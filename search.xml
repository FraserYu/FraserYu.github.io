<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SQLECTRON-è¶…è½»é‡çº§SQLå®¢æˆ·ç«¯</title>
      <link href="//p/SQLECTRON-sql-client.html"/>
      <url>//p/SQLECTRON-sql-client.html</url>
      
        <content type="html"><![CDATA[<p>æ— æ„é—´çœ‹åˆ°è¿™ä¸ªSQLå®¢æˆ·ç«¯ï¼Œç¬é—´è¢«å®ƒç®€æ´çš„é¡µé¢å¸å¼•äº†ï¼Œ å¯åŠ¨ç”»é¢å¯èƒ½æ˜¯å®ƒæœ€å¤æ‚çš„å‘ˆç°äº†ï¼Œçˆ±æ²¡ï¼Ÿ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/2020-07-22at10.58.56.gif" alt=""></fancybox></p><h2 id="SQLECTRON"><a href="#SQLECTRON" class="headerlink" title="SQLECTRON"></a>SQLECTRON</h2><p>æŒ‰ç…§<a href="https://sqlectron.github.io/" target="_blank" rel="noopener">å®˜ç½‘</a> (<a href="https://sqlectron.github.io/" target="_blank" rel="noopener">https://sqlectron.github.io/</a>,  çœ‹ URL å‘ç°ï¼ŒSQLECTRONå®˜ç½‘éƒ½æ˜¯ç”¨ Github Pages æ­å»ºçš„) çš„è¯´æ˜ï¼š</p><blockquote><p>ä¸€ä¸ªç®€å•çš„è½»é‡çº§SQLå®¢æˆ·ç«¯æ¡Œé¢/ç»ˆç«¯ï¼Œå…·æœ‰è·¨æ•°æ®åº“å’Œè·¨å¹³å°çš„æ”¯æŒ</p></blockquote><p>çœ‹åˆ°è¿™ä½ åº”è¯¥æ”¾å¿ƒäº†ï¼Œæ— è®ºä½ ä½¿ç”¨çš„æ˜¯  <code>Linux</code>ï¼Œ <code>Mac</code> è¿˜æ˜¯ <code>Windows</code>ï¼Œéƒ½å¯ä»¥è¯•ä¸€è¯•ã€‚é‚£å®ƒæ”¯æŒå“ªäº›æ•°æ®åº“å‘¢ï¼Ÿä¸€ä¼šåˆ°å®‰è£…ç•Œé¢ä½ å°±ä¼šå‘ç°äº†</p><p>è¿™é‡Œæˆ‘ç”¨ MAC æ¼”ç¤ºä¸€ä¸‹æ•´ä¸ªä½¿ç”¨è¿‡ç¨‹</p><h2 id="å®‰è£…ä¸ä½¿ç”¨"><a href="#å®‰è£…ä¸ä½¿ç”¨" class="headerlink" title="å®‰è£…ä¸ä½¿ç”¨"></a>å®‰è£…ä¸ä½¿ç”¨</h2><p>å†™æœ¬æ–‡æ—¶çš„ç‰ˆæœ¬ä¸º <code>v1.30.0</code>, ç›´æ¥ä¸‹è½½å®‰è£…åŒ…â€”â€”&gt;æ‹–æ‹½, ä¸€æ­¥å®‰è£…å®Œæˆ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722103040.png" alt=""></fancybox></p><p>æ·»åŠ  Server</p><p><fancybox><img src="https://rgyb.sunluomeng.top/2020-07-22at11.23.19.gif" alt=""></fancybox></p><p>å¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œä»Database Type ä¸­ä½ åº”è¯¥å·²ç»çœ‹åˆ°äº†ï¼Œç›®å‰æ”¯æŒçš„æ•°æ®åº“ç±»å‹æœ‰ï¼š</p><ul><li>MySQL</li><li>PostgreSQL</li><li>Microsoft SQL Server</li><li>SQLite</li><li>Cassandra</li></ul><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722104013.png" alt=""></fancybox></p><p>æµ‹è¯•è¿æ¥ â€”â€”&gt; Save å³å¯</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722104034.png" alt=""></fancybox></p><p>é€‰æ‹©ç›¸åº”çš„ Serverï¼Œ ç„¶å Connectï¼Œæ‰§è¡Œä¸ª SQL è¯•ä¸€è¯•</p><p><fancybox><img src="https://rgyb.sunluomeng.top/2020-07-22at11.32.40.gif" alt=""></fancybox></p><p>è·å–æ‰§è¡Œç»“æœåï¼Œå¯ä»¥å¿«é€Ÿç²˜è´´ä¸º JSON æˆ– CSV æ ¼å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¼å‡ºç›¸åº”æ ¼å¼æ–‡ä»¶ï¼Œéå¸¸æ–¹ä¾¿</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722113741.png" alt=""></fancybox></p><p>æ—¥å¸¸ explain ä¸ª SQLï¼Œ ç”»é£éƒ½ä¸ä¸€æ ·äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722114118.png" alt=""></fancybox></p><p>è¯´å®ƒå¾ˆè½»é‡çº§ï¼Œæˆ‘ä»¬å’ŒDataGrip æ¥åšä¸ªæ¯”è¾ƒ<strong>ï¼ˆè¿™ä¹ˆæ¯”çœŸæ˜¯æ²¡æœ‰äººæ€§ï¼ŒDataGrip çš„åŠŸèƒ½æœ‰å¤šå°‘æ€ä¹ˆä¸è¯´å‘¢ï¼‰</strong> å¦‚æœä¸æ˜¯é‡åº¦å®¢æˆ·ç«¯ä¾èµ–çš„åŒå­¦ï¼ŒSQLECTRON è¿˜æ˜¯æ»¡è¶³åŸºæœ¬è¦æ±‚çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722105551.png" alt=""></fancybox></p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722105628.png" alt=""></fancybox></p><p>ç”±äºå®¢æˆ·ç«¯æä¾›çš„åŠŸèƒ½å¹¶ä¸å¤æ‚ï¼Œæ‰€ä»¥<a href="https://github.com/sqlectron/sqlectron-gui/wiki/Keyboard-Shortcuts" target="_blank" rel="noopener">å¿«æ·é”®</a> (<a href="https://github.com/sqlectron/sqlectron-gui/wiki/Keyboard-Shortcuts)ä¹Ÿå°‘çš„å¯æ€œï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…" target="_blank" rel="noopener">https://github.com/sqlectron/sqlectron-gui/wiki/Keyboard-Shortcuts)ä¹Ÿå°‘çš„å¯æ€œï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…</a></p><p>å¦‚æœä½ æ›´å–œæ¬¢ç»ˆç«¯å½¢å¼ï¼ŒSQLECTRON è¿˜æœ‰ä¸€ä¸ª <code>SQLECTRON-TERM</code>  (<a href="https://github.com/sqlectron/sqlectron-term" target="_blank" rel="noopener">https://github.com/sqlectron/sqlectron-term</a>) å®¢æˆ·ç«¯æ”¯æŒï¼Œå°±åƒè¿™æ ·ï¼Œæµ“æµ“çš„ BIOS é£</p><p><fancybox><img src="https://rgyb.sunluomeng.top/sqlectron-demo-term-v1.0.0.gif" alt=""></fancybox></p><p>åªéœ€ä¸€æ¡å‘½ä»¤å®‰è£…å³å¯ï¼ˆå‰ææ˜¯å®‰è£… Nodeï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g sqlectron-term</span><br></pre></td></tr></table></figure><p>Bu<del>~</del>t</p><p>å…ˆåˆ«ç›²ç›®è¿½é€ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨ Javascript è¯­è¨€å®ç°çš„ï¼Œå¹¶ä¸”åœ¨ github ä¸Šçš„æ˜Ÿæ ‡å¹¶ä¸å¤š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722115846.png" alt=""></fancybox></p><p>å› ä¸º Owner å‡ºäºå…´è¶£ç»´æŠ¤è¿™ä¸ªé¡¹ç›®ï¼Œä½†æ˜¯ç°åœ¨å…´è¶£æ²¡äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200722115950.png" alt=""></fancybox></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœä½ åªæ˜¯åšæ—¥å¸¸çš„åŸºæœ¬ SQL æ‰§è¡Œï¼Œé‚£ä¹ˆ SQLECTRON å®Œå…¨å¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ ä¸ç”¨å†æ‰¾ DataGrip æˆ– Navicat çš„æ³¨å†Œç ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šè®©ç”µè„‘å‘çƒ­å¤ªå¤šå‘ç”Ÿå¡é¡¿</p><p>å¦‚æœä½ æœ‰å…´è¶£çœ‹ä¸€çœ‹ï¼Œå¹¶ä¸”æƒ³å°è¯•ç»´æŠ¤è¿™ä¸ªé¡¹ç›®ï¼Œè¿™åˆæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é”»ç‚¼æœºä¼š</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> æ•°æ®åº“-æŒä¹…å±‚-SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java8 CompletableFuture ä½¿ç”¨è¯¦è§£</title>
      <link href="//p/java8-completablefuture-tutorial.html"/>
      <url>//p/java8-completablefuture-tutorial.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://rgyb.sunluomeng.top/puppy-5388151_1280.jpg" alt=""></p><hr><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719211506.png" alt=""></fancybox></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://dayarch.top/p/java-future-and-callable.html">ä¸ä¼šç”¨Java Futureï¼Œæˆ‘æ€€ç–‘ä½ æ³¡èŒ¶æ²¡æˆ‘å¿« </a> å…¨é¢åˆ†æäº† Futureï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå®ƒè™½ç„¶è§£å†³äº† Runnable çš„ â€œä¸‰æ— â€ çŸ­æ¿ï¼Œä½†æ˜¯å®ƒè‡ªèº«è¿˜æ˜¯æœ‰çŸ­æ¿ï¼š</p><blockquote><p>ä¸èƒ½æ‰‹åŠ¨å®Œæˆè®¡ç®—</p></blockquote><p>å‡è®¾ä½ ä½¿ç”¨ Future è¿è¡Œå­çº¿ç¨‹è°ƒç”¨è¿œç¨‹ API æ¥è·å–æŸæ¬¾äº§å“çš„æœ€æ–°ä»·æ ¼ï¼ŒæœåŠ¡å™¨ç”±äºæ´ªç¾å®•æœºäº†ï¼Œæ­¤æ—¶å¦‚æœä½ æƒ³æ‰‹åŠ¨ç»“æŸè®¡ç®—ï¼Œè€Œæ˜¯æƒ³è¿”å›ä¸Šæ¬¡ç¼“å­˜ä¸­çš„ä»·æ ¼ï¼Œè¿™æ˜¯ Future åšä¸åˆ°çš„</p><blockquote><p>è°ƒç”¨ get() æ–¹æ³•ä¼šé˜»å¡ç¨‹åº</p></blockquote><p>Future ä¸ä¼šé€šçŸ¥ä½ å®ƒçš„å®Œæˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªget()æ–¹æ³•ï¼Œç¨‹åºè°ƒç”¨è¯¥æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°ç»“æœå¯ç”¨ä¸ºæ­¢ï¼Œæ²¡æœ‰åŠæ³•åˆ©ç”¨å›è°ƒå‡½æ•°é™„åŠ åˆ°Futureï¼Œå¹¶åœ¨Futureçš„ç»“æœå¯ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨å®ƒ</p><blockquote><p>ä¸èƒ½é“¾å¼æ‰§è¡Œ</p></blockquote><p>çƒ§æ°´æ³¡èŒ¶ä¸­ï¼Œé€šè¿‡æ„é€ å‡½æ•°ä¼ å‚åšåˆ°å¤šä¸ªä»»åŠ¡çš„é“¾å¼æ‰§è¡Œï¼Œä¸‡ä¸€æœ‰æ›´å¤šçš„ä»»åŠ¡ï¼Œæˆ–æ˜¯ä»»åŠ¡é“¾çš„æ‰§è¡Œé¡ºåºæœ‰å˜ï¼Œå¯¹åŸæœ‰ç¨‹åºçš„å½±å“éƒ½æ˜¯éå¸¸å¤§çš„</p><blockquote><p>æ•´åˆå¤šä¸ª Future æ‰§è¡Œç»“æœæ–¹å¼ç¬¨é‡</p></blockquote><p>å‡è®¾æœ‰å¤šä¸ª Future å¹¶è¡Œæ‰§è¡Œï¼Œéœ€è¦åœ¨è¿™äº›ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæˆä¹‹ååšåç»­æ“ä½œï¼ŒFuture æœ¬èº«æ˜¯åšä¸åˆ°çš„ï¼Œéœ€è¦å€ŸåŠ©å·¥å…·ç±» <code>Executors</code> çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span></span><br></pre></td></tr></table></figure><blockquote><p>æ²¡æœ‰å¼‚å¸¸å¤„ç†</p></blockquote><p>Future åŒæ ·æ²¡æœ‰æä¾›å¾ˆå¥½çš„å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719174354.png" alt=""></fancybox></p><p>ä¸Šä¸€ç¯‡æ–‡ç« çœ‹ Future è§‰å¾—æ˜¯å‘ç°äº†æ–°å¤©åœ°ï¼Œè¿™ä¹ˆä¸€è¯´æœ‰æ„Ÿè§‰å›åˆ°äº†è§£æ”¾å‰</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719174523.png" alt=""></fancybox></p><p>å¯¹äº Java åç«¯çš„åŒå­¦ï¼Œåœ¨ Java1.8 ä¹‹å‰æƒ³å®ç°å¼‚æ­¥ç¼–ç¨‹ï¼Œè¿˜æƒ³é¿å¼€ä¸Šè¿°è¿™äº›çƒ¦æ¼ï¼Œ<a href="http://reactivex.io/intro.html" target="_blank" rel="noopener">ReactiveX</a> åº”è¯¥æ˜¯ä¸€ä¸ªå¸¸è§è§£å†³æ–¹æ¡ˆï¼ˆåšAndroid çš„åº”è¯¥ä¼šæœ‰äº†è§£ï¼‰ã€‚å¦‚æœç†Ÿæ‚‰å‰ç«¯åŒå­¦ï¼Œ ES6 Promiseï¼ˆç”·æœ‹å‹çš„æ‰¿è¯ºï¼‰ä¹Ÿè§£å†³äº†å¼‚æ­¥ç¼–ç¨‹çš„çƒ¦æ¼</p><p>å¤©ä¸‹è¯­è¨€éƒ½åœ¨å½¼æ­¤å€Ÿé‰´ç›¸åº”ä¼˜ç‚¹ï¼ŒJava ä½œä¸ºè€ç‰ŒåŠ²æ—…è‡ªç„¶ä¹Ÿè¦è§£å†³ä¸Šè¿°é—®é¢˜ã€‚åˆæ˜¯é‚£ä¸ªç”·äººï¼Œå¹¶å‘å¤§å¸ˆ Doug Lea å¿§å¤©ä¸‹ç¨‹åºå‘˜ä¹‹å¿§ï¼Œè§£å¤©ä¸‹ç¨‹åºå‘˜ä¹‹å›°æ‰°ï¼Œåœ¨ Java1.8 ç‰ˆæœ¬ï¼ˆLambda æ¨ªç©ºå‡ºä¸–ï¼‰ä¸­ï¼Œæ–°å¢äº†ä¸€ä¸ªå¹¶å‘å·¥å…·ç±» <strong>CompletableFuture</strong>ï¼Œå®ƒçš„å‡ºç°ï¼Œè®©äººåœ¨æ³¡èŒ¶è¿‡ç¨‹ä¸­ï¼Œå“å°åˆ°äº†ä¸ä¸€æ ·çš„å‘³é“â€¦â€¦</p><h2 id="å‡ ä¸ªé‡è¦-Lambda-å‡½æ•°"><a href="#å‡ ä¸ªé‡è¦-Lambda-å‡½æ•°" class="headerlink" title="å‡ ä¸ªé‡è¦ Lambda å‡½æ•°"></a>å‡ ä¸ªé‡è¦ Lambda å‡½æ•°</h2><p><strong>CompletableFuture</strong> åœ¨ Java1.8 çš„ç‰ˆæœ¬ä¸­å‡ºç°ï¼Œè‡ªç„¶ä¹Ÿå¾—æ­ä¸Š Lambda çš„é¡ºé£è½¦ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£ <strong>CompletableFuture</strong>ï¼Œè¿™é‡Œæˆ‘éœ€è¦å…ˆä»‹ç»ä¸€ä¸‹å‡ ä¸ª Lambda å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å®ƒä»¬çš„ä»¥ä¸‹å‡ ç‚¹å°±å¯ä»¥ï¼š</p><ul><li>å‚æ•°æ¥å—å½¢å¼</li><li>è¿”å›å€¼å½¢å¼</li><li>å‡½æ•°åç§°</li></ul><h3 id="Runnable"><a href="#Runnable" class="headerlink" title="Runnable"></a>Runnable</h3><p>Runnable æˆ‘ä»¬å·²ç»è¯´è¿‡æ— æ•°æ¬¡äº†ï¼Œæ— å‚æ•°ï¼Œæ— è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>Function&lt;T, R&gt; æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><p>Consumer<T> æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Supplier"><a href="#Supplier" class="headerlink" title="Supplier"></a>Supplier</h3><p>Supplier<T> æ²¡æœ‰å‚æ•°ï¼Œæœ‰ä¸€ä¸ªè¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BiConsumer"><a href="#BiConsumer" class="headerlink" title="BiConsumer"></a>BiConsumer</h3><p>BiConsumer&lt;T, U&gt; æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ˆBiï¼Œ è‹±æ–‡å•è¯è¯æ ¹ï¼Œä»£è¡¨ä¸¤ä¸ªçš„æ„æ€ï¼‰ï¼Œæ²¡æœ‰è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BiConsumer</span>&lt;<span class="title">T</span>, <span class="title">U</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t, U u)</span></span>;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œæˆ‘ä»¬åšä¸ªå°æ±‡æ€»</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719175939.png" alt=""></fancybox></p><p>æœ‰äº›åŒå­¦å¯èƒ½æœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦å…³æ³¨è¿™å‡ ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå› ä¸º <strong>CompletableFuture</strong> çš„å‡½æ•°å‘½åä»¥åŠå…¶ä½œç”¨éƒ½æ˜¯å’Œè¿™å‡ ä¸ªå‡½æ•°å¼æ¥å£é«˜åº¦ç›¸å…³çš„ï¼Œä¸€ä¼šä½ å°±ä¼šå‘ç°äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719180154.png" alt=""></fancybox></p><p>å‰æˆåšè¶³ï¼Œç»ˆäºå¯ä»¥è¿›å…¥æ­£é¢˜äº† <strong>CompletableFuture</strong></p><h2 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h2><h3 id="ç±»ç»“æ„"><a href="#ç±»ç»“æ„" class="headerlink" title="ç±»ç»“æ„"></a>ç±»ç»“æ„</h3><p>è€è§„çŸ©ï¼Œå…ˆä»ç±»ç»“æ„çœ‹èµ·ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719153822.png" alt=""></fancybox></p><h4 id="å®ç°äº†-Future-æ¥å£"><a href="#å®ç°äº†-Future-æ¥å£" class="headerlink" title="å®ç°äº† Future æ¥å£"></a>å®ç°äº† Future æ¥å£</h4><p>å®ç°äº† Future æ¥å£ï¼Œé‚£å°±å…·æœ‰ Future æ¥å£çš„ç›¸å…³ç‰¹æ€§ï¼Œè¯·è„‘è¡¥ Future é‚£å°‘çš„å¯æ€œçš„ 5 ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œå…·ä½“è¯·æŸ¥çœ‹ <a href="https://dayarch.top/p/java-future-and-callable.html">ä¸ä¼šç”¨Java Futureï¼Œæˆ‘æ€€ç–‘ä½ æ³¡èŒ¶æ²¡æˆ‘å¿« </a> </p><h4 id="å®ç°äº†-CompletionStage-æ¥å£"><a href="#å®ç°äº†-CompletionStage-æ¥å£" class="headerlink" title="å®ç°äº† CompletionStage æ¥å£"></a>å®ç°äº† CompletionStage æ¥å£</h4><p>CompletionStage è¿™ä¸ªæ¥å£è¿˜æ˜¯æŒºé™Œç”Ÿçš„ï¼Œä¸­æ–‡ç›´è¯‘è¿‡æ¥æ˜¯ã€ç«£å·¥é˜¶æ®µã€‘ï¼Œå¦‚æœå°†çƒ§æ°´æ³¡èŒ¶æ¯”å–»æˆä¸€é¡¹å¤§å·¥ç¨‹ï¼Œä»–ä»¬çš„ç«£å·¥é˜¶æ®µä½“ç°æ˜¯ä¸ä¸€æ ·çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705191033.png" alt=""></fancybox></p><ol><li><p>å•çœ‹çº¿ç¨‹1 æˆ–å•çœ‹çº¿ç¨‹ 2 å°±æ˜¯ä¸€ç§ä¸²è¡Œå…³ç³»ï¼Œåšå®Œä¸€æ­¥ä¹‹ååšä¸‹ä¸€æ­¥</p></li><li><p>ä¸€èµ·çœ‹çº¿ç¨‹1 å’Œ çº¿ç¨‹ 2ï¼Œå®ƒä»¬å½¼æ­¤å°±æ˜¯å¹¶è¡Œå…³ç³»ï¼Œä¸¤ä¸ªçº¿ç¨‹åšçš„äº‹å½¼æ­¤ç‹¬ç«‹äº’ä¸å¹²æ‰°</p></li><li><p>æ³¡èŒ¶å°±æ˜¯çº¿ç¨‹1 å’Œ çº¿ç¨‹ 2 çš„æ±‡æ€»/ç»„åˆï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ 1 å’Œ çº¿ç¨‹ 2 éƒ½å®Œæˆä¹‹åæ‰èƒ½åˆ°è¿™ä¸ªé˜¶æ®µï¼ˆå½“ç„¶ä¹Ÿå­˜åœ¨çº¿ç¨‹1 æˆ– çº¿ç¨‹ 2 ä»»æ„ä¸€ä¸ªçº¿ç¨‹ç«£å·¥å°±å¯ä»¥å¼€å¯ä¸‹ä¸€é˜¶æ®µçš„åœºæ™¯ï¼‰</p></li></ol><p>æ‰€ä»¥ï¼ŒCompletionStage æ¥å£çš„ä½œç”¨å°±åšäº†è¿™ç‚¹äº‹ï¼Œæ‰€æœ‰å‡½æ•°éƒ½ç”¨äºæè¿°ä»»åŠ¡çš„æ—¶åºå…³ç³»ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719181233.png" alt=""></fancybox></p><p><strong>CompletableFuture</strong> æ—¢ç„¶å®ç°äº†ä¸¤ä¸ªæ¥å£ï¼Œè‡ªç„¶ä¹Ÿå°±ä¼šå®ç°ç›¸åº”çš„æ–¹æ³•å……åˆ†åˆ©ç”¨å…¶æ¥å£ç‰¹æ€§ï¼Œæˆ‘ä»¬èµ°è¿›å®ƒçš„æ–¹æ³•æ¥çœ‹ä¸€çœ‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719182536.png" alt=""></fancybox></p><p><strong>CompletableFuture</strong> å¤§çº¦æœ‰50ç§ä¸åŒå¤„ç†ä¸²è¡Œï¼Œå¹¶è¡Œï¼Œç»„åˆä»¥åŠå¤„ç†é”™è¯¯çš„æ–¹æ³•ã€‚å°å¼Ÿå±å¹•ä¸äº‰æ°”ï¼Œæ–¹æ³•ä¹‹å¤šï¼Œä¸€ä¸ªå±å¹•è£…ä¸ä¸‹ï¼Œçœ‹åˆ°è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯ç¬é—´è¦ç›´æ¥ <code>æ”¶è—â€”â€”&gt;åƒç°</code> 2è¿èµ°äººï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬æŒ‰ç…§ç›¸åº”çš„å‘½åå’Œä½œç”¨è¿›è¡Œåˆ†ç±»ï¼Œåˆ†åˆ†é’Ÿæå®š50å¤šç§æ–¹æ³•</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719183446.png" alt=""></fancybox></p><h3 id="ä¸²è¡Œå…³ç³»"><a href="#ä¸²è¡Œå…³ç³»" class="headerlink" title="ä¸²è¡Œå…³ç³»"></a>ä¸²è¡Œå…³ç³»</h3><p><code>then</code> ç›´è¯‘ã€ç„¶åã€‘ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºä¸‹ä¸€æ­¥ï¼Œæ‰€ä»¥é€šå¸¸æ˜¯ä¸€ç§ä¸²è¡Œå…³ç³»ä½“ç°, then åé¢çš„å•è¯ï¼ˆæ¯”å¦‚ run /apply/acceptï¼‰å°±æ˜¯ä¸Šé¢è¯´çš„å‡½æ•°å¼æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•åç§°äº†ï¼Œå®ƒçš„ä½œç”¨å’Œé‚£å‡ ä¸ªå‡½æ•°å¼æ¥å£çš„ä½œç”¨æ˜¯ä¸€æ ·ä¸€æ ·æ»´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">thenRun</span><span class="params">(Runnable action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">thenRunAsync</span><span class="params">(Runnable action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">thenRunAsync</span><span class="params">(Runnable action, Executor executor)</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenApply</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenApplyAsync</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenApplyAsync</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends U&gt; fn, Executor executor)</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">thenAccept</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; action)</span> </span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">thenAcceptAsync</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">thenAcceptAsync</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; action, Executor executor)</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenCompose</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends CompletionStage&lt;U&gt;&gt; fn)</span>  </span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenComposeAsync</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends CompletionStage&lt;U&gt;&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenComposeAsync</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends CompletionStage&lt;U&gt;&gt; fn, Executor executor)</span></span></span><br></pre></td></tr></table></figure><h3 id="èšåˆ-And-å…³ç³»"><a href="#èšåˆ-And-å…³ç³»" class="headerlink" title="èšåˆ And å…³ç³»"></a>èšåˆ And å…³ç³»</h3><p><code>combine... with...</code> å’Œ <code>both...and...</code> éƒ½æ˜¯è¦æ±‚ä¸¤è€…éƒ½æ»¡è¶³ï¼Œä¹Ÿå°±æ˜¯ and çš„å…³ç³»äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;U,V&gt; <span class="function">CompletableFuture&lt;V&gt; <span class="title">thenCombine</span><span class="params">(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? <span class="keyword">super</span> T,? <span class="keyword">super</span> U,? extends V&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U,V&gt; CompletableFuture&lt;V&gt; <span class="title">thenCombineAsync</span><span class="params">(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? <span class="keyword">super</span> T,? <span class="keyword">super</span> U,? extends V&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U,V&gt; CompletableFuture&lt;V&gt; <span class="title">thenCombineAsync</span><span class="params">(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? <span class="keyword">super</span> T,? <span class="keyword">super</span> U,? extends V&gt; fn, Executor executor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;Void&gt; <span class="title">thenAcceptBoth</span><span class="params">(CompletionStage&lt;? extends U&gt; other, BiConsumer&lt;? <span class="keyword">super</span> T, ? <span class="keyword">super</span> U&gt; action)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;Void&gt; <span class="title">thenAcceptBothAsync</span><span class="params">(CompletionStage&lt;? extends U&gt; other, BiConsumer&lt;? <span class="keyword">super</span> T, ? <span class="keyword">super</span> U&gt; action)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;Void&gt; <span class="title">thenAcceptBothAsync</span><span class="params">( CompletionStage&lt;? extends U&gt; other, BiConsumer&lt;? <span class="keyword">super</span> T, ? <span class="keyword">super</span> U&gt; action, Executor executor)</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">runAfterBoth</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">runAfterBothAsync</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">runAfterBothAsync</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action, Executor executor)</span></span></span><br></pre></td></tr></table></figure><h3 id="èšåˆ-Or-å…³ç³»"><a href="#èšåˆ-Or-å…³ç³»" class="headerlink" title="èšåˆ Or å…³ç³»"></a>èšåˆ Or å…³ç³»</h3><p><code>Either...or...</code> è¡¨ç¤ºä¸¤è€…ä¸­çš„ä¸€ä¸ªï¼Œè‡ªç„¶ä¹Ÿå°±æ˜¯ Or çš„ä½“ç°äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;U&gt; <span class="function">CompletableFuture&lt;U&gt; <span class="title">applyToEither</span><span class="params">(CompletionStage&lt;? extends T&gt; other, Function&lt;? <span class="keyword">super</span> T, U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">applyToEitherAsync</span><span class="params">(ã€CompletionStage&lt;? extends T&gt; other, Function&lt;? <span class="keyword">super</span> T, U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">applyToEitherAsync</span><span class="params">(CompletionStage&lt;? extends T&gt; other, Function&lt;? <span class="keyword">super</span> T, U&gt; fn, Executor executor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">acceptEither</span><span class="params">(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? <span class="keyword">super</span> T&gt; action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">acceptEitherAsync</span><span class="params">(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? <span class="keyword">super</span> T&gt; action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">acceptEitherAsync</span><span class="params">(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? <span class="keyword">super</span> T&gt; action, Executor executor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">runAfterEither</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">runAfterEitherAsync</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;Void&gt; <span class="title">runAfterEitherAsync</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action, Executor executor)</span></span></span><br></pre></td></tr></table></figure><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CompletableFuture&lt;T&gt; <span class="title">exceptionally</span><span class="params">(Function&lt;Throwable, ? extends T&gt; fn)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;T&gt; <span class="title">exceptionallyAsync</span><span class="params">(Function&lt;Throwable, ? extends T&gt; fn)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;T&gt; <span class="title">exceptionallyAsync</span><span class="params">(Function&lt;Throwable, ? extends T&gt; fn, Executor executor)</span></span></span><br><span class="line"><span class="function">        </span></span><br><span class="line"><span class="function">CompletableFuture&lt;T&gt; <span class="title">whenComplete</span><span class="params">(BiConsumer&lt;? <span class="keyword">super</span> T, ? <span class="keyword">super</span> Throwable&gt; action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;T&gt; <span class="title">whenCompleteAsync</span><span class="params">(BiConsumer&lt;? <span class="keyword">super</span> T, ? <span class="keyword">super</span> Throwable&gt; action)</span></span></span><br><span class="line"><span class="function">CompletableFuture&lt;T&gt; <span class="title">whenCompleteAsync</span><span class="params">(BiConsumer&lt;? <span class="keyword">super</span> T, ? <span class="keyword">super</span> Throwable&gt; action, Executor executor)</span></span></span><br><span class="line"><span class="function">        </span></span><br><span class="line"><span class="function">       </span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">handle</span><span class="params">(BiFunction&lt;? <span class="keyword">super</span> T, Throwable, ? extends U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">handleAsync</span><span class="params">(BiFunction&lt;? <span class="keyword">super</span> T, Throwable, ? extends U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">handleAsync</span><span class="params">(BiFunction&lt;? <span class="keyword">super</span> T, Throwable, ? extends U&gt; fn, Executor executor)</span></span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¼‚å¸¸å¤„ç†çœ‹ç€è¿˜æŒºå“äººçš„ï¼Œæ‹¿ä¼ ç»Ÿçš„ try/catch/finally åšä¸ªå¯¹æ¯”ä¹Ÿå°±ç¬é—´ç§’æ‡‚äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719185042.png" alt=""></fancybox></p><p>whenComplete å’Œ handle çš„åŒºåˆ«å¦‚æœä½ çœ‹æ¥å—çš„å‚æ•°å‡½æ•°å¼æ¥å£åç§°ä½ ä¹Ÿå°±èƒ½çœ‹å‡ºå·®åˆ«äº†ï¼Œå‰è€…ä½¿ç”¨Comsumer, è‡ªç„¶ä¹Ÿå°±ä¸ä¼šæœ‰è¿”å›å€¼ï¼›åè€…ä½¿ç”¨ Functionï¼Œè‡ªç„¶ä¹Ÿå°±ä¼šæœ‰è¿”å›å€¼</p><p>è¿™é‡Œå¹¶æ²¡æœ‰å…¨éƒ¨åˆ—ä¸¾ï¼Œä¸è¿‡ç›¸ä¿¡å¾ˆå¤šåŒå­¦å·²ç»å‘ç°äº†è§„å¾‹ï¼š</p><blockquote><p>CompletableFuture æä¾›çš„æ‰€æœ‰å›è°ƒæ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªå¼‚æ­¥ï¼ˆAsyncï¼‰å˜ä½“ï¼Œéƒ½åƒè¿™æ ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// thenApply() çš„å˜ä½“</span></span><br><span class="line">&lt;U&gt; <span class="function">CompletableFuture&lt;U&gt; <span class="title">thenApply</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenApplyAsync</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends U&gt; fn)</span></span></span><br><span class="line"><span class="function">&lt;U&gt; CompletableFuture&lt;U&gt; <span class="title">thenApplyAsync</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends U&gt; fn, Executor executor)</span></span></span><br></pre></td></tr></table></figure><blockquote><p>å¦å¤–,æ–¹æ³•çš„åç§°ä¹Ÿéƒ½ä¸å‰æˆä¸­è¯´çš„å‡½æ•°å¼æ¥å£å®Œå…¨åŒ¹é…ï¼ŒæŒ‰ç…§è¿™ä¸­è§„å¾‹åˆ†ç±»ä¹‹åï¼Œè¿™ 50 å¤šä¸ªæ–¹æ³•çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆè½»æ¾äº†å‘¢ï¼Ÿ</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719185324.png" alt=""></fancybox></p><p>åŸºæœ¬æ–¹æ³•å·²ç»ç½—åˆ—çš„å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥å®é™…æ¼”ç¤ºä¸€ä¸‹ï¼š</p><h3 id="æ¡ˆä¾‹æ¼”ç¤º"><a href="#æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="æ¡ˆä¾‹æ¼”ç¤º"></a>æ¡ˆä¾‹æ¼”ç¤º</h3><h4 id="åˆ›å»ºä¸€ä¸ª-CompletableFuture-å¯¹è±¡"><a href="#åˆ›å»ºä¸€ä¸ª-CompletableFuture-å¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ª CompletableFuture å¯¹è±¡"></a>åˆ›å»ºä¸€ä¸ª CompletableFuture å¯¹è±¡</h4><p>åˆ›å»ºä¸€ä¸ª CompletableFuture å¯¹è±¡å¹¶æ²¡æœ‰ä»€ä¹ˆç¨€å¥‡çš„ï¼Œä¾æ—§æ˜¯é€šè¿‡æ„é€ å‡½æ•°æ„å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; completableFuture = <span class="keyword">new</span> CompletableFuture&lt;String&gt;();</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æœ€ç®€å•çš„ CompletableFuture å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œç”±äºå®ƒå®ç°äº† Future æ¥å£ï¼Œæ‰€ä»¥è‡ªç„¶å°±å¯ä»¥é€šè¿‡ get() æ–¹æ³•è·å–ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String result = completableFuture.get();</span><br></pre></td></tr></table></figure><p>æ–‡ç« å¼€å¤´å·²ç»è¯´è¿‡ï¼Œget()æ–¹æ³•åœ¨ä»»åŠ¡ç»“æŸä¹‹å‰å°†ä¸€ç›´å¤„åœ¨é˜»å¡çŠ¶æ€ï¼Œç”±äºä¸Šé¢åˆ›å»ºçš„ Future æ²¡æœ‰è¿”å›ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè°ƒç”¨ get() å°†ä¼šæ°¸ä¹…æ€§çš„å µå¡</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719190106.png" alt=""></fancybox></p><p>è¿™æ—¶å°±éœ€è¦æˆ‘ä»¬è°ƒç”¨ complete() æ–¹æ³•æ‰‹åŠ¨çš„ç»“æŸä¸€ä¸ª Future</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">completableFuture.complete(<span class="string">"Future's Result Here Manually"</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œæ‰€æœ‰ç­‰å¾…è¿™ä¸ª Future çš„ client éƒ½ä¼šè¿”å›æ‰‹åŠ¨ç»“æŸçš„æŒ‡å®šç»“æœ</p><h4 id="runAsync"><a href="#runAsync" class="headerlink" title="runAsync"></a>runAsync</h4><p>ä½¿ç”¨ <code>runAsync</code> è¿›è¡Œå¼‚æ­¥è®¡ç®—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"è¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å½“ä¸­"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">future.get();</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨çš„æ˜¯ Runnable å‡½æ•°å¼è¡¨è¾¾å¼ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šè·å–åˆ°ç»“æœ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719190859.png" alt=""></fancybox></p><h4 id="supplyAsync"><a href="#supplyAsync" class="headerlink" title="supplyAsync"></a>supplyAsync</h4><p>ä½¿ç”¨ <code>runAsync</code> æ˜¯æ²¡æœ‰è¿”å›ç»“æœçš„ï¼Œæˆ‘ä»¬æƒ³è·å–å¼‚æ­¥è®¡ç®—çš„è¿”å›ç»“æœéœ€è¦ä½¿ç”¨ <code>supplyAsync()</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">&#125;</span><br><span class="line">log.info(<span class="string">"è¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å½“ä¸­"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"æˆ‘æœ‰è¿”å›å€¼"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">log.info(future.get());</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨çš„æ˜¯ Supplier å‡½æ•°å¼è¡¨è¾¾å¼ï¼Œè‡ªç„¶å¯ä»¥è·å¾—è¿”å›ç»“æœ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719191341.png" alt=""></fancybox></p><p>æˆ‘ä»¬å·²ç»å¤šæ¬¡è¯´è¿‡ï¼Œget() æ–¹æ³•åœ¨Future è®¡ç®—å®Œæˆä¹‹å‰ä¼šä¸€ç›´å¤„åœ¨ blocking çŠ¶æ€ä¸‹ï¼Œå¯¹äºçœŸæ­£çš„å¼‚æ­¥å¤„ç†ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯å¯ä»¥é€šè¿‡ä¼ å…¥å›è°ƒå‡½æ•°ï¼Œåœ¨Future ç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ç­‰å¾…ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; comboText = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">  <span class="comment">//å¯ä»¥æ³¨é‡Šæ‰åšå¿«é€Ÿè¿”å› start</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">&#125;</span><br><span class="line">log.info(<span class="string">"ğŸ‘"</span>);</span><br><span class="line">  <span class="comment">//å¯ä»¥æ³¨é‡Šæ‰åšå¿«é€Ÿè¿”å› end</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"èµ"</span>;</span><br><span class="line">&#125;)</span><br><span class="line">.thenApply(first -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"åœ¨çœ‹"</span>);</span><br><span class="line"><span class="keyword">return</span> first + <span class="string">", åœ¨çœ‹"</span>;</span><br><span class="line">&#125;)</span><br><span class="line">.thenApply(second -&gt; second + <span class="string">", è½¬å‘"</span>);</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"ä¸‰è¿æœ‰æ²¡æœ‰ï¼Ÿ"</span>);</span><br><span class="line">log.info(comboText.get());</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719194326.png" alt=""></fancybox></p><p>å¯¹ thenApply çš„è°ƒç”¨å¹¶æ²¡æœ‰é˜»å¡ç¨‹åºæ‰“å°logï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„é€šè¿‡å›è°ƒé€šçŸ¥æœºåˆ¶ï¼Œ è¿™é‡Œä½ çœ‹åˆ° thenApply  ä½¿ç”¨çš„æ˜¯supplyAsyncæ‰€ç”¨çš„çº¿ç¨‹ï¼Œå¦‚æœå°†supplyAsync åšå¿«é€Ÿè¿”å›ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719194537.png" alt=""></fancybox></p><p>thenApply æ­¤æ—¶ä½¿ç”¨çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥ï¼š</p><blockquote><p><strong>ä¸²è¡Œçš„åç»­æ“ä½œå¹¶ä¸ä¸€å®šä¼šå’Œå‰åºæ“ä½œä½¿ç”¨åŒä¸€ä¸ªçº¿ç¨‹</strong></p></blockquote><h4 id="thenAccept"><a href="#thenAccept" class="headerlink" title="thenAccept"></a>thenAccept</h4><p>å¦‚æœä½ ä¸æƒ³ä»å›è°ƒå‡½æ•°ä¸­è¿”å›ä»»ä½•ç»“æœï¼Œé‚£å¯ä»¥ä½¿ç”¨ thenAccept </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> CompletableFuture&lt;Void&gt; voidCompletableFuture = CompletableFuture.supplyAsync(</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè¿œç«¯APIè°ƒç”¨ï¼Œè¿™é‡Œåªè¿”å›äº†ä¸€ä¸ªæ„é€ çš„å¯¹è±¡</span></span><br><span class="line">() -&gt; Product.builder().id(<span class="number">12345L</span>).name(<span class="string">"é¢ˆæ¤/è…°æ¤æ²»ç–—ä»ª"</span>).build())</span><br><span class="line">.thenAccept(product -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"è·å–åˆ°è¿œç¨‹APIäº§å“åç§° "</span> + product.getName());</span><br><span class="line">&#125;);</span><br><span class="line">voidCompletableFuture.get();</span><br></pre></td></tr></table></figure><h4 id="thenRun"><a href="#thenRun" class="headerlink" title="thenRun"></a>thenRun</h4><p><code>thenAccept</code> å¯ä»¥ä»å›è°ƒå‡½æ•°ä¸­è·å–å‰åºæ‰§è¡Œçš„ç»“æœï¼Œä½†thenRun å´ä¸å¯ä»¥ï¼Œå› ä¸ºå®ƒçš„å›è°ƒå‡½æ•°å¼è¡¨è¾¾å¼å®šä¹‰ä¸­æ²¡æœ‰ä»»ä½•å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">    <span class="comment">//å‰åºæ“ä½œ</span></span><br><span class="line">&#125;).thenRun(() -&gt; &#123;</span><br><span class="line">    <span class="comment">//ä¸²è¡Œçš„åéœ€æ“ä½œï¼Œæ— å‚æ•°ä¹Ÿæ— è¿”å›å€¼</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‰é¢åŒæ ·è¯´è¿‡äº†ï¼Œæ¯ä¸ªæä¾›å›è°ƒæ–¹æ³•çš„å‡½æ•°éƒ½æœ‰ä¸¤ä¸ªå¼‚æ­¥ï¼ˆAsyncï¼‰å˜ä½“ï¼Œå¼‚æ­¥å°±æ˜¯å¦å¤–èµ·ä¸€ä¸ªçº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; stringCompletableFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"å‰åºæ“ä½œ"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"å‰éœ€æ“ä½œç»“æœ"</span>;</span><br><span class="line">&#125;).thenApplyAsync(result -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"åç»­æ“ä½œ"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"åç»­æ“ä½œç»“æœ"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719195510.png" alt=""></fancybox></p><p>åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ ä¸²è¡Œçš„æ“ä½œä½ å·²ç»éå¸¸ç†Ÿç»ƒäº†</p><h4 id="thenCompose"><a href="#thenCompose" class="headerlink" title="thenCompose"></a>thenCompose</h4><p>æ—¥å¸¸çš„ä»»åŠ¡ä¸­ï¼Œé€šå¸¸å®šä¹‰çš„æ–¹æ³•éƒ½ä¼šè¿”å› CompletableFuture ç±»å‹ï¼Œè¿™æ ·ä¼šç»™åç»­æ“ä½œç•™æœ‰æ›´å¤šçš„ä½™åœ°ï¼Œå‡å¦‚æœ‰è¿™æ ·çš„ä¸šåŠ¡ï¼ˆXå‘—æ˜¯ä¸æ˜¯éƒ½æœ‰è¿™æ ·çš„ä¸šåŠ¡å‘¢ï¼Ÿï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–ç”¨æˆ·ä¿¡æ¯è¯¦æƒ…</span></span><br><span class="line"><span class="function">CompletableFuture&lt;User&gt; <span class="title">getUsersDetail</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; User.builder().id(<span class="number">12345L</span>).name(<span class="string">"æ—¥æ‹±ä¸€å…µ"</span>).build());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–ç”¨æˆ·ä¿¡ç”¨è¯„çº§</span></span><br><span class="line"><span class="function">CompletableFuture&lt;Double&gt; <span class="title">getCreditRating</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; CreditRating.builder().rating(<span class="number">7.5</span>).build().getRating());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ thenApply() æ–¹æ³•æ¥æè¿°ä¸²è¡Œå…³ç³»ï¼Œè¿”å›çš„ç»“æœå°±ä¼šå‘ç”Ÿ CompletableFuture çš„åµŒå¥—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;CompletableFuture&lt;Double&gt;&gt; result = completableFutureCompose.getUsersDetail(<span class="number">12345L</span>)</span><br><span class="line">.thenApply(user -&gt; completableFutureCompose.getCreditRating(user));</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¦‚æœæƒ³â€œæ‹å¹³â€ è¿”å›ç»“æœï¼ŒthenCompose æ–¹æ³•å°±æ´¾ä¸Šç”¨åœºäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Double&gt; result = completableFutureCompose.getUsersDetail(<span class="number">12345L</span>)</span><br><span class="line">.thenCompose(user -&gt; completableFutureCompose.getCreditRating(user));</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå’Œ Lambda çš„map å’Œ flatMap çš„é“ç†æ˜¯ä¸€æ ·ä¸€æ ·æ»´</p><h4 id="thenCombine"><a href="#thenCombine" class="headerlink" title="thenCombine"></a>thenCombine</h4><p>å¦‚æœè¦èšåˆä¸¤ä¸ªç‹¬ç«‹ Future çš„ç»“æœï¼Œé‚£ä¹ˆ thenCombine å°±ä¼šæ´¾ä¸Šç”¨åœºäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Double&gt; weightFuture = CompletableFuture.supplyAsync(() -&gt; <span class="number">65.0</span>);</span><br><span class="line">CompletableFuture&lt;Double&gt; heightFuture = CompletableFuture.supplyAsync(() -&gt; <span class="number">183.8</span>);</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;Double&gt; combinedFuture = weightFuture</span><br><span class="line">.thenCombine(heightFuture, (weight, height) -&gt; &#123;</span><br><span class="line">Double heightInMeter = height/<span class="number">100</span>;</span><br><span class="line"><span class="keyword">return</span> weight/(heightInMeter*heightInMeter);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"èº«ä½“BMIæŒ‡æ ‡ - "</span> + combinedFuture.get());</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719201750.png" alt=""></fancybox></p><p>å½“ç„¶è¿™é‡Œå¤šæ•°æ—¶å¤„ç†ä¸¤ä¸ª Future çš„å…³ç³»ï¼Œå¦‚æœè¶…è¿‡ä¸¤ä¸ªFutureï¼Œå¦‚ä½•å¤„ç†ä»–ä»¬çš„ä¸€äº›èšåˆå…³ç³»å‘¢ï¼Ÿ</p><h4 id="allOf-ï½œ-anyOf"><a href="#allOf-ï½œ-anyOf" class="headerlink" title="allOf ï½œ anyOf"></a>allOf ï½œ anyOf</h4><p>ç›¸ä¿¡ä½ çœ‹åˆ°æ–¹æ³•çš„ç­¾åï¼Œä½ å·²ç»æ˜ç™½ä»–çš„ç”¨å¤„äº†ï¼Œè¿™é‡Œå°±ä¸å†ä»‹ç»äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title">allOf</span><span class="params">(CompletableFuture&lt;?&gt;... cfs)</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> CompletableFuture&lt;Object&gt; <span class="title">anyOf</span><span class="params">(CompletableFuture&lt;?&gt;... cfs)</span></span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å¼‚å¸¸çš„å¤„ç†äº†</p><h4 id="exceptionally"><a href="#exceptionally" class="headerlink" title="exceptionally"></a>exceptionally</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Integer age = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;String&gt; maturityFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line"><span class="keyword">if</span>( age &lt; <span class="number">0</span> ) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"ä½•æ–¹ç¥åœ£ï¼Ÿ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(age &gt; <span class="number">18</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"å¤§å®¶éƒ½æ˜¯æˆå¹´äºº"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"æœªæˆå¹´ç¦æ­¢å…¥å†…"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;).thenApply((str) -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"æ¸¸æˆå¼€å§‹"</span>);</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;).exceptionally(ex -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"å¿…æœ‰è¹Šè··ï¼Œæ¥è€…"</span> + ex.getMessage());</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Unknown!"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">log.info(maturityFuture.get());</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719204002.png" alt=""></fancybox></p><p>exceptionally å°±ç›¸å½“äº catchï¼Œå‡ºç°å¼‚å¸¸ï¼Œå°†ä¼šè·³è¿‡ thenApply çš„åç»­æ“ä½œï¼Œç›´æ¥æ•è·å¼‚å¸¸ï¼Œè¿›è¡Œä¸€åœºå¤„ç†</p><h4 id="handle"><a href="#handle" class="headerlink" title="handle"></a>handle</h4><p>ç”¨å¤šçº¿ç¨‹ï¼Œè‰¯å¥½çš„ä¹ æƒ¯æ˜¯ä½¿ç”¨ try/finally èŒƒå¼ï¼Œhandle å°±å¯ä»¥èµ·åˆ° finally çš„ä½œç”¨ï¼Œå¯¹ä¸Šè¿°ç¨‹åºåšä¸€ä¸ªå°å°çš„æ›´æ”¹ï¼Œ handle æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸è¿”å›å€¼ï¼Œä¸€ä¸ªæ˜¯å¼‚å¸¸</p><blockquote><p><strong>æ³¨æ„ï¼šhandleçš„å†™æ³•ä¹Ÿç®—æ˜¯èŒƒå¼çš„ä¸€ç§</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Integer age = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;String&gt; maturityFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line"><span class="keyword">if</span>( age &lt; <span class="number">0</span> ) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"ä½•æ–¹ç¥åœ£ï¼Ÿ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(age &gt; <span class="number">18</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"å¤§å®¶éƒ½æ˜¯æˆå¹´äºº"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"æœªæˆå¹´ç¦æ­¢å…¥å†…"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;).thenApply((str) -&gt; &#123;</span><br><span class="line">log.info(<span class="string">"æ¸¸æˆå¼€å§‹"</span>);</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;).handle((res, ex) -&gt; &#123;</span><br><span class="line"><span class="keyword">if</span>(ex != <span class="keyword">null</span>) &#123;</span><br><span class="line">log.info(<span class="string">"å¿…æœ‰è¹Šè··ï¼Œæ¥è€…"</span> + ex.getMessage());</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Unknown!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">log.info(maturityFuture.get());</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå…³äº <code>CompletableFuture</code> çš„åŸºæœ¬ä½¿ç”¨ä½ å·²ç»äº†è§£çš„å·®ä¸å¤šäº†ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦æ³¨æ„ï¼Œæˆ‘ä»¬å‰é¢è¯´çš„å¸¦æœ‰ Sync çš„æ–¹æ³•æ˜¯å•ç‹¬èµ·ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200719205144.png" alt=""></fancybox></p><p>ç»†å¿ƒçš„æœ‹å‹å¦‚æœä»”ç»†çœ‹æ¯ä¸ªå˜ç§å‡½æ•°çš„ç¬¬ä¸‰ä¸ªæ–¹æ³•ä¹Ÿè®¸ä¼šå‘ç°é‡Œé¢éƒ½æœ‰ä¸€ä¸ª Executor ç±»å‹çš„å‚æ•°ï¼Œç”¨äºæŒ‡å®šçº¿ç¨‹æ± ï¼Œå› ä¸ºå®é™…ä¸šåŠ¡ä¸­æˆ‘ä»¬æ˜¯ä¸¥è°¨æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹çš„ï¼Œè¿™åœ¨ <a href="https://dayarch.top/p/why-we-need-to-use-threadpool.html">æˆ‘ä¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</a>æ–‡ç« ä¸­æ˜ç¡®è¯´æ˜è¿‡ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šçº¿ç¨‹æ± ï¼Œé‚£è‡ªç„¶å°±ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯ ForkJoinPool</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor ASYNC_POOL = USE_COMMON_POOL ?</span><br><span class="line">    ForkJoinPool.commonPool() : <span class="keyword">new</span> ThreadPerTaskExecutor();</span><br></pre></td></tr></table></figure><p>ForkJoinPool çš„çº¿ç¨‹æ•°é»˜è®¤æ˜¯ CPU çš„æ ¸å¿ƒæ•°ã€‚ä½†æ˜¯ï¼Œåœ¨å‰åºæ–‡ç« ä¸­æ˜ç¡®è¯´æ˜è¿‡ï¼š</p><blockquote><p><strong>ä¸è¦æ‰€æœ‰ä¸šåŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± </strong>ï¼Œå› ä¸ºï¼Œä¸€æ—¦æœ‰ä»»åŠ¡æ‰§è¡Œä¸€äº›å¾ˆæ…¢çš„ I/O æ“ä½œï¼Œå°±ä¼šå¯¼è‡´çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹éƒ½é˜»å¡åœ¨ I/O æ“ä½œä¸Šï¼Œä»è€Œé€ æˆçº¿ç¨‹é¥¥é¥¿ï¼Œè¿›è€Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>CompletableFuture</code> çš„æ–¹æ³•å¹¶æ²¡æœ‰å…¨éƒ¨ä»‹ç»å®Œå…¨ï¼Œä¹Ÿæ²¡å¿…è¦å…¨éƒ¨ä»‹ç»ï¼Œç›¸ä¿¡å¤§å®¶æŒ‰ç…§è¿™ä¸ªæ€è·¯æ¥ç†è§£ <code>CompletableFuture</code> ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆå¤§é—®é¢˜äº†ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™<code>å®è·µ/æ—¶é—´</code>ä»¥åŠè‡ªå·±çš„ä½“ä¼šäº†</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ä½ ä»¥ä¸º JDK1.8 <em>CompletableFuture</em> å·²ç»å¾ˆå®Œç¾äº†æ˜¯ä¸æ˜¯ï¼Œä½†è¿½å»å®Œç¾çš„é“è·¯ä¸Šæ°¸æ— æ­¢å¢ƒï¼ŒJava 9 å¯¹<em>CompletableFuture</em> åˆåšäº†éƒ¨åˆ†å‡çº§å’Œæ”¹é€ </p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><ol><li><p>æ·»åŠ äº†æ–°çš„å·¥å‚æ–¹æ³•</p></li><li><p>æ”¯æŒå»¶è¿Ÿå’Œè¶…æ—¶å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">orTimeout()</span><br><span class="line">completeOnTimeout()</span><br></pre></td></tr></table></figure></li><li><p>æ”¹è¿›äº†å¯¹å­ç±»çš„æ”¯æŒ</p></li></ol><p>è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ï¼š <a href="https://www.baeldung.com/java-9-completablefuture" target="_blank" rel="noopener">Java 9 CompletableFuture API Improvements</a>. æ€æ ·å¿«é€Ÿçš„åˆ‡æ¢ä¸åŒ Java ç‰ˆæœ¬æ¥å°é²œï¼Ÿ<a href="https://dayarch.top/p/multiple-java-management.html">SDKMAN ç»Ÿä¸€çµæ´»ç®¡ç†å¤šç‰ˆæœ¬Java</a> è¿™ç¯‡æ–‡ç« çš„æ–¹æ³•é€ç»™ä½ </p><p>æœ€åå’±ä»¬å†æ³¡ä¸€å£¶èŒ¶ï¼Œæ„Ÿå—ä¸€ä¸‹æ–°å˜åŒ–å§</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>å¬è¯´ ForkJoinPool çº¿ç¨‹æ± æ•ˆç‡æ›´é«˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</li><li>å¦‚æœæ‰¹é‡å¤„ç†å¼‚æ­¥ç¨‹åºï¼Œæœ‰ä»€ä¹ˆå¯ç”¨çš„æ–¹æ¡ˆå—ï¼Ÿ</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾</li><li><a href="https://www.baeldung.com/java-completablefuture" target="_blank" rel="noopener">https://www.baeldung.com/java-completablefuture</a></li><li><a href="https://www.callicoder.com/java-8-completablefuture-tutorial/" target="_blank" rel="noopener">https://www.callicoder.com/java-8-completablefuture-tutorial/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Futureè¯¦è§£ä¸ä½¿ç”¨</title>
      <link href="//p/java-future-and-callable.html"/>
      <url>//p/java-future-and-callable.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://rgyb.sunluomeng.top/20200705203141.png" alt=""></fancybox></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ›å»ºçº¿ç¨‹æœ‰å‡ ç§æ–¹å¼ï¼Ÿè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆåº”è¯¥æ˜¯å¯ä»¥è„±å£è€Œå‡ºçš„å§</p><ul><li>ç»§æ‰¿ Thread ç±»</li><li>å®ç° Runnable æ¥å£</li></ul><p>ä½†è¿™ä¸¤ç§æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ˜¯å±äºâ€ä¸‰æ— äº§å“â€œï¼š</p><ul><li>æ²¡æœ‰å‚æ•°</li><li>æ²¡æœ‰è¿”å›å€¼</li><li>æ²¡åŠæ³•æŠ›å‡ºå¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      log.info(<span class="string">"my thread"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Runnable æ¥å£æ˜¯ JDK1.0 çš„æ ¸å¿ƒäº§ç‰©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   JDK1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ç€ â€œä¸‰æ— äº§å“â€ æ€»æ˜¯æœ‰ä¸€äº›å¼Šç«¯ï¼Œå…¶ä¸­æ²¡åŠæ³•æ‹¿åˆ°è¿”å›å€¼æ˜¯æœ€è®©äººä¸èƒ½å¿çš„ï¼Œäºæ˜¯ Callable å°±è¯ç”Ÿäº†</p><h2 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h2><p>åˆæ˜¯ Doug Lea å¤§å¸ˆï¼Œåˆæ˜¯ Java 1.5 è¿™ä¸ªç¥å¥‡çš„ç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Executor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;V&gt; the result type of method &#123;<span class="doctag">@code</span> call&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Callable æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª <code>call()</code> æ–¹æ³•ï¼Œ<strong>è¯¥æ–¹æ³•å¯ä»¥è¿”å›æ³›å‹å€¼ V</strong> ï¼Œä½¿ç”¨èµ·æ¥å°±åƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Callable&lt;String&gt; callable = () -&gt; &#123;</span><br><span class="line">    <span class="comment">// Perform some computation</span></span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Return some result"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200704183047.png" alt=""></fancybox></p><p>äºŒè€…éƒ½æ˜¯å‡½æ•°å¼æ¥å£ï¼Œé‡Œé¢éƒ½ä»…æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨ä¸Šåˆæ˜¯å¦‚æ­¤ç›¸ä¼¼ï¼Œé™¤äº†æœ‰æ— è¿”å›å€¼ï¼ŒRunnable ä¸ Callable å°±ç‚¹å·®åˆ«å—ï¼Ÿ</p><h2 id="Runnable-VS-Callable"><a href="#Runnable-VS-Callable" class="headerlink" title="Runnable VS Callable"></a>Runnable VS Callable</h2><p>ä¸¤ä¸ªæ¥å£éƒ½æ˜¯ç”¨äºå¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„ï¼Œä½†ä»–ä»¬è¿˜æ˜¯æœ‰å¾ˆæ˜æ˜¾çš„å·®åˆ«çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705120918.png" alt=""></fancybox></p><h3 id="æ‰§è¡Œæœºåˆ¶"><a href="#æ‰§è¡Œæœºåˆ¶" class="headerlink" title="æ‰§è¡Œæœºåˆ¶"></a>æ‰§è¡Œæœºåˆ¶</h3><p>å…ˆä»æ‰§è¡Œæœºåˆ¶ä¸Šæ¥çœ‹ï¼ŒRunnable ä½ å¤ªæ¸…æ¥šäº†ï¼Œå®ƒæ—¢å¯ä»¥ç”¨åœ¨ Thread ç±»ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨ <em>ExecutorService</em> ç±»ä¸­é…åˆçº¿ç¨‹æ± çš„ä½¿ç”¨ï¼›<strong>Buï½ï½ï½ï½tï¼Œ  Callable åªèƒ½åœ¨ <em>ExecutorService</em> ä¸­ä½¿ç”¨</strong>ï¼Œä½ ç¿»é Thread ç±»ï¼Œä¹Ÿæ‰¾ä¸åˆ°Callable çš„èº«å½±</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200704184053.png" alt=""></fancybox></p><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>Runnable æ¥å£ä¸­çš„ run æ–¹æ³•ç­¾åä¸Šæ²¡æœ‰ <strong>throws</strong> ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡åŠæ³•å‘ä¸Šä¼ æ’­å—æ£€å¼‚å¸¸ï¼›è€Œ Callable çš„ call() æ–¹æ³•ç­¾åå´æœ‰ <strong>throws</strong>ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¤„ç†å—æ£€å¼‚å¸¸ï¼›</p><p>æ‰€ä»¥å½’çº³èµ·æ¥çœ‹ä¸»è¦æœ‰è¿™å‡ å¤„ä¸åŒç‚¹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705122813.png" alt=""></fancybox></p><p>æ•´ä½“å·®åˆ«è™½ç„¶ä¸å¤§ï¼Œä½†æ˜¯è¿™ç‚¹å·®åˆ«ï¼Œå´å…·æœ‰é‡å¤§æ„ä¹‰</p><p>è¿”å›å€¼å’Œå¤„ç†å¼‚å¸¸å¾ˆå¥½ç†è§£ï¼Œå¦å¤–ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¦ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼ˆ<em>åŸå› å·²ç»åœ¨ <a href="https://dayarch.top/p/why-we-need-to-use-threadpool.html">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</a> ä¸­æ˜ç¡®è¯´æ˜</em>ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ ExecutorService ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨äºŒè€…çš„</p><h2 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a>ExecutorService</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹ ExecutorService ç±»å›¾</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200704185918.png" alt=""></fancybox></p><p>æˆ‘å°†ä¸Šå›¾æ ‡è®°çš„æ–¹æ³•å•ç‹¬æ”¾åœ¨æ­¤å¤„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span></span>;</span><br><span class="line"></span><br><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span>;</span><br><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Runnable task, T result)</span></span>;</span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ExecutorService çš„ <code>execute()</code> æ–¹æ³•ä¾æ—§å¾—ä¸åˆ°è¿”å›å€¼ï¼Œè€Œ <code>submit()</code> æ–¹æ³•æ¸…ä¸€è‰²çš„è¿”å› <code>Future</code> ç±»å‹çš„è¿”å›å€¼</p><p>ç»†å¿ƒçš„æœ‹å‹å¯èƒ½å·²ç»å‘ç°ï¼Œ submit() æ–¹æ³•å·²ç»åœ¨ <a href="https://dayarch.top/p/java-countdownlatch-vs-cyclicbarrier.html">CountDownLatch å’Œ CyclicBarrier å‚»å‚»çš„åˆ†ä¸æ¸…æ¥šï¼Ÿ</a> æ–‡ç« ä¸­å¤šæ¬¡ä½¿ç”¨äº†ï¼Œåªä¸è¿‡æˆ‘ä»¬æ²¡æœ‰è·å–å…¶è¿”å›å€¼ç½¢äº†ï¼Œé‚£ä¹ˆ</p><ul><li>Future åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li><li>æ€ä¹ˆé€šè¿‡å®ƒè·å–è¿”å›å€¼å‘¢ï¼Ÿ</li></ul><p>æˆ‘ä»¬å¸¦ç€è¿™äº›ç–‘é—®ä¸€ç‚¹ç‚¹æ¥çœ‹</p><h2 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h2><p>Future åˆæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢åªæœ‰äº”ä¸ªæ–¹æ³•ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200704193123.png" alt=""></fancybox></p><p>ä»æ–¹æ³•åç§°ä¸Šç›¸ä¿¡ä½ å·²ç»èƒ½çœ‹å‡ºè¿™äº›æ–¹æ³•çš„ä½œç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å–æ¶ˆä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå¸¦æœ‰è¶…æ—¶æ—¶é—´é™åˆ¶</span></span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException,  TimeoutException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å–æ¶ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>é“ºå«äº†è¿™ä¹ˆå¤šï¼Œçœ‹åˆ°è¿™ä½ ä¹Ÿè®¸æœ‰äº›ä¹±äº†ï¼Œå’±ä»¬èµ¶ç´§çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæ¼”ç¤ºä¸€ä¸‹å‡ ä¸ªæ–¹æ³•çš„ä½œç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureAndCallableExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">      ExecutorService executorService = Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä½¿ç”¨ Callable ï¼Œå¯ä»¥è·å–è¿”å›å€¼</span></span><br><span class="line">      Callable&lt;String&gt; callable = () -&gt; &#123;</span><br><span class="line">         log.info(<span class="string">"è¿›å…¥ Callable çš„ call æ–¹æ³•"</span>);</span><br><span class="line">         <span class="comment">// æ¨¡æ‹Ÿå­çº¿ç¨‹ä»»åŠ¡ï¼Œåœ¨æ­¤ç¡çœ  2sï¼Œ</span></span><br><span class="line">         <span class="comment">// å°ç»†èŠ‚ï¼šç”±äº call æ–¹æ³•ä¼šæŠ›å‡º Exceptionï¼Œè¿™é‡Œä¸ç”¨åƒä½¿ç”¨ Runnable çš„run æ–¹æ³•é‚£æ · try/catch äº†</span></span><br><span class="line">         Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"Hello from Callable"</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      log.info(<span class="string">"æäº¤ Callable åˆ°çº¿ç¨‹æ± "</span>);</span><br><span class="line">      Future&lt;String&gt; future = executorService.submit(callable);</span><br><span class="line"></span><br><span class="line">      log.info(<span class="string">"ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ"</span>);</span><br><span class="line"></span><br><span class="line">      log.info(<span class="string">"ä¸»çº¿ç¨‹ç­‰å¾…è·å– Future ç»“æœ"</span>);</span><br><span class="line">      <span class="comment">// Future.get() blocks until the result is available</span></span><br><span class="line">      String result = future.get();</span><br><span class="line">      log.info(<span class="string">"ä¸»çº¿ç¨‹è·å–åˆ° Future ç»“æœ: &#123;&#125;"</span>, result);</span><br><span class="line"></span><br><span class="line">      executorService.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200704201049.png" alt=""></fancybox></p><p>å¦‚æœä½ è¿è¡Œä¸Šè¿°ç¤ºä¾‹ä»£ç ï¼Œä¸»çº¿ç¨‹è°ƒç”¨ future.get() æ–¹æ³•ä¼šé˜»å¡è‡ªå·±ï¼Œç›´åˆ°å­ä»»åŠ¡å®Œæˆã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Future æ–¹æ³•æä¾›çš„ <code>isDone</code> æ–¹æ³•ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ£€æŸ¥ task æ˜¯å¦å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬å°†ä¸Šé¢ç¨‹åºåšç‚¹å°ä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœå­çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œåˆ™ç¡çœ  1s é‡æ–°æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">while</span>(!future.isDone()) &#123;</span><br><span class="line">   System.out.println(<span class="string">"Task is still not done..."</span>);</span><br><span class="line">   Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200704201749.png" alt=""></fancybox></p><p>å¦‚æœå­ç¨‹åºè¿è¡Œæ—¶é—´è¿‡é•¿ï¼Œæˆ–è€…å…¶ä»–åŸå› ï¼Œæˆ‘ä»¬æƒ³ cancel å­ç¨‹åºçš„è¿è¡Œï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Future æä¾›çš„ cancel æ–¹æ³•ï¼Œç»§ç»­å¯¹ç¨‹åºåšä¸€äº›ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!future.isDone()) &#123;</span><br><span class="line">   System.out.println(<span class="string">"å­çº¿ç¨‹ä»»åŠ¡è¿˜æ²¡æœ‰ç»“æŸ..."</span>);</span><br><span class="line">   Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">double</span> elapsedTimeInSec = (System.nanoTime() - startTime)/<span class="number">1000000000.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœç¨‹åºè¿è¡Œæ—¶é—´å¤§äº 1sï¼Œåˆ™å–æ¶ˆå­çº¿ç¨‹çš„è¿è¡Œ</span></span><br><span class="line">   <span class="keyword">if</span>(elapsedTimeInSec &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      future.cancel(<span class="keyword">true</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705095610.png" alt=""></fancybox></p><p>ä¸ºä»€ä¹ˆè°ƒç”¨ cancel æ–¹æ³•ç¨‹åºä¼šå‡ºç° CancellationException å‘¢ï¼Ÿ æ˜¯å› ä¸ºè°ƒç”¨ get() æ–¹æ³•æ—¶ï¼Œæ˜ç¡®è¯´æ˜äº†ï¼š</p><blockquote><p>è°ƒç”¨ get() æ–¹æ³•æ—¶ï¼Œå¦‚æœè®¡ç®—ç»“æœè¢«å–æ¶ˆäº†ï¼Œåˆ™æŠ›å‡º CancellationException ï¼ˆå…·ä½“åŸå› ï¼Œä½ ä¼šåœ¨ä¸‹é¢çš„æºç åˆ†æä¸­çœ‹åˆ°ï¼‰</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705095256.png" alt=""></fancybox></p><p>æœ‰å¼‚å¸¸ä¸å¤„ç†æ˜¯éå¸¸ä¸ä¸“ä¸šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥ä¿®æ”¹ç¨‹åºï¼Œä»¥æ›´å‹å¥½çš„æ–¹å¼å¤„ç†å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ isCancelled æ–¹æ³•åˆ¤æ–­ç¨‹åºæ˜¯å¦è¢«å–æ¶ˆï¼Œå¦‚æœè¢«å–æ¶ˆï¼Œåˆ™æ‰“å°æ—¥å¿—ï¼Œå¦‚æœæ²¡è¢«å–æ¶ˆï¼Œåˆ™æ­£å¸¸è°ƒç”¨ get() æ–¹æ³•</span></span><br><span class="line"><span class="keyword">if</span> (!future.isCancelled())&#123;</span><br><span class="line">   log.info(<span class="string">"å­çº¿ç¨‹ä»»åŠ¡å·²å®Œæˆ"</span>);</span><br><span class="line">   String result = future.get();</span><br><span class="line">   log.info(<span class="string">"ä¸»çº¿ç¨‹è·å–åˆ° Future ç»“æœ: &#123;&#125;"</span>, result);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   log.warn(<span class="string">"å­çº¿ç¨‹ä»»åŠ¡è¢«å–æ¶ˆ"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç¨‹åºè¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705095841.png" alt=""></fancybox></p><p>ç›¸ä¿¡åˆ°è¿™é‡Œä½ å·²ç»å¯¹ <code>Future</code> çš„å‡ ä¸ªæ–¹æ³•æœ‰äº†åŸºæœ¬çš„ä½¿ç”¨å°è±¡ï¼Œä½† <code>Future</code> æ˜¯æ¥å£ï¼Œå…¶å®ä½¿ç”¨ <code>ExecutorService.submit()</code> æ–¹æ³•è¿”å›çš„ä¸€ç›´éƒ½æ˜¯ <code>Future</code> çš„å®ç°ç±» <code>FutureTask</code></p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705100311.png" alt=""></fancybox></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›å…¥è¿™ä¸ªæ ¸å¿ƒå®ç°ç±»ä¸€æ¢ç©¶ç«Ÿ</p><h2 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h2><p>åŒæ ·å…ˆæ¥çœ‹ç±»ç»“æ„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705100500.png" alt=""></fancybox></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Runnable</span>, <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç¥å¥‡çš„ä¸€ä¸ªæ¥å£ï¼Œ<code>FutureTask</code> å®ç°äº† <code>RunnableFuture</code> æ¥å£ï¼Œè€Œ  <code>RunnableFuture</code>  æ¥å£åˆåˆ†åˆ«å®ç°äº† <code>Runnable</code> å’Œ <code>Future</code> æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥æ¨æ–­å‡º <code>FutureTask</code> å…·æœ‰è¿™ä¸¤ç§æ¥å£çš„ç‰¹æ€§ï¼š</p><ul><li>æœ‰ <code>Runnable</code> ç‰¹æ€§ï¼Œæ‰€ä»¥å¯ä»¥ç”¨åœ¨ <code>ExecutorService</code> ä¸­é…åˆçº¿ç¨‹æ± ä½¿ç”¨</li><li>æœ‰ <code>Future</code> ç‰¹æ€§ï¼Œæ‰€ä»¥å¯ä»¥ä»ä¸­è·å–åˆ°æ‰§è¡Œç»“æœ</li></ul><h3 id="FutureTaskæºç åˆ†æ"><a href="#FutureTaskæºç åˆ†æ" class="headerlink" title="FutureTaskæºç åˆ†æ"></a>FutureTaskæºç åˆ†æ</h3><p>å¦‚æœä½ å®Œæ•´çš„çœ‹è¿‡ AQS ç›¸å…³åˆ†æçš„æ–‡ç« ï¼Œä½ ä¹Ÿè®¸ä¼šå‘ç°ï¼Œé˜…è¯» Java å¹¶å‘å·¥å…·ç±»æºç ï¼Œæˆ‘ä»¬æ— éå°±æ˜¯è¦å…³æ³¨ä»¥ä¸‹è¿™ä¸‰ç‚¹ï¼š</p><pre><code>- çŠ¶æ€ ï¼ˆä»£ç é€»è¾‘çš„ä¸»è¦æ§åˆ¶ï¼‰- é˜Ÿåˆ— ï¼ˆç­‰å¾…æ’é˜Ÿé˜Ÿåˆ—ï¼‰- CAS ï¼ˆå®‰å…¨çš„set å€¼ï¼‰</code></pre><blockquote><p>è„‘æµ·ä¸­ç‰¢è®°è¿™ä¸‰ç‚¹ï¼Œå’±ä»¬å¼€å§‹çœ‹ FutureTask æºç ï¼Œçœ‹ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å›´ç»•è¿™ä¸‰ç‚¹å®ç°ç›¸åº”çš„é€»è¾‘çš„</p></blockquote><p>æ–‡ç« å¼€å¤´å·²ç»æåˆ°ï¼Œå®ç° Runnable æ¥å£å½¢å¼åˆ›å»ºçš„çº¿ç¨‹å¹¶ä¸èƒ½è·å–åˆ°è¿”å›å€¼ï¼Œè€Œå®ç° Callable çš„æ‰å¯ä»¥ï¼Œæ‰€ä»¥ FutureTask æƒ³è¦è·å–è¿”å›å€¼ï¼Œå¿…å®šæ˜¯å’Œ Callable æœ‰è”ç³»çš„ï¼Œè¿™ä¸ªæ¨æ–­ä¸€ç‚¹éƒ½æ²¡é”™ï¼Œä»æ„é€ æ–¹æ³•ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FutureTask</span><span class="params">(Callable&lt;V&gt; callable)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (callable == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.callable = callable;</span><br><span class="line">    <span class="keyword">this</span>.state = NEW;       <span class="comment">// ensure visibility of callable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³ä¾¿åœ¨ FutureTask æ„é€ æ–¹æ³•ä¸­ä¼ å…¥çš„æ˜¯ Runnable å½¢å¼çš„çº¿ç¨‹ï¼Œè¯¥æ„é€ æ–¹æ³•ä¹Ÿä¼šé€šè¿‡ <code>Executors.callable</code> å·¥å‚æ–¹æ³•å°†å…¶è½¬æ¢ä¸º Callable ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FutureTask</span><span class="params">(Runnable runnable, V result)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.callable = Executors.callable(runnable, result);</span><br><span class="line">    <span class="keyword">this</span>.state = NEW;       <span class="comment">// ensure visibility of callable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705102453.png" alt=""></fancybox></p><p>ä½†æ˜¯ FutureTask å®ç°çš„æ˜¯ Runnable æ¥å£ï¼Œä¹Ÿå°±æ˜¯åªèƒ½é‡å†™ run() æ–¹æ³•ï¼Œrun() æ–¹æ³•åˆæ²¡æœ‰è¿”å›å€¼ï¼Œé‚£é—®é¢˜æ¥äº†ï¼š</p><blockquote><ul><li>FutureTask æ˜¯æ€æ ·åœ¨ run() æ–¹æ³•ä¸­è·å–è¿”å›å€¼çš„ï¼Ÿ</li><li>å®ƒå°†è¿”å›å€¼æ”¾åˆ°å“ªé‡Œäº†ï¼Ÿ</li><li>get() æ–¹æ³•åˆæ˜¯æ€æ ·æ‹¿åˆ°è¿™ä¸ªè¿”å›å€¼çš„å‘¢ï¼Ÿ</li></ul></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ run() æ–¹æ³•ï¼ˆå…³é”®ä»£ç éƒ½å·²æ ‡è®°æ³¨é‡Šï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœçŠ¶æ€ä¸æ˜¯ NEWï¼Œè¯´æ˜ä»»åŠ¡å·²ç»æ‰§è¡Œè¿‡æˆ–è€…å·²ç»è¢«å–æ¶ˆï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="comment">// å¦‚æœçŠ¶æ€æ˜¯ NEWï¼Œåˆ™å°è¯•æŠŠæ‰§è¡Œçº¿ç¨‹ä¿å­˜åœ¨ runnerOffsetï¼ˆrunnerå­—æ®µï¼‰ï¼Œå¦‚æœèµ‹å€¼å¤±è´¥ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (state != NEW ||</span><br><span class="line">        !UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, runnerOffset,</span><br><span class="line">                                     <span class="keyword">null</span>, Thread.currentThread()))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è·å–æ„é€ å‡½æ•°ä¼ å…¥çš„ Callable å€¼</span></span><br><span class="line">        Callable&lt;V&gt; c = callable;</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; state == NEW) &#123;</span><br><span class="line">            V result;</span><br><span class="line">            <span class="keyword">boolean</span> ran;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// æ­£å¸¸è°ƒç”¨ Callable çš„ call æ–¹æ³•å°±å¯ä»¥è·å–åˆ°è¿”å›å€¼</span></span><br><span class="line">                result = c.call();</span><br><span class="line">                ran = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                result = <span class="keyword">null</span>;</span><br><span class="line">                ran = <span class="keyword">false</span>;</span><br><span class="line">              <span class="comment">// ä¿å­˜ call æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸</span></span><br><span class="line">                setException(ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ran)</span><br><span class="line">              <span class="comment">// ä¿å­˜ call æ–¹æ³•çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">                set(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;        </span><br><span class="line">        runner = <span class="keyword">null</span>;       </span><br><span class="line">        <span class="keyword">int</span> s = state;</span><br><span class="line">      <span class="comment">// å¦‚æœä»»åŠ¡è¢«ä¸­æ–­ï¼Œåˆ™æ‰§è¡Œä¸­æ–­å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (s &gt;= INTERRUPTING)</span><br><span class="line">            handlePossibleCancellationInterrupt(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>run()</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œè‡³äº <code>run()</code> æ–¹æ³•æ˜¯å¦‚ä½•å°† <code>call()</code> æ–¹æ³•çš„è¿”å›ç»“æœå’Œå¼‚å¸¸éƒ½ä¿å­˜èµ·æ¥çš„å‘¢ï¼Ÿå…¶å®éå¸¸ç®€å•, å°±æ˜¯é€šè¿‡ set(result) ä¿å­˜æ­£å¸¸ç¨‹åºè¿è¡Œç»“æœï¼Œæˆ–é€šè¿‡ setException(ex) ä¿å­˜ç¨‹åºå¼‚å¸¸ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The result to return or exception to throw from get() */</span></span><br><span class="line"><span class="keyword">private</span> Object outcome; <span class="comment">// non-volatile, protected by state reads/writes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜å¼‚å¸¸ç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setException</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW, COMPLETING)) &#123;</span><br><span class="line">        outcome = t;</span><br><span class="line">        UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, EXCEPTIONAL); <span class="comment">// final state</span></span><br><span class="line">        finishCompletion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜æ­£å¸¸ç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW, COMPLETING)) &#123;</span><br><span class="line">    outcome = v;</span><br><span class="line">    UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, NORMAL); <span class="comment">// final state</span></span><br><span class="line">    finishCompletion();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>setException</code> å’Œ <code>set</code> æ–¹æ³•éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯å°†å¼‚å¸¸æˆ–è€…ç»“æœä¿å­˜åœ¨ <code>Object</code> ç±»å‹çš„ <code>outcome</code> å˜é‡ä¸­ï¼Œ<code>outcome</code> æ˜¯æˆå‘˜å˜é‡ï¼Œå°±è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥ä»–ä»¬è¦é€šè¿‡ CASæ–¹å¼è®¾ç½® outcome å˜é‡çš„å€¼ï¼Œæ—¢ç„¶æ˜¯åœ¨ CAS æˆåŠŸå æ›´æ”¹ outcome çš„å€¼ï¼Œè¿™ä¹Ÿå°±æ˜¯ outcome æ²¡æœ‰è¢« <code>volatile</code> ä¿®é¥°çš„åŸå› æ‰€åœ¨ã€‚</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705172536.png" alt=""></fancybox></p><p>ä¿å­˜æ­£å¸¸ç»“æœå€¼ï¼ˆsetæ–¹æ³•ï¼‰ä¸ä¿å­˜å¼‚å¸¸ç»“æœå€¼ï¼ˆsetExceptionæ–¹æ³•ï¼‰ä¸¤ä¸ªæ–¹æ³•ä»£ç é€»è¾‘ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯ CAS ä¼ å…¥çš„ state ä¸åŒã€‚æˆ‘ä»¬ä¸Šé¢æåˆ°ï¼Œstate å¤šæ•°ç”¨äºæ§åˆ¶ä»£ç é€»è¾‘ï¼ŒFutureTask ä¹Ÿæ˜¯è¿™æ ·ï¼Œæ‰€ä»¥è¦ææ¸…ä»£ç é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹ state çš„çŠ¶æ€å˜åŒ–æœ‰æ‰€äº†è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Possible state transitions:</span></span><br><span class="line"><span class="comment"> * NEW -&gt; COMPLETING -&gt; NORMAL  //æ‰§è¡Œè¿‡ç¨‹é¡ºåˆ©å®Œæˆ</span></span><br><span class="line"><span class="comment"> * NEW -&gt; COMPLETING -&gt; EXCEPTIONAL //æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> * NEW -&gt; CANCELLED // æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«å–æ¶ˆ</span></span><br><span class="line"><span class="comment"> * NEW -&gt; INTERRUPTING -&gt; INTERRUPTED //æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹è¢«ä¸­æ–­</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NEW          = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMPLETING   = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NORMAL       = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXCEPTIONAL  = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED    = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERRUPTING = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERRUPTED  = <span class="number">6</span>;</span><br></pre></td></tr></table></figure><p>7ç§çŠ¶æ€ï¼Œåƒä¸‡åˆ«æ…Œï¼Œæ•´ä¸ªçŠ¶æ€æµè½¬å…¶å®åªæœ‰å››ç§çº¿è·¯</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705105031.png" alt=""></fancybox></p><p>FutureTask å¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥ï¼Œstate çš„çŠ¶æ€å°±æ˜¯ NEW çŠ¶æ€ï¼Œä»ä¸Šé¢çš„æ„é€ å‡½æ•°ä¸­ä½ åº”è¯¥å·²ç»å‘ç°äº†ï¼Œå››ä¸ªæœ€ç»ˆçŠ¶æ€ NORMAL ï¼ŒEXCEPTIONAL ï¼Œ CANCELLED ï¼Œ INTERRUPTED ä¹Ÿéƒ½å¾ˆå¥½ç†è§£ï¼Œä¸¤ä¸ªä¸­é—´çŠ¶æ€ç¨ç¨æœ‰ç‚¹è®©äººå›°æƒ‘:</p><ul><li>COMPLETING: outcome æ­£åœ¨è¢«set å€¼çš„æ—¶å€™</li><li>INTERRUPTINGï¼šé€šè¿‡ cancel(true) æ–¹æ³•æ­£åœ¨ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™ </li></ul><p>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªä¸­é—´çŠ¶æ€éƒ½è¡¨ç¤ºä¸€ç§ç¬æ—¶çŠ¶æ€ï¼Œæˆ‘ä»¬å°†å‡ ç§çŠ¶æ€å›¾å½¢åŒ–å±•ç¤ºä¸€ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705181018.png" alt=""></fancybox></p><p>æˆ‘ä»¬çŸ¥é“äº† run() æ–¹æ³•æ˜¯å¦‚ä½•ä¿å­˜ç»“æœçš„ï¼Œä»¥åŠçŸ¥é“äº†å°†æ­£å¸¸ç»“æœ/å¼‚å¸¸ç»“æœä¿å­˜åˆ°äº† outcome å˜é‡é‡Œï¼Œé‚£å°±éœ€è¦çœ‹ä¸€ä¸‹ FutureTask æ˜¯å¦‚ä½•é€šè¿‡ get() æ–¹æ³•è·å–ç»“æœçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = state;</span><br><span class="line">  <span class="comment">// å¦‚æœ state è¿˜æ²¡åˆ° set outcome ç»“æœçš„æ—¶å€™ï¼Œåˆ™è°ƒç”¨ awaitDone() æ–¹æ³•é˜»å¡è‡ªå·±</span></span><br><span class="line">    <span class="keyword">if</span> (s &lt;= COMPLETING)</span><br><span class="line">        s = awaitDone(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">  <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> report(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>awaitDone æ–¹æ³•æ˜¯ FutureTask æœ€æ ¸å¿ƒçš„ä¸€ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get æ–¹æ³•æ”¯æŒè¶…æ—¶é™åˆ¶ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥è¶…æ—¶æ—¶é—´ï¼Œåˆ™æ¥å—çš„å‚æ•°æ˜¯ false å’Œ 0L</span></span><br><span class="line"><span class="comment">// æœ‰ç­‰å¾…å°±ä¼šæœ‰é˜Ÿåˆ—æ’é˜Ÿæˆ–è€…å¯å“åº”ä¸­æ–­ï¼Œä»æ–¹æ³•ç­¾åä¸Šçœ‹æœ‰ InterruptedExceptionï¼Œè¯´æ˜è¯¥æ–¹æ³•è¿™æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">awaitDone</span><span class="params">(<span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">  <span class="comment">// è®¡ç®—ç­‰å¾…æˆªæ­¢æ—¶é—´</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> deadline = timed ? System.nanoTime() + nanos : <span class="number">0L</span>;</span><br><span class="line">    WaitNode q = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> queued = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™åœ¨ç­‰å¾…å¯¹ç«‹ä¸­åˆ é™¤è¯¥èŠ‚ç‚¹ï¼Œå¹¶æŠ›å‡º InterruptedException</span></span><br><span class="line">        <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">            removeWaiter(q);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> s = state;</span><br><span class="line">      <span class="comment">// çŠ¶æ€å¤§äº COMPLETING è¯´æ˜å·²ç»è¾¾åˆ°æŸä¸ªæœ€ç»ˆçŠ¶æ€ï¼ˆæ­£å¸¸ç»“æŸ/å¼‚å¸¸ç»“æŸ/å–æ¶ˆï¼‰</span></span><br><span class="line">      <span class="comment">// æŠŠ thread åªä¸ºç©ºï¼Œå¹¶è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (s &gt; COMPLETING) &#123;</span><br><span class="line">            <span class="keyword">if</span> (q != <span class="keyword">null</span>)</span><br><span class="line">                q.thread = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯COMPLETING çŠ¶æ€ï¼ˆä¸­é—´çŠ¶æ€ï¼‰ï¼Œè¡¨ç¤ºä»»åŠ¡å·²ç»“æŸï¼Œä½† outcome èµ‹å€¼è¿˜æ²¡ç»“æŸï¼Œè¿™æ—¶ä¸»åŠ¨è®©å‡ºæ‰§è¡Œæƒï¼Œè®©å…¶ä»–çº¿ç¨‹ä¼˜å…ˆæ‰§è¡Œï¼ˆåªæ˜¯å‘å‡ºè¿™ä¸ªä¿¡å·ï¼Œè‡³äºæ˜¯å¦åˆ«çš„çº¿ç¨‹æ‰§è¡Œä¸€å®šä¼šæ‰§è¡Œå¯æ˜¯ä¸ä¸€å®šçš„ï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == COMPLETING) <span class="comment">// cannot time out yet</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">      <span class="comment">// ç­‰å¾…èŠ‚ç‚¹ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (q == <span class="keyword">null</span>)</span><br><span class="line">          <span class="comment">// å°†å½“å‰çº¿ç¨‹æ„é€ èŠ‚ç‚¹</span></span><br><span class="line">            q = <span class="keyword">new</span> WaitNode();</span><br><span class="line">      <span class="comment">// å¦‚æœè¿˜æ²¡æœ‰å…¥é˜Ÿåˆ—ï¼Œåˆ™æŠŠå½“å‰èŠ‚ç‚¹åŠ å…¥waitersé¦–èŠ‚ç‚¹å¹¶æ›¿æ¢åŸæ¥waiters</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!queued)</span><br><span class="line">            queued = UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset,</span><br><span class="line">                                                 q.next = waiters, q);</span><br><span class="line">      <span class="comment">// å¦‚æœè®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (timed) &#123;</span><br><span class="line">            nanos = deadline - System.nanoTime();</span><br><span class="line">          <span class="comment">// æ—¶é—´åˆ°ï¼Œåˆ™ä¸å†ç­‰å¾…ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> (nanos &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                removeWaiter(q);</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// é˜»å¡ç­‰å¾…ç‰¹å®šæ—¶é—´</span></span><br><span class="line">            LockSupport.parkNanos(<span class="keyword">this</span>, nanos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="comment">// æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼ŒçŸ¥é“è¢«å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">            LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼Œè¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼Œé€šå¸¸ä¼šç»å†ä¸‰è½®å¾ªç¯</p><ol><li>ç¬¬ä¸€è½®forå¾ªç¯ï¼Œæ‰§è¡Œçš„é€»è¾‘æ˜¯ <code>q == null</code>, è¿™æ—¶å€™ä¼šæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ q, ç¬¬ä¸€è½®å¾ªç¯ç»“æŸã€‚</li><li>ç¬¬äºŒè½®forå¾ªç¯ï¼Œæ‰§è¡Œçš„é€»è¾‘æ˜¯ <code>!queue</code>ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæŠŠç¬¬ä¸€è½®å¾ªç¯ä¸­ç”Ÿæˆçš„èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘waitersï¼Œç„¶åCASçš„æŠŠèŠ‚ç‚¹q æ›¿æ¢waiters, ä¹Ÿå°±æ˜¯æŠŠæ–°ç”Ÿæˆçš„èŠ‚ç‚¹æ·»åŠ åˆ°waiters ä¸­çš„é¦–èŠ‚ç‚¹ã€‚å¦‚æœæ›¿æ¢æˆåŠŸï¼Œqueued=trueã€‚ç¬¬äºŒè½®å¾ªç¯ç»“æŸã€‚</li><li>ç¬¬ä¸‰è½®forå¾ªç¯ï¼Œè¿›è¡Œé˜»å¡ç­‰å¾…ã€‚è¦ä¹ˆé˜»å¡ç‰¹å®šæ—¶é—´ï¼Œè¦ä¹ˆä¸€ç›´é˜»å¡çŸ¥é“è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</li></ol><p>å¯¹äºç¬¬äºŒè½®å¾ªç¯ï¼Œå¤§å®¶å¯èƒ½ç¨ç¨æœ‰ç‚¹è¿·ç³Šï¼Œæˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œæœ‰é˜»å¡ï¼Œå°±ä¼šæ’é˜Ÿï¼Œæœ‰æ’é˜Ÿè‡ªç„¶å°±æœ‰é˜Ÿåˆ—ï¼ŒFutureTask å†…éƒ¨åŒæ ·ç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ— </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Treiber stack of waiting threads */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> WaitNode waiters;</span><br></pre></td></tr></table></figure><p>è¯´æ˜¯ç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª Treiber ç±»å‹ stackï¼Œæ—¢ç„¶æ˜¯ stackï¼Œ é‚£å°±åƒæ‰‹æªçš„å¼¹å¤¹ä¸€æ ·ï¼ˆè„‘è¡¥ä¸€ä¸‹å­å¼¹æ”¾å…¥å¼¹å¤¹çš„æƒ…å½¢ï¼‰ï¼Œåè¿›å…ˆå‡ºï¼Œæ‰€ä»¥åˆšåˆšè¯´çš„ç¬¬äºŒè½®å¾ªç¯ï¼Œä¼šæŠŠæ–°ç”Ÿæˆçš„èŠ‚ç‚¹æ·»åŠ åˆ° waiters stack çš„é¦–èŠ‚ç‚¹</p><p>å¦‚æœç¨‹åºè¿è¡Œæ­£å¸¸ï¼Œé€šå¸¸è°ƒç”¨ get() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œé‚£è°æ¥å”¤é†’å‘¢ï¼Ÿè‡ªç„¶æ˜¯ run() æ–¹æ³•è¿è¡Œå®Œä¼šå”¤é†’ï¼Œè®¾ç½®è¿”å›ç»“æœï¼ˆsetæ–¹æ³•ï¼‰/å¼‚å¸¸çš„æ–¹æ³•(setExceptionæ–¹æ³•) ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨ finishCompletion æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±ä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishCompletion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert state &gt; COMPLETING;</span></span><br><span class="line">    <span class="keyword">for</span> (WaitNode q; (q = waiters) != <span class="keyword">null</span>;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset, q, <span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                Thread t = q.thread;</span><br><span class="line">                <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    q.thread = <span class="keyword">null</span>;</span><br><span class="line">                  <span class="comment">// å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">                    LockSupport.unpark(t);</span><br><span class="line">                &#125;</span><br><span class="line">                WaitNode next = q.next;</span><br><span class="line">                <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                q.next = <span class="keyword">null</span>; <span class="comment">// unlink to help gc</span></span><br><span class="line">                q = next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    done();</span><br><span class="line"></span><br><span class="line">    callable = <span class="keyword">null</span>;        <span class="comment">// to reduce footprint</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€è®¾ç½®æˆç»ˆæ­¢æ€åªæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li>set</li><li>setException</li><li>cancel</li></ul><p>å‰ä¸¤ç§æ–¹æ³•å·²ç»åˆ†æå®Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹ <code>cancel</code> æ–¹æ³•</p><p>æŸ¥çœ‹ Future cancel()ï¼Œè¯¥æ–¹æ³•æ³¨é‡Šä¸Šæ˜ç¡®è¯´æ˜ä¸‰ç§ cancel æ“ä½œä¸€å®šå¤±è´¥çš„æƒ…å½¢</p><ol><li>ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæˆäº†</li><li>ä»»åŠ¡å·²ç»è¢«å–æ¶ˆè¿‡äº†</li><li>ä»»åŠ¡å› ä¸ºæŸç§åŸå› ä¸èƒ½è¢«å–æ¶ˆ</li></ol><p>å…¶å®ƒæƒ…å†µä¸‹ï¼Œcancelæ“ä½œå°†è¿”å›trueã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œcancelæ“ä½œè¿”å› true å¹¶ä¸ä»£è¡¨ä»»åŠ¡çœŸçš„å°±æ˜¯è¢«å–æ¶ˆ, <strong>è¿™å–å†³äºå‘åŠ¨cancelçŠ¶æ€æ—¶ï¼Œä»»åŠ¡æ‰€å¤„çš„çŠ¶æ€</strong></p><ul><li>å¦‚æœå‘èµ·cancelæ—¶ä»»åŠ¡è¿˜æ²¡æœ‰å¼€å§‹è¿è¡Œï¼Œåˆ™éšåä»»åŠ¡å°±ä¸ä¼šè¢«æ‰§è¡Œï¼›</li><li>å¦‚æœå‘èµ·cancelæ—¶ä»»åŠ¡å·²ç»åœ¨è¿è¡Œäº†ï¼Œåˆ™è¿™æ—¶å°±éœ€è¦çœ‹ <code>mayInterruptIfRunning</code> å‚æ•°äº†ï¼š<ul><li>å¦‚æœmayInterruptIfRunning ä¸ºtrue, åˆ™å½“å‰åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¼šè¢«ä¸­æ–­</li><li>å¦‚æœmayInterruptIfRunning ä¸ºfalse, åˆ™å¯ä»¥å…è®¸æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ç»§ç»­è¿è¡Œï¼Œç›´åˆ°å®ƒæ‰§è¡Œå®Œ</li></ul></li></ul><p>æœ‰äº†è¿™äº›é“ºå«ï¼Œçœ‹ä¸€ä¸‹ cancel ä»£ç çš„é€»è¾‘å°±ç§’æ‡‚äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (!(state == NEW &amp;&amp;</span><br><span class="line">          UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW,</span><br><span class="line">              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;    <span class="comment">// in case call to interrupt throws exception</span></span><br><span class="line">      <span class="comment">// éœ€è¦ä¸­æ–­ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (mayInterruptIfRunning) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread t = runner;</span><br><span class="line">              <span class="comment">// ä¸­æ–­çº¿ç¨‹</span></span><br><span class="line">                <span class="keyword">if</span> (t != <span class="keyword">null</span>)</span><br><span class="line">                    t.interrupt();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123; <span class="comment">// final state</span></span><br><span class="line">              <span class="comment">// ä¿®æ”¹ä¸ºæœ€ç»ˆçŠ¶æ€ INTERRUPTED</span></span><br><span class="line">                UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, INTERRUPTED);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">        finishCompletion();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ–¹æ³•ç»ˆäºåˆ†æå®Œäº†ï¼Œåˆ°è¿™å’±ä»¬å–å£èŒ¶ä¼‘æ¯ä¸€ä¸‹å§</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705115057.png" alt=""></fancybox></p><p>æˆ‘æ˜¯æƒ³è¯´ï¼Œä½¿ç”¨ FutureTask æ¥æ¼”ç»ƒçƒ§æ°´æ³¡èŒ¶ç»å…¸ç¨‹åº</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705190234.png" alt=""></fancybox></p><p>å¦‚ä¸Šå›¾ï¼š</p><ul><li>æ´—æ°´å£¶ 1 åˆ†é’Ÿ</li><li>çƒ§å¼€æ°´ 15 åˆ†é’Ÿ</li><li>æ´—èŒ¶å£¶ 1 åˆ†é’Ÿ</li><li>æ´—èŒ¶æ¯ 1 åˆ†é’Ÿ</li><li>æ‹¿èŒ¶å¶ 2 åˆ†é’Ÿ</li></ul><p>æœ€ç»ˆæ³¡èŒ¶</p><p>è®©æˆ‘å¿ƒç®—ä¸€ä¸‹ï¼Œå¦‚æœä¸²è¡Œæ€»å…±éœ€è¦ 20 åˆ†é’Ÿï¼Œä½†å¾ˆæ˜¾ç„¶åœ¨çƒ§å¼€æ°´æœŸé—´ï¼Œæˆ‘ä»¬å¯ä»¥æ´—èŒ¶å£¶/æ´—èŒ¶æ¯/æ‹¿èŒ¶å¶</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705191033.png" alt=""></fancybox></p><p>è¿™æ ·æ€»å…±éœ€è¦ 16 åˆ†é’Ÿï¼ŒèŠ‚çº¦äº† 4åˆ†é’Ÿæ—¶é—´ï¼Œçƒ§æ°´æ³¡èŒ¶å°šä¸”å¦‚æ­¤ï¼Œåœ¨ç°åœ¨é«˜å¹¶å‘çš„æ—¶ä»£ï¼Œ4åˆ†é’Ÿå¯ä»¥åšçš„äº‹å¤ªå¤šäº†ï¼Œå­¦ä¼šä½¿ç”¨ Future ä¼˜åŒ–ç¨‹åºæ˜¯å¿…ç„¶ï¼ˆ<strong>å…¶å®ä¼˜åŒ–ç¨‹åºå°±æ˜¯å¯»æ‰¾å…³é”®è·¯å¾„ï¼Œå…³é”®è·¯å¾„æ‰¾åˆ°äº†ï¼Œéå…³é”®è·¯å¾„çš„ä»»åŠ¡é€šå¸¸å°±å¯ä»¥å’Œå…³é”®è·¯å¾„çš„å†…å®¹å¹¶è¡Œæ‰§è¡Œäº†</strong>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MakeTeaExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">      ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºçº¿ç¨‹1çš„FutureTask</span></span><br><span class="line">      FutureTask&lt;String&gt; ft1 = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> T1Task());</span><br><span class="line">      <span class="comment">// åˆ›å»ºçº¿ç¨‹2çš„FutureTask</span></span><br><span class="line">      FutureTask&lt;String&gt; ft2 = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> T2Task());</span><br><span class="line"></span><br><span class="line">      executorService.submit(ft1);</span><br><span class="line">      executorService.submit(ft2);</span><br><span class="line"></span><br><span class="line">      log.info(ft1.get() + ft2.get());</span><br><span class="line">      log.info(<span class="string">"å¼€å§‹æ³¡èŒ¶"</span>);</span><br><span class="line"></span><br><span class="line">      executorService.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T1Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         log.info(<span class="string">"T1:æ´—æ°´å£¶..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">         log.info(<span class="string">"T1:çƒ§å¼€æ°´..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> <span class="string">"T1:å¼€æ°´å·²å¤‡å¥½"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T2Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         log.info(<span class="string">"T2:æ´—èŒ¶å£¶..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">         log.info(<span class="string">"T2:æ´—èŒ¶æ¯..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">         log.info(<span class="string">"T2:æ‹¿èŒ¶å¶..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"T2:ç¦é¼ç™½èŒ¶æ‹¿åˆ°äº†"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¨‹åºæ˜¯ä¸»çº¿ç¨‹ç­‰å¾…ä¸¤ä¸ª FutureTask çš„æ‰§è¡Œç»“æœï¼Œçº¿ç¨‹1 çƒ§å¼€æ°´æ—¶é—´æ›´é•¿ï¼Œçº¿ç¨‹1å¸Œæœ›åœ¨æ°´çƒ§å¼€çš„é‚£ä¸€åˆ¹é‚£å°±å¯ä»¥æ‹¿åˆ°èŒ¶å¶ç›´æ¥æ³¡èŒ¶ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705192544.png" alt=""></fancybox></p><p>é‚£åªéœ€è¦åœ¨çº¿ç¨‹ 1 çš„FutureTask ä¸­è·å– çº¿ç¨‹ 2 FutureTask çš„è¿”å›ç»“æœå°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬ç¨ç¨ä¿®æ”¹ä¸€ä¸‹ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MakeTeaExample1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">      ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºçº¿ç¨‹2çš„FutureTask</span></span><br><span class="line">      FutureTask&lt;String&gt; ft2 = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> T2Task());</span><br><span class="line">      <span class="comment">// åˆ›å»ºçº¿ç¨‹1çš„FutureTask</span></span><br><span class="line">      FutureTask&lt;String&gt; ft1 = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> T1Task(ft2));</span><br><span class="line">      </span><br><span class="line">      executorService.submit(ft1);</span><br><span class="line">      executorService.submit(ft2);</span><br><span class="line"></span><br><span class="line">      executorService.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T1Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> FutureTask&lt;String&gt; ft2;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">T1Task</span><span class="params">(FutureTask&lt;String&gt; ft2)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.ft2 = ft2;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         log.info(<span class="string">"T1:æ´—æ°´å£¶..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">         log.info(<span class="string">"T1:çƒ§å¼€æ°´..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">         String t2Result = ft2.get();</span><br><span class="line">         log.info(<span class="string">"T1 æ‹¿åˆ°T2çš„ &#123;&#125;ï¼Œ å¼€å§‹æ³¡èŒ¶"</span>, t2Result);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"T1: ä¸ŠèŒ¶ï¼ï¼ï¼"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T2Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         log.info(<span class="string">"T2:æ´—èŒ¶å£¶..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">         log.info(<span class="string">"T2:æ´—èŒ¶æ¯..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">         log.info(<span class="string">"T2:æ‹¿èŒ¶å¶..."</span>);</span><br><span class="line">         TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"ç¦é¼ç™½èŒ¶"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ç¨‹åºè¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705194107.png" alt=""></fancybox></p><p>çŸ¥é“è¿™ä¸ªå˜åŒ–åæˆ‘ä»¬å†å›å¤´çœ‹ ExecutorService çš„ä¸‰ä¸ª submit æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Runnable task, T result)</span></span>;</span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œé€å±‚ä»£ç æŸ¥çœ‹åˆ°è¿™é‡Œï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705194511.png" alt=""></fancybox></p><p>ä½ ä¼šå‘ç°ï¼Œå’Œæˆ‘ä»¬æ”¹é€ çƒ§æ°´æ³¡èŒ¶çš„ç¨‹åºæ€ç»´æ˜¯ç›¸ä¼¼çš„ï¼Œå¯ä»¥ä¼ è¿›å»ä¸€ä¸ª resultï¼Œresult ç›¸å½“äºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä¹‹é—´çš„æ¡¥æ¢ï¼Œé€šè¿‡å®ƒä¸»å­çº¿ç¨‹å¯ä»¥å…±äº«æ•°æ®</p><p>ç¬¬äºŒä¸ªæ–¹æ³•å‚æ•°æ˜¯ Runnable ç±»å‹å‚æ•°ï¼Œå³ä¾¿è°ƒç”¨ get() æ–¹æ³•ä¹Ÿæ˜¯è¿”å› nullï¼Œæ‰€ä»¥ä»…æ˜¯å¯ä»¥ç”¨æ¥æ–­è¨€ä»»åŠ¡å·²ç»ç»“æŸäº†ï¼Œç±»ä¼¼ Thread.join()</p><p>ç¬¬ä¸‰ä¸ªæ–¹æ³•å‚æ•°æ˜¯ Callable ç±»å‹å‚æ•°ï¼Œé€šè¿‡get() æ–¹æ³•å¯ä»¥æ˜ç¡®è·å– call() æ–¹æ³•çš„è¿”å›å€¼</p><p>åˆ°è¿™é‡Œï¼Œå…³äº Future çš„æ•´å—è®²è§£å°±ç»“æŸäº†ï¼Œè¿˜æ˜¯éœ€è¦ç®€å•æ¶ˆåŒ–ä¸€ä¸‹çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705203258.png" alt=""></fancybox></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœç†Ÿæ‚‰ Javascript çš„æœ‹å‹ï¼ŒFuture çš„ç‰¹æ€§å’Œ Javascript çš„ Promise æ˜¯ç±»ä¼¼çš„ï¼Œç§ä¸‹å¼€ç©ç¬‘é€šå¸¸å°†å…¶æ¯”å–»æˆ<strong>ç”·æœ‹å‹çš„æ‰¿è¯º</strong></p><p>å›å½’åˆ°Javaï¼Œæˆ‘ä»¬ä» JDK çš„æ¼”å˜å†å²ï¼Œè°ˆåŠ Callable çš„è¯ç”Ÿï¼Œå®ƒå¼¥è¡¥äº† Runnable æ²¡æœ‰è¿”å›å€¼çš„ç©ºç¼ºï¼Œé€šè¿‡ç®€å•çš„ demo äº†è§£ Callable ä¸ Future çš„ä½¿ç”¨ã€‚ FutureTask åˆæ˜¯ Futureæ¥å£çš„æ ¸å¿ƒå®ç°ç±»ï¼Œé€šè¿‡é˜…è¯»æºç äº†è§£äº†æ•´ä¸ªå®ç°é€»è¾‘ï¼Œæœ€åç»“åˆFutureTask å’Œçº¿ç¨‹æ± æ¼”ç¤ºçƒ§æ°´æ³¡èŒ¶ç¨‹åºï¼Œç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯ä»¥è½»æ¾è·å–çº¿ç¨‹ç»“æœäº†</p><p>çƒ§æ°´æ³¡èŒ¶æ˜¯éå¸¸ç®€å•çš„ï¼Œå¦‚æœæ›´å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ Future å¿…å®šä¼šå¸¦æ¥å¾ˆå¤§çš„ä¼šä¹±ï¼ˆç¨‹åºç»“æŸæ²¡åŠæ³•ä¸»åŠ¨é€šçŸ¥ï¼ŒFuture çš„é“¾æ¥å’Œæ•´åˆéƒ½éœ€è¦æ‰‹åŠ¨æ“ä½œï¼‰ä¸ºäº†è§£å†³è¿™ä¸ªçŸ­æ¿ï¼Œæ²¡é”™ï¼Œåˆæ˜¯é‚£ä¸ªç”·äºº Doug Lea, <code>CompletableFuture</code> å·¥å…·ç±»åœ¨ Java1.8 çš„ç‰ˆæœ¬å‡ºç°äº†ï¼Œæ­é… Lambda çš„ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬ç¼–å†™å¼‚æ­¥ç¨‹åºä¹Ÿåƒå†™ä¸²è¡Œä»£ç é‚£æ ·ç®€å•ï¼Œçºµäº«ä¸æ»‘</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200705200111.png" alt=""></fancybox></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±äº†è§£ä¸€ä¸‹ <code>CompletableFuture</code> çš„ä½¿ç”¨</p><blockquote><p><strong>æˆ‘è¿˜è¦å•°å—¦ä¸€å¥ï¼šçƒ§æ°´æ³¡èŒ¶åªæ˜¯æŠ›å‡ºå»çš„ç –ï¼Œæ— è®ºç”Ÿæ´»è¿˜æ˜¯å·¥ä½œéƒ½è¦æ€è€ƒï¼Œå¯»æ‰¾ä»»åŠ¡å…³é”®è·¯å¾„ï¼Œæå‡è‡ªå·±çš„æ•ˆç‡</strong></p></blockquote><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä½ åœ¨æ—¥å¸¸å¼€å‘å·¥ä½œä¸­æ˜¯æ€æ ·å°†æ•´å—ä»»åŠ¡åšåˆ°åˆ†å·¥ä¸åä½œçš„å‘¢ï¼Ÿæœ‰ä»€ä¹ˆåŸºæœ¬å‡†åˆ™å—ï¼Ÿ</li><li>å¦‚ä½•æ‰¹é‡çš„æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡å‘¢ï¼Ÿ</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾</li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CountDownLatch å’Œ CyclicBarrier å‚»å‚»çš„åˆ†ä¸æ¸…æ¥šï¼Ÿ</title>
      <link href="//p/java-countdownlatch-vs-cyclicbarrier.html"/>
      <url>//p/java-countdownlatch-vs-cyclicbarrier.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://rgyb.sunluomeng.top/20200627213322.png" alt=""></fancybox></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¹¶å‘ç¼–ç¨‹çš„ä¸‰å¤§æ ¸å¿ƒæ˜¯<code>åˆ†å·¥</code>ï¼Œ<code>åŒæ­¥</code>å’Œ<code>äº’æ–¥</code>ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­å¼€å¯å¤šä¸ªå­çº¿ç¨‹å»å¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶ä¸”ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†è¿›è¡Œæ±‡æ€»çš„åœºæ™¯ï¼Œè¿™å°±æ¶‰åŠåˆ°åˆ†å·¥ä¸åŒæ­¥çš„å†…å®¹äº†</p><p>åœ¨è®² <a href="https://dayarch.top/p/java-concurrency-happens-before-rule.html#join-%E8%A7%84%E5%88%99">æœ‰åºæ€§å¯è§æ€§ï¼ŒHappens-beforeæ¥æå®š</a> æ—¶ï¼Œæåˆ°è¿‡ join() è§„åˆ™ï¼Œä½¿ç”¨ join() å°±å¯ä»¥ç®€å•çš„å®ç°ä¸Šè¿°åœºæ™¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread thread1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">log.info(<span class="string">"Thread-1 æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="string">"Thread-1"</span>);</span><br><span class="line"></span><br><span class="line">Thread thread2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">log.info(<span class="string">"Thread-2 æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="string">"Thread-2"</span>);</span><br><span class="line"></span><br><span class="line">thread1.start();</span><br><span class="line">thread2.start();</span><br><span class="line"></span><br><span class="line">thread1.join();</span><br><span class="line">thread2.join();</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200626180728.png" alt=""></fancybox></p><p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¿™ä¹ˆç†è§£</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627181246.png" alt=""></fancybox></p><p>æˆ‘ä»¬æ¥æŸ¥çœ‹ join() çš„å®ç°æºç ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627181448.png" alt=""></fancybox></p><p>å…¶å®ç°åŸç†æ˜¯ä¸åœçš„æ£€æŸ¥ join çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœ join çº¿ç¨‹å­˜æ´»ï¼Œåˆ™ wait(0) æ°¸è¿œçš„ç­‰ä¸‹å»ï¼Œç›´è‡³ join çº¿ç¨‹ç»ˆæ­¢åï¼Œçº¿ç¨‹çš„ this.notifyAll() æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼ˆè¯¥æ–¹æ³•æ˜¯åœ¨ JVM ä¸­å®ç°çš„ï¼ŒJDK ä¸­å¹¶ä¸ä¼šçœ‹åˆ°æºç ï¼‰ï¼Œé€€å‡ºå¾ªç¯æ¢å¤ä¸»çº¿ç¨‹æ‰§è¡Œã€‚å¾ˆæ˜¾ç„¶è¿™ç§å¾ªç¯æ£€æŸ¥çš„æ–¹å¼æ¯”è¾ƒä½æ•ˆ</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨ join() ç¼ºå°‘å¾ˆå¤šçµæ´»æ€§ï¼Œæ¯”å¦‚å®é™…é¡¹ç›®ä¸­å¾ˆå°‘è®©è‡ªå·±å•ç‹¬åˆ›å»ºçº¿ç¨‹ï¼ˆåŸå› åœ¨ <a href="https://dayarch.top/p/why-we-need-to-use-threadpool.html">æˆ‘ä¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</a> ä¸­è¯´è¿‡ï¼‰è€Œæ˜¯ä½¿ç”¨ Executor,  è¿™è¿›ä¸€æ­¥å‡å°‘äº† join() çš„ä½¿ç”¨åœºæ™¯ï¼Œæ‰€ä»¥ join() çš„ä½¿ç”¨åœ¨å¤šæ•°æ˜¯åœç•™åœ¨ demo æ¼”ç¤ºä¸Š</p><blockquote><p>é‚£å¦‚ä½•å®ç°æ–‡ä¸­å¼€å¤´æåˆ°çš„åœºæ™¯å‘¢ï¼Ÿ</p></blockquote><h2 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h2><p>CountDownLatch, ç›´è¯‘è¿‡æ¥ã€æ•°é‡å‘ä¸‹é—¨é—©ã€‘ï¼Œé‚£è‚¯å®šé‡Œé¢æœ‰è®¡æ•°å™¨çš„å­˜åœ¨äº†ã€‚æˆ‘ä»¬å°†ä¸Šè¿°ç¨‹åºç”¨ CountDownLatch å®ç°ä¸€ä¸‹ï¼Œå…ˆè®©å¤§å®¶æœ‰ä¸ªç›´è§‚å°è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="comment">// è¿™é‡Œä¸æ¨èè¿™æ ·åˆ›å»ºçº¿ç¨‹æ± ï¼Œæœ€å¥½é€šè¿‡ ThreadPoolExecutor æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">executorService.submit(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">log.info(<span class="string">"Thread-1 æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line"><span class="comment">//è®¡æ•°å™¨å‡1</span></span><br><span class="line">countDownLatch.countDown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">executorService.submit(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">log.info(<span class="string">"Thread-2 æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line"><span class="comment">//è®¡æ•°å™¨å‡1</span></span><br><span class="line">countDownLatch.countDown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">log.info(<span class="string">"è®¡æ•°å™¨å€¼ä¸ºï¼š"</span> + countDownLatch.getCount());</span><br><span class="line">countDownLatch.await();</span><br><span class="line">log.info(<span class="string">"è®¡æ•°å™¨å€¼ä¸ºï¼š"</span> + countDownLatch.getCount());</span><br><span class="line">log.info(<span class="string">"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">executorService.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200626191054.png" alt=""></fancybox></p><p>ç»“åˆä¸Šè¿°ç¤ºä¾‹çš„è¿è¡Œç»“æœï¼Œç›¸ä¿¡ä½ ä¹Ÿèƒ½çŒœå‡º CountDownLatch çš„å®ç°åŸç†äº†ï¼š</p><ol><li>åˆå§‹åŒ–è®¡æ•°å™¨æ•°å€¼ï¼Œæ¯”å¦‚ä¸º2</li><li>å­çº¿ç¨‹æ‰§è¡Œå®Œåˆ™è°ƒç”¨ <code>countDownLatch.countDown()</code> æ–¹æ³•å°†è®¡æ•°å™¨æ•°å€¼å‡1</li><li>ä¸»çº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•é˜»å¡è‡ªå·±ï¼Œç›´è‡³è®¡æ•°å™¨æ•°å€¼ä¸º0ï¼ˆå³å­çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œç»“æŸï¼‰</li></ol><blockquote><p>ä¸çŸ¥é“ä½ æ˜¯å¦æ³¨æ„ï¼Œ<code>countDownLatch.countDown();</code> è¿™è¡Œä»£ç å¯ä»¥å†™åœ¨å­çº¿ç¨‹æ‰§è¡Œçš„ä»»æ„ä½ç½®ï¼Œä¸åƒ join() è¦å®Œå…¨ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œï¼Œè¿™ä¹Ÿæ˜¯ CountDownLatch çµæ´»æ€§çš„ä¸€ç§ä½“ç°</p></blockquote><p>ä¸Šè¿°çš„ä¾‹å­è¿˜æ˜¯è¿‡äºç®€å•ï¼Œ<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CountDownLatch.html" target="_blank" rel="noopener">Oracle å®˜ç½‘ CountDownLatch è¯´æ˜</a> æœ‰ä¸¤ä¸ªéå¸¸ç»å…¸çš„ä½¿ç”¨åœºæ™¯ï¼Œç¤ºä¾‹å¾ˆç®€å•ï¼Œå¼ºçƒˆå»ºè®®æŸ¥çœ‹ç›¸å…³ç¤ºä¾‹ä»£ç ï¼Œæ‰“å¼€ä½¿ç”¨æ€è·¯ã€‚æˆ‘å°†ä¸¤ä¸ªç¤ºä¾‹ä»£ç ä»¥å›¾ç‰‡çš„å½¢å¼å±•ç¤ºåœ¨æ­¤å¤„ï¼š</p><h3 id="å®˜ç½‘ç¤ºä¾‹1"><a href="#å®˜ç½‘ç¤ºä¾‹1" class="headerlink" title="å®˜ç½‘ç¤ºä¾‹1"></a>å®˜ç½‘ç¤ºä¾‹1</h3><ul><li>ç¬¬ä¸€ä¸ªæ˜¯å¼€å§‹ä¿¡å· <code>startSignal</code>ï¼Œé˜»æ­¢ä»»ä½•å·¥äºº <code>Worker</code> ç»§ç»­å·¥ä½œï¼Œç›´åˆ°å¸æœº <code>Driver</code> å‡†å¤‡å¥½è®©ä»–ä»¬ç»§ç»­å·¥ä½œ</li><li>ç¬¬äºŒä¸ªæ˜¯å®Œæˆä¿¡å· <code>doneSignal</code>ï¼Œå…è®¸å¸æœº <code>Driver</code> ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„å·¥äºº <code>Worker</code> å®Œæˆã€‚</li></ul><p><fancybox><img src="https://rgyb.sunluomeng.top/carbon.png" alt=""></fancybox></p><h3 id="å®˜ç½‘ç¤ºä¾‹2"><a href="#å®˜ç½‘ç¤ºä¾‹2" class="headerlink" title="å®˜ç½‘ç¤ºä¾‹2"></a>å®˜ç½‘ç¤ºä¾‹2</h3><p>å¦ä¸€ç§å…¸å‹çš„ç”¨æ³•æ˜¯å°†ä¸€ä¸ªé—®é¢˜åˆ†æˆ N ä¸ªéƒ¨åˆ† ï¼ˆæ¯”å¦‚å°†ä¸€ä¸ªå¤§çš„ list æ‹†åˆ†æˆå¤šåˆ†ï¼Œæ¯ä¸ª Worker å¹²ä¸€éƒ¨åˆ†ï¼‰ï¼ŒWorker æ‰§è¡Œå®Œè‡ªå·±æ‰€å¤„ç†çš„éƒ¨åˆ†åï¼Œè®¡æ•°å™¨å‡1ï¼Œå½“æ‰€æœ‰å­éƒ¨åˆ†å®Œæˆåï¼ŒDriver æ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/carboncountdownlatch2.png" alt=""></fancybox></p><p>ç»“åˆå®˜ç½‘ç¤ºä¾‹ï¼Œç›¸ä¿¡ä½ å·²ç»å¯ä»¥ç»“åˆä½ è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯è§£ï¼Œé€šè¿‡ CountDownLatch è§£å†³ä¸€äº›ä¸²è¡Œç“¶é¢ˆæ¥æé«˜è¿è¡Œæ•ˆç‡äº†ï¼Œä¼šç”¨è¿˜è¿œè¿œä¸å¤Ÿï¼Œå’±å¾—çŸ¥é“ CountDownLatch çš„å®ç°åŸç†</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>CountDownLatch æ˜¯ AQS å®ç°ä¸­çš„æœ€åä¸€ä¸ªå†…å®¹ï¼Œæœ‰äº†å‰åºæ–‡ç« çš„çŸ¥è¯†é“ºå«ï¼š</p><ul><li><a href="https://dayarch.top/p/java-aqs-and-reentrantlock.html">Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨</a></li><li><a href="https://dayarch.top/p/java-aqs-acquireshared-and-semaphore.html">Java AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€åŠSemaphoreçš„åº”ç”¨åˆ†æ</a></li></ul><p>å½“ä½ çœ‹åˆ° CountDownLatch çš„æºç å†…å®¹ï¼Œä½ ä¼šé«˜å…´çš„ç¬‘èµ·æ¥ï¼Œå†…å®¹çœŸæ˜¯å¤ªå°‘äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200626180308.png" alt=""></fancybox></p><p>å±•å¼€ç±»ç»“æ„å…¨éƒ¨å†…å®¹å°±è¿™ç‚¹ä¸œè¥¿</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200626195016.png" alt=""></fancybox></p><p>æ—¢ç„¶ CountDownLatch æ˜¯åŸºäº AQS å®ç°çš„ï¼Œé‚£è‚¯å®šä¹Ÿç¦»ä¸å¼€å¯¹åŒæ­¥çŠ¶æ€å˜é‡ state çš„æ“ä½œï¼Œæˆ‘ä»¬åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å°†è®¡æ•°å™¨çš„å€¼èµ‹å€¼ç»™äº†state</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200626195503.png" alt=""></fancybox></p><p>å¦å¤–ï¼Œå®ƒå¯ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ï¼Œé‚£ä¸€å®šæ˜¯åŸºäºå…±äº«å¼è·å–åŒæ­¥å˜é‡çš„ç”¨æ³•äº†ï¼Œæ‰€ä»¥å®ƒéœ€è¦é€šè¿‡é‡å†™ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•æ§åˆ¶åŒæ­¥çŠ¶æ€å˜é‡ state ï¼š</p><ul><li>tryAcquireShared()</li><li>tryReleaseShared()</li></ul><p>CountDownLatch æš´éœ²ç»™ä½¿ç”¨è€…çš„åªæœ‰ <code>await()</code> å’Œ <code>countDown()</code> ä¸¤ä¸ªæ–¹æ³•ï¼Œå‰è€…æ˜¯é˜»å¡è‡ªå·±ï¼Œå› ä¸ºåªæœ‰è·å–åŒæ­¥çŠ¶æ€æ‰ä¼šæ‰ä¼šå‡ºç°é˜»å¡çš„æƒ…å†µï¼Œé‚£è‡ªç„¶æ˜¯åœ¨ <code>await()</code> çš„æ–¹æ³•å†…éƒ¨ä¼šç”¨åˆ° <code>tryAcquireShared()</code>ï¼›æœ‰è·å–å°±è¦æœ‰é‡Šæ”¾ï¼Œé‚£åè€… <code>countDown()</code>  æ–¹æ³•å†…éƒ¨è‡ªç„¶æ˜¯è¦ç”¨åˆ° <code>tryReleaseShared()</code> æ–¹æ³•äº†</p><blockquote><p>PSï¼šå¦‚æœä½ å¯¹ä¸Šé¢è¿™ä¸ªå¾ˆè‡ªç„¶çš„æ¨æ–­ç†è§£æœ‰å›°éš¾ï¼Œå¼ºçƒˆå»ºè®®ä½ çœ‹ä¸€ä¸‹å‰åºæ–‡ç« çš„é“ºå«ï¼Œä»¥é˜²æ­¢çŸ¥è¯†æ–­å±‚å¸¦æ¥çš„å›°æ‰°</p></blockquote><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="await"><a href="#await" class="headerlink" title="await()"></a>await()</h4><p>å…ˆæ¥çœ‹ await() æ–¹æ³•, ä»æ–¹æ³•ç­¾åä¸Šçœ‹ï¼Œè¯¥æ–¹æ³•ä¼šæŠ›å‡º InterruptedException, æ‰€ä»¥å®ƒæ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ <a href="https://dayarch.top/p/java-concurrency-interrupt-mechnism.html">Javaå¤šçº¿ç¨‹ä¸­æ–­æœºåˆ¶</a> ä¸­æ˜ç¡®è¯´æ˜è¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    sync.acquireSharedInterruptibly(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å†…éƒ¨è°ƒç”¨äº†åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³• <code>acquireSharedInterruptibly</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœç›‘æµ‹åˆ°ä¸­æ–­æ ‡è¯†ä¸ºtrue,ä¼šé‡ç½®æ ‡è¯†ï¼Œç„¶åæŠ›å‡º InterruptedException</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">  <span class="comment">// è°ƒç”¨é‡å†™çš„ tryAcquireShared æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç»“æœå¦‚æœå¤§äºé›¶åˆ™ç›´æ¥è¿”å›ï¼Œç¨‹åºç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå¦‚æœå°äºé›¶ï¼Œåˆ™ä¼šé˜»å¡è‡ªå·±</span></span><br><span class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="comment">// stateä¸ç­‰äº0ï¼Œåˆ™å°è¯•é˜»å¡è‡ªå·±</span></span><br><span class="line">        doAcquireSharedInterruptibly(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å†™çš„ <code>tryAcquireShared</code> æ–¹æ³•éå¸¸ç®€å•, å°±æ˜¯åˆ¤æ–­åŒæ­¥çŠ¶æ€å˜é‡ state çš„å€¼æ˜¯å¦ä¸º 0ï¼Œ å¦‚æœä¸ºé›¶ ï¼ˆå­çº¿ç¨‹å·²ç»å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼‰åˆ™è¿”å›1ï¼Œ å¦åˆ™è¿”å› -1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå­çº¿ç¨‹æ²¡æœ‰å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¼šé€šè¿‡ <code>doAcquireSharedInterruptibly</code> æ–¹æ³•é˜»å¡è‡ªå·±ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ <a href="https://dayarch.top/p/java-aqs-acquireshared-and-semaphore.html">Java AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€åŠSemaphoreçš„åº”ç”¨åˆ†æ</a> ä¸­å·²ç»ä»”ç»†åˆ†æè¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAcquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.SHARED);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head) &#123;</span><br><span class="line">              <span class="comment">// å†æ¬¡å°è¯•è·å–åŒæ­¥è£…é˜¿åšï¼Œå¦‚æœå¤§äº0ï¼Œè¯´æ˜å­çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">                <span class="keyword">int</span> r = tryAcquireShared(arg);</span><br><span class="line">                <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// é˜»å¡è‡ªå·±</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>await()</code> æ–¹æ³•çš„å®ç°å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ <code>countDown()</code> çš„å®ç°åŸç†</p><h4 id="countDown"><a href="#countDown" class="headerlink" title="countDown()"></a>countDown()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sync.releaseShared(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æ˜¯è°ƒç”¨åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³• <code>releaseShared</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">releaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨è‡ªå·±é‡å†™çš„åŒæ­¥å™¨æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">      <span class="comment">// å”¤é†’è°ƒç”¨ await() è¢«é˜»å¡çš„çº¿ç¨‹</span></span><br><span class="line">        doReleaseShared();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å†™çš„ <code>tryReleaseShared</code> åŒæ ·å¾ˆç®€å•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = getState();</span><br><span class="line">      <span class="comment">// å¦‚æœå½“å‰çŠ¶æ€å€¼ä¸º0ï¼Œåˆ™ç›´æ¥è¿”å› ï¼ˆ1ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ CAS è®©è®¡æ•°å™¨çš„å€¼å‡1 ï¼ˆ2ï¼‰</span></span><br><span class="line">        <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">            <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç  ï¼ˆ1ï¼‰ åˆ¤æ–­å½“å‰åŒæ­¥çŠ¶æ€å€¼ï¼Œå¦‚æœä¸º0 åˆ™ç›´æ¥è¿”å› falseï¼›å¦åˆ™æ‰§è¡Œä»£ç  ï¼ˆ2ï¼‰ï¼Œä½¿ç”¨ CAS å°†è®¡æ•°å™¨å‡1ï¼Œå¦‚æœ CAS å¤±è´¥ï¼Œåˆ™å¾ªç¯é‡è¯•ï¼Œæœ€ç»ˆè¿”å› <code>nextc == 0</code>  çš„ç»“æœå€¼ï¼Œå¦‚æœè¯¥å€¼è¿”å› trueï¼Œè¯´æ˜æœ€åä¸€ä¸ªçº¿ç¨‹å·²è°ƒç”¨ countDown() æ–¹æ³•ï¼Œç„¶åå°±è¦å”¤é†’è°ƒç”¨ await() æ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹ï¼ŒåŒæ ·ç”±äºåˆ†æè¿‡ AQS çš„æ¨¡ç‰ˆæ–¹æ³• doReleaseShared æ•´ä¸ªé‡Šæ”¾åŒæ­¥çŠ¶æ€ä»¥åŠå”¤é†’çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿™é‡ŒåŒæ ·ä¸å†èµ˜è¿°äº†</p><p>ä»”ç»†çœ‹CountDownLatché‡å†™çš„ <code>tryReleaseShared</code> æ–¹æ³•ï¼Œæœ‰ä¸€ç‚¹éœ€è¦å’Œå¤§å®¶è¯´æ˜ï¼š</p><blockquote><p>ä»£ç  ï¼ˆ1ï¼‰ <code>if (c == 0)</code> çœ‹ä¼¼æ²¡ä»€ä¹ˆç”¨å¤„ï¼Œå…¶å®ç”¨å¤„å¤§å¤§æ»´ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªåˆ¤æ–­ï¼Œå½“è®¡æ•°å™¨å€¼å·²ç»ä¸ºé›¶äº†ï¼Œå…¶ä»–çº¿ç¨‹å†è°ƒç”¨ countDown æ–¹æ³•ä¼šå°†è®¡æ•°å™¨å€¼å˜ä¸ºè´Ÿå€¼ </p></blockquote><p>ç°åœ¨å°±å·® <code>await(long timeout, TimeUnit unit)</code> æ–¹æ³•æ²¡ä»‹ç»äº†</p><h4 id="await-long-timeout-TimeUnit-unit"><a href="#await-long-timeout-TimeUnit-unit" class="headerlink" title="await(long timeout, TimeUnit unit)"></a>await(long timeout, TimeUnit unit)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sync.tryAcquireSharedNanos(<span class="number">1</span>, unit.toNanos(timeout));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ç­¾ååŒæ ·æŠ›å‡º InterruptedExceptionï¼Œæ„æ€å¯å“åº”ä¸­æ–­ã€‚å®ƒå…¶å®å°±æ˜¯ await() æ›´å®Œå–„çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œç®€å•æ¥è¯´å°±æ˜¯</p><blockquote><p>ä¸»çº¿ç¨‹è®¾å®šç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¯¥æ—¶é—´å†…å­çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹ä¹Ÿä¼š<strong>ç›´æ¥è¿”å›</strong></p></blockquote><p>æˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­ç¨ç¨ä¿®æ”¹ä¸€ä¸‹ä½ å°±ä¼šæ˜ç™½(ä¸»çº¿ç¨‹è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 2 ç§’ï¼Œè€Œå­çº¿ç¨‹è¦ sleep 5 ç§’)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTimeoutExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œä¸æ¨èè¿™æ ·åˆ›å»ºçº¿ç¨‹æ± ï¼Œæœ€å¥½é€šè¿‡ ThreadPoolExecutor æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">      ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">      executorService.submit(() -&gt; &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.info(<span class="string">"Thread-1 æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">            <span class="comment">//è®¡æ•°å™¨å‡1</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      executorService.submit(() -&gt; &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.info(<span class="string">"Thread-2 æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">            <span class="comment">//è®¡æ•°å™¨å‡1</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      log.info(<span class="string">"ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">      log.info(<span class="string">"è®¡æ•°å™¨å€¼ä¸ºï¼š"</span> + countDownLatch.getCount());</span><br><span class="line">      countDownLatch.await(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">      log.info(<span class="string">"è®¡æ•°å™¨å€¼ä¸ºï¼š"</span> + countDownLatch.getCount());</span><br><span class="line">      log.info(<span class="string">"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">      executorService.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627144719.png" alt=""></fancybox></p><p>å½¢è±¡åŒ–çš„å±•ç¤ºä¸Šè¿°ç¤ºä¾‹çš„è¿è¡Œè¿‡ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627185411.png" alt=""></fancybox></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>CountDownLatch çš„å®ç°åŸç†å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œäº†è§£äº†æ•´ä¸ªå®ç°è¿‡ç¨‹åï¼Œä½ ä¹Ÿè®¸å‘ç°äº†ä½¿ç”¨ CountDownLatch çš„ä¸€ä¸ªé—®é¢˜ï¼š</p><blockquote><p>è®¡æ•°å™¨å‡ 1 æ“ä½œæ˜¯<strong>ä¸€æ¬¡æ€§</strong>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“è®¡æ•°å™¨å‡åˆ° 0ï¼Œ å†æœ‰çº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ä¼šç›´æ¥é€šè¿‡ï¼Œ<strong>ä¸ä¼šå†èµ·åˆ°ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œç»“æœèµ·åˆ°åŒæ­¥çš„ä½œç”¨äº†</strong></p></blockquote><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè´´å¿ƒçš„ Doug Lea å¤§å¸ˆæ—©å·²ç»™æˆ‘ä»¬å‡†å¤‡å¥½ç›¸åº”ç­–ç•¥ <code>CyclicBarrier</code> </p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627185712.png" alt=""></fancybox></p><blockquote><p>æœ¬æ¥æƒ³å°† <code>CyclicBarrier</code> çš„å†…å®¹æ”¾åˆ°ä¸‹ä¸€ä¸ªç« èŠ‚ï¼Œä½†æ˜¯ CountDownLatch çš„å†…å®¹ç€å®æœ‰äº›å°‘ï¼Œä¸å¤Ÿè§£æ¸´ï¼Œå¦å¤–æœ‰å¯¹æ¯”æ‰æœ‰ä¼¤å®³ï¼Œæ‰€ä»¥å†…å®¹æ²¡ç»“æŸï¼Œå’±å¾—ç»§ç»­çœ‹ <code>CyclicBarrier</code>ï¼‰</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200626205623.png" alt=""></fancybox></p><h2 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h2><p>ä¸Šé¢ç®€å•è¯´äº†ä¸€ä¸‹ CyclicBarrier è¢«åˆ›é€ å‡ºæ¥çš„ç†ç”±ï¼Œè¿™é‡Œå…ˆçœ‹ä¸€ä¸‹å®ƒçš„å­—é¢è§£é‡Šï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627150846.png" alt=""></fancybox></p><p>æ¦‚å¿µæ€»æ˜¯æœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­ç”¨ CyclicBarrier å†åšä¸ªæ”¹åŠ¨ï¼Œå…ˆè®©å¤§å®¶æœ‰ä¸ªç›´è§‚çš„ä½¿ç”¨æ¦‚å¿µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆ›å»º CyclicBarrier å®ä¾‹ï¼Œè®¡æ•°å™¨çš„å€¼è®¾ç½®ä¸º2</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">      <span class="keyword">int</span> breakCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// å°†çº¿ç¨‹æäº¤åˆ°çº¿ç¨‹æ± </span></span><br><span class="line">      executorService.submit(() -&gt; &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(Thread.currentThread() + <span class="string">"ç¬¬ä¸€å›åˆ"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line"></span><br><span class="line">            log.info(Thread.currentThread() + <span class="string">"ç¬¬äºŒå›åˆ"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line"></span><br><span class="line">            log.info(Thread.currentThread() + <span class="string">"ç¬¬ä¸‰å›åˆ"</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125; </span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      executorService.submit(() -&gt; &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(Thread.currentThread() + <span class="string">"ç¬¬ä¸€å›åˆ"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line"></span><br><span class="line">            log.info(Thread.currentThread() + <span class="string">"ç¬¬äºŒå›åˆ"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line"></span><br><span class="line">            log.info(Thread.currentThread() + <span class="string">"ç¬¬ä¸‰å›åˆ"</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      executorService.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627152822.png" alt=""></fancybox></p><p>ç»“åˆç¨‹åºä»£ç ä¸è¿è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå­çº¿ç¨‹æ‰§è¡Œå®Œç¬¬ä¸€å›åˆåï¼ˆæ‰§è¡Œå›åˆæ‰€éœ€æ—¶é—´ä¸åŒï¼‰ï¼Œéƒ½ä¼šè°ƒç”¨ await() æ–¹æ³•ï¼Œç­‰æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹åï¼Œä¼šçªç ´å±éšœç»§è€Œæ‰§è¡Œç¬¬äºŒå›åˆï¼ŒåŒæ ·çš„é“ç†æœ€ç»ˆåˆ°è¾¾ç¬¬ä¸‰å›åˆ</p><p>å½¢è±¡åŒ–çš„å±•ç¤ºä¸Šè¿°ç¤ºä¾‹çš„è¿è¡Œè¿‡ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627190525.png" alt=""></fancybox></p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥æ˜ç™½ CyclicBarrier çš„åŸºæœ¬ç”¨æ³•ï¼Œä½†éšä¹‹ä½ å†…å¿ƒä¹Ÿåº”è¯¥æœ‰äº†ä¸€äº›ç–‘é—®ï¼š</p><ol><li>æ€ä¹ˆåˆ¤æ–­æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹çš„ï¼Ÿ</li><li>çªç ´æŸä¸€å±éšœåï¼Œåˆæ˜¯æ€ä¹ˆé‡ç½® CyclicBarrier è®¡æ•°å™¨ï¼Œç­‰å¾…çº¿ç¨‹å†ä¸€æ¬¡çªç ´å±éšœå‘¢ï¼Ÿ</li></ol><p>å¸¦ç€è¿™äº›é—®é¢˜æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æºç </p><h3 id="æºç åˆ†æ-1"><a href="#æºç åˆ†æ-1" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>åŒæ ·å…ˆæ‰“å¼€ CyclicBarrier çš„ç±»ç»“æ„ï¼Œå±•å¼€ç±»å…¨éƒ¨å†…å®¹ï¼Œå…¶å®ä¹Ÿæ²¡å¤šå°‘å†…å®¹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627163939.png" alt=""></fancybox></p><p>ä»ç±»ç»“æ„ä¸­çœ‹åˆ°æœ‰ï¼š</p><ol><li>await() æ–¹æ³•ï¼ŒçŒœæµ‹åº”è¯¥å’Œ CountDownLatch æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯è·å–åŒæ­¥çŠ¶æ€ï¼Œé˜»å¡è‡ªå·±</li><li>ReentrantLockï¼ŒCyclicBarrier å†…éƒ¨ç«Ÿç„¶ä¹Ÿç”¨åˆ°äº†æˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„ ReentrantLockï¼ŒçŒœæµ‹è¿™ä¸ªé”ä¸€å®šä¿æŠ¤ CyclicBarrier çš„æŸä¸ªå˜é‡ï¼Œé‚£è‚¯å®šä¹Ÿæ˜¯åŸºäº AQS ç›¸å…³çŸ¥è¯†äº†</li><li>Conditionï¼Œå­˜åœ¨æ¡ä»¶ï¼ŒçŒœæµ‹ä¼šæœ‰ç­‰å¾…/é€šçŸ¥æœºåˆ¶çš„è¿ç”¨</li></ol><p>æˆ‘ä»¬ç»§ç»­å¸¦ç€è¿™äº›çŒœæµ‹ï¼Œç»“åˆä¸Šé¢çš„å®ä¾‹ä»£ç ä¸€ç‚¹ç‚¹æ¥éªŒè¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º CyclicBarrier å®ä¾‹ï¼Œè®¡æ•°å™¨çš„å€¼è®¾ç½®ä¸º2</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ„é€ å‡½æ•° (è¿™é‡Œçš„è‹±æ–‡æ³¨é‡Šèˆä¸å¾—åˆ æ‰ï¼Œå› ä¸ºè¯´çš„å¤ªæ¸…æ¥šäº†ï¼Œæˆ‘æ¥ç»“åˆæ³¨é‡Šæ¥è¯´æ˜ä¸€ä¸‹)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> parties;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(parties, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new &#123;<span class="doctag">@code</span> CyclicBarrier&#125; that will trip when the</span></span><br><span class="line"><span class="comment">     * given number of parties (threads) are waiting upon it, and which</span></span><br><span class="line"><span class="comment">     * will execute the given barrier action when the barrier is tripped,</span></span><br><span class="line"><span class="comment">     * performed by the last thread entering the barrier.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parties the number of threads that must invoke &#123;<span class="doctag">@link</span> #await&#125;</span></span><br><span class="line"><span class="comment">     *        before the barrier is tripped</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> barrierAction the command to execute when the barrier is</span></span><br><span class="line"><span class="comment">     *        tripped, or &#123;<span class="doctag">@code</span> null&#125; if there is no action</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> parties&#125; is less than 1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties, Runnable barrierAction)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parties &lt;= <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">this</span>.parties = parties;</span><br><span class="line">        <span class="keyword">this</span>.count = parties;</span><br><span class="line">        <span class="keyword">this</span>.barrierCommand = barrierAction;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æ³¨é‡Šè¯´æ˜ï¼Œparties ä»£è¡¨å†²ç ´å±éšœä¹‹å‰è¦è§¦å‘çš„çº¿ç¨‹æ€»æ•°ï¼Œcount æœ¬èº«åˆæ˜¯è®¡æ•°å™¨ï¼Œé‚£é—®é¢˜æ¥äº†</p><blockquote><p>ç›´æ¥å°±ç”¨ count ä¸å°±å¯ä»¥äº†å˜›ï¼Ÿä¸ºå•¥åŒæ ·ç”¨äºåˆå§‹åŒ–è®¡æ•°å™¨ï¼Œè¦ç»´æŠ¤ä¸¤ä¸ªå˜é‡å‘¢ï¼Ÿ</p></blockquote><p>ä» parties å’Œ count çš„å˜é‡å£°æ˜ä¸­ï¼Œä½ ä¹Ÿèƒ½çœ‹å‡ºä¸€äº›é—¨é“ï¼Œå‰è€…æœ‰ final ä¿®é¥°ï¼Œåˆå§‹åŒ–åå°±ä¸å¯ä»¥æ”¹å˜äº†ï¼Œå› ä¸º CyclicBarrier çš„è®¾è®¡ç›®çš„æ˜¯å¯ä»¥å¾ªç¯åˆ©ç”¨çš„ï¼Œæ‰€ä»¥å§‹ç»ˆç”¨ parties æ¥è®°å½•çº¿ç¨‹æ€»æ•°ï¼Œå½“ count è®¡æ•°å™¨å˜ä¸º 0 åï¼Œå¦‚æœæ²¡æœ‰ parties çš„å€¼èµ‹ç»™å®ƒï¼Œæ€ä¹ˆè¿›è¡Œé‡æ–°å¤ç”¨å†æ¬¡è®¡æ•°å‘¢ï¼Œæ‰€ä»¥è¿™é‡Œç»´æŠ¤ä¸¤ä¸ªå˜é‡å¾ˆæœ‰å¿…è¦</p><p>æ¥ä¸‹æ¥å°±çœ‹çœ‹ await() åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»æ–¹æ³•ç­¾åä¸Šå¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•åŒæ ·å¯ä»¥è¢«ä¸­æ–­ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ª BrokenBarrierException å¼‚å¸¸ï¼Œæˆ‘ä»¬ä¸€ä¼šçœ‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è°ƒç”¨å†…éƒ¨ dowait æ–¹æ³•ï¼Œ ç¬¬ä¸€ä¸ªå‚æ•°ä¸º falseï¼Œè¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå°±æ²¡äº†æ„ä¹‰</span></span><br><span class="line">        <span class="keyword">return</span> dowait(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (TimeoutException toe) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Error(toe); <span class="comment">// cannot happen</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çœ‹çœ‹ <code>dowait(false, 0L)</code> åšäº†å“ªäº›äº‹æƒ… ï¼ˆè¿™ä¸ªæ–¹æ³•å†…å®¹æœ‰ç‚¹å¤šï¼Œåˆ«æ‹…å¿ƒï¼Œé€»è¾‘å¹¶ä¸å¤æ‚ï¼Œè¯·çœ‹å…³é”®ä»£ç æ³¨é‡Šï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">dowait</span><span class="params">(<span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, BrokenBarrierException,</span></span><br><span class="line"><span class="function">           TimeoutException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    <span class="comment">// è¿˜è®°å¾—ä¹‹å‰è¯´è¿‡çš„ Lock æ ‡å‡†èŒƒå¼å—ï¼Ÿ JDK å†…éƒ¨éƒ½æ˜¯è¿™ä¹ˆä½¿ç”¨çš„ï¼Œä½ ä¸€å®šä¹Ÿè¦éµå¾ªèŒƒå¼</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> Generation g = generation;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// broken æ˜¯é™æ€å†…éƒ¨ç±» Generationå”¯ä¸€çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œç”¨äºè®°å½•å½“å‰å±éšœæ˜¯å¦è¢«æ‰“ç ´ï¼Œå¦‚æœæ‰“ç ´ï¼Œåˆ™æŠ›å‡º BrokenBarrierException å¼‚å¸¸</span></span><br><span class="line">      <span class="comment">// è¿™é‡Œæ„Ÿè§‰æŒºå›°æƒ‘çš„ï¼Œæˆ‘ä»¬è¦ã€å†²ç ´ã€‘å±éšœï¼Œè¿™é‡Œã€æ‰“ç ´ã€‘å±éšœå´æŠ›å‡ºå¼‚å¸¸ï¼Œæ³¨æ„æˆ‘è¿™é‡Œçš„ç”¨è¯</span></span><br><span class="line">        <span class="keyword">if</span> (g.broken)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BrokenBarrierException();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™ä¼šé€šè¿‡ breakBarrier æ–¹æ³•å°† broken è®¾ç½®ä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰çº¿ç¨‹æ”¶åˆ°ä¸­æ–­é€šçŸ¥ï¼Œç›´æ¥å°±æ‰“ç ´å±éšœï¼Œåœæ­¢ CyclicBarrierï¼Œ å¹¶å”¤é†’æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">            breakBarrier();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// ************************************</span></span><br><span class="line">      <span class="comment">// å› ä¸º breakBarrier æ–¹æ³•åœ¨è¿™é‡Œä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œæˆ‘ç›´æ¥å°† breakBarrier ä»£ç æ’å…¥åˆ°è¿™é‡Œ</span></span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">breakBarrier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="comment">// å°†æ‰“ç ´å±éšœæ ‡è¯† è®¾ç½®ä¸º true</span></span><br><span class="line">          generation.broken = <span class="keyword">true</span>;</span><br><span class="line">          <span class="comment">// é‡ç½®è®¡æ•°å™¨</span></span><br><span class="line">          count = parties;</span><br><span class="line">          <span class="comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">          trip.signalAll();</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="comment">// ************************************</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ await æ–¹æ³•ï¼Œè®¡æ•°å™¨ count å°±ä¼šå‡1</span></span><br><span class="line">        <span class="keyword">int</span> index = --count;</span><br><span class="line">      <span class="comment">// å½“ count å€¼å‡åˆ° 0 æ—¶ï¼Œè¯´æ˜è¿™æ˜¯æœ€åä¸€ä¸ªè°ƒç”¨ await() çš„å­çº¿ç¨‹ï¼Œåˆ™ä¼šçªç ´å±éšœ</span></span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;  <span class="comment">// tripped</span></span><br><span class="line">            <span class="keyword">boolean</span> ranAction = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// è·å–æ„é€ å‡½æ•°ä¸­çš„ barrierCommandï¼Œå¦‚æœæœ‰å€¼ï¼Œåˆ™è¿è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">final</span> Runnable command = barrierCommand;</span><br><span class="line">                <span class="keyword">if</span> (command != <span class="keyword">null</span>)</span><br><span class="line">                    command.run();</span><br><span class="line">                ranAction = <span class="keyword">true</span>;</span><br><span class="line">              <span class="comment">// æ¿€æ´»å…¶ä»–å› è°ƒç”¨ await æ–¹æ³•è€Œè¢«é˜»å¡çš„çº¿ç¨‹ï¼Œå¹¶é‡ç½® CyclicBarrier</span></span><br><span class="line">                nextGeneration();</span><br><span class="line">              </span><br><span class="line">                <span class="comment">// ************************************</span></span><br><span class="line">                <span class="comment">// ä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œæˆ‘ç›´æ¥å°† nextGeneration å®ç°æ’å…¥åˆ°è¿™é‡Œ</span></span><br><span class="line">                <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">nextGeneration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// signal completion of last generation</span></span><br><span class="line">                    trip.signalAll();</span><br><span class="line">                    <span class="comment">// set up next generation</span></span><br><span class="line">                    count = parties;</span><br><span class="line">                    generation = <span class="keyword">new</span> Generation();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ************************************</span></span><br><span class="line">              </span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!ranAction)</span><br><span class="line">                    breakBarrier();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// index ä¸ç­‰äº0ï¼Œ è¯´æ˜å½“å‰ä¸æ˜¯æœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ await æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// loop until tripped, broken, interrupted, or timed out</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">                <span class="keyword">if</span> (!timed)</span><br><span class="line">                  <span class="comment">// è¿›å…¥æ¡ä»¶ç­‰å¾…</span></span><br><span class="line">                    trip.await();</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (nanos &gt; <span class="number">0L</span>)</span><br><span class="line">                  <span class="comment">// å¦åˆ™ï¼Œåˆ¤æ–­è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ AQS ä¸­æœ‰è¯´æ˜è¿‡ï¼ŒåŒ…æ‹¬ä¸ºä»€ä¹ˆæœ€åè¶…æ—¶é˜ˆå€¼ spinForTimeoutThreshold ä¸å†æ¯”è¾ƒçš„åŸå› ï¼Œå¤§å®¶ä¼šçœ‹å°±å¥½</span></span><br><span class="line">                    nanos = trip.awaitNanos(nanos);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">              <span class="comment">// æ¡ä»¶ç­‰å¾…è¢«ä¸­æ–­ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹å·²ç»ä½¿å±éšœç ´åã€‚è‹¥æ²¡æœ‰åˆ™è¿›è¡Œå±éšœç ´åå¤„ç†ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼›å¦åˆ™å†æ¬¡ä¸­æ–­å½“å‰çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (g == generation &amp;&amp; ! g.broken) &#123;</span><br><span class="line">                    breakBarrier();</span><br><span class="line">                    <span class="keyword">throw</span> ie;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (g.broken)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BrokenBarrierException();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å¦‚æœæ–°ä¸€è½®å›ç¯ç»“æŸï¼Œä¼šé€šè¿‡ nextGeneration æ–¹æ³•æ–°å»º generation å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (g != generation)</span><br><span class="line">                <span class="keyword">return</span> index;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (timed &amp;&amp; nanos &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                breakBarrier();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>doWait å°±æ˜¯ CyclicBarrier çš„æ ¸å¿ƒé€»è¾‘ï¼Œ å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•å…¥å£ä½¿ç”¨äº† ReentrantLockï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ Generation broken å˜é‡æ²¡æœ‰è¢«å£°æ˜ä¸º volatile ç±»å‹ä¿æŒå¯è§æ€§ï¼Œå› ä¸ºå¯¹å…¶çš„æ›´æ”¹éƒ½æ˜¯åœ¨é”çš„å†…éƒ¨ï¼ŒåŒæ ·åœ¨é”çš„å†…éƒ¨å¯¹è®¡æ•°å™¨ count åšæ›´æ–°ï¼Œä¹Ÿä¿è¯äº†åŸå­æ€§</p><p>doWait æ–¹æ³•ä¸­ï¼Œæ˜¯é€šè¿‡ nextGeneration æ–¹æ³•æ¥é‡æ–°åˆå§‹åŒ–/é‡ç½® CyclicBarrier çŠ¶æ€çš„ï¼Œè¯¥ç±»ä¸­è¿˜æœ‰ä¸€ä¸ª reset() æ–¹æ³•ï¼Œä¹Ÿæ˜¯é‡ç½® CyclicBarrier çŠ¶æ€çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        breakBarrier();   <span class="comment">// break the current generation</span></span><br><span class="line">        nextGeneration(); <span class="comment">// start a new generation</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½† reset() æ–¹æ³•å¹¶æ²¡æœ‰åœ¨ CyclicBarrier å†…éƒ¨è¢«è°ƒç”¨ï¼Œæ˜¾ç„¶æ˜¯ç»™ CyclicBarrier ä½¿ç”¨è€…æ¥è°ƒç”¨çš„ï¼Œé‚£é—®é¢˜æ¥äº†</p><blockquote><p>ä»€ä¹ˆæ—¶å€™è°ƒç”¨ reset() æ–¹æ³•å‘¢</p></blockquote><p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒCyclicBarrier æ˜¯ä¼šè¢«è‡ªåŠ¨é‡ç½®çŠ¶æ€çš„ï¼Œä» reset çš„æ–¹æ³•å®ç°ä¸­å¯ä»¥çœ‹å‡ºè°ƒç”¨äº† breakBarrier</p><p>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ reset ä¼šä½¿å½“å‰å¤„åœ¨ç­‰å¾…ä¸­çš„çº¿ç¨‹æœ€ç»ˆæŠ›å‡º BrokenBarrierException å¹¶ç«‹å³è¢«å”¤é†’ï¼Œæ‰€ä»¥è¯´  reset() åªä¼šåœ¨ä½ æƒ³æ‰“ç ´å±éšœæ—¶æ‰ä¼šä½¿ç”¨</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627210856.png" alt=""></fancybox></p><p>ä¸Šè¿°ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ„å»º CyclicBarrier å¯¹è±¡æ—¶ï¼Œå¹¶æ²¡æœ‰ä¼ é€’ barrierCommand å¯¹è±¡ï¼Œ æˆ‘ä»¬ä¿®æ”¹ç¤ºä¾‹ä¼ å…¥ä¸€ä¸ª barrierCommand å¯¹è±¡ï¼Œçœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º CyclicBarrier å®ä¾‹ï¼Œè®¡æ•°å™¨çš„å€¼è®¾ç½®ä¸º2</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>, () -&gt; &#123;</span><br><span class="line">   log.info(<span class="string">"å…¨éƒ¨è¿è¡Œç»“æŸ"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627180315.png" alt=""></fancybox></p><p>ä»è¿è¡Œç»“æœä¸­æ¥çœ‹ï¼Œæ¯æ¬¡å†²ç ´å±éšœåéƒ½ä¼šæ‰§è¡Œ CyclicBarrier åˆå§‹åŒ– barrierCommand çš„æ–¹æ³•ï¼Œ è¿™ä¸æˆ‘ä»¬å¯¹ doWait() æ–¹æ³•çš„åˆ†æå®Œå…¨å»åˆï¼Œä»ä¸Šé¢çš„è¿è¡Œç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹æ˜¯è¿è¡Œ barrierCommand run() æ–¹æ³•çš„çº¿ç¨‹ï¼Œæˆ‘ä»¬å†æ¥å½¢è±¡åŒ–çš„å±•ç¤ºä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627203542.png" alt=""></fancybox></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒbarrierAction ä¸æ¯æ¬¡çªç ´å±éšœæ˜¯ä¸²è¡ŒåŒ–çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå‡å¦‚ barrierAction æ˜¯å¾ˆè€—æ—¶çš„æ±‡æ€»æ“ä½œï¼Œé‚£è¿™å°±æ˜¯å¯ä»¥ä¼˜åŒ–çš„ç‚¹äº†ï¼Œæˆ‘ä»¬ç»§ç»­ä¿®æ”¹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå•çº¿ç¨‹çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Executor executor = Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º CyclicBarrier å®ä¾‹ï¼Œè®¡æ•°å™¨çš„å€¼è®¾ç½®ä¸º2</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>, () -&gt; &#123;</span><br><span class="line">   executor.execute(() -&gt; gather());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">gather</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">   &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">   &#125;</span><br><span class="line">   log.info(<span class="string">"å…¨éƒ¨è¿è¡Œç»“æŸ"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œå°† CyclicBarrier çš„å›è°ƒå‡½æ•° barrierActionä½¿ç”¨å•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œè¿™æ ·æœ€åä¸€ä¸ªå†²ç ´å±éšœçš„çº¿ç¨‹å°±ä¸ç”¨ç­‰å¾… barrierAction çš„æ‰§è¡Œï¼Œç›´æ¥åˆ†é…ä¸ªçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œè¿›ä¸€æ­¥æå‡æ•ˆç‡</p><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627204149.png" alt=""></fancybox></p><p>æˆ‘ä»¬å†å½¢è±¡åŒ–çš„çœ‹ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200627205306.png" alt=""></fancybox></p><p>è¿™é‡Œä½¿ç”¨äº†å•ä¸€çº¿ç¨‹æ± ï¼Œå¢åŠ äº†å¹¶è¡Œæ“ä½œï¼Œæé«˜äº†ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œé‚£é—®é¢˜æ¥äº†ï¼š</p><blockquote><p>å¦‚æœ barrierAction éå¸¸éå¸¸è€—æ—¶ï¼Œå†²ç ´å±éšœçš„ä»»åŠ¡å°±å¯èƒ½å †ç§¯åœ¨å•ä¸€çº¿ç¨‹æ± çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå°±å­˜åœ¨ OOM çš„é£é™©ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p></blockquote><p>è¿™æ˜¯å°±è¦éœ€è¦ä¸€å®šçš„é™æµç­–ç•¥æˆ–è€…ä½¿ç”¨çº¿ç¨‹æ± çš„æ‹’ç»çš„ç•¥ç­‰</p><blockquote><p>é‚£æŠŠå•ä¸€çº¿ç¨‹æ± æ¢æˆéå•ä¸€çš„å›ºå®šçº¿ç¨‹æ± ä¸å°±å¯ä»¥äº†å˜›ï¼Ÿæ¯”å¦‚ fixed(5)</p></blockquote><p>ä¹ä¸€çœ‹ç¡®å®èƒ½ç¼“è§£å•çº¿ç¨‹æ± å¯èƒ½å¼•èµ·çš„ä»»åŠ¡å †ç§¯é—®é¢˜ï¼Œä¸Šé¢ä»£ç æˆ‘ä»¬çœ‹åˆ°çš„ gather() æ–¹æ³•ï¼Œå‡å¦‚è¯¥æ–¹æ³•å†…éƒ¨æ²¡æœ‰ä½¿ç”¨é”æˆ–è€…è¯´å­˜åœ¨ç«Ÿæ€æ¡ä»¶ï¼Œé‚£ CyclicBarrier çš„å›è°ƒå‡½æ•° barrierAction ä½¿ç”¨å¤šçº¿ç¨‹å¿…å®šå¼•èµ·ç»“æœçš„ä¸å‡†ç¡®</p><p>æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ä¸­è¿˜è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡åœºæ™¯ä¸æ–­ä¼˜åŒ–ä»£ç ï¼Œä½¿ä¹‹æ›´åŠ å¥å£®</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è®²è§£äº† CountDownLatch å’Œ CyclicBarrier çš„ç»å…¸ä½¿ç”¨åœºæ™¯ä»¥åŠå®ç°åŸç†ï¼Œä»¥åŠåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œæ¯”å¦‚å°†å¤§çš„ list æ‹†åˆ†ä½œä¸šå°±å¯ä»¥ç”¨åˆ°å‰è€…ï¼Œè¯»å–å¤šä¸ª Excel çš„sheet é¡µï¼Œæœ€åè¿›è¡Œç»“æœæ±‡æ€»å°±å¯ä»¥ç”¨åˆ°åè€… ï¼ˆæ–‡ä¸­å®Œæ•´ç¤ºä¾‹ä»£ç å·²ä¸Šä¼ ï¼‰</p><p>æœ€åï¼Œå†å½¢è±¡åŒ–çš„æ¯”å–»ä¸€ä¸‹</p><ul><li><strong>CountDownLatch ä¸»è¦ç”¨æ¥è§£å†³ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„åœºæ™¯ï¼Œå¯ä»¥ç±»æ¯”æ—…æ¸¸å›¢å›¢é•¿è¦ç­‰å¾…æ‰€æœ‰æ¸¸å®¢åˆ°é½æ‰èƒ½å»ä¸‹ä¸€ä¸ªæ™¯ç‚¹</strong></li><li><strong>è€Œ CyclicBarrier æ˜¯ä¸€ç»„çº¿ç¨‹ä¹‹é—´çš„ç›¸äº’ç­‰å¾…ï¼Œå¯ä»¥ç±»æ¯”å‡ ä¸ªé©´å‹ä¹‹é—´çš„ä¸ç¦»ä¸å¼ƒï¼Œå…±åŒåˆ°è¾¾æŸä¸ªåœ°æ–¹ï¼Œå†ç»§ç»­å‡ºå‘ï¼Œè¿™æ ·åå¤</strong></li></ul><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>æ€æ ·æ‹¿åˆ° CyclicBarrier çš„æ±‡æ€»ç»“æœå‘¢ï¼Ÿ</li><li>çº¿ç¨‹æ± ä¸­çš„ Future ç‰¹æ€§ä½ æœ‰ä½¿ç”¨è¿‡å—ï¼Ÿ</li></ol><p>æ¥ä¸‹æ¥ï¼Œå’±ä»¬å°±èŠèŠé‚£äº›å¯ä»¥ä½¿ç”¨çš„ Future ç‰¹æ€§</p><p>å‚è€ƒ</p><ol><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾</li><li><a href="https://stackoverflow.com/questions/24104642/when-to-reset-cyclicbarrier-in-java-multithreading#:~:text=CyclicBarriers%20are%20useful%20in%20programs,the%20waiting%20threads%20are%20released." target="_blank" rel="noopener">When to reset CyclicBarrier in java multithreading</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Github UI å¸ƒå±€è®¾è®¡æ›´æ–°äº†ï¼Œä½ å‘ç°äº†å—ï¼Ÿ</title>
      <link href="//p/github-new-ui.html"/>
      <url>//p/github-new-ui.html</url>
      
        <content type="html"><![CDATA[<p>è¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹å›¾ï¼Œä½ ä¸€çœ¼åº”è¯¥å°±èƒ½çœ‹å‡ºå˜åŒ–äº†</p><p><img src="https://rgyb.sunluomeng.top/20200624145748.png" alt=""></p><p>Github ä¸»è¦å¯¹ UI è®¾è®¡ä»¥åŠ Repository å¸ƒå±€è¿›è¡Œäº†æ›´æ–°ï¼Œæ”¹å–„äº†è®¿é—®å’Œç»´æŠ¤ Repository çš„ä½“éªŒï¼Œå…¶å®ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹æ›´æ–°ï¼š</p><ol><li>å“åº”å¼çš„å¸ƒå±€ä»¥åŠæ”¹è¿›äº†ç§»åŠ¨ç«¯ Web çš„ä½“éªŒ</li><li>é€šè¿‡ Repository ä¾§è¾¹æ æ˜¾ç¤ºæ›´å¤šå†…å®¹</li><li>èƒ½å¤Ÿåœ¨ Repository ä¾§è¾¹æ ç°å®/éšè— Release ç‰ˆæœ¬ä»¥åŠ Packages å’Œ Environments</li></ol><p><img src="https://rgyb.sunluomeng.top/20200624152458.png" alt=""></p><p>ç›®å‰æ•´ä½“æ”¹åŠ¨è™½ç„¶ä¸å¤§ï¼Œä½†è¿™äº›æ›´æ”¹ä¼šä¸ºå°†æ¥çš„æ¸è¿›å¼æ”¹è¿›å¥ å®šåŸºç¡€ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¼šæ¨å‡ºæš—é»‘æ¨¡å¼ç­‰å†…å®¹</p><hr><p>é¡ºä¾¿è¦è¯´ä¸€ä¸‹ï¼Œæµè§ˆ Github å¿…é¡»è¦æœ‰çš„ç¥å™¨ <strong>Octotree</strong> ï¼ˆä¸€æ¬¾ Chrome æ’ä»¶ <a href="https://www.octotree.io/" target="_blank" rel="noopener">https://www.octotree.io/</a> ï¼‰ï¼Œé€šè¿‡è¯¥æ’ä»¶å¯ä»¥å¿«é€Ÿæµè§ˆæŸä¸ª Repository çš„ç»“æ„ä»¥åŠåšåˆ°å¿«é€Ÿè·³è½¬ï¼Œè¯¥æ’ä»¶åŒæ ·æ”¯æŒæš—é»‘æ¨¡å¼</p><p><img src="https://rgyb.sunluomeng.top/1c8e9ec.gif" alt=""></p><p>å¸¦ç€è¿™ä¸ªæ’ä»¶å»ä½“éªŒä¸€ä¸‹æ–°ç‰ˆ Github å§</p><blockquote><p>å®˜åšï¼š<a href="https://github.blog/changelog/2020-06-23-design-updates-to-repositories-and-github-ui/" target="_blank" rel="noopener">https://github.blog/changelog/2020-06-23-design-updates-to-repositories-and-github-ui/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æå®šReentrantReadWriteLock å‡ é“å°å°æ•°å­¦é¢˜å°±å¤Ÿäº†</title>
      <link href="//p/java-reentrant-read-write-lock.html"/>
      <url>//p/java-reentrant-read-write-lock.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://rgyb.sunluomeng.top/20200621190111.png" alt=""></fancybox></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>æ–‡ç«  <a href="https://dayarch.top/p/java-aqs-and-reentrantlock.html">Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨</a> ä»‹ç»äº†AQS<strong>ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€</strong>çš„å®ç°ï¼Œå¹¶ä»¥ ReentrantLock ä¸ºä¾‹è¯´æ˜å…¶æ˜¯å¦‚ä½•è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°äº’æ–¥é”çš„</li><li>æ–‡ç«  <a href="https://dayarch.top/p/java-aqs-acquireshared-and-semaphore.html">Java AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€åŠSemaphoreçš„åº”ç”¨åˆ†æ</a> ä»‹ç» AQS <strong>å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</strong>çš„å®ç°ï¼Œå¹¶è¯´æ˜äº† Semaphore æ˜¯å¦‚ä½•è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°ç®€å•é™æµä½œç”¨çš„</li></ul><p>æœ‰äº†ä»¥ä¸Šä¸¤ç¯‡æ–‡ç« çš„é“ºå«ï¼Œæ¥ç†è§£æœ¬æ–‡è¦ä»‹ç»çš„æ—¢æœ‰ç‹¬å å¼ï¼Œåˆæœ‰å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„ <code>ReadWriteLock</code>ï¼Œå°±éå¸¸è½»æ¾äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621153338.png" alt=""></fancybox></p><h2 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h2><p><code>ReadWriteLock</code> ç›´è¯‘è¿‡æ¥ä¸ºã€è¯»å†™é”ã€‘ã€‚ç°å®ä¸­ï¼Œè¯»å¤šå†™å°‘çš„ä¸šåŠ¡åœºæ™¯æ˜¯éå¸¸æ™®éçš„ï¼Œæ¯”å¦‚åº”ç”¨ç¼“å­˜</p><blockquote><p> ä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®å†™å…¥ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç›´æ¥è¯»å–ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œæé«˜æ•°æ®æŸ¥è¯¢æ•ˆç‡</p></blockquote><p>ä¹‹å‰æåˆ°çš„äº’æ–¥é”éƒ½æ˜¯æ’ä»–é”ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè®¿é—®ï¼Œå½“é¢å¯¹å¯å…±äº«è¯»çš„ä¸šåŠ¡åœºæ™¯ï¼Œäº’æ–¥é”æ˜¾ç„¶æ˜¯æ¯”è¾ƒä½æ•ˆçš„ä¸€ç§å¤„ç†æ–¹å¼ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¯»å†™é”æ¨¡å‹å°±è¯ç”Ÿäº†</p><p>æ•ˆç‡æå‡æ˜¯ä¸€æ–¹é¢ï¼Œä½†å¹¶å‘ç¼–ç¨‹æ›´é‡è¦çš„æ˜¯åœ¨ä¿è¯å‡†ç¡®æ€§çš„å‰æä¸‹æé«˜æ•ˆç‡</p><blockquote><p>ä¸€ä¸ªå†™çº¿ç¨‹æ”¹å˜äº†ç¼“å­˜ä¸­çš„å€¼ï¼Œå…¶ä»–è¯»çº¿ç¨‹ä¸€å®šæ˜¯å¯ä»¥ <strong>â€œæ„ŸçŸ¥â€</strong> åˆ°çš„ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æŸ¥è¯¢åˆ°çš„å€¼ä¸å‡†ç¡®</p></blockquote><p>æ‰€ä»¥å…³äºè¯»å†™é”æ¨¡å‹å°±äº†ä¸‹é¢è¿™ 3 æ¡è§„å®šï¼š</p><ol><li>å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡</li><li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…±äº«å˜é‡</li><li>å¦‚æœå†™çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå†™æ“ä½œï¼Œæ­¤æ—¶åˆ™ç¦æ­¢å…¶ä»–è¯»çº¿ç¨‹è¯»å…±äº«å˜é‡</li></ol><p><code>ReadWriteLock</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å†…éƒ¨åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ReadWriteLock</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›ç”¨äºè¯»çš„é”</span></span><br><span class="line">    <span class="function">Lock <span class="title">readLock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç”¨äºå†™çš„é”</span></span><br><span class="line">    <span class="function">Lock <span class="title">writeLock</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¦äº†è§£æ•´ä¸ªè¯»/å†™é”çš„æ•´ä¸ªåº”ç”¨è¿‡ç¨‹ï¼Œéœ€è¦ä»å®ƒçš„å®ç°ç±» <code>ReentrantReadWriteLock</code> è¯´èµ·</p><h3 id="ReentrantReadWriteLock-ç±»ç»“æ„"><a href="#ReentrantReadWriteLock-ç±»ç»“æ„" class="headerlink" title="ReentrantReadWriteLock ç±»ç»“æ„"></a>ReentrantReadWriteLock ç±»ç»“æ„</h3><p>ç›´æ¥å¯¹æ¯”ReentrantReadWriteLock ä¸ ReentrantLockçš„ç±»ç»“æ„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621160819.png" alt=""></fancybox></p><p>ä»–ä»¬åˆå¾ˆç›¸ä¼¼å§ï¼Œæ ¹æ®ç±»åç§°ä»¥åŠç±»ç»“æ„ï¼ŒæŒ‰ç…§å’±ä»¬å‰åºæ–‡ç« çš„åˆ†æï¼Œä½ ä¹Ÿå°±èƒ½çœ‹å‡º ReentrantReadWriteLock çš„åŸºæœ¬ç‰¹æ€§ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621161359.png" alt=""></fancybox></p><p>å…¶ä¸­é»„é¢œè‰²æ ‡è®°çš„çš„ <strong>é”é™çº§</strong> æ˜¯çœ‹ä¸å‡ºæ¥çš„ï¼Œ è¿™é‡Œå…ˆæœ‰ä¸ªå°è±¡ï¼Œä¸‹é¢ä¼šå•ç‹¬è¯´æ˜</p><p>å¦å¤–ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾—ï¼Œ<a href="https://dayarch.top/p/java-aqs-and-reentrantlock.html">Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨</a> è¯´è¿‡ï¼ŒLock å’Œ AQS åŒæ­¥å™¨æ˜¯ä¸€ç§ç»„åˆå½¢å¼çš„å­˜åœ¨ï¼Œæ—¢ç„¶è¿™é‡Œæ˜¯è¯»/å†™ä¸¤ç§é”ï¼Œä»–ä»¬çš„ç»„åˆæ¨¡å¼ä¹Ÿå°±åˆ†æˆäº†ä¸¤ç§ï¼š</p><ol><li>è¯»é”ä¸è‡ªå®šä¹‰åŒæ­¥å™¨çš„èšåˆ</li><li>å†™é”ä¸è‡ªå®šä¹‰åŒæ­¥å™¨çš„èšåˆ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReentrantReadWriteLock</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>&#123;</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> FairSync() : <span class="keyword">new</span> NonfairSync();</span><br><span class="line">    readerLock = <span class="keyword">new</span> ReadLock(<span class="keyword">this</span>);</span><br><span class="line">    writerLock = <span class="keyword">new</span> WriteLock(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621155924.png" alt=""></fancybox></p><p>è¿™é‡Œåªæ˜¯æé†’å¤§å®¶ï¼Œæ¨¡å¼æ²¡æœ‰å˜ï¼Œä¸è¦è¢«è¯»/å†™ä¸¤ç§é”è¿·æƒ‘</p><h4 id="åŸºæœ¬ç¤ºä¾‹"><a href="#åŸºæœ¬ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ç¤ºä¾‹"></a>åŸºæœ¬ç¤ºä¾‹</h4><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå¦‚æœä½ å¿˜äº†å‰åºçŸ¥è¯†ï¼Œæ•´ä½“ç†è§£æ„Ÿè§‰åº”è¯¥æ˜¯æœ‰æ–­æ¡£çš„ï¼Œæ‰€ä»¥å…ˆæ¥çœ‹ä¸ªç¤ºä¾‹ï¼ˆæ¨¡æ‹Ÿä½¿ç”¨ç¼“å­˜ï¼‰è®©å¤§å®¶å¯¹ ReentrantReadWriteLock æœ‰ä¸ªç›´è§‚çš„ä½¿ç”¨å°è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantReadWriteLockCache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„ HashMap ç”¨äºç¼“å­˜å¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"><span class="comment">// åˆ›å»ºè¯»å†™é”å¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> ReadWriteLock readWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"><span class="comment">// æ„å»ºè¯»é”</span></span><br><span class="line"><span class="keyword">static</span> Lock rl = readWriteLock.readLock();</span><br><span class="line"><span class="comment">// æ„å»ºå†™é”</span></span><br><span class="line"><span class="keyword">static</span> Lock wl = readWriteLock.writeLock();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">rl.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="keyword">return</span> map.get(key);</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">rl.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object <span class="title">put</span><span class="params">(String key, Object value)</span></span>&#123;</span><br><span class="line">wl.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="keyword">return</span> map.put(key, value);</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">wl.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ç§ï¼Œä½¿ç”¨å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ä½†æ˜¯ä½ çŸ¥é“çš„ï¼ŒAQS çš„æ ¸å¿ƒæ˜¯é”çš„å®ç°ï¼Œå³æ§åˆ¶åŒæ­¥çŠ¶æ€ state çš„å€¼ï¼ŒReentrantReadWriteLock ä¹Ÿæ˜¯åº”ç”¨AQSçš„ state æ¥æ§åˆ¶åŒæ­¥çŠ¶æ€çš„ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><blockquote><p>ä¸€ä¸ª int ç±»å‹çš„ state æ€ä¹ˆæ—¢æ§åˆ¶è¯»çš„åŒæ­¥çŠ¶æ€ï¼Œåˆå¯ä»¥æ§åˆ¶å†™çš„åŒæ­¥çŠ¶æ€å‘¢ï¼Ÿ</p></blockquote><p>æ˜¾ç„¶éœ€è¦ä¸€ç‚¹è®¾è®¡äº†</p><h3 id="è¯»å†™çŠ¶æ€è®¾è®¡"><a href="#è¯»å†™çŠ¶æ€è®¾è®¡" class="headerlink" title="è¯»å†™çŠ¶æ€è®¾è®¡"></a>è¯»å†™çŠ¶æ€è®¾è®¡</h3><p>å¦‚æœè¦åœ¨ä¸€ä¸ª int ç±»å‹å˜é‡ä¸Šç»´æŠ¤å¤šä¸ªçŠ¶æ€ï¼Œé‚£è‚¯å®šå°±éœ€è¦æ‹†åˆ†äº†ã€‚æˆ‘ä»¬çŸ¥é“ int ç±»å‹æ•°æ®å 32ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æœ‰æœºä¼šæŒ‰ä½åˆ‡å‰²ä½¿ç”¨stateäº†ã€‚æˆ‘ä»¬å°†å…¶åˆ‡å‰²æˆä¸¤éƒ¨åˆ†ï¼š</p><ol><li>é«˜16ä½è¡¨ç¤ºè¯»</li><li>ä½16ä½è¡¨ç¤ºå†™</li></ol><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621133150.png" alt=""></fancybox></p><p>æ‰€ä»¥ï¼Œè¦æƒ³å‡†ç¡®çš„è®¡ç®—è¯»/å†™å„è‡ªçš„çŠ¶æ€å€¼ï¼Œè‚¯å®šå°±è¦åº”ç”¨ä½è¿ç®—äº†ï¼Œä¸‹é¢ä»£ç æ˜¯ JDK1.8ï¼ŒReentrantReadWriteLock è‡ªå®šä¹‰åŒæ­¥å™¨ Sync çš„ä½æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHARED_SHIFT   = <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHARED_UNIT    = (<span class="number">1</span> &lt;&lt; SHARED_SHIFT);</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_COUNT      = (<span class="number">1</span> &lt;&lt; SHARED_SHIFT) - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXCLUSIVE_MASK = (<span class="number">1</span> &lt;&lt; SHARED_SHIFT) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sharedCount</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123; </span><br><span class="line">          <span class="keyword">return</span> c &gt;&gt;&gt; SHARED_SHIFT; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">exclusiveCount</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123; </span><br><span class="line">          <span class="keyword">return</span> c &amp; EXCLUSIVE_MASK; </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹çœŸæ˜¯æœ‰äº›å¤æ‚çš„å¯æ€•ï¼Œåˆ«æ…Œï¼Œå’±ä»¬é€šè¿‡å‡ é“å°å°æ•°å­¦é¢˜å°±å¯ä»¥æå®šæ•´ä¸ªä½è¿ç®—è¿‡ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621140715.png" alt=""></fancybox></p><p>æ•´ä¸ª ReentrantReadWriteLock ä¸­ è¯»/å†™çŠ¶æ€çš„è®¡ç®—å°±æ˜¯åå¤åº”ç”¨è¿™å‡ é“æ•°å­¦é¢˜ï¼Œæ‰€ä»¥ï¼Œåœ¨é˜…è¯»ä¸‹é¢å†…å®¹ä¹‹å‰ï¼Œå¸Œæœ›ä½ ææ‡‚è¿™ç®€å•çš„è¿ç®—</p><p>åŸºç¡€é“ºå«è¶³å¤Ÿäº†ï¼Œæˆ‘ä»¬è¿›å…¥æºç åˆ†æå§</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><h4 id="å†™é”åˆ†æ"><a href="#å†™é”åˆ†æ" class="headerlink" title="å†™é”åˆ†æ"></a>å†™é”åˆ†æ</h4><p>ç”±äºå†™é”æ˜¯æ’ä»–çš„ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯è¦é‡å†™ AQS ä¸­ <code>tryAcquire</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;        </span><br><span class="line">    Thread current = Thread.currentThread();</span><br><span class="line">  <span class="comment">// è·å– state æ•´ä½“çš„å€¼</span></span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="comment">// è·å–å†™çŠ¶æ€çš„å€¼</span></span><br><span class="line">    <span class="keyword">int</span> w = exclusiveCount(c);</span><br><span class="line">    <span class="keyword">if</span> (c != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// w=0: æ ¹æ®æ¨ç†äºŒï¼Œæ•´ä½“çŠ¶æ€ä¸ç­‰äºé›¶ï¼Œå†™çŠ¶æ€ç­‰äºé›¶ï¼Œæ‰€ä»¥ï¼Œè¯»çŠ¶æ€å¤§äº0ï¼Œå³å­˜åœ¨è¯»é”</span></span><br><span class="line">      <span class="comment">// æˆ–è€…å½“å‰çº¿ç¨‹ä¸æ˜¯å·²è·å–å†™é”çš„çº¿ç¨‹</span></span><br><span class="line">      <span class="comment">// äºŒè€…ä¹‹ä¸€æ¡ä»¶æˆçœŸï¼Œåˆ™è·å–å†™çŠ¶æ€å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (w == <span class="number">0</span> || current != getExclusiveOwnerThread())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (w + exclusiveCount(acquires) &gt; MAX_COUNT)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">        <span class="comment">// æ ¹æ®æ¨ç†ä¸€ç¬¬ 1 æ¡ï¼Œæ›´æ–°å†™çŠ¶æ€å€¼</span></span><br><span class="line">        setState(c + acquires);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (writerShouldBlock() ||</span><br><span class="line">        !compareAndSetState(c, c + acquires))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    setExclusiveOwnerThread(current);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç  ç¬¬ 19 è¡Œ writerShouldBlock ä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆç¥ç§˜çš„ï¼Œåªä¸è¿‡æ˜¯å…¬å¹³/éå…¬å¹³è·å–é”æ–¹å¼çš„åˆ¤æ–­ï¼ˆæ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹æ¥åˆ¤æ–­ï¼‰</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621144015.png" alt=""></fancybox></p><p>ä½ ç§ï¼Œå†™é”è·å–æ–¹å¼å°±æ˜¯è¿™ä¹ˆç®€å•</p><h4 id="è¯»é”åˆ†æ"><a href="#è¯»é”åˆ†æ" class="headerlink" title="è¯»é”åˆ†æ"></a>è¯»é”åˆ†æ</h4><p>ç”±äºè¯»é”æ˜¯å…±äº«å¼çš„ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯è¦é‡å†™ AQS ä¸­ <code>tryAcquireShared</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>&#123;</span><br><span class="line">    Thread current = Thread.currentThread();</span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">  <span class="comment">// å†™çŠ¶æ€ä¸ç­‰äº0ï¼Œå¹¶ä¸”é”çš„æŒæœ‰è€…ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œæ ¹æ®çº¦å®š 3ï¼Œåˆ™è·å–è¯»é”å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (exclusiveCount(c) != <span class="number">0</span> &amp;&amp;</span><br><span class="line">        getExclusiveOwnerThread() != current)</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="comment">// è·å–è¯»çŠ¶æ€å€¼</span></span><br><span class="line">    <span class="keyword">int</span> r = sharedCount(c);</span><br><span class="line">  <span class="comment">// è¿™ä¸ªåœ°æ–¹æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å•ç‹¬è¯´æ˜</span></span><br><span class="line">    <span class="keyword">if</span> (!readerShouldBlock() &amp;&amp;</span><br><span class="line">        r &lt; MAX_COUNT &amp;&amp;</span><br><span class="line">        compareAndSetState(c, c + SHARED_UNIT)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="number">0</span>) &#123;</span><br><span class="line">            firstReader = current;</span><br><span class="line">            firstReaderHoldCount = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstReader == current) &#123;</span><br><span class="line">            firstReaderHoldCount++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            HoldCounter rh = cachedHoldCounter;</span><br><span class="line">            <span class="keyword">if</span> (rh == <span class="keyword">null</span> || rh.tid != getThreadId(current))</span><br><span class="line">                cachedHoldCounter = rh = readHolds.get();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (rh.count == <span class="number">0</span>)</span><br><span class="line">                readHolds.set(rh);</span><br><span class="line">            rh.count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœè·å–è¯»é”å¤±è´¥åˆ™è¿›å…¥è‡ªæ—‹è·å–</span></span><br><span class="line">    <span class="keyword">return</span> fullTryAcquireShared(current);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>readerShouldBlock</code> å’Œ <code>writerShouldBlock</code> åœ¨å…¬å¹³é”çš„å®ç°ä¸Šéƒ½æ˜¯åˆ¤æ–­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹ï¼Œä½†æ˜¯åœ¨éå…¬å¹³é”çš„å®ç°ä¸Šï¼Œå‰è€…æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">readerShouldBlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> apparentlyFirstQueuedIsExclusive();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">apparentlyFirstQueuedIsExclusive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Node h, s;</span><br><span class="line">  <span class="keyword">return</span> (h = head) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">    <span class="comment">// ç­‰å¾…é˜Ÿåˆ—å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    (s = h.next)  != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯æ’ä»–å¼çš„èŠ‚ç‚¹</span></span><br><span class="line">    !s.isShared()         &amp;&amp;</span><br><span class="line">    s.thread != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œå¦‚æœè¯·æ±‚è¯»é”çš„å½“å‰çº¿ç¨‹å‘ç°åŒæ­¥é˜Ÿåˆ—çš„ head èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºæ’ä»–å¼èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±è¯´æ˜æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…è·å–å†™é”ï¼ˆäº‰æŠ¢å†™é”å¤±è´¥ï¼Œè¢«æ”¾å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼‰ï¼Œé‚£ä¹ˆè¯·æ±‚è¯»é”çš„çº¿ç¨‹å°±è¦é˜»å¡ï¼Œæ¯•ç«Ÿè¯»å¤šå†™å°‘ï¼Œå¦‚æœè¿˜æ²¡æœ‰è¿™ç‚¹åˆ¤æ–­æœºåˆ¶ï¼Œå†™é”å¯èƒ½ä¼šå‘ç”Ÿã€é¥¥é¥¿ã€‘</p><blockquote><p>ä¸Šè¿°æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œä¹Ÿå°±ä¼šè¿›å…¥  <code>tryAcquireShared</code> ä»£ç çš„ç¬¬ 14 è¡Œåˆ°ç¬¬ 25 è¡Œï¼Œè¿™æ®µä»£ç ä¸»è¦æ˜¯ä¸ºäº†è®°å½•çº¿ç¨‹æŒæœ‰é”çš„æ¬¡æ•°ã€‚è¯»é”æ˜¯å…±äº«å¼çš„ï¼Œè¿˜æƒ³è®°å½•æ¯ä¸ªçº¿ç¨‹æŒæœ‰è¯»é”çš„æ¬¡æ•°ï¼Œå°±è¦ç”¨åˆ° ThreadLocal äº†ï¼Œå› ä¸ºè¿™ä¸å½±å“åŒæ­¥çŠ¶æ€ state çš„å€¼ï¼Œæ‰€ä»¥å°±ä¸åˆ†æäº†, åªæŠŠå…³ç³»æ”¾åœ¨è¿™å§</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621165753.png" alt=""></fancybox></p><p>åˆ°è¿™é‡Œè¯»é”çš„è·å–ä¹Ÿå°±ç»“æŸäº†ï¼Œæ¯”å†™é”ç¨ç¨å¤æ‚é‚£ä¹ˆä¸€ä¸¢ä¸¢ï¼Œæ¥ä¸‹æ¥å°±è¯´æ˜ä¸€ä¸‹é‚£ä¸ªå¯èƒ½è®©ä½ è¿·æƒ‘çš„é”å‡çº§/é™çº§é—®é¢˜å§</p><h2 id="è¯»å†™é”çš„å‡çº§ä¸é™çº§"><a href="#è¯»å†™é”çš„å‡çº§ä¸é™çº§" class="headerlink" title="è¯»å†™é”çš„å‡çº§ä¸é™çº§"></a>è¯»å†™é”çš„å‡çº§ä¸é™çº§</h2><p><strong>ä¸ªäººç†è§£ï¼š</strong>è¯»é”æ˜¯å¯ä»¥è¢«å¤šçº¿ç¨‹å…±äº«çš„ï¼Œå†™é”æ˜¯å•çº¿ç¨‹ç‹¬å çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å†™é”çš„å¹¶å‘é™åˆ¶æ¯”è¯»é”é«˜ï¼Œæ‰€ä»¥</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621173215.png" alt=""></fancybox></p><p>åœ¨çœŸæ­£äº†è§£è¯»å†™é”çš„å‡çº§ä¸é™çº§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®Œå–„ä¸€ä¸‹æœ¬æ–‡å¼€å¤´ ReentrantReadWriteLock çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">Object obj = <span class="keyword">null</span>;</span><br><span class="line">rl.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">     <span class="comment">// è·å–ç¼“å­˜ä¸­çš„å€¼</span></span><br><span class="line">obj = map.get(key);</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">rl.unlock();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¼“å­˜ä¸­å€¼ä¸ä¸ºç©ºï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">if</span> (obj!= <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ç¼“å­˜ä¸­å€¼ä¸ºç©ºï¼Œåˆ™é€šè¿‡å†™é”æŸ¥è¯¢DBï¼Œå¹¶å°†å…¶å†™å…¥åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line">wl.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">     <span class="comment">// å†æ¬¡å°è¯•è·å–ç¼“å­˜ä¸­çš„å€¼</span></span><br><span class="line">obj = map.get(key);</span><br><span class="line">     <span class="comment">// å†æ¬¡è·å–ç¼“å­˜ä¸­å€¼è¿˜æ˜¯ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="comment">// æŸ¥è¯¢DB</span></span><br><span class="line">obj = getDataFromDB(key); <span class="comment">// ä¼ªä»£ç ï¼šgetDataFromDB</span></span><br><span class="line">       <span class="comment">// å°†å…¶æ”¾å…¥åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line">map.put(key, obj);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">wl.unlock();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ç«¥é‹å¯èƒ½ä¼šæœ‰ç–‘é—®</p><blockquote><p>åœ¨å†™é”é‡Œé¢ï¼Œä¸ºä»€ä¹ˆä»£ç ç¬¬19è¡Œè¿˜è¦å†æ¬¡è·å–ç¼“å­˜ä¸­çš„å€¼å‘¢ï¼Ÿä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿ</p></blockquote><p>å…¶å®è¿™é‡Œå†æ¬¡å°è¯•è·å–ç¼“å­˜ä¸­çš„å€¼æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ get æ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•° key ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œæ‰§è¡Œåˆ°ä»£ç ç¬¬ 16 è¡Œ <code>wl.lock()</code> ,æ¯”å¦‚è¿™æ ·ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200621174450.png" alt=""></fancybox></p><p>çº¿ç¨‹ Aï¼ŒBï¼ŒC åŒæ—¶æ‰§è¡Œåˆ°ä¸´ç•ŒåŒº wl.lock()ï¼Œ åªæœ‰çº¿ç¨‹ A è·å–å†™é”æˆåŠŸï¼Œçº¿ç¨‹Bï¼ŒCåªèƒ½é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹A é‡Šæ”¾å†™é”ã€‚è¿™æ—¶ï¼Œå½“çº¿ç¨‹B æˆ–è€… C å†æ¬¡è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œçº¿ç¨‹ A å·²ç»å°†å€¼æ›´æ–°åˆ°ç¼“å­˜ä¸­äº†ï¼Œæ‰€ä»¥çº¿ç¨‹Bï¼ŒCæ²¡å¿…è¦å†æŸ¥è¯¢ä¸€æ¬¡DBï¼Œè€Œæ˜¯å†æ¬¡å°è¯•æŸ¥è¯¢ç¼“å­˜ä¸­çš„å€¼</p><p>æ—¢ç„¶å†æ¬¡è·å–ç¼“å­˜å¾ˆæœ‰å¿…è¦ï¼Œæˆ‘èƒ½å¦åœ¨è¯»é”é‡Œç›´æ¥åˆ¤æ–­ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å€¼ï¼Œé‚£å°±å†æ¬¡è·å–å†™é”æ¥æŸ¥è¯¢DBä¸å°±å¯ä»¥äº†å˜›ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object <span class="title">getLockUpgrade</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">Object obj = <span class="keyword">null</span>;</span><br><span class="line">rl.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">obj = map.get(key);</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="keyword">null</span>)&#123;</span><br><span class="line">wl.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">obj = map.get(key);</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">obj = getDataFromDB(key); <span class="comment">// ä¼ªä»£ç ï¼šgetDataFromDB</span></span><br><span class="line">map.put(key, obj);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">wl.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">rl.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™è¿˜çœŸæ˜¯ä¸å¯ä»¥çš„ï¼Œå› ä¸ºè·å–ä¸€ä¸ªå†™å…¥é”éœ€è¦å…ˆé‡Šæ”¾æ‰€æœ‰çš„è¯»å–é”ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªè¯»å–é”è¯•å›¾è·å–å†™å…¥é”ï¼Œä¸”éƒ½ä¸é‡Šæ”¾è¯»å–é”æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­»é”ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œé”çš„å‡çº§æ˜¯ä¸è¢«å…è®¸çš„</p><p>è¯»å†™é”çš„å‡çº§æ˜¯ä¸å¯ä»¥çš„ï¼Œé‚£ä¹ˆé”çš„é™çº§æ˜¯å¯ä»¥çš„å˜›ï¼Ÿè¿™ä¸ªæ˜¯ <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html" target="_blank" rel="noopener">Oracle å®˜ç½‘å…³äºé”é™çº§çš„ç¤ºä¾‹</a> ï¼Œæˆ‘å°†ä»£ç ç²˜è´´åœ¨æ­¤å¤„ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥ç‚¹è¿›å»è¿æ¥çœ‹æ›´å¤šå†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CachedData</span> </span>&#123;</span><br><span class="line">  Object data;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">boolean</span> cacheValid;</span><br><span class="line">  <span class="keyword">final</span> ReentrantReadWriteLock rwl = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">processCachedData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rwl.readLock().lock();</span><br><span class="line">    <span class="keyword">if</span> (!cacheValid) &#123;</span><br><span class="line">       <span class="comment">// å¿…é¡»åœ¨è·å–å†™é”ä¹‹å‰é‡Šæ”¾è¯»é”ï¼Œå› ä¸ºé”çš„å‡çº§æ˜¯ä¸è¢«å…è®¸çš„</span></span><br><span class="line">       rwl.readLock().unlock();</span><br><span class="line">       rwl.writeLock().lock();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// å†æ¬¡æ£€æŸ¥ï¼ŒåŸå› å¯èƒ½æ˜¯å…¶ä»–çº¿ç¨‹å·²ç»æ›´æ–°è¿‡ç¼“å­˜</span></span><br><span class="line">         <span class="keyword">if</span> (!cacheValid) &#123;</span><br><span class="line">           data = ...</span><br><span class="line">           cacheValid = <span class="keyword">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line"><span class="comment">//åœ¨é‡Šæ”¾å†™é”å‰ï¼Œé™çº§ä¸ºè¯»é”</span></span><br><span class="line">         rwl.readLock().lock();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">//é‡Šæ”¾å†™é”ï¼Œæ­¤æ—¶æŒæœ‰è¯»é”</span></span><br><span class="line">         rwl.writeLock().unlock(); </span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      use(data);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      rwl.readLock().unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­å£°æ˜äº†ä¸€ä¸ª volatile ç±»å‹çš„ cacheValid å˜é‡ï¼Œä¿è¯å…¶å¯è§æ€§ã€‚</p><ol><li>é¦–å…ˆè·å–è¯»é”ï¼Œå¦‚æœcacheä¸å¯ç”¨ï¼Œåˆ™é‡Šæ”¾è¯»é”</li><li>ç„¶åè·å–å†™é”</li><li>åœ¨æ›´æ”¹æ•°æ®ä¹‹å‰ï¼Œå†æ£€æŸ¥ä¸€æ¬¡cacheValidçš„å€¼ï¼Œç„¶åä¿®æ”¹æ•°æ®ï¼Œå°†cacheValidç½®ä¸ºtrue</li><li>ç„¶ååœ¨<strong>é‡Šæ”¾å†™é”å‰è·å–è¯»é”</strong> æ­¤æ—¶</li><li>cacheä¸­æ•°æ®å¯ç”¨ï¼Œå¤„ç†cacheä¸­æ•°æ®ï¼Œæœ€åé‡Šæ”¾è¯»é”</li></ol><p>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„é”é™çº§çš„è¿‡ç¨‹ï¼Œç›®çš„æ˜¯ä¿è¯æ•°æ®å¯è§æ€§ï¼Œå¬èµ·æ¥å¾ˆæœ‰é“ç†çš„æ ·å­ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><blockquote><p>ä¸Šè¿°ä»£ç ä¸ºä»€ä¹ˆåœ¨é‡Šæ”¾å†™é”ä¹‹å‰è¦è·å–è¯»é”å‘¢ï¼Ÿ</p></blockquote><p>å¦‚æœå½“å‰çš„<strong>çº¿ç¨‹A</strong>åœ¨ä¿®æ”¹å®Œcacheä¸­çš„æ•°æ®åï¼Œæ²¡æœ‰è·å–è¯»é”è€Œæ˜¯ç›´æ¥é‡Šæ”¾äº†å†™é”ï¼›å‡è®¾æ­¤æ—¶å¦ä¸€ä¸ª<strong>çº¿ç¨‹B</strong> è·å–äº†å†™é”å¹¶ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆ<strong>çº¿ç¨‹A</strong>æ— æ³•æ„ŸçŸ¥åˆ°æ•°æ®å·²è¢«ä¿®æ”¹ï¼Œä½†çº¿ç¨‹Aè¿˜åº”ç”¨äº†ç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å°±å¯èƒ½å‡ºç°æ•°æ®é”™è¯¯</p><p>å¦‚æœéµå¾ªé”é™çº§çš„æ­¥éª¤ï¼Œ<strong>çº¿ç¨‹A</strong> åœ¨é‡Šæ”¾å†™é”ä¹‹å‰è·å–è¯»é”ï¼Œé‚£ä¹ˆ<strong>çº¿ç¨‹B</strong>åœ¨è·å–å†™é”æ—¶å°†è¢«é˜»å¡ï¼Œç›´åˆ°<strong>çº¿ç¨‹A</strong>å®Œæˆæ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œé‡Šæ”¾è¯»é”ï¼Œä»è€Œä¿è¯æ•°æ®çš„å¯è§æ€§</p><hr><p>é‚£é—®é¢˜åˆæ¥äº†ï¼š</p><blockquote><p>ä½¿ç”¨å†™é”ä¸€å®šè¦é™çº§å—ï¼Ÿ</p></blockquote><p>å¦‚æœä½ ç†è§£äº†ä¸Šé¢çš„é—®é¢˜ï¼Œç›¸ä¿¡è¿™ä¸ªé—®é¢˜å·²ç»æœ‰äº†ç­”æ¡ˆã€‚å‡å¦‚<strong>çº¿ç¨‹A</strong>ä¿®æ”¹å®Œæ•°æ®ä¹‹åï¼Œ ç»è¿‡è€—æ—¶æ“ä½œåæƒ³è¦å†ä½¿ç”¨æ•°æ®æ—¶ï¼Œå¸Œæœ›ä½¿ç”¨çš„æ˜¯è‡ªå·±ä¿®æ”¹åçš„æ•°æ®ï¼Œè€Œä¸æ˜¯å…¶ä»–çº¿ç¨‹ä¿®æ”¹åçš„æ•°æ®ï¼Œè¿™æ ·çš„è¯ç¡®å®æ˜¯éœ€è¦é”é™çº§ï¼›å¦‚æœåªæ˜¯å¸Œæœ›æœ€åä½¿ç”¨æ•°æ®çš„æ—¶å€™ï¼Œæ‹¿åˆ°çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œè€Œä¸ä¸€å®šæ˜¯è‡ªå·±åˆšä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œé‚£ä¹ˆå…ˆé‡Šæ”¾å†™é”ï¼Œå†è·å–è¯»é”ï¼Œç„¶åä½¿ç”¨æ•°æ®ä¹Ÿæ— å¦¨</p><p>åœ¨è¿™é‡Œæˆ‘è¦é¢å¤–è¯´æ˜ä¸€ä¸‹ä½ å¯èƒ½å­˜åœ¨çš„è¯¯è§£ï¼š</p><ul><li><p>å¦‚æœå·²ç»é‡Šæ”¾äº†è¯»é”å†è·å–å†™é”<strong>ä¸å«</strong>é”çš„å‡çº§</p></li><li><p>å¦‚æœå·²ç»é‡Šæ”¾äº†å†™é”åœ¨è·å–è¯»é”ä¹Ÿ<strong>ä¸å«</strong>é”çš„é™çº§</p></li></ul><p>ç›¸ä¿¡ä½ åˆ°è¿™é‡Œä¹Ÿç†è§£äº†é”çš„å‡çº§ä¸é™çº§è¿‡ç¨‹ï¼Œä»¥åŠä»–ä»¬è¢«å…è®¸æˆ–è¢«ç¦æ­¢çš„åŸå› äº†</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦è¯´æ˜äº† ReentrantReadWriteLock æ˜¯å¦‚ä½•åº”ç”¨ state åšä½æ‹†åˆ†å®ç°è¯»/å†™ä¸¤ç§åŒæ­¥çŠ¶æ€çš„ï¼Œå¦å¤–ä¹Ÿé€šè¿‡æºç åˆ†æäº†è¯»/å†™é”è·å–åŒæ­¥çŠ¶æ€çš„è¿‡ç¨‹ï¼Œæœ€ååˆäº†è§£äº†è¯»å†™é”çš„å‡çº§/é™çº§æœºåˆ¶ï¼Œç›¸ä¿¡åˆ°è¿™é‡Œä½ å¯¹è¯»å†™é”å·²ç»æœ‰äº†ä¸€å®šçš„ç†è§£ã€‚å¦‚æœä½ å¯¹æ–‡ä¸­çš„å“ªäº›åœ°æ–¹è§‰å¾—ç†è§£æœ‰äº›å›°éš¾ï¼Œå¼ºçƒˆå»ºè®®ä½ å›çœ‹æœ¬æ–‡å¼€å¤´çš„ä¸¤ç¯‡æ–‡ç« ï¼Œé‚£é‡Œé“ºå«äº†éå¸¸å¤šçš„å†…å®¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹åœ¨åº”ç”¨AQSçš„æœ€åä¸€ä¸ªå¹¶å‘å·¥å…·ç±» CountDownLatch å§</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>è¯»é”ä¹Ÿæ²¡ä¿®æ”¹æ•°æ®ï¼Œè¿˜å…è®¸å…±äº«å¼è·å–ï¼Œé‚£è¿˜æœ‰å¿…è¦è®¾ç½®è¯»é”å—ï¼Ÿ</li><li>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä½ æ˜¯å¦‚ä½•ä¿è¯ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„å‘¢ï¼Ÿ</li><li>å½“ä½ æ‰“å¼€çœ‹ReentrantReadWriteLockæºç æ—¶ï¼Œä½ ä¼šå‘ç°ï¼ŒWriteLock ä¸­å¯ä»¥ä½¿ç”¨ Conditionï¼Œä½†æ˜¯ReadLock ä½¿ç”¨Conditionå´ä¼šæŠ›å‡ºUnsupportedOperationExceptionï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WriteLock</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sync.newCondition();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadLock</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>Java å¹¶å‘å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="https://www.jianshu.com/p/58697bb2243e" target="_blank" rel="noopener">https://www.jianshu.com/p/58697bb2243e</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€åŠSemaphoreçš„åº”ç”¨åˆ†æ</title>
      <link href="//p/java-aqs-acquireshared-and-semaphore.html"/>
      <url>//p/java-aqs-acquireshared-and-semaphore.html</url>
      
        <content type="html"><![CDATA[<p>ç°é™†ç»­å°†Demoä»£ç å’ŒæŠ€æœ¯æ–‡ç« æ•´ç†åœ¨ä¸€èµ· <a href="https://github.com/FraserYu/learnings" target="_blank" rel="noopener">Githubå®è·µç²¾é€‰</a> ï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»æŸ¥çœ‹ï¼Œæœ¬æ–‡åŒæ ·æ”¶å½•åœ¨æ­¤ï¼Œè§‰å¾—ä¸é”™ï¼Œè¿˜è¯·StarğŸŒŸ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613150348.png" alt=""></fancybox></p><p>çœ‹åˆ°æœ¬æœŸå†…å®¹è¿™ä¹ˆå°‘ï¼Œæ˜¯ä¸æ˜¯å¿ƒåŠ¨äº†å‘¢ï¼Ÿ </p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šä¸€ç¯‡ä¸‡å­—é•¿æ–‡ <a href="https://dayarch.top/p/java-aqs-and-reentrantlock.html">Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨</a> ä¸ºæˆ‘ä»¬è¯» JUC æºç ä»¥åŠå…¶è®¾è®¡æ€æƒ³åšäº†è¶³å¤Ÿå¤šçš„é“ºå«ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹æˆ‘å°†é‡ç‚¹è¯´æ˜å·®å¼‚åŒ–ï¼Œå¦‚æœæœ‰äº›ç«¥é‹ä¸æ˜¯èƒ½å¾ˆå¥½çš„ç†è§£æ–‡ä¸­çš„ä¸€äº›å†…å®¹ï¼Œå¼ºçƒˆå»ºè®®å›çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œææ‡‚åŸºç¡€å†…å®¹ï¼Œæ¥ä¸‹æ¥çš„é˜…è¯»çœŸä¼šè½»æ¾åŠ æ„‰å¿«</p><hr><p>AQS ä¸­æˆ‘ä»¬ä»‹ç»äº†ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„å¤šç§æƒ…å½¢ï¼š</p><ul><li>ç‹¬å å¼è·å–é”</li><li>å¯å“åº”ä¸­æ–­çš„ç‹¬å å¼è·å–é”</li><li>æœ‰è¶…æ—¶é™åˆ¶çš„ç‹¬å å¼è·å–é”</li></ul><p>AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•é‡Œé¢è¿˜å·®å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æ²¡æœ‰ä»‹ç»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»Šå¤©æ¥æ­å¼€è¿™ä¸ªçœ‹ä¼¼ç¥ç§˜çš„é¢çº±</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613150826.png" alt=""></fancybox></p><h2 id="AQS-ä¸­çš„å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€"><a href="#AQS-ä¸­çš„å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€" class="headerlink" title="AQS ä¸­çš„å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€"></a>AQS ä¸­çš„å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</h2><p>ç‹¬å å¼æ˜¯ä½ ä¸­æ²¡æˆ‘ï¼Œæˆ‘ä¸­æ²¡ä½ çš„çš„ä¸€ç§äº’æ–¥å½¢å¼ï¼Œå…±äº«å¼æ˜¾ç„¶å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œæ‰€ä»¥ä»–ä»¬çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼š</p><blockquote><p>åŒä¸€æ—¶åˆ»èƒ½å¦æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€</p></blockquote><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿™æ ·æ»´ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613104401.png" alt=""></fancybox></p><p>æˆ‘ä»¬çŸ¥é“åŒæ­¥çŠ¶æ€ state æ˜¯ç»´æŠ¤åœ¨ AQS ä¸­çš„ï¼ŒæŠ›å¼€å¯é‡å…¥é”çš„æ¦‚å¿µï¼Œæˆ‘åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†ï¼Œç‹¬å å¼å’Œå…±äº«å¼æ§åˆ¶åŒæ­¥çŠ¶æ€ state çš„åŒºåˆ«ä»…ä»…æ˜¯è¿™æ ·ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523160705.png" alt=""></fancybox></p><p>æ‰€ä»¥è¯´æƒ³äº†è§£ AQS çš„ xxxShared çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œåªéœ€è¦çŸ¥é“å®ƒæ˜¯æ€ä¹ˆæ§åˆ¶ state çš„å°±å¥½äº†</p><h3 id="AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æºç åˆ†æ"><a href="#AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æºç åˆ†æ" class="headerlink" title="AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æºç åˆ†æ"></a>AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æºç åˆ†æ</h3><p>ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½çš„å›å¿†å†…å®¹ï¼Œæˆ‘å°†ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸¤ä¸ªå…³é”®å†…å®¹ç²˜è´´åœ¨æ­¤å¤„ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå›å¿†ï¼Œå…³äºå…±äº«å¼ï¼Œå¤§å®¶åªéœ€è¦å…³æ³¨ã€éªšç´«è‰²ã€‘å°±å¯ä»¥äº†</p><h4 id="è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•"><a href="#è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•"></a>è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•</h4><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523160830.png" alt=""></fancybox></p><h4 id="AQS-æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•"><a href="#AQS-æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•" class="headerlink" title="AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•"></a>AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•</h4><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523195957.png" alt=""></fancybox></p><p>æ•…äº‹å°±ä»è¿™é‡Œè¯´èµ·å§ (ä½ ä¼šå‘ç°å’Œç‹¬å å¼æƒŠäººçš„ç›¸ä¼¼)ï¼Œå…³é”®ä»£ç éƒ½åŠ äº†æ³¨é‡Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åŒæ ·è°ƒç”¨è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•ï¼Œéé˜»å¡å¼çš„å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœç»“æœå°äºé›¶ï¼Œåˆ™è·å–åŒæ­¥çŠ¶æ€å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="comment">// è°ƒç”¨ AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">        doAcquireShared(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥ <code>doAcquireShared</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAcquireShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºå…±äº«èŠ‚ç‚¹ã€ŒSHAREDã€ï¼ŒåŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.SHARED);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">      <span class="comment">// è¿›å…¥â€œè‡ªæ—‹â€ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯çº¯ç²¹æ„ä¹‰ä¸Šçš„æ­»å¾ªç¯ï¼Œåœ¨ç‹¬å å¼å·²ç»è¯´æ˜è¿‡</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">          <span class="comment">// åŒæ ·å°è¯•è·å–å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">          <span class="comment">// å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ï¼Œå°è¯•å†æ¬¡è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">if</span> (p == head) &#123;</span><br><span class="line">              <span class="comment">// åœ¨æ­¤ä»¥éé˜»å¡å¼è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">int</span> r = tryAcquireShared(arg);</span><br><span class="line">              <span class="comment">// å¦‚æœè¿”å›ç»“æœå¤§äºç­‰äºé›¶ï¼Œæ‰èƒ½è·³å‡ºå¤–å±‚å¾ªç¯è¿”å›</span></span><br><span class="line">                <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="comment">// è¿™é‡Œæ˜¯å’Œç‹¬å å¼çš„åŒºåˆ«</span></span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    <span class="keyword">if</span> (interrupted)</span><br><span class="line">                        selfInterrupt();</span><br><span class="line">                    failed = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ç¬¬ 18 è¡Œæˆ‘ä»¬æåˆ°å’Œç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„åŒºåˆ«ï¼Œè´´å¿ƒçš„ç»™å¤§å®¶ä¸€ä¸ªæ›´ç›´è§‚çš„å¯¹æ¯”ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613111949.png" alt=""></fancybox></p><p>å·®åˆ«åªåœ¨è¿™é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ <code>setHeadAndPropagate(node, r)</code> åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œæˆ‘ä¹‹å‰è¯´è¿‡ JDK æºç ä¸­çš„æ–¹æ³•å‘½åç»å¤§å¤šæ•°è¿˜æ˜¯éå¸¸ç›´è§‚çš„ï¼Œè¯¥æ–¹æ³•ç›´è¯‘è¿‡æ¥å°±æ˜¯ ã€è®¾ç½®å¤´å¹¶ä¸”ä¼ æ’­/ç¹è¡ã€‘ã€‚ç‹¬å å¼åªæ˜¯è®¾ç½®äº†å¤´ï¼Œå…±äº«å¼é™¤äº†è®¾ç½®å¤´è¿˜å¤šäº†ä¸€ä¸ªä¼ æ’­ï¼Œä½ çš„ç–‘é—®åº”è¯¥å·²ç»æ¥äº†ï¼š</p><blockquote><p>å•¥æ˜¯ä¼ æ’­ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¼ æ’­è¿™ä¸ªè®¾ç½®å‘¢ï¼Ÿ</p></blockquote><p>æƒ³äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦å…ˆçŸ¥é“éé˜»å¡å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€è¿”å›å€¼çš„å«ä¹‰ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613114247.png" alt=""></fancybox></p><p>è¿™é‡Œè¯´çš„ä¼ æ’­å…¶å®è¯´çš„æ˜¯ <code>propagate &gt; 0</code> çš„æƒ…å†µï¼Œé“ç†ä¹Ÿå¾ˆç®€å•ï¼Œå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€æˆåŠŸäº†ï¼Œè¿˜æœ‰å‰©ä½™çš„åŒæ­¥çŠ¶æ€å¯ç”¨äºå…¶ä»–çº¿ç¨‹è·å–ï¼Œ<strong>é‚£å°±è¦é€šçŸ¥åœ¨ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹ï¼Œè®©ä»–ä»¬å°è¯•è·å–å‰©ä½™çš„åŒæ­¥çŠ¶æ€</strong></p><p><strong>å¦‚æœè¦è®©ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹è·å–åˆ°é€šçŸ¥ï¼Œéœ€è¦çº¿ç¨‹è°ƒç”¨ release æ–¹æ³•å®ç°çš„</strong>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬èµ°è¿‘ <code>setHeadAndPropagate</code> ä¸€æ¢ç©¶ç«Ÿï¼ŒéªŒè¯ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// å…¥å‚ï¼Œnodeï¼š å½“å‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// å…¥å‚ï¼Œpropagateï¼šè·å–åŒæ­¥çŠ¶æ€çš„ç»“æœå€¼ï¼Œå³ä¸Šé¢æ–¹æ³•ä¸­çš„å˜é‡ r</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setHeadAndPropagate</span><span class="params">(Node node, <span class="keyword">int</span> propagate)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// è®°å½•æ—§çš„å¤´éƒ¨èŠ‚ç‚¹ï¼Œç”¨äºä¸‹é¢çš„check</span></span><br><span class="line">       Node h = head; </span><br><span class="line">   <span class="comment">// å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">       setHead(node);</span><br><span class="line">       </span><br><span class="line">   <span class="comment">// é€šè¿‡ propagate çš„å€¼å’Œ waitStatus çš„å€¼æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è°ƒç”¨ doReleaseShared æ–¹æ³•</span></span><br><span class="line">       <span class="keyword">if</span> (propagate &gt; <span class="number">0</span> || h == <span class="keyword">null</span> || h.waitStatus &lt; <span class="number">0</span> ||</span><br><span class="line">           (h = head) == <span class="keyword">null</span> || h.waitStatus &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           Node s = node.next;</span><br><span class="line">         <span class="comment">// å¦‚æœåç»§èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…åç»§èŠ‚ç‚¹ä¸ºå…±äº«ç±»å‹ï¼Œåˆ™è¿›è¡Œå”¤é†’åç»§èŠ‚ç‚¹</span></span><br><span class="line">   <span class="comment">// è¿™é‡Œåç»§èŠ‚ç‚¹ä¸ºç©ºæ„æ€æ˜¯åªå‰©ä¸‹å½“å‰å¤´èŠ‚ç‚¹äº†ï¼Œå¦å¤–è¿™é‡Œçš„ s == null ä¹Ÿæ˜¯åˆ¤æ–­ç©ºæŒ‡é’ˆçš„æ ‡å‡†å†™æ³•</span></span><br><span class="line">           <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.isShared())</span><br><span class="line">               doReleaseShared();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•çš„å¤§æ–¹å‘ä½œç”¨æˆ‘ä»¬äº†è§£äº†ï¼Œä½†æ˜¯ä»£ç ä¸­ä½•æ—¶è°ƒç”¨ <code>doReleaseShared</code> çš„åˆ¤æ–­é€»è¾‘è¿˜æ˜¯æŒºè®©äººè´¹è§£çš„ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆä¸€å¤§å †çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬æ¥é€ä¸ªåˆ†æä¸€ä¸‹ï¼š</p><p>è¿™é‡Œçš„ç©ºåˆ¤æ–­æœ‰ç‚¹è®©äººå¤´å¤§ï¼Œæˆ‘ä»¬å…ˆæŒ‘å‡ºæ¥è¯´æ˜ä¸€ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613120818.png" alt=""></fancybox></p><p>æ’é™¤äº†å…¶ä»–åˆ¤æ–­æ¡ä»¶çš„å¹²æ‰°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸“æ³¨åˆ†æ propagate å’Œ waitStatus ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶å°±å¯ä»¥äº†ï¼Œè¿™é‡Œå†å°† waitStatus çš„å‡ ç§çŠ¶æ€å±•ç¤ºåœ¨è¿™é‡Œï¼Œå¸®åŠ©å¤§å®¶ç†è§£ï¼Œã€éªšç²‰è‰²ã€‘æ˜¯æˆ‘ä»¬ä¸€ä¼šè¦ç”¨åˆ°çš„ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613124631.png" alt=""></fancybox></p><blockquote><p>propagate &gt; 0</p></blockquote><p>ä¸Šé¢å·²ç»è¯´è¿‡äº†ï¼Œå¦‚æœæˆç«‹ï¼Œç›´æ¥çŸ­è·¯åç»­åˆ¤æ–­ï¼Œç„¶åæ ¹æ® doReleaseShared çš„åˆ¤æ–­æ¡ä»¶è¿›è¡Œé‡Šæ”¾</p><blockquote><p>propagate &gt; 0 ä¸æˆç«‹ï¼Œ h.waitStatus &lt; 0 æˆç«‹ <strong>ï¼ˆæ³¨æ„è¿™é‡Œçš„hæ˜¯æ—§çš„å¤´èŠ‚ç‚¹ï¼‰</strong></p></blockquote><p>ä»€ä¹ˆæ—¶å€™ h.waitStatus &lt; 0 å‘¢ï¼ŸæŠ›å¼€ CONDITION çš„ä½¿ç”¨ï¼Œåªå‰©ä¸‹ SIGNAL å’Œ PROPAGATEï¼Œæƒ³çŸ¥é“è¿™ä¸ªç­”æ¡ˆï¼Œéœ€è¦æå‰çœ‹ä¸€ä¸‹ <code>doReleaseShared()</code> æ–¹æ³•äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doReleaseShared</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h != tail) &#123;</span><br><span class="line">            <span class="keyword">int</span> ws = h.waitStatus;</span><br><span class="line">            <span class="keyword">if</span> (ws == Node.SIGNAL) &#123;</span><br><span class="line">              <span class="comment">// CAS å°†å¤´èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®ä¸º0                </span></span><br><span class="line">                <span class="keyword">if</span> (!compareAndSetWaitStatus(h, Node.SIGNAL, <span class="number">0</span>))</span><br><span class="line">                    <span class="keyword">continue</span>;            <span class="comment">// loop to recheck cases</span></span><br><span class="line">                <span class="comment">// è®¾ç½®æˆåŠŸåæ‰èƒ½è·³å‡ºå¾ªç¯å”¤é†’å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">              unparkSuccessor(h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ws == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                     <span class="comment">// å°†å¤´èŠ‚ç‚¹çŠ¶æ€CASè®¾ç½®æˆ PROPAGATE çŠ¶æ€</span></span><br><span class="line">                     !compareAndSetWaitStatus(h, <span class="number">0</span>, Node.PROPAGATE))</span><br><span class="line">                <span class="keyword">continue</span>;                <span class="comment">// loop on failed CAS</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (h == head)                   <span class="comment">// loop if head changed</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»  <code>doReleaseShared()</code> æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼š</p><ul><li><p>å¦‚æœè®© h.waitStatus &lt; 0 æˆç«‹ï¼Œåªèƒ½å°†å…¶è®¾ç½®æˆ PROPAGATE = -3 çš„æƒ…å†µï¼Œè®¾ç½®æˆåŠŸçš„å‰ææ˜¯ h å¤´èŠ‚ç‚¹ expected çš„çŠ¶æ€æ˜¯ 0ï¼›</p></li><li><p>å¦‚æœ h.waitStatus = 0ï¼Œæ˜¯ä¸Šè¿°ä»£ç ç¬¬ 8 è¡Œ CAS è®¾ç½®æˆåŠŸï¼Œç„¶åå”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹</p></li></ul><p>æ‰€ä»¥çŒœæµ‹ï¼Œå½“å‰çº¿ç¨‹æ‰§è¡Œåˆ° h.waitStatus &lt; 0 çš„åˆ¤æ–­å‰ï¼Œæœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆšå¥½æ‰§è¡Œäº†  <code>doReleaseShared()</code> æ–¹æ³•ï¼Œå°† waitStatus åˆè®¾ç½®æˆPROPAGATE = -3</p><p>è¿™ä¸ªç†è§£æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥ç”»ä¸ªå›¾ç†è§£ä¸€ä¸‹å§ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613132907.png" alt=""></fancybox></p><p>å¯èƒ½æœ‰åŒå­¦è¿˜æ˜¯ä¸å¤ªèƒ½ç†è§£è¿™ä¹ˆå†™çš„é“ç†ï¼Œæˆ‘ä»¬ä¸€ç›´è¯´ propagate &lt;&gt; = 0 çš„æƒ…å†µï¼Œpropagate = 0 ä»£è¡¨çš„æ˜¯<strong>å½“æ—¶/å½“æ—¶/å½“æ—¶</strong> å°è¯•è·å–åŒæ­¥çŠ¶æ€æ²¡æˆåŠŸï¼Œä½†æ˜¯ä¹‹åå¯èƒ½åˆæœ‰å…±äº«çŠ¶æ€è¢«é‡Šæ”¾äº†ï¼Œæ‰€ä»¥ä¸Šé¢çš„é€»è¾‘æ˜¯ä»¥é˜²è¿™ç§ä¸‡ä¸€ï¼Œä½ æ‡‚çš„ï¼Œä¸¥è°¨çš„å¹¶å‘å°±æ˜¯è¦é˜²æ­¢ä¸€åˆ‡ä¸‡ä¸€ï¼Œç°åœ¨ç»“åˆè¿™ä¸ªæƒ…æ™¯å†æ¥ç†è§£ä¸Šé¢çš„åˆ¤æ–­ä½ æ˜¯å¦è±ç„¶å¼€æœ—äº†å‘¢ï¼Ÿ</p><p>ç»§ç»­å‘ä¸‹çœ‹ï¼Œ</p><blockquote><p>å‰åºæ¡ä»¶ä¸æˆç«‹ï¼Œ(h = head) == null ||  h.waitStatus &lt; 0 <strong>æ³¨æ„è¿™é‡Œçš„hæ˜¯æ–°çš„å¤´èŠ‚ç‚¹ï¼‰</strong></p></blockquote><p>æœ‰äº†ä¸Šé¢é“ºå«ï¼Œè¿™ä¸ªå°±ç›´æ¥ç”»ä¸ªå›¾å°±æ›´å¥½ç†è§£å•¦ï¼Œå…¶å®å°±æ˜¯æ²¡æœ‰é‚£ä¹ˆå·§æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹æºåˆäº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613133904.png" alt=""></fancybox></p><p>ç›¸ä¿¡åˆ°è¿™é‡Œä½ åº”è¯¥ç†è§£å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„å…¨éƒ¨è¿‡ç¨‹äº†å§ï¼Œè‡³äº<strong>éé˜»å¡å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</strong>å’Œ<strong>å¸¦æœ‰è¶…æ—¶æ—¶é—´è·å–åŒæ­¥çŠ¶æ€</strong>ï¼Œç»“åˆæœ¬æ–‡è®²çš„ setHeadAndPropagate é€»è¾‘å’Œç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„å®ç°è¿‡ç¨‹è¿‡ç¨‹æ¥çœ‹ï¼ŒçœŸæ˜¯ä¸€æ¯›ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†ç´¯è¿°äº†ï¼Œèµ¶ç´§æ‰“å¼€ä½ çš„ IDE å»éªŒè¯ä¸€ä¸‹å§</p><p>æˆ‘ä»¬åˆ†æäº†AQS çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œè¿˜ä¸€ç›´æ²¡è¯´ <code>tryAcquireShared(arg)</code> è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•è¢«é‡å†™çš„ï¼Œæƒ³è¦äº†è§£è¿™ä¸ªï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„ç»å…¸åº”ç”¨ Semaphore</p><h2 id="Semaphore-çš„åº”ç”¨åŠæºç åˆ†æ"><a href="#Semaphore-çš„åº”ç”¨åŠæºç åˆ†æ" class="headerlink" title="Semaphore çš„åº”ç”¨åŠæºç åˆ†æ"></a>Semaphore çš„åº”ç”¨åŠæºç åˆ†æ</h2><h3 id="Semaphore-æ¦‚å¿µ"><a href="#Semaphore-æ¦‚å¿µ" class="headerlink" title="Semaphore æ¦‚å¿µ"></a>Semaphore æ¦‚å¿µ</h3><p>Semaphore ä¸­æ–‡å¤šç¿»è¯‘ä¸º ã€ä¿¡å·é‡ã€‘ï¼Œæˆ‘è¿˜ç‰¹æ„æŸ¥äº†ä¸€ä¸‹å‰‘æ¡¥è¾å…¸çš„è‹±æ–‡è§£é‡Šï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613134832.png" alt=""></fancybox></p><p>å…¶å®å°±æ˜¯ä¿¡å·æ ‡å¿—ï¼ˆtwo flagsï¼‰ï¼Œæ¯”å¦‚çº¢ç»¿ç¯ï¼Œæ¯ä¸ªäº¤é€šç¯äº§ç”Ÿä¸¤ç§ä¸åŒè¡Œä¸º</p><ul><li>Flag1-çº¢ç¯ï¼šåœè½¦</li><li>Flag2-ç»¿ç¯ï¼šè¡Œè½¦</li></ul><p>åœ¨ Semaphore é‡Œé¢ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯çº¢ç¯ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯ç»¿ç¯ï¼Œå…¶å®å°±æ˜¯é  <code>tryAcquireShared(arg)</code> çš„ç»“æœæ¥è¡¨ç¤ºçš„</p><ul><li>è·å–ä¸åˆ°å…±äº«çŠ¶æ€ï¼Œå³ä¸ºçº¢ç¯</li><li>è·å–åˆ°å…±äº«çŠ¶æ€ï¼Œå³ä¸ºç»¿ç¯</li></ul><p>æ‰€ä»¥æˆ‘ä»¬èµ°è¿‘ Semaphore ï¼Œæ¥çœ‹çœ‹å®ƒåˆ°åº•æ˜¯æ€ä¹ˆåº”ç”¨ AQS çš„ï¼Œåˆæ˜¯æ€æ ·é‡å†™ <code>tryAcquireShared(arg)</code>  æ–¹æ³•çš„</p><h3 id="Semaphore-æºç åˆ†æ"><a href="#Semaphore-æºç åˆ†æ" class="headerlink" title="Semaphore æºç åˆ†æ"></a>Semaphore æºç åˆ†æ</h3><p>å…ˆçœ‹ä¸€ä¸‹ç±»ç»“æ„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613135824.png" alt=""></fancybox></p><p>çœ‹åˆ°è¿™é‡Œä½ æ˜¯å¦æœ‰ç‚¹è·Œçœ¼é•œï¼Œå’Œ ReentrantLock ç›¸ä¼¼çš„å¯æ€•å§ï¼Œå¦‚æœä½ æœ‰äº›é™Œç”Ÿï¼Œå†æ¬¡å¼ºçƒˆå»ºè®®ä½ å›çœ‹ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://dayarch.top/p/java-aqs-and-reentrantlock.html">Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨</a> ï¼Œè¿™é‡Œç›´æ¥æé€Ÿå¯¹æ¯”çœ‹å…¬å¹³å’Œéå…¬å¹³ä¸¤ç§é‡å†™çš„ <code>tryAcquireShared(arg)</code> æ–¹æ³•ï¼Œæ²¡æœ‰æ„å¤–ï¼Œå…¬å¹³ä¸å¦ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613140142.png" alt=""></fancybox></p><p>æ–¹æ³•å†…éƒ¨åªæ˜¯è®¡ç®— state çš„å‰©ä½™å€¼ï¼Œé‚£ state çš„åˆå§‹å€¼æ˜¯å¤šå°‘æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿå½“ç„¶ä¹Ÿå°±æ˜¯æ„é€ æ–¹æ³•äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é»˜è®¤ä»æ˜¯éå…¬å¹³çš„åŒæ­¥å™¨ï¼Œè‡³äºä¸ºä»€ä¹ˆé»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿç‰¹æ„è¯´æ˜è¿‡</span></span><br><span class="line">      sync = <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  NonfairSync(<span class="keyword">int</span> permits) &#123;</span><br><span class="line">  <span class="keyword">super</span>(permits);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>super æ–¹æ³•ï¼Œå°±ä¼šå°†åˆå§‹å€¼ç»™åˆ° AQS ä¸­çš„ state</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613140716.png" alt=""></fancybox></p><p>ä¹Ÿè®¸ä½ å‘ç°äº†ï¼Œå½“æˆ‘ä»¬æŠŠ permits è®¾ç½®ä¸º1 çš„æ—¶å€™ï¼Œä¸å°±æ˜¯ ReentrantLock çš„äº’æ–¥é”äº†å˜›ï¼Œè¯´çš„ä¸€ç‚¹ä¹Ÿæ²¡é”™ï¼Œæˆ‘ä»¬ç”¨ Semaphore ä¹Ÿèƒ½å®ç°åŸºæœ¬äº’æ–¥é”çš„æ•ˆæœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ä¿¡å·é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> Semaphore s </span><br><span class="line">    = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//ç”¨ä¿¡å·é‡ä¿è¯äº’æ–¥    </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  s.acquire();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    count+=<span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    s.release();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Butï¼ˆè‹±æ–‡å¬åŠ›ä¸­çš„é‡ç‚¹ï¼‰ï¼ŒSemaphore è‚¯å®šä¸æ˜¯ä¸ºè¿™ç§ç‰¹ä¾‹å­˜åœ¨çš„ï¼Œå®ƒæ˜¯å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„ä¸€ç§å®ç°ã€‚å¦‚æœä½¿ç”¨ä¿¡å·é‡ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°† permits è®¾ç½®æˆå¤§äº1çš„å€¼ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾—æˆ‘æ›¾åœ¨ <a href="https://dayarch.top/p/why-we-need-to-use-threadpool.html">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</a> ä¸€æ–‡ä¸­è¯´åˆ°çš„æ± åŒ–æ¦‚å¿µï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹ä½¿ç”¨è¿æ¥æ± ï¼Œæ¯ä¸ªè¿æ¥è¢«é‡Šæ”¾ä¹‹å‰ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹ä½¿ç”¨ã€‚æ‰€ä»¥è¯´ <strong>Semaphore å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªä¸´ç•ŒåŒº</strong>ï¼Œæœ€ç»ˆå¾ˆå¥½çš„åšåˆ°ä¸€ä¸ª<strong>é™æµ/é™æµ/é™æµ</strong> çš„ä½œç”¨</p><p>è™½ç„¶ Semaphore èƒ½å¾ˆå¥½çš„æä¾›é™æµä½œç”¨ï¼Œè¯´å®è¯ï¼ŒSemaphore çš„é™æµä½œç”¨æ¯”è¾ƒå•ä¸€ï¼Œæˆ‘åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨ Semaphore å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œå¦‚æœçœŸçš„è¦ç”¨é«˜æ€§èƒ½é™æµå™¨ï¼ŒGuava RateLimiter æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œæˆ‘ä»¬åé¢ä¼šåšåˆ†æï¼Œæœ‰å…´è¶£çš„å¯ä»¥æå‰äº†è§£ä¸€ä¸‹</p><p>å…³äº Semaphore æºç ï¼Œå°±è¿™ä¹ˆä¸‰ä¸‹äº”é™¤äºŒçš„ç»“æŸäº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200613150959.png" alt=""></fancybox></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸çŸ¥ä½ æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œæˆ‘ä»¬çš„èŠ‚å¥æ˜æ˜¾åŠ å¿«äº†ï¼Œå¥½å¤šåŸæ¥åˆ†æ•£çš„ç‚¹åœ¨è¢«ç–¯ç‹‚çš„ä¸²è”èµ·æ¥ï¼Œå¦‚æœæŒ‰ç…§è¿™ä¸ªæ–¹å¼æ¥é˜…è¯» JUC æºç ï¼Œç›¸ä¿¡ä½ ä¹Ÿä¸ä¼šä¸€å¤´æ‰è¿›å»è¿·å¤±æ–¹å‘ï¼Œç„¶åæ²®ä¸§çš„é€€å‡º JUC å§ï¼Œç„¶åé¢è¯•èƒŒè¯µç­”æ¡ˆï¼Œç„¶åå¿˜è®°ï¼Œç„¶åå†èƒŒè¯µï¼Ÿ</p><p>è·Ÿä¸ŠèŠ‚å¥ï¼Œå…³äºå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼ŒSemaphore åªä¸è¿‡æ˜¯éå¸¸ç»å…¸çš„åº”ç”¨ï¼ŒReadWriteLock å’Œ CountDownLatch æ—¥å¸¸åº”ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±é™†ç»­èŠèŠå®ƒä»¬å§</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>Semaphore çš„ permits è®¾ç½®æˆ1 â€œç­‰åŒäºâ€ ç®€å•çš„äº’æ–¥é”å®ç°ï¼Œé‚£å®ƒå’Œ ReentrantLock çš„åŒºåˆ«è¿˜æ˜¯æŒºå¤§çš„ï¼Œéƒ½æœ‰å“ªäº›åŒºåˆ«å‘¢ï¼Ÿ</li><li>ä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ Semaphore çš„å‘¢ï¼Ÿ</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>Java å¹¶å‘å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="https://blog.csdn.net/anlian523/article/details/106319294" target="_blank" rel="noopener">https://blog.csdn.net/anlian523/article/details/106319294</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨</title>
      <link href="//p/java-aqs-and-reentrantlock.html"/>
      <url>//p/java-aqs-and-reentrantlock.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://rgyb.sunluomeng.top/20200531195654.png" alt=""></fancybox></p><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>è¿›å…¥æºç é˜¶æ®µäº†ï¼Œå†™äº†åå‡ ç¯‡çš„ <a href="https://dayarch.top/categories/Coding/Java-Concurrency/">å¹¶å‘ç³»åˆ—</a> çŸ¥è¯†é“ºå«ç»ˆäºè¦æ´¾ä¸Šç”¨åœºäº†ã€‚ç›¸ä¿¡å¾ˆå¤šäººå·²ç»å¿˜äº†å…¶ä¸­çš„ä¸€äº›ç†è®ºçŸ¥è¯†ï¼Œåˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šåœ¨æºç ç¯èŠ‚å¸¦å…¥ç›¸åº”çš„ç†è®ºçŸ¥è¯†ç‚¹å¸®åŠ©å¤§å®¶å›å¿†ï¼Œåšåˆ°ç†è®ºä¸å®è·µç›¸ç»“åˆï¼Œå¦å¤–è¿™æ˜¯è¶…é•¿å›¾æ–‡ï¼Œå»ºè®®æ”¶è—ï¼Œå¦‚æœå¯¹ä½ æœ‰ç”¨è¿˜è¯·ç‚¹èµè®©æ›´å¤šäººçœ‹åˆ°</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200531112004.png" alt=""></fancybox></p><h2 id="Java-SDK-ä¸ºä»€ä¹ˆè¦è®¾è®¡-Lock"><a href="#Java-SDK-ä¸ºä»€ä¹ˆè¦è®¾è®¡-Lock" class="headerlink" title="Java SDK ä¸ºä»€ä¹ˆè¦è®¾è®¡ Lock"></a>Java SDK ä¸ºä»€ä¹ˆè¦è®¾è®¡ Lock</h2><p>æ›¾å‡ ä½•æ—¶å¹»æƒ³è¿‡ï¼Œå¦‚æœ Java å¹¶å‘æ§åˆ¶åªæœ‰ synchronized å¤šå¥½ï¼Œåªæœ‰ä¸‹é¢ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œç®€å•æ–¹ä¾¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeSync</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">normalSyncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">staticSyncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncBlockMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span> (object)&#123;</span><br><span class="line"><span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ Java 1.5ä¹‹å‰ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼Œè‡ªä» 1.5 ç‰ˆæœ¬ Doug Lea å¤§å¸ˆå°±é‡æ–°é€ äº†ä¸€ä¸ªè½®å­ Lock</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200517205907.png" alt=""></fancybox></p><p>æˆ‘ä»¬å¸¸è¯´ï¼šâ€œé¿å…é‡å¤é€ è½®å­â€ï¼Œå¦‚æœæœ‰äº†è½®å­è¿˜æ˜¯è¦åšæŒå†é€ ä¸ªè½®å­ï¼Œé‚£ä¹ˆè‚¯å®šä¼ ç»Ÿçš„è½®å­åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸­ä¸èƒ½å¾ˆå¥½çš„è§£å†³é—®é¢˜</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20160902811214_jeTEtQ.gif" alt=""></fancybox></p><p>ä¸çŸ¥ä½ æ˜¯å¦è¿˜è®°å¾— <a href="https://dayarch.top/p/java-concurrency-dead-lock.html#Coffman-æ¡ä»¶">Coffman æ€»ç»“çš„å››ä¸ªå¯ä»¥å‘ç”Ÿæ­»é”çš„æƒ…å½¢</a> ï¼Œå…¶ä¸­ã€ä¸å¯å‰¥å¤ºæ¡ä»¶ã€‘æ˜¯æŒ‡ï¼š</p><blockquote><p>çº¿ç¨‹å·²ç»è·å¾—èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œæ—¶è‡ªå·±é‡Šæ”¾</p></blockquote><p>è¦æƒ³ç ´åè¿™ä¸ªæ¡ä»¶ï¼Œ<strong>å°±éœ€è¦å…·æœ‰ç”³è¯·ä¸åˆ°è¿›ä¸€æ­¥èµ„æºå°±é‡Šæ”¾å·²æœ‰èµ„æºçš„èƒ½åŠ›</strong> </p><p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªèƒ½åŠ›æ˜¯ synchronized ä¸å…·å¤‡çš„ï¼Œä½¿ç”¨ synchronized ï¼Œå¦‚æœçº¿ç¨‹ç”³è¯·ä¸åˆ°èµ„æºå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæˆ‘ä»¬åšä»€ä¹ˆä¹Ÿæ”¹å˜ä¸äº†å®ƒçš„çŠ¶æ€ï¼Œè¿™æ˜¯ synchronized è½®å­çš„è‡´å‘½å¼±ç‚¹ï¼Œè¿™å°±å¼ºæœ‰åŠ›çš„ç»™äº†é‡é€ è½®å­ Lock çš„ç†ç”±</p><h2 id="æ˜¾å¼é”-Lock"><a href="#æ˜¾å¼é”-Lock" class="headerlink" title="æ˜¾å¼é” Lock"></a>æ˜¾å¼é” Lock</h2><p>æ—§è½®å­æœ‰å¼±ç‚¹ï¼Œæ–°è½®å­å°±è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥è¦å…·å¤‡ä¸ä¼šé˜»å¡çš„åŠŸèƒ½ï¼Œä¸‹é¢çš„ä¸‰ä¸ªæ–¹æ¡ˆéƒ½æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å¥½åŠæ³•ï¼ˆçœ‹ä¸‹é¢è¡¨æ ¼æè¿°ä½ å°±æ˜ç™½ä¸‰ä¸ªæ–¹æ¡ˆçš„å«ä¹‰äº†ï¼‰</p><table><thead><tr><th>ç‰¹æ€§</th><th>æè¿°</th><th>API</th></tr></thead><tbody><tr><td>èƒ½å“åº”ä¸­æ–­</td><td>å¦‚æœä¸èƒ½è‡ªå·±é‡Šæ”¾ï¼Œé‚£å¯ä»¥å“åº”ä¸­æ–­ä¹Ÿæ˜¯å¾ˆå¥½çš„ã€‚<a href="https://dayarch.top/p/java-concurrency-interrupt-mechnism.html">Javaå¤šçº¿ç¨‹ä¸­æ–­æœºåˆ¶</a> ä¸“é—¨æè¿°äº†ä¸­æ–­è¿‡ç¨‹ï¼Œç›®çš„æ˜¯é€šè¿‡ä¸­æ–­ä¿¡å·æ¥è·³å‡ºæŸç§çŠ¶æ€ï¼Œæ¯”å¦‚é˜»å¡</td><td>lockInterruptbly()</td></tr><tr><td>éé˜»å¡å¼çš„è·å–é”</td><td>å°è¯•è·å–ï¼Œè·å–ä¸åˆ°ä¸ä¼šé˜»å¡ï¼Œç›´æ¥è¿”å›</td><td>tryLock()</td></tr><tr><td>æ”¯æŒè¶…æ—¶</td><td>ç»™å®šä¸€ä¸ªæ—¶é—´é™åˆ¶ï¼Œå¦‚æœä¸€æ®µæ—¶é—´å†…æ²¡è·å–åˆ°ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼ŒåŒæ ·ç›´æ¥è¿”å›</td><td>tryLock(long time, timeUnit)</td></tr></tbody></table><p>å¥½çš„æ–¹æ¡ˆæœ‰äº†ï¼Œä½†é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ï¼ŒLock å¤šäº† synchronized ä¸å…·å¤‡çš„ç‰¹æ€§ï¼Œè‡ªç„¶ä¸ä¼šåƒ synchronized é‚£æ ·ä¸€ä¸ªå…³é”®å­—ä¸‰ä¸ªç©æ³•èµ°éå…¨å¤©ä¸‹ï¼Œåœ¨ä½¿ç”¨ä¸Šä¹Ÿç›¸å¯¹å¤æ‚äº†ä¸€ä¸¢ä¸¢</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530121439.png" alt=""></fancybox></p><h3 id="Lock-ä½¿ç”¨èŒƒå¼"><a href="#Lock-ä½¿ç”¨èŒƒå¼" class="headerlink" title="Lock ä½¿ç”¨èŒƒå¼"></a>Lock ä½¿ç”¨èŒƒå¼</h3><p>synchronized æœ‰æ ‡å‡†ç”¨æ³•ï¼Œè¿™æ ·çš„ä¼˜è‰¯ä¼ ç»Ÿå’± Lock ä¹Ÿå¾—æœ‰ï¼Œç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“ä½¿ç”¨ Lock çš„ä¸€ä¸ª<strong>èŒƒå¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯èŒƒå¼ï¼ˆæ²¡äº‹ä¸è¦æŒ‘æˆ˜æ›´æ”¹å†™æ³•çš„é‚£ç§ï¼‰ï¼Œè‚¯å®šæœ‰å…¶ç†ç”±ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹</p><h4 id="æ ‡å‡†1â€”finally-ä¸­é‡Šæ”¾é”"><a href="#æ ‡å‡†1â€”finally-ä¸­é‡Šæ”¾é”" class="headerlink" title="æ ‡å‡†1â€”finally ä¸­é‡Šæ”¾é”"></a>æ ‡å‡†1â€”finally ä¸­é‡Šæ”¾é”</h4><p>è¿™ä¸ªå¤§å®¶åº”è¯¥éƒ½ä¼šæ˜ç™½ï¼Œåœ¨ finally ä¸­é‡Šæ”¾é”ï¼Œç›®çš„æ˜¯ä¿è¯åœ¨è·å–åˆ°é”ä¹‹åï¼Œ<strong>æœ€ç»ˆ</strong>èƒ½è¢«é‡Šæ”¾</p><h4 id="æ ‡å‡†2â€”åœ¨-try-å¤–é¢è·å–é”"><a href="#æ ‡å‡†2â€”åœ¨-try-å¤–é¢è·å–é”" class="headerlink" title="æ ‡å‡†2â€”åœ¨ try{} å¤–é¢è·å–é”"></a>æ ‡å‡†2â€”åœ¨ try{} å¤–é¢è·å–é”</h4><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰æ ‡å‡† 2 çš„å­˜åœ¨ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯â€œå–œæ¬¢â€ try ä½æ‰€æœ‰å†…å®¹ï¼Œç”Ÿæ€•å‘ç”Ÿå¼‚å¸¸ä¸èƒ½æ•è·çš„</p><p>åœ¨ <code>try{}</code> å¤–è·å–é”ä¸»è¦è€ƒè™‘ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li>å¦‚æœæ²¡æœ‰è·å–åˆ°é”å°±æŠ›å‡ºå¼‚å¸¸ï¼Œæœ€ç»ˆé‡Šæ”¾é”è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºè¿˜æœªæ›¾æ‹¥æœ‰é”è°ˆä½•é‡Šæ”¾é”å‘¢</li><li>å¦‚æœåœ¨è·å–é”æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹å¹¶æœªè·å–åˆ°é”ï¼Œä½†æ‰§è¡Œåˆ° finally ä»£ç æ—¶ï¼Œå¦‚æœæ°å·§åˆ«çš„çº¿ç¨‹è·å–åˆ°äº†é”ï¼Œåˆ™ä¼šè¢«é‡Šæ”¾æ‰ï¼ˆæ— æ•…é‡Šæ”¾ï¼‰</li></ol><blockquote><p>ä¸åŒé”çš„å®ç°æ–¹å¼ç•¥æœ‰ä¸åŒï¼ŒèŒƒå¼çš„å­˜åœ¨å°±æ˜¯è¦é¿å…ä¸€åˆ‡é—®é¢˜çš„å‡ºç°ï¼Œæ‰€ä»¥å¤§å®¶å°½é‡éµå®ˆèŒƒå¼</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530122723.png" alt=""></fancybox></p><h3 id="Lock-æ˜¯æ€æ ·èµ·åˆ°é”çš„ä½œç”¨å‘¢ï¼Ÿ"><a href="#Lock-æ˜¯æ€æ ·èµ·åˆ°é”çš„ä½œç”¨å‘¢ï¼Ÿ" class="headerlink" title="Lock æ˜¯æ€æ ·èµ·åˆ°é”çš„ä½œç”¨å‘¢ï¼Ÿ"></a>Lock æ˜¯æ€æ ·èµ·åˆ°é”çš„ä½œç”¨å‘¢ï¼Ÿ</h3><p>å¦‚æœä½ ç†Ÿæ‚‰ synchronizedï¼Œä½ çŸ¥é“ç¨‹åºç¼–è¯‘æˆ CPU æŒ‡ä»¤åï¼Œåœ¨ä¸´ç•ŒåŒºä¼šæœ‰ <code>moniterenter</code> å’Œ <code>moniterexit</code> æŒ‡ä»¤çš„å‡ºç°ï¼Œå¯ä»¥ç†è§£æˆè¿›å‡ºä¸´ç•ŒåŒºçš„æ ‡è¯†</p><p>ä»èŒƒå¼ä¸Šæ¥çœ‹ï¼š</p><ul><li><p><code>lock.lock()</code>  è·å–é”ï¼Œâ€œç­‰åŒäºâ€ synchronized çš„ moniterenteræŒ‡ä»¤</p></li><li><p><code>lock.unlock()</code> é‡Šæ”¾é”ï¼Œâ€œç­‰åŒäºâ€ synchronized çš„ moniterexit æŒ‡ä»¤</p></li></ul><p>é‚£ Lock æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>è¿™é‡Œå…ˆç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œè¿™æ ·ä¸€ä¼šåˆ°æºç åˆ†ææ—¶ï¼Œä½ å¯ä»¥è¿œè§‚è®¾è®¡è½®å»“ï¼Œè¿‘è§‚å®ç°ç»†èŠ‚ï¼Œä¼šå˜å¾—è¶Šå‘è½»æ¾</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530123350.png" alt=""></fancybox></p><blockquote><p>å…¶å®å¾ˆç®€å•ï¼Œæ¯”å¦‚åœ¨  ReentrantLock å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª volatile ä¿®é¥°çš„å˜é‡ stateï¼Œé€šè¿‡ CAS æ¥è¿›è¡Œè¯»å†™ï¼ˆæœ€åº•å±‚è¿˜æ˜¯äº¤ç»™ç¡¬ä»¶æ¥ä¿è¯åŸå­æ€§å’Œå¯è§æ€§ï¼‰ï¼Œå¦‚æœCASæ›´æ”¹æˆåŠŸï¼Œå³è·å–åˆ°é”ï¼Œçº¿ç¨‹è¿›å…¥åˆ° try ä»£ç å—ç»§ç»­æ‰§è¡Œï¼›å¦‚æœæ²¡æœ‰æ›´æ”¹æˆåŠŸï¼Œçº¿ç¨‹ä¼šè¢«ã€æŒ‚èµ·ã€‘ï¼Œä¸ä¼šå‘ä¸‹æ‰§è¡Œ</p></blockquote><p>ä½† Lock æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢æ ¹æœ¬æ²¡æœ‰ state è¿™ä¸ªå˜é‡çš„å­˜åœ¨ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523141526.png" alt=""></fancybox></p><p>å®ƒæ€ä¹ˆå¤„ç†è¿™ä¸ª state å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶éœ€è¦ä¸€ç‚¹è®¾è®¡çš„åŠ æˆäº†ï¼Œæ¥å£å®šä¹‰è¡Œä¸ºï¼Œå…·ä½“éƒ½æ˜¯éœ€è¦å®ç°ç±»çš„</p><blockquote><p>Lock æ¥å£çš„å®ç°ç±»åŸºæœ¬éƒ½æ˜¯é€šè¿‡ã€èšåˆã€‘äº†ä¸€ä¸ªã€é˜Ÿåˆ—åŒæ­¥å™¨ã€‘çš„å­ç±»å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„</p></blockquote><p>é‚£ä»€ä¹ˆæ˜¯é˜Ÿåˆ—åŒæ­¥å™¨å‘¢ï¼Ÿ ï¼ˆè¿™åº”è¯¥æ˜¯ä½ è§è¿‡çš„æœ€å¼ºæ ‡é¢˜å…šï¼ŒèŠäº†åŠä¸ªä¸–çºªæ‰å…¥æ­£é¢˜ï¼Œè¯„è®ºåŒºç•™è¨€éª‚æˆ‘ï¼‰</p><h2 id="é˜Ÿåˆ—åŒæ­¥å™¨-AQS"><a href="#é˜Ÿåˆ—åŒæ­¥å™¨-AQS" class="headerlink" title="é˜Ÿåˆ—åŒæ­¥å™¨ AQS"></a>é˜Ÿåˆ—åŒæ­¥å™¨ AQS</h2><p>é˜Ÿåˆ—åŒæ­¥å™¨ ï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œç®€ç§°åŒæ­¥å™¨æˆ–AQSï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»äººå…¬</p><blockquote><p><strong>é—®ï¼š</strong>ä¸ºä»€ä¹ˆä½ åˆ†æ JUC æºç ï¼Œè¦ä» AQS è¯´èµ·å‘¢ï¼Ÿ</p><p><strong>ç­”ï¼š</strong>çœ‹ä¸‹å›¾</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200517201817.png" alt=""></fancybox></p><p>ç›¸ä¿¡çœ‹åˆ°è¿™ä¸ªæˆªå›¾ä½ å°±æ˜ç™½ä¸€äºŒäº†ï¼Œä½ å¬è¿‡çš„ï¼Œé¢è¯•å¸¸è¢«é—®èµ·çš„ï¼Œå·¥ä½œä¸­å¸¸ç”¨çš„</p><ul><li><code>ReentrantLock</code>  </li><li><code>ReentrantReadWriteLock</code> </li><li><code>Semaphore(ä¿¡å·é‡)</code> </li><li><code>CountDownLatch</code> </li><li><code>å…¬å¹³é”</code> </li><li><code>éå…¬å¹³é”</code> </li><li><code>ThreadPoolExecutor</code>  (å…³äºçº¿ç¨‹æ± çš„ç†è§£ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://dayarch.top/p/why-we-need-to-use-threadpool.html">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</a> )</li></ul><p>éƒ½å’Œ AQS æœ‰ç›´æ¥å…³ç³»ï¼Œæ‰€ä»¥äº†è§£ AQS çš„æŠ½è±¡å®ç°ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå†ç¨ç¨æŸ¥çœ‹ä¸Šè¿°å„ç±»çš„å®ç°ç»†èŠ‚ï¼Œå¾ˆå¿«å°±å¯ä»¥å…¨éƒ¨æå®šï¼Œä¸è‡³äºæŸ¥çœ‹æºç æ—¶ä¸€å¤´é›¾æ°´ï¼Œä¸¢å¤±ä¸»çº¿</p><p>ä¸Šé¢æåˆ°ï¼Œåœ¨é”çš„å®ç°ç±»ä¸­ä¼šèšåˆåŒæ­¥å™¨ï¼Œç„¶ååˆ©åŒæ­¥å™¨å®ç°é”çš„è¯­ä¹‰ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨èšåˆæ¨¡å¼ï¼Œæ€ä¹ˆè¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³»å‘¢ï¼Ÿ</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530125122.png" alt=""></fancybox></p><p>æˆ‘ä»¬ç»å¤§å¤šæ•°éƒ½æ˜¯åœ¨ä½¿ç”¨é”ï¼Œå®ç°é”ä¹‹åï¼Œå…¶æ ¸å¿ƒå°±æ˜¯è¦ä½¿ç”¨æ–¹ä¾¿</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530130025.png" alt=""></fancybox></p><p>ä» AQS çš„ç±»åç§°å’Œä¿®é¥°ä¸Šæ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥ä»è®¾è®¡æ¨¡å¼çš„è§’åº¦æ¥çœ‹åŒæ­¥å™¨ä¸€å®šæ˜¯åŸºäºã€æ¨¡ç‰ˆæ¨¡å¼ã€‘æ¥è®¾è®¡çš„ï¼Œä½¿ç”¨è€…éœ€è¦ç»§æ‰¿åŒæ­¥å™¨ï¼Œå®ç°è‡ªå®šä¹‰åŒæ­¥å™¨ï¼Œå¹¶é‡å†™æŒ‡å®šæ–¹æ³•ï¼Œéšåå°†åŒæ­¥å™¨ç»„åˆåœ¨è‡ªå®šä¹‰çš„åŒæ­¥ç»„ä»¶ä¸­ï¼Œå¹¶è°ƒç”¨åŒæ­¥å™¨çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œè€Œè¿™äº›æ¨¡ç‰ˆæ–¹æ³•åˆå›è°ƒç”¨ä½¿ç”¨è€…é‡å†™çš„æ–¹æ³•</p><p>æˆ‘ä¸æƒ³å°†ä¸Šé¢çš„è§£é‡Šè¯´çš„è¿™ä¹ˆæŠ½è±¡ï¼Œå…¶å®æƒ³ç†è§£ä¸Šé¢è¿™å¥è¯ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ä¸‹é¢ä¸¤ä¸ªé—®é¢˜å°±å¥½äº†</p><ol><li>å“ªäº›æ˜¯è‡ªå®šä¹‰åŒæ­¥å™¨å¯é‡å†™çš„æ–¹æ³•ï¼Ÿ</li><li>å“ªäº›æ˜¯æŠ½è±¡åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Ÿ</li></ol><h3 id="åŒæ­¥å™¨å¯é‡å†™çš„æ–¹æ³•"><a href="#åŒæ­¥å™¨å¯é‡å†™çš„æ–¹æ³•" class="headerlink" title="åŒæ­¥å™¨å¯é‡å†™çš„æ–¹æ³•"></a>åŒæ­¥å™¨å¯é‡å†™çš„æ–¹æ³•</h3><p>åŒæ­¥å™¨æä¾›çš„å¯é‡å†™æ–¹æ³•åªæœ‰5ä¸ªï¼Œè¿™å¤§å¤§æ–¹ä¾¿äº†é”çš„ä½¿ç”¨è€…ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523160830.png" alt=""></fancybox></p><p>æŒ‰ç†è¯´ï¼Œéœ€è¦é‡å†™çš„æ–¹æ³•ä¹Ÿåº”è¯¥æœ‰ abstract æ¥ä¿®é¥°çš„ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæ²¡æœ‰ï¼ŸåŸå› å…¶å®å¾ˆç®€å•ï¼Œä¸Šé¢çš„æ–¹æ³•æˆ‘å·²ç»ç”¨é¢œè‰²åŒºåˆ†æˆäº†ä¸¤ç±»ï¼š</p><ul><li><code>ç‹¬å å¼</code> </li><li><code>å…±äº«å¼</code></li></ul><p>è‡ªå®šä¹‰çš„åŒæ­¥ç»„ä»¶æˆ–è€…é”ä¸å¯èƒ½æ—¢æ˜¯ç‹¬å å¼åˆæ˜¯å…±äº«å¼ï¼Œä¸ºäº†é¿å…å¼ºåˆ¶é‡å†™ä¸ç›¸å¹²æ–¹æ³•ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ abstract æ¥ä¿®é¥°äº†ï¼Œä½†è¦æŠ›å‡ºå¼‚å¸¸å‘ŠçŸ¥ä¸èƒ½ç›´æ¥ä½¿ç”¨è¯¥æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æš–æš–çš„å¾ˆè´´å¿ƒï¼ˆå¦‚æœä½ æœ‰ç±»ä¼¼çš„éœ€æ±‚ä¹Ÿå¯ä»¥ä»¿ç…§è¿™æ ·çš„è®¾è®¡ï¼‰</p><p>è¡¨æ ¼æ–¹æ³•æè¿°ä¸­æ‰€è¯´çš„<code>åŒæ­¥çŠ¶æ€</code>å°±æ˜¯ä¸Šæ–‡æåˆ°çš„æœ‰ volatile ä¿®é¥°çš„ stateï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨<code>é‡å†™</code>ä¸Šé¢å‡ ä¸ªæ–¹æ³•æ—¶ï¼Œè¿˜è¦é€šè¿‡åŒæ­¥å™¨æä¾›çš„ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼ˆAQS æä¾›çš„ï¼‰æ¥è·å–æˆ–ä¿®æ”¹åŒæ­¥çŠ¶æ€ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523160906.png" alt=""></fancybox></p><p>è€Œç‹¬å å¼å’Œå…±äº«å¼æ“ä½œ state å˜é‡çš„åŒºåˆ«ä¹Ÿå°±å¾ˆç®€å•äº†</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523160705.png" alt=""></fancybox></p><p>æ‰€ä»¥ä½ çœ‹åˆ°çš„ <code>ReentrantLock</code>  <code>ReentrantReadWriteLock</code>  <code>Semaphore(ä¿¡å·é‡)</code>  <code>CountDownLatch</code>  è¿™å‡ ä¸ªç±»å…¶å®ä»…ä»…æ˜¯åœ¨å®ç°ä»¥ä¸Šå‡ ä¸ªæ–¹æ³•ä¸Šç•¥æœ‰å·®åˆ«ï¼Œå…¶ä»–çš„å®ç°éƒ½æ˜¯é€šè¿‡åŒæ­¥å™¨çš„æ¨¡ç‰ˆæ–¹æ³•æ¥å®ç°çš„ï¼Œåˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å¿ƒæƒ…æ”¾æ¾äº†è®¸å¤šå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æ¨¡ç‰ˆæ–¹æ³•ï¼š</p><h3 id="åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•"><a href="#åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•" class="headerlink" title="åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•"></a>åŒæ­¥å™¨æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•</h3><p>ä¸Šé¢æˆ‘ä»¬å°†åŒæ­¥å™¨çš„å®ç°æ–¹æ³•åˆ†ä¸ºç‹¬å å¼å’Œå…±äº«å¼ä¸¤ç±»ï¼Œæ¨¡ç‰ˆæ–¹æ³•å…¶å®é™¤äº†æä¾›ä»¥ä¸Šä¸¤ç±»æ¨¡ç‰ˆæ–¹æ³•ä¹‹å¤–ï¼Œåªæ˜¯å¤šäº†<code>å“åº”ä¸­æ–­</code>å’Œ<code>è¶…æ—¶é™åˆ¶</code> çš„æ¨¡ç‰ˆæ–¹æ³•ä¾› Lock ä½¿ç”¨ï¼Œæ¥çœ‹ä¸€ä¸‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523195957.png" alt=""></fancybox></p><p>å…ˆä¸ç”¨è®°ä¸Šè¿°æ–¹æ³•çš„åŠŸèƒ½ï¼Œç›®å‰ä½ åªéœ€è¦äº†è§£ä¸ªå¤§æ¦‚åŠŸèƒ½å°±å¥½ã€‚å¦å¤–ï¼Œç›¸ä¿¡ä½ ä¹Ÿæ³¨æ„åˆ°äº†ï¼š</p><blockquote><p>ä¸Šé¢çš„æ–¹æ³•éƒ½æœ‰ final å…³é”®å­—ä¿®é¥°ï¼Œè¯´æ˜å­ç±»ä¸èƒ½é‡å†™è¿™ä¸ªæ–¹æ³•</p></blockquote><p>çœ‹åˆ°è¿™ä½ ä¹Ÿè®¸æœ‰ç‚¹ä¹±äº†ï¼Œæˆ‘ä»¬ç¨å¾®å½’çº³ä¸€ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200523213113.png" alt=""></fancybox></p><p>ç¨‹åºå‘˜è¿˜æ˜¯çœ‹ä»£ç å¿ƒé‡Œè¸å®ä¸€ç‚¹ï¼Œæˆ‘ä»¬å†æ¥ç”¨ä»£ç è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„å…³ç³»ï¼ˆæ³¨æ„ä»£ç ä¸­çš„æ³¨é‡Šï¼Œä»¥ä¸‹çš„ä»£ç å¹¶ä¸æ˜¯å¾ˆä¸¥è°¨ï¼Œåªæ˜¯ä¸ºäº†ç®€å•è¯´æ˜ä¸Šå›¾çš„ä»£ç å®ç°ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.dayarch.myjuc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.AbstractQueuedSynchronizer;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰äº’æ–¥é”</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tanrgyb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/5/23 9:33 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMutex</span> <span class="keyword">implements</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€å†…éƒ¨ç±»-è‡ªå®šä¹‰åŒæ­¥å™¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MySync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span></span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨AQSæä¾›çš„æ–¹æ³•ï¼Œé€šè¿‡CASä¿è¯åŸå­æ€§</span></span><br><span class="line"><span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, arg))&#123;</span><br><span class="line"><span class="comment">// æˆ‘ä»¬å®ç°çš„æ˜¯äº’æ–¥é”ï¼Œæ‰€ä»¥æ ‡è®°è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼ˆæ›´æ–°stateæˆåŠŸï¼‰çš„çº¿ç¨‹ï¼Œ</span></span><br><span class="line"><span class="comment">// ä¸»è¦ä¸ºäº†åˆ¤æ–­æ˜¯å¦å¯é‡å…¥ï¼ˆä¸€ä¼šå„¿ä¼šè¯´æ˜ï¼‰</span></span><br><span class="line">setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line"><span class="comment">//è·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œè¿”å› true</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œè¿”å› false</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line"><span class="comment">// æœªæ‹¥æœ‰é”å´è®©é‡Šæ”¾ï¼Œä¼šæŠ›å‡ºIMSE</span></span><br><span class="line"><span class="keyword">if</span> (getState() == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯ä»¥é‡Šæ”¾ï¼Œæ¸…ç©ºæ’å®ƒçº¿ç¨‹æ ‡è®°</span></span><br><span class="line">setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®åŒæ­¥çŠ¶æ€ä¸º0ï¼Œè¡¨ç¤ºé‡Šæ”¾é”</span></span><br><span class="line">setState(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¯å¦ç‹¬å å¼æŒæœ‰</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> getState() == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åç»­ä¼šç”¨åˆ°ï¼Œä¸»è¦ç”¨äºç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œæ¯ä¸ªconditionéƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ï¼Œåœ¨é”æ¨¡å‹ä¸­è¯´æ˜è¿‡</span></span><br><span class="line"><span class="function">Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ConditionObject();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// èšåˆè‡ªå®šä¹‰åŒæ­¥å™¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MySync sync = <span class="keyword">new</span> MySync();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// é˜»å¡å¼çš„è·å–é”ï¼Œè°ƒç”¨åŒæ­¥å™¨æ¨¡ç‰ˆæ–¹æ³•ç‹¬å å¼ï¼Œè·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">sync.acquire(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨åŒæ­¥å™¨æ¨¡ç‰ˆæ–¹æ³•å¯ä¸­æ–­å¼è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨è‡ªå·±é‡å†™çš„æ–¹æ³•ï¼Œéé˜»å¡å¼çš„è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line"><span class="keyword">return</span> sync.tryAcquire(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨åŒæ­¥å™¨æ¨¡ç‰ˆæ–¹æ³•ï¼Œå¯å“åº”ä¸­æ–­å’Œè¶…æ—¶æ—¶é—´é™åˆ¶</span></span><br><span class="line"><span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>, unit.toNanos(time));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">sync.release(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„æ¡ä»¶</span></span><br><span class="line"><span class="keyword">return</span> sync.newCondition();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç°åœ¨æ‰“å¼€ IDEï¼Œ ä½ ä¼šå‘ç°ä¸Šæ–‡æåˆ°çš„  <code>ReentrantLock</code>  <code>ReentrantReadWriteLock</code>  <code>Semaphore(ä¿¡å·é‡)</code>  <code>CountDownLatch</code>  éƒ½æ˜¯æŒ‰ç…§è¿™ä¸ªç»“æ„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹ AQS çš„æ¨¡ç‰ˆæ–¹æ³•åˆ°åº•æ˜¯æ€ä¹ˆå®ç°é”</p><h2 id="AQSå®ç°åˆ†æ"><a href="#AQSå®ç°åˆ†æ" class="headerlink" title="AQSå®ç°åˆ†æ"></a>AQSå®ç°åˆ†æ</h2><p>ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½ åº”è¯¥ç†è§£äº†<code>lock.tryLock()</code> éé˜»å¡å¼è·å–é”å°±æ˜¯è°ƒç”¨è‡ªå®šä¹‰åŒæ­¥å™¨é‡å†™çš„ <code>tryAcquire()</code> æ–¹æ³•ï¼Œé€šè¿‡ CAS è®¾ç½®state çŠ¶æ€ï¼Œä¸ç®¡æˆåŠŸä¸å¦éƒ½ä¼šé©¬ä¸Šè¿”å›ï¼›é‚£ä¹ˆ lock.lock() è¿™ç§é˜»å¡å¼çš„é”æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ—</p><blockquote><p>CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰â€”â€”æ¦‚å¿µäº†è§£å°±å¥½ï¼Œä¸è¦è®°</p></blockquote><p>é˜Ÿåˆ—ä¸­æ¯ä¸ªæ’é˜Ÿçš„ä¸ªä½“å°±æ˜¯ä¸€ä¸ª Nodeï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Node çš„ç»“æ„</p><h3 id="Node-èŠ‚ç‚¹"><a href="#Node-èŠ‚ç‚¹" class="headerlink" title="Node èŠ‚ç‚¹"></a>Node èŠ‚ç‚¹</h3><p>AQS å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œç”¨äºç®¡ç†åŒæ­¥çŠ¶æ€ã€‚</p><ul><li>å½“çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼Œå°±ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œå°†å…¶åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å°¾éƒ¨ï¼Œé˜»å¡è¯¥çº¿ç¨‹</li><li>å½“åŒæ­¥çŠ¶æ€è¢«é‡Šæ”¾æ—¶ï¼Œä¼šå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­â€œé¦–èŠ‚ç‚¹â€çš„çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€</li></ul><p>ä¸ºäº†å°†ä¸Šè¿°æ­¥éª¤å¼„æ¸…æ¥šï¼Œæˆ‘ä»¬éœ€è¦æ¥çœ‹ä¸€çœ‹ Node ç»“æ„ ï¼ˆå¦‚æœä½ èƒ½æ‰“å¼€ IDE ä¸€èµ·çœ‹é‚£æ˜¯æå¥½çš„ï¼‰</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200524183916.png" alt=""></fancybox></p><p>ä¹ä¸€çœ‹æœ‰ç‚¹æ‚ä¹±ï¼Œæˆ‘ä»¬è¿˜æ˜¯å°†å…¶å½’ç±»è¯´æ˜ä¸€ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200524184014.png" alt=""></fancybox></p><p>ä¸Šé¢è¿™å‡ ä¸ªçŠ¶æ€è¯´æ˜æœ‰ä¸ªå°è±¡å°±å¥½ï¼Œæœ‰äº†Node çš„ç»“æ„è¯´æ˜é“ºå«ï¼Œä½ ä¹Ÿå°±èƒ½æƒ³è±¡åŒæ­¥é˜Ÿåˆ—çš„æ¥æœ¬ç»“æ„äº†ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200525072245.png" alt=""></fancybox></p><p>å‰ç½®çŸ¥è¯†åŸºæœ¬é“ºå«å®Œæ¯•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„æ•´ä¸ªè¿‡ç¨‹</p><h3 id="ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€"><a href="#ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€" class="headerlink" title="ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€"></a>ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€</h3><p>æ•…äº‹è¦ä»èŒƒå¼lock.lock() å¼€å§‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// é˜»å¡å¼çš„è·å–é”ï¼Œè°ƒç”¨åŒæ­¥å™¨æ¨¡ç‰ˆæ–¹æ³•ï¼Œè·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">sync.acquire(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥AQSçš„æ¨¡ç‰ˆæ–¹æ³• acquire()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨è‡ªå®šä¹‰åŒæ­¥å™¨é‡å†™çš„ tryAcquire æ–¹æ³•</span></span><br><span class="line"><span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œä¹Ÿä¼šå°è¯•éé˜»å¡çš„è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆtryAcquireè¿”å›falseï¼‰ï¼Œåˆ™ä¼šè°ƒç”¨ <code>addWaiter</code> æ–¹æ³•æ„é€  Node èŠ‚ç‚¹ï¼ˆNode.EXCLUSIVE ç‹¬å å¼ï¼‰å¹¶å®‰å…¨çš„ï¼ˆCASï¼‰åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ã€å°¾éƒ¨ã€‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ„é€ NodeèŠ‚ç‚¹ï¼ŒåŒ…å«å½“å‰çº¿ç¨‹ä¿¡æ¯ä»¥åŠèŠ‚ç‚¹æ¨¡å¼ã€ç‹¬å /å…±äº«ã€‘</span></span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">  <span class="comment">// æ–°å»ºå˜é‡ pred å°†æŒ‡é’ˆæŒ‡å‘tailæŒ‡å‘çš„èŠ‚ç‚¹</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">  <span class="comment">// å¦‚æœå°¾èŠ‚ç‚¹ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// æ–°åŠ å…¥çš„èŠ‚ç‚¹å‰é©±èŠ‚ç‚¹æŒ‡å‘å°¾èŠ‚ç‚¹</span></span><br><span class="line">        node.prev = pred;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å› ä¸ºå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åŒæ­¥çŠ¶æ€å¤±è´¥éƒ½ä¼šæ‰§è¡Œè¿™æ®µä»£ç </span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥ï¼Œé€šè¿‡ CAS æ–¹å¼ç¡®ä¿å®‰å…¨çš„è®¾ç½®å½“å‰èŠ‚ç‚¹ä¸ºæœ€æ–°çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">          <span class="comment">// æ›¾ç»çš„å°¾èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">            pred.next = node;</span><br><span class="line">          <span class="comment">// è¿”å›æ–°æ„å»ºçš„èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// å°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªè¢«åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹</span></span><br><span class="line">  <span class="comment">// éœ€è¦ä¸€ä¸ªå…¥é˜Ÿæ“ä½œ</span></span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡â€œæ­»å¾ªç¯â€ç¡®ä¿èŠ‚ç‚¹è¢«æ­£ç¡®æ·»åŠ ï¼Œæœ€ç»ˆå°†å…¶è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹ä¹‹åæ‰ä¼šè¿”å›ï¼Œè¿™é‡Œä½¿ç”¨ CAS çš„ç†ç”±å’Œä¸Šé¢ä¸€æ ·</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Node t = tail;</span><br><span class="line">      <span class="comment">// ç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œå¦‚æœå°¾èŠ‚ç‚¹ä¸º null</span></span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123; <span class="comment">// Must initialize</span></span><br><span class="line">          <span class="comment">// æ„å»ºä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œå¹¶å°†å¤´éƒ¨æŒ‡é’ˆæŒ‡å‘å®ƒ</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">              <span class="comment">// å°¾éƒ¨æŒ‡é’ˆåŒæ ·æŒ‡å‘å“¨å…µèŠ‚ç‚¹</span></span><br><span class="line">                tail = head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// ç¬¬äºŒæ¬¡å¾ªç¯ï¼Œå°†æ–°èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æŒ‡å‘t</span></span><br><span class="line">            node.prev = t;</span><br><span class="line">          <span class="comment">// å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—å°¾èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class="line">              <span class="comment">// å‰é©±èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æŒ‡å‘å½“å‰æ–°èŠ‚ç‚¹ï¼Œå®ŒæˆåŒå‘é˜Ÿåˆ—</span></span><br><span class="line">                t.next = node;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½æ¯”è¾ƒè¿·æƒ‘ enq() çš„å¤„ç†æ–¹å¼ï¼Œè¿›å…¥è¯¥æ–¹æ³•å°±æ˜¯ä¸€ä¸ªâ€œæ­»å¾ªç¯â€ï¼Œæˆ‘ä»¬å°±ç”¨å›¾æ¥æè¿°å®ƒæ˜¯æ€æ ·è·³å‡ºå¾ªç¯çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530135150.png" alt=""></fancybox></p><p>æœ‰äº›åŒå­¦å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰å“¨å…µèŠ‚ç‚¹ï¼Ÿ</p><blockquote><p>å“¨å…µï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨æ¥è§£å†³å›½å®¶ä¹‹é—´è¾¹ç•Œé—®é¢˜çš„ï¼Œä¸ç›´æ¥å‚ä¸ç”Ÿäº§æ´»åŠ¨ã€‚åŒæ ·ï¼Œè®¡ç®—æœºç§‘å­¦ä¸­æåˆ°çš„å“¨å…µï¼Œä¹Ÿç”¨æ¥è§£å†³è¾¹ç•Œé—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰è¾¹ç•Œï¼ŒæŒ‡å®šç¯èŠ‚ï¼ŒæŒ‰ç…§åŒæ ·ç®—æ³•å¯èƒ½ä¼šåœ¨è¾¹ç•Œå¤„å‘ç”Ÿå¼‚å¸¸ï¼Œæ¯”å¦‚è¦ç»§ç»­å‘ä¸‹åˆ†æçš„ <code>acquireQueued()</code> æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">      <span class="comment">// "æ­»å¾ªç¯"ï¼Œå°è¯•è·å–é”ï¼Œæˆ–è€…æŒ‚èµ·</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">          <span class="comment">// è·å–å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">          <span class="comment">// åªæœ‰å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼Œæ‰ä¼šå°è¯•è·å–é”</span></span><br><span class="line">          <span class="comment">// çœ‹åˆ°è¿™ä½ åº”è¯¥ç†è§£æ·»åŠ å“¨å…µèŠ‚ç‚¹çš„å«ä¹‰äº†å§</span></span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">              <span class="comment">// è·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œå°†è‡ªå·±è®¾ç½®ä¸ºå¤´</span></span><br><span class="line">                setHead(node);</span><br><span class="line">              <span class="comment">// å°†å“¨å…µèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ç½®ä¸ºç©ºï¼Œæ–¹ä¾¿GC</span></span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">              <span class="comment">// è¿”å›ä¸­æ–­æ ‡è¯†</span></span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ä¸æ˜¯å¤´èŠ‚ç‚¹</span></span><br><span class="line">          <span class="comment">//ã€æˆ–è€…ã€‘å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ä½†è·å–åŒæ­¥çŠ¶æ€å¤±è´¥</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–åŒæ­¥çŠ¶æ€æˆåŠŸä¼šè¿”å›å¯ä»¥ç†è§£äº†ï¼Œä½†æ˜¯å¦‚æœå¤±è´¥å°±ä¼šä¸€ç›´é™·å…¥åˆ°â€œæ­»å¾ªç¯â€ä¸­æµªè´¹èµ„æºå—ï¼Ÿå¾ˆæ˜¾ç„¶ä¸æ˜¯ï¼Œ<code>shouldParkAfterFailedAcquire(p, node)</code> å’Œ <code>parkAndCheckInterrupt()</code> å°±ä¼šå°†çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹æŒ‚èµ·ï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span> ws = pred.waitStatus;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ SIGNAL çŠ¶æ€ï¼Œå³ç­‰å¾…è¢«å ç”¨çš„èµ„æºé‡Šæ”¾ï¼Œç›´æ¥è¿”å› true</span></span><br><span class="line">  <span class="comment">// å‡†å¤‡ç»§ç»­è°ƒç”¨ parkAndCheckInterrupt æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (ws == Node.SIGNAL)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="comment">// ws å¤§äº0è¯´æ˜æ˜¯CANCELLEDçŠ¶æ€ï¼Œ</span></span><br><span class="line">    <span class="keyword">if</span> (ws &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å¾ªç¯åˆ¤æ–­å‰é©±èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¦ä¹Ÿä¸ºCANCELLEDçŠ¶æ€ï¼Œå¿½ç•¥è¯¥çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œé‡æ–°è¿æ¥é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            node.prev = pred = pred.prev;</span><br><span class="line">        &#125; <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>);</span><br><span class="line">        pred.next = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å°†å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹è®¾ç½®ä¸ºè®¾ç½®ä¸º SIGNAL çŠ¶æ€ï¼Œç”¨äºåç»­å”¤é†’æ“ä½œ</span></span><br><span class="line">      <span class="comment">// ç¨‹åºç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°è¿™è¿”å›ä¸ºfalseï¼Œè¿˜ä¼šè¿›è¡Œå¤–å±‚ç¬¬äºŒæ¬¡å¾ªç¯ï¼Œæœ€ç»ˆä»ä»£ç ç¬¬7è¡Œè¿”å›</span></span><br><span class="line">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä½ ä¹Ÿè®¸æœ‰ä¸ªé—®é¢˜ï¼š</p><blockquote><p>è¿™ä¸ªåœ°æ–¹è®¾ç½®å‰é©±èŠ‚ç‚¹ä¸º SIGNAL çŠ¶æ€åˆ°åº•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p></blockquote><p>ä¿ç•™è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é™†ç»­æ­æ™“</p><p>å¦‚æœå‰é©±èŠ‚ç‚¹çš„ waitStatus æ˜¯ SIGNALçŠ¶æ€ï¼Œå³ shouldParkAfterFailedAcquire æ–¹æ³•ä¼šè¿”å› true ï¼Œç¨‹åºä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ <code>parkAndCheckInterrupt</code> æ–¹æ³•ï¼Œç”¨äºå°†å½“å‰çº¿ç¨‹æŒ‚èµ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// çº¿ç¨‹æŒ‚èµ·ï¼Œç¨‹åºä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</span></span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">  <span class="comment">// æ ¹æ® park æ–¹æ³• APIæè¿°ï¼Œç¨‹åºåœ¨ä¸‹è¿°ä¸‰ç§æƒ…å†µä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</span></span><br><span class="line">  <span class="comment">// 1. è¢« unpark </span></span><br><span class="line">  <span class="comment">// 2. è¢«ä¸­æ–­(interrupt)</span></span><br><span class="line">  <span class="comment">// 3. å…¶ä»–ä¸åˆé€»è¾‘çš„è¿”å›æ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å› ä¸Šè¿°ä¸‰ç§æƒ…å†µç¨‹åºæ‰§è¡Œè‡³æ­¤ï¼Œè¿”å›å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶æ¸…ç©ºä¸­æ–­çŠ¶æ€</span></span><br><span class="line">  <span class="comment">// å¦‚æœç”±äºè¢«ä¸­æ–­ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å› true</span></span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¢«å”¤é†’çš„ç¨‹åºä¼šç»§ç»­æ‰§è¡Œ <code>acquireQueued</code> æ–¹æ³•é‡Œçš„å¾ªç¯ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ä¼šè¿”å› <code>interrupted = true</code> çš„ç»“æœ</p><p>ç¨‹åºç»§ç»­å‘è°ƒç”¨æ ˆä¸Šå±‚è¿”å›ï¼Œæœ€ç»ˆå›åˆ° AQS çš„æ¨¡ç‰ˆæ–¹æ³• <code>acquire</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿè®¸ä¼šæœ‰ç–‘æƒ‘:</p><blockquote><p>ç¨‹åºå·²ç»æˆåŠŸè·å–åˆ°åŒæ­¥çŠ¶æ€å¹¶è¿”å›äº†ï¼Œæ€ä¹ˆä¼šæœ‰ä¸ªè‡ªæˆ‘ä¸­æ–­å‘¢ï¼Ÿ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selfInterrupt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread.currentThread().interrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530171736.png" alt=""></fancybox></p><p>å¦‚æœä½ ä¸èƒ½ç†è§£ä¸­æ–­ï¼Œå¼ºçƒˆå»ºè®®ä½ å›çœ‹ <a href="https://dayarch.top/p/java-concurrency-interrupt-mechnism.html">Javaå¤šçº¿ç¨‹ä¸­æ–­æœºåˆ¶</a></p><p>åˆ°è¿™é‡Œå…³äºè·å–åŒæ­¥çŠ¶æ€æˆ‘ä»¬è¿˜é—æ¼äº†ä¸€æ¡çº¿ï¼ŒacquireQueued çš„ finally ä»£ç å—å¦‚æœä½ ä»”ç»†çœ‹ä½ ä¹Ÿè®¸é©¬ä¸Šå°±ä¼šæœ‰ç–‘æƒ‘:</p><blockquote><p>åˆ°åº•ä»€ä¹ˆæƒ…å†µæ‰ä¼šæ‰§è¡Œ if(failed) é‡Œé¢çš„ä»£ç  ï¼Ÿ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (failed)</span><br><span class="line">  cancelAcquire(node);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¢«æ‰§è¡Œçš„æ¡ä»¶æ˜¯ failed ä¸º trueï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœè·³å‡ºå¾ªç¯ï¼Œfailed çš„å€¼ä¸ºfalseï¼Œå¦‚æœä¸èƒ½è·³å‡ºå¾ªç¯è²Œä¼¼æ€ä¹ˆä¹Ÿä¸èƒ½æ‰§è¡Œåˆ°è¿™é‡Œï¼Œæ‰€ä»¥åªæœ‰ä¸æ­£å¸¸çš„æƒ…å†µæ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œä¹Ÿå°±æ˜¯ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ‰ä¼šæ‰§è¡Œåˆ°æ­¤å¤„</p><p>æŸ¥çœ‹ try ä»£ç å—ï¼Œåªæœ‰ä¸¤ä¸ªæ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p><ul><li><p><code>node.processor()</code> æ–¹æ³•</p></li><li><p>è‡ªå·±é‡å†™çš„ <code>tryAcquire()</code> æ–¹æ³•</p></li></ul><p>å…ˆçœ‹å‰è€…ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200525201815.png" alt=""></fancybox></p><p>å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡ŒæŠ›å‡ºçš„å¼‚å¸¸ä¸æ˜¯é‡ç‚¹ï¼Œé‚£å°±ä»¥ ReentrantLock é‡å†™çš„ tryAcquire() æ–¹æ³•ä¸ºä¾‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200525202215.png" alt=""></fancybox></p><p>å¦å¤–ï¼Œä¸Šé¢åˆ†æ <code>shouldParkAfterFailedAcquire</code> æ–¹æ³•è¿˜å¯¹ CANCELLED çš„çŠ¶æ€è¿›è¡Œäº†åˆ¤æ–­ï¼Œé‚£ä¹ˆ</p><blockquote><p>ä»€ä¹ˆæ—¶å€™ä¼šç”Ÿæˆå–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹å‘¢ï¼Ÿ</p></blockquote><p>ç­”æ¡ˆå°±åœ¨ <code>cancelAcquire</code> æ–¹æ³•ä¸­ï¼Œ æˆ‘ä»¬æ¥çœ‹çœ‹ cancelAcquireåˆ°åº•æ€ä¹ˆè®¾ç½®/å¤„ç† CANNELLED çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cancelAcquire</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// å¿½ç•¥æ— æ•ˆèŠ‚ç‚¹</span></span><br><span class="line">       <span class="keyword">if</span> (node == <span class="keyword">null</span>)</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">// å°†å…³è”çš„çº¿ç¨‹ä¿¡æ¯æ¸…ç©º</span></span><br><span class="line">       node.thread = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// è·³è¿‡åŒæ ·æ˜¯å–æ¶ˆçŠ¶æ€çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">       Node pred = node.prev;</span><br><span class="line">       <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>)</span><br><span class="line">           node.prev = pred = pred.prev;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// è·³å‡ºä¸Šé¢å¾ªç¯åæ‰¾åˆ°å‰é©±æœ‰æ•ˆèŠ‚ç‚¹ï¼Œå¹¶è·å–è¯¥æœ‰æ•ˆèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line">       Node predNext = pred.next;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å°†å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ç½®ä¸º CANCELLED</span></span><br><span class="line">       node.waitStatus = Node.CANCELLED;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹å¤„åœ¨å°¾èŠ‚ç‚¹ï¼Œç›´æ¥ä»é˜Ÿåˆ—ä¸­åˆ é™¤è‡ªå·±å°±å¥½</span></span><br><span class="line">       <span class="keyword">if</span> (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123;</span><br><span class="line">           compareAndSetNext(pred, predNext, <span class="keyword">null</span>);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">int</span> ws;</span><br><span class="line">         <span class="comment">// 1. å¦‚æœå½“å‰èŠ‚ç‚¹çš„æœ‰æ•ˆå‰é©±èŠ‚ç‚¹ä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰èŠ‚ç‚¹ä¸æ˜¯å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line">           <span class="keyword">if</span> (pred != head &amp;&amp;</span><br><span class="line">               <span class="comment">// 2. åˆ¤æ–­å½“å‰èŠ‚ç‚¹æœ‰æ•ˆå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯å¦ä¸º SIGNAL</span></span><br><span class="line">               ((ws = pred.waitStatus) == Node.SIGNAL ||</span><br><span class="line">                <span class="comment">// 3. å¦‚æœä¸æ˜¯ï¼Œå°è¯•å°†å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ç½®ä¸º SIGNAL</span></span><br><span class="line">                (ws &lt;= <span class="number">0</span> &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp;</span><br><span class="line">               <span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹æœ‰æ•ˆå‰é©±èŠ‚ç‚¹çš„çº¿ç¨‹ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">               pred.thread != <span class="keyword">null</span>) &#123;</span><br><span class="line">             <span class="comment">// ä¸Šè¿°æ¡ä»¶æ»¡è¶³</span></span><br><span class="line">               Node next = node.next;</span><br><span class="line">             <span class="comment">// å°†å½“å‰èŠ‚ç‚¹æœ‰æ•ˆå‰é©±èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line">               <span class="keyword">if</span> (next != <span class="keyword">null</span> &amp;&amp; next.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                   compareAndSetNext(pred, predNext, next);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼Œæˆ–è€…ä¸Šè¿°å…¶ä»–æ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±å”¤é†’å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line">               unparkSuccessor(node);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           node.next = node; <span class="comment">// help GC</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™ä¸ªæ³¨é‡Šä½ å¯èƒ½æœ‰äº›ä¹±äº†ï¼Œå…¶æ ¸å¿ƒç›®çš„å°±æ˜¯ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ CANCELLED çš„èŠ‚ç‚¹ï¼Œå¹¶é‡æ–°æ‹¼æ¥æ•´ä¸ªé˜Ÿåˆ—ï¼Œæ€»ç»“æ¥çœ‹ï¼Œå…¶å®è®¾ç½® CANCELLED çŠ¶æ€èŠ‚ç‚¹åªæ˜¯æœ‰ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬é€šè¿‡ç”»å›¾æ¥åˆ†æä¸€ä¸‹ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200527104935.png" alt=""></fancybox></p><hr><p><fancybox><img src="https://rgyb.sunluomeng.top/20200527105017.png" alt=""></fancybox></p><hr><p><fancybox><img src="https://rgyb.sunluomeng.top/20200527105040.png" alt=""></fancybox></p><p>è‡³æ­¤ï¼Œè·å–åŒæ­¥çŠ¶æ€çš„è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæˆ‘ä»¬ç®€å•çš„ç”¨æµç¨‹å›¾è¯´æ˜ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200527112235.png" alt=""></fancybox></p><p>è·å–é”çš„è¿‡ç¨‹å°±è¿™æ ·çš„ç»“æŸäº†ï¼Œå…ˆæš‚åœå‡ åˆ†é’Ÿæ•´ç†ä¸€ä¸‹è‡ªå·±çš„æ€è·¯ã€‚æˆ‘ä»¬ä¸Šé¢è¿˜æ²¡æœ‰è¯´æ˜ SIGNAL çš„ä½œç”¨ï¼Œ SIGNAL çŠ¶æ€ä¿¡å·åˆ°åº•æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿè¿™å°±æ¶‰åŠåˆ°é”çš„é‡Šæ”¾äº†ï¼Œæˆ‘ä»¬æ¥ç»§ç»­äº†è§£ï¼Œæ•´ä½“æ€è·¯å’Œé”çš„è·å–æ˜¯ä¸€æ ·çš„ï¼Œ ä½†æ˜¯é‡Šæ”¾è¿‡ç¨‹å°±ç›¸å¯¹ç®€å•å¾ˆå¤šäº†</p><h3 id="ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€"><a href="#ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€" class="headerlink" title="ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€"></a>ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</h3><p>æ•…äº‹è¦ä» unlock() æ–¹æ³•è¯´èµ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">sync.release(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ AQS æ¨¡ç‰ˆæ–¹æ³• releaseï¼Œè¿›å…¥è¯¥æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨è‡ªå®šä¹‰åŒæ­¥å™¨é‡å†™çš„ tryRelease æ–¹æ³•å°è¯•é‡Šæ”¾åŒæ­¥çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">      <span class="comment">// é‡Šæ”¾æˆåŠŸï¼Œè·å–å¤´èŠ‚ç‚¹</span></span><br><span class="line">        Node h = head;</span><br><span class="line">      <span class="comment">// å­˜åœ¨å¤´èŠ‚ç‚¹ï¼Œå¹¶ä¸”waitStatusä¸æ˜¯åˆå§‹çŠ¶æ€</span></span><br><span class="line">      <span class="comment">// é€šè¿‡è·å–çš„è¿‡ç¨‹æˆ‘ä»¬å·²ç»åˆ†æäº†ï¼Œåœ¨è·å–çš„è¿‡ç¨‹ä¸­ä¼šå°† waitStatusçš„å€¼ä»åˆå§‹çŠ¶æ€æ›´æ–°æˆ SIGNAL çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">          <span class="comment">// è§£é™¤çº¿ç¨‹æŒ‚èµ·çŠ¶æ€</span></span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ unparkSuccessor æ–¹æ³•ï¼Œå®é™…æ˜¯è¦å”¤é†’å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>&#123;      </span><br><span class="line">  <span class="comment">// è·å–å¤´èŠ‚ç‚¹çš„waitStatus</span></span><br><span class="line">    <span class="keyword">int</span> ws = node.waitStatus;</span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="comment">// æ¸…ç©ºå¤´èŠ‚ç‚¹çš„waitStatuså€¼ï¼Œå³ç½®ä¸º0</span></span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line">    Node s = node.next;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æ˜¯å¦æ˜¯å–æ¶ˆçŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œéœ€è¦ç§»é™¤ï¼Œé‡æ–°è¿æ¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        s = <span class="keyword">null</span>;</span><br><span class="line">      <span class="comment">// ä»å°¾èŠ‚ç‚¹å‘å‰æŸ¥æ‰¾ï¼Œæ‰¾åˆ°é˜Ÿåˆ—ç¬¬ä¸€ä¸ªwaitStatusçŠ¶æ€å°äº0çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">          <span class="comment">// å¦‚æœæ˜¯ç‹¬å å¼ï¼Œè¿™é‡Œå°äº0ï¼Œå…¶å®å°±æ˜¯ SIGNAL</span></span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="keyword">null</span>)</span><br><span class="line">      <span class="comment">// è§£é™¤çº¿ç¨‹æŒ‚èµ·çŠ¶æ€</span></span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰åŒå­¦å¯èƒ½æœ‰ç–‘é—®ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆè¿™ä¸ªåœ°æ–¹æ˜¯ä»é˜Ÿåˆ—å°¾éƒ¨å‘å‰æŸ¥æ‰¾ä¸æ˜¯ CANCELLED çš„èŠ‚ç‚¹ï¼Ÿ</p></blockquote><p>åŸå› æœ‰ä¸¤ä¸ªï¼š</p><p>ç¬¬ä¸€ï¼Œå…ˆå›çœ‹èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—çš„æƒ…æ™¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">        node.prev = pred;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">            pred.next = node;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èŠ‚ç‚¹å…¥é˜Ÿå¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œä»£ç ç¬¬6ã€7è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.prev = pred; </span><br><span class="line">compareAndSetTail(pred, node)</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªåœ°æ–¹å¯ä»¥çœ‹ä½œæ˜¯å°¾èŠ‚ç‚¹å…¥é˜Ÿçš„åŸå­æ“ä½œï¼Œå¦‚æœæ­¤æ—¶ä»£ç è¿˜æ²¡æ‰§è¡Œåˆ° pred.next = node; è¿™æ—¶åˆæ°å·§æ‰§è¡Œäº†unparkSuccessoræ–¹æ³•ï¼Œå°±æ²¡åŠæ³•ä»å‰å¾€åæ‰¾äº†ï¼Œå› ä¸ºåç»§æŒ‡é’ˆè¿˜æ²¡æœ‰è¿æ¥èµ·æ¥ï¼Œæ‰€ä»¥éœ€è¦ä»åå¾€å‰æ‰¾</p><p>ç¬¬äºŒç‚¹åŸå› ï¼Œåœ¨ä¸Šé¢å›¾è§£äº§ç”Ÿ CANCELLED çŠ¶æ€èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå…ˆæ–­å¼€çš„æ˜¯ Next æŒ‡é’ˆï¼ŒPrevæŒ‡é’ˆå¹¶æœªæ–­å¼€ï¼Œå› æ­¤è¿™ä¹Ÿæ˜¯å¿…é¡»è¦ä»åå¾€å‰éå†æ‰èƒ½å¤Ÿéå†å®Œå…¨éƒ¨çš„Node</p><p>åŒæ­¥çŠ¶æ€è‡³æ­¤å°±å·²ç»æˆåŠŸé‡Šæ”¾äº†ï¼Œä¹‹å‰è·å–åŒæ­¥çŠ¶æ€è¢«æŒ‚èµ·çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ï¼Œç»§ç»­ä»ä¸‹é¢ä»£ç ç¬¬ 3 è¡Œè¿”å›æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è¿”å›ä¸Šå±‚è°ƒç”¨æ ˆ, ä»ä¸‹é¢ä»£ç 15è¡Œå¼€å§‹æ‰§è¡Œï¼Œé‡æ–°æ‰§è¡Œå¾ªç¯ï¼Œå†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå…³äºç‹¬å å¼è·å–/é‡Šæ”¾é”çš„æµç¨‹å·²ç»é—­ç¯äº†ï¼Œä½†æ˜¯å…³äº AQS çš„å¦å¤–ä¸¤ä¸ªæ¨¡ç‰ˆæ–¹æ³•è¿˜æ²¡æœ‰ä»‹ç»</p><ul><li><code>å“åº”ä¸­æ–­</code></li><li><code>è¶…æ—¶é™åˆ¶</code> </li></ul><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530195432.png" alt=""></fancybox></p><h3 id="ç‹¬å å¼å“åº”ä¸­æ–­è·å–åŒæ­¥çŠ¶æ€"><a href="#ç‹¬å å¼å“åº”ä¸­æ–­è·å–åŒæ­¥çŠ¶æ€" class="headerlink" title="ç‹¬å å¼å“åº”ä¸­æ–­è·å–åŒæ­¥çŠ¶æ€"></a>ç‹¬å å¼å“åº”ä¸­æ–­è·å–åŒæ­¥çŠ¶æ€</h3><p>æ•…äº‹è¦ä»lock.lockInterruptibly() æ–¹æ³•è¯´èµ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨åŒæ­¥å™¨æ¨¡ç‰ˆæ–¹æ³•å¯ä¸­æ–­å¼è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†å‰é¢çš„ç†è§£ï¼Œç†è§£ç‹¬å å¼å¯å“åº”ä¸­æ–­çš„è·å–åŒæ­¥çŠ¶æ€æ–¹å¼ï¼ŒçœŸæ˜¯ä¸€çœ¼å°±èƒ½æ˜ç™½äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">  <span class="comment">// å°è¯•éé˜»å¡å¼è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œæ‰§è¡Œä»£ç 7è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg))</span><br><span class="line">        doAcquireInterruptibly(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­æŸ¥çœ‹ <code>doAcquireInterruptibly</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAcquireInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.EXCLUSIVE);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">              <span class="comment">// è·å–ä¸­æ–­ä¿¡å·åï¼Œä¸å†è¿”å› interrupted = true çš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡º InterruptedException </span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æƒ³åˆ° JDK å†…éƒ¨ä¹Ÿæœ‰å¦‚æ­¤ç›¸è¿‘çš„ä»£ç ï¼Œå¯å“åº”ä¸­æ–­è·å–é”æ²¡ä»€ä¹ˆæ·±å¥¥çš„ï¼Œå°±æ˜¯è¢«ä¸­æ–­æŠ›å‡º InterruptedException å¼‚å¸¸ï¼ˆä»£ç ç¬¬17è¡Œï¼‰ï¼Œè¿™æ ·å°±é€å±‚è¿”å›ä¸Šå±‚è°ƒç”¨æ ˆæ•è·è¯¥å¼‚å¸¸è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œäº†</p><p>è¶çƒ­æ‰“é“ï¼Œæ¥çœ‹çœ‹å¦å¤–ä¸€ä¸ªæ¨¡ç‰ˆæ–¹æ³•ï¼š</p><h3 id="ç‹¬å å¼è¶…æ—¶é™åˆ¶è·å–åŒæ­¥çŠ¶æ€"><a href="#ç‹¬å å¼è¶…æ—¶é™åˆ¶è·å–åŒæ­¥çŠ¶æ€" class="headerlink" title="ç‹¬å å¼è¶…æ—¶é™åˆ¶è·å–åŒæ­¥çŠ¶æ€"></a>ç‹¬å å¼è¶…æ—¶é™åˆ¶è·å–åŒæ­¥çŠ¶æ€</h3><p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ç»™å®šä¸€ä¸ªæ—¶é™ï¼Œåœ¨è¯¥æ—¶é—´æ®µå†…è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°±è¿”å› trueï¼Œ å¦åˆ™ï¼Œè¿”å› falseã€‚å¥½æ¯”çº¿ç¨‹ç»™è‡ªå·±å®šäº†ä¸€ä¸ªé—¹é’Ÿï¼Œé—¹é“ƒä¸€å“ï¼Œçº¿ç¨‹å°±è‡ªå·±è¿”å›äº†ï¼Œè¿™å°±ä¸ä¼šä½¿è‡ªå·±æ˜¯é˜»å¡çŠ¶æ€äº†</p><p>æ—¢ç„¶æ¶‰åŠåˆ°è¶…æ—¶é™åˆ¶ï¼Œå…¶æ ¸å¿ƒé€»è¾‘è‚¯å®šæ˜¯è®¡ç®—æ—¶é—´é—´éš”ï¼Œå› ä¸ºåœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œè‚¯å®šæ˜¯å¤šæ¬¡å°è¯•è·å–é”çš„ï¼Œæ¯æ¬¡è·å–é”è‚¯å®šæœ‰æ—¶é—´æ¶ˆè€—ï¼Œæ‰€ä»¥è®¡ç®—æ—¶é—´é—´éš”çš„é€»è¾‘å°±åƒæˆ‘ä»¬åœ¨ç¨‹åºæ‰“å°ç¨‹åºè€—æ—¶ log é‚£ä¹ˆç®€å•</p><blockquote><p>nanosTimeout = deadline - System.nanoTime()</p></blockquote><p>æ•…äº‹è¦ä» <code>lock.tryLock(time, unit)</code> æ–¹æ³•è¯´èµ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨åŒæ­¥å™¨æ¨¡ç‰ˆæ–¹æ³•ï¼Œå¯å“åº”ä¸­æ–­å’Œè¶…æ—¶æ—¶é—´é™åˆ¶</span></span><br><span class="line"><span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>, unit.toNanos(time));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ tryAcquireNanos æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquireNanos</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">long</span> nanosTimeout)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">    <span class="keyword">return</span> tryAcquire(arg) ||</span><br><span class="line">        doAcquireNanos(arg, nanosTimeout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å’Œä¸Šé¢ <code>acquireInterruptibly</code>  æ–¹æ³•é•¿ç›¸å¾ˆè¯¦ç»†äº†ï¼Œç»§ç»­æŸ¥çœ‹æ¥ doAcquireNanos æ–¹æ³•ï¼Œçœ‹ç¨‹åº, è¯¥æ–¹æ³•ä¹Ÿæ˜¯ throws InterruptedExceptionï¼Œæˆ‘ä»¬åœ¨ä¸­æ–­æ–‡ç« ä¸­è¯´è¿‡ï¼Œæ–¹æ³•æ ‡è®°ä¸Šæœ‰ <code>throws InterruptedException</code> è¯´æ˜è¯¥æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç†è§£è¶…æ—¶é™åˆ¶æ˜¯ <code>acquireInterruptibly</code> æ–¹æ³•çš„åŠ å¼ºç‰ˆï¼Œå…·æœ‰è¶…æ—¶å’Œéé˜»å¡æ§åˆ¶çš„åŒä¿é™©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">doAcquireNanos</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">long</span> nanosTimeout)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">  <span class="comment">// è¶…æ—¶æ—¶é—´å†…ï¼Œä¸ºè·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œç›´æ¥è¿”å›false</span></span><br><span class="line">    <span class="keyword">if</span> (nanosTimeout &lt;= <span class="number">0L</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="comment">// è®¡ç®—è¶…æ—¶æˆªæ­¢æ—¶é—´</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> deadline = System.nanoTime() + nanosTimeout;</span><br><span class="line">  <span class="comment">// ä»¥ç‹¬å æ–¹å¼åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.EXCLUSIVE);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// è®¡ç®—æ–°çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">            nanosTimeout = deadline - System.nanoTime();</span><br><span class="line">          <span class="comment">// å¦‚æœè¶…æ—¶ï¼Œç›´æ¥è¿”å› false</span></span><br><span class="line">            <span class="keyword">if</span> (nanosTimeout &lt;= <span class="number">0L</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯æœ€æ–°è¶…æ—¶æ—¶é—´æ˜¯å¦å¤§äºé˜ˆå€¼ 1000    </span></span><br><span class="line">                nanosTimeout &gt; spinForTimeoutThreshold)</span><br><span class="line">              <span class="comment">// æŒ‚èµ·çº¿ç¨‹ nanosTimeout é•¿æ—¶é—´ï¼Œæ—¶é—´åˆ°ï¼Œè‡ªåŠ¨è¿”å›</span></span><br><span class="line">                LockSupport.parkNanos(<span class="keyword">this</span>, nanosTimeout);</span><br><span class="line">            <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•åº”è¯¥ä¸æ˜¯å¾ˆéš¾æ‡‚ï¼Œä½†æ˜¯åˆåŒå­¦å¯èƒ½åœ¨ç¬¬ 27 è¡Œä¸Šæœ‰æ‰€å›°æƒ‘</p><blockquote><p>ä¸ºä»€ä¹ˆ nanosTimeout å’Œ è‡ªæ—‹è¶…æ—¶é˜ˆå€¼1000è¿›è¡Œæ¯”è¾ƒï¼Ÿ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * The number of nanoseconds for which it is faster to spin</span><br><span class="line"> * rather than to use timed park. A rough estimate suffices</span><br><span class="line"> * to improve responsiveness with very short timeouts.</span><br><span class="line"> */</span><br><span class="line">static final long spinForTimeoutThreshold = 1000L;</span><br></pre></td></tr></table></figure><p>å…¶å® doc è¯´çš„å¾ˆæ¸…æ¥šï¼Œè¯´ç™½äº†ï¼Œ1000 nanoseconds æ—¶é—´å·²ç»éå¸¸éå¸¸çŸ­æš‚äº†ï¼Œæ²¡å¿…è¦å†æ‰§è¡ŒæŒ‚èµ·å’Œå”¤é†’æ“ä½œäº†ï¼Œä¸å¦‚ç›´æ¥å½“å‰çº¿ç¨‹ç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ MyMutex åªå·® Condition æ²¡æœ‰è¯´æ˜äº†ï¼Œä¸çŸ¥é“ä½ ç´¯äº†å—ï¼Ÿæˆ‘è¿˜åœ¨åšæŒ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530195521.png" alt=""></fancybox></p><h3 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h3><p>å¦‚æœä½ çœ‹è¿‡ä¹‹å‰å†™çš„ <a href="https://dayarch.top/p/waiting-notification-mechanism.html">å¹¶å‘ç¼–ç¨‹ä¹‹ç­‰å¾…é€šçŸ¥æœºåˆ¶</a> ï¼Œä½ åº”è¯¥å¯¹ä¸‹é¢è¿™ä¸ªå›¾æ˜¯æœ‰å°è±¡çš„ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315110223.png" alt=""></fancybox></p><p>å¦‚æœå½“æ—¶ä½ ç†è§£äº†è¿™ä¸ªæ¨¡å‹ï¼Œå†çœ‹ Condition çš„å®ç°ï¼Œæ ¹æœ¬å°±ä¸æ˜¯é—®é¢˜äº†ï¼Œé¦–å…ˆ Condition è¿˜æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè‚¯å®šä¹Ÿæ˜¯éœ€è¦æœ‰å®ç°ç±»çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530200503.png" alt=""></fancybox></p><p>é‚£æ•…äº‹å°±ä» <code>lock.newnewCondition</code> è¯´èµ·å§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„æ¡ä»¶</span></span><br><span class="line"><span class="keyword">return</span> sync.newCondition();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰åŒæ­¥å™¨é‡å°è£…äº†è¯¥æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ConditionObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ConditionObject å°±æ˜¯ Condition çš„å®ç°ç±»ï¼Œè¯¥ç±»å°±å®šä¹‰åœ¨äº† AQS ä¸­ï¼Œåªæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** First node of condition queue. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Node firstWaiter;</span><br><span class="line"><span class="comment">/** Last node of condition queue. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Node lastWaiter;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ¥çœ‹ä¸€ä¸‹ ConditionObject å®ç°çš„ await / signal æ–¹æ³•æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªæˆå‘˜å˜é‡å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">  <span class="comment">// åŒæ ·æ„å»º Node èŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    Node node = addConditionWaiter();</span><br><span class="line">  <span class="comment">// é‡Šæ”¾åŒæ­¥çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span> savedState = fullyRelease(node);</span><br><span class="line">    <span class="keyword">int</span> interruptMode = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!isOnSyncQueue(node)) &#123;</span><br><span class="line">      <span class="comment">// æŒ‚èµ·å½“å‰çº¿ç¨‹</span></span><br><span class="line">        LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> ((interruptMode = checkInterruptWhileWaiting(node)) != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class="line">        interruptMode = REINTERRUPT;</span><br><span class="line">    <span class="keyword">if</span> (node.nextWaiter != <span class="keyword">null</span>) <span class="comment">// clean up if cancelled</span></span><br><span class="line">        unlinkCancelledWaiters();</span><br><span class="line">    <span class="keyword">if</span> (interruptMode != <span class="number">0</span>)</span><br><span class="line">        reportInterruptAfterWait(interruptMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ç”¨è¯ï¼Œåœ¨ä»‹ç»è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼ŒaddWaiter æ˜¯åŠ å…¥åˆ°ã€åŒæ­¥é˜Ÿåˆ—ã€‘ï¼Œå°±æ˜¯ä¸Šå›¾è¯´çš„å…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œè¿™é‡Œè¯´çš„æ˜¯ã€ç­‰å¾…é˜Ÿåˆ—ã€‘ï¼Œæ‰€ä»¥ addConditionWaiter è‚¯å®šæ˜¯æ„å»ºäº†ä¸€ä¸ªè‡ªå·±çš„é˜Ÿåˆ—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addConditionWaiter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node t = lastWaiter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (t != <span class="keyword">null</span> &amp;&amp; t.waitStatus != Node.CONDITION) &#123;</span><br><span class="line">        unlinkCancelledWaiters();</span><br><span class="line">        t = lastWaiter;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// æ–°æ„å»ºçš„èŠ‚ç‚¹çš„ waitStatus æ˜¯ CONDITIONï¼Œæ³¨æ„ä¸æ˜¯ 0 æˆ– SIGNAL äº†</span></span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), Node.CONDITION);</span><br><span class="line">  <span class="comment">// æ„å»ºå•å‘åŒæ­¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>)</span><br><span class="line">        firstWaiter = node;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        t.nextWaiter = node;</span><br><span class="line">    lastWaiter = node;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰æœ‹å‹å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯å•å‘é˜Ÿåˆ—ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨CAS æ¥ä¿è¯åŠ å…¥é˜Ÿåˆ—çš„å®‰å…¨æ€§å‘¢ï¼Ÿ</p></blockquote><p>å› ä¸º await æ˜¯ Lock èŒƒå¼ try ä¸­ä½¿ç”¨çš„ï¼Œè¯´æ˜å·²ç»è·å–åˆ°é”äº†ï¼Œæ‰€ä»¥å°±æ²¡å¿…è¦ä½¿ç”¨ CAS äº†ï¼Œè‡³äºæ˜¯å•å‘ï¼Œå› ä¸ºè¿™é‡Œè¿˜ä¸æ¶‰åŠåˆ°ç«äº‰é”ï¼Œåªæ˜¯åšä¸€ä¸ªæ¡ä»¶ç­‰å¾…é˜Ÿåˆ—</p><p>åœ¨ Lock ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶éƒ½ä¼šå¯¹åº”ä¸€ä¸ª æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ï¼Œæ‰€ä»¥å°†ä¸Šå›¾ä¸°å¯Œè¯´æ˜ä¸€ä¸‹å°±å˜æˆäº†è¿™ä¸ªæ ·å­ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530205315.png" alt=""></fancybox></p><p>çº¿ç¨‹å·²ç»æŒ‰ç›¸åº”çš„æ¡ä»¶åŠ å…¥åˆ°äº†æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œé‚£å¦‚ä½•å†å°è¯•è·å–é”å‘¢ï¼Ÿsignal / signalAll æ–¹æ³•å°±å·²ç»æ’ä¸Šç”¨åœºäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isHeldExclusively())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">    Node first = firstWaiter;</span><br><span class="line">    <span class="keyword">if</span> (first != <span class="keyword">null</span>)</span><br><span class="line">        doSignal(first);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Signal æ–¹æ³•é€šè¿‡è°ƒç”¨ doSignal æ–¹æ³•ï¼Œåªå”¤é†’æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doSignal</span><span class="params">(Node first)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (firstWaiter = first.nextWaiter) == <span class="keyword">null</span>)</span><br><span class="line">            lastWaiter = <span class="keyword">null</span>;</span><br><span class="line">        first.nextWaiter = <span class="keyword">null</span>;</span><br><span class="line">      <span class="comment">// è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (!transferForSignal(first) &amp;&amp;</span><br><span class="line">             (first = firstWaiter) != <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­çœ‹ <code>transferForSignal</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">transferForSignal</span><span class="params">(Node node)</span> </span>&#123;       </span><br><span class="line">    <span class="keyword">if</span> (!compareAndSetWaitStatus(node, Node.CONDITION, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// é‡æ–°è¿›è¡Œå…¥é˜Ÿæ“ä½œ</span></span><br><span class="line">    Node p = enq(node);</span><br><span class="line">    <span class="keyword">int</span> ws = p.waitStatus;</span><br><span class="line">    <span class="keyword">if</span> (ws &gt; <span class="number">0</span> || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))</span><br><span class="line">      <span class="comment">// å”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­è¯¥çº¿ç¨‹</span></span><br><span class="line">        LockSupport.unpark(node.thread);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å†ç”¨å›¾è§£ä¸€ä¸‹å”¤é†’çš„æ•´ä¸ªè¿‡ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530210706.png" alt=""></fancybox></p><p>åˆ°è¿™é‡Œï¼Œç†è§£ signalAll å°±éå¸¸ç®€å•äº†ï¼Œåªä¸è¿‡å¾ªç¯åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ nextWaiterï¼Œå¦‚æœæœ‰å°±åƒ signal æ“ä½œä¸€æ ·ï¼Œå°†å…¶ä»æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doSignalAll</span><span class="params">(Node first)</span> </span>&#123;</span><br><span class="line">    lastWaiter = firstWaiter = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        Node next = first.nextWaiter;</span><br><span class="line">        first.nextWaiter = <span class="keyword">null</span>;</span><br><span class="line">        transferForSignal(first);</span><br><span class="line">        first = next;</span><br><span class="line">    &#125; <span class="keyword">while</span> (first != <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥ä½ è¿˜æ˜¯å¦è®°å¾—ï¼Œæˆ‘åœ¨<a href="https://dayarch.top/p/waiting-notification-mechanism.html">å¹¶å‘ç¼–ç¨‹ä¹‹ç­‰å¾…é€šçŸ¥æœºåˆ¶</a> ä¸­è¿˜è¯´è¿‡ä¸€å¥è¯</p><blockquote><p>æ²¡æœ‰ç‰¹æ®ŠåŸå› å°½é‡ç”¨ signalAll æ–¹æ³•</p></blockquote><p>ä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨ signal æ–¹æ³•ä¹Ÿåœ¨å…¶ä¸­åšäº†è¯´æ˜ï¼Œè¯·å¤§å®¶è‡ªè¡ŒæŸ¥çœ‹å§</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530211202.png" alt=""></fancybox></p><p>è¿™é‡Œæˆ‘è¿˜è¦å¤šè¯´ä¸€ä¸ªç»†èŠ‚ï¼Œä»æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ç§»åˆ°åŒæ­¥é˜Ÿåˆ—æ˜¯æœ‰æ—¶é—´å·®çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ await() æ–¹æ³•ä¹Ÿæ˜¯èŒƒå¼çš„ï¼Œ åŒæ ·åœ¨è¯¥æ–‡ç« ä¸­åšäº†è§£é‡Š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312154011.png" alt=""></fancybox></p><p>æœ‰æ—¶é—´å·®ï¼Œå°±ä¼šæœ‰å…¬å¹³å’Œä¸å…¬å¹³çš„é—®é¢˜ï¼Œæƒ³è¦å…¨é¢äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦èµ°è¿‘ ReentrantLock ä¸­æ¥çœ‹äº†ï¼Œé™¤äº†äº†è§£å…¬å¹³/ä¸å…¬å¹³é—®é¢˜ï¼ŒæŸ¥çœ‹ ReentrantLock çš„åº”ç”¨è¿˜æ˜¯è¦åè¿‡æ¥éªŒè¯å®ƒä½¿ç”¨çš„AQSçš„ï¼Œæˆ‘ä»¬ç»§ç»­å§</p><h2 id="ReentrantLock-æ˜¯å¦‚ä½•åº”ç”¨çš„AQS"><a href="#ReentrantLock-æ˜¯å¦‚ä½•åº”ç”¨çš„AQS" class="headerlink" title="ReentrantLock æ˜¯å¦‚ä½•åº”ç”¨çš„AQS"></a>ReentrantLock æ˜¯å¦‚ä½•åº”ç”¨çš„AQS</h2><p>ç‹¬å å¼çš„å…¸å‹åº”ç”¨å°±æ˜¯ ReentrantLock äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•é‡å†™è¿™ä¸ªæ–¹æ³•çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530113417.png" alt=""></fancybox></p><p>ä¹ä¸€çœ‹æŒºå¥‡æ€ªçš„ï¼Œæ€ä¹ˆé‡Œé¢è‡ªå®šä¹‰äº†ä¸‰ä¸ªåŒæ­¥å™¨ï¼šå…¶å® NonfairSyncï¼ŒFairSync åªæ˜¯å¯¹ Sync åšäº†è¿›ä¸€æ­¥åˆ’åˆ†ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200531100921.png" alt=""></fancybox></p><p>ä»åç§°ä¸Šä½ åº”è¯¥ä¹ŸçŸ¥é“äº†ï¼Œè¿™å°±æ˜¯ä½ å¬åˆ°è¿‡çš„ <code>å…¬å¹³é”/éå…¬å¹³é”</code>äº†</p><h3 id="ä½•ä¸ºå…¬å¹³é”-éå…¬å¹³é”ï¼Ÿ"><a href="#ä½•ä¸ºå…¬å¹³é”-éå…¬å¹³é”ï¼Ÿ" class="headerlink" title="ä½•ä¸ºå…¬å¹³é”/éå…¬å¹³é”ï¼Ÿ"></a>ä½•ä¸ºå…¬å¹³é”/éå…¬å¹³é”ï¼Ÿ</h3><p>ç”Ÿæ´»ä¸­ï¼Œæ’é˜Ÿè®²æ±‚å…ˆæ¥ååˆ°è§†ä¸ºå…¬å¹³ã€‚ç¨‹åºä¸­çš„å…¬å¹³æ€§ä¹Ÿæ˜¯ç¬¦åˆè¯·æ±‚é”çš„ç»å¯¹æ—¶é—´çš„ï¼Œå…¶å®å°±æ˜¯ FIFOï¼Œå¦åˆ™è§†ä¸ºä¸å…¬å¹³</p><p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ ReentrantLock æ˜¯å¦‚ä½•å®ç°å…¬å¹³é”å’Œéå…¬å¹³é”çš„</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200531102752.png" alt=""></fancybox></p><p>å…¶å®æ²¡ä»€ä¹ˆå¤§ä¸äº†ï¼Œå…¬å¹³é”å°±æ˜¯åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦è¿˜æœ‰å…ˆé©±èŠ‚ç‚¹çš„å­˜åœ¨ï¼Œåªæœ‰æ²¡æœ‰å…ˆé©±èŠ‚ç‚¹æ‰èƒ½è·å–é”ï¼›è€Œéå…¬å¹³é”æ˜¯ä¸ç®¡è¿™ä¸ªäº‹çš„ï¼Œèƒ½è·å–åˆ°åŒæ­¥çŠ¶æ€å°±å¯ä»¥ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œé‚£é—®é¢˜æ¥äº†ï¼š</p><h3 id="ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¹³é”-éå…¬å¹³é”çš„è®¾è®¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¹³é”-éå…¬å¹³é”çš„è®¾è®¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¹³é”/éå…¬å¹³é”çš„è®¾è®¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¹³é”/éå…¬å¹³é”çš„è®¾è®¡ï¼Ÿ</h3><p>è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€é‡æ–°å›å¿†ä¸Šé¢çš„é”è·å–å®ç°å›¾äº†ï¼Œå…¶å®ä¸Šé¢æˆ‘å·²ç»é€éœ²äº†ä¸€ç‚¹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200530210706.png" alt=""></fancybox></p><p>ä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š</p><h4 id="åŸå› ä¸€ï¼š"><a href="#åŸå› ä¸€ï¼š" class="headerlink" title="åŸå› ä¸€ï¼š"></a>åŸå› ä¸€ï¼š</h4><p>æ¢å¤æŒ‚èµ·çš„çº¿ç¨‹åˆ°çœŸæ­£é”çš„è·å–è¿˜æ˜¯æœ‰æ—¶é—´å·®çš„ï¼Œä»äººç±»çš„è§’åº¦æ¥çœ‹è¿™ä¸ªæ—¶é—´å¾®ä¹å…¶å¾®ï¼Œä½†æ˜¯ä»CPUçš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªæ—¶é—´å·®å­˜åœ¨çš„è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚æ‰€ä»¥éå…¬å¹³é”èƒ½æ›´å……åˆ†çš„åˆ©ç”¨ CPU çš„æ—¶é—´ç‰‡ï¼Œå°½é‡å‡å°‘ CPU ç©ºé—²çŠ¶æ€æ—¶é—´</p><p>####åŸå› äºŒï¼š</p><p>ä¸çŸ¥ä½ æ˜¯å¦è¿˜è®°å¾—æˆ‘åœ¨ <a href="https://dayarch.top/p/how-many-threads-should-be-created.html">é¢è¯•é—®ï¼Œåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ</a> æ–‡ç« ä¸­åå¤æåˆ°è¿‡ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å¾ˆé‡è¦çš„è€ƒé‡ç‚¹æ˜¯çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœé‡‡ç”¨éå…¬å¹³é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚é”è·å–åŒæ­¥çŠ¶æ€ï¼Œç„¶åé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå› ä¸ºä¸éœ€è¦è€ƒè™‘æ˜¯å¦è¿˜æœ‰å‰é©±èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆšé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨æ­¤åˆ»å†æ¬¡è·å–åŒæ­¥çŠ¶æ€çš„å‡ ç‡å°±å˜å¾—éå¸¸å¤§ï¼Œæ‰€ä»¥å°±å‡å°‘äº†çº¿ç¨‹çš„å¼€é”€</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200531104701.png" alt=""></fancybox></p><p>ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ ä¹Ÿå°±æ˜ç™½äº†ï¼Œä¸ºä»€ä¹ˆ ReentrantLock é»˜è®¤æ„é€ å™¨ç”¨çš„æ˜¯éå…¬å¹³é”åŒæ­¥å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sync = <span class="keyword">new</span> NonfairSync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œæ„Ÿè§‰éå…¬å¹³é” perfectï¼Œéä¹Ÿï¼Œæœ‰å¾—å¿…æœ‰å¤±</p><blockquote><p>ä½¿ç”¨å…¬å¹³é”ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p></blockquote><p>å…¬å¹³é”ä¿è¯äº†æ’é˜Ÿçš„å…¬å¹³æ€§ï¼Œéå…¬å¹³é”éœ¸æ°”çš„å¿½è§†è¿™ä¸ªè§„åˆ™ï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½å¯¼è‡´æ’é˜Ÿçš„é•¿æ—¶é—´åœ¨æ’é˜Ÿï¼Œä¹Ÿæ²¡æœ‰æœºä¼šè·å–åˆ°é”ï¼Œè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ <strong>â€œé¥¥é¥¿â€</strong></p><h3 id="å¦‚ä½•é€‰æ‹©å…¬å¹³é”-éå…¬å¹³é”ï¼Ÿ"><a href="#å¦‚ä½•é€‰æ‹©å…¬å¹³é”-éå…¬å¹³é”ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€‰æ‹©å…¬å¹³é”/éå…¬å¹³é”ï¼Ÿ"></a>å¦‚ä½•é€‰æ‹©å…¬å¹³é”/éå…¬å¹³é”ï¼Ÿ</h3><p>ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œç­”æ¡ˆå·²ç»åœ¨ä½ å¿ƒä¸­äº†ï¼Œå¦‚æœä¸ºäº†æ›´é«˜çš„ååé‡ï¼Œå¾ˆæ˜¾ç„¶éå…¬å¹³é”æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œå› ä¸ºèŠ‚çœå¾ˆå¤šçº¿ç¨‹åˆ‡æ¢æ—¶é—´ï¼Œååé‡è‡ªç„¶å°±ä¸Šå»äº†ï¼Œå¦åˆ™é‚£å°±ç”¨å…¬å¹³é”è¿˜å¤§å®¶ä¸€ä¸ªå…¬å¹³</p><p>æˆ‘ä»¬è¿˜å·®æœ€åä¸€ä¸ªç¯èŠ‚ï¼ŒçœŸçš„è¦æŒºä½</p><h3 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ²¡åˆ†æ ReentrantLock çš„åå­—ï¼ŒJDK èµ·åè¿™ä¹ˆæœ‰è®²ç©¶ï¼Œè‚¯å®šæœ‰å…¶å«ä¹‰ï¼Œç›´è¯‘è¿‡æ¥ã€å¯é‡å…¥é”ã€‘</p><blockquote><p>ä¸ºä»€ä¹ˆè¦æ”¯æŒé”çš„é‡å…¥ï¼Ÿ</p></blockquote><p>è¯•æƒ³ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæœ‰ synchronized ä¿®é¥°çš„é€’å½’è°ƒç”¨æ–¹æ³•ï¼Œç¨‹åºç¬¬äºŒæ¬¡è¿›å…¥è¢«è‡ªå·±é˜»å¡äº†å²‚ä¸æ˜¯å¾ˆå¤§çš„ç¬‘è¯ï¼Œæ‰€ä»¥ synchronized æ˜¯æ”¯æŒé”çš„é‡å…¥çš„</p><p>Lock æ˜¯æ–°è½®å­ï¼Œè‡ªç„¶ä¹Ÿè¦æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå…¶å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œè¯·æŸ¥çœ‹å…¬å¹³é”å’Œéå…¬å¹³é”å¯¹æ¯”å›¾ï¼Œå…¶ä¸­æœ‰ä¸€æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å’Œå·²å ç”¨é”çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread())</span><br></pre></td></tr></table></figure><p>ä»”ç»†çœ‹ä»£ç ï¼Œ ä½ ä¹Ÿè®¸å‘ç°ï¼Œæˆ‘å‰é¢çš„ä¸€ä¸ªè¯´æ˜æ˜¯é”™è¯¯çš„ï¼Œæˆ‘è¦é‡æ–°è§£é‡Šä¸€ä¸‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200531110129.png" alt=""></fancybox></p><p>é‡å…¥çš„çº¿ç¨‹ä¼šä¸€ç›´å°† state + 1ï¼Œ é‡Šæ”¾é”ä¼š state - 1ç›´è‡³ç­‰äº0ï¼Œä¸Šé¢è¿™æ ·å†™ä¹Ÿæ˜¯æƒ³å¸®åŠ©å¤§å®¶å¿«é€Ÿçš„åŒºåˆ†</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡æ˜¯ä¸€ä¸ªé•¿æ–‡ï¼Œè¯´æ˜äº†ä¸ºä»€ä¹ˆè¦é€  Lock æ–°è½®å­ï¼Œå¦‚ä½•æ ‡å‡†çš„ä½¿ç”¨ Lockï¼ŒAQS æ˜¯ä»€ä¹ˆï¼Œæ˜¯å¦‚ä½•å®ç°é”çš„ï¼Œç»“åˆ ReentrantLock åæ¨ AQS ä¸­çš„ä¸€äº›åº”ç”¨ä»¥åŠå…¶ç‹¬æœ‰çš„ä¸€äº›ç‰¹æ€§</p><p>ç‹¬å å¼è·å–é”å°±è¿™æ ·ä»‹ç»å®Œäº†ï¼Œæˆ‘ä»¬è¿˜å·® AQS å…±äº«å¼ <code>xxxShared</code> æ²¡æœ‰åˆ†æï¼Œç»“åˆå…±äº«å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥é˜…è¯»ä¸€ä¸‹ Semaphoreï¼ŒReentrantReadWriteLock å’Œ CountLatch ç­‰</p><p>å¦å¤–ä¹Ÿæ¬¢è¿å¤§å®¶çš„ç•™è¨€ï¼Œå¦‚æœ‰é”™è¯¯ä¹‹å¤„è¿˜è¯·æŒ‡å‡ºï¼Œæˆ‘çš„æ‰‹é…¸äº†ï¼Œçœ¼ç›å¹²äº†ï¼Œæˆ‘å»å‡†å¤‡æ’¸ä¸‹ä¸€ç¯‡â€¦.. </p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200531112135.png" alt=""></fancybox></p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li><p>ä¸ºä»€ä¹ˆæ›´æ”¹ state æœ‰ setState() ,  compareAndSetState() ä¸¤ç§æ–¹å¼ï¼Œæ„Ÿè§‰åè€…æ›´å®‰å…¨ï¼Œä½†æ˜¯é”çš„è§†çº¿ä¸­æœ‰å¥½å¤šåœ°æ–¹éƒ½ä½¿ç”¨äº† setState()ï¼Œå®‰å…¨å—ï¼Ÿ</p></li><li><p>ä¸‹é¢ä»£ç æ˜¯ä¸€ä¸ªè½¬è´¦ç¨‹åºï¼Œæ˜¯å¦å­˜åœ¨æ­»é”æˆ–è€…é”çš„å…¶ä»–é—®é¢˜å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Lock lock</span><br><span class="line">          = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">  <span class="comment">// è½¬è´¦</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Account tar, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.lock.tryLock()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (tar.lock.tryLock()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">this</span>.balance -= amt;</span><br><span class="line">              tar.balance += amt;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">              tar.lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;<span class="comment">//if</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="comment">//if</span></span><br><span class="line">    &#125;<span class="comment">//while</span></span><br><span class="line">  &#125;<span class="comment">//transfer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>Java å¹¶å‘å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html" target="_blank" rel="noopener">https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¤šçº¿ç¨‹ä¸­æ–­æœºåˆ¶</title>
      <link href="//p/java-concurrency-interrupt-mechnism.html"/>
      <url>//p/java-concurrency-interrupt-mechnism.html</url>
      
        <content type="html"><![CDATA[<p>| <strong>å¥½çœ‹è¯·èµï¼Œå…»æˆä¹ æƒ¯</strong></p><blockquote><ul><li><p>ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰ä¸¤ä¸ªæ€æƒ³</p></li><li><p>If you can NOT explain it simply, you do NOT understand it well enough</p></li></ul></blockquote><p>ç°é™†ç»­å°†Demoä»£ç å’ŒæŠ€æœ¯æ–‡ç« æ•´ç†åœ¨ä¸€èµ· <a href="https://github.com/FraserYu/learnings" target="_blank" rel="noopener">Githubå®è·µç²¾é€‰</a> ï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»æŸ¥çœ‹ï¼Œæœ¬æ–‡åŒæ ·æ”¶å½•åœ¨æ­¤ï¼Œè§‰å¾—ä¸é”™ï¼Œè¿˜è¯·StarğŸŒŸ</p><hr><p>æ¨ªçœ‹æˆå²­ä¾§æˆå³°ï¼Œè¿œè¿‘é«˜ä½å„ä¸åŒï¼Œ<a href="https://dayarch.top/categories/Coding/Java-Concurrency/">å¹¶å‘ç¼–ç¨‹ç†è®ºç³»åˆ—</a>åŸºæœ¬å·²ç»ç»“æŸï¼Œç›¸ä¿¡å¤§å®¶æœ‰äº†ç†è®ºçš„é“ºå«ï¼Œè¿‘çœ‹æºç æ‰èƒ½å‘ç°å…¶è®¾è®¡ä¹‹ç¾ï¼Œä¸ä¼šä¸€å¤´é›¾æ°´</p><hr><p>æœ¬æ¥æ˜¯è¦ä»‹ç» AQS ä½œä¸ºæˆ‘ä»¬èµ°è¿›å¹¶å‘ç¼–ç¨‹æºç ç¯èŠ‚çš„ç¬¬ä¸€æ­¥ï¼Œä½† AQS æ¶‰åŠçš„çŸ¥è¯†ç‚¹ä¹Ÿè¿˜çœŸæœ‰ç‚¹å¤šï¼Œæ¯ä¸€ä¸ªéƒ½å¤Ÿå•ç‹¬æ‹¿å‡ºæ¥è¯´ä¸€è¯´ï¼Œæ°å·§æœ‰æœ‹å‹ç§ä¿¡æˆ‘â€œä¸ç†è§£çº¿ç¨‹çš„ä¸­æ–­æœºåˆ¶â€ï¼Œä¸­æ–­æœºåˆ¶åˆæ°å·§æ˜¯ AQS APIå®ç°çš„ä¸€éƒ¨åˆ†ï¼Œæ›´è´¯ç©¿äºæ•´ä¸ªå¹¶å‘ç¼–ç¨‹å†…å®¹ä¸­ã€‚äºæ˜¯å°±æ‰“ç®—å•ç‹¬è¯´ä¸€è¯´è¿™ä¸ªå°æœºåˆ¶ï¼Œå…ˆè®©å¤§å®¶åšåˆ°å¿ƒä¸­æœ‰ number </p><p>åœ¨å­¦ä¹ /ç¼–å†™å¹¶å‘ç¨‹åºæ—¶ï¼Œæ€»ä¼šå¬åˆ°/çœ‹åˆ°å¦‚ä¸‹è¯æ±‡ï¼š</p><ul><li>çº¿ç¨‹è¢«ä¸­æ–­æˆ–æŠ›å‡ºInterruptedException</li><li>è®¾ç½®äº†ä¸­æ–­æ ‡è¯†</li><li>æ¸…ç©ºäº†ä¸­æ–­æ ‡è¯†</li><li>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­</li></ul><p>åœ¨ Java Thread ç±»åˆæä¾›äº†é•¿ç›¸é…·ä¼¼ï¼Œè®©äººå‚»å‚»åˆ†ä¸æ¸…çš„ä¸‰ä¸ªæ–¹æ³•æ¥å¤„ç†å¹¶å‘ä¸­æ–­é—®é¢˜ï¼š </p><ul><li><code>interrupt()</code></li><li><code>interrupted()</code></li><li><code>isInterrupted()</code></li></ul><p><fancybox><img src="https://rgyb.sunluomeng.top/20200513160945.png" alt=""></fancybox></p><p>çœ‹åˆ°è¿™æˆ‘ä¸ç¦ä¼šé—®è‡ªå·±ï¼š</p><p><img src="https://rgyb.sunluomeng.top/20200517135855.png" alt=""></p><h2 id="ä»€ä¹ˆæ˜¯ä¸­æ–­æœºåˆ¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸­æ–­æœºåˆ¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­æ–­æœºåˆ¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸­æ–­æœºåˆ¶ï¼Ÿ</h2><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200516202432.png" alt=""></fancybox></p><p>åˆšåˆšæ¥è§¦ã€ä¸­æ–­ã€‘è¿™ä¸ªè¯æ—¶ï¼Œå…ˆå…¥ä¸ºä¸»çš„æ¦‚å¿µå°±æ˜¯â€œç›´æ¥ä¸­æ–­/æ‰“æ–­â€æ­£åœ¨åšçš„äº‹ï¼Œä½¿å…¶åœæ­¢ã€‚æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>ä½ ï¼šåœ¨æ‰“æ¸¸æˆ</p><p>å¥³æœ‹å‹ï¼šåˆ«æ‰“æ¸¸æˆäº†ï¼Œèµ¶å¿«è¿‡æ¥åƒé¥­</p><p>ä½ ï¼šå¬åˆ°å¥³æœ‹å‹æ‹›å‘¼ä¹‹åç«‹é©¬ä¸­æ–­æ‰‹ä¸­çš„æ¸¸æˆä¹–ä¹–è¿‡å»åƒé¥­</p></blockquote><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200516203009.png" alt=""></fancybox></p><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä¸­æ–­æ˜¯ä¸€ç§ã€ååŒã€‘æœºåˆ¶ï¼Œæ€ä¹ˆç†è§£è¿™ä¹ˆé«˜å¤§ä¸Šçš„è¯å‘¢ï¼Ÿå°±æ˜¯å¥³æœ‹å‹å«ä½ åƒé¥­ï¼Œä½ æ”¶åˆ°äº†ä¸­æ–­æ¸¸æˆé€šçŸ¥ï¼Œ<strong>ä½†æ˜¯å¦é©¬ä¸Šæ”¾ä¸‹æ‰‹ä¸­çš„æ¸¸æˆå»åƒé¥­çœ‹ä½ å¿ƒæƒ…</strong> ã€‚åœ¨ç¨‹åºä¸­æ€æ ·æ¼”ç»è¿™ä¸ªå¿ƒæƒ…å°±çœ‹å…·ä½“çš„ä¸šåŠ¡é€»è¾‘äº†ï¼ŒJava çš„ä¸­æ–­æœºåˆ¶å°±æ˜¯è¿™ä¹ˆç®€å•</p><p>å¦‚æœè¿˜æ²¡æ”¹å˜è¿™ä¸ªå…ˆå…¥ä¸ºä¸»çš„æ¦‚å¿µï¼Œæˆ‘æ€€ä½ ä½ æ²¡æœ‰å¥³æœ‹å‹ï¼ˆğŸ˜­ï¼‰æˆ‘ä»¬æ‹¥æŠ±ä¸€ä¸‹</p><h2 id="ä¸ºä»€ä¹ˆä¼šæœ‰ä¸­æ–­æœºåˆ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰ä¸­æ–­æœºåˆ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰ä¸­æ–­æœºåˆ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šæœ‰ä¸­æ–­æœºåˆ¶ï¼Ÿ</h2><p>ä¸­æ–­æ˜¯ä¸€ç§ååŒæœºåˆ¶ï¼Œæˆ‘è§‰å¾—å°±æ˜¯è§£å†³ã€å½“å±€è€…è¿·ã€‘çš„çŠ¶å†µ</p><p>ç°å®ä¸­ï¼Œä½ åŠªåŠ›å¿˜æˆ‘æ²¡æœ‰æ˜¼å¤œçš„å·¥ä½œï¼Œå¦‚æœå†æ²¡æœ‰äººå‘ŠçŸ¥ä½ ä¸­æ–­ï¼Œä½ èº«ä½“æ˜¯åƒä¸æ¶ˆçš„ã€‚</p><p>åœ¨å¤šçº¿ç¨‹çš„åœºæ™¯ä¸­ï¼Œæœ‰çš„çº¿ç¨‹å¯èƒ½è¿·å¤±åœ¨æ€ªåœˆæ— æ³•è‡ªæ‹”ï¼ˆè‡ªæ—‹æµªè´¹èµ„æºï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨å…¶ä»–çº¿ç¨‹åœ¨<strong>æ°å½“</strong>çš„æ—¶æœºç»™å®ƒä¸ªä¸­æ–­é€šçŸ¥ï¼Œè¢«â€œä¸­æ–­â€çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©åœ¨<strong>æ°å½“</strong>çš„æ—¶æœºé€‰æ‹©è·³å‡ºæ€ªåœˆï¼Œæœ€å¤§åŒ–çš„åˆ©ç”¨èµ„æº</p><p>é‚£ç¨‹åºä¸­å¦‚ä½•ä¸­æ–­ï¼Ÿæ€æ ·è¯†åˆ«æ˜¯å¦ä¸­æ–­ï¼Ÿåˆå¦‚ä½•å¤„ç†ä¸­æ–­å‘¢ï¼Ÿè¿™å°±ä¸ä¸Šæ–‡æåˆ°çš„ä¸‰ä¸ªæ–¹æ³•æœ‰å…³äº†</p><h2 id="interrupt-VS-isInterrupted-VS-interrupted"><a href="#interrupt-VS-isInterrupted-VS-interrupted" class="headerlink" title="interrupt() VS isInterrupted() VS interrupted()"></a><code>interrupt()</code> VS <code>isInterrupted()</code> VS <code>interrupted()</code></h2><p>Java çš„æ¯ä¸ªçº¿ç¨‹å¯¹è±¡é‡Œéƒ½æœ‰ä¸€ä¸ª boolean ç±»å‹çš„æ ‡è¯†ï¼Œä»£è¡¨æ˜¯å¦æœ‰ä¸­æ–­è¯·æ±‚ï¼Œå¯ä½ å¯»é Thread ç±»ä½ ä¹Ÿä¸ä¼šæ‰¾åˆ°è¿™ä¸ªæ ‡è¯†ï¼Œå› ä¸ºè¿™æ˜¯é€šè¿‡åº•å±‚ native æ–¹æ³•å®ç°çš„ã€‚</p><h3 id="interrupt"><a href="#interrupt" class="headerlink" title="interrupt()"></a>interrupt()</h3><p>interrupt() æ–¹æ³•æ˜¯ <strong>å”¯ä¸€ä¸€ä¸ª</strong> å¯ä»¥å°†ä¸Šé¢æåˆ°ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸º true çš„æ–¹æ³•ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ª Thread ç±» public çš„å¯¹è±¡æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºä»»ä½•çº¿ç¨‹å¯¹è±¡éƒ½å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿›ä¸€æ­¥è¯´æ˜å°±æ˜¯å¯ä»¥ä¸€ä¸ªçº¿ç¨‹ interrupt å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥ interrupt è‡ªå·±ã€‚å…¶ä¸­ï¼Œä¸­æ–­æ ‡è¯†çš„è®¾ç½®æ˜¯é€šè¿‡ native æ–¹æ³• <code>interrupt0</code> å®Œæˆçš„</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200516213303.png" alt=""></fancybox></p><p>åœ¨ Java ä¸­ï¼Œçº¿ç¨‹è¢«ä¸­æ–­çš„ååº”æ˜¯ä¸ä¸€æ ·çš„ï¼Œè„¾æ°”ä¸å¥½çš„ç›´æ¥å°±æŠ›å‡ºäº† <code>InterruptedException()</code> ï¼Œ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200516215134.png" alt=""></fancybox></p><p>è¯¥æ–¹æ³•æ³¨é‡Šä¸Šå†™çš„å¾ˆæ¸…æ¥šï¼Œå½“çº¿ç¨‹è¢«é˜»å¡åœ¨ï¼š</p><ol><li>wait()</li><li>join()</li><li>sleep()</li></ol><p>è¿™äº›æ–¹æ³•æ—¶ï¼Œå¦‚æœè¢«ä¸­æ–­ï¼Œå°±ä¼šæŠ›å‡º InterruptedException å—æ£€å¼‚å¸¸ï¼ˆä¹Ÿå°±æ˜¯å¿…é¡»è¦æ±‚æˆ‘ä»¬ catch è¿›è¡Œå¤„ç†çš„ï¼‰</p><p>ç†Ÿæ‚‰ JUC çš„æœ‹å‹å¯èƒ½çŸ¥é“ï¼Œå…¶å®è¢«ä¸­æ–­æŠ›å‡º InterruptedException çš„è¿œè¿œä¸æ­¢è¿™å‡ ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200516215615.png" alt=""></fancybox></p><p>åå‘æ¨ç†ï¼Œè¿™äº›å¯èƒ½é˜»å¡çš„æ–¹æ³•å¦‚æœå£°æ˜æœ‰ <code>throws InterruptedException</code> ï¼Œ ä¹Ÿå°±æš—ç¤ºæˆ‘ä»¬å®ƒä»¬æ˜¯å¯ä¸­æ–­çš„</p><p>è°ƒç”¨ interrput() æ–¹æ³•åï¼Œä¸­æ–­æ ‡è¯†å°±è¢«è®¾ç½®ä¸º true äº†ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåˆ©ç”¨è¿™ä¸ªä¸­æ–­æ ‡è¯†ï¼Œæ¥åˆ¤æ–­æŸä¸ªçº¿ç¨‹ä¸­æ–­æ ‡è¯†åˆ°åº•ä»€ä¹ˆçŠ¶æ€å‘¢ï¼Ÿ</p><h3 id="isInterrupted"><a href="#isInterrupted" class="headerlink" title="isInterrupted()"></a>isInterrupted()</h3><p><fancybox><img src="https://rgyb.sunluomeng.top/20200516221434.png" alt=""></fancybox></p><p>è¿™ä¸ªæ–¹æ³•åèµ·çš„éå¸¸å¥½ï¼Œå› ä¸ºæ¯”è¾ƒç¬¦åˆæˆ‘ä»¬ bean boolean ç±»å‹å­—æ®µçš„ get æ–¹æ³•è§„èŒƒï¼Œæ²¡é”™ï¼Œè¯¥æ–¹æ³•å°±æ˜¯è¿”å›ä¸­æ–­æ ‡è¯†çš„ç»“æœï¼š</p><ul><li>trueï¼šçº¿ç¨‹è¢«ä¸­æ–­ï¼Œ</li><li>falseï¼šçº¿ç¨‹æ²¡è¢«ä¸­æ–­æˆ–è¢«æ¸…ç©ºäº†ä¸­æ–­æ ‡è¯†ï¼ˆå¦‚ä½•æ¸…ç©ºæˆ‘ä»¬ä¸€ä¼šçœ‹ï¼‰</li></ul><p>æ‹¿åˆ°è¿™ä¸ªæ ‡è¯†åï¼Œçº¿ç¨‹å°±å¯ä»¥åˆ¤æ–­è¿™ä¸ªæ ‡è¯†æ¥æ‰§è¡Œåç»­çš„é€»è¾‘äº†ã€‚æœ‰èµ·åå¥½çš„ï¼Œä¹Ÿæœ‰èµ·åä¸å¥½çš„ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š</p><h3 id="interrupted"><a href="#interrupted" class="headerlink" title="interrupted()"></a>interrupted()</h3><p>æŒ‰ç…§å¸¸è§„ç¿»è¯‘ï¼Œè¿‡å»æ—¶æ—¶æ€ï¼Œè¿™å°±æ˜¯â€œè¢«æ‰“æ–­äº†/è¢«æ‰“æ–­çš„â€ï¼Œå…¶å®å’Œä¸Šé¢çš„ isInterrupted() æ–¹æ³•å·®ä¸å¤šï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è°ƒç”¨ <code>private</code> çš„ isInterrupted() æ–¹æ³•ï¼Œ å”¯ä¸€å·®åˆ«å°±æ˜¯ä¼šæ¸…ç©ºä¸­æ–­æ ‡è¯†ï¼ˆè¿™æ˜¯ä»æ–¹æ³•åä¸­æ€ä¹ˆä¹Ÿçœ‹ä¸å‡ºæ¥çš„ï¼‰</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200516223926.png" alt=""></fancybox></p><p>å› ä¸ºè°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¼šè¿”å›å½“å‰ä¸­æ–­æ ‡è¯†ï¼ŒåŒæ—¶ä¼šæ¸…ç©ºä¸­æ–­æ ‡è¯†ï¼Œå°±æœ‰äº†é‚£ä¸€æ®µæœ‰ç‚¹è®©äººè¿·æƒ‘çš„æ–¹æ³•æ³¨é‡Šï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200516224422.png" alt=""></fancybox></p><p>æ¥æ®µç¨‹åºä½ å°±ä¼šæ˜ç™½ä¸Šé¢æ³¨é‡Šçš„æ„æ€äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread.currentThread().isInterrupted(); <span class="comment">// true</span></span><br><span class="line">Thread.interrupted() <span class="comment">// trueï¼Œè¿”å›trueåæ¸…ç©ºäº†ä¸­æ–­æ ‡è¯†å°†å…¶ç½®ä¸º false</span></span><br><span class="line">Thread.currentThread().isInterrupted(); <span class="comment">// false</span></span><br><span class="line">Thread.interrupted() <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ€»è§‰å¾—å¾ˆå¥‡æ€ªï¼Œç°å®ä¸­æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><blockquote><p>å½“ä½ å¯èƒ½è¦è¢«å¤§é‡ä¸­æ–­å¹¶ä¸”ä½ æƒ³ç¡®ä¿åªå¤„ç†ä¸€æ¬¡ä¸­æ–­æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•äº†</p></blockquote><p>è¯¥æ–¹æ³•åœ¨ JDK æºç ä¸­åº”ç”¨ä¹Ÿéå¸¸å¤šï¼Œæ¯”å¦‚ï¼ˆåç»­æ–‡ç« ä¼šå…·ä½“åˆ†æï¼Œè¿™é‡ŒçŸ¥é“è¯¥æ–¹æ³•çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯å°±å¥½ï¼‰ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200517124752.png" alt=""></fancybox></p><p>ç›¸ä¿¡åˆ°è¿™é‡Œä½ å·²ç»èƒ½æ˜ç¡®åˆ†è¾¨ä¸‰èƒèƒéƒ½æ˜¯è°ï¼Œå¹¶å‘æŒ¥æ€æ ·çš„ä½œç”¨äº†ï¼Œé‚£ä¹ˆæœ‰å“ªäº›åœºæ™¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­æ–­æœºåˆ¶å‘¢ï¼Ÿ</p><h2 id="ä¸­æ–­æœºåˆ¶çš„ä½¿ç”¨åœºæ™¯"><a href="#ä¸­æ–­æœºåˆ¶çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä¸­æ–­æœºåˆ¶çš„ä½¿ç”¨åœºæ™¯"></a>ä¸­æ–­æœºåˆ¶çš„ä½¿ç”¨åœºæ™¯</h2><p>é€šå¸¸ï¼Œä¸­æ–­çš„ä½¿ç”¨åœºæ™¯æœ‰ä»¥ä¸‹å‡ ä¸ª</p><ul><li>ç‚¹å‡»æŸä¸ªæ¡Œé¢åº”ç”¨ä¸­çš„å…³é—­æŒ‰é’®æ—¶ï¼ˆæ¯”å¦‚ä½ å…³é—­ IDEAï¼Œä¸ä¿å­˜æ•°æ®ç›´æ¥ä¸­æ–­å¥½å—ï¼Ÿï¼‰ï¼›</li><li>æŸä¸ªæ“ä½œè¶…è¿‡äº†ä¸€å®šçš„æ‰§è¡Œæ—¶é—´é™åˆ¶éœ€è¦ä¸­æ­¢æ—¶ï¼›</li><li>å¤šä¸ªçº¿ç¨‹åšç›¸åŒçš„äº‹æƒ…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹æˆåŠŸå…¶å®ƒçº¿ç¨‹éƒ½å¯ä»¥å–æ¶ˆæ—¶ï¼›</li><li>ä¸€ç»„çº¿ç¨‹ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‡ºç°é”™è¯¯å¯¼è‡´æ•´ç»„éƒ½æ— æ³•ç»§ç»­æ—¶ï¼›</li></ul><p>å› ä¸ºä¸­æ–­æ˜¯ä¸€ç§ååŒæœºåˆ¶ï¼Œæä¾›äº†æ›´ä¼˜é›…ä¸­æ–­æ–¹å¼ï¼Œä¹Ÿæä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œæ‰€ä»¥å½“é‡åˆ°å¦‚ä¸Šåœºæ™¯ç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸­æ–­æœºåˆ¶äº†</p><h2 id="ä½¿ç”¨ä¸­æ–­æœºåˆ¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨ä¸­æ–­æœºåˆ¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨ä¸­æ–­æœºåˆ¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨ä¸­æ–­æœºåˆ¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹</h2><p>å…¶å®ä½¿ç”¨ä¸­æ–­æœºåˆ¶æ— éå°±æ˜¯æ³¨æ„ä¸Šé¢è¯´çš„ä¸¤é¡¹å†…å®¹ï¼š</p><ol><li>ä¸­æ–­æ ‡è¯†</li><li>InterruptedException</li></ol><p>å‰æµªå·²ç»å°†å…¶æ€»ç»“ä¸ºä¸¤ä¸ªé€šç”¨åŸåˆ™ï¼Œæˆ‘ä»¬åæµªç›´æ¥ç«™åœ¨è‚©è†€ä¸Šç”¨å°±å¯ä»¥äº†ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªåŸåˆ™æ˜¯ä»€ä¹ˆï¼š</p><h3 id="åŸåˆ™-1"><a href="#åŸåˆ™-1" class="headerlink" title="åŸåˆ™-1"></a>åŸåˆ™-1</h3><blockquote><p>å¦‚æœé‡åˆ°çš„æ˜¯å¯ä¸­æ–­çš„é˜»å¡æ–¹æ³•, å¹¶æŠ›å‡º InterruptedExceptionï¼Œå¯ä»¥ç»§ç»­å‘æ–¹æ³•è°ƒç”¨æ ˆçš„ä¸Šå±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼›å¦‚æœæ£€æµ‹åˆ°ä¸­æ–­ï¼Œåˆ™å¯æ¸…é™¤ä¸­æ–­çŠ¶æ€å¹¶æŠ›å‡º InterruptedExceptionï¼Œä½¿å½“å‰æ–¹æ³•ä¹Ÿæˆä¸ºä¸€ä¸ªå¯ä¸­æ–­çš„æ–¹æ³•</p></blockquote><h3 id="åŸåˆ™-2"><a href="#åŸåˆ™-2" class="headerlink" title="åŸåˆ™-2"></a>åŸåˆ™-2</h3><blockquote><p>è‹¥æœ‰æ—¶å€™ä¸å¤ªæ–¹ä¾¿åœ¨æ–¹æ³•ä¸ŠæŠ›å‡º InterruptedExceptionï¼Œæ¯”å¦‚è¦å®ç°çš„æŸä¸ªæ¥å£ä¸­çš„æ–¹æ³•ç­¾åä¸Šæ²¡æœ‰ throws InterruptedExceptionï¼Œè¿™æ—¶å°±å¯ä»¥æ•è·å¯ä¸­æ–­æ–¹æ³•çš„ InterruptedException å¹¶é€šè¿‡ Thread.currentThread.interrupt() æ¥é‡æ–°è®¾ç½®ä¸­æ–­çŠ¶æ€ã€‚</p></blockquote><p>å†é€šè¿‡ä¸ªä¾‹å­æ¥åŠ æ·±ä¸€ä¸‹ç†è§£ï¼š</p><blockquote><p>æœ¬æ„æ˜¯å½“å‰çº¿ç¨‹è¢«ä¸­æ–­ä¹‹åï¼Œé€€å‡ºwhile(true),  ä½ è§‰å¾—ä»£ç æœ‰é—®é¢˜å—ï¼Ÿï¼ˆå…ˆä¸è¦å‘ä¸‹çœ‹ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Thread th = Thread.currentThread();</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(th.isInterrupted()) &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// çœç•¥ä¸šåŠ¡ä»£ç </span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ Thread.sleep æ–¹æ³•ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200516231654.png" alt=""></fancybox></p><p>sleep æ–¹æ³•æŠ›å‡º InterruptedExceptionåï¼Œä¸­æ–­æ ‡è¯†ä¹Ÿè¢«æ¸…ç©ºç½®ä¸º falseï¼Œæˆ‘ä»¬åœ¨catch æ²¡æœ‰é€šè¿‡è°ƒç”¨ th.interrupt() æ–¹æ³•å†æ¬¡å°†ä¸­æ–­æ ‡è¯†ç½®ä¸º trueï¼Œè¿™å°±å¯¼è‡´æ— é™å¾ªç¯äº†</p><p>è¿™ä¸¤ä¸ªåŸåˆ™å¾ˆå¥½ç†è§£ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥ç•™æ„ InterruptedExceptionï¼Œå½“æˆ‘ä»¬æ•è·åˆ°è¯¥å¼‚å¸¸æ—¶ï¼Œç»ä¸å¯ä»¥é»˜é»˜çš„åæ‰å®ƒï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ä¸Šå±‚è°ƒç”¨æ ˆä»€ä¹ˆä¿¡æ¯ä¹Ÿè·å–ä¸åˆ°ã€‚å…¶å®åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œæ•è·çš„ä»»ä½•å—æ£€å¼‚å¸¸æˆ‘ä»¬éƒ½ä¸åº”è¯¥åæ‰</p><h2 id="JDK-ä¸­æœ‰å“ªäº›ä½¿ç”¨ä¸­æ–­æœºåˆ¶çš„åœ°æ–¹å‘¢ï¼Ÿ"><a href="#JDK-ä¸­æœ‰å“ªäº›ä½¿ç”¨ä¸­æ–­æœºåˆ¶çš„åœ°æ–¹å‘¢ï¼Ÿ" class="headerlink" title="JDK ä¸­æœ‰å“ªäº›ä½¿ç”¨ä¸­æ–­æœºåˆ¶çš„åœ°æ–¹å‘¢ï¼Ÿ"></a>JDK ä¸­æœ‰å“ªäº›ä½¿ç”¨ä¸­æ–­æœºåˆ¶çš„åœ°æ–¹å‘¢ï¼Ÿ</h2><p>ä¸­æ–­æœºåˆ¶è´¯ç©¿æ•´ä¸ªå¹¶å‘ç¼–ç¨‹ä¸­ï¼Œè¿™é‡Œåªç®€å•åˆ—è§‰å¤§å®¶ç»å¸¸ä¼šä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é˜…è¯»JDKæºç æ¥è¿›ä¸€æ­¥äº†è§£ä¸­æ–­æœºåˆ¶ä»¥åŠå­¦ä¹ å¦‚ä½•ä½¿ç”¨ä¸­æ–­æœºåˆ¶</p><h3 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h3><p>ThreadPoolExecutor ä¸­çš„ shutdownNow æ–¹æ³•ä¼šéå†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å¹¶è°ƒç”¨çº¿ç¨‹çš„ interrupt æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200517125410.png" alt=""></fancybox></p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200517125513.png" alt=""></fancybox></p><h3 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h3><p>FutureTask ä¸­çš„ cancel æ–¹æ³•ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°ä¸º trueï¼Œå®ƒå°†ä¼šåœ¨æ­£åœ¨è¿è¡Œå¼‚æ­¥ä»»åŠ¡çš„çº¿ç¨‹ä¸Šè°ƒç”¨ interrupt æ–¹æ³•ï¼Œå¦‚æœæ­£åœ¨æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡ä¸­çš„ä»£ç æ²¡æœ‰å¯¹ä¸­æ–­åšå‡ºå“åº”ï¼Œé‚£ä¹ˆ cancel æ–¹æ³•ä¸­çš„å‚æ•°å°†ä¸ä¼šèµ·åˆ°ä»€ä¹ˆæ•ˆæœ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200517125655.png" alt=""></fancybox></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œä½ åº”è¯¥ç†è§£Java å¹¶å‘ç¼–ç¨‹ä¸­æ–­æœºåˆ¶çš„å«ä¹‰äº†ï¼Œå®ƒæ˜¯ä¸€ç§ååŒæœºåˆ¶ï¼Œå’Œä½ å…ˆå…¥ä¸ºä¸»çš„æ¦‚å¿µå®Œå…¨ä¸ä¸€æ ·ã€‚åŒºåˆ†äº†ä¸‰ä¸ªç›¸è¿‘æ–¹æ³•ï¼Œè¯´æ˜äº†ä½¿ç”¨åœºæ™¯ä»¥åŠä½¿ç”¨åŸåˆ™ï¼ŒåŒæ—¶åˆç»™å‡ºJDKæºç ä¸€äº›å¸¸è§æ¡ˆä¾‹ï¼Œç›¸ä¿¡ä½ å·²ç»èƒ¸ä¸­æœ‰æ²Ÿå£‘äº†ï¼Œæ¥ä¸‹æ¥ï¼Œè·Ÿä¸ŠèŠ‚å¥ï¼Œæˆ‘ä»¬é™†ç»­èµ°è¿›æºç å§</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>æŠ›å‡º InterruptedException åï¼Œä¸­æ–­æ ‡è¯†å°±ä¸€å®šè¢«æ¸…ç©ºå—ï¼Ÿ</li><li>å¤„åœ¨æ­»é”çŠ¶æ€çš„çº¿ç¨‹æ˜¯å¦å¯ä»¥è¢«ä¸­æ–­å‘¢ï¼Ÿ</li><li>è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹èƒ½å¦è¢«ä¸­æ–­å‘¢ï¼Ÿå¦‚æœä¸èƒ½æœ‰ä»€ä¹ˆåŠæ³•èƒ½å“åº”ä¸­æ–­å—ï¼Ÿ</li><li>ä¸ªäººæ„Ÿè§‰interruptedè¿™ä¸ªæ–¹æ³•åç§°ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œå¦‚æœä½ ä¹Ÿè§‰å¾—ä¸å¥½ï¼Œè®©ä½ è®¾è®¡è¿™ä¸ªåœ°æ–¹ï¼Œä½ æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Ÿ</li></ol><blockquote><p>æœ‰æœ‹å‹å¯èƒ½ä¼šé—®æ–‡ç« å¼€å¤´çš„å›¾ï¼ŒåŒæ—¶çœ‹ä¸€ä¸ªç±»çš„ä¸åŒéƒ¨åˆ†æ€ä¹ˆå®ç°çš„ï¼Ÿä¸ç­‰æ‚¨å¼€å£ï¼Œæˆ‘å°±å…¨ç›˜çš„æ‹›äº†ï¼Œå…¶å®å°±æ˜¯å±å¹•åˆ†å‰²ï¼ˆåœ¨æ–‡ä»¶ä¸Šé¼ æ ‡å³é”®-&gt;é€‰æ‹©æ°´å¹³/å‚ç›´åˆ†å‰²ï¼‰ï¼Œè¿™æ ·åœ¨åŒæ—¶æŸ¥çœ‹æŸäº›ä»£ç æ—¶è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼ˆå¸¦é±¼å±å‚ç›´åˆ†å‰²çœŸæ˜¯çˆ½ç¿»å¤©ï¼‰ï¼Œä¿å§†å¼æ¼”ç¤ºå¦‚ä¸‹ï¼š</p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/2020-05-14at22.09.53.gif" alt=""></fancybox></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="https://www.infoq.cn/article/java-interrupt-mechanism" target="_blank" rel="noopener">https://www.infoq.cn/article/java-interrupt-mechanism</a></li><li><a href="https://coderanch.com/t/237332/certification/explain-interrupt-isInterrupted-interrupted-method" target="_blank" rel="noopener">https://coderanch.com/t/237332/certification/explain-interrupt-isInterrupted-interrupted-method</a></li><li><a href="https://dzone.com/articles/waiting-for-coroutines" target="_blank" rel="noopener">https://dzone.com/articles/waiting-for-coroutines</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Intellij IDEA é…ç½®å’Œæ’ä»¶åˆé›†</title>
      <link href="//p/intellij-idea-configuration-and-plugins.html"/>
      <url>//p/intellij-idea-configuration-and-plugins.html</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨é™†ç»­å†™ <a href="https://dayarch.top/categories/Coding/Java-Concurrency/">Java å¹¶å‘ç¼–ç¨‹ç³»åˆ—</a>ï¼Œå¥½å¤šæœ‹ç§ä¿¡é—®æˆ‘çš„ä¸æ˜¯å¹¶å‘å†…å®¹æœ¬èº«ï¼Œè€Œæ˜¯æˆ‘çš„ IDEA ä¸»é¢˜é…ç½®ã€‚æˆ‘å°±å§‘ä¸”è®¤ä¸ºå¥½çš„ä¸»é¢˜é…ç½®å¯ä»¥å†™å‡ºæ›´å¥½çš„å¹¶å‘ç¨‹åºå§</p><p>å³ä¾¿è¿™ç§å¯èƒ½æ€§åªæœ‰ä¸‡åˆ†ä¹‹ä¸€ï¼Œæˆ‘ä¹Ÿè¦æŠŠæˆ‘çš„ IDEA ç›¸å…³å€¼å¾—é…ç½®çš„å†…å®¹/æ’ä»¶å’Œå¤§å®¶åˆ†äº«å‡ºæ¥</p><p>å…ˆæ¥ä¸€å¼ æˆ‘çš„ IDE æˆªå›¾ï¼Œæœ‰ä½ çœ‹ä¸­çš„åœ°æ–¹å—ï¼Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200429091925.png" alt=""></fancybox></p><h2 id="æ’ä»¶ç¯‡"><a href="#æ’ä»¶ç¯‡" class="headerlink" title="æ’ä»¶ç¯‡"></a>æ’ä»¶ç¯‡</h2><p>å¥½ç”¨çš„æ’ä»¶æ€»æ˜¯è®©äººï¼š</p><p>ç¥æ¸…æ°”çˆ½ï¼Œç²¾ç¥æŠ–æ“ ï¼Œä¸°ç¥å¼‚å½©ï¼Œç‚¯ç‚¯æœ‰ç¥ï¼Œç¥é‡‡å¥•å¥•ï¼Œæ°”è´¯é•¿è™¹ ï¼Œè‹±å§¿é£’çˆ½ï¼Œç²¾ç¥ç„•å‘ </p><p><strong>ä¸‹é¢æ‰€æœ‰æ’ä»¶éƒ½å¯ä»¥æŒ‰ç…§æ–‡ä¸­æ ‡æ³¨çš„åç§°åœ¨ IDEA æ’ä»¶å¸‚åœºä¸­ç›´æ¥æœç´¢å¹¶å®‰è£…</strong></p><h3 id="Material-Theme-UI"><a href="#Material-Theme-UI" class="headerlink" title="Material Theme UI"></a>Material Theme UI</h3><p>Material Theme UI  åœ¨ä¸»é¢˜ä¸‹è½½é‡æ’è¡Œæ¦œä¸­é«˜å±…ç¬¬ä¸€ã€‚å®‰è£…ä¸»é¢˜åï¼ˆåœ¨é¡µé¢åº•éƒ¨å°±ä¼šæœ‰è¿›å…¥ä¸»é¢˜çš„å¿«æ·å…¥å£ï¼‰ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜è¿›è¡Œå¾®è°ƒå°±å¯ä»¥å•¦ï¼Œå¦‚æœæ‡’å¾—åšé…ç½®ï¼ŒæŒ‰ç…§ä¸‹å›¾å‹¾é€‰ç›¸åº”è®¾ç½®å°±å’Œæˆ‘çš„ä¸€æ ·äº†ï¼š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-01at10.46.17.gif" alt=""></fancybox></p><h3 id="Rainbow-Brackets"><a href="#Rainbow-Brackets" class="headerlink" title="Rainbow Brackets"></a>Rainbow Brackets</h3><p>ç¿»è¯‘è¿‡æ¥å«ã€å½©è™¹æ‹¬å·ã€‘ï¼Œè¯¥æ’ä»¶é™¤äº†å¯ä»¥å®ç°å¤šå½©çš„æ‹¬å·åŒ¹é…å¤–ï¼Œæˆ‘ä½¿ç”¨æ›´å¤šçš„æ˜¯å…¶ã€åŒºåŸŸä»£ç é«˜äº®ã€‘åŠŸèƒ½ ï¼Œè¿™æ ·å¯ä»¥æ¸…æ™°å®šä½åŒºåŸŸä»£ç å†…å®¹</p><blockquote><p>Mac å¿«æ·é”®ï¼š<code>cmd + é¼ æ ‡å³é”®</code>; </p><p>Windows å¿«æ·é”®ï¼š<code>ctrl + é¼ æ ‡å³é”®</code> </p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-01at11.31.30.gif" alt=""></fancybox></p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨éé€‰ä¸­éƒ¨åˆ†æš—æ·¡æ•ˆæœ</p><blockquote><p>å¿«æ·é”®ï¼š<code>alt + é¼ æ ‡å³é”®</code></p></blockquote><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-01at11.35.02.gif" alt=""></fancybox></p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘æ›´å–œæ¬¢ç¬¬ä¸€ç§é«˜äº®æ•ˆæœ</p><h3 id="Codota"><a href="#Codota" class="headerlink" title="Codota"></a>Codota</h3><p>Codota æ€»ç»“èµ·æ¥æœ‰ä¸‰å¤§åŠŸèƒ½ï¼š</p><h4 id="1-æ™ºèƒ½è‡ªåŠ¨è¡¥å…¨è®©ç¼–ç é€Ÿåº¦æ›´å¿«"><a href="#1-æ™ºèƒ½è‡ªåŠ¨è¡¥å…¨è®©ç¼–ç é€Ÿåº¦æ›´å¿«" class="headerlink" title="1. æ™ºèƒ½è‡ªåŠ¨è¡¥å…¨è®©ç¼–ç é€Ÿåº¦æ›´å¿«"></a>1. æ™ºèƒ½è‡ªåŠ¨è¡¥å…¨è®©ç¼–ç é€Ÿåº¦æ›´å¿«</h4><p>å½“ç¼–å†™ä»£ç æ—¶ï¼ŒCodota å¯ä»¥å¿«é€Ÿçš„å®Œæˆæ™ºèƒ½è¡¥å…¨ä»¥åŠé«˜é¢‘ç”¨æ³•æç¤º</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-01at21.18.45.gif" alt=""></fancybox></p><h4 id="2-ä»ç»è¿‡æµ‹è¯•æˆ–è¯æ˜è¿‡çš„ç¨‹åºä¸­è·å¾—ç¼–ç å»ºè®®"><a href="#2-ä»ç»è¿‡æµ‹è¯•æˆ–è¯æ˜è¿‡çš„ç¨‹åºä¸­è·å¾—ç¼–ç å»ºè®®" class="headerlink" title="2. ä»ç»è¿‡æµ‹è¯•æˆ–è¯æ˜è¿‡çš„ç¨‹åºä¸­è·å¾—ç¼–ç å»ºè®®"></a>2. ä»ç»è¿‡æµ‹è¯•æˆ–è¯æ˜è¿‡çš„ç¨‹åºä¸­è·å¾—ç¼–ç å»ºè®®</h4><p>å¦‚æœæˆ‘ä»¬è§‰å¾—ç»™å‡ºçš„æç¤ºä¸å¤Ÿæ¸…æ™°ï¼Œå¯ä»¥ä½¿ç”¨å¿«æ·é”®ï¼š <code>ctrl + shift + o</code> ï¼Œ å¿«é€ŸæŸ¥è¯¢ç›¸å…³ä½¿ç”¨æ¡ˆä¾‹ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡æ·»åŠ å…³é”®å­—è¿›è¡Œè¿‡æ»¤ï¼ŒæŸ¥æ‰¾åˆ°æ›´åŠ ç²¾ç¡®çš„ä»£ç æ ·ä¾‹</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-01at21.23.10.gif" alt=""></fancybox></p><h4 id="3-ä¸è„±ç¦»IDEå‘ç°å¹¶åˆ©ç”¨æ›´å¤šå¼€æºä»£ç "><a href="#3-ä¸è„±ç¦»IDEå‘ç°å¹¶åˆ©ç”¨æ›´å¤šå¼€æºä»£ç " class="headerlink" title="3. ä¸è„±ç¦»IDEå‘ç°å¹¶åˆ©ç”¨æ›´å¤šå¼€æºä»£ç "></a>3. ä¸è„±ç¦»IDEå‘ç°å¹¶åˆ©ç”¨æ›´å¤šå¼€æºä»£ç </h4><p>å½“ä½ ä¸çŸ¥é“æŸä¸ªç±»å¦‚ä½•ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¿«æ·é”®ï¼š<code>ctrl + shift + y</code> ï¼Œ ç„¶åè¾“å…¥å…³é”®å­—ï¼Œä¼šæŸ¥è¯¢åˆ°å¾ˆå¤šã€å¼€æºæ¡†æ¶ã€‘ä¸­ä½¿ç”¨è¯¥ç±»çš„ç»å…¸æ¡ˆä¾‹ã€‚ä¸ç”¨è„±ç¦» IDEï¼Œæ²¡æœ‰å¹¿å‘Šï¼Œæ²¡æœ‰åºŸè¯ï¼Œåªæœ‰ç»å…¸çš„ä»£ç æ ·ä¾‹ï¼Œä½ è¯´çˆ½ä¸çˆ½ï¼Ÿ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-01at21.25.26.gif" alt=""></fancybox></p><p>å¦‚æœä½ ç”¨ Eclipse ï¼ŒCodota ä¹Ÿæ˜¯å®Œç¾æ”¯æŒçš„<br><fancybox><img src="https://rgyb.sunluomeng.top/20200502193044.png" alt=""></fancybox></p><h3 id="Key-Promoter-X"><a href="#Key-Promoter-X" class="headerlink" title="Key Promoter X"></a>Key Promoter X</h3><p>é«˜æ•ˆçš„ç¼–ç è„±ç¦»ä¸å¼€å¿«æ·é”®çš„ä½¿ç”¨ï¼Œä½†æ˜¯ IDEA ä¸­çš„å¿«æ·é”®å®åœ¨å¤ªå¤šäº†ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿è®°å¿†ï¼ŒKey Promoter X ä¼šæ ¹æ®ä½ ä½¿ç”¨çš„åŠŸèƒ½æç¤ºä½ è®¾ç½®å¿«æ·é”®</p><p><fancybox><img src="https://rgyb.sunluomeng.top/2020-05-03at10.24.10.gif" alt=""></fancybox></p><p>è®¾ç½®å®Œåï¼Œå¦‚æœä½ å¿˜è®°äº†è¯¥å¿«æ·é”®ï¼Œå†æ¬¡é€šè¿‡é¼ æ ‡ç‚¹å‡»è¯¥åŠŸèƒ½æ—¶ï¼Œè®¾ç½®å¥½çš„å¿«æ·é”®å°±ä¼šç›¸åº”çš„æç¤ºå‡ºæ¥ï¼ŒçœŸæ˜¯æ·±çŸ¥ç å†œè‹¦å•Š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-02at19.49.37.gif" alt=""></fancybox></p><h3 id="Alibaba-Java-Code-Guideline"><a href="#Alibaba-Java-Code-Guideline" class="headerlink" title="Alibaba Java Code Guideline"></a>Alibaba Java Code Guideline</h3><p>å®‰è£…è¯¥æ’ä»¶åï¼Œä½ ç¼–å†™çš„ä»£ç å°±ä¼šæŒ‰ç…§ Alibaba ç¼–ç è§„çº¦è§„èŒƒæˆ‘ä»¬ç¼–å†™çš„ä»£ç ï¼ˆè°è¯´æˆ‘ä»¬ä¸èƒ½å†™å‡ºå’Œå¤§å‚ä¸€æ ·è§„èŒƒçš„ä»£ç ï¼Ÿï¼‰</p><p>æ¯”å¦‚é€šè¿‡Executors å¿«é€Ÿåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå…·ä½“åŸå› å·²ç»åœ¨<a href="https://dayarch.top/p/why-we-need-to-use-threadpool.html">æˆ‘ä¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</a> ä¸­è¯´æ˜ï¼Œå½“æ£€æµ‹å‡ºä¹‹åï¼Œé¼ æ ‡æ‚¬æµ®åœ¨ä¸Šé¢ä¼šç»™å‡ºæç¤ºï¼ŒæŒ‰å¿«æ·é”® <code>cmd + F1</code> ä¼šæ›´å®Œæ•´çš„å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆä¸å¯ä»¥ï¼ŒåŒæ—¶è¿˜ç»™å‡ºä½ åº”è¯¥æ€æ ·ç¼–å†™çš„æ ·ä¾‹ ï¼ˆæš–æš–çš„ï¼Œå¾ˆè´´å¿ƒï¼‰</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-02at20.10.38.gif" alt=""></fancybox></p><h3 id="CodeGlance"><a href="#CodeGlance" class="headerlink" title="CodeGlance"></a>CodeGlance</h3><p>è‹±æ–‡ç›´è¯‘ã€ä»£ç ä¸€ç¥ã€‘ï¼Œç»†å¿ƒçš„æœ‹å‹å·²ç»åœ¨å¼€ç¯‡çš„å›¾ä¸­çœ‹åˆ°äº†è¿™ä¸ªè®¾ç½®ï¼Œå®‰è£…è¯¥æ’ä»¶åï¼ŒIDEå³ä¾§ä¼šå‡ºç°ä¸€ä¸ªmini è§†å›¾ï¼Œæ¯”å¦‚çœ‹ ConcurrentHashMap æºç ï¼Œé‚£ä¹ˆé•¿çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡è¯¥æ’ä»¶å¿«é€Ÿçš„æ‹–åŠ¨åˆ°å¤§æ¦‚ä½ç½®ï¼Œæ–¹ä¾¿å¾ˆå¤š</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200502202154.png" alt=""></fancybox></p><h3 id="Restful-Tookit"><a href="#Restful-Tookit" class="headerlink" title="Restful Tookit"></a>Restful Tookit</h3><p>è¿™ä¸ªæ’ä»¶ä¹‹å‰æˆ‘æœ‰ä»‹ç»è¿‡ï¼Œç¼–å†™ RESTful æ¥å£å¿…ä¸å¯å°‘çš„æ’ä»¶ï¼Œç¼–å†™å®Œæ¥å£å½“ç„¶è¿˜éœ€è¦è°ƒè¯•ï¼Œæ­é…HTTP Client ä¸€èµ·ä½¿ç”¨æ‰æ›´é¦™ <a href="https://dayarch.top/p/http-client-advanced-usage.html">IntelliJ IDEA HTTP Clienté«˜çº§ä½¿ç”¨è¯¦è§£</a>ï¼Œç›¸ä¿¡ä½ å­¦ä¼šä½¿ç”¨è¿™ä¸ªï¼Œä¸å•å•æ˜¯ä½ ä¸ªäººï¼Œä½ ä»¬æ•´ä¸ªå°ç»„éƒ½ä¼šå› æ­¤å—ç›Š</p><h3 id="CamelCase"><a href="#CamelCase" class="headerlink" title="CamelCase"></a>CamelCase</h3><p>ç¼–ç ç¦»ä¸å¼€å­—ç¬¦ä¸²çš„ä½¿ç”¨ï¼Œå®‰è£…è¯¥æ’ä»¶åï¼Œå¯ä»¥é€šè¿‡å¿«æ·é”® <code>shift + alt + U</code> å¿«é€Ÿçš„åˆ‡æ¢å­—ç¬¦ä¸²æ ¼å¼ï¼Œå½“ç„¶å¦‚æœä½ åªæ˜¯å•çº¯çš„åˆ‡æ¢å¤§å°å†™ï¼Œä½¿ç”¨ <code>shift + cmd + U</code> æ›´ä¾¿æ·ä¸€äº›</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-02at20.37.56.gif" alt=""></fancybox></p><h2 id="è®¾ç½®ç¯‡"><a href="#è®¾ç½®ç¯‡" class="headerlink" title="è®¾ç½®ç¯‡"></a>è®¾ç½®ç¯‡</h2><h3 id="æ–¹æ³•åˆ†å‰²çº¿ä»¥åŠå­—ç¬¦ç¼©è¿›"><a href="#æ–¹æ³•åˆ†å‰²çº¿ä»¥åŠå­—ç¬¦ç¼©è¿›" class="headerlink" title="æ–¹æ³•åˆ†å‰²çº¿ä»¥åŠå­—ç¬¦ç¼©è¿›"></a>æ–¹æ³•åˆ†å‰²çº¿ä»¥åŠå­—ç¬¦ç¼©è¿›</h3><p>é€šè¿‡æ–¹æ³•åˆ†å‰²çº¿å¯ä»¥æ›´æ¸…æ™°æ˜äº†çš„åŒºåˆ†æ–¹æ³•çš„è¾¹ç•Œï¼Œé€šè¿‡å­—ç¬¦ç¼©è¿›ä¹Ÿå¯ä»¥è®©ä»£ç çš„å±‚æ¬¡æ„Ÿæ›´åŠ æ˜æ˜¾ï¼Œå…ˆæ¥çœ‹æ•´ä½“æ•ˆæœ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200502205359.png" alt=""></fancybox></p><p>åªéœ€è¦æŒ‰ç…§ä¸‹å›¾å‹¾é€‰ç›¸åº”é€‰é¡¹å°±å¯ä»¥äº† ï¼ˆç°åœ¨æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Ÿï¼‰</p><p><fancybox><img src="https://rgyb.sunluomeng.top/20200502205434.png" alt=""></fancybox></p><h3 id="Editor-è¾¹æ ä½ç½®è®¾ç½®"><a href="#Editor-è¾¹æ ä½ç½®è®¾ç½®" class="headerlink" title="Editor è¾¹æ ä½ç½®è®¾ç½®"></a>Editor è¾¹æ ä½ç½®è®¾ç½®</h3><p>å¦‚æœä½ ä¸èƒ½ç†Ÿæ‚‰çš„ä½¿ç”¨ <code>cmd + E</code> å¿«æ·é”®ï¼ˆä¸€ä¸å°å¿ƒç»™äº†æç¤ºï¼‰æ‰“å¼€ä½ æœ€è¿‘å¸¸ç”¨çš„æ–‡ä»¶ï¼Œé¡¶éƒ¨ä½ç½®å¯æ˜¾ç¤ºçš„æ‰“å¼€çš„ç±»åç§°å°‘ä¹‹åˆå°‘ï¼Œæ‰€ä»¥é€šè¿‡æŒªåŠ¨ Editor çš„æ˜¾ç¤ºä½ç½®ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªç—›ç‚¹é—®é¢˜ï¼Œç°åœ¨æ˜¯ä¸æ˜¯æåº¦èˆ’é€‚äº†å‘¢ï¼Ÿ</p><p><fancybox><img src="https://rgyb.sunluomeng.top/Kapture2020-05-02at20.46.49.gif" alt=""></fancybox></p><hr><p>å½“ä½ è§‰å¾—éœ€è¦ IDEA å¸®åŠ©ä½ æ›´é«˜æ•ˆçš„å·¥ä½œæ—¶ï¼Œä¸å¦¨å»æ’ä»¶å¸‚åœºæœæœçœ‹ï¼Œæ²¡å‡†å°±æœ‰æ„æƒ³ä¸åˆ°çš„æƒŠå–œã€‚å¦å¤–ï¼Œè¿™æ˜¯ä¸€ä¸ª IDEA è®¾ç½®ç¯‡çš„åˆé›†ï¼Œæˆ‘ä¼šé™†ç»­å°†æ›´å¤šè®¾ç½®å’Œå¥½ç”¨çš„æ’ä»¶æ•´åˆåˆ°è¿™ä¸€ç¯‡æ–‡ç« å½“ä¸­ï¼Œä¸ºäº†ä¸é”™è¿‡æ›´å¤šç²¾å½©å†…å®¹ï¼Œä½ å¯ä»¥ç›´æ¥é€‰æ‹©æ”¶è—å•¦</p><p>æœ€åï¼Œæˆ‘ä¹Ÿæ•´ç†äº†å¾ˆå¤šå¯ä»¥å¸®ä½ é«˜æ•ˆå·¥ä½œçš„å·¥å…·ï¼Œå…¬ä¼—å·å›å¤ã€å·¥å…·ã€‘å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IntelliJ IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?</title>
      <link href="//p/why-we-need-to-use-threadpool.html"/>
      <url>//p/why-we-need-to-use-threadpool.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200419154934.png" alt=""></p><p>ä¸Šä¸€ç¯‡æ–‡ç«   <a href="https://dayarch.top/p/how-many-threads-should-be-created.html">é¢è¯•é—®æˆ‘ï¼Œåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿæˆ‘è¯¥æ€ä¹ˆè¯´</a>  ä»å®šæ€§åˆ°å®šé‡çš„åˆ†æäº†å¦‚ä½•åˆ›å»ºæ­£ç¡®ä¸ªæ•°çš„çº¿ç¨‹æ¥æœ€å¤§åŒ–åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼ˆå…¶å®å°±æ˜¯å‡ é“å°å­¦æ•°å­¦é¢˜ï¼‰ã€‚é€šå¸¸æ¥è®²ï¼Œæœ‰äº†ä¸ªè¿™ä¸ªçŸ¥è¯†ç‚¹å‚èº«ï¼ŒæŒ‰éœ€æ‰‹åŠ¨åˆ›å»ºç›¸åº”ä¸ªæ•°çš„çº¿ç¨‹å°±å¥½</p><p>ä½†æ˜¯ç°å®ä¸­ï¼Œä½ ä¹Ÿè®¸å¬è¿‡æˆ–è€…è¢«è¦æ±‚ï¼š</p><blockquote><p>å°½é‡é¿å…æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œåº”ä½¿ç”¨çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†çº¿ç¨‹</p></blockquote><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„è¦æ±‚ï¼ŸèƒŒåçš„é“ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿé¡ºç€è¿™ä¸ªç»éªŒç†è®ºæ¥æ¨æ–­ï¼Œé‚£è‚¯å®šæ˜¯æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æœ‰ç¼ºç‚¹</p><h2 id="æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"><a href="#æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ" class="headerlink" title="æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"></a>æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</h2><ol><li>ä¸å—æ§é£é™©</li><li>é¢‘ç¹åˆ›å»ºå¼€é”€å¤§</li></ol><h3 id="ä¸å—æ§é£é™©"><a href="#ä¸å—æ§é£é™©" class="headerlink" title="ä¸å—æ§é£é™©"></a>ä¸å—æ§é£é™©</h3><p>è¿™ä¸ªç¼ºç‚¹ï¼Œç›¸ä¿¡ä½ ä¹Ÿå¯ä»¥è¯´å‡ºä¸€äºŒ</p><p>ç³»ç»Ÿèµ„æºæœ‰é™ï¼Œæ¯ä¸ªäººé’ˆå¯¹ä¸åŒä¸šåŠ¡éƒ½å¯ä»¥æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶ä¸”åˆ›å»ºæ ‡å‡†ä¸ä¸€æ ·ï¼ˆæ¯”å¦‚çº¿ç¨‹æ²¡æœ‰åå­—ï¼‰ã€‚å½“ç³»ç»Ÿè¿è¡Œèµ·æ¥ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ç–¯ç‹‚æŠ¢å èµ„æºï¼Œæ— ç»„ç»‡æ— çºªå¾‹ï¼Œæ··ä¹±åœºé¢å¯æƒ³è€ŒçŸ¥ï¼ˆå‡ºç°é—®é¢˜ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸å¯èƒ½è½»æ˜“çš„å‘ç°å’Œè§£å†³ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20181101002826_kaCnoA.gif" alt=""></p><p>å¦‚æœæœ‰ä½ç¥å¥‡çš„å°ä¼™ä¼´ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå½“å¤§é‡è¯·æ±‚é“ºé¢è€Œæ¥çš„æ—¶å€™ï¼Œè¿™å¥½æ¯”ä¸€ä¸ªæ­£è§„æœ¨é©¬ç¨‹åºï¼Œå†…å­˜è¢«æ— æƒ…æ¦¨å¹²è€—å°½ï¼ˆä½ æ— æƒ…ï¼Œä½ å†·é…·ï¼Œä½ æ— ç†å–é—¹ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200418205443.png" alt=""></p><p>å¦å¤–ï¼Œè¿‡å¤šçš„çº¿ç¨‹è‡ªç„¶ä¹Ÿä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</p><p>æ€»çš„æ¥è¯´ï¼Œä¸å—æ§é£é™©å¾ˆå¤§</p><h3 id="é¢‘ç¹åˆ›å»ºå¼€é”€å¤§"><a href="#é¢‘ç¹åˆ›å»ºå¼€é”€å¤§" class="headerlink" title="é¢‘ç¹åˆ›å»ºå¼€é”€å¤§"></a>é¢‘ç¹åˆ›å»ºå¼€é”€å¤§</h3><blockquote><p><strong>é¢è¯•é—®ï¼š</strong>é¢‘ç¹æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p><strong>ç­”ï¼š</strong>å¼€é”€å¤§</p></blockquote><p>è¿™è²Œä¼¼æ˜¯ä¸€ä¸ªä¸å‡æ€ç´¢å°±å¯ä»¥å›ç­”å‡ºæ¥çš„æ­£ç¡®ç­”æ¡ˆã€‚é‚£æˆ‘è¦ç»§ç»­é—®äº†</p><blockquote><p><strong>é¢è¯•å®˜ï¼š</strong>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹²äº†ä»€ä¹ˆå°±å¼€é”€å¤§äº†ï¼Ÿå’Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€š Java å¯¹è±¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</p><p><strong>ç­”ï¼š</strong> â€¦ å—¯â€¦å•Š </p></blockquote><p>æŒ‰ç…§å¸¸è§„ç†è§£ new Thread() åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å’Œ new Object() æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚Javaä¸­ä¸‡ç‰©æ¥å¯¹è±¡ï¼Œå› ä¸º Thread çš„è€ç¥–å®—ä¹Ÿæ˜¯ Object</p><p>å¦‚æœä½ çœŸæ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œè¯´æ˜ä½ å¯¹çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸè¿˜ä¸æ˜¯å¾ˆç†è§£ï¼Œè¯·å›çœ‹ä¹‹å‰çš„ <a href="https://dayarch.top/p/java-thread-life-cycle.html">Javaçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸè¿™æ ·ç†è§£æŒºç®€å•çš„</a></p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ˜ç¡®è¯´æ˜ï¼Œnew Thread() åœ¨æ“ä½œç³»ç»Ÿå±‚é¢å¹¶æ²¡æœ‰åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè¿™æ˜¯ç¼–ç¨‹è¯­è¨€ç‰¹æœ‰çš„ã€‚çœŸæ­£è½¬æ¢ä¸ºæ“ä½œç³»ç»Ÿå±‚é¢åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿˜è¦è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„APIï¼Œç„¶åæ“ä½œç³»ç»Ÿè¦ä¸ºè¯¥çº¿ç¨‹åˆ†é…ä¸€ç³»åˆ—çš„èµ„æº</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å°†äºŒè€…åšä¸ªå¯¹æ¯”ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200415105301.png" alt=""></p><h4 id="new-Object-è¿‡ç¨‹"><a href="#new-Object-è¿‡ç¨‹" class="headerlink" title="new Object() è¿‡ç¨‹"></a>new Object() è¿‡ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br></pre></td></tr></table></figure><p>å½“æˆ‘éœ€è¦ã€å¯¹è±¡ã€‘æ—¶ï¼Œæˆ‘å°±ä¼šç»™è‡ªå·± new ä¸€ä¸ªï¼ˆä¸çŸ¥ä½ æ˜¯å¦å’Œæˆ‘ä¸€æ ·ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½ åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼š</p><ol><li>åˆ†é…ä¸€å—å†…å­˜ M</li><li>åœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ–è¯¥å¯¹è±¡</li><li>å°†å†…å­˜ M çš„åœ°å€èµ‹å€¼ç»™å¼•ç”¨å˜é‡ obj</li></ol><p>å°±æ˜¯è¿™ä¹ˆç®€å•</p><h4 id="åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„è¿‡ç¨‹"><a href="#åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„è¿‡ç¨‹"></a>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„è¿‡ç¨‹</h4><p>ä¸Šé¢å·²ç»æåˆ°äº†ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹è¿˜è¦è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸APIã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹çš„å¼€é”€ï¼Œæˆ‘ä»¬éœ€è¦çœ‹çœ‹ JVM åœ¨èƒŒåå¸®æˆ‘ä»¬åšäº†å“ªäº›äº‹æƒ…ï¼š</p><ol><li>å®ƒä¸ºä¸€ä¸ªçº¿ç¨‹æ ˆåˆ†é…å†…å­˜ï¼Œè¯¥æ ˆä¸ºæ¯ä¸ªçº¿ç¨‹æ–¹æ³•è°ƒç”¨ä¿å­˜ä¸€ä¸ªæ ˆå¸§</li><li>æ¯ä¸€æ ˆå¸§ç”±ä¸€ä¸ªå±€éƒ¨å˜é‡æ•°ç»„ã€è¿”å›å€¼ã€æ“ä½œæ•°å †æ ˆå’Œå¸¸é‡æ± ç»„æˆ</li><li>ä¸€äº›æ”¯æŒæœ¬æœºæ–¹æ³•çš„ jvm ä¹Ÿä¼šåˆ†é…ä¸€ä¸ªæœ¬æœºå †æ ˆ</li><li>æ¯ä¸ªçº¿ç¨‹è·å¾—ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼Œå‘Šè¯‰å®ƒå½“å‰å¤„ç†å™¨æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ä»€ä¹ˆ</li><li>ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªä¸Javaçº¿ç¨‹å¯¹åº”çš„æœ¬æœºçº¿ç¨‹</li><li>å°†ä¸çº¿ç¨‹ç›¸å…³çš„æè¿°ç¬¦æ·»åŠ åˆ°JVMå†…éƒ¨æ•°æ®ç»“æ„ä¸­</li><li>çº¿ç¨‹å…±äº«å †å’Œæ–¹æ³•åŒºåŸŸ</li></ol><p>è¿™æ®µæè¿°ç¨ç¨æœ‰ç‚¹æŠ½è±¡ï¼Œç”¨æ•°æ®æ¥è¯´æ˜åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆå³ä¾¿ä¸å¹²ä»€ä¹ˆï¼‰éœ€è¦å¤šå¤§ç©ºé—´å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¤§çº¦  <code>1M</code>  å·¦å³</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockDiagnosticVMOptions -XX:NativeMemoryTracking=summary -XX:+PrintNMTStatistics -version</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200418201711.png" alt=""></p><p>ä¸Šå›¾æ˜¯æˆ‘ç”¨ Java8 çš„æµ‹è¯•ç»“æœï¼Œ19ä¸ªçº¿ç¨‹ï¼Œé¢„ç•™å’Œæäº¤çš„å¤§æ¦‚éƒ½æ˜¯19000+KBï¼Œå¹³å‡æ¯ä¸ªçº¿ç¨‹å¤§æ¦‚éœ€è¦ 1M å·¦å³çš„å¤§å°ï¼ˆJava11çš„ç»“æœå®Œå…¨ä¸åŒï¼Œè¿™ä¸ªå¤§å®¶è‡ªè¡Œæµ‹è¯•å§ï¼‰</p><p>ç›¸ä¿¡åˆ°è¿™é‡Œä½ å·²ç»æ˜ç™½äº†ï¼Œå¯¹äºæ€§èƒ½è¦æ±‚ä¸¥è‹›çš„ç°åœ¨ï¼Œé¢‘ç¹æ‰‹åŠ¨åˆ›å»º/é”€æ¯çº¿ç¨‹çš„ä»£ä»·æ˜¯éå¸¸å·¨å¤§çš„ï¼Œè§£å†³æ–¹æ¡ˆè‡ªç„¶ä¹Ÿæ˜¯ä½ çŸ¥é“çš„çº¿ç¨‹æ± äº†</p><h2 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</h2><p>ä½ å¸¸è§çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå®ä¾‹æ± ï¼Œè¿˜æœ‰XXæ± ï¼ŒOOæ± ï¼Œå„ç§æ± ï¼Œéƒ½æ˜¯ä¸€ç§æ± åŒ–ï¼ˆpoolingï¼‰æ€æƒ³ï¼Œ<strong>ç®€è€Œè¨€ä¹‹å°±æ˜¯ä¸ºäº†æœ€å¤§åŒ–æ”¶ç›Šï¼Œå¹¶æœ€å°åŒ–é£é™©ï¼Œå°†èµ„æºç»Ÿä¸€åœ¨ä¸€èµ·ç®¡ç†çš„æ€æƒ³</strong></p><p>Java ä¹Ÿæä¾›äº†å®ƒè‡ªå·±å®ç°çš„çº¿ç¨‹æ± æ¨¡å‹â€”â€” <code>ThreadPoolExecutor</code>ã€‚å¥—ç”¨ä¸Šé¢æ± åŒ–çš„æƒ³è±¡æ¥è¯´ï¼ŒJavaçº¿ç¨‹æ± å°±æ˜¯ä¸ºäº†æœ€å¤§åŒ–é«˜å¹¶å‘å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œå¹¶æœ€å°åŒ–æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹çš„é£é™©ï¼Œå°†å¤šä¸ªçº¿ç¨‹ç»Ÿä¸€åœ¨ä¸€èµ·ç®¡ç†çš„æ€æƒ³</p><p>ä¸ºäº†äº†è§£è¿™ä¸ªç®¡ç†æ€æƒ³ï¼Œæˆ‘ä»¬å½“å‰åªéœ€è¦å…³æ³¨ <code>ThreadPoolExecutor</code> æ„é€ æ–¹æ³•å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                              ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                              RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">this</span>.acc = System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">                <span class="keyword">null</span> :</span><br><span class="line">                AccessController.getContext();</span><br><span class="line">        <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">        <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">        <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">        <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆå¤æ‚çš„æ„é€ æ–¹æ³•åœ¨JDKä¸­è¿˜çœŸæ˜¯ä¸å¤šè§ï¼Œä¸ºäº†ä¸ªæ›´å½¢è±¡åŒ–çš„è®©å¤§å®¶ç†è§£è¿™å‡ ä¸ªæ ¸å¿ƒå‚æ•°ï¼Œæˆ‘ä»¬ä»¥å¤šæ•°äººéƒ½ç»å†è¿‡çš„æ˜¥è¿ï¼ˆåŒ—äº¬â€”â€”ä¸Šæµ·ï¼‰æ¥è¯´æ˜</p><table><thead><tr><th>åºå·</th><th>å‚æ•°åç§°</th><th>å‚æ•°è§£é‡Š</th><th>æ˜¥è¿å½¢è±¡è¯´æ˜</th></tr></thead><tbody><tr><td>1</td><td>corePoolSize</td><td>è¡¨ç¤ºå¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœå¤§äº0ï¼Œå³ä½¿æœ¬åœ°ä»»åŠ¡æ‰§è¡Œå®Œä¹Ÿä¸ä¼šè¢«é”€æ¯</td><td>æ—¥å¸¸å›ºå®šçš„åˆ—è½¦æ•°è¾†ï¼ˆä¸ç®¡æ˜¯ä¸æ˜¯æ˜¥è¿ï¼Œéƒ½è¦æœ‰å›ºå®šè¿™äº›è½¦æ¬¡è¿è¡Œï¼‰</td></tr><tr><td>2</td><td>maximumPoolSize</td><td>è¡¨ç¤ºçº¿ç¨‹æ± èƒ½å¤Ÿå®¹çº³å¯åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°</td><td>æ˜¥è¿å®¢æµé‡å¤§ï¼Œä¸´æ—¶åŠ è½¦ï¼ŒåŠ è½¦åï¼Œæ€»åˆ—è½¦æ¬¡æ•°ä¸èƒ½è¶…è¿‡è¿™ä¸ªæœ€å¤§å€¼ï¼Œå¦åˆ™å°±ä¼šå‡ºç°è°ƒåº¦ä¸å¼€ç­‰é—®é¢˜ ï¼ˆç»“åˆworkqueueï¼‰</td></tr><tr><td>3</td><td>keepAliveTime</td><td>è¡¨ç¤ºçº¿ç¨‹æ± ä¸­çº¿ç¨‹ç©ºé—²çš„æ—¶é—´ï¼Œå½“ç©ºé—²æ—¶é—´è¾¾åˆ°è¯¥å€¼æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œåªå‰©ä¸‹ <code>corePoolSize</code> ä¸ªçº¿ç¨‹ä½ç½®</td><td>æ˜¥è¿å‹åŠ›è¿‡åï¼Œä¸´æ—¶çš„åŠ è½¦ï¼ˆå¦‚æœç©ºé—²æ—¶é—´è¶…è¿‡<code>keepAliveTime</code>ï¼‰å°±ä¼šè¢«æ’¤æ‰ï¼Œåªä¿ç•™æ—¥å¸¸å›ºå®šçš„åˆ—è½¦è½¦æ¬¡æ•°é‡ç”¨äºæ—¥å¸¸è¿è¥</td></tr><tr><td>4</td><td>unit</td><td><code>keepAliveTime</code> çš„æ—¶é—´å•ä½ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢æˆã€çº³ç§’ã€‘ï¼Œå› ä¸ºCPUçš„æ‰§è¡Œé€Ÿåº¦æ æ æ»´</td><td><code>keepAliveTime</code> çš„å•ä½ï¼Œæ˜¥è¿ä»¥ã€å¤©ã€‘ä¸ºè®¡ç®—å•ä½</td></tr><tr><td>5</td><td>workQueue</td><td>å½“è¯·æ±‚çš„çº¿ç¨‹æ•°å¤§äº <code>corePoolSize</code> æ—¶ï¼Œçº¿ç¨‹è¿›å…¥è¯¥é˜»å¡é˜Ÿåˆ—</td><td>æ˜¥è¿å‹åŠ›å¼‚å¸¸å¤§ï¼Œï¼ˆè¾¾åˆ°<code>corePoolSize</code>ï¼‰ä¹Ÿä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæ‰€æœ‰ä¹˜åè¯·æ±‚éƒ½ä¼šè¿›å…¥è¯¥é˜»å¡é˜Ÿåˆ—ä¸­æ’é˜Ÿ, é˜Ÿåˆ—æ»¡ï¼Œè¿˜æœ‰é¢å¤–è¯·æ±‚ï¼Œå°±éœ€è¦åŠ è½¦äº†</td></tr><tr><td>6</td><td>threadFactory</td><td>é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥ç”Ÿäº§ä¸€ç»„ç›¸åŒä»»åŠ¡çš„çº¿ç¨‹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡å®ƒå¢åŠ å‰ç¼€åï¼Œè™šæ‹Ÿæœºæ ˆåˆ†ææ—¶æ›´æ¸…æ™°</td><td>æ¯”å¦‚ï¼ˆåŒ—äº¬â€”â€”ä¸Šæµ·ï¼‰å°±å±äºè¯¥æ®µåˆ—è½¦æ‰€æœ‰å‰ç¼€ï¼Œè¡¨æ˜åˆ—è½¦è¿è¾“èŒè´£</td></tr><tr><td>7</td><td>handler</td><td>æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼Œå½“ <code>workQueue</code> è¾¾åˆ°ä¸Šé™ï¼ŒåŒæ—¶ä¹Ÿè¾¾åˆ° <code>maximumPoolSize</code> å°±è¦é€šè¿‡è¿™ä¸ªæ¥å¤„ç†ï¼Œæ¯”å¦‚æ‹’ç»ï¼Œä¸¢å¼ƒç­‰ï¼Œè¿™æ˜¯ä¸€ç§é™æµçš„ä¿æŠ¤æªæ–½</td><td>å½“<code>workQueue</code>æ’é˜Ÿä¹Ÿè¾¾åˆ°é˜Ÿåˆ—æœ€å¤§ä¸Šçº¿ï¼Œ<code>maximumPoolSize</code> å°±è¦æç¤ºæ— ç¥¨ç­‰æ‹’ç»ç­–ç•¥äº†,å› ä¸ºæˆ‘ä»¬ä¸èƒ½åŠ è½¦äº†ï¼Œå½“å‰æ‰€æœ‰è½¦æ¬¡å·²ç»æ»¡è´Ÿè½½</td></tr></tbody></table><p>æ•´ä½“æ¥çœ‹å°±æ˜¯è¿™æ ·ï¼š<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200421065936.png" alt=""></fancybox></p><p>è¯•æƒ³ï¼Œå¦‚æœæœ‰è¯·æ±‚å°±æ–°å»ºä¸€è¶Ÿåˆ—è½¦ï¼Œè¯·æ±‚ç»“æŸå°±â€œé”€æ¯â€è¿™è¶Ÿåˆ—è½¦ï¼Œé¢‘ç¹å¾€å¤è¿™æ ·æ“ä½œï¼Œè¿™æ ·çš„ä»£ä»·è‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨çº¿ç¨‹æ± ä¸ä½†èƒ½å®Œæˆæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¯ä»¥åšåˆ°çš„å·¥ä½œï¼ŒåŒæ—¶ä¹Ÿå¡«è¡¥äº†æ‰‹åŠ¨çº¿ç¨‹ä¸èƒ½åšåˆ°çš„ç©ºç™½ã€‚å½’çº³èµ·æ¥è¯´ï¼Œçº¿ç¨‹æ± çš„ä½œç”¨åŒ…æ‹¬ï¼š</p><ol><li>åˆ©ç”¨çº¿ç¨‹æ± ç®¡ç†å¹¶æœç”¨çº¿ç¨‹ï¼Œæ§åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼ˆæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¾ˆéš¾å¾—åˆ°ä¿è¯ï¼‰</li><li>å®ç°ä»»åŠ¡çº¿ç¨‹é˜Ÿåˆ—ç¼“å­˜ç­–ç•¥å’Œæ‹’ç»æœºåˆ¶</li><li>å®ç°æŸäº›ä¸å®è·µç›¸å…³çš„åŠŸèƒ½ï¼Œå¦‚å®šæ—¶æ‰§è¡Œï¼Œå‘¨æœŸæ‰§è¡Œç­‰ï¼ˆæ¯”å¦‚åˆ—è½¦æŒ‡å®šæ—¶é—´è¿è¡Œï¼‰</li><li>éš”ç¦»çº¿ç¨‹ç¯å¢ƒï¼Œæ¯”å¦‚ï¼Œäº¤æ˜“æœåŠ¡å’Œæœç´¢æœåŠ¡åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œåˆ†åˆ«å¼€å¯ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œäº¤æ˜“çº¿ç¨‹çš„èµ„æºæ¶ˆè€—æ˜æ˜¾è¦å¤§ã€‚å› æ­¤ï¼Œé€šè¿‡é…ç½®ç‹¬ç«‹çš„çº¿ç¨‹æ± ï¼Œå°†è¾ƒæ…¢çš„äº¤æ˜“æœåŠ¡ä¸æœç´¢æœåŠ¡ä¸ªç¦»å¼€ï¼Œé¿å…ä¸ªæœåŠ¡çº¿ç¨‹äº’ç›¸å½±å“</li></ol><p>ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ å·²ç»äº†è§£çº¿ç¨‹æ± çš„åŸºæœ¬æ€æƒ³äº†ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æ˜¯æœ‰å‡ ä¸ªæ³¨æ„äº‹é¡¹è¦è¯´æ˜ä¸€ä¸‹çš„</p><h2 id="çº¿ç¨‹æ± ä½¿ç”¨æ€æƒ³-æ³¨æ„äº‹é¡¹"><a href="#çº¿ç¨‹æ± ä½¿ç”¨æ€æƒ³-æ³¨æ„äº‹é¡¹" class="headerlink" title="çº¿ç¨‹æ± ä½¿ç”¨æ€æƒ³/æ³¨æ„äº‹é¡¹"></a>çº¿ç¨‹æ± ä½¿ç”¨æ€æƒ³/æ³¨æ„äº‹é¡¹</h2><h3 id="ä¸èƒ½å¿½ç•¥çš„çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥"><a href="#ä¸èƒ½å¿½ç•¥çš„çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥" class="headerlink" title="ä¸èƒ½å¿½ç•¥çš„çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥"></a>ä¸èƒ½å¿½ç•¥çš„çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥</h3><p>æˆ‘ä»¬å¾ˆéš¾å‡†ç¡®çš„é¢„æµ‹æœªæ¥çš„æœ€å¤§å¹¶å‘é‡ï¼Œæ‰€ä»¥å®šåˆ¶åˆç†çš„æ‹’ç»ç­–ç•¥æ˜¯å¿…ä¸å¯å°‘çš„æ­¥éª¤ã€‚é»˜è®¤æƒ…å†µï¼Œ ThreadPoolExecutor æä¾›äº†å››ç§æ‹’ç»ç­–ç•¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200419122441.png" alt=""></p><ol><li><p>AbortPolicyï¼šé»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼Œä¼š throw RejectedExecutionException æ‹’ç»</p></li><li><p>CallerRunsPolicyï¼šæäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±å»æ‰§è¡Œè¯¥ä»»åŠ¡</p></li><li><p>DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡ï¼Œå…¶å®å°±æ˜¯æŠŠæœ€æ—©è¿›å…¥å·¥ä½œé˜Ÿåˆ—çš„ä»»åŠ¡ä¸¢å¼ƒï¼Œç„¶åæŠŠæ–°ä»»åŠ¡åŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—</p></li><li><p>DiscardPolicyï¼šç›¸å½“å¤§èƒ†çš„ç­–ç•¥ï¼Œç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡º</p></li></ol><p>ä¸åŒçš„æ¡†æ¶ï¼ˆNettyï¼ŒDubboï¼‰éƒ½æœ‰ä¸åŒçš„æ‹’ç»ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®ç° <code>RejectedExecutionHandler</code> è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥</p><p>å¯¹äºé‡‡ç”¨ä½•ç§ç­–ç•¥ï¼Œå…·ä½“è¦çœ‹æ‰§è¡Œçš„ä»»åŠ¡é‡è¦ç¨‹åº¦ã€‚å¦‚æœæ˜¯ä¸€äº›ä¸é‡è¦ä»»åŠ¡ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥ä¸¢å¼ƒï¼›å¦‚æœæ˜¯é‡è¦ä»»åŠ¡ï¼Œå¯ä»¥é‡‡ç”¨é™çº§ï¼ˆæ‰€è°“é™çº§å°±æ˜¯åœ¨æœåŠ¡æ— æ³•æ­£å¸¸æä¾›åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œé‡‡å–çš„è¡¥æ•‘æªæ–½ã€‚å…·ä½“é‡‡ç”¨ä½•ç§é™çº§æ‰‹æ®µï¼Œè¿™ä¹Ÿæ˜¯è¦çœ‹å…·ä½“åœºæ™¯ï¼‰å¤„ç†ï¼Œä¾‹å¦‚å°†ä»»åŠ¡ä¿¡æ¯æ’å…¥æ•°æ®åº“æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ç”¨ä¸€ä¸ªä¸“é—¨ç”¨ä½œè¡¥å¿çš„çº¿ç¨‹æ± å»è¿›è¡Œè¡¥å¿</p><p>æ²¡æœ‰ç»å¯¹çš„æ‹’ç»ç­–ç•¥ï¼Œåªæœ‰é€‚åˆé‚£ä¸€ä¸ªï¼Œä½†åœ¨è®¾è®¡è¿‡ç¨‹ä¸­åƒä¸‡ä¸è¦å¿½ç•¥æ‰æ‹’ç»ç­–ç•¥å°±å¯ä»¥</p><h3 id="ç¦æ­¢ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± "><a href="#ç¦æ­¢ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="ç¦æ­¢ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± "></a>ç¦æ­¢ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± </h3><p>ç›¸ä¿¡å¾ˆå¤šäººéƒ½çœ‹åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼ˆé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œè¯´æ˜ç¦æ­¢ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼‰ï¼Œæˆ‘æŠŠå‡ºå¤„ï¼ˆP247ï¼‰æˆªå›¾åœ¨æ­¤ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200413215729.png" alt=""></p><p>Executors å¤§å¤§çš„ç®€åŒ–äº†æˆ‘ä»¬åˆ›å»ºå„ç§ç±»å‹çº¿ç¨‹æ± çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆè¿˜ä¸è®©ä½¿ç”¨å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œåªè¦ä½ æ‰“å¼€çœ‹çœ‹å®ƒçš„é™æ€æ–¹æ³•å‚æ•°å°±ä¼šæ˜ç™½äº†</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200419105202.png" alt=""></p><p>ä¼ å…¥çš„workQueue æ˜¯ä¸€ä¸ªè¾¹ç•Œä¸º <code>Integer.MAX_VALUE</code> é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å˜ç›¸çš„ç§°ä¹‹ä¸ºæ— ç•Œé˜Ÿåˆ—äº†ï¼Œå› ä¸ºè¾¹ç•Œå¤ªå¤§äº†ï¼Œè¿™ä¹ˆå¤§çš„ç­‰å¾…é˜Ÿåˆ—ä¹Ÿæ˜¯éå¸¸æ¶ˆè€—å†…å­˜çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a &#123;<span class="doctag">@code</span> LinkedBlockingQueue&#125; with a capacity of</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Integer#MAX_VALUE&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedBlockingQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>(Integer.MAX_VALUE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–è¯¥ ThreadPoolExecutoræ–¹æ³•ä½¿ç”¨çš„æ˜¯é»˜è®¤æ‹’ç»ç­–ç•¥ï¼ˆç›´æ¥æ‹’ç»ï¼‰ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ä¸šåŠ¡åœºæ™¯éƒ½é€‚åˆä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå½“å¾ˆé‡è¦çš„è¯·æ±‚è¿‡æ¥ç›´æ¥é€‰æ‹©æ‹’ç»æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200419105928.png" alt=""></p><p>æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨ Executors åˆ›å»ºçš„çº¿ç¨‹æ± å¤ªè¿‡äºç†æƒ³åŒ–ï¼Œå¹¶ä¸èƒ½æ»¡è¶³å¾ˆå¤šç°å®ä¸­çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ‰€ä»¥è¦æ±‚æˆ‘ä»¬é€šè¿‡ ThreadPoolExecutoræ¥åˆ›å»ºï¼Œå¹¶ä¼ å…¥åˆé€‚çš„å‚æ•°</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å½“æˆ‘ä»¬éœ€è¦é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œæˆ‘ä»¬è¦è€ƒè™‘åˆ°é€šè¿‡çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†çº¿ç¨‹èµ„æºï¼Œé¿å…ä¸å¯æ§é£é™©ä»¥åŠé¢å¤–çš„å¼€é”€</p><p>äº†è§£äº†çº¿ç¨‹æ± çš„å‡ ä¸ªæ ¸å¿ƒå‚æ•°æ¦‚å¿µåï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ç»è¿‡è°ƒä¼˜çš„è¿‡ç¨‹æ¥è®¾ç½®æœ€ä½³çº¿ç¨‹å‚æ•°å€¼ï¼ˆè¿™ä¸ªè¿‡ç¨‹æ—¶å¿…ä¸å¯å°‘çš„ï¼‰</p><p>çº¿ç¨‹æ± è™½ç„¶å¼¥è¡¥äº†æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹çš„ç¼ºé™·å’Œç©ºç™½ï¼ŒåŒæ—¶ï¼Œåˆç†çš„é™çº§ç­–ç•¥èƒ½å¤§å¤§å¢åŠ ç³»ç»Ÿçš„ç¨³å®šæ€§</p><p>é˜¿é‡Œå·´å·´æ‰‹å†Œéƒ½æ˜¯å‰è¾ˆä»¬æ— æ•°å¡«å‘åæ€»ç»“çš„ç²¾åï¼Œä½ ä¹Ÿåº”è¯¥éµå®ˆç›¸åº”çš„æŒ‡ç¤ºï¼Œç»“åˆè‡ªå·±çš„å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œè®¾å®šåˆé€‚çš„å‚æ•°æ¥åˆ›å»ºçº¿ç¨‹æ± </p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>æˆ‘ä»¬è¯´äº†è¿™ä¹ˆå¤šçº¿ç¨‹æ± çš„å¥½ï¼Œé‚£ä½¿ç”¨çº¿ç¨‹æ± æœ‰å“ªäº›ç¼ºç‚¹æˆ–é™åˆ¶å‘¢ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆä¸å»ºè®®æ‰€æœ‰ä¸šåŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Ÿæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</li><li>ç»™çº¿ç¨‹æ± è®¾ç½®æŒ‡å®šå‰ç¼€ï¼Œæœ‰å“ªäº›æ–¹å¼ï¼Ÿ</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>æ„Ÿè°¢å‰è¾ˆä»¬æ€»ç»“çš„ç²¾åï¼Œè‡ªå·±æ‰€å†™çš„å¹¶å‘ç³»åˆ—å¥½å¤šéƒ½å‚è€ƒäº†ä»¥ä¸‹èµ„æ–™</p><ul><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾</li><li>ç å‡ºé«˜æ•ˆ</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="http://ifeve.com/how-to-calculate-threadpool-size/" target="_blank" rel="noopener">ifeve</a></li><li>ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ¸…çˆ½çš„å®‰æ’æ—¥å¸¸ï¼Ÿ</title>
      <link href="//p/how-to-organize-your-day.html"/>
      <url>//p/how-to-organize-your-day.html</url>
      
        <content type="html"><![CDATA[<p>æœ‰æœ‹å‹ç§ä¿¡é—®æˆ‘å¦‚ä½•å®‰æ’æ—¥å¸¸ï¼Œä»¥åŠç›¸å¯¹é«˜æ•ˆçš„å†™ä¸œè¥¿ï¼Ÿæˆ‘è§‰å¾—æœ‰å¿…è¦å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« æ¥å’Œå¤§å®¶äº¤æµè¿™ä¸ªäº‹</p><h2 id="ä¸åšæ²¡æœ‰çµé­‚çš„-TODO-List"><a href="#ä¸åšæ²¡æœ‰çµé­‚çš„-TODO-List" class="headerlink" title="ä¸åšæ²¡æœ‰çµé­‚çš„ TODO List"></a>ä¸åšæ²¡æœ‰çµé­‚çš„ TODO List</h2><p>æˆ‘ä»¬éƒ½æ˜¯ä¸Šè¿›çš„å¥½é’å¹´ï¼Œå¤§å®¶æ‰‹é‡Œåº”è¯¥éƒ½æœ‰è‡ªå·±çš„ TODO listï¼Œæˆ‘é€šå¸¸ä¼šç”¨ <code>Microsoft To Do</code> è¿™æ¬¾è½¯ä»¶åšç®€å•çš„æ—¥å¸¸å®‰æ’</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200412095820.png" alt=""></p><p>æ±‚å­¦æœŸé—´ï¼Œæ¯ä¸ªå¯’æš‘å‡ä¸´è¿‘ï¼Œæˆ‘éƒ½å¯ä»¥æŠŠåšå„ç§ planï¼Œç«‹å„ç§ flag çš„æ°”è´¨æ‹¿æçš„æ­»æ­»çš„ã€‚å¦‚ä½ æ‰€æ–™ï¼Œå‡æœŸè¿‡åä¸€ä¸ª plan éƒ½æ²¡æœ‰åšï¼Œä¸€ä¸ª flag éƒ½æ²¡æœ‰å®Œæˆã€‚</p><p>è¿™ç§è¡¨é¢é£å…‰ï¼Œå®åˆ™æ²¡æœ‰äº†çµé­‚TODO list åªæ˜¯çŸ­æœŸå¿ƒç†æ…°è—‰ï¼Œå½“éœ€è¦éªŒè¯ç»“æœæ—¶ï¼Œæƒ…ç»ªè½»åˆ™ä½è½ä¸€ä¼šï¼Œé‡åˆ™ç„¦è™‘åŠå¤©</p><p>é€ æˆè¿™ç§é—®é¢˜çš„åŸå› å¾ˆç®€å•</p><ul><li>å¤§æ‚çƒ© TODO </li><li>æ²¡æœ‰è½»é‡ç¼“æ€¥</li><li>æ²¡æœ‰å¯ä»¥è½åœ°çš„æ‰§è¡Œè®¡åˆ’å’Œè‡ªæˆ‘çº¦æŸèƒ½åŠ›</li></ul><p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><h3 id="ç­›é€‰"><a href="#ç­›é€‰" class="headerlink" title="ç­›é€‰"></a>ç­›é€‰</h3><p>åšäº‹æˆ‘ä»¬çŸ¥é“ä¸‰æ€è€Œåè¡Œï¼Œåš plan å¥½åƒæ²¡æœ‰æˆæœ¬ä¸€æ ·ï¼Œæˆ‘å´å¿˜è®°äº†ä¸‰æ€è€Œåè¡Œçš„é“ç†ã€‚å¯¼è‡´ todo list åˆè‡­åˆé•¿çš„åŸå› å¤šæ•°å‡ºäºå†²åŠ¨æ€§æ€ç»´ï¼Œè¿™æ˜¯äººæ€§ï¼Œä½†æˆ‘ä¸æ‰“ç®—é€†äººæ€§è€Œä¸ºä¹‹ï¼Œæˆ‘é€‰æ‹©åœ¨åŸæœ‰åŸºç¡€ä¸Šï¼Œå†å¤šåšä¸¤ä¸ª todo listï¼ˆä½ æ²¡çœ‹é”™ï¼‰</p><ul><li><p>æ¸…å•Bï¼ˆAgile Backlogï¼‰ï¼šæ—¥å¸¸å¤©é©¬è¡Œç©ºçš„ï¼Œæ„æ·«çš„ï¼Œä¸´æ—¶æƒ³åˆ°çš„ï¼Œæˆ‘éƒ½ä¼šæ”¾åˆ°è¿™ä¸ªæ¸…å•é‡Œé¢ï¼Œæ»¡è¶³äº†æˆ‘è¿™ã€æ”¶è—ã€‘æ¢¦</p></li><li><p>æ¸…å•Gï¼ˆAgile Groomingï¼‰: åå¤æŸ¥çœ‹æ¸…å•Aï¼Œè‡ªæˆ‘åé—®ï¼ŒæŸä¸€é¡¹æ˜¯ä½ æƒ³è¦çš„å—ï¼Ÿæœ€ç»ˆåœ¨è¯¥æ¸…å•Gä¸­ç•™ä¸‹3åˆ°7ä¸ªé€‰é¡¹</p></li><li><p>æ¸…å•Sï¼ˆAgile Sprintï¼‰ï¼šçµé­‚æ‹·é—®è‡ªå·±ï¼Œåšå‡ºå–èˆï¼Œæœ€å¤šèƒ½ç•™ä¸‹ 1åˆ°3ä¸ª</p></li></ul><p>è¿™æ ·æˆ‘ä»¬åªéœ€åœ¨çŸ­æ—¶é—´å†…å…³æ³¨<code>æ¸…å•S</code>çš„å†…å®¹ï¼Œå½“æ¸…å•Sçš„å†…å®¹åšå®Œï¼Œé‡å¤è¿™ä¸ªç­›é€‰æ­¥éª¤å³å¯ã€‚æˆ‘çš„æ¬²æœ›æ¸…å•å¹¶æ²¡æœ‰åˆ å‡ï¼Œåªæ˜¯æ¢äº†ä¸ªè§†è§’ï¼Œæ„Ÿè§‰å®Œå…¨ä¸ä¸€æ ·äº†</p><h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><p>äº‹æœ‰ã€è½»é‡ç¼“æ€¥ã€‘ï¼Œè¿™å››ä¸ªå­—çš„æ’åˆ—ç»„åˆå°±æ˜¯ä½ ç†Ÿæ‚‰çš„è±¡é™å›¾äº†</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200411172634.png" alt=""></p><p>æ’åˆ—ä¼˜å…ˆçº§æ˜¯åŸºæœ¬æŠ€èƒ½ï¼Œæ³¨æ„è¿™ä¸ªå›¾æ˜¯è¦æŒç»­æ›´æ–°çš„ï¼Œè€Œä¸æ˜¯ä¸€æˆä¸å˜çš„</p><blockquote><p>Tips: ç”Ÿæ´»ä¸­æ€»ä¼šæœ‰å¾ˆå¤šæ’æ›²æ¥æ‰“æ–­æˆ‘ä»¬çš„è®¡åˆ’ï¼Œæ‰€ä»¥æˆ‘å¹¶ä¸ä¼šå°†æ—¶é—´æ’çš„å¾ˆæ»¡ï¼Œä¸€å®šè¦ç»™è‡ªå·±ç•™æœ‰ä¸€äº›bufferï¼Œè¿™æ ·ä¸è‡³äºè¢«å…¶ä»–äº‹æ‰“æ–­ï¼Œå¯¼è‡´åŸæœ‰äº‹æƒ…åšä¸å®Œè€Œå¸¦æ¥çš„æŒ«è´¥æ„Ÿï¼Œä½†ä¹Ÿä¸èƒ½ç•™å¤ªå¤šbufferï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æœ‰æ‹–å»¶ç—‡/æƒ°æ€§</p></blockquote><p>å¦å¤–ï¼Œç”Ÿæ´»ä¸­çš„å¤§å¤šæ•°äº‹æƒ…éƒ½å¤„åœ¨ç¬¬äºŒè±¡é™ã€é‡è¦ &amp; ä¸ç´§æ€¥ã€‘ï¼Œæ‰€ä»¥å¦‚ä½•åˆ†è§£ä»»åŠ¡ï¼Œåˆ¶å®šè®¡åˆ’ï¼Œå¹¶æŒ‰éƒ¨å°±ç­æ‰§è¡Œå°±æ˜¾å¾—å¾ˆé‡è¦äº†</p><h2 id="ä¸è¦å°†æ•´å—æ—¶é—´ç¢ç‰‡åŒ–"><a href="#ä¸è¦å°†æ•´å—æ—¶é—´ç¢ç‰‡åŒ–" class="headerlink" title="ä¸è¦å°†æ•´å—æ—¶é—´ç¢ç‰‡åŒ–"></a>ä¸è¦å°†æ•´å—æ—¶é—´ç¢ç‰‡åŒ–</h2><p>éƒ½çŸ¥é“æœ‰è¿ç»­æ€§çš„åšäº‹ä¼šæ¯”è¾ƒé«˜æ•ˆï¼Œè¿™å°±éœ€è¦æ•´å—çš„æ—¶é—´ï¼Œä½†å½“æˆ‘æœ‰æ•´å—æ—¶é—´æ—¶ï¼Œè²Œä¼¼å¹¶ä¸çæƒœè¿™ä¸ªç¦åˆ©ï¼Œä¸€ä¼šçœ‹æ‰‹æœºèŠå¤©ï¼Œä¸€ä¼šè¯»ä¹¦ï¼Œä¸€ä¼šçœ‹è§†é¢‘ã€‚æ„Ÿè§‰è‡ªå·±å¿™å¿™ç¢Œç¢Œï¼Œå®åˆ™ä»€ä¹ˆéƒ½æ²¡åšæˆï¼Œè¿‡åéœ€è¦éªŒè¯æˆæœæ—¶ï¼Œä¸€ç‰‡èŒ«ç„¶ï¼ŒåŸå› æ˜¯æˆ‘ä»¬å°†æ—¶é—´ç¢ç‰‡åŒ–äº†</p><p>æˆ‘ä»¬èƒ½ä¿æŒä¸“æ³¨çš„æ—¶é—´æœ‰é™ï¼Œè¿‡é•¿æ—¶é—´çš„çº¦æŸè‡ªå·±åè€Œæ˜¯é€†äººæ€§çš„è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦åœ¨ä¸“æ³¨å’Œæ”¾æ¾ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹</p><h3 id="ç•ªèŒ„å·¥ä½œæ³•"><a href="#ç•ªèŒ„å·¥ä½œæ³•" class="headerlink" title="ç•ªèŒ„å·¥ä½œæ³•"></a>ç•ªèŒ„å·¥ä½œæ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200411175606.png" alt=""></p><p>æŒ‰ç…§ç•ªèŒ„å·¥ä½œæ³•ï¼Œä¸€ä¸ªç•ªèŒ„é’Ÿæ˜¯25åˆ†é’Ÿï¼Œç•ªèŒ„é’Ÿé“ƒå“ï¼Œä¼‘æ¯3ï½5åˆ†é’Ÿï¼Œç»§ç»­ä¸‹ä¸€ä¸ªç•ªèŒ„é’Ÿã€‚ç•ªèŒ„é’Ÿå†…ç§‘å­¦çš„è®©æˆ‘ä¿æŒä¸“æ³¨ï¼›ä¼‘æ¯æ—¶é—´åˆè®©æˆ‘ç®€å•æŠŠç©æ‰‹æœºã€‚æ›´é‡è¦çš„æ˜¯å¯ä»¥å°†æ•´å—äº‹æƒ…æŒ‰ç…§ç•ªèŒ„é’Ÿè¿›è¡Œç»†åˆ†ï¼Œå½¢æˆå¯æ‰§è¡Œçš„è®¡åˆ’ï¼ˆChromeæµè§ˆå™¨å°±æœ‰ç›¸åº”çš„ç•ªèŒ„æ’ä»¶ï¼Œæ¯”å¦‚æˆ‘ç”¨çš„è¿™ä¸ªï¼‰<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-04-14_19-03-06.jpg" alt=""></p><h2 id="æœ€å¤§åŒ–åˆ©ç”¨ç¢ç‰‡åŒ–æ—¶é—´"><a href="#æœ€å¤§åŒ–åˆ©ç”¨ç¢ç‰‡åŒ–æ—¶é—´" class="headerlink" title="æœ€å¤§åŒ–åˆ©ç”¨ç¢ç‰‡åŒ–æ—¶é—´"></a>æœ€å¤§åŒ–åˆ©ç”¨ç¢ç‰‡åŒ–æ—¶é—´</h2><p>å¤§å®¶çš„ç¢ç‰‡åŒ–æ—¶é—´çœŸçš„éå¸¸å¤šï¼Œæ„Ÿè§‰å¯ä»¥ç©æ‰‹æœºçš„æ—¶é—´éƒ½æ˜¯æˆ‘ä»¬çš„ç¢ç‰‡åŒ–æ—¶é—´ï¼ˆä½ è„‘è¡¥ä¸€ä¸‹ä½ é€šå¸¸éƒ½åœ¨ä»€ä¹ˆæ—¶å€™ç©æ‰‹æœºï¼‰</p><p>è¿™ä¸ªæ—¶é—´æˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼Ÿ</p><ul><li>ç®€å•æ‹‰ä¼¸åŠ¨ä½œå’Œæ‰©å±•è¿åŠ¨</li><li>å›é¡¾è¿‡å»ä¸€ä¸¤å¤©çš„ç‚¹ç‚¹æ»´æ»´åšä¸ªå¤ç›˜æ€»ç»“ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°</li><li>å¹³æ—¶è®¢é˜…çš„é«˜è´¨é‡å…¬ä¼—å·é›†ä¸­é˜…è¯»ï¼ˆæ¯”å¦‚æ—¥æ‹±ä¸€å…µï¼Œè¿™ä¸ªå¹¿å‘Šæ‰“çš„è¿æˆ‘è‡ªå·±éƒ½çŒä¸åŠé˜²ï¼‰</li><li>ç»™å®¶äººæœ‹å‹ä¸€äº›é—®å€™</li><li>â€¦â€¦</li></ul><p>ä½ ä¼šå‘ç°ï¼Œç”Ÿæ´»ä¸­çš„ä¸€äº›ç»†ææœ«èŠ‚å°äº‹ï¼Œéƒ½å¯ä»¥é€šè¿‡ç¢ç‰‡åŒ–æ—¶é—´æ¥å®Œæˆï¼Œä¸ä¼šå¿™å¿™ç¢Œç¢Œ</p><h2 id="åˆ†æ¸…ä¸»æ¬¡"><a href="#åˆ†æ¸…ä¸»æ¬¡" class="headerlink" title="åˆ†æ¸…ä¸»æ¬¡"></a>åˆ†æ¸…ä¸»æ¬¡</h2><p>å¤§å®¶éƒ½æ˜¯æˆå¹´äººï¼Œç”Ÿæ´»ä¸­è‚¯å®šä¸æ­¢ä¸€ä¸¤ä»¶äº‹éœ€è¦ä½ ç…§é¡¾ã€‚å³ä¾¿åŒæ ·å¤šçš„äº‹ï¼Œæ¯ä¸ªäººç…§é¡¾çš„æ–¹å¼å’Œé¡ºåºä¸ä¸€æ ·ï¼Œå¾—åˆ°çš„ç»“æœå’Œæ„Ÿå—è‡ªç„¶ä¹Ÿå°±ä¸ä¸€æ ·ï¼Œä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æŠŠå¾ˆä¹…ä»¥å‰çœ‹è¿‡çš„ä¸€ä¸ªè§†é¢‘æ”¾åˆ°è¿™é‡Œã€å¦‚æœè§†é¢‘æ‰“ä¸å¼€ï¼Œå¯ä»¥ç‚¹å¼€æ‰“å¼€å¦‚ä½•æ¸…çˆ½çš„å®‰æ’æ—¥å¸¸ï¼Ÿ æŸ¥çœ‹ã€‘</p><p><a href="http://www.youtube.com/watch?v=R0C_uHXiH10" target="_blank" rel="noopener"><img src="http://img.youtube.com/vi/R0C_uHXiH10/0.jpg" alt=""></a></p><p>åƒè§†é¢‘ä¸­è¯´çš„ä¸€æ ·ï¼Œå¶å°”ç»™è‡ªå·±å‡ æ¯å•¤é…’ï¼ˆæˆ‘é…’ç²¾è¿‡æ•å°±ä¸å–äº†ï¼‰</p><h2 id="å¯»æ‰¾"><a href="#å¯»æ‰¾" class="headerlink" title="å¯»æ‰¾"></a>å¯»æ‰¾</h2><p>æˆ‘ä»¬éƒ½æ˜¯ç¨‹åºå‘˜ï¼Œæˆ‘å°±æ‹¿ç¨‹åºå·¥ä½œçš„äº‹æƒ…ä¸¾ä¾‹å­ï¼š</p><ul><li>ä½ å†™äº†æ— æ•°ä¸ªCRUDï¼Œå¸¦ç»™ä½ çš„æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ</li><li>ä½ åšäº†ç®€å•çš„è°ƒä¼˜ï¼Œæ€§èƒ½æå‡äº†å‡ ä¸ªç™¾åˆ†æ¯”ï¼Œå¸¦ç»™çš„æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ</li><li>ä½ é€šè¿‡åŠªåŠ›ï¼Œå…‹æœä¸€äº›å›°éš¾ï¼Œå®Œæˆä¸€äº›ä½ ä¹‹å‰çœ‹ä¼¼å¾ˆéš¾å¾—çš„é—®é¢˜ï¼Œå¸¦ç»™ä½ çš„æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ</li></ul><p>æˆ‘ä»¬æ— æ—¶æ— åˆ»ä¸éœ€è¦è‡ªèº«çš„æˆå°±æ„Ÿæ¥é©±åŠ¨è‡ªæˆ‘ï¼Œä¸‹é¢è¿™å¥è¯æ˜¯æˆ‘ç„¦è™‘çš„æ—¶å€™å‘ç»™æˆ‘çš„æœ‹å‹ä½³å…´å¤§ä½¬å¾—åˆ°çš„å›å¤ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200408195035.png" alt=""></p><hr><p>æœ€åï¼Œéƒ½è¯´æ‰§è¡Œå›°éš¾ï¼Œå¦‚æœä½ æ²¡æœ‰è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•ï¼Œè¯·æŒ‰ç…§ä¸Šé¢è¿™äº›æ–¹æ³•è¿›è¡Œé€æ­¥æ”¹å–„ï¼Œè‡ªç„¶ä¼šç»™ä½ å¸¦æ¥å¹¸ç¦æ„Ÿå’Œæˆå°±æ„Ÿï¼Œä¹Ÿå°±è‡ªç„¶ä¼šæ¨åŠ¨ä½ åšä¸‹ä¸€æ­¥æ‰§è¡Œ</p><p>æˆ‘ä¹Ÿåœ¨æ”¹å˜æ€ç»´å’Œæ–¹å¼çš„è·¯ä¸Šâ€¦ æˆ‘ä»¬ä¸€èµ· </p><p>æœ€åå¦‚æœä½ é€šè¿‡è¿™ä¸ªæ–¹æ³•æ”¹å˜äº†å¾ˆå¤šï¼Œä¸€å®šè¦è®°å¾—å›æ¥å‘Šè¯‰æˆ‘ï¼Œè¿™ä¼šç»™æˆ‘å¸¦æ¥å¾ˆå¤§æˆå°±æ„Ÿâ€‹</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é—®ï¼Œåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ</title>
      <link href="//p/how-many-threads-should-be-created.html"/>
      <url>//p/how-many-threads-should-be-created.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200406205924.png" alt=""></fancybox></p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</h2><blockquote><p>é˜²æ­¢å¹¶å‘ç¼–ç¨‹å‡ºé”™æœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸å†™å¹¶å‘ç¨‹åº</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img%E9%87%8D%E6%96%B0%E7%BB%84%E7%BB%87%E8%AF%AD%E8%A8%80.gif" alt=""></p><p>æ—¢ç„¶å¤šçº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å‡ºé”™ï¼Œä¸ºä»€ä¹ˆå®ƒè¿˜ç»ä¹…ä¸è¡°å‘¢ï¼Ÿ</p><p><strong>Aï¼šé‚£è¿˜ç”¨è¯´ï¼Œè‚¯å®šåœ¨æŸäº›æ–¹é¢æœ‰ç‰¹é•¿å‘—ï¼Œæ¯”å¦‚ä½ çŸ¥é“çš„ã€å®ƒå¾ˆå¿«ï¼Œéå¸¸å¿«ã€‘</strong></p><p>æˆ‘ä¹Ÿå¾ˆèµåŒè¿™ä¸ªç­”æ¡ˆï¼Œä½†è¯´çš„ä¸å¤Ÿå…·ä½“</p><h2 id="å¹¶å‘ç¼–ç¨‹é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ"><a href="#å¹¶å‘ç¼–ç¨‹é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ" class="headerlink" title="å¹¶å‘ç¼–ç¨‹é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ"></a>å¹¶å‘ç¼–ç¨‹é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ</h2><p>å¦‚æœé—®ä½ é€‰æ‹©å¤šçº¿ç¨‹çš„åŸå› å°±æ˜¯ä¸€ä¸ªã€å¿«ã€‘å­—ï¼Œé¢è¯•ä¹Ÿå°±ä¸ä¼šå‡ºé‚£ä¹ˆå¤šå¹ºè›¾å­äº†ã€‚ä½ æœ‰æ²¡æœ‰é—®è¿‡ä½ è‡ªå·±</p><ol><li>å¹¶å‘ç¼–ç¨‹åœ¨æ‰€æœ‰åœºæ™¯ä¸‹éƒ½æ˜¯å¿«çš„å—ï¼Ÿ </li><li>çŸ¥é“å®ƒå¾ˆå¿«ï¼Œä½•ä¸ºå¿«ï¼Ÿæ€æ ·åº¦é‡ï¼Ÿ</li></ol><p>æƒ³çŸ¥é“è¿™ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä»ã€å®šæ€§ã€‘åˆ°ã€å®šé‡ã€‘çš„åˆ†æè¿‡ç¨‹</p><blockquote><p>ä½¿ç”¨å¤šçº¿ç¨‹å°±æ˜¯åœ¨æ­£ç¡®çš„åœºæ™¯ä¸‹é€šè¿‡è®¾ç½®æ­£ç¡®ä¸ªæ•°çš„çº¿ç¨‹æ¥æœ€å¤§åŒ–ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼ˆæˆ‘æ„Ÿè§‰ä½ è¿˜æ˜¯å•¥ä¹Ÿæ²¡è¯´ï¼‰</p></blockquote><p>å°†è¿™å¥è¯ç¿»è¯‘åˆ°ç¡¬ä»¶çº§åˆ«å°±æ˜¯è¦å……åˆ†çš„åˆ©ç”¨ CPU å’Œ I/O çš„åˆ©ç”¨ç‡</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200329203812.png" alt=""></fancybox></p><p>ä¸¤ä¸ªæ­£ç¡®å¾—åˆ°ä¿è¯ï¼Œä¹Ÿå°±èƒ½è¾¾åˆ°æœ€å¤§åŒ–åˆ©ç”¨ CPU å’Œ I/Oçš„ç›®çš„äº†ã€‚æœ€å…³é”®æ˜¯ï¼Œå¦‚ä½•åšåˆ°ä¸¤ä¸ªã€æ­£ç¡®ã€‘ï¼Ÿ</p><p>åœ¨èŠå…·ä½“åœºæ™¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦æ‹¿å‡ºæˆ‘ä»¬çš„ä¸“ä¸šæ€§æ¥ã€‚é€ä½ ä¸¤ä¸ªåè¯ buff åŠ æˆ</p><ul><li>CPU å¯†é›†å‹ç¨‹åº</li><li>I/O å¯†é›†å‹ç¨‹åº</li></ul><h3 id="CPU-å¯†é›†å‹ç¨‹åº"><a href="#CPU-å¯†é›†å‹ç¨‹åº" class="headerlink" title="CPU å¯†é›†å‹ç¨‹åº"></a>CPU å¯†é›†å‹ç¨‹åº</h3><blockquote><p>ä¸€ä¸ªå®Œæ•´è¯·æ±‚ï¼ŒI/Oæ“ä½œå¯ä»¥åœ¨å¾ˆçŸ­æ—¶é—´å†…å®Œæˆï¼Œ CPUè¿˜æœ‰å¾ˆå¤šè¿ç®—è¦å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ CPU è®¡ç®—çš„æ¯”ä¾‹å å¾ˆå¤§ä¸€éƒ¨åˆ†</p></blockquote><p>å‡å¦‚æˆ‘ä»¬è¦è®¡ç®— 1+2+â€¦.100äº¿ çš„æ€»å’Œï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª CPU å¯†é›†å‹ç¨‹åº</p><p>åœ¨ã€å•æ ¸ã€‘CPUä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»º 4 ä¸ªçº¿ç¨‹æ¥åˆ†æ®µè®¡ç®—ï¼Œå³ï¼š</p><ol><li><p>çº¿ç¨‹1è®¡ç®— <code>[1,25äº¿ï¼‰</code></p></li><li><p>â€¦â€¦ ä»¥æ­¤ç±»æ¨</p></li><li><p>çº¿ç¨‹4è®¡ç®— <code>[75äº¿ï¼Œ100äº¿]</code></p></li></ol><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å›¾ä»–ä»¬ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200329213204.png" alt=""></fancybox></p><p>ç”±äºæ˜¯å•æ ¸ CPUï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚æŒ‰ç…§ç†æƒ³æƒ…å†µæ¥çœ‹ï¼Œå››ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´æ€»å’Œä¸ä¸€ä¸ªçº¿ç¨‹5ç‹¬è‡ªå®Œæˆæ˜¯ç›¸ç­‰çš„ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿˜å¿½ç•¥äº†å››ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</p><p><strong>æ‰€ä»¥ï¼Œå•æ ¸CPUå¤„ç†CPUå¯†é›†å‹ç¨‹åºï¼Œè¿™ç§æƒ…å†µå¹¶ä¸å¤ªé€‚åˆä½¿ç”¨å¤šçº¿ç¨‹</strong></p><p>æ­¤æ—¶å¦‚æœåœ¨ 4 æ ¸CPUä¸‹ï¼ŒåŒæ ·åˆ›å»ºå››ä¸ªçº¿ç¨‹æ¥åˆ†æ®µè®¡ç®—ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200329213337.png" alt=""></fancybox></p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ CPU æ¥è¿è¡Œï¼Œå¹¶ä¸ä¼šå‘ç”Ÿç­‰å¾… CPU æ—¶é—´ç‰‡çš„æƒ…å†µï¼Œä¹Ÿæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚ç†è®ºæƒ…å†µæ¥çœ‹æ•ˆç‡æå‡äº† 4 å€</p><p><strong>æ‰€ä»¥ï¼Œå¦‚æœæ˜¯å¤šæ ¸CPU å¤„ç† CPU å¯†é›†å‹ç¨‹åºï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æœ€å¤§åŒ–çš„åˆ©ç”¨ CPU æ ¸å¿ƒæ•°ï¼Œåº”ç”¨å¹¶å‘ç¼–ç¨‹æ¥æé«˜æ•ˆç‡</strong></p><h3 id="I-Oå¯†é›†å‹ç¨‹åº"><a href="#I-Oå¯†é›†å‹ç¨‹åº" class="headerlink" title="I/Oå¯†é›†å‹ç¨‹åº"></a>I/Oå¯†é›†å‹ç¨‹åº</h3><blockquote><p>ä¸ CPU å¯†é›†å‹ç¨‹åºç›¸å¯¹ï¼Œä¸€ä¸ªå®Œæ•´è¯·æ±‚ï¼ŒCPUè¿ç®—æ“ä½œå®Œæˆä¹‹åè¿˜æœ‰å¾ˆå¤š I/O æ“ä½œè¦åšï¼Œä¹Ÿå°±æ˜¯è¯´ I/O æ“ä½œå æ¯”å¾ˆå¤§éƒ¨åˆ†</p></blockquote><p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨è¿›è¡Œ I/O æ“ä½œæ—¶ï¼ŒCPUæ˜¯ç©ºé—²çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æœ€å¤§åŒ–çš„åˆ©ç”¨ CPUï¼Œä¸èƒ½è®©å…¶æ˜¯ç©ºé—²çŠ¶æ€</p><p>åŒæ ·åœ¨å•æ ¸ CPU çš„æƒ…å†µä¸‹ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200329214829.png" alt=""></fancybox></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº†ç›¸åŒé•¿åº¦çš„ CPU è€—æ—¶å’Œ I/O è€—æ—¶ï¼Œå¦‚æœä½ å°†ä¸Šé¢çš„å›¾å¤šç”»å‡ ä¸ªå‘¨æœŸï¼ŒCPUæ“ä½œè€—æ—¶å›ºå®šï¼Œå°† I/O æ“ä½œè€—æ—¶å˜ä¸º CPU è€—æ—¶çš„ 3 å€ï¼Œä½ ä¼šå‘ç°ï¼ŒCPUåˆæœ‰ç©ºé—²äº†ï¼Œè¿™æ—¶ä½ å°±å¯ä»¥æ–°å»ºçº¿ç¨‹ 4ï¼Œæ¥ç»§ç»­æœ€å¤§åŒ–çš„åˆ©ç”¨ CPUã€‚</p><p>ç»¼ä¸Šä¸¤ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥åšå‡ºè¿™æ ·çš„æ€»ç»“ï¼š</p><blockquote><p><strong>çº¿ç¨‹ç­‰å¾…æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œéœ€è¦è¶Šå¤šçº¿ç¨‹ï¼›çº¿ç¨‹CPUæ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œéœ€è¦è¶Šå°‘çº¿ç¨‹ã€‚</strong></p></blockquote><p>åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å·²ç»çŸ¥é“ç¬¬ä¸€ä¸ªã€æ­£ç¡®ã€‘ä½¿ç”¨å¤šçº¿ç¨‹çš„åœºæ™¯äº†ï¼Œé‚£åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿ</p><h2 id="åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ"><a href="#åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ" class="headerlink" title="åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ"></a>åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ</h2><p>é¢è¯•å¦‚æœé—®åˆ°è¿™ä¸ªé—®é¢˜ï¼Œè¿™å¯æ˜¯å¯¹ä½ ç†è®ºå’Œå®è·µçš„ç»Ÿè€ƒã€‚æƒ³å®Œå…¨ç­”å¯¹ï¼Œä½ å¿…é¡»è¦ã€ç²¾é€š/ç²¾é€š/ç²¾é€šã€‘<strong>å°å­¦ç®—æœ¯</strong></p><p>ä»ä¸Šé¢çŸ¥é“ï¼Œæˆ‘ä»¬æœ‰ CPU å¯†é›†å‹å’Œ I/O å¯†é›†å‹ä¸¤ä¸ªåœºæ™¯ï¼Œä¸åŒçš„åœºæ™¯å½“ç„¶éœ€è¦çš„çº¿ç¨‹æ•°ä¹Ÿå°±ä¸ä¸€æ ·äº†</p><h3 id="CPU-å¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ"><a href="#CPU-å¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ" class="headerlink" title="CPU å¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ"></a>CPU å¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ</h3><p>æœ‰äº›åŒå­¦æ—©å·²ç»å‘ç°ï¼Œå¯¹äº CPU å¯†é›†å‹æ¥è¯´ï¼Œç†è®ºä¸Š <code>çº¿ç¨‹æ•°é‡ = CPU æ ¸æ•°ï¼ˆé€»è¾‘ï¼‰</code> å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæ•°é‡ä¸€èˆ¬ä¼šè®¾ç½®ä¸º <code>CPU æ ¸æ•°ï¼ˆé€»è¾‘ï¼‰+ 1</code>ï¼Œ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹è¿™ä¹ˆè¯´ï¼š</p><blockquote><p>è®¡ç®—ï¼ˆCPUï¼‰å¯†é›†å‹çš„çº¿ç¨‹æ°å¥½åœ¨æŸæ—¶å› ä¸ºå‘ç”Ÿä¸€ä¸ªé¡µé”™è¯¯æˆ–è€…å› å…¶ä»–åŸå› è€Œæš‚åœï¼Œåˆšå¥½æœ‰ä¸€ä¸ªâ€œé¢å¤–â€çš„çº¿ç¨‹ï¼Œå¯ä»¥ç¡®ä¿åœ¨è¿™ç§æƒ…å†µä¸‹CPUå‘¨æœŸä¸ä¼šä¸­æ–­å·¥ä½œã€‚</p></blockquote><p>æ‰€ä»¥å¯¹äºCPUå¯†é›†å‹ç¨‹åºï¼Œ  <code>CPU æ ¸æ•°ï¼ˆé€»è¾‘ï¼‰+ 1</code> ä¸ªçº¿ç¨‹æ•°æ˜¯æ¯”è¾ƒå¥½çš„ç»éªŒå€¼çš„åŸå› äº†</p><h3 id="I-Oå¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ"><a href="#I-Oå¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ" class="headerlink" title="I/Oå¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ"></a>I/Oå¯†é›†å‹ç¨‹åºåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Ÿ</h3><p>ä¸Šé¢å·²ç»è®©å¤§å®¶æŒ‰ç…§å›¾å¤šç”»å‡ ä¸ªå‘¨æœŸï¼ˆä½ å¯ä»¥åŠ¨æ‰‹å°†I/Oè€—æ—¶ä¸CPUè€—æ—¶æ¯”ä¾‹è°ƒå¤§ï¼Œæ¯”å¦‚6å€æˆ–7å€ï¼‰ï¼Œè¿™æ ·ä½ å°±ä¼šå¾—åˆ°ä¸€ä¸ªç»“è®ºï¼Œå¯¹äº I/O å¯†é›†å‹ç¨‹åºï¼š</p><blockquote><p>æœ€ä½³çº¿ç¨‹æ•° =  <code>(1/CPUåˆ©ç”¨ç‡)</code> = <code>1 + (I/Oè€—æ—¶/CPUè€—æ—¶)</code></p></blockquote><p>æˆ‘è¿™ä¹ˆä½“è´´ï¼Œå½“ç„¶æ‹…å¿ƒæœ‰äº›åŒå­¦ä¸ç†è§£è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å°†ä¸Šå›¾çš„æ¯”ä¾‹æ‰‹åŠ¨å¸¦å…¥åˆ°ä¸Šé¢çš„å…¬å¼ä¸­ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200402220324.png" alt=""></fancybox></p><p>è¿™æ˜¯ä¸€ä¸ªCPUæ ¸å¿ƒçš„æœ€ä½³çº¿ç¨‹æ•°ï¼Œå¦‚æœå¤šä¸ªæ ¸å¿ƒï¼Œé‚£ä¹ˆ I/O å¯†é›†å‹ç¨‹åºçš„æœ€ä½³çº¿ç¨‹æ•°å°±æ˜¯ï¼š</p><blockquote><p>æœ€ä½³çº¿ç¨‹æ•° = <code>CPUæ ¸å¿ƒæ•°</code> *  <code>(1/CPUåˆ©ç”¨ç‡)</code> =  <code>CPUæ ¸å¿ƒæ•°</code> * <code>ï¼ˆ1 + ï¼ˆI/Oè€—æ—¶/CPUè€—æ—¶)ï¼‰</code></p></blockquote><p>è¯´åˆ°è¿™ï¼Œæœ‰äº›åŒå­¦å¯èƒ½æœ‰ç–‘é—®äº†ï¼Œè¦è®¡ç®— I/O å¯†é›†å‹ç¨‹åºï¼Œæ˜¯è¦çŸ¥é“ CPU åˆ©ç”¨ç‡çš„ï¼Œå¦‚æœæˆ‘ä¸çŸ¥é“è¿™äº›ï¼Œé‚£è¦æ€æ ·ç»™å‡ºä¸€ä¸ªåˆå§‹å€¼å‘¢ï¼Ÿ</p><p>æŒ‰ç…§ä¸Šé¢å…¬å¼ï¼Œå‡å¦‚å‡ ä¹å…¨æ˜¯ I/Oè€—æ—¶ï¼Œæ‰€ä»¥çº¯ç†è®ºä½ å°±å¯ä»¥è¯´æ˜¯ <strong>2Nï¼ˆN=CPUæ ¸æ•°ï¼‰ï¼Œå½“ç„¶ä¹Ÿæœ‰è¯´ 2N + 1çš„</strong>ï¼Œï¼ˆæˆ‘çŒœè¿™ä¸ª 1 ä¹Ÿæ˜¯ backupï¼‰ï¼Œæ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„æ¨å€’è¿‡ç¨‹ï¼Œåœ¨ã€å¹¶å‘ç¼–ç¨‹å®æˆ˜-8.2ç« èŠ‚ã€‘æˆªå›¾åœ¨æ­¤ï¼Œå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±çœ‹çœ‹</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200401185053.png" alt=""></fancybox></p><p><strong>ç†è®ºä¸Šæ¥è¯´ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œç†è®ºä¸Šæ¥è¯´</strong>ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ° CPU 100% çš„åˆ©ç”¨ç‡</p><p>å¦‚æœç†è®ºéƒ½å¥½ç”¨ï¼Œé‚£å°±ç”¨ä¸ç€å®è·µäº†ï¼Œä¹Ÿå°±æ›´ä¸ä¼šæœ‰è°ƒä¼˜çš„äº‹å‡ºç°äº†ã€‚<strong>ä¸è¿‡åœ¨åˆå§‹é˜¶æ®µï¼Œæˆ‘ä»¬ç¡®å®å¯ä»¥æŒ‰ç…§è¿™ä¸ªç†è®ºä¹‹ä½œä¸ºä¼ªæ ‡å‡†ï¼Œ æ¯•ç«Ÿå·®ä¹Ÿå¯èƒ½ä¸ä¼šå·®å¤ªå¤šï¼Œè¿™æ ·è°ƒä¼˜ä¹Ÿä¼šæ›´å¥½ä¸€äº›</strong></p><p>è°ˆå®Œç†è®ºï¼Œå’±ä»¬è¯´ç‚¹å®é™…çš„ï¼Œå…¬å¼æˆ‘çœ‹æ‡‚äº†ï¼ˆå®šæ€§é˜¶æ®µç»“æŸï¼‰ï¼Œä½†æ˜¯æˆ‘æœ‰ä¸¤ä¸ªç–‘é—®ï¼š</p><ol><li>æˆ‘æ€ä¹ˆçŸ¥é“å…·ä½“çš„ I/Oè€—æ—¶å’ŒCPUè€—æ—¶å‘¢ï¼Ÿ</li><li>æ€ä¹ˆæŸ¥çœ‹CPUåˆ©ç”¨ç‡ï¼Ÿ</li></ol><p>æ²¡é”™ï¼Œæˆ‘ä»¬éœ€è¦å®šé‡åˆ†æäº†</p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªåƒèƒèŸ¹çš„ä»”å„¿ï¼Œå…¶å®æœ‰å¾ˆå¤š APM ï¼ˆApplication Performance Managerï¼‰å·¥å…·å¯ä»¥å¸®æˆ‘ä»¬å¾—åˆ°å‡†ç¡®çš„æ•°æ®ï¼Œå­¦ä¼šä½¿ç”¨è¿™ç±»å·¥å…·ï¼Œä¹Ÿå°±å¯ä»¥ç»“åˆç†è®ºï¼Œåœ¨è°ƒä¼˜çš„è¿‡ç¨‹å¾—åˆ°æ›´ä¼˜çš„çº¿ç¨‹ä¸ªæ•°äº†ã€‚æˆ‘è¿™é‡Œç®€å•åˆ—ä¸¾å‡ ä¸ªï¼Œå…·ä½“ä½¿ç”¨å“ªä¸€ä¸ªï¼Œå…·ä½“åº”ç”¨è¿˜éœ€è¦ä½ è‡ªå·±å»è°ƒç ”é€‰æ‹©ï¼Œå—ç¯‡å¹…é™åˆ¶ï¼Œæš‚ä¸å±•å¼€è®¨è®ºäº†</p><ol><li>SkyWalking</li><li>CAT</li><li>zipkin</li></ol><p>ä¸Šé¢äº†è§£äº†åŸºæœ¬çš„ç†è®ºçŸ¥è¯†ï¼Œé‚£é¢è¯•æœ‰å¯èƒ½é—®ä»€ä¹ˆï¼Ÿåˆå¯èƒ½ä¼šä»¥æ€æ ·çš„æ–¹å¼æé—®å‘¢ï¼Ÿ </p><h2 id="é¢è¯•å°é—®"><a href="#é¢è¯•å°é—®" class="headerlink" title="é¢è¯•å°é—®"></a>é¢è¯•å°é—®</h2><h3 id="å°é—®ä¸€"><a href="#å°é—®ä¸€" class="headerlink" title="å°é—®ä¸€"></a>å°é—®ä¸€</h3><blockquote><p>å‡è®¾è¦æ±‚ä¸€ä¸ªç³»ç»Ÿçš„ TPSï¼ˆTransaction Per Second æˆ–è€… Task Per Secondï¼‰è‡³å°‘ä¸º20ï¼Œç„¶åå‡è®¾æ¯ä¸ªTransactionç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆï¼Œç»§ç»­å‡è®¾å¹³å‡æ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªTransactionçš„æ—¶é—´ä¸º4s</p></blockquote><p><strong>å¦‚ä½•è®¾è®¡çº¿ç¨‹ä¸ªæ•°ï¼Œä½¿å¾—å¯ä»¥åœ¨1så†…å¤„ç†å®Œ20ä¸ªTransactionï¼Ÿ</strong></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200402222407.png" alt=""></fancybox></p><p>ä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰è€ƒè™‘åˆ°CPUæ•°ç›®ã€‚å®¶é‡Œåˆæ²¡çŸ¿ï¼Œä¸€èˆ¬æœåŠ¡å™¨çš„CPUæ ¸æ•°ä¸º16æˆ–è€…32ï¼Œå¦‚æœæœ‰80ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆè‚¯å®šä¼šå¸¦æ¥å¤ªå¤šä¸å¿…è¦çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼ˆå¸Œæœ›è¿™å¥è¯ä½ å¯ä»¥ä¸»åŠ¨è¯´å‡ºæ¥ï¼‰ï¼Œè¿™å°±éœ€è¦è°ƒä¼˜äº†ï¼Œæ¥åšåˆ°æœ€ä½³ balance</p><h3 id="å°é—®äºŒ"><a href="#å°é—®äºŒ" class="headerlink" title="å°é—®äºŒ"></a>å°é—®äºŒ</h3><blockquote><p>è®¡ç®—æ“ä½œéœ€è¦5msï¼ŒDBæ“ä½œéœ€è¦ 100msï¼Œå¯¹äºä¸€å° 8ä¸ªCPUçš„æœåŠ¡å™¨ï¼Œæ€ä¹ˆè®¾ç½®çº¿ç¨‹æ•°å‘¢ï¼Ÿ</p></blockquote><p>å¦‚æœä¸çŸ¥é“è¯·æ‹¿ä¸‰å¹´çº§æœŸæœ«è€ƒè¯•é¢˜é‡æ–°åšï¼ˆä»Šå¤©æ™šè‡ªä¹ ç•™ä¸‹æ¥ï¼‰ï¼Œç­”æ¡ˆæ˜¯ï¼š</p><p><strong>çº¿ç¨‹æ•° = 8 * (1 + 100/5) = 168 (ä¸ª)</strong></p><blockquote><p>é‚£å¦‚æœDBçš„ QPSï¼ˆQuery Per Secondï¼‰ä¸Šé™æ˜¯1000ï¼Œæ­¤æ—¶è¿™ä¸ªçº¿ç¨‹æ•°åˆè¯¥è®¾ç½®ä¸ºå¤šå¤§å‘¢ï¼Ÿ</p></blockquote><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200408165804.png" alt=""></fancybox></p><p>åŒæ ·ï¼Œè¿™æ˜¯æ²¡æœ‰è€ƒè™‘ CPU æ•°ç›®ï¼Œæ¥ä¸‹æ¥å°±åˆæ˜¯ç»†èŠ‚è°ƒä¼˜çš„é˜¶æ®µäº†</p><p>å› ä¸ºä¸€æ¬¡è¯·æ±‚ä¸ä»…ä»…åŒ…æ‹¬ CPU å’Œ I/Oæ“ä½œï¼Œå…·ä½“çš„è°ƒä¼˜è¿‡ç¨‹è¿˜è¦è€ƒè™‘å†…å­˜èµ„æºï¼Œç½‘ç»œç­‰å…·ä½“å†…å®¹</p><h2 id="å¢åŠ -CPU-æ ¸æ•°ä¸€å®šèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ"><a href="#å¢åŠ -CPU-æ ¸æ•°ä¸€å®šèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ" class="headerlink" title="å¢åŠ  CPU æ ¸æ•°ä¸€å®šèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ"></a>å¢åŠ  CPU æ ¸æ•°ä¸€å®šèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ</h2><p>çœ‹åˆ°è¿™ï¼Œæœ‰äº›åŒå­¦å¯èƒ½ä¼šè®¤ä¸ºï¼Œå³ä¾¿æˆ‘ç®—å‡ºäº†ç†è®ºçº¿ç¨‹æ•°ï¼Œä½†å®é™…CPUæ ¸æ•°ä¸å¤Ÿï¼Œä¼šå¸¦æ¥çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°±éœ€è¦å¢åŠ  CPU æ ¸æ•°ï¼Œé‚£æˆ‘ä»¬ç›²ç›®çš„å¢åŠ  CPU æ ¸æ•°å°±ä¸€å®šèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ</p><p>åœ¨è®²äº’æ–¥é”çš„å†…å®¹æ˜¯ï¼Œæˆ‘æ•…æ„é—ç•™äº†ä¸€ä¸ªçŸ¥è¯†:</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200406195447.png" alt=""></fancybox></p><p>æ€ä¹ˆç†è§£è¿™ä¸ªå…¬å¼å‘¢ï¼Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200406195849.png" alt=""></fancybox></p><p>è¿™ä¸ªç»“è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œå‡å¦‚æˆ‘ä»¬çš„ä¸²è¡Œç‡æ˜¯ 5%ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ— è®ºé‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯ï¼Œæœ€é«˜ä¹Ÿå°±åªèƒ½æé«˜ 20 å€çš„æ€§èƒ½ã€‚</p><p>å¦‚ä½•ç®€å•ç²—æš´çš„ç†è§£ä¸²è¡Œç™¾åˆ†æ¯”ï¼ˆå…¶å®éƒ½å¯ä»¥é€šè¿‡å·¥å…·å¾—å‡ºè¿™ä¸ªç»“æœçš„ï¼‰å‘¢ï¼Ÿæ¥çœ‹ä¸ªå° Tipsï¼š</p><blockquote><p><strong>Tips:</strong> ä¸´ç•ŒåŒºéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œéä¸´ç•ŒåŒºéƒ½æ˜¯å¹¶è¡Œçš„ï¼Œç”¨å•çº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºçš„æ—¶é—´/ç”¨å•çº¿ç¨‹æ‰§è¡Œ(ä¸´ç•ŒåŒº+éä¸´ç•ŒåŒº)çš„æ—¶é—´å°±æ˜¯ä¸²è¡Œç™¾åˆ†æ¯”</p></blockquote><p>ç°åœ¨ä½ åº”è¯¥ç†è§£æˆ‘åœ¨è®²è§£ synchronized å…³é”®å­—æ—¶æ‰€è¯´çš„ï¼š</p><blockquote><p>æœ€å°åŒ–ä¸´ç•ŒåŒºèŒƒå›´ï¼Œå› ä¸ºä¸´ç•ŒåŒºçš„å¤§å°å¾€å¾€å°±æ˜¯ç“¶é¢ˆé—®é¢˜çš„æ‰€åœ¨ï¼Œä¸è¦åƒä¹±ç”¨try catché‚£æ ·ä¸€é”…ç«¯</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¤šçº¿ç¨‹ä¸ä¸€å®šå°±æ¯”å•çº¿ç¨‹é«˜æ•ˆï¼Œæ¯”å¦‚å¤§åé¼é¼çš„ Redis ï¼ˆåé¢ä¼šåˆ†æï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºå†…å­˜æ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå•çº¿ç¨‹å¯ä»¥å¾ˆé«˜æ•ˆçš„åˆ©ç”¨CPUã€‚è€Œå¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ—¶å­˜åœ¨ç›¸å½“æ¯”ä¾‹çš„I/Oæˆ–ç½‘ç»œæ“ä½œ</p><p>å¦å¤–ï¼Œç»“åˆå°å­¦æ•°å­¦é¢˜ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä»å®šæ€§åˆ°å®šé‡çš„åˆ†æçš„è¿‡ç¨‹ï¼Œåœ¨å¼€å§‹æ²¡æœ‰ä»»ä½•æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ç»éªŒå€¼ä½œä¸ºä¸€ä¸ªä¼ªæ ‡å‡†ï¼Œå…¶æ¬¡å°±æ˜¯ç»“åˆå®é™…æ¥é€æ­¥çš„è°ƒä¼˜ï¼ˆç»¼åˆ CPUï¼Œå†…å­˜ï¼Œç¡¬ç›˜è¯»å†™é€Ÿåº¦ï¼Œç½‘ç»œçŠ¶å†µç­‰ï¼‰äº†</p><p>æœ€åï¼Œç›²ç›®çš„å¢åŠ  CPU æ ¸æ•°ä¹Ÿä¸ä¸€å®šèƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬ä¸¥æ ¼çš„ç¼–å†™å¹¶å‘ç¨‹åºä»£ç äº†</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>æˆ‘ä»¬å·²ç»çŸ¥é“åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æä¸€ä¸ªçº¿ç¨‹æ± å‡ºæ¥ï¼Ÿ</li><li>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹éƒ½è¦åšå“ªäº›äº‹æƒ…ï¼Ÿä¸ºä»€ä¹ˆè¯´é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹å¼€é”€å¾ˆå¤§ï¼Ÿ</li><li>å¤šçº¿ç¨‹é€šå¸¸è¦æ³¨æ„å…±äº«å˜é‡é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡å°±æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜å‘¢ï¼Ÿ</li><li>â€¦â€¦</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>æ„Ÿè°¢å‰è¾ˆä»¬æ€»ç»“çš„ç²¾åï¼Œè‡ªå·±æ‰€å†™çš„å¹¶å‘ç³»åˆ—å¥½å¤šéƒ½å‚è€ƒäº†ä»¥ä¸‹èµ„æ–™</p><ul><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾</li><li>ç å‡ºé«˜æ•ˆ</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="http://ifeve.com/how-to-calculate-threadpool-size/" target="_blank" rel="noopener">ifeve</a></li></ul><hr><p>ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ¥è¯´è¯´ï¼Œä½ ç†Ÿæ‚‰åˆé™Œç”Ÿçš„çº¿ç¨‹æ± é—®é¢˜</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸè¿™æ ·ç†è§£æŒºç®€å•çš„</title>
      <link href="//p/java-thread-life-cycle.html"/>
      <url>//p/java-thread-life-cycle.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200325143022.png" alt=""></fancybox></p><h2 id="ä¸ºä»€ä¹ˆè¦äº†è§£çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦äº†è§£çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦äº†è§£çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦äº†è§£çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</h2><p>ä¹‹å‰å†™è¿‡ Spring Bean ç”Ÿå‘½å‘¨æœŸä¸‰éƒ¨æ›²ï¼š</p><ol><li><a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Beanç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a></li><li><a href="https://dayarch.top/p/spring-bean-lifecycle-destroy.html">Spring Beanç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜å°½</a></li><li><a href="https://dayarch.top/p/spring-aware.html">Spring Aware åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</a></li></ol><p>æœ‰æœ‹å‹ç•™è¨€è¯´ï¼šâ€œäº†è§£äº†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸåï¼Œä½¿ç”¨ Spring Bean å¥½æ¯”çœ‹åˆ°å®ƒä»¬çš„è¡ŒåŠ¨è½¨è¿¹ï¼Œç°åœ¨ä½¿ç”¨å°±ä¸€ç‚¹éƒ½ä¸æ…Œäº†â€ã€‚æˆ‘å’Œä»–ä¸€æ ·ï¼Œäº†è§£äº‹ç‰©çš„ç”Ÿå‘½å‘¨æœŸç›®çš„å¾ˆç®€å•ï¼Œå”¯ã€ä¸æ…Œã€‘ä¹Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img%E4%B8%8D%E6%85%8C.gif" alt=""></fancybox></p><p><a href="https://dayarch.top/categories/Coding/Java-Concurrency/">Java å¹¶å‘ç³»åˆ—</a> å·²ç»å†™äº†å¾ˆå¤šï¼Œä»æ¥è¿˜æ²¡æèµ·è¿‡é‚£ä¸ªå®ƒã€Javaçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸã€‘ã€‚æœ‰äº†å‰åºç†è®ºå›¾æ–‡çš„é“ºå«ï¼Œåœ¨èµ°è¿›æºç ä¸–ç•Œä¹‹å‰ï¼Œè°ˆè®ºå®ƒçš„æ—¶æœºæ°å¥½åˆ°äº†ã€‚å› ä¸ºï¼Œç¼–å†™å¹¶å‘ç¨‹åºçš„æ ¸å¿ƒä¹‹ä¸€å°±æ˜¯æ­£ç¡®çš„æ‘†å¼„çº¿ç¨‹çŠ¶æ€</p><h2 id="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å‡ ç§çŠ¶æ€"><a href="#çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å‡ ç§çŠ¶æ€" class="headerlink" title="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å‡ ç§çŠ¶æ€"></a>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å‡ ç§çŠ¶æ€</h2><p>åˆšæ¥è§¦çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œæˆ‘æ€»æ˜¯è®°ä¸ä½ï¼Œä¹Ÿç†è§£ä¸äº†ä»–ä»¬çš„çŠ¶æ€ï¼Œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒæ··ä¹±ï¼Œæ›´åˆ«è¯´å®ƒä»¬ä¹‹é—´æ˜¯å¦‚ä½•è¿›è¡ŒçŠ¶æ€è½¬æ¢çš„äº†ã€‚åŸå› æ˜¯æˆ‘æŠŠ<code>æ“ä½œç³»ç»Ÿé€šç”¨çº¿ç¨‹çŠ¶æ€</code>å’Œ<code>ç¼–ç¨‹è¯­è¨€å°è£…åçš„çº¿ç¨‹çŠ¶æ€</code> æ¦‚å¿µæ··æ·†åœ¨ä¸€èµ·äº†</p><h3 id="æ“ä½œç³»ç»Ÿé€šç”¨çº¿ç¨‹çŠ¶æ€"><a href="#æ“ä½œç³»ç»Ÿé€šç”¨çº¿ç¨‹çŠ¶æ€" class="headerlink" title="æ“ä½œç³»ç»Ÿé€šç”¨çº¿ç¨‹çŠ¶æ€"></a>æ“ä½œç³»ç»Ÿé€šç”¨çº¿ç¨‹çŠ¶æ€</h3><p>ä¸ªäººè§‰å¾—é€šç”¨çº¿ç¨‹çŠ¶æ€æ›´ç¬¦åˆæˆ‘ä»¬çš„æ€è€ƒä¹ æƒ¯ã€‚å…¶çŠ¶æ€æ€»å…±æœ‰ 5 ç§ ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å¯¹äºç»å¸¸å†™å¹¶å‘ç¨‹åºçš„åŒå­¦æ¥è¯´ï¼Œå…¶å˜´é‡Œç»å¸¸å¿µçš„éƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„è¿™äº›é€šç”¨çº¿ç¨‹çŠ¶æ€ï¼Œä¸”çœ‹</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200322162836.png" alt=""></fancybox></p><p>é™¤å»ç”Ÿã€åˆå§‹çŠ¶æ€ã€‘æ­»ã€ç»ˆæ­¢çŠ¶æ€ã€‘ï¼Œå…¶å®åªæ˜¯ä¸‰ç§çŠ¶æ€çš„å„ç§è½¬æ¢ï¼Œå¬åˆ°è¿™å¥è¯æ˜¯ä¸æ˜¯å¿ƒæƒ…æ”¾æ¾äº†å¾ˆå¤šå‘¢ï¼Ÿ</p><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜<code>é€šç”¨çº¿ç¨‹çŠ¶æ€</code>å’Œ <code>Java è¯­è¨€ä¸­çš„çº¿ç¨‹çŠ¶æ€</code>ï¼Œè¿™é‡Œè¿˜æ˜¯å…ˆå¯¹å‰è€…è¿›è¡Œç®€çŸ­çš„è¯´æ˜ </p><blockquote><p>åˆå§‹çŠ¶æ€</p></blockquote><p>çº¿ç¨‹å·²è¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜ä¸è¢«å…è®¸åˆ†é…CPUæ‰§è¡Œã€‚<strong>æ³¨æ„ï¼Œè¿™ä¸ªè¢«åˆ›å»ºå…¶å®æ˜¯å±äºç¼–ç¨‹è¯­è¨€å±‚é¢çš„ï¼Œå®é™…åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼ŒçœŸæ­£çš„çº¿ç¨‹è¿˜æ²¡è¢«åˆ›å»º</strong>ï¼Œ æ¯”å¦‚ Java è¯­è¨€ä¸­çš„ new Thread()ã€‚</p><blockquote><p>å¯è¿è¡ŒçŠ¶æ€</p></blockquote><p>çº¿ç¨‹å¯ä»¥åˆ†é…CPUæ‰§è¡Œï¼Œ<strong>è¿™æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹å·²ç»è¢«åˆ›å»ºæˆåŠŸäº†</strong></p><blockquote><p>è¿è¡ŒçŠ¶æ€</p></blockquote><p>æ“ä½œç³»ç»Ÿä¼šä¸º<code>å¤„åœ¨å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹</code>åˆ†é…CPUæ—¶é—´ç‰‡ï¼Œè¢« CPU ä¸´å¹¸åï¼Œå¤„åœ¨å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹å°±ä¼šå˜ä¸ºè¿è¡ŒçŠ¶æ€</p><blockquote><p>ä¼‘çœ çŠ¶æ€</p></blockquote><p>å¦‚æœå¤„åœ¨è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨<code>æŸä¸ªé˜»å¡çš„API</code>æˆ–<code>ç­‰å¾…æŸä¸ªäº‹ä»¶æ¡ä»¶å¯ç”¨</code>ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±ä¼šè½¬æ¢åˆ°ä¼‘çœ çŠ¶æ€ï¼Œ<strong>æ³¨æ„ï¼šæ­¤æ—¶çº¿ç¨‹ä¼šé‡Šæ”¾CPUä½¿ç”¨æƒï¼Œä¼‘çœ çš„çº¿ç¨‹æ°¸è¿œæ²¡æœ‰æœºä¼šè·å¾—CPUä½¿ç”¨æƒï¼Œåªæœ‰å½“ç­‰å¾…äº‹ä»¶å‡ºç°åï¼Œçº¿ç¨‹ä¼šä»ä¼‘çœ çŠ¶æ€è½¬æ¢åˆ°å¯è¿è¡ŒçŠ¶æ€</strong></p><blockquote><p>ç»ˆæ­¢çŠ¶æ€</p></blockquote><p><code>çº¿ç¨‹æ‰§è¡Œå®Œ</code>æˆ–è€…<code>å‡ºç°å¼‚å¸¸</code> (è¢«interrupté‚£ç§ä¸ç®—çš„å“ˆï¼Œåç»­ä¼šè¯´)å°±ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼Œæ­£å¼èµ°åˆ°ç”Ÿå‘½çš„å°½å¤´ï¼Œæ²¡æœ‰èµ·æ­»å›ç”Ÿçš„æœºä¼š</p><p>æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹ä½ ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Œé¢è¯•åˆç»å¸¸è¢«é—®åˆ°çš„Java çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå§</p><h3 id="Javaè¯­è¨€çº¿ç¨‹çŠ¶æ€"><a href="#Javaè¯­è¨€çº¿ç¨‹çŠ¶æ€" class="headerlink" title="Javaè¯­è¨€çº¿ç¨‹çŠ¶æ€"></a>Javaè¯­è¨€çº¿ç¨‹çŠ¶æ€</h3><p>åœ¨ Thread çš„æºç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±» Stateï¼Œé‡Œé¢æ¸…æ™°æ˜äº†çš„å†™äº†Javaè¯­è¨€ä¸­çº¿ç¨‹çš„6ç§çŠ¶æ€ï¼š</p><ol><li>NEW</li><li>RUNNABLE</li><li>BLOCKED</li><li>WAITING</li><li>TIMED_WAITING</li><li>TERMINATED</li></ol><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-03-22_16-01-54.jpg" alt=""></fancybox></p><p>è¿™é‡Œè¦åšä¸€ä¸ªå°è°ƒæŸ¥äº†ï¼Œä½ æœ‰æŸ¥çœ‹è¿‡è¿™ä¸ªç±»å’Œè¯»è¿‡å…¶æ³¨é‡Šè¯´æ˜å—ï¼Ÿï¼ˆæ¬¢è¿ç•™è¨€è„šå°å“¦ï¼‰</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200325112648.png" alt=""></fancybox></p><p>è€³è¾¹å“èµ·äº”ç¯ä¹‹æ­Œï¼ŒJavaä¸­çº¿ç¨‹çŠ¶æ€ç«Ÿç„¶æ¯”é€šç”¨çº¿ç¨‹çŠ¶æ€çš„ 5 ç§å¤š1ç§ï¼Œå˜æˆäº† 6 ç§ã€‚è¿™ä¸ªçœ‹ä¼¼å¤æ‚ï¼Œå…¶å®å¹¶ä¸æ˜¯ä½ æƒ³çš„é‚£æ ·ï¼ŒJavaåœ¨é€šç”¨çº¿ç¨‹çŠ¶æ€çš„åŸºç¡€ä¸Šï¼Œæœ‰è£å‰ªï¼Œä¹Ÿæœ‰ä¸°å¯Œï¼Œæ•´ä½“æ¥è¯´æ˜¯å°‘ä¸€ç§ã€‚å†æ¥çœ‹ä¸ªå›¾ï¼Œæ³¨æ„é¢œè‰²åŒºåˆ†å“¦</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage-20200322163335824.png" alt=""></fancybox></p><p>Java è¯­è¨€ä¸­</p><ul><li>å°†é€šç”¨çº¿ç¨‹çŠ¶æ€çš„<code>å¯è¿è¡ŒçŠ¶æ€</code>å’Œ<code>è¿è¡ŒçŠ¶æ€</code>åˆå¹¶ä¸º <code>Runnable</code>ï¼Œ</li><li>å°†<code>ä¼‘çœ çŠ¶æ€</code>ç»†åˆ†ä¸ºä¸‰ç§ (<code>BLOCKED</code>/<code>WAITING</code>/<code>TIMED_WAITING</code>); åè¿‡æ¥ç†è§£è¿™å¥è¯ï¼Œå°±æ˜¯è¿™ä¸‰ç§çŠ¶æ€åœ¨æ“ä½œç³»ç»Ÿçš„çœ¼ä¸­éƒ½æ˜¯ä¼‘çœ çŠ¶æ€ï¼ŒåŒæ ·<strong>ä¸ä¼šè·å¾—CPUä½¿ç”¨æƒ</strong></li></ul><p>çœ‹ä¸Šå›¾å³ä¾§ã€Javaè¯­è¨€ä¸­çš„çº¿ç¨‹çŠ¶æ€ã€‘ï¼Œè¿›ä¸€æ­¥ç®€æ´çš„è¯´ï¼Œé™¤å»çº¿ç¨‹ç”Ÿæ­»ï¼Œæˆ‘ä»¬åªè¦ç©è½¬ <code>RUNNABLE</code> å’Œ<code>ä¼‘çœ çŠ¶æ€</code>çš„è½¬æ¢å°±å¯ä»¥äº†ï¼Œç¼–å†™å¹¶å‘ç¨‹åºä¹Ÿå¤šæ•°æ˜¯è¿™ä¸¤ç§çŠ¶æ€çš„è½¬æ¢ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦äº†è§£ï¼Œæœ‰å“ªäº›æ—¶æœºï¼Œä¼šè§¦å‘è¿™äº›çŠ¶æ€è½¬æ¢</p><p>è¿œçœ‹çœ‹è½®å»“ï¼Œ è¿‘çœ‹çœ‹ç»†èŠ‚ã€‚æˆ‘ä»¬å°†ä¸Šé¢Javaè¯­è¨€ä¸­çš„å›¾è¿›è¡Œç»†åŒ–ï¼Œå°†è§¦å‘çš„èŠ‚ç‚¹æ”¾åˆ°å›¾ä¸­ (è¿™çœ‹ä¼¼å¤æ‚çš„å›¾ï¼Œå…¶å®ä¸‰å¥è¯å°±èƒ½åˆ†è§£çš„ï¼Œæ‰€ä»¥åˆ«æ…Œ)ï¼Œä¸”çœ‹ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgstateoverview.png" alt=""></fancybox></p><h4 id="RUNNABLEä¸BLOCKEDçŠ¶æ€è½¬æ¢"><a href="#RUNNABLEä¸BLOCKEDçŠ¶æ€è½¬æ¢" class="headerlink" title="RUNNABLEä¸BLOCKEDçŠ¶æ€è½¬æ¢"></a>RUNNABLEä¸BLOCKEDçŠ¶æ€è½¬æ¢</h4><p><strong>å½“ä¸”ä»…æœ‰ï¼ˆjust onlyï¼‰ä¸€ç§æƒ…å†µä¼šä» RUNNABLE çŠ¶æ€è¿›å…¥åˆ° BLOCKED çŠ¶æ€</strong>ï¼Œå°±æ˜¯çº¿ç¨‹åœ¨ç­‰å¾… synchronized å†…ç½®éšå¼é”ï¼›å¦‚æœç­‰å¾…çš„çº¿ç¨‹è·å–åˆ°äº† synchronized å†…ç½®éšå¼é”ï¼Œä¹Ÿå°±ä¼šä» BLOCKED çŠ¶æ€å˜ä¸º RUNNABLE çŠ¶æ€äº†</p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>ä¸Šé¢æåˆ°ï¼Œä»¥æ“ä½œç³»ç»Ÿé€šç”¨çŠ¶æ€æ¥çœ‹ï¼Œçº¿ç¨‹è°ƒç”¨é˜»å¡å¼ APIï¼Œä¼šå˜ä¸ºä¼‘çœ çŠ¶æ€ï¼ˆé‡Šæ”¾CPUä½¿ç”¨æƒï¼‰ï¼Œä½†åœ¨JVMå±‚é¢ï¼ŒJavaçº¿ç¨‹çŠ¶æ€ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´Javaçº¿ç¨‹çš„çŠ¶æ€ä¾æ—§ä¼šä¿æŒåœ¨ RUNNABLE çŠ¶æ€ã€‚JVMå¹¶ä¸å…³å¿ƒæ“ä½œç³»ç»Ÿè°ƒåº¦çš„çŠ¶æ€ã€‚åœ¨JVMçœ‹æ¥ï¼Œç­‰å¾…CPUä½¿ç”¨æƒï¼ˆæ“ä½œç³»ç»Ÿé‡Œæ˜¯å¤„åœ¨å¯æ‰§è¡ŒçŠ¶æ€ï¼‰ä¸ç­‰å¾…I/Oï¼ˆæ“ä½œç³»ç»Ÿæ˜¯å¤„åœ¨ä¼‘çœ çŠ¶æ€ï¼‰ï¼Œéƒ½æ˜¯ç­‰å¾…æŸä¸ªèµ„æºï¼Œæ‰€ä»¥éƒ½å½’å…¥äº†RUNNABLE çŠ¶æ€ </p><p>â€‹                                                         â€”â€” æ‘˜è‡ªã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹</p></blockquote><h4 id="RUNNABLEä¸WAITINGçŠ¶æ€è½¬æ¢"><a href="#RUNNABLEä¸WAITINGçŠ¶æ€è½¬æ¢" class="headerlink" title="RUNNABLEä¸WAITINGçŠ¶æ€è½¬æ¢"></a>RUNNABLEä¸WAITINGçŠ¶æ€è½¬æ¢</h4><p>è°ƒç”¨<strong>ä¸å¸¦æ—¶é—´å‚æ•°çš„ç­‰å¾…API</strong>ï¼Œå°±ä¼šä»RUNNABLEçŠ¶æ€è¿›å…¥åˆ°WAITINGçŠ¶æ€ï¼›å½“è¢«å”¤é†’å°±ä¼šä»WAITINGè¿›å…¥RUNNABLEçŠ¶æ€</p><h4 id="RUNNABLEä¸-TIMED-WAITING-çŠ¶æ€è½¬æ¢"><a href="#RUNNABLEä¸-TIMED-WAITING-çŠ¶æ€è½¬æ¢" class="headerlink" title="RUNNABLEä¸ TIMED-WAITING çŠ¶æ€è½¬æ¢"></a>RUNNABLEä¸ TIMED-WAITING çŠ¶æ€è½¬æ¢</h4><p>è°ƒç”¨<strong>å¸¦æ—¶é—´å‚æ•°çš„ç­‰å¾…API</strong>ï¼Œè‡ªç„¶å°±ä» RUNNABLE çŠ¶æ€è¿›å…¥ TIMED-WAITING çŠ¶æ€ï¼›å½“è¢«å”¤é†’æˆ–è¶…æ—¶æ—¶é—´åˆ°å°±ä¼šä»TIMED_WAITINGè¿›å…¥RUNNABLEçŠ¶æ€</p><p>çœ‹å›¾ä¸­çš„è½¬æ¢ API æŒºå¤šçš„ï¼Œå…¶å®ä¸ç”¨æ‹…å¿ƒï¼Œåç»­åˆ†ææºç ç« èŠ‚ï¼Œè‡ªç„¶å°±ä¼šè®°ä½çš„ï¼Œç°åœ¨æœ‰ä¸ªå°è±¡ä»¥åŠçŸ¥é“çŠ¶æ€è½¬æ¢çš„èŠ‚ç‚¹å°±å¥½äº†</p><hr><p>ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ çœ‹Javaçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„çœ¼ç¥å°±æ²¡é‚£ä¹ˆè¿·æƒ‘äº†ï¼Œé‡ç‚¹å°±æ˜¯RUNNABLEä¸ä¼‘çœ çŠ¶æ€çš„åˆ‡æ¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€çœ‹ï¼Œå¦‚ä½•æŸ¥çœ‹çº¿ç¨‹ä¸­çš„çŠ¶æ€ï¼Œä»¥åŠå…·ä½“çš„ä»£ç è§¦å‘ç‚¹</p><h2 id="å¦‚ä½•æŸ¥çœ‹çº¿ç¨‹å¤„åœ¨ä»€ä¹ˆçŠ¶æ€"><a href="#å¦‚ä½•æŸ¥çœ‹çº¿ç¨‹å¤„åœ¨ä»€ä¹ˆçŠ¶æ€" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹çº¿ç¨‹å¤„åœ¨ä»€ä¹ˆçŠ¶æ€"></a>å¦‚ä½•æŸ¥çœ‹çº¿ç¨‹å¤„åœ¨ä»€ä¹ˆçŠ¶æ€</h2><h3 id="ç¨‹åºä¸­è°ƒç”¨-getState-æ–¹æ³•"><a href="#ç¨‹åºä¸­è°ƒç”¨-getState-æ–¹æ³•" class="headerlink" title="ç¨‹åºä¸­è°ƒç”¨ getState() æ–¹æ³•"></a>ç¨‹åºä¸­è°ƒç”¨ <code>getState()</code> æ–¹æ³•</h3><p>Thread ç±»ä¸­åŒæ ·å­˜åœ¨  <code>getState()</code> æ–¹æ³•ç”¨äºæŸ¥çœ‹å½“å‰çº¿ç¨‹çŠ¶æ€ï¼Œè¯¥æ–¹æ³•å°±æ˜¯è¿”å›ä¸Šé¢æåˆ°çš„æšä¸¾ç±» <code>State</code></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200322202334.png" alt=""></fancybox></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h4 id="NEW"><a href="#NEW" class="headerlink" title="NEW"></a>NEW</h4><p>å°±æ˜¯ä¸Šé¢æåˆ°ï¼Œ ç¼–ç¨‹è¯­è¨€ä¸­ç‰¹æœ‰çš„ï¼Œé€šè¿‡ç»§æ‰¿ Thread æˆ–å®ç° Runnable æ¥å£å®šä¹‰çº¿ç¨‹åï¼Œè¿™æ—¶çš„çŠ¶æ€éƒ½æ˜¯ NEW</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;&#125;);</span><br><span class="line">System.out.println(thread.getState());</span><br></pre></td></tr></table></figure><h4 id="RUNNABLE"><a href="#RUNNABLE" class="headerlink" title="RUNNABLE"></a>RUNNABLE</h4><p>è°ƒç”¨äº† <code>start()</code> æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹å°±å¤„åœ¨ RUNNABLE çŠ¶æ€äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;&#125;);</span><br><span class="line">thread.start();</span><br><span class="line"><span class="comment">//Thread.sleep(1000);</span></span><br><span class="line">System.out.println(thread.getState());</span><br></pre></td></tr></table></figure><h4 id="BLOCKED"><a href="#BLOCKED" class="headerlink" title="BLOCKED"></a>BLOCKED</h4><p>ç­‰å¾… synchronized å†…ç½®é”ï¼Œå°±ä¼šå¤„åœ¨ BLOCKED çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadStateTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> DemoThreadB());</span><br><span class="line">Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> DemoThreadB());</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">System.out.println((t2.getState()));</span><br><span class="line">System.exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoThreadB</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">commonResource();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">commonResource</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WAITING"><a href="#WAITING" class="headerlink" title="WAITING"></a>WAITING</h4><p>è°ƒç”¨çº¿ç¨‹çš„ <code>join()</code> ç­‰æ–¹æ³•ï¼Œä» RUNNABLE å˜ä¸º WAITING çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread main = Thread.currentThread();</span><br><span class="line"></span><br><span class="line">Thread thread2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        Thread.currentThread().interrupt();</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(main.getState());</span><br><span class="line">&#125;);</span><br><span class="line">thread2.start();</span><br><span class="line">thread2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="TIMED-WAITING"><a href="#TIMED-WAITING" class="headerlink" title="TIMED-WAITING"></a>TIMED-WAITING</h4><p>è°ƒç”¨äº† <code>sleep(long)</code> ç­‰æ–¹æ³•ï¼Œçº¿ç¨‹ä» RUNNABLE å˜ä¸º TIMED-WAITING çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread thread3 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="comment">// ä¸ºä»€ä¹ˆè¦è°ƒç”¨interruptæ–¹æ³•ï¼Ÿ</span></span><br><span class="line">Thread.currentThread().interrupt();</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">thread3.start();</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">System.out.println(thread3.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="TERMINATED"><a href="#TERMINATED" class="headerlink" title="TERMINATED"></a>TERMINATED</h4><p>çº¿ç¨‹æ‰§è¡Œå®Œè‡ªç„¶å°±åˆ°äº† TERMINATED çŠ¶æ€äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;&#125;);</span><br><span class="line">thread.start();</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">System.out.println(thread.getState());</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯ç¨‹åºä¸­æŸ¥çœ‹çº¿ç¨‹ï¼Œè‡ªå·±å†™å†™æµ‹è¯•çœ‹çœ‹çŠ¶æ€è¿˜å¥½ï¼Œç°å®ä¸­çš„ç¨‹åºæ€ä¹ˆå¯èƒ½å…è®¸ä½ åŠ è¿™ä¹ˆå¤šæ— ç”¨ä»£ç ï¼Œæ‰€ä»¥ï¼Œç¿ èŠ±ï¼Œä¸Šé…¸èœï¼ˆ<strong>jstack</strong>ï¼‰</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200325114400.png" alt=""></fancybox></p><h3 id="jstack-å‘½ä»¤æŸ¥çœ‹"><a href="#jstack-å‘½ä»¤æŸ¥çœ‹" class="headerlink" title="jstack å‘½ä»¤æŸ¥çœ‹"></a>jstack å‘½ä»¤æŸ¥çœ‹</h3><p>ç›¸ä¿¡ä½ å¬è¯´è¿‡è¿™ç©æ„ï¼Œjstack å‘½ä»¤å°±æ¯”è¾ƒå¼ºå¤§äº†ï¼Œä¸ä»…èƒ½æŸ¥çœ‹çº¿ç¨‹å½“å‰çŠ¶æ€ï¼Œè¿˜èƒ½çœ‹è°ƒç”¨æ ˆï¼Œé”ç­‰çº¿ç¨‹æ ˆä¿¡æ¯</p><p>å¤§å®¶å¯ä»¥éšæ„å†™ä¸€äº›ç¨‹åºï¼Œè¿™é‡Œæˆ‘ç”¨äº†ä¸Šé¢ WAITING çŠ¶æ€çš„ä»£ç , ä¿®æ”¹ç¡çœ æ—¶é—´ Thread.sleep(100000)ï¼Œç„¶ååœ¨ç»ˆç«¯æŒ‰ç…§ä¸‹å›¾æ ‡ç¤ºä¾æ¬¡æ‰§è¡Œä¸‹å›¾å‘½ä»¤</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage-20200324211507627.png" alt=""></fancybox></p><p>æ›´å¤šåŠŸèƒ½è¿˜è¯·å¤§å®¶è‡ªè¡ŒæŸ¥çœ‹ï¼Œåç»­ä¼šå•ç‹¬å†™æ–‡ç« æ¥æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨jstackæŸ¥çœ‹çº¿ç¨‹æ ˆä¿¡æ¯</p><h3 id="Arthas"><a href="#Arthas" class="headerlink" title="Arthas"></a>Arthas</h3><p>è¿™ä¸ªåˆ©å™¨ï¼Œæ— é¡»å¤šè¨€å§ï¼Œçº¿ä¸Šæ‰¾èŒ¬ç›‘æ§æ²¡æ¯›ç—…ï¼Œå¸Œæœ›ä½ å¯ä»¥çµæ´»ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œæ”»å…‹ç–‘éš¾æ‚ç—‡</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200324213310.png" alt=""></fancybox></p><p>æŸ¥çœ‹çº¿ç¨‹æ ˆè¯¦ç»†ä¿¡æ¯ï¼Œéå¸¸æ–¹ä¾¿ï¼š<a href="https://alibaba.github.io/arthas/thread.html" target="_blank" rel="noopener">https://alibaba.github.io/arthas/thread.html</a></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200324213720.png" alt=""></fancybox></p><p>ç›¸ä¿¡ä½ å·²ç»å’ŒArthasç¡®è®¤äº†çœ¼ç¥ </p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200324214443.png" alt=""></p><p>å…³äºçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æ•´ä½“å°±ç®—è¯´å®Œäº†ï¼Œç¼–å†™å¹¶å‘ç¨‹åºæ—¶å¤šé—®ä¸€é—®è‡ªå·±ï¼š</p><blockquote><p>è°ƒç”¨æŸä¸ªAPIä¼šå°†ä½ çš„çº¿ç¨‹ç½®ä¸ºç”šä¹ˆçŠ¶æ€ï¼Ÿ</p></blockquote><p>å¤šé—®è‡ªå·±å‡ æ¬¡ï¼Œè‡ªç„¶å°±è®°ä½ä¸Šé¢çš„å›¾äº†</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li><p>ä¸ºä»€ä¹ˆè°ƒç”¨ Thread.sleep, catchå¼‚å¸¸åï¼Œè°ƒç”¨äº†Thread.currentThread().interrupt();</p></li><li><p>è¿›å…¥ BLOCKEDåªæœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ç­‰å¾… synchronized ç›‘è§†å™¨é”ï¼Œé‚£è°ƒç”¨ JUC ä¸­çš„ Lock.lock() æ–¹æ³•ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹ç­‰å¾…è¿™ä¸ªé”ï¼Œè¿™ä¸ªçº¿ç¨‹çŠ¶æ€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadStateTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    TestLock testLock = <span class="keyword">new</span> TestLock();</span><br><span class="line"></span><br><span class="line">    Thread thread2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        testLock.myTestLock();</span><br><span class="line">    &#125;, <span class="string">"thread2"</span>);</span><br><span class="line"></span><br><span class="line">    Thread thread1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            testLock.myTestLock();</span><br><span class="line">        &#125;, <span class="string">"thread1"</span>);</span><br><span class="line"></span><br><span class="line">    thread1.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    thread2.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"****"</span> + (thread2.getState()));</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">20000</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLock</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myTestLock</span><span class="params">()</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">            log.info(<span class="string">"testLock status"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>synchronized å’Œ Lock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li></ol><hr><p>æˆ‘è¿™é¢ä¹Ÿåœ¨é€æ­¥æ€»ç»“å¸¸è§çš„å¹¶å‘é¢è¯•é—®é¢˜ï¼ˆæ€»ç»“ingâ€¦â€¦ï¼‰ç­”æ¡ˆæ•´ç†å¥½åä¼šé€šçŸ¥å¤§å®¶ï¼Œè¯·æŒç»­å…³æ³¨</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315120104.png" alt=""></fancybox></p><p>åŒæ—¶ï¼Œè¿™é‡Œä¹Ÿæ•´ç†äº†ä¸€ç‚¹ Java ç¡¬æ ¸èµ„æ–™ï¼Œæœ‰éœ€è¦çš„å°±å…¬ä¼—å·å›å¤ã€èµ„æ–™ã€‘/ã€666ã€‘å§</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200310160835.png" alt=""></fancybox></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹ä¹‹ç­‰å¾…é€šçŸ¥æœºåˆ¶</title>
      <link href="//p/waiting-notification-mechanism.html"/>
      <url>//p/waiting-notification-mechanism.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315160153.png" alt=""></fancybox></p><h2 id="å¹¶å‘ç¼–ç¨‹ä¸ºä»€ä¹ˆä¼šæœ‰ç­‰å¾…é€šçŸ¥æœºåˆ¶"><a href="#å¹¶å‘ç¼–ç¨‹ä¸ºä»€ä¹ˆä¼šæœ‰ç­‰å¾…é€šçŸ¥æœºåˆ¶" class="headerlink" title="å¹¶å‘ç¼–ç¨‹ä¸ºä»€ä¹ˆä¼šæœ‰ç­‰å¾…é€šçŸ¥æœºåˆ¶"></a>å¹¶å‘ç¼–ç¨‹ä¸ºä»€ä¹ˆä¼šæœ‰ç­‰å¾…é€šçŸ¥æœºåˆ¶</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« è¯´æ˜äº† <a href="https://dayarch.top/p/java-concurrency-dead-lock.html">Javaå¹¶å‘æ­»é”è§£å†³æ€è·¯</a> ï¼Œ è§£å†³æ­»é”çš„æ€è·¯ä¹‹ä¸€å°±æ˜¯ <code>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶</code>, æ‰€æœ‰æŸœå‘˜éƒ½è¦é€šè¿‡<strong>å”¯ä¸€</strong>çš„è´¦æœ¬ç®¡ç†å‘˜ä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰è½¬è´¦ä¸šåŠ¡éœ€è¦çš„è´¦æœ¬ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š </p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgaccountmananger.png" alt=""></fancybox></p><p>æ²¡æœ‰ç­‰å¾…/é€šçŸ¥æœºåˆ¶ä¹‹å‰ï¼Œæ‰€æœ‰æŸœå‘˜éƒ½é€šè¿‡æ­»å¾ªç¯çš„æ–¹å¼ä¸æ–­å‘è´¦æœ¬ç®¡ç†å‘˜ç”³è¯·æ‰€æœ‰è´¦æœ¬ï¼Œç¨‹åºçš„ä½“ç°å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!accountBookManager.getAllRequiredAccountBook(<span class="keyword">this</span>, target)) </span><br><span class="line">ï¼›</span><br></pre></td></tr></table></figure><p>å‡å¦‚è´¦æœ¬ç®¡ç†å‘˜æ˜¯å¹´è½»å°ä¼™ï¼Œè…¿è„šåˆ©è½ï¼ˆå³æ‰§è¡Œ getAllRequiredAccountBookæ–¹æ³•è€—æ—¶çŸ­ï¼‰ï¼Œå¹¶ä¸”å¤šä¸ªæŸœå‘˜è½¬è´¦çš„ä¸šåŠ¡å†²çªé‡ä¸å¤§ï¼Œè¿™ä¸ªæ–¹æ¡ˆç®€å•ç²—æš´ä¸”æœ‰æ•ˆï¼ŒæŸœå‘˜åªéœ€è¦å°è¯•å‡ æ¬¡å°±å¯ä»¥æˆåŠŸï¼ˆå³é€šè¿‡å°‘é‡çš„å¾ªç¯å¯ä»¥å®ç°ï¼‰</p><p>è¿‡äº†å¥½å¤šå¹´ï¼Œå¹´è½»çš„è´¦æœ¬ç®¡ç†å‘˜å˜æˆäº†å¹´è¿ˆçš„è€äººï¼Œè¡ŒåŠ¨è¿Ÿç¼“ï¼ˆå³æ‰§è¡Œ getAllRequiredAccountBook è€—æ—¶é•¿ï¼‰ï¼ŒåŒæ—¶ï¼Œå¤šä¸ªæŸœå‘˜è½¬è´¦çš„ä¸šåŠ¡å†²çªé‡ä¹Ÿå˜å¤§ï¼Œä¹‹å‰å‡ åæ¬¡å¾ªç¯èƒ½åšåˆ°çš„ï¼Œç°åœ¨å¯èƒ½å°±è¦ç”³è¯·æˆåƒä¸Šç™¾ï¼Œç”šè‡³ä¸Šä¸‡æ¬¡æ‰èƒ½å®Œæˆä¸€æ¬¡è½¬è´¦</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200311103256.png" alt=""></fancybox></p><p> <strong>äººå·¥æ— é™ç”³è¯·æµªè´¹å£èˆŒï¼Œ ç¨‹åºæ— é™ç”³è¯·æµªè´¹CPUã€‚èªæ˜çš„äººå°±æƒ³åˆ°äº† <code>ç­‰å¾…/é€šçŸ¥</code> æœºåˆ¶</strong></p><h2 id="ç­‰å¾…-é€šçŸ¥æœºåˆ¶"><a href="#ç­‰å¾…-é€šçŸ¥æœºåˆ¶" class="headerlink" title="ç­‰å¾…/é€šçŸ¥æœºåˆ¶"></a>ç­‰å¾…/é€šçŸ¥æœºåˆ¶</h2><p>æ— é™å¾ªç¯å®åœ¨å¤ªæµªè´¹CPUï¼Œè€Œç†æƒ³æƒ…å†µåº”è¯¥æ˜¯è¿™æ ·ï¼š</p><ul><li>æŸœå‘˜Aå¦‚æœæ‹¿ä¸åˆ°æ‰€æœ‰è´¦æœ¬ï¼Œå°±å‚²å¨‡çš„ä¸å†ç»§ç»­é—®äº†ï¼ˆçº¿ç¨‹é˜»å¡è‡ªå·± waitï¼‰</li><li>æŸœå‘˜Bå½’è¿˜äº†æŸœå‘˜Aéœ€è¦çš„è´¦æœ¬ä¹‹åå°±ä¸»åŠ¨é€šçŸ¥æŸœå‘˜Aè´¦æœ¬å¯ç”¨ï¼ˆé€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹ notify/notifyAllï¼‰</li></ul><p>åšåˆ°è¿™æ ·ï¼Œå°±èƒ½é¿å…å¾ªç¯ç­‰å¾…æ¶ˆè€—CPUçš„é—®é¢˜äº†</p><hr><p>ç°å®ä¸­æœ‰å¤ªå¤šåœºæ™¯éƒ½åœ¨åº”ç”¨ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚æ¬¢è¿è§‚ä¸´çº¢æµªæ¼«ï¼Œæ¯”å¦‚å»XXåŠè¯ï¼Œå»åŒ»é™¢å°±åŒ»/ä½“æ£€ã€‚</p><p>ä¸‹é¢è¯·è‡ªè¡Œè„‘è¡¥ä¸€ä¸‹å»åŒ»é™¢å°±åŒ»æˆ–ä½“æ£€çš„ç”»é¢, æ•´ä½“æµç¨‹ç±»ä¼¼è¿™æ ·ï¼š</p><table><thead><tr><th>åºå·</th><th align="left">å°±åŒ»</th><th>ç¨‹åºè§£é‡Šï¼ˆè‡ªå·±çš„è§†è§’ï¼‰</th></tr></thead><tbody><tr><td>1</td><td align="left">æŒ‚å·æˆåŠŸï¼Œåˆ°è¯Šå®¤é—¨å£æ’å·å€™è¯Š</td><td>æ’å·çš„æ‚£è€…ï¼ˆçº¿ç¨‹ï¼‰å°è¯•è·å–ã€äº’æ–¥é”ã€‘</td></tr><tr><td>2</td><td align="left">å¤§å¤«å«åˆ°è‡ªå·±ï¼Œè¿›å…¥è¯Šå®¤å°±è¯Š</td><td>è‡ªå·±ã€è·å–åˆ°äº’æ–¥é”ã€‘</td></tr><tr><td>3</td><td align="left">å¤§å¤«ç®€å•è¯¢é—®ï¼Œè¦æ±‚åšæ£€æŸ¥ï¼ˆæ‚£è€…ç¼ºä¹æŠ¥å‘Šä¸èƒ½è¯Šæ–­ç—…å› ï¼‰</td><td>è¿›è¡Œã€æ¡ä»¶åˆ¤æ–­ã€‘ï¼Œçº¿ç¨‹è¦æ±‚çš„æ¡ä»¶ã€æ²¡æ»¡è¶³ã€‘</td></tr><tr><td>4</td><td align="left">è‡ªå·±å‡ºå»åšæ£€æŸ¥</td><td>çº¿ç¨‹ã€ä¸»åŠ¨é‡Šæ”¾ã€‘æŒæœ‰çš„äº’æ–¥é”</td></tr><tr><td>5</td><td align="left">å¤§å¤«å«ä¸‹ä¸€ä½æ‚£è€…</td><td>å¦ä¸€ä½æ‚£è€…ï¼ˆçº¿ç¨‹ï¼‰è·å–åˆ°äº’æ–¥é”</td></tr><tr><td>6</td><td align="left">è‡ªå·±æ‹¿åˆ°æ£€æµ‹æŠ¥å‘Š</td><td>çº¿ç¨‹ã€æ›¾ç»ã€‘è¦æ±‚çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼ˆå®åˆ™ã€è¢«é€šçŸ¥ã€‘ï¼‰</td></tr><tr><td>7</td><td align="left">å†æ¬¡åœ¨è¯Šå®¤é—¨å£æ’å·å€™è¯Š</td><td>å†æ¬¡å°è¯•è·å–äº’æ–¥é”</td></tr><tr><td>8</td><td align="left">â€¦</td><td>â€¦</td></tr></tbody></table><p>åœ¨ã€ç¨‹åºè§£é‡Šã€‘ä¸€åˆ—ï¼Œæˆ‘å°†å…³é”®å­—ï¼ˆæ’é˜Ÿã€é”ã€ç­‰å¾…ã€é‡Šæ”¾â€¦.ï¼‰å·²ç»ç”¨ <code>ã€ã€‘</code> æ¡†äº†èµ·æ¥ã€‚Java è¯­è¨€ä¸­ï¼Œå…¶å†…ç½®çš„å…³é”®å­— <code>synchronized</code> å’Œ æ–¹æ³•<code>wait()ï¼Œnotify()/notifyAll()</code>  å°±èƒ½å®ç°ä¸Šé¢æåˆ°çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œæˆ‘ä»¬å°†è¿™å‡ ä¸ªå…³é”®å­—å®ç°æµç¨‹ç°å½¢è±¡åŒ–çš„è¡¨ç¤ºä¸€ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312141043.png" alt="ç­‰å¾…é˜Ÿåˆ—å›¾"></fancybox></p><p>è¿™å¯ä¸æ˜¯ä¸€ä¸ªç®€å•çš„å›¾ï¼Œä¸‹é¢è¿˜è¦å›´ç»•è¿™ä¸ªå›¾åšå¾ˆå¤šæ–‡ç« ï¼Œä¸è¿‡è¿™é‡Œæˆ‘å¿…é¡»è¦æ’æ’­å‡ ä¸ªé¢è¯•åŸºç¡€çŸ¥è¯†ç‚¹äº†ï¼š</p><ol><li>ä¸€ä¸ªé”å¯¹åº”ä¸€ä¸ªã€å…¥å£ç­‰å¾…é˜Ÿåˆ—ã€‘ï¼Œä¸åŒé”çš„å…¥å£ç­‰å¾…é˜Ÿåˆ—æ²¡ä»»ä½•å…³ç³»ï¼Œè¯´ç™½äº†ä»–ä»¬å°±ä¸å­˜åœ¨ç«äº‰å…³ç³»ã€‚ä½ æƒ³å‘€ï¼Œä¸åŒæ‚£è€…è¿›å…¥çœ¼ç§‘å’Œè€³é¼»å–‰ç§‘çœ‹å¤§å¤«ä¸€ç‚¹å†²çªéƒ½æ²¡æœ‰</li><li><code>wait(), notify()/notifyAll()</code>  è¦åœ¨ synchronized å†…éƒ¨è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”ï¼Œå¦‚æœé”çš„å¯¹è±¡æ˜¯thisï¼Œå°±è¦ <code>this.wait()ï¼Œthis.notify()/this.notifyAll()</code> , å¦åˆ™JVMå°±ä¼šæŠ›å‡º <code>java.lang.IllegalMonitorStateException</code> çš„ã€‚ä½ æƒ³å‘€ï¼Œç­‰å¾…/é€šçŸ¥æœºåˆ¶å°±æ˜¯ä»ã€ç«äº‰ã€‘ç¯å¢ƒé€æ¸è¡ç”Ÿå‡ºæ¥çš„ç­–ç•¥ï¼Œä¸åœ¨é”ç«äº‰å†…éƒ¨ä½¿ç”¨æˆ–ç­‰å¾…/é€šçŸ¥é”™äº†å¯¹è±¡ï¼Œ è‡ªç„¶æ˜¯ä¸ç¬¦åˆå¸¸ç†çš„</li></ol><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312143352.png" alt=""></fancybox></p><p>æœ‰äº†ä¸Šé¢çŸ¥è¯†çš„é“ºå«ï¼Œè¦æƒ³å°†æ— é™å¾ªç¯ç­–ç•¥æ”¹ä¸ºç­‰å¾…é€šçŸ¥ç­–ç•¥ï¼Œä½ è¿˜éœ€è¦é—®è‡ªå·±å››ä¸ªé—®é¢˜ï¼š</p><h3 id="çµé­‚-4-é—®"><a href="#çµé­‚-4-é—®" class="headerlink" title="çµé­‚ 4 é—®"></a>çµé­‚ 4 é—®</h3><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312144436.png" alt=""></fancybox></p><p>æˆ‘ä»¬æ‹¿é’±åº„è´¦æœ¬ç®¡ç†å‘˜çš„ä¾‹å­ä¾ä¾åšä»¥ä¸Šå›ç­”ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315160059.png" alt=""></fancybox></p><p>æˆ‘ä»¬ä¼˜åŒ–é’±åº„è½¬è´¦çš„ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountBookManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; accounts = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">getAllRequiredAccountBook</span><span class="params">( Object from, Object to)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(accounts.contains(from) || accounts.contains(to))&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">accounts.add(from);</span><br><span class="line">accounts.add(to);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½’è¿˜èµ„æº</span></span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">releaseObtainedAccountBook</span><span class="params">(Object from, Object to)</span></span>&#123;</span><br><span class="line">accounts.remove(from);</span><br><span class="line">accounts.remove(to);</span><br><span class="line">    notify();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±è¿™æ ·ã€çœ‹ã€‘ ã€ä¼¼ã€‘ ã€å®Œã€‘ ã€ç¾ã€‘çš„è§£å†³äº†ï¼Œå…¶å®ä¸Šé¢çš„ç¨‹åºæœ‰ä¸¤ä¸ªå¤§å‘ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imge18d20c94006dfe0-3cdd6892e1ea4e8e-3668d8ad5f1cfd4ddcc222610ebc14e7.gif" alt=""></p><h3 id="å‘ä¸€"><a href="#å‘ä¸€" class="headerlink" title="å‘ä¸€"></a>å‘ä¸€</h3><p>åœ¨ä¸Šé¢ <code>this.wait()</code> å¤„ï¼Œä½¿ç”¨äº† if æ¡ä»¶åˆ¤æ–­ï¼Œä¼šå‡ºç°å¤©å¤§çš„éº»çƒ¦ï¼Œæ¥çœ‹ä¸‹å›¾ï¼ˆä»ä¸‹å¾€ä¸Šçœ‹ï¼‰ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312151758.png" alt=""></fancybox></p><p>notify å”¤é†’çš„é‚£ä¸€åˆ»ï¼Œçº¿ç¨‹<strong>ã€æ›¾ç»/æ›¾ç»/æ›¾ç»ã€‘</strong>è¦æ±‚çš„æ¡ä»¶å¾—åˆ°äº†æ»¡è¶³ï¼Œä»è¿™ä¸€åˆ»å¼€å§‹ï¼Œåˆ°å»æ¡ä»¶ç­‰é˜Ÿåˆ—ä¸­å”¤é†’çº¿ç¨‹ï¼Œå†åˆ°å†æ¬¡å°è¯•è·å–é”æ˜¯<code>æœ‰æ—¶é—´å·®</code>çš„ï¼Œå½“å†æ¬¡è·å–åˆ°é”æ—¶ï¼Œçº¿ç¨‹æ›¾ç»è¦æ±‚çš„æ¡ä»¶æ˜¯<strong>ä¸ä¸€å®š</strong>æ»¡è¶³ï¼Œæ‰€ä»¥éœ€è¦<strong>é‡æ–°</strong>è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œæ‰€ä»¥éœ€è¦å°† <code>if</code> åˆ¤æ–­æ”¹æˆ <code>while</code> åˆ¤æ–­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">getAllRequiredAccountBook</span><span class="params">( Object from, Object to)</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(accounts.contains(from) || accounts.contains(to))&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">accounts.add(from);</span><br><span class="line">accounts.add(to);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä»æŒ‚èµ·çŠ¶æ€å˜ä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯è¢«å”¤é†’ï¼‰ï¼Œå³ä½¿çº¿ç¨‹æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹è°ƒç”¨<code>notify()/notifyAll()</code> æ–¹æ³•è¿›è¡Œé€šçŸ¥ï¼Œæˆ–è¢«ä¸­æ–­ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ã€<strong>è™šå‡å”¤é†’</strong>ã€‘ã€‚è™½ç„¶è™šå‡å”¤é†’å¾ˆå°‘å‘ç”Ÿï¼Œä½†è¦é˜²æ‚£äºæœªç„¶ï¼Œ<strong>åšæ³•å°±æ˜¯ä¸åœçš„å»æµ‹è¯•è¯¥çº¿ç¨‹è¢«å”¤é†’æ¡ä»¶æ˜¯å¦æ»¡è¶³</strong></p><p>â€”â€”æ‘˜è‡ªã€ŠJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€‹</p></blockquote><hr><p>æœ‰åŒå­¦å¯èƒ½è¿˜ä¼šäº§ç”Ÿç–‘é—®ï¼Œä¸ºä»€ä¹ˆwhileå°±å¯ä»¥ï¼Ÿ</p><p>å› ä¸ºè¢«å”¤é†’çš„çº¿ç¨‹å†æ¬¡è·å–åˆ°é”ä¹‹åæ˜¯<strong>ä»åŸæ¥çš„ wait ä¹‹åå¼€å§‹æ‰§è¡Œçš„</strong>ï¼Œwaitåœ¨å¾ªç¯é‡Œé¢ï¼Œæ‰€ä»¥ä¼šå†æ¬¡è¿›å…¥å¾ªç¯æ¡ä»¶é‡æ–°è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚</p><p>å¦‚æœä¸ç†è§£è¿™ä¸ªé“ç†å°±è®°ä½ä¸€å¥è¯ï¼š</p><blockquote><p>ä»å“ªé‡Œè·Œå€’å°±ä»å“ªé‡Œçˆ¬èµ·æ¥ï¼›åœ¨å“ªé‡Œwaitï¼Œå°±ä»waité‚£é‡Œç»§ç»­å‘åæ‰§è¡Œ</p></blockquote><p>æ‰€ä»¥ï¼Œè¿™ä¹Ÿå°±æˆäº†ä½¿ç”¨wait()çš„æ ‡å‡†èŒƒå¼</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312154011.png" alt=""></fancybox></p><p>è‡³äºå‘äºŒï¼Œæ˜¯çº¿ç¨‹å½’è¿˜æ‰€ä½¿ç”¨çš„è´¦æˆ·ä¹‹åä½¿ç”¨ notify è€Œä¸æ˜¯ notifyAll è¿›è¡Œé€šçŸ¥ï¼Œç”±äºå‘å¾ˆå¤§ï¼Œéœ€è¦ä¸€äº›çŸ¥è¯†é“ºå«æ¥è¯´æ˜</p><h2 id="ä¸ºä»€ä¹ˆè¯´å°½é‡ä½¿ç”¨-notifyAll"><a href="#ä¸ºä»€ä¹ˆè¯´å°½é‡ä½¿ç”¨-notifyAll" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´å°½é‡ä½¿ç”¨ notifyAll()"></a>ä¸ºä»€ä¹ˆè¯´å°½é‡ä½¿ç”¨ notifyAll()</h2><p>notify() å’Œ notifyAll() åˆ°åº•å•¥åŒºåˆ«ï¼Ÿ</p><p><code>notify()</code> å‡½æ•°</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><blockquote><p><strong>éšæœºå”¤é†’ä¸€ä¸ªï¼š</strong>ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å…±äº«å¯¹è±¡çš„ notify() æ–¹æ³•ï¼Œä¼šå”¤é†’<strong>ä¸€ä¸ª</strong>åœ¨è¯¥å…±äº«å˜é‡ä¸Šè°ƒç”¨ wait() æ–¹æ³•åè¢«æŒ‚èµ·çš„çº¿ç¨‹ï¼Œä¸€ä¸ªå…±äº«å˜é‡ä¸Šå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå…·ä½“å”¤é†’é‚£ä¸€ä¸ªï¼Œæ˜¯<strong>éšæœºçš„</strong></p></blockquote><p><code>notifyAll()</code> å‡½æ•°</p><blockquote><p><strong>å”¤é†’æ‰€æœ‰ï¼š</strong> ä¸notify() ä¸åŒï¼ŒnotifyAll() ä¼šå”¤é†’åœ¨è¯¥å…±äº«å˜é‡ä¸Šç”±äºè°ƒç”¨wait() æ–¹æ³•è€Œè¢«æŒ‚èµ·çš„<strong>æ‰€æœ‰çº¿ç¨‹</strong></p></blockquote><p>çœ‹ä¸ªéå¸¸ç®€å•çš„ç¨‹åºä¾‹å­å§</p><p><strong>ç¤ºä¾‹ç¨‹åºä¸€</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Object resourceA = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">synchronized</span> (resourceA)&#123;</span><br><span class="line">log.info(<span class="string">"threadA get resourceA lock"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">log.info(<span class="string">"threadA begins to wait"</span>);</span><br><span class="line">resourceA.wait();</span><br><span class="line">log.info(<span class="string">"threadA ends wait"</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">log.error(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Thread threadB = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">synchronized</span> (resourceA)&#123;</span><br><span class="line">log.info(<span class="string">"threadB get resourceA lock"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">log.info(<span class="string">"threadB begins to wait"</span>);</span><br><span class="line">resourceA.wait();</span><br><span class="line">log.info(<span class="string">"threadB ends wait"</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">log.error(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Thread threadC = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"><span class="keyword">synchronized</span> (resourceA)&#123;</span><br><span class="line">log.info(<span class="string">"threadC begin to notify"</span>);</span><br><span class="line">resourceA.notify();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">threadA.start();</span><br><span class="line">threadB.start();</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">threadC.start();</span><br><span class="line"></span><br><span class="line">threadA.join();</span><br><span class="line">threadB.join();</span><br><span class="line">threadC.join();</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"main thread over now"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹è¿è¡Œç»“æœ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312204947.png" alt=""></fancybox></p><p>ç¨‹åºä¸­æˆ‘ä»¬ä½¿ç”¨notify()éšæœºé€šçŸ¥resourceAçš„ç­‰å¾…é˜Ÿåˆ—çš„ä¸€ä¸ªçº¿ç¨‹ï¼ŒthreadAè¢«å”¤é†’ï¼ŒthreadBå´æ²¡æœ‰æ‰“å°å‡º <code>threadB ends wait</code> è¿™å¥è¯ï¼Œé—æ†¾çš„æ­»æ‰äº†</p><p>å°† notify() æ¢æˆ notifyAll() çš„ç»“æœæƒ³å¿…ä½ å·²ç»çŸ¥é“äº†</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312205605.png" alt=""></fancybox></p><p>ä½¿ç”¨ notifyAll() ç¡®å®ä¸ä¼šé—è½ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œä½†ä¹Ÿäº§ç”Ÿäº†æ¯”è¾ƒå¼ºçƒˆçš„ç«äº‰ï¼Œå¦‚æœnotify() è®¾è®¡çš„æœ¬èº«å°±æ˜¯ bugï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°åº”è¯¥æ—©å°±ä» JDK ä¸­ç§»é™¤äº†ï¼Œå®ƒéšæœºé€šçŸ¥ä¸€ä¸ªçº¿ç¨‹çš„å½¢å¼å¿…å®šæ˜¯æœ‰ç”¨æ­¦ä¹‹åœ°çš„</p><h2 id="ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨-notify"><a href="#ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨-notify" class="headerlink" title="ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨ notify()"></a>ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨ notify()</h2><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200312210340.png" alt=""></fancybox></p><p>notify() çš„å…¸å‹çš„åº”ç”¨å°±æ˜¯çº¿ç¨‹æ± ï¼ˆæŒ‰ç…§ä¸Šé¢çš„ä¸‰ä¸ªæ¡ä»¶ä½ è‡ªé—®è‡ªç­”éªŒè¯ä¸€ä¸‹æ˜¯è¿™æ ·å—ï¼Ÿï¼‰</p><p>è¿™é‡Œæˆ‘ä»¬æ‹¿ä¸€ä¸ª JUC ä¸‹çš„ç±»æ¥çœ‹çœ‹ notify() çš„ç”¨å¤„</p><blockquote><p><strong>Tips:</strong></p><ul><li><code>notify()</code> ç­‰åŒäº <code>signal()</code> </li><li><code>wait()</code> ç­‰åŒäº <code>await()</code></li></ul></blockquote><p>åœ¨IDEä¸­ï¼Œæ‰“å¼€ <code>ArrayBlockingQueue.java</code> </p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315101013.png" alt=""></fancybox></p><p>æ‰€æœ‰çš„å…¥é˜Ÿ public æ–¹æ³•<code>offer()/put()</code> å†…éƒ¨éƒ½è°ƒç”¨äº† private çš„ <code>enqueue()</code> æ–¹æ³•</p><p>æ‰€æœ‰çš„å‡ºé˜Ÿ public æ–¹æ³•<code>poll()/take()</code> å†…éƒ¨éƒ½è°ƒç”¨äº† private çš„ <code>dequeue()</code> æ–¹æ³•</p><p>å°†è¿™ä¸ªæ¨¡å‹è¿›è¡Œç²¾ç®€å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBlockingQueue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="comment">// æ¡ä»¶å˜é‡ï¼šé˜Ÿåˆ—ä¸æ»¡</span></span><br><span class="line"><span class="keyword">final</span> Condition notFull = lock.newCondition();</span><br><span class="line"><span class="comment">// æ¡ä»¶å˜é‡ï¼šé˜Ÿåˆ—ä¸ç©º</span></span><br><span class="line"><span class="keyword">final</span> Condition notEmpty = lock.newCondition();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¥é˜Ÿ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">enq</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (é˜Ÿåˆ—å·²æ»¡)&#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…é˜Ÿåˆ—ä¸æ»¡</span></span><br><span class="line">notFull.await();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çœç•¥å…¥é˜Ÿæ“ä½œ...</span></span><br><span class="line"><span class="comment">//å…¥é˜Ÿå,é€šçŸ¥å¯å‡ºé˜Ÿ</span></span><br><span class="line">notEmpty.signal();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deq</span><span class="params">()</span></span>&#123;</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (é˜Ÿåˆ—å·²ç©º)&#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…é˜Ÿåˆ—ä¸ç©º</span></span><br><span class="line">notEmpty.await();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çœç•¥å‡ºé˜Ÿæ“ä½œ...</span></span><br><span class="line"><span class="comment">//å‡ºé˜Ÿåï¼Œé€šçŸ¥å¯å…¥é˜Ÿ</span></span><br><span class="line">notFull.signal();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ»¡è¶³ä¸Šé¢è¿™ä¸‰ä¸ªæ¡ä»¶ï¼Œnotify() çš„ä½¿ç”¨å°±æ°åˆ°å¥½å¤„ï¼›æˆ‘ä»¬ç”¨ä½¿ç”¨ <code>notify()</code>çš„æ¡ä»¶è¿›è¡ŒéªŒè¯</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315104007.png" alt=""></fancybox></p><p>æœ‰çš„åŒå­¦çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šç¨ç¨æœ‰ä¸€äº›ç–‘æƒ‘ï¼Œ<code>await()/signal()</code> å’Œ <code>wait()/notify()</code> ç»„åˆçš„ç©æ³•çœ‹ç€ä¸å¤ªä¸€æ ·å‘¢ï¼Œä½ ç–‘æƒ‘çš„æ²¡æœ‰é”™</p><p>å› ä¸º Java å†…ç½®çš„ç›‘è§†å™¨é”æ¨¡å‹æ˜¯ MESA æ¨¡å‹çš„ç²¾ç®€ç‰ˆ</p><h2 id="MESAæ¨¡å‹"><a href="#MESAæ¨¡å‹" class="headerlink" title="MESAæ¨¡å‹"></a>MESAæ¨¡å‹</h2><p>MESA ç›‘è§†å™¨æ¨¡å‹ä¸­è¯´ï¼Œæ¯ä¸€ä¸ªæ¡ä»¶å˜é‡éƒ½å¯¹åº”ä¸€ä¸ªæ¡ä»¶ç­‰å¾…é˜Ÿåˆ—</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315110223.png" alt=""></fancybox></p><p>å¯¹åº”åˆ°ä¸Šé¢ç¨‹åºï¼š</p><ul><li>é˜Ÿåˆ—å·²æ»¡æ˜¯å‰ææ¡ä»¶ï¼Œæ¡ä»¶å˜é‡Aå°±æ˜¯notFullï¼Œä¹Ÿå°±æ˜¯notFull.await; notFull.signal</li><li>é˜Ÿåˆ—å·²ç©ºæ˜¯å‰ææ¡ä»¶ï¼Œæ¡ä»¶å˜é‡Bå°±æ˜¯notEmptyï¼Œä¹Ÿå°±æ˜¯notEmpty.await; notEmpty.signal/sign</li></ul><p><strong>å³ä¾¿notFull.signalAll, ä¹Ÿå’Œawaitåœ¨notEmpty æ¡ä»¶å˜é‡é˜Ÿåˆ—çš„çº¿ç¨‹æ²¡åŠæ¯›é’±å…³ç³»</strong></p><p>è€ŒJavaå†…ç½®ç›‘è§†å™¨æ¨¡å‹å°±åªä¼šæœ‰ä¸€ä¸ªã€éšå½¢çš„ã€‘æ¡ä»¶å˜é‡</p><ul><li>å¦‚æœæ˜¯synchronizedä¿®é¥°çš„æ™®é€šæ–¹æ³•ï¼Œæ¡ä»¶å˜é‡å°±æ˜¯ this</li><li>å¦‚æœæ˜¯synchronizedä¿®é¥°çš„é™æ€æ–¹æ³•ï¼Œæ¡ä»¶å˜é‡å°±æ˜¯ç±»</li><li>å¦‚æœæ˜¯synchronizedå—ï¼Œæ¡ä»¶å˜é‡å°±æ˜¯å—ä¸­çš„å†…å®¹äº† </li></ul><p>è¯´å®Œäº†è¿™äº›ï¼Œä½ æœ‰æ²¡æœ‰æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰å‘¢</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315115553.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœä¸šåŠ¡å†²çªä¸å¤§ï¼Œå¾ªç¯ç­‰å¾…æ˜¯ä¸€ç§ç®€å•ç²—æš´ä¸”æœ‰æ•ˆçš„æ–¹å¼ï¼›ä½†æ˜¯å½“ä¸šåŠ¡å†²çªå¤§ä¹‹åï¼Œé€šçŸ¥/ç­‰å¾…æœºåˆ¶æ˜¯å¿…ä¸å¯å°‘çš„ä½¿ç”¨ç­–ç•¥</p><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œç›¸ä¿¡ä½ å·²ç»å¯ä»¥é€šè¿‡çµé­‚4é—®ï¼ŒçŸ¥é“å¦‚ä½•å°†å¾ªç¯ç­‰å¾…æ”¹å–„æˆé€šçŸ¥/ç­‰å¾…æ¨¡å‹äº†ï¼›å¦å¤–ä¹ŸçŸ¥é“å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨é€šçŸ¥/ç­‰å¾…æœºåˆ¶äº†</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>é’±åº„è½¬è´¦çš„ä¸šåŠ¡ï¼Œæ¡ä»¶éƒ½æ˜¯åˆ¤æ–­è´¦æˆ·æ˜¯å¦è¢«æ”¯é…ï¼Œéƒ½æ˜¯æ‰§è¡Œç›¸åŒçš„è½¬è´¦ä¸šåŠ¡ï¼Œä¸ºä»€ä¹ˆå°±ä¸å¯ä»¥ç”¨notify() è€Œåªèƒ½ç”¨notifyAll() å‘¢</li><li>ResourceAçš„ä¾‹å­ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨notifyé€šçŸ¥ï¼Œç¨‹åºæ²¡æœ‰æ‰“å°å‡º <code>main thread over now</code>ï¼Œ è€Œä½¿ç”¨notifyAll() å´æ‰“å°å‡ºæ¥äº†å‘¢ï¼Ÿ</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>æ„Ÿè°¢å‰è¾ˆä»¬æ€»ç»“çš„ç²¾åï¼Œè‡ªå·±æ‰€å†™çš„å¹¶å‘ç³»åˆ—å¥½å¤šéƒ½å‚è€ƒäº†ä»¥ä¸‹èµ„æ–™</p><ul><li>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜</li><li>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾</li><li>ç å‡ºé«˜æ•ˆ</li><li>Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</li><li><a href="https://www.geeksforgeeks.org/difference-notify-notifyall-java/" target="_blank" rel="noopener">https://www.geeksforgeeks.org/difference-notify-notifyall-java/</a></li><li>â€¦</li></ul><hr><p>ä¸‹é¢çš„æ–‡ç« ï¼Œå°±éœ€è¦èŠèŠã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‘äº†ï¼Œåªæœ‰ç†ŸçŸ¥çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½ æ‰èƒ½æ›´å¥½çš„ç¼–å†™å¹¶å‘ç¨‹åºã€‚</p><p>æˆ‘è¿™é¢ä¹Ÿåœ¨é€æ­¥æ€»ç»“å¸¸è§çš„å¹¶å‘é¢è¯•é—®é¢˜ï¼ˆæ€»ç»“ingâ€¦â€¦ï¼‰ç­”æ¡ˆæ•´ç†å¥½åä¼šé€šçŸ¥å¤§å®¶ï¼Œè¯·æŒç»­å…³æ³¨</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200315120104.png" alt=""></fancybox></p><p>åŒæ—¶ï¼Œè¿™é‡Œä¹Ÿæ•´ç†äº†ä¸€ç‚¹ Java ç¡¬æ ¸èµ„æ–™ï¼Œæœ‰éœ€è¦çš„å°±å…¬ä¼—å·å›å¤ã€èµ„æ–™ã€‘/ã€666ã€‘å§</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200310160835.png" alt=""></fancybox></p><hr>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>volatileå’Œsynchronizedå›¾æ–‡é€å½»è®²è§£</title>
      <link href="//p/difference-between-volatile-and-synchronized-keyword.html"/>
      <url>//p/difference-between-volatile-and-synchronized-keyword.html</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><p>ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰ä¸¤ä¸ªæ€æƒ³</p></li><li><p>If you can NOT explain it simply, you do NOT understand it well enough</p></li></ul></blockquote><p>ç°é™†ç»­å°†Demoä»£ç å’ŒæŠ€æœ¯æ–‡ç« æ•´ç†åœ¨ä¸€èµ· <a href="https://github.com/FraserYu/learnings" target="_blank" rel="noopener">Githubå®è·µç²¾é€‰</a> ï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»æŸ¥çœ‹ï¼Œæœ¬æ–‡åŒæ ·æ”¶å½•åœ¨æ­¤ï¼Œè§‰å¾—ä¸é”™ï¼Œè¿˜è¯·StarğŸŒŸ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgfenge.gif" alt=""></fancybox></p><p>ä¹‹å‰å†™äº†å‡ ç¯‡ <a href="https://dayarch.top/categories/Coding/Java-Concurrency/">Javaå¹¶å‘ç¼–ç¨‹çš„ç³»åˆ—</a> æ–‡ç« ï¼Œæœ‰ä¸ªæœ‹å‹å¾®ç¾¤é‡Œé—®æˆ‘ï¼Œè¿˜æ˜¯ä¸èƒ½ç†è§£ <code>volatile</code> å’Œ <code>synchronized</code> äºŒè€…çš„åŒºåˆ«, ä»–çš„é—®é¢˜ä¸»è¦å¯ä»¥å½’çº³ä¸ºè¿™å‡ ä¸ªï¼š</p><ul><li><p>volatile ä¸ synchronized åœ¨å¤„ç†å“ªäº›é—®é¢˜æ˜¯ç›¸å¯¹ç­‰ä»·çš„ï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆè¯´ volatile æ˜¯ synchronized å¼±åŒæ­¥çš„æ–¹å¼ï¼Ÿ</p></li><li><p>volatile é™¤äº†å¯è§æ€§é—®é¢˜ï¼Œè¿˜èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p></li><li><p>äºŒè€…æˆ‘è¦å¦‚ä½•é€‰æ‹©ä½¿ç”¨ï¼Ÿ</p></li></ul><p>å¦‚æœä½ ä¸èƒ½å›ç­”ä¸Šé¢çš„å‡ ä¸ªé—®é¢˜ï¼Œè¯´æ˜ä½ å¯¹äºŒè€…çš„åŒºåˆ«è¿˜æœ‰ä¸€äº›å«æ··ã€‚æœ¬æ–‡å°±é€šè¿‡<strong>å›¾æ–‡</strong>çš„æ–¹å¼å¥½å¥½è¯´è¯´ä»–ä»¬å¾®å¦™çš„å…³ç³»</p><p>éƒ½å¬è¿‡ã€å¤©ä¸Šä¸€å¤©ï¼Œåœ°ä¸‹ä¸€å¹´ã€‘ï¼Œå‡è®¾ CPU æ‰§è¡Œä¸€æ¡æ™®é€šæŒ‡ä»¤éœ€è¦ä¸€å¤©ï¼Œé‚£ä¹ˆ CPU è¯»å†™å†…å­˜å°±å¾—ç­‰å¾…ä¸€å¹´çš„æ—¶é—´ã€‚</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200301161659.png" alt=""></fancybox></p><p>å—ã€æœ¨æ¡¶åŸç†ã€‘çš„é™åˆ¶ï¼Œåœ¨CPUçœ¼é‡Œï¼Œç¨‹åºçš„æ•´ä½“æ€§èƒ½éƒ½è¢«å†…å­˜çš„åŠäº‹æ•ˆç‡æ‹‰ä½äº†ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªçŸ­æ¿ï¼Œç¡¬ä»¶åŒå­¦ä¹Ÿä½¿ç”¨äº†æˆ‘ä»¬åšè½¯ä»¶å¸¸ç”¨çš„æé€Ÿç­–ç•¥â€”â€”ä½¿ç”¨ç¼“å­˜Cacheï¼ˆå®åˆ™æ˜¯ç¡¬ä»¶åŒå­¦ç»™è½¯ä»¶åŒå­¦æŒ–çš„å‘ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img%E4%BD%A0%E7%9A%84%E9%94%85.gif" alt=""></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"><a href="#Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" class="headerlink" title="Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"></a>Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</h2><p>CPU å¢åŠ äº†ç¼“å­˜å‡è¡¡äº†ä¸å†…å­˜çš„é€Ÿåº¦å·®å¼‚ï¼Œè¿™ä¸€å¢åŠ è¿˜æ˜¯å¥½å‡ å±‚ã€‚</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200303192228.png" alt=""></fancybox></p><p>æ­¤æ—¶å†…å­˜çš„çŸ­æ¿ä¸å†é‚£ä¹ˆæ˜æ˜¾ï¼ŒCPUç”šå–œã€‚ä½†éšä¹‹å´å¸¦æ¥å¾ˆå¤šé—®é¢˜</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgjmm.png" alt=""></fancybox></p><p>çœ‹ä¸Šå›¾ï¼Œæ¯ä¸ªæ ¸éƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼ˆL1 Cacheï¼‰ï¼Œæœ‰çš„æ¶æ„é‡Œé¢è¿˜æœ‰æ‰€æœ‰æ ¸å…±ç”¨çš„äºŒçº§ç¼“å­˜ï¼ˆL2 Cacheï¼‰ã€‚ä½¿ç”¨ç¼“å­˜ä¹‹åï¼Œå½“çº¿ç¨‹è¦è®¿é—®å…±äº«å˜é‡æ—¶ï¼Œå¦‚æœ L1 ä¸­å­˜åœ¨è¯¥å…±äº«å˜é‡ï¼Œå°±ä¸ä¼šå†é€çº§è®¿é—®ç›´è‡³ä¸»å†…å­˜äº†ã€‚æ‰€ä»¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±è¡¥ä¸Šäº†è®¿é—®å†…å­˜æ…¢çš„çŸ­æ¿</p><p>å…·ä½“æ¥è¯´ï¼Œçº¿ç¨‹è¯»/å†™å…±äº«å˜é‡çš„æ­¥éª¤æ˜¯è¿™æ ·ï¼š</p><ol><li>ä»ä¸»å†…å­˜å¤åˆ¶å…±äº«å˜é‡åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜</li><li>åœ¨å·¥ä½œå†…å­˜ä¸­å¯¹å˜é‡è¿›è¡Œå¤„ç†</li><li>å¤„ç†å®Œåï¼Œå°†å˜é‡å€¼æ›´æ–°å›ä¸»å†…å­˜</li></ol><p>å‡è®¾ç°åœ¨ä¸»å†…å­˜ä¸­æœ‰å…±äº«å˜é‡ Xï¼Œ å…¶åˆå§‹å€¼ä¸º 0</p><p>çº¿ç¨‹1å…ˆè®¿é—®å˜é‡ Xï¼Œ å¥—ç”¨ä¸Šé¢çš„æ­¥éª¤å°±æ˜¯è¿™æ ·ï¼š</p><ol><li>L1 å’Œ L2 ä¸­éƒ½æ²¡æœ‰å‘ç°å˜é‡ Xï¼Œç›´åˆ°åœ¨ä¸»å†…å­˜ä¸­æ‰¾åˆ°</li><li>æ‹·è´å˜é‡ X åˆ° L1 å’Œ L2 ä¸­</li><li>åœ¨ L1 ä¸­å°† X çš„å€¼ä¿®æ”¹ä¸º1ï¼Œå¹¶é€å±‚å†™å›åˆ°ä¸»å†…å­˜ä¸­</li></ol><p>æ­¤æ—¶ï¼Œåœ¨çº¿ç¨‹ 1 çœ¼ä¸­ï¼ŒX çš„å€¼æ˜¯è¿™æ ·çš„ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgjmm-thread1-111.png" alt=""></fancybox></p><p>æ¥ä¸‹æ¥ï¼Œçº¿ç¨‹ 2 åŒæ ·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è®¿é—®å˜é‡ X </p><ol><li>L1 ä¸­æ²¡æœ‰å‘ç°å˜é‡ X</li><li>L2 ä¸­å‘ç°äº†å˜é‡X</li><li>ä»L2ä¸­æ‹·è´å˜é‡åˆ°L1ä¸­</li><li>åœ¨L1ä¸­å°†X çš„å€¼ä¿®æ”¹ä¸º2ï¼Œå¹¶é€å±‚å†™å›åˆ°ä¸»å†…å­˜ä¸­</li></ol><p>æ­¤æ—¶ï¼Œçº¿ç¨‹ 2 çœ¼ä¸­ï¼ŒX çš„å€¼æ˜¯è¿™æ ·çš„ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgjmm-thread2-111.png" alt=""></fancybox></p><p>ç»“åˆåˆšåˆšçš„ä¸¤æ¬¡æ“ä½œï¼Œå½“çº¿ç¨‹1å†è®¿é—®å˜é‡xï¼Œæˆ‘ä»¬çœ‹çœ‹æœ‰ä»€ä¹ˆé—®é¢˜ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgjmm-thread1and222.png" alt=""></fancybox></p><p>æ­¤åˆ»ï¼Œå¦‚æœçº¿ç¨‹ 1 å†æ¬¡å°† x=1å›å†™ï¼Œå°±ä¼šè¦†ç›–çº¿ç¨‹2 x=2 çš„ç»“æœï¼ŒåŒæ ·çš„å…±äº«å˜é‡ï¼Œçº¿ç¨‹æ‹¿åˆ°çš„ç»“æœå´ä¸ä¸€æ ·ï¼ˆçº¿ç¨‹1çœ¼ä¸­x=1ï¼›çº¿ç¨‹2çœ¼ä¸­x=2ï¼‰ï¼Œè¿™å°±æ˜¯å…±äº«å˜é‡å†…å­˜ä¸å¯è§çš„é—®é¢˜ã€‚</p><p>æ€ä¹ˆè¡¥å‘å‘¢ï¼Ÿä»Šå¤©çš„ä¸¤ä½ä¸»è§’é—ªäº®ç™»åœºï¼Œä¸è¿‡åœ¨è¯´æ˜ volatileå…³é”®å­—ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´è¯´ä½ æœ€ç†Ÿæ‚‰çš„ synchronized å…³é”®å­—</p><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h3><p>é‡åˆ°çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼Œä¹ æƒ¯æ€§çš„ä¼šæƒ³åˆ°ç”¨ synchronized å…³é”®å­—æ¥è§£å†³é—®é¢˜ï¼Œæš‚ä¸”å…ˆä¸è®ºè¯¥åŠæ³•æ˜¯å¦åˆç†ï¼Œæˆ‘ä»¬æ¥çœ‹ synchronized å…³é”®å­—æ˜¯æ€ä¹ˆè§£å†³ä¸Šé¢æåˆ°çš„å…±äº«å˜é‡å†…å­˜å¯è§æ€§é—®é¢˜çš„</p><ul><li>ã€è¿›å…¥ã€‘synchronized å—çš„å†…å­˜è¯­ä¹‰æ˜¯æŠŠåœ¨ synchronized å—å†…ä½¿ç”¨çš„å˜é‡ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­æ¸…é™¤ï¼Œä»ä¸»å†…å­˜ä¸­è¯»å–</li><li>ã€é€€å‡ºã€‘synchronized å—çš„å†…å­˜è¯­ä¹‰äº‹æŠŠåœ¨ synchronized å—å†…å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</li></ul><p>äºŒè¯ä¸è¯´ï¼Œæ— æƒ…å‘ä¸‹çœ‹ volatile</p><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p>å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸º volatile æ—¶ï¼š</p><ul><li>çº¿ç¨‹åœ¨ã€è¯»å–ã€‘å…±äº«å˜é‡æ—¶ï¼Œä¼šå…ˆæ¸…ç©ºæœ¬åœ°å†…å­˜å˜é‡å€¼ï¼Œå†ä»ä¸»å†…å­˜è·å–æœ€æ–°å€¼</li><li>çº¿ç¨‹åœ¨ã€å†™å…¥ã€‘å…±äº«å˜é‡æ—¶ï¼Œä¸ä¼šæŠŠå€¼ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–å…¶ä»–åœ°æ–¹ï¼ˆå°±æ˜¯åˆšåˆšè¯´çš„æ‰€è°“çš„ã€Œå·¥ä½œå†…å­˜ã€ï¼‰ï¼Œè€Œæ˜¯ä¼šæŠŠå€¼åˆ·æ–°å›ä¸»å†…å­˜</li></ul><p>æœ‰ç§æ¢æ±¤ä¸æ¢è¯çš„æ„Ÿè§‰ï¼Œä½ çœ‹çš„ä¸€ç‚¹éƒ½æ²¡é”™</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200302134932.png" alt=""></fancybox></p><p>æ‰€ä»¥ï¼Œå½“ä½¿ç”¨ synchronized æˆ– volatile åï¼Œå¤šçº¿ç¨‹æ“ä½œå…±äº«å˜é‡çš„æ­¥éª¤å°±å˜æˆäº†è¿™æ ·ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage-20200302140442742.png" alt=""></fancybox></p><p><strong>ç®€å•ç‚¹æ¥è¯´å°±æ˜¯ä¸å†å‚è€ƒ L1 å’Œ L2 ä¸­å…±äº«å˜é‡çš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥è®¿é—®ä¸»å†…å­˜</strong></p><p>æ¥ç‚¹è¸å®çš„ï¼Œä¸Šä¾‹å­ğŸŒ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadNotSafeInteger</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…±äº«å˜é‡ value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.value = value;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡å‰åºåˆ†æé“ºå«ï¼Œå¾ˆæ˜æ˜¾ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œå…±äº«å˜é‡ value å­˜åœ¨å¤§å¤§çš„éšæ‚£ï¼Œå°è¯•å¯¹å…¶ä½œå‡ºä¸€äº›æ”¹å˜</p><p>å…ˆä½¿ç”¨ volatile å…³é”®å­—æ”¹é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadSafeInteger</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…±äº«å˜é‡ value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.value = value;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ä½¿ç”¨ synchronized å…³é”®å­—æ”¹é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadSafeInteger</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…±äº«å˜é‡ value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.value = value;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªç»“æœæ˜¯å®Œå…¨ç›¸åŒï¼Œåœ¨è§£å†³ã€å½“å‰ã€‘å…±äº«å˜é‡æ•°æ®å¯è§æ€§çš„é—®é¢˜ä¸Šï¼ŒäºŒè€…ç®—æ˜¯ç­‰åŒçš„</p><p>å¦‚æœè¯´ synchronized å’Œ volatile æ˜¯å®Œå…¨ç­‰åŒçš„ï¼Œé‚£å°±æ²¡å¿…è¦è®¾è®¡ä¸¤ä¸ªå…³é”®å­—äº†ï¼Œç»§ç»­çœ‹ä¸ªä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityIssue</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOTAL = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å³ä¾¿åƒä¸‹é¢è¿™æ ·åŠ äº† volatile å…³é”®å­—ä¿®é¥°ä¸ä¼šè§£å†³é—®é¢˜ï¼Œå› ä¸ºå¹¶æ²¡æœ‰è§£å†³åŸå­æ€§é—®é¢˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">VisibilityIssue visibilityIssue = <span class="keyword">new</span> VisibilityIssue();</span><br><span class="line"></span><br><span class="line">Thread thread1 = <span class="keyword">new</span> Thread(() -&gt; visibilityIssue.add10KCount());</span><br><span class="line">Thread thread2 = <span class="keyword">new</span> Thread(() -&gt; visibilityIssue.add10KCount());</span><br><span class="line"></span><br><span class="line">thread1.start();</span><br><span class="line">thread2.start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">thread1.join();</span><br><span class="line">thread2.join();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">log.error(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"count å€¼ä¸ºï¼š&#123;&#125;"</span>, visibilityIssue.count);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add10KCount</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (start ++ &lt; TOTAL)&#123;</span><br><span class="line"><span class="keyword">this</span>.count ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯å°†ä¸Šé¢setValue ç®€å•èµ‹å€¼æ“ä½œ ï¼ˆthis.value = value;ï¼‰å˜æˆäº†  ï¼ˆthis.count ++;ï¼‰å½¢å¼ï¼Œå¦‚æœä½ è¿è¡Œä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œcountçš„å€¼å§‹ç»ˆæ˜¯å¤„äº1wå’Œ2wä¹‹é—´çš„</p><p>å°†ä¸Šé¢æ–¹æ³•å†ä»¥ synchronized çš„å½¢å¼åšæ”¹åŠ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityIssue</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOTAL = <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//... åŒä¸Š</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add10KCount</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (start ++ &lt; TOTAL)&#123;</span><br><span class="line"><span class="keyword">this</span>.count ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œä»£ç ï¼Œcount ç»“æœå°±æ˜¯ 2w</p><p>ä¸¤ç»„ä»£ç ï¼Œéƒ½é€šè¿‡ volatile å’Œ synchronized å…³é”®å­—ä»¥åŒæ ·å½¢å¼ä¿®é¥°ï¼Œæ€ä¹ˆæœ‰çš„å¯ä»¥å¸¦æ¥ç›¸åŒç»“æœï¼Œæœ‰çš„å´ä¸èƒ½å‘¢ï¼Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgwhy.gif" alt=""></p><p>è¿™å°±è¦è¯´è¯´äºŒè€…çš„ä¸åŒäº†</p><blockquote><p>count++  ç¨‹åºä»£ç æ˜¯ä¸€è¡Œï¼Œä½†æ˜¯ç¿»è¯‘æˆ CPU æŒ‡ä»¤ç¡®æ˜¯ä¸‰è¡Œ( ä¸ä¿¡ä½ ç”¨ <code>javap -c</code> å‘½ä»¤è¯•è¯•)</p></blockquote><p>synchronized æ˜¯ç‹¬å é”/æ’ä»–é”ï¼ˆå°±æ˜¯æœ‰ä½ æ²¡æˆ‘çš„æ„æ€ï¼‰ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>add10KCount</code> æ–¹æ³•ï¼Œå…¶ä»–è°ƒç”¨çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚æ‰€ä»¥ä¸‰è¡Œ CPU æŒ‡ä»¤éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¹‹ååˆ«çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè¿™å°±æ˜¯é€šå¸¸è¯´è¯´çš„ <strong>åŸå­æ€§</strong> ï¼ˆçº¿ç¨‹æ‰§è¡Œå¤šæ¡æŒ‡ä»¤ä¸è¢«ä¸­æ–­ï¼‰</p><p>ä½† <strong>volatile æ˜¯éé˜»å¡ç®—æ³•</strong>ï¼ˆä¹Ÿå°±æ˜¯ä¸æ’ä»–ï¼‰ï¼Œå½“é‡åˆ°ä¸‰è¡Œ CPU æŒ‡ä»¤è‡ªç„¶å°±ä¸èƒ½ä¿è¯åˆ«çš„çº¿ç¨‹ä¸æ’è¶³äº†ï¼Œè¿™å°±æ˜¯é€šå¸¸æ‰€è¯´çš„ï¼Œ<strong>volatile èƒ½ä¿è¯å†…å­˜å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§</strong></p><p>ä¸€å¥è¯ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰èƒ½ç”¨volatileå…³é”®å­—å‘¢ï¼Ÿï¼ˆåƒä¸‡è®°ä½äº†ï¼Œé‡è¦äº‹æƒ…è¯´ä¸‰éï¼Œæ„Ÿè§‰è¿™å¥è¯è¿‡æ—¶äº†ï¼‰</p><blockquote><p>å¦‚æœå†™å…¥å˜é‡å€¼ä¸ä¾èµ–å˜é‡å½“å‰å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ volatile </p><p>å¦‚æœå†™å…¥å˜é‡å€¼ä¸ä¾èµ–å˜é‡å½“å‰å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ volatile </p><p>å¦‚æœå†™å…¥å˜é‡å€¼ä¸ä¾èµ–å˜é‡å½“å‰å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ volatile </p></blockquote><p>æ¯”å¦‚ä¸Šé¢ count++ ï¼Œæ˜¯è·å–-è®¡ç®—-å†™å…¥ä¸‰æ­¥æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¾èµ–å½“å‰å€¼çš„ï¼Œæ‰€ä»¥ä¸èƒ½é volatile è§£å†³é—®é¢˜</p><blockquote><p>åˆ°è¿™é‡Œï¼Œæ–‡ç« å¼€å¤´ç¬¬ä¸€ä¸ªé—®é¢˜ã€volatile ä¸ synchronized åœ¨å¤„ç†å“ªäº›é—®é¢˜æ˜¯ç›¸å¯¹ç­‰ä»·çš„ï¼Ÿã€‘ç­”æ¡ˆå·²ç»æ­æ™“äº†</p></blockquote><p>å…ˆè‡ªå·±è„‘è¡¥ä¸€ä¸‹ï¼Œå¦‚æœè®©ä½ åŒä¸€æ®µæ—¶é—´å†…ã€å†™å‡ è¡Œä»£ç ã€‘å°±è¦å»ã€æ•°é’±ã€‘ï¼Œæ•°å‡ ä¸‹é’±å°±è¦å»ã€å”±æ­Œã€‘ï¼Œå”±å®Œæ­Œåˆè¦å»ã€å†™ä»£ç ã€‘ï¼Œåå¤é¢‘ç¹è¿™æ ·æ“ä½œï¼Œè¿˜è¦æ¥ä¸Šä¸Šä¸€æ¬¡çš„æ“ä½œï¼ˆä»£ç æ¥ç€å†™ï¼Œé’±ç´¯åŠ ç€æ•°ï¼Œæ­Œæ¥ç€å”±ï¼‰è¿˜éœ€è¦ä¿è¯ä¸å‡ºé”™ï¼Œä½ ç´¯ä¸ç´¯ï¼Ÿ</p><p>synchronized æ˜¯æ’ä»–çš„ï¼Œçº¿ç¨‹æ’é˜Ÿå°±è¦æœ‰åˆ‡æ¢ï¼Œè¿™ä¸ªåˆ‡æ¢å°±å¥½æ¯”ä¸Šé¢çš„ä¾‹å­ï¼Œè¦å®Œæˆåˆ‡æ¢ï¼Œè¿˜å¾—è®°å‡†çº¿ç¨‹ä¸Šä¸€æ¬¡çš„æ“ä½œï¼Œå¾ˆç´¯CPUå¤§è„‘ï¼Œè¿™å°±æ˜¯é€šå¸¸è¯´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šå¸¦æ¥å¾ˆå¤§å¼€é”€</p><p>volatile å°±ä¸ä¸€æ ·äº†ï¼Œå®ƒæ˜¯éé˜»å¡çš„æ–¹å¼ï¼Œæ‰€ä»¥åœ¨è§£å†³å…±äº«å˜é‡å¯è§æ€§é—®é¢˜çš„æ—¶å€™ï¼Œvolatile å°±æ˜¯ synchronized çš„å¼±åŒæ­¥ä½“ç°äº†</p><blockquote><p>åˆ°è¿™ï¼Œæ–‡ç« çš„ç¬¬äºŒä¸ªé—®é¢˜ã€ä¸ºä»€ä¹ˆè¯´ volatile æ˜¯ synchronized å¼±åŒæ­¥çš„æ–¹å¼ï¼Ÿã€‘ä½ ä¹Ÿåº”è¯¥æ˜ç™½äº†å§</p></blockquote><p>volatile é™¤äº†è¿˜èƒ½è§£å†³å¯è§æ€§é—®é¢˜ï¼Œè¿˜èƒ½è§£å†³ç¼–è¯‘ä¼˜åŒ–é‡æ’åºé—®é¢˜ï¼Œä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»è¿‡ï¼Œè¯·å¤§å®¶ç‚¹å‡»é“¾æ¥è‡ªè¡ŒæŸ¥çœ‹å°±å¥½ï¼ˆé¢è¯•å¸¸é—®çš„åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹Ÿå¯ä»¥åœ¨é‡Œé¢æ‰¾åˆ°ç­”æ¡ˆå“¦ï¼‰ï¼š</p><ul><li><a href="https://dayarch.top/p/java-concurrency-happens-before-rule.html">æœ‰åºæ€§å¯è§æ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://dayarch.top/p/java-concurrency-volatile.html">é¢è¯•volatileå…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…·å¤‡å“ªäº›è°ˆèµ„ï¼Ÿ</a></li></ul><blockquote><p>çœ‹å®Œè¿™ä¸¤ç¯‡æ–‡ç« ï¼Œç›¸ä¿¡ç¬¬ä¸‰ä¸ªé—®é¢˜ä¹Ÿå°±è¿åˆƒè€Œè§£äº†</p></blockquote><p>äº†è§£äº†è¿™äº›ï¼Œç›¸ä¿¡ä½ ä¹Ÿå°±æ‡‚å¾—å¦‚ä½•ä½¿ç”¨äº†</p><p><strong>ç²¾æŒ‘ç»†é€‰ï¼Œç»ˆäºæ•´ç†å®Œåˆç‰ˆ Java æŠ€æœ¯æ ˆç¡¬æ ¸èµ„æ–™ï¼ŒæŠ¢å…ˆçœ‹å°±å…¬ä¼—å·å›å¤ã€èµ„æ–™ã€‘/ã€666ã€‘å§</strong></p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä½ äº†è§£çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿä¸åŒçš„çŠ¶æ€æµè½¬æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆçº¿ç¨‹æœ‰é€šçŸ¥å”¤é†’æœºåˆ¶ï¼Ÿ</li></ol><p>ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ¥è¯´è¯´ã€å”¤é†’çº¿ç¨‹ä¸ºä»€ä¹ˆå»ºè®®ç”¨notifyAllè€Œä¸å»ºè®®ç”¨notifyå‘¢ï¼Ÿã€‘</p><hr>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> volatile </tag>
            
            <tag> synchronized </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåç«¯çš„æˆ‘åœ¨å­¦Node.js ä½ æ•¢ä¿¡ï¼Ÿ</title>
      <link href="//p/start-to-learn-nodejs.html"/>
      <url>//p/start-to-learn-nodejs.html</url>
      
        <content type="html"><![CDATA[<p>é¡¹ç›®éœ€è¦ï¼Œæˆ‘éœ€è¦å‚¨å¤‡ä¸€äº›Node.js ç›¸å…³çš„çŸ¥è¯†äº†ï¼Œæ•´ä½“æ„Ÿè§‰æ˜¯ä¸€ä»¶å¥½äº‹</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä»å‰ï¼Œæˆ‘ä¹Ÿå†™è¿‡å‰ç«¯ï¼Œä¸è¿‡é‚£ä¼šæœ€å¤šç”¨åˆ°HTML5 +jQueryç›¸å…³æŠ€æœ¯ã€‚ä¹Ÿæ²¡æœ‰å‡†ç¡®çš„æ—¶é—´ç‚¹æ¥åˆ’åˆ†ï¼Œæˆ‘å°±å¿½å¿½æ‚ æ‚ çš„ä¸“æ³¨äºJavaåç«¯äº†</p><p><img src="https://i03piccdn.sogoucdn.com/8c2c3c7fdfc3b299" alt="img"></p><p>åƒç°åœ¨çš„å¤§å‰ç«¯Angularã€VUEã€REACTè¿™äº›å¤§å‰ç«¯æ¡†æ¶æˆ‘åªæ˜¯ç•¥æœ‰äº†è§£ï¼Œå®Œå…¨æ²¡æœ‰ç”¨è¿‡ï¼Œç”¨Nodeä½œä¸ºä¸­é—´æœåŠ¡å™¨ä¹Ÿæ˜¯ç›¸å¯¹é™Œç”ŸçŠ¶æ€ï¼Œé¡¹ç›®ä¸­éœ€è¦ï¼Œæˆ‘æ˜¯ä¸€å®šä¸ä¼šæ”¾è¿‡è¿™ä¸ªå¯ä»¥æ‰å¤´å‘çš„è‰¯æœºï¼ˆæƒ³æ³•å¾ˆç®€ç­”ï¼Œ è·³å‡ºè‡ªå·±çš„èˆ’é€‚åŒºï¼‰</p><p><img src="https://i01piccdn.sogoucdn.com/21c3784942552f15" alt="img"></p><p>æ¯•ç«Ÿè¦åœ¨å®é™…é¡¹ç›®ä¸­å†™Nodeä»£ç çš„ï¼Œè¿™ä¹ˆä¸¥å³»çš„é—®é¢˜æˆ‘æ˜¯è¦è®¤çœŸå¯¹å¾…çš„ï¼Œè¦ä¸ç„¶ä¼šè®©é˜Ÿå‹æ¶ˆè€—å¤ªå¤š WTFs/min èƒ½é‡ï¼ˆè¿™æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿè¯·çœ‹ã€<a href="https://mp.weixin.qq.com/s/K3fHhXbSNAMVEQF_2NHg9g" target="_blank" rel="noopener">è¯»ã€ŠClean Code ä»£ç æ•´æ´ä¹‹é“ã€‹ä¹‹æ„Ÿæ‚Ÿ</a>ã€‘ï¼‰ï¼Œä½œä¸ºä¸€ä¸ªå°ç™½ï¼Œé€šè¿‡å­¦ä¹ ä¸€å°æ®µæ—¶é—´è¿˜æ˜¯æœ‰æ‰€æ”¶è·çš„ï¼Œä¸‹é¢ä¸»è¦è¯´ä¸€ä¸‹æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ï¼Œ<strong>è¯·æœ‰ç»éªŒçš„å¤§ä½¬å¤šæŒ‡æ­£ï¼Œè®©ä¿ºå°‘èµ°ç‚¹å¼¯è·¯å¤šç•™å‡ æ ¹å¤´å‘</strong></p><h2 id="Node-js-å­¦ä¹ "><a href="#Node-js-å­¦ä¹ " class="headerlink" title="Node.js å­¦ä¹ "></a>Node.js å­¦ä¹ </h2><p>å’Œå¤§å®¶ä¸€æ ·ï¼Œæˆ‘ä¹Ÿæ˜¯å„ç§ä¸Šç½‘æŸ¥é˜…èµ„æ–™ï¼Œè¿™é‡Œå°†ç›®å‰çš„å­¦ä¹ è¿‡ç¨‹åšä¸ªç®€å•çš„è®°å½•</p><h3 id="Node-js-å®˜ç½‘"><a href="#Node-js-å®˜ç½‘" class="headerlink" title="Node.js å®˜ç½‘"></a><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js å®˜ç½‘</a></h3><p>å­¦ä¹ ä¸€æ ·ä¸œè¥¿ï¼Œç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯å…ˆæ‰“å¼€å®˜ç½‘ï¼Œè¿™é‡Œæ ¹æ­£è‹—çº¢ï¼Œä¸ä¼—ä¸åŒ</p><p>ä¼˜ç‚¹ï¼šå¾ˆå¿«å¯ä»¥æœ‰ä¸€ä¸ªç›¸å¯¹ç›´è§‚çš„äº†è§£ï¼Œæ–‡æ¡£ä¸APIé½å…¨</p><p>ç¼ºç‚¹ï¼šè¿™é‡Œçš„è‹—å¤ªæ­£äº†ï¼Œã€äº‹ä»¶é©±åŠ¨ã€æ„å»ºåœ¨V8å¼•æ“ã€‘ç­‰é™Œç”Ÿè¯æ±‡ç›´æ¥è®©æˆ‘çœ¼å†’é‡‘æ˜Ÿï¼Œè¿™ç±»è¯è¯­å°±å¥½æ¯”å°æ—¶å€™çˆ¶æ¯å¯¹æˆ‘ä»¬è¯´çš„è¯æ±‡ï¼Œåªæœ‰é•¿å¤§ä¹‹åæ‰ä¼šæ˜ç™½</p><p>é¢å¯¹è¿™äº›é™Œç”Ÿçš„å†…å®¹ï¼Œæˆ‘å¹¶ä¸æ˜¯å¾ˆæ‹…å¿ƒï¼ˆå†…å¿ƒæ‡µçš„ä¸€Pï¼‰ï¼Œç›¸ä¿¡é•¿å¤§åä¼šæ˜ç™½çš„ï¼Œéšæ‰‹æ¯«ä¸ç•™æƒ…æŠŠç½‘ç«™å…³æ‰</p><h3 id="tutorialspoint"><a href="#tutorialspoint" class="headerlink" title="tutorialspoint"></a>tutorialspoint</h3><p><a href="https://www.tutorialspoint.com/index.htm" target="_blank" rel="noopener">tutorialspoint</a> æ˜¯æˆ‘éå¸¸å–œæ¬¢çš„å­¦ä¹ ç½‘ç«™ï¼Œä¸Šé¢æœ‰å¾ˆå¤šæŠ€æœ¯æ•™ç¨‹ï¼Œå…ˆæ¥ä¸ªæˆªå›¾ç§ç§</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200225080943.png" alt=""></p><p>ä¼˜ç‚¹ï¼šæ•™ç¨‹å†…å®¹ç®€å•æ˜äº†ï¼Œå¾ªåºæ¸è¿›ï¼Œæ¡ˆä¾‹ä»£ç é½å…¨</p><p>ç¼ºç‚¹ï¼šè¿™æ˜¯ä¸€ä¸ªè‹±æ–‡ç½‘ç«™</p><p>ï¼ˆ<strong>Tips</strong>: çœ‹è‹±æ–‡æ–‡æ¡£åº”è¯¥æˆä¸ºæˆ‘ä»¬çš„å¿…å¤‡æŠ€èƒ½ä¹‹ä¸€ï¼‰</p><p>ä¸è¦è¢«è‹±æ–‡ç½‘ç«™å“åˆ°ï¼Œå…¶å®æ²¡ä»€ä¹ˆé™Œç”Ÿè¯æ±‡ï¼ŒæŒ‰ç…§<a href="https://www.tutorialspoint.com/nodejs/index.htm" target="_blank" rel="noopener">Node.js æ•™ç¨‹</a> ä»å¤´åˆ°å°¾æ’¸äº†ä¸€éï¼Œæœ‰äº†ç›¸å¯¹å…¨é¢çš„äº†è§£ï¼ŒçŸ¥é“äº†åŸºæœ¬éª¨æ¶å†…å®¹, ä¸€è¾¹æ’¸ä¸€éè®°ç¬”è®°ï¼ˆå¿½ç•¥ç€æ½¦è‰çš„å­—ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgWechatIMG197.jpeg" alt=""></p><p>ä¸­é€”è¿˜æ˜¯æœ‰å¾ˆå¤šä¸ç†è§£çš„å†…å®¹ï¼Œéƒ½ç”¨é»„è‰²çš„ç¬”åœˆäº†å‡ºæ¥ï¼Œæ”¾åœ¨åé¢æ…¢æ…¢æŸ¥é˜…ï¼Œ<strong>ç´§è·Ÿä¸»çº¿ï¼Œä»¥é˜²è‡ªå·±è·‘å</strong></p><h3 id="æå®¢æ—¶é—´-æ…•è¯¾ç½‘"><a href="#æå®¢æ—¶é—´-æ…•è¯¾ç½‘" class="headerlink" title="æå®¢æ—¶é—´/æ…•è¯¾ç½‘"></a>æå®¢æ—¶é—´/æ…•è¯¾ç½‘</h3><p>æ•™å­¦è§†é¢‘æ˜¯å‰è¾ˆå¤šå¹´æµ“ç¼©çš„ç²¾åï¼Œæœ‰äº†ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œæˆ‘ä¼šé€‰æ‹©ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šæ•´ä½“çœ‹ä¸€ä¸‹ã€‚æ—¥å¸¸ä¸»è¦é€šè¿‡ã€æå®¢æ—¶é—´ã€‘å’Œã€æ…•è¯¾ç½‘ã€‘è¿™ä¸¤ä¸ªç½‘ç«™æœç´¢è§†é¢‘èµ„æ–™ï¼Œå…¶ä¸­è¿˜åœ¨æå®¢æ—¶é—´è´­ä¹°äº†ä¸‹é¢çš„è¿™é—¨è¯¾</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgWechatIMG199.jpeg" alt=""></p><p>è¿™é—¨è¯¾çš„åŸºç¡€çŸ¥è¯†è®²çš„ä¸ç®—å¤šï¼Œå‰åºç« èŠ‚ä»¥çŸ³å¤´å‰ªåˆ€å¸ƒçš„ç®€å•æ¸¸æˆæ¥è¯´æ˜Node.jsä¸€äº›ç‰¹æ€§ï¼Œåé¢å®æˆ˜å®ç°æå®¢æ—¶é—´ã€è¯¦æƒ…/åˆ—è¡¨/è¯„è®ºã€‘ç­‰é¡µé¢</p><p>æ¨æµ©è€å¸ˆè®²è§£çš„å¾ˆæ¸…æ™°ï¼Œä¸­é—´ç©¿æ’ç€å¾ˆå¤šå†·å¹½é»˜ï¼Œä½†å¯¹äºå°ç™½çš„æˆ‘æ¥è¯´ï¼Œè¿™é—¨è¯¾çœ‹æ—©äº†ï¼Œé‡Œé¢è®²çš„å¾ˆå¤šå†…å®¹æˆ‘è¿˜ä¸èƒ½ç†è§£ï¼Œä½†æ˜¯é‡Œé¢è¯´çš„ä¸€äº›æ„å»ºæ€æƒ³ï¼Œæ¯”å¦‚CommonJSï¼Œè¿™äº›å†…å®¹è¿˜æ˜¯ååˆ†å—ç”¨çš„ï¼Œè§†é¢‘è¯¾ç¨‹ç›®å‰çœ‹äº†è¶…è¿‡2/3ï¼Œæˆ‘é€‰æ‹©æŒ‰ä¸‹æš‚åœé”®ï¼Œè§‰å¾—æœ‰å¿…è¦å†™ä¸€äº›Demoæ¥ä½¿ç”¨ä¸Šé¢å­¦åˆ°çš„ä¸€äº›çŸ¥è¯†ç‚¹äº†ï¼Œæˆ‘ç›¸ä¿¡å½“æˆ‘å†å›å¤´è¿‡æ¥çœ‹è¿™ä¸ªè§†é¢‘çš„æ”¶è·ä¸€å®šæ˜¯ä¸ä¸€æ ·çš„</p><h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><p>æ¬¢è¿æ¥åˆ°ä¸–ç•Œæœ€å¤§çš„åŒæ€§äº¤å‹ç½‘ç«™ï¼Œæƒ³ä¸åˆ°è¦å†™ä¸€ä¸ªä»€ä¹ˆæ ·çš„Demoï¼Œäºæ˜¯æ¥è¿™é‡Œæœç´¢ä¸€ä¸‹ï¼Œè¿˜çœŸæ‰¾åˆ°äº†è‡ªå»ºåšå®¢çš„å­¦ä¹ æ€§é¡¹ç›®<a href="https://github.com/nswbmw/N-blog" target="_blank" rel="noopener">N-Blog</a> ï¼ˆä½ æœ‰ä»€ä¹ˆéœ€æ±‚å®Œå…¨å¯ä»¥å…ˆæ¥ä¸Šé¢æ‰¾æ‰¾è½®å­çš„ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200225092053.png" alt=""></p><p>æ‰¾é¡¹ç›®æœ‰å‡ çœ‹ï¼š</p><ol><li>commitsçš„æ´»è·ƒåº¦</li><li>æ˜Ÿæ ‡/forkæ•°é‡</li><li>README/wikiç¼–å†™è´¨é‡</li><li>Issueså¤„ç†æƒ…å†µ</li></ol><p>æŒ‰ç…§ä¸Šè¿°å‡ ä¸ªæ ‡å‡†ç¡®è®¤è¿‡çœ¼ç¥ï¼Œè¿™æ˜¯æˆ‘è¦æ‰¾çš„å§‘å¨˜</p><p>è¯¥é¡¹ç›®ä¸»è¦åº”ç”¨ä¸‹é¢å‡ é¡¹æŠ€æœ¯ï¼š</p><ul><li>Node.js: 8.9.1</li><li>MongoDB: 3.4.10</li><li>Express: 4.16.2</li></ul><p>çœ‹æŠ€æœ¯æ ˆï¼Œå°±å¯ä»¥è®¤å®šï¼Œè¿™æ˜¯æ¥è¿‘çœŸå®é¡¹ç›®çš„å­˜åœ¨ï¼Œäºæ˜¯ï¼ŒæŒ‰éƒ¨å°±ç­çš„<strong>æ•²ä»£ç ï¼Œæ•²ä»£ç ï¼Œæ•²ä»£ç </strong>ï¼ˆä¸æ˜¯å¤åˆ¶ç²˜è´´ï¼‰ï¼Œå› ä¸ºæ•²ä»£ç å°±å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œè¿™æ ·ä¹Ÿåœ¨å­¦ä¹ ä¸­é€æ­¥å­¦ä¼šäº†è°ƒè¯•</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200225092721.png" alt=""></p><p>é€šè¿‡ä¸¤å¤©æ—¶é—´ä¹Ÿç»ˆäºåšå‡ºäº†æœ€ç»ˆçš„æ•ˆæœ</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200225093129.png" alt=""></p><p>éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ï¼Œåœ¨å®ç°è¿‡ç¨‹é‡åˆ°äº†å¤ªå¤šé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><ul><li>npmå…¨å±€å®‰è£…æƒé™é—®é¢˜</li><li>Homebrew å®‰è£…MongoDBä¸æ”¯æŒservicesæŒ‡ä»¤é—®é¢˜</li><li>é™Œç”Ÿçš„APIä½¿ç”¨é—®é¢˜</li><li>â€¦â€¦</li></ul><p>åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æˆ‘éƒ½æœ‰åšè®°å½•ï¼ŒåŒæ—¶ç»“åˆé¡¹ç›®å†…å®¹åšäº†ä¸‹é¢è¿™å¼ æ€ç»´å¯¼å›¾ï¼Œåªæœ‰å…¨éƒ¨ç‚¹äº®è¿™äº›å¶å­ï¼Œæ‰èƒ½ç®—æ˜¯åšå®Œäº†è¿™ä¸ªDemoï¼ˆæ›´å¤šç»†èŠ‚å†…å®¹éšè—åœ¨äº†èŠ‚ç‚¹notesé‡Œé¢ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgNode1.png" alt=""></p><p>è¿™ä¸ªæ€ç»´å¯¼å›¾è‚¯å®šä¸æ˜¯æ ‡å‡†çš„Node.js å­¦ä¹ å†…å®¹ï¼Œåªä¸è¿‡æ˜¯åº”å¯¹æˆ‘æœ¬æ¬¡åŸºç¡€çš„å­¦ä¹ ï¼Œåç»­çš„å­¦ä¹ ä¼šä¸æ–­å¯¹è¿™ä¸ªæ€ç»´å¯¼å›¾è¿›è¡Œä¿®æ­£çš„</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½ ä»¥ä¸ºæˆ‘ä»¬å°±å¯ä»¥å½»åº•æŠ›å¼ƒå®˜ç½‘äº†å—ï¼Ÿåœ¨è°ƒè¯•ä¸ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°æŸä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±è¦æœæ–­å›åˆ°å®˜ç½‘æŸ¥çœ‹ï¼Œé‚£é‡Œæœ‰æœ€æƒå¨çš„è§£é‡Šã€‚å¦å¤–ï¼Œå¸¦æœ‰ç›®çš„æ€§çš„æŸ¥çœ‹å®˜ç½‘æ€»æ¯”ä¸€å¤´æ‰è¿›å»èˆ’æœçš„å¤šï¼Œä½ è§‰å¾—å‘¢</p><p>ä¸å…¶è¯´è¿™æ˜¯æˆ‘è¿™å‡ å¤©å­¦ä¹ Node.js æ–¹å¼ï¼Œä¸å¦‚è¯´è¿™æ˜¯æˆ‘å­¦ä¹ æ–°ä¸œè¥¿çš„æ•´ä½“æ–¹æ³•å’Œè·¯çº¿ï¼Œå†™è¿™ç¯‡æ–‡ç« ä¹Ÿæƒ³å€Ÿæ­¤å½“ä¸ªè¯é¢˜å’Œå¤§å®¶èŠèŠï¼Œæ¬¢è¿å¤§å®¶ç•™è¨€æˆ–<a href="https://mp.weixin.qq.com/s/G7BXuZh0Qh1-mE6ts4LJqQ" target="_blank" rel="noopener">è¿›ç¾¤</a>åˆ†äº«å½¼æ­¤çš„å­¦ä¹ æ–¹æ³•/è¯»ä¹¦ç¬”è®°/æŠ€æœ¯äº¤æµç­‰ï¼Œå…±åŒè¿›æ­¥</p><p>éš”ä¸‰å·®äº”ï¼Œæˆ‘ä¹Ÿä¼šè¾“å‡ºä¸€äº›Node.js ç›¸å…³çš„å†…å®¹ï¼Œä½ ä»¥ä¸ºæˆ‘å–œæ–°åŒæ—§äº†ï¼Ÿåœ¨æˆ‘å¿ƒä¸­ï¼ŒJavaä¾æ—§æ˜¯æˆ‘æ€¡çº¢é™¢çš„å¤´ç‰Œï¼ˆæˆ‘å¿…é¡»å® å¥¹ï¼‰</p><p>æœ€åï¼Œ<strong>ä¸è¦æ°¸è¿œå‘†åœ¨è‡ªå·±çš„èˆ’é€‚åŒºï¼Œstay hungryï¼Œ stay foolish</strong></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é—²ç€æ— èŠè€ƒä¸ªPMPç©ç©</title>
      <link href="//p/pmp-certificate.html"/>
      <url>//p/pmp-certificate.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬å·²å°†PMPè€ƒè¯•è®°å½•åœ¨2019å¹´å¹´ç»ˆæ€»ç»“çš„äº‹ä»¶ä¹‹ä¸€é‡Œäº†ï¼Œæ˜¥èŠ‚æœ‰æœ‹å‹é—®æˆ‘ï¼Œæƒ³è®©æˆ‘åˆ†äº«ä¸€ä¸‹ï¼Œæˆ‘å›æƒ³äº†æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æŒºæœ‰è¶£çš„ï¼Œäºæ˜¯æœ¬æ–‡å°±ä»¥çºªå®çš„å½¢å¼å†™å†™è€ƒPMPçš„é‚£ç‚¹äº‹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç§èŠï¼Œé¿å…è¯´å¹¿å‘Š</p><p>PMPï¼ˆProject Management Professionalï¼‰å­¦åã€Œé¡¹ç›®ç®¡ç†ä¸“å®¶ã€ï¼Œæˆ‘å«å®ƒã€Œæ‹é©¬å±ã€ã€‚2019å¹´4æœˆçš„æ—¶å€™åœ¨æœ‹å‹åœˆçœ‹åˆ°æœ‰ä¸¤ä½æœ‹å‹å…ˆåã€æ³¨æ„æ˜¯å…ˆåï¼Œæœ‰åŸ‹ä¼ã€‘æ™’å‡ºæ¥PMPçš„è¯ä»¶å‡ºæ¥ï¼Œçœ‹ç€æŒºå¥½çœ‹çš„ï¼ˆæ–‡æœ«æœ‰ï¼Œè¿˜æ˜¯çºªå¿µç‰ˆï¼Œè¿™ä¸ªç†ç”±å¥½ç‰µå¼ºï¼‰ï¼Œå°±æœæ–­å»éªšæ‰°äº†ä»–ä»¬è¯¢é—®å…·ä½“æƒ…å†µ</p><p>æœ‹å‹Aï¼šæœ‰çš„å…¬å¸è®¤å¯è¿™ä¸ªè¯ä»¶ï¼Œæ²¡äº‹è€ƒä¸ªè¿˜æŒºæœ‰ç”¨çš„ã€‚</p><p>æœ‹å‹Bï¼šè€ƒè¯•é™©è¿‡ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼Œæœ‰æœ‹å‹è€ƒï¼Œä¸€èµ·è·Ÿç€è€ƒäº†</p><p>å¿ƒæƒ³ï¼Œæ¯•ä¸šåå¥½ä¹…éƒ½æ²¡è€ƒè¿‡è¯•ï¼Œä¸èƒ½è‡ªåºŸæ­¦åŠŸï¼ŒæŠŠä»å°åŸ¹å…»çš„è€ƒè¯•æŠ€èƒ½ï¼ˆè€ƒè¯•åº”è¯¥æ˜¯ä¸­å›½å­©å­çš„ç«¥å­åŠŸå§ï¼‰è’åºŸæ‰ï¼Œå°±è¿™æ ·åœ¨å†…å¿ƒä¸­äº†è¦è€ƒè¿™ä¸ªè¯ä»¶çš„è‰</p><p>äººéš¾å…æœ‰å†²åŠ¨å’Œæ‹–å»¶ç—‡ï¼Œæˆ‘ä¹Ÿä¸ä¾‹å¤–ï¼Œè½¬çœ¼é—´æ¥åˆ°äº†8æœˆï¼Œå…¬å¸é£˜æ¥ä¸€å°é‚®ä»¶ï¼Œè€ƒXXè¯ä»¶å¯ä»¥æŠ¥é”€ï¼Œç‚çƒ­çš„å¤å­£æˆ‘ç¬é—´ç²¾ç¥äº†ä¸€ç‚¹ï¼Œæˆ‘æ˜¯ä¸ªä¿—äººï¼Œè€ƒè¯•è´¹ç”¨æŒºè´µçš„ï¼Œå¥½å‡ Kå‘¢ï¼Œæ—¢ç„¶å…¬å¸èƒ½ç»™æŠ¥é”€å¾ˆå¤šï¼Œé‚£å°±ç€æ‰‹å®‰æ’å‘—</p><p>æˆ‘è¿˜æ˜¯æƒ³çœç‚¹è´¹ç”¨ï¼Œæˆ‘å°±åˆæ‰¾æœ‹å‹Aç¡®è®¤æ˜¯å¦å¯ä»¥è‡ªå­¦</p><p>æœ‹å‹Aï¼šèƒ½è‡ªå­¦ï¼Œä½†æ˜¯å¾ˆéš¾ï¼ˆè¿™å¥è¯å¾ˆPMPå“²å­¦å•Šï¼Œåé¢ä½ å°±æ‡‚äº†ï¼‰</p><p>æˆ‘å†…å¿ƒå…¶å®æ˜¯æŠµè§¦åŸ¹è®­ç­çš„ï¼Œæ¯”å¦‚å‰æ®µæ—¶é—´é‚£ä¹ˆå¤§çš„XXè‹±è¯­åŸ¹è®­æœºæ„å°±è·‘è·¯äº†ï¼Œæˆ‘å¤©èµ„å’Œèªæ•ä¸æ­è¾¹ï¼Œé‚£å°±æŒºç€æŠ¥ä¸ªåŸ¹è®­ç­å§ï¼Œæ‰¾åˆ°åŸ¹è®­æœºæ„çš„äººï¼Œç›´æ¥å¾®ä¿¡è½¬è´¦å°±æˆäº†ï¼Œè½¬è´¦çš„é‚£ä¸€åˆ»ï¼Œå†…å¿ƒå¼ºçƒˆçš„ç—›äº†ä¸€ä¸‹</p><p>è¿™ä¸ªèŠ‚ç‚¹æŠ¥åï¼Œåªèƒ½æŠ¥è€ƒ12æœˆ7å·çš„è€ƒè¯•äº†ï¼ˆåº”è¯¥æ˜¯æ¯å¹´3/6/9/12æœˆä»½éƒ½æœ‰è€ƒè¯•ï¼‰ï¼Œè¢«åŸ¹è®­è€å¸ˆæ‹‰åˆ°ä¸€ä¸ªå¾®ä¿¡ç¾¤ä¸­ï¼ŒæŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•åœ¨PMIç½‘ç«™ä¸Šæ³¨å†ŒæŠ¥åç­‰ï¼Œé’±é‚£ä¹ˆè´µï¼Œå¡«å†™æŠ¥è€ƒä¿¡æ¯å¼‚å¸¸è°¨æ…ï¼Œé«˜è€ƒéƒ½æ˜¯éšä¾¿å¡«çš„</p><p>æ²¡å‡ å¤©ï¼Œå°±æ”¶åˆ°äº†åŸ¹è®­æœºæ„å‘æ¥çš„èµ„æ–™ï¼ˆå…¶å®ä¸»è¦æ˜¯ç”µå­ç‰ˆ/çº¸è´¨ç‰ˆçš„ä¹¦ï¼‰ï¼Œä½œä¸ºJavaç¨‹åºå‘˜ï¼Œæˆ‘ä¸€ç›´ä¿ç•™ç€é‚£æœ¬å·²ç»æ³›é»„çš„ç¥ä¹¦ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ï¼Œæˆ‘æŠŠPMPçš„ä¹¦å’Œè¿™æœ¬ä¹¦æ”¾åœ¨ä¸€èµ·å¯¹æ¯”ä¸€ä¸‹è‡ªå·±ä½“ä¼šå§</p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200210215306.png" style="zoom:50%;" /><p>æœºæ„è€å¸ˆè¯´ï¼šå›½åº†å‡æœŸæœ€å¥½è‡ªå·±ä»å¤´åˆ°å°¾çœ‹ä¸€éï¼Œæœ€å·®ä¹Ÿè¦çœ‹å‰ä¸‰å¼ ï¼Œçœ‹ä¸æ‡‚ä¹Ÿè¦ç¡¬çœ‹ï¼ŒèŠ‚åå°±è¦å»æœºæ„ä¸Šè¯¾äº†ï¼Œè®²è¯¾èŠ‚å¥ä¼šå¾ˆå¿«</p><p>åŸ¹è®­è´¹æ•™äº†è®©æˆ‘è‡ªå·±å­¦æˆ‘æ˜¯è‚¯å®šä¸å¹²çš„ï¼Œæˆ‘ä¸æ˜¯äºäº†ğŸ˜‚ï¼Œå…¶å®æˆ‘å‡æœŸçœŸçš„ç¡¬ç€å¤´çš®çœ‹äº†ï¼Œå‹‰å¼ºçœ‹å®Œç¬¬ä¸‰ç« ï¼Œä½†æ˜¯åˆ°åº•çœ‹äº†ä¸ªå•¥æˆ‘ä¹Ÿæµ‘ç„¶ä¸çŸ¥ï¼Œæˆ‘çš„å¤©èµ„æœçœŸæ— æƒ…çš„æ‰“æˆ‘</p><p>æ€»å…±æœ‰8èŠ‚çº¿ä¸‹è¯¾ç¨‹ï¼Œéƒ½æ˜¯å‘¨å…­å‘¨æ—¥çš„å…¨å¤©è¯¾ç¨‹ï¼Œé‚£æ®µæ—¶é—´é¡¹ç›®è¿˜ç‰¹åˆ«å¿™ï¼Œæœ‰ä¸¤æ¬¡å‘¨æœ«çš„åŠ ç­æˆ‘ä¹Ÿæ²¡æœ‰å»ï¼Œå†…å¿ƒè¿˜æ˜¯å¯¹ä¸ä½æˆ‘ç»„å†…çš„å…„å¼Ÿä»¬çš„ã€‚é‚£æ®µæ—¶é—´çš„èŠ‚å¥ï¼Œç®—æ˜¯9N7ï¼ˆNä¸å›ºå®šï¼‰å§</p><p>åŸ¹è®­è¯¾å¦‚æœŸå¼€å§‹ï¼Œæ¯å¤©å†…å®¹å¾ˆæ…¢ï¼ŒåŸ¹è®­è€å¸ˆçš„èƒ½åŠ›ä¸æ˜¯çèƒ¡é—¹çš„ï¼Œæ€»æ˜¯èƒ½å„ç§ç©¿é’ˆå¼•çº¿ï¼Œæ„Ÿè§‰è€å¸ˆéƒ½è¿™æ ·è®²è¯¾ï¼Œå­¦ç”Ÿåº”è¯¥ä¸ä¼šå›°å§ï¼Œåº”å¯¹è€ƒå‰çªå‡»ï¼Œåå‡ èŠ‚è¯¾å°±æ˜¯è¾¹è®²è¯¾è¾¹åšæ¨¡æ‹Ÿé¢˜äº†</p><p>12æœˆ7å·ï¼Œè€ƒè¯•ç»ˆäºåˆ°æ¥ï¼Œè¯´è¯´æœ‰å…³è€ƒè¯•ï¼š</p><p><strong>è€ƒè¯•æ—¶é—´ï¼š</strong>9:00amâ€”â€”13:pmï¼Œä¸­é€”æ²¡æœ‰æš‚åœï¼Œé¢˜å‹å…¨éƒ¨æ˜¯å•é¡¹<strong>é€‰æ‹©é¢˜</strong>ï¼Œæ€»å…±200é“é¢˜ï¼Œè€ƒè¯•åªéœ€è¦å¸¦èº«ä»½è¯ï¼ˆçº¸ï¼Œç¬”ï¼Œè®¡ç®—å™¨ï¼Œæ°´ï¼Œé’Ÿè¡¨ï¼Œè€ƒåœºéƒ½æä¾›ï¼‰</p><p>è€ƒè¯•è€ƒé¢˜éå¸¸çµæ´»ï¼Œç®€å•æ¥è¯´ï¼Œå¦‚æœå››ä¸ªé€‰é¡¹éƒ½å¯¹ï¼Œé€‰æ‹©æœ€å¯¹çš„ï¼›å¦‚æœå››ä¸ªé€‰é¡¹éƒ½é”™ï¼Œé€‰é”™æœ€å°‘çš„é‚£ä¸ªï¼Œç»è¿‡å››ä¸ªå°æ—¶çš„ç…ç†¬è‹¦æˆ˜ï¼Œä¸´è¿‘è€ƒè¯•ç»“æŸå‰10åˆ†é’Ÿæ¶‚å®Œç­”é¢˜å¡ï¼Œè€ƒå®Œå®Œå…¨æ‡µé€¼çŠ¶æ€ï¼Œå› ä¸ºæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œå› ä¸ºå†å±Šè€ƒé¢˜éƒ½ä¸å‘å¸ƒæ ‡å‡†ç­”æ¡ˆï¼Œè€ƒå®Œé¥¿çš„ä¸è¡Œï¼Œå›å®¶ç‹ ç‹ çš„åƒäº†ä¸€é¡¿ï¼Œå…¶ä»–çš„ä¸€åˆ‡å°±çœ‹è¿æ°”å§</p><p>ä¸€ä¸ªæœˆåçš„æŸä¸ªæ—©æ™¨ï¼ŒåŸ¹è®­è€å¸ˆçªç„¶åœ¨ç¾¤é‡Œè¯´å¯ä»¥æŸ¥æˆç»©äº†ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰è€ƒç”Ÿä¸€ä¸‹éƒ½èƒ½æŸ¥åˆ°æˆç»©ï¼Œè€ƒè¯•æˆç»©åˆ†ä¸€å‘¨æ—¶é—´é™†ç»­å…¨éƒ¨å…¬å¸ƒï¼Œä½ å°±è¯´æœ‰å¤šå˜æ€å§ï¼Œç¾¤é‡Œå…¶ä»–æœ‹å‹å·²ç»å‡ºæˆç»©äº†ï¼Œæˆ‘å¿«æŠŠæ‰‹æœºåˆ·çˆ†ä¹Ÿæ²¡æœ‰å¾—åˆ°æˆ‘çš„æˆç»©ï¼Œå¸¦ç€ææ…Œå’Œæ‹…å¿§å¼€å§‹ç¡è§‰</p><p>æ•´å®¿éƒ½åœ¨åšæ¢¦ï¼Œä¸€ä¼šæ²¡è¿‡ï¼Œå“é†’ï¼Œåº†å¹¸è¿™æ˜¯æ¢¦ï¼Œè€ƒè¯•æˆç»©è¿˜æ²¡åˆ°å‘¢ï¼›ä¸€ä¼šè¿‡äº†ï¼Œé«˜å…´çš„é†’äº†ï¼Œé—æ†¾è¿™ä¸ºä»€ä¹ˆæ˜¯ä¸ªæ¢¦ï¼›å¤©è’™è’™äº®ï¼Œå·²å…¨ç„¶æ²¡æœ‰ç¡æ„ï¼Œç¥ˆç¥·å¼ç¿»çœ‹é‚®ä»¶ï¼Œä¸€å°æ–°é‚®ä»¶çš„åˆ°æ¥è®©æˆ‘å¿ƒè·³åŠ å€ï¼ŒCongraâ€¦â€¦ï¼Œç»ˆäºèƒ½è¿‡ä¸ªå¥½å¹´ï¼Œè€ƒè¯•æˆç»©è¿‡äº†ï¼Œè¿˜å¾ˆæ„å¤–ï¼Œå¾—äº†ä¸ª5Aï¼Œè¿˜æ˜¯æ™’ä¸€å¼ å›¾å§</p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200211093712.png" style="zoom:50%;" /><p>èµ¶ä¸ŠPMPè€ƒè¯•å¤šå°‘å‘¨å¹´ï¼Œè¿™ä¸€ç‰ˆè¯ä¹¦å¾ˆç‰¹åˆ«ï¼Œæ˜¯çº¢è‰²æ»´ï¼Œå…¶ä»–çš„éƒ½æ˜¯è“è‰²çš„ï¼Œhiahia</p><p>æ•´ä¸ªè¿‡ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥è¯´è¯´æˆ‘å¯¹PMPçš„çœ‹æ³•ï¼š</p><p>ITè¡Œä¸šç®¡ç†æ¨¡å¼è¶Šæ¥è¶Šæ‰å¹³åŒ–ï¼Œå¾ˆå°‘æœ‰çº¯ç®¡ç†å²—ï¼Œä¹Ÿå¾ˆå°‘æœ‰çº¯æŠ€æœ¯å²—ï¼Œç›¸å¯¹æ¥è¯´æœ‰æŠ€æœ¯çš„ç®¡ç†å²—æ›´å¥½ä¸€äº›ï¼Œå› ä¸ºå¹²ä»€ä¹ˆäº‹å¿ƒä¸­éƒ½æ˜¯æœ‰åº•çš„</p><p>PMPè€ƒè¯•æœ¬èº«æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªå¤‡è€ƒè¿‡ç¨‹é”»ç‚¼çš„é€»è¾‘æ€ç»´ï¼Œä»¥åŠè¦çŸ­æœŸå†…å­¦ä¹ é‚£ä¹ˆåšä¸€æœ¬ä¹¦çš„å†…å®¹çš„å½’çº³èƒ½åŠ›è¿™äº›è½¯æŠ€èƒ½éƒ½æ˜¯éå¸¸å€¼å¾—å­¦ä¹ çš„ï¼Œå•çº¯ç¼–å†™ä»£ç å¾ˆéš¾å­¦ä¹ åˆ°è¿™æ–¹é¢çš„æŠ€èƒ½</p><p>éƒ¨åˆ†å…¬å¸è®¤å¯ï¼Œè¿˜æ˜¯èƒ½åœ¨è–ªæ°´å’Œä¸€äº›å‘å±•ä¸Šå¸¦æ¥ä¸€å®šçš„å¸®åŠ©ï¼Œèƒ½æœ‰å¤šå°‘ï¼Œè¿˜çœ‹è‡ªå·±çš„å®é™…èƒ½åŠ›ï¼Œè€å¸ˆä¹Ÿè¯´ï¼Œæƒ³åšå¥½é¡¹ç›®ç®¡ç†ï¼Œä¸éœéœå‡ ä¸ªé¡¹ç›®ï¼Œå•çº¯è€ƒä¸€ä¸ªè¯å°±æ˜¯çº¸ä¸Šè°ˆå…µï¼Œä»»ä½•é¡¹ç›®è¿‡ç¨‹éƒ½å¾ˆå¤æ‚éš¾åŠ</p><p>å›çœ‹æ•´ä¸ªè€ƒè¯•ï¼Œå…¶å®éš¾åº¦è§‰å¾—ä¸å¤§ï¼Œæˆ‘ä¹Ÿæ˜¯æƒ³å€Ÿæ­¤æœºä¼šé‡æ‹¾è€ƒè¯•æŠ€èƒ½åŒ…ï¼Œä¸ºæ¥ä¸‹æ¥çš„å‡ ä¸ªè€ƒè¯•è®¤è¯ï¼ŒåŒ…æ‹¬Elastic Search æˆ– AWS åšä¸€äº›é“ºå«ï¼Œæ‰¾æ‰¾æ„Ÿè§‰ï¼Œç®—æ˜¯è€ƒè¯•è¯•æ°´å§</p><p>æ¯•ç«Ÿæ˜¯ä¸ºäº†åº”å¯¹è€ƒè¯•æ‹¿ç»“æœï¼Œå¦‚æœæ—¶é—´ä¸å……è£•ï¼Œæ‰¾ä¸ªé è°±çš„åŸ¹è®­æœºæ„è¿˜æ˜¯å€¼å¾—çš„ï¼Œè‡ªå­¦æˆ‘è§‰å¾—æµªè´¹å¾ˆå¤šæ—¶é—´ï¼Œä¸å¦‚å¤šçœ‹çœ‹å…¶ä»–æ–¹ä¾¿çš„ä¸œè¥¿</p><p>åˆ°è¿™é‡Œäº†ï¼Œæœ‰å…´è¶£çš„ç§èŠå§ï¼Œæ¯•ç«Ÿæ¯ä¸ªäººçš„æƒ…å†µè¿˜æ˜¯ä¸ä¸€æ ·æ»´</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 12 æ–°ç‰¹æ€§ä¸€è§ˆ</title>
      <link href="//p/jdk12-new-feature-overview.html"/>
      <url>//p/jdk12-new-feature-overview.html</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><p>ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰ä¸¤ä¸ªæ€æƒ³</p></li><li><p>If you can NOT explain it simply, you do NOT understand it well enough</p></li></ul></blockquote><p>ç°é™†ç»­å°†Demoä»£ç å’ŒæŠ€æœ¯æ–‡ç« æ•´ç†åœ¨ä¸€èµ· <a href="https://github.com/FraserYu/learnings" target="_blank" rel="noopener">Githubå®è·µç²¾é€‰</a>ï¼Œ<strong>æœ¬æ–‡åŒæ ·æ”¶å½•åœ¨æ­¤</strong>ï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»æŸ¥çœ‹ï¼Œè§‰å¾—ä¸é”™ï¼Œè¿˜è¯·StarğŸŒŸ</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgfenge.gif" alt=""></p><p>æ—¥å¸¸å·¥ä½œå¯¹é›†åˆæ“ä½œçœŸçš„å¤ªé¢‘ç¹äº†ï¼Œå‰ç«¯æ—¶é—´å°±å†™è¿‡ä¸€ç¯‡å…³äºJava 12 é›†åˆçš„æ–‡ç«  <a href="https://dayarch.top/p/jdk12-collectors-teeing-api-usage.html">Java12 Collectors.teeing çš„ä½¿ç”¨è¯¦è§£</a> ï¼Œ æœ‰æœ‹å‹ç•™è¨€è¯´è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒå¥½ç”¨ã€‚ä¸ªäººè§‰å¾— Java12è¿˜æœ‰å‡ ä¸ªç‰¹æ€§å¯ä»¥å°è¯•ä½¿ç”¨ï¼Œè¿™ç¯‡æ–‡ç« å°±å‡ºç‚‰äº†</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgJava12_new_feature.png" alt=""></p><p>å¦‚æœä½ ç›®å‰ä½¿ç”¨çš„Javaç‰ˆæœ¬ä¸æ˜¯12ï¼Œä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæ—©å·²ä¸ºä½ å‡†å¤‡å¥½è‰¯æ–¹ï¼Œ<a href="https://dayarch.top/p/multiple-java-management.html">SDKMAN ç»Ÿä¸€çµæ´»ç®¡ç†å¤šç‰ˆæœ¬Java</a> ï¼Œå¯ä»¥è®©ä½ å¿«é€Ÿå„ç§å°é²œæ–°ç‰¹æ€§</p><h2 id="String-API-å˜åŒ–"><a href="#String-API-å˜åŒ–" class="headerlink" title="String API å˜åŒ–"></a>String API å˜åŒ–</h2><h3 id="String-indent"><a href="#String-indent" class="headerlink" title="String.indent()"></a>String.indent()</h3><p><code>indent</code> ã€Œç¼©è¿›ã€è¿™ä¸ªå•è¯å¤§å®¶å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™æ˜¯Java12å¤„ç†å­—ç¬¦ä¸²çš„æ–°åŠŸèƒ½ï¼Œå…ˆæ¥çœ‹æ–¹æ³•å®šä¹‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200209135336.png" alt=""></p><p>è¯¥æ–¹æ³•å¾ˆç®€å•ï¼Œåªæ¥æ”¶ä¸€ä¸ª <code>int</code> ç±»å‹çš„å‚æ•°è¡¨ç¤ºç¼©è¿›å€¼ï¼Œè¿™é‡Œçš„ n æ—¢å¯ä»¥æ˜¯æ­£æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œåªä¸è¿‡æ˜¯å¢åŠ ç©ºæ ¼ <code>space</code> å’Œç§»é™¤ç©ºæ ¼çš„å·®åˆ«ï¼Œæ¥çœ‹ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String result = <span class="string">"foo\nbar\nbar2"</span>.indent(<span class="number">4</span>);</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœæ˜¯è¿™æ ·çš„ï¼ˆè€ƒéªŒçœ¼åŠ›çš„æ—¶å€™åˆ°äº†ï¼Œä»”ç»†çœ‹æˆªå›¾åœ¨IDEä¸­è®¾ç½®çš„ç¼©è¿›å°ç‚¹ç‚¹ğŸ˜œï¼‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200209141352.png" alt=""></p><p>è°ƒç”¨ indent æ–¹æ³•ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦å· <code>\n</code> ï¼Œåœ¨è¯¥æ–¹æ³•çš„å®ç°ä¸­ä¹Ÿæ˜ç¡®ç»™äº†æ³¨é‡Šè¯´æ˜ï¼Œç›®çš„æ˜¯ä¸ºäº†è¡Œç»ˆç»“ç¬¦çš„è§„èŒƒåŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200209153328.png" alt=""></p><p><strong>æ³¨æ„ï¼š</strong>å¯¹äº <code>Tab</code> å°±æ˜¯å½“æˆä¸€ä¸ªå­—ç¬¦æ¥çœ‹åˆ°ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ç¨ä½œä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String result = <span class="string">"foo\nbar\n\tbar2"</span>.indent(<span class="number">4</span>);</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure><p>æ¥çœ‹æ‰“å°ç»“æœï¼Œæ³¨æ„å’Œä¸Šé¢çš„ä¸åŒï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200209153700.png" alt=""></p><p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹</p><h3 id="String-transform"><a href="#String-transform" class="headerlink" title="String.transform()"></a>String.transform()</h3><p><code>transform</code> ã€Œè½¬æ¢ã€ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å­—ç¬¦ä¸²å½¢åŠ¿è½¬æ¢çš„éœ€æ±‚ï¼Œtransformæ–¹æ³•æ¥æ”¶ä¸€ä¸ª Function ç±»å‹çš„å‚æ•°ï¼Œ ç”Ÿæˆä¸€ä¸ªå…¨æ–°å½¢å¼çš„å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; names = List.of( <span class="string">"   Alex"</span>, <span class="string">"brian"</span>);</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; transformedNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (String name : names)&#123;</span><br><span class="line">String transformedName = name.transform(String::strip)</span><br><span class="line"> .transform(StringUtils::toCamelCase);</span><br><span class="line"></span><br><span class="line">transformedNames.add(transformedName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æœ‹å‹å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªå’Œå•çº¯çš„å¯¹å­—ç¬¦ä¸² trim æˆ–è€…å…¶ä»–æ“ä½œæœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿå› ä¸ºæ¥å—çš„å‚æ•°æ˜¯ Functionç±»å‹ï¼Œå½“Functionç±»å‹ä½œä¸ºå…¥å‚æ—¶ï¼Œå†…éƒ¨çš„<strong>å¤„ç†é€»è¾‘</strong>å°†å¢åŠ æ›´å¤šçµæ´»æ€§</p><h2 id="Files-mismatch-Path-Path"><a href="#Files-mismatch-Path-Path" class="headerlink" title="Files.mismatch(Path, Path)"></a>Files.mismatch(Path, Path)</h2><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯å¦ç›¸åŒï¼Œè¿™ä¸ªAPIå°±æ´¾ä¸Šç”¨åœºäº†ï¼Œè¯¥æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ª path ä¸‹çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª long å€¼ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºç¬¬ä¸€å¤„ä¸åŒ¹é…çš„å­—èŠ‚ä½ç½®ã€‚å¦‚æœè¿”å›-1ï¼Œè¯´æ˜ä¸¤ä¸ªæ–‡ä»¶ç›¸ç­‰ï¼Œè¿˜æ˜¯æ¥çœ‹ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Path file1 = Paths.get(<span class="string">"/Users/fraser/Documents/projects/personal/learning-demo-collection/jdk12-demo/src/file1.txt"</span>);</span><br><span class="line">Path file2 = Paths.get(<span class="string">"/Users/fraser/Documents/projects/personal/learning-demo-collection/jdk12-demo/src/file2.txt"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">long</span> mismatch = Files.mismatch(file1, file2);</span><br><span class="line">System.out.println(mismatch);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ–‡ä»¶å†…å®¹åˆ†åˆ«æ˜¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//file1.txt</span><br><span class="line">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ—¥æ‹±ä¸€å…µï¼Œå«æˆ‘æ‹±å“¥å°±å¥½</span><br><span class="line">//file2.txt</span><br><span class="line">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ—¥æ‹±ä¸€å…µï¼Œå«æˆ‘å…µå…µå°±å¥½</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200209203347.png" alt=""></p><blockquote><p>å»ºè®®å¤§å®¶æŸ¥çœ‹ä¸€ä¸‹ <code>mismatch</code> çš„å®ç°é€»è¾‘ï¼Œæœ‰ä¸ªå°ç®—æ³•åœ¨é‡Œé¢çš„</p></blockquote><h2 id="Support-for-Unicode-11-ï¼ˆå½“ä¸ªäº†è§£å°±å¥½äº†ï¼‰"><a href="#Support-for-Unicode-11-ï¼ˆå½“ä¸ªäº†è§£å°±å¥½äº†ï¼‰" class="headerlink" title="Support for Unicode 11 ï¼ˆå½“ä¸ªäº†è§£å°±å¥½äº†ï¼‰"></a>Support for Unicode 11 ï¼ˆå½“ä¸ªäº†è§£å°±å¥½äº†ï¼‰</h2><p>å½“ä¸‹ï¼ŒEmoji è¡¨æƒ…ç¬¦å·åœ¨ç¤¾äº¤åª’ä½“æ¸ é“ä¸Šæ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œæ‰€ä»¥æ”¯æŒæœ€æ–°çš„ Unicode è§„èŒƒæ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´é‡è¦ã€‚Java 12ä¿æŒäº†åŒæ­¥å¹¶æ”¯æŒUnicode 11ã€‚Unicode 11å¢åŠ äº†684ä¸ªå­—ç¬¦ï¼Œå…±137,374ä¸ªå­—ç¬¦ï¼Œå¢åŠ äº†7ä¸ªæ–°è„šæœ¬ï¼Œå…±146ä¸ªè„šæœ¬ã€‚</p><h2 id="Switch-Expressions-Preview"><a href="#Switch-Expressions-Preview" class="headerlink" title="Switch Expressions(Preview)"></a>Switch Expressions(Preview)</h2><p>è¿™ä¸ªæ›´æ”¹æ‰©å±•äº†switchè¯­å¥ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ</p><ul><li>è¯­å¥ï¼ˆæˆ‘ä»¬åŸæ¥é‚£æ ·ä½¿ç”¨ï¼‰</li><li>è¡¨è¾¾å¼ï¼ˆä¸å¿…ä¸ºæ¯ä¸ªcaseå—å®šä¹‰ä¸€ä¸ªbreakè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨ç®­å¤´è¯­æ³•ï¼‰</li><li>å˜é‡èµ‹å€¼ï¼ˆä½¿ç”¨æ–°çš„switchè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†switchè¯­å¥åˆ†é…ç»™ä¸€ä¸ªå˜é‡ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> isWeekend = <span class="keyword">switch</span> (day) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">case</span> MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY -&gt; <span class="keyword">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">case</span> SATURDAY, SUNDAY -&gt; <span class="keyword">true</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">default</span> -&gt; <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Illegal day entry :: "</span> + day);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">System.out.println(isWeekend);</span><br></pre></td></tr></table></figure><blockquote><p> <strong>æ³¨æ„ï¼š</strong> è¦ä½¿ç”¨æ­¤é¢„è§ˆç‰¹æ€§ï¼Œè¯·è®°ä½ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´ä½¿ç”¨-enable-previewæ ‡å¿—æ˜¾å¼åœ°æŒ‡ç¤ºJVMã€‚</p></blockquote><h2 id="Compact-Number-Formatting-ç´§å‡‘çš„æ•°æ®æ ¼å¼"><a href="#Compact-Number-Formatting-ç´§å‡‘çš„æ•°æ®æ ¼å¼" class="headerlink" title="Compact Number Formatting (ç´§å‡‘çš„æ•°æ®æ ¼å¼)"></a>Compact Number Formatting (ç´§å‡‘çš„æ•°æ®æ ¼å¼)</h2><p>ç”±ç”¨æˆ·ç•Œé¢æˆ–å‘½ä»¤è¡Œå·¥å…·å‘ˆç°çš„å¤§æ•°å­—æ€»æ˜¯å¾ˆéš¾å±•ç°ã€‚ä½¿ç”¨æ•°å­—çš„ç¼©å†™å½¢å¼åˆ™è¦ç›´è§‚å¾ˆå¤šã€‚å‰ç«¯ä¸ºäº†æ›´æœ‰å¥½çš„æ•°æ®å±•ç°å½¢å¼ï¼Œå¾ˆæ—©å°±æœ‰ç›¸åº”çš„ç»„ä»¶å®ç°äº†ã€‚ç°åœ¨åç«¯å°ä¼™ä¼´ä¹Ÿå¯ä»¥åœ¨java12ä¸­åº”ç”¨è¿™ä¸ªç‰¹æ€§äº†</p><p>ç´§å‡‘çš„æ•°å­—è¡¨ç¤ºæ›´æ˜“äºé˜…è¯»ï¼Œå¹¶ä¸”åœ¨ä¸ä¸¢å¤±åŸå§‹å«ä¹‰çš„æƒ…å†µä¸‹ï¼Œåœ¨å±å¹•ä¸Šéœ€è¦æ›´å°‘çš„ç©ºé—´ã€‚</p><blockquote><p>ä¾‹å­ï¼š<code>3.6M</code> æ¯” <code>3,600,000</code> å®¹æ˜“è¯»å¾—å¤š</p></blockquote><p>Java 12 å¼•å…¥äº†ä¸€ä¸ªå«åš NumberFormat.getCompactNumberInstance(Locale, NumberFormat.Style)çš„é™æ€æ–¹æ³•ã€‚ç”¨äºåˆ›å»ºç´§å‡‘æ•°å­—è¡¨ç¤ºå½¢å¼ï¼Œæ¥çœ‹ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NumberFormat formatter = NumberFormat.getCompactNumberInstance(Locale.US, NumberFormat.Style.SHORT);</span><br><span class="line"></span><br><span class="line">String formattedString = formatter.format(<span class="number">25000L</span>);</span><br><span class="line">System.out.println(formattedString);</span><br></pre></td></tr></table></figure><p>æ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200210132355.png" alt=""></p><p>å¦å¤–ï¼ŒCompactNumberFormat æ˜¯ NumberFormatçš„å­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å®ƒçš„å®ä¾‹ï¼ˆå…¶å®å°±æ˜¯æ ¼å¼åŒ–æ ·å¼ç­‰ï¼‰ï¼Œå¾ˆç®€å•ï¼Œè¿™ä¸ªå¤§å®¶è‡ªè¡ŒæŸ¥çœ‹å§</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Javaè¿‘ä¸¤å¹´å‡çº§çœŸæ˜¯å¤ªå¿«äº†ï¼Œäº†è§£ä¸€äº›æ–°åŠŸèƒ½æ€»æ˜¯æ²¡é”™çš„ï¼Œå¤§å®¶åŠ¨æ‰‹å®è·µè¯•è¯•å§ï¼Œä»¥åé‡åˆ°ç±»ä¼¼çš„éœ€æ±‚è‡³å°‘èƒ½é¿å…æˆ‘ä»¬é‡å¤é€ è½®å­äº†â€¦..</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä½ ä»¬é¡¹ç›®ä¸­Javaçš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</li><li>é¡¹ç›®ä¸­ä½ ä¼šæ€æ ·å»ºè®®æŸäº›å·¥å…·çš„å‡çº§ï¼Ÿ</li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IntelliJ IDEA HTTP Clienté«˜çº§ä½¿ç”¨è¯¦è§£</title>
      <link href="//p/http-client-advanced-usage.html"/>
      <url>//p/http-client-advanced-usage.html</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><p>ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰ä¸¤ä¸ªæ€æƒ³</p></li><li><p>If you can NOT explain it simply, you do NOT understand it well enough</p></li></ul></blockquote><p>é™†ç»­å°†Demoä»£ç å’ŒæŠ€æœ¯æ–‡ç« æ•´ç†åœ¨ä¸€èµ· <a href="https://github.com/FraserYu/learnings" target="_blank" rel="noopener">Githubå®è·µç²¾é€‰</a>ï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»æŸ¥çœ‹ï¼Œè§‰å¾—ä¸é”™ï¼Œè¿˜è¯·StarğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgfenge.gif" alt=""></p><p>æŠ—å‡»ç–«æƒ…ï¼Œåœ¨å®¶åŠå…¬ã€‚å·¥ä½œç…§å¸¸å¹²ï¼Œé¢†å¯¼éœ€è¦å‡ ä¸ªæ–°åŠŸèƒ½æ¥å£å¼€å‘ã€‚ä»¥å‰åœ¨å…¬å¸åŠå…¬ï¼Œé€šå¸¸å¼€å‘å®Œçš„åŠŸèƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæš´éœ²å‡º Swagger æ¥å£æ–‡æ¡£ï¼Œç›´æ¥æ‰¾æ—è¾¹çš„å‰ç«¯å¤§äººè”è°ƒæµ‹è¯•äº†</p><p>å½“ä¸‹ï¼Œå›åœ¨é•¿æ±Ÿå¤´ï¼Œæˆ‘åœ¨é•¿æ±Ÿå°¾ï¼Œå¤œå¤œæ€å›ä¸æ•¢å‡ºé—¨è§å›å•Šï¼Œä¸€åˆ‡æµ‹è¯•å…¨äº¤ç»™è‡ªå·±å§ï¼Œ</p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206102942.png" style="zoom:50%;" /><p>è™½ç„¶æƒ³å¿µå‰ç«¯ï¼Œä½†æ˜¯åœ¨å®¶åŠå…¬ä¹Ÿç»å¯¹æ˜¯å’Œåœ¨å…¬å¸åŠå…¬ä¸€æ ·ä¸€æ ·çš„ï¼Œé«˜æ•ˆä¸ï¼ˆquï¼‰æ‘¸é±¼</p><h2 id="æ’æ’­èƒŒæ™¯"><a href="#æ’æ’­èƒŒæ™¯" class="headerlink" title="æ’æ’­èƒŒæ™¯"></a>æ’æ’­èƒŒæ™¯</h2><p>åœ¨å¤šä¸ªäº§å“çº¿ä¸Šæ¥å›ç©¿åˆ‡æ¢ç€å¼€å‘åŠŸèƒ½ï¼Œä»¥å‰ç”¨Postmançš„åœºæ™¯æ˜¯è¿™æ ·çš„:</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206110455.png" alt=""></fancybox></p><p>å®é™…è¿œè¿œä¸æ­¢è¿™å‡ ä¸ªæ–‡ä»¶å¤¹æ¥å½’ç±»å¤šä¸ªäº§å“çº¿çš„æ¥å£ï¼ŒPostmançš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯é¢å¯¹ä»¥ä¸‹è¿™äº›çŠ¶å†µæ—¶ï¼Œæˆ‘è§‰å¾—è°ƒè¯•ä¸€ä¸ªæ¥å£å¤ªéº»çƒ¦äº† ï¼ˆè¿™é‡Œä¸è®¨è®ºå·¥å…·çš„å¥½åï¼Œå·¥å…·æ˜¯å¸®åŠ©æˆ‘ä»¬æé«˜æ•ˆç‡çš„ï¼Œæ¯ä¸ªäººçš„éœ€æ±‚ä¹Ÿä¸ä¸€æ ·ï¼Œæˆ‘åªè¯´æ˜æˆ‘ä¸ªäººé‡åˆ°çš„ä¸€äº›æƒ…å†µï¼Œä¸å–œè¯·å‹¿å–·ï¼‰</p><ul><li>æŸ¥æ‰¾é…ç½®å¤šæ•°è¦é€šè¿‡é¼ æ ‡ç‚¹æ¥ç‚¹å», ä¸ä¹ æƒ¯æ–‡æœ¬å’Œå¿«æ·é”®æ“ä½œçš„ä¾¿æ·æ–¹å¼è¿èƒŒ</li><li>è°ƒè¯•åˆ«äººæ¥å£è¦å¯¼å…¥ä»–ä»¬çš„ä¸€äº›æ•°æ®ï¼Œæ¯”è¾ƒéº»çƒ¦</li><li>å¤šä¸ªäº§å“çº¿ç¯å¢ƒå˜é‡æŸ¥çœ‹ä¸ç›´è§‚</li><li>å†™å®Œæ¥å£è¦æ¥å›åˆ‡æ¢åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚ï¼ˆIDEA &lt;â€”â€”&gt; Postmanï¼‰</li><li>å¿«é€Ÿå®šä½æ¥å£æ¯”è¾ƒéº»çƒ¦</li><li>â€¦â€¦</li></ul><p>æ— æ„é—´å‘ç° IntelliJ IDEA çš„ <code>HTTP Client</code> å·¥å…·åˆšå¥½èƒ½è§£å†³æˆ‘ä¸Šé¢æåˆ°çš„ä¸€äº›é—®é¢˜ï¼Œç®€å•çš„è¯´å°±æ˜¯èƒ½ç›´æ¥åœ¨ IDEA çš„ä»£ç ç¼–è¾‘å™¨ä¸­ <code>åˆ›å»ºï¼Œç¼–è¾‘ï¼Œæ‰§è¡Œ</code> HTTPè¯·æ±‚ï¼Œå°±åƒè¿™æ ·(å¦‚æœä½ å¿ƒåŠ¨äº†ï¼Œè¯·ç»§ç»­å‘ä¸‹çœ‹å§)ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img97483310-4556-42b8-ac61-9b127c9aaf05.gif" alt=""></fancybox></p><p>äºæ˜¯ï¼Œå»å®˜ç½‘æŸ¥çœ‹ä¸€ç•ªä½œå‡ºå¦‚ä¸‹æ•´ç†ï¼š</p><h2 id="èµ°è¿›-Http-Client"><a href="#èµ°è¿›-Http-Client" class="headerlink" title="èµ°è¿› Http Client"></a>èµ°è¿› Http Client</h2><p>HTTP Client æ˜¯ IDEA é»˜è®¤ç»‘å®šå¥½å¹¶å¯ç”¨çš„æ’ä»¶ï¼Œå¦‚æœä½ é‚£é‡Œæ²¡æœ‰å¯ç”¨ï¼ŒæŒ‰ç…§ä¸‹å›¾å¯ç”¨å°±å¥½</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206115605.png" alt=""></fancybox></p><p>ç‚¹å‡»èœå•ï¼š<code>Tools</code> â€” <code>HTTP Client</code> â€” <code>Test RESTful Web Service</code></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206112908.png" alt=""></fancybox></p><p>æ¥ä¸‹æ¥è¿›å…¥ä¸‹é¢çš„ç•Œé¢ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206125806.png" alt=""></fancybox></p><p>ä¸Šå›¾å·²ç»™å‡ºæç¤ºï¼ŒREST Client æ˜¯è¢«å¼ƒç”¨çš„ï¼Œç‚¹å‡»å³ä¾§çš„ <code>Convert request to new format</code> , è¿›åˆ°ä¸‹é¢ç•Œé¢ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206132014.png" alt=""></fancybox></p><p>é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªåä¸º <code>rest-api.http</code> çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è¢«å­˜å‚¨åœ¨ Scratches æ–‡ä»¶å¤¹ä¸‹ï¼Œä¸ºäº†çªå‡ºä¸»è§’å…‰ç¯ï¼Œå…³äº <a href="https://www.jetbrains.com/help/idea/scratches.html" target="_blank" rel="noopener">Scratch Files</a> è¯·å®˜ç½‘è‡ªè¡ŒæŸ¥çœ‹ ï¼ˆ<strong>ç»§ç»­å‘ä¸‹çœ‹ä¸å½±å“ç†è§£çš„</strong>ï¼‰ï¼Œé»„è‰²æ¡†çº¿çš„åŠŸèƒ½ä¹Ÿéå¸¸æœ‰ç”¨ï¼Œç»§ç»­å‘ä¸‹çœ‹</p><h2 id="åˆ›å»º-HTTP-request-æ–‡ä»¶"><a href="#åˆ›å»º-HTTP-request-æ–‡ä»¶" class="headerlink" title="åˆ›å»º HTTP request æ–‡ä»¶"></a>åˆ›å»º HTTP request æ–‡ä»¶</h2><p>åˆšåˆšæåˆ°çš„ <code>rest-api.http</code> å°±æ˜¯ HTTP request æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼åˆ›å»ºï¼š</p><ol><li>é€šè¿‡å¿«æ·é”®  <code>â‡§âŒ˜N</code>  ç„¶åé€‰æ‹© <strong>HTTP Request</strong>. ï¼ˆæ–‡ä»¶å­˜æ”¾åœ¨Scratches æ–‡ä»¶å¤¹ï¼‰</li><li>é€šè¿‡èœå•æ“ä½œ Fileâ€”Newâ€”HTTP Request ï¼ˆæ–‡ä»¶å­˜æ”¾åœ¨æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œå°±å’Œæˆ‘ä»¬å¹³æ—¶åˆ›å»ºclass/packageæ˜¯ä¸€æ ·ä¸€æ ·æ»´ï¼‰</li></ol><p>å¦‚æœåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½œä¸ºé¡¹ç›®æ–‡ä»¶ï¼Œé€šè¿‡ Git æäº¤åˆ°ä»“åº“ï¼Œå¤§å®¶å…±äº«æ–‡ä»¶ï¼Œå…±åŒç»´æŠ¤æ¥å£è¯·æ±‚æ•°æ®ï¼Œè‡ªç„¶å°±ä¸ä¼šå‡ºç°è°ƒè¯•åˆ«äººæ¥å£è¿˜è¦å¯¼å…¥ä»–äººæ•°æ®çš„æƒ…å†µå•¦</p><h2 id="ç¼–è¾‘-HTTP-request-æ–‡ä»¶"><a href="#ç¼–è¾‘-HTTP-request-æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘ HTTP request æ–‡ä»¶"></a>ç¼–è¾‘ HTTP request æ–‡ä»¶</h2><p>æˆ‘ä»¬æ¨¡æ‹Ÿå®é™…é¡¹ç›®ä¸­åœºæ™¯æ¥ç¼–è¾‘æ–‡ä»¶</p><ol><li>ç”¨æˆ·ç™»å½•ï¼ŒæˆåŠŸåè·å– Tokenï¼Œé€šå¸¸æ˜¯ POST è¯·æ±‚</li><li>ç”¨æˆ·åç»­è®¿é—®è¡Œä¸ºéƒ½è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ç™»å½•æˆåŠŸè¿”å›çš„ Token</li></ol><p>é€šè¿‡ç‚¹å‡» Add Requestï¼Œé€‰æ‹©ç›¸åº”çš„æ–¹æ³•å°±å¯ä»¥ç¼–å†™å•¦</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206140641.png" alt=""></fancybox></p><p>éƒ½çŸ¥é“ï¼Œé€šå¸¸å†™ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚éœ€è¦å†™å¥½å¤šå†…å®¹ï¼Œè´´å¿ƒçš„ IDEA ç»™æˆ‘ä»¬æä¾›äº†æ¨¡ç‰ˆï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ Examples ä¸­æ‰¾æ¨¡ç‰ˆå°±å¯ä»¥å•¦ï¼Œæ¯”å¦‚æ‰¾ POST è¯·æ±‚çš„æ¨¡ç‰ˆï¼Œé€‰å–åˆé€‚çš„æ‹·è´è¿‡å»å°±å¯ä»¥ï¼Œso easyï½ï½ï½</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206142611.png" alt=""></fancybox></p><p>åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥å‘é€åŸºæœ¬çš„è¯·æ±‚äº†ï¼Œä½†æ˜¯ï¼Œä¸€ä¸ªé¡¹ç›®ä¸­æ¥å£ä¼—å¤šï¼Œå¦‚ä½•å¿«é€Ÿç”Ÿæˆå‚æ•°ï¼Ÿå¦‚ä½•å¿«é€Ÿåˆ‡æ¢ç«¯å£ï¼Ÿå¦‚ä½•è®©ç™»å½•ä¹‹åçš„æ¯ä¸ªè¯·æ±‚è‡ªåŠ¨æºå¸¦æˆåŠŸè¿”å›çš„ Tokenï¼Ÿæˆ‘ä»¬éœ€è¦æ›´é«˜çº§çš„ç©æ³•</p><h2 id="HTTP-Client-è¿›é˜¶ç©æ³•"><a href="#HTTP-Client-è¿›é˜¶ç©æ³•" class="headerlink" title="HTTP Client è¿›é˜¶ç©æ³•"></a>HTTP Client è¿›é˜¶ç©æ³•</h2><h3 id="ä½¿ç”¨ç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨ç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨ç¯å¢ƒå˜é‡"></a>ä½¿ç”¨ç¯å¢ƒå˜é‡</h3><p>åœ¨ç¼–å†™HTTPè¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å˜é‡å¯¹å…¶å…ƒç´ è¿›è¡Œå‚æ•°åŒ–ã€‚å˜é‡å¯ä»¥ä¿å­˜è¯·æ±‚çš„hostã€portå’Œpathã€æŸ¥è¯¢å‚æ•°æˆ–å€¼ã€è¯·æ±‚å¤´å€¼æˆ–è¯·æ±‚ä½“å€¼ç­‰.</p><p>ä½¿ç”¨å˜é‡çš„æ–¹å¼éå¸¸ç®€å•ï¼Œå°±ç”¨ä¸¤ä¸ªå¤§æ‹¬å·åŒ…å›´å®šä¹‰å¥½çš„å˜é‡å°±å¯ä»¥äº†ï¼Œå°±åƒè¿™æ ·ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206145933.png" alt=""></fancybox></p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿè¦æœ‰åœ°æ–¹å®šä¹‰å˜é‡</p><h3 id="å®šä¹‰ç¯å¢ƒå˜é‡"><a href="#å®šä¹‰ç¯å¢ƒå˜é‡" class="headerlink" title="å®šä¹‰ç¯å¢ƒå˜é‡"></a>å®šä¹‰ç¯å¢ƒå˜é‡</h3><p>ç¯å¢ƒå˜é‡éœ€è¦å®šä¹‰åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­ï¼Œç¯å¢ƒæ–‡ä»¶æœ‰ä¸¤ç§ï¼š</p><ol><li>åˆ›å»ºåä¸º <code>rest-client.env.json</code> æˆ–è€… <code>http-client.env.json</code> çš„ç¯å¢ƒæ–‡ä»¶(å…¶å®é‡Œé¢å°±æ˜¯ä¿å­˜ JSON æ•°æ®)ï¼Œè¯¥æ–‡ä»¶é‡Œå¯ä»¥å®šä¹‰ç”¨åœ¨æ•´ä¸ªé¡¹ç›®ä¸Šçš„æ‰€æœ‰å¸¸è§„å˜é‡</li><li>åˆ›å»ºåä¸º<code>rest-client.private.env.json</code> æˆ–è€… <code>http-client.private.env.json</code>ï¼Œ çœ‹æ–‡ä»¶åä½ åº”è¯¥ä¹ŸçŒœåˆ°è¿™æ˜¯ä¿å­˜æ•æ„Ÿæ•°æ®çš„ï¼Œæ¯”å¦‚å¯†ç ï¼Œtokenç­‰ï¼Œè¯¥æ–‡ä»¶é»˜è®¤æ˜¯è¢«åŠ å…¥åˆ° VCS çš„ ignoreæ–‡ä»¶ä¸­çš„ï¼ŒåŒæ—¶ä¼˜å…ˆçº§é«˜äºå…¶ä»–ç¯å¢ƒæ–‡ä»¶ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ–‡ä»¶çš„å˜é‡ä¼šè¦†ç›–å…¶ä»–ç¯å¢ƒæ–‡ä»¶ä¸­çš„å˜é‡å€¼</li></ol><p>é‡Œé¢çš„æ–‡ä»¶å†…å®¹å°±åƒè¿™æ ·</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"dev"</span>: &#123;</span><br><span class="line">    <span class="attr">"host"</span>: <span class="string">"localhost"</span>,</span><br><span class="line">    <span class="attr">"port"</span>: <span class="number">8081</span>,</span><br><span class="line">    <span class="attr">"identifier"</span>: <span class="string">"tanrgyb"</span>,</span><br><span class="line">    <span class="attr">"password"</span>: <span class="string">"iloveu"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"prod"</span>: &#123;</span><br><span class="line">    <span class="attr">"host"</span>: <span class="string">"dayarch.top"</span>,</span><br><span class="line">    <span class="attr">"port"</span>: <span class="number">8080</span>,</span><br><span class="line">    <span class="attr">"identifier"</span>: <span class="string">"admin"</span>,</span><br><span class="line">    <span class="attr">"password"</span>: <span class="string">"admin"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹æˆ‘ä»¬ç¼–å†™çš„è¯·æ±‚å§ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206153120.png" alt=""></fancybox></p><p>IDEAè‡ªåŠ¨è¯†åˆ«å¤šä¸ªç¯å¢ƒï¼Œè¿™æ ·å°±å¯ä»¥è½»è€Œæ˜“ä¸¾çš„åˆ‡æ¢ç¯å¢ƒï¼Œä½¿ç”¨ä¸åŒçš„å˜é‡å€¼äº†ï¼ˆè¿™çš®é‹ï¼Œä½ è¯´äº®ä¸äº®ï¼Œè¿˜æœ‰æ›´äº®çš„ï¼‰</p><h3 id="å·§ç”¨-response-handler-è„šæœ¬"><a href="#å·§ç”¨-response-handler-è„šæœ¬" class="headerlink" title="å·§ç”¨ response handler è„šæœ¬"></a>å·§ç”¨ response handler è„šæœ¬</h3><p>ä¸Šé¢æåˆ°ï¼Œæˆ‘ä»¬è¦è®©ç™»å½•æˆåŠŸåçš„æ‰€æœ‰è¯·æ±‚éƒ½è‡ªåŠ¨æºå¸¦æˆåŠŸè¿”å›çš„ Tokenï¼Œè¿™æ ·ä¸ç”¨æˆ‘ä»¬æ¯æ¬¡éƒ½æ‰‹åŠ¨å°†å…¶æ·»åŠ åˆ°headerä¸­ï¼ŒåŒæ ·æœ‰ä¸¤ç§æ–¹å¼å°†è„šæœ¬æ’å…¥åˆ°è¯·æ±‚ä¸­</p><ul><li>å†…åµŒæ–¹å¼</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET host/api/test</span><br><span class="line"></span><br><span class="line">&gt; &#123;%</span><br><span class="line">response è„šæœ¬</span><br><span class="line">%&#125;</span><br></pre></td></tr></table></figure><ul><li>å¤–éƒ¨æ–‡ä»¶æ–¹å¼ï¼ˆå°±æ˜¯å°†å†…åµŒçš„è„šæœ¬æŠ½ç¦»å‡ºåˆ°æ–‡ä»¶ä¸­ï¼‰</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET host/api/test</span><br><span class="line"></span><br><span class="line">&gt; scripts/my-script.js</span><br></pre></td></tr></table></figure><p>ä»¥ç™»å½•è¿”å›è·å–çš„tokenè®¾ç½®åˆ°å˜é‡ä¸­ä¸ºä¾‹ï¼Œçœ‹ä»£ç ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST http://&#123;&#123;host&#125;&#125;:&#123;&#123;port&#125;&#125;/login</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br><span class="line"></span><br><span class="line">&gt; &#123;%</span><br><span class="line">client.global.set("auth_token", response.body.result.token);</span><br><span class="line"> %&#125;</span><br></pre></td></tr></table></figure><blockquote><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p><code>response.body.result.token</code> æ˜¯æˆ‘æŒ‰ç…§æˆ‘ç™»å½•è¿”å›çš„æ•°æ®ç»“æ„å†™çš„ï¼Œä¸åŒç»“æ„ä¸ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥æ˜¯è¿™æ ·çš„ <code>response.body.token</code> , response.body ä¹‹åæ ¹æ®ä½ çš„æ•°æ®ç»“æ„å‘æŒ¥å§</p></blockquote><p>æˆ‘è¿˜æ˜¯ä¸æ”¾å¿ƒï¼ŒæŠŠæˆ‘çš„ç™»å½•è¿”å›ç»“æ„ï¼ˆé¡¹ç›®ä¸­æ€æ ·è®¾è®¡è¿™ç§ç»“æ„ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰å†™çš„<a href="https://dayarch.top/p/spring-boot-global-return.html">Springbootè¿”å›ç»Ÿä¸€JSONæ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a> )ç²˜è´´åœ¨æ­¤å¤„å§ï¼Œè¿™å›ç†è§£äº†å§ï¼Ÿ</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206155455.png" alt=""></fancybox></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„åœ¨å…¶ä»–è¯·æ±‚ä¸Šæºå¸¦è¿™ä¸ª Token äº†</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206161327.png" alt=""></fancybox></p><blockquote><h4 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>è¿™é‡Œçš„Authorization ç±»å‹ï¼Œå¤§å®¶æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µåšä¿®æ”¹ï¼Œæ¯”å¦‚ï¼šAuthorization:  Bearer </p></blockquote><p>ä»¥ä¸Šè¿™äº›å·²ç»æ»¡è¶³æˆ‘çš„æ—¥å¸¸ä½¿ç”¨ï¼Œæ²¡æœ‰è¿›ä¸€æ­¥äº†è§£æ›´å¤šï¼Œæ›´å¤šå…³äº Response è„šæœ¬çš„ç”¨æ³•è¯·å¤§å®¶æŸ¥çœ‹å®˜ç½‘ <a href="https://www.jetbrains.com/help/idea/http-response-reference.html" target="_blank" rel="noopener">HTTP Response reference</a>å§ </p><p>ä½ ä»¥ä¸ºåˆ°è¿™é‡Œç»“æŸäº†ï¼ˆOMGï¼‰ï¼Œè¿˜æœ‰é¦™æ–™éœ€è¦å’Œå¤§å®¶åˆ†äº«ï¼Œæ­é…ä¸Šé¢åŠŸèƒ½ä½¿ç”¨æ›´æ£’å“¦</p><h2 id="è¾…åŠ©åŠŸèƒ½è¯´æ˜"><a href="#è¾…åŠ©åŠŸèƒ½è¯´æ˜" class="headerlink" title="è¾…åŠ©åŠŸèƒ½è¯´æ˜"></a>è¾…åŠ©åŠŸèƒ½è¯´æ˜</h2><h3 id="RestfulToolkit"><a href="#RestfulToolkit" class="headerlink" title="RestfulToolkit"></a>RestfulToolkit</h3><p>RestfulToolkit åŒæ ·æ˜¯ä¸ªæ’ä»¶ï¼Œåœ¨æ’ä»¶å¸‚åœºæœç´¢å®‰è£…å³å¯</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206163158.png" alt=""></fancybox></p><p>å®‰è£…äº†è¿™ä¸ªæ’ä»¶åï¼Œæ‰“å¼€ä¾§è¾¹æ ï¼Œé¡¹ç›®çš„æ‰€æœ‰æ¥å£ä¿¡æ¯éƒ½ä¼šå±•ç°åœ¨æ­¤å¤„ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206163719.png" alt=""></fancybox></p><p>æˆ‘å¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯æŠŠæŒ‡å®šæ¥å£ç”Ÿæˆçš„JSONæ•°æ®æ‹·è´åˆ° HTTP request æ–‡ä»¶ä¸­ï¼Œå…å»æ‰‹å†™çš„éº»çƒ¦äº†ï¼Œä½ è¯´æ–¹ä¾¿ä¸ï¼Ÿ</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨å¿«æ·é”® <code>cmd+\</code>, å¯ä»¥æ ¹æ®å…³é”®å­—å¿«é€Ÿæ‰¾åˆ°æ¥å£ï¼Œå›è½¦è¿…é€Ÿåˆ°è¾¾ä»£ç æ¥å£ä½ç½®ï¼Œè¿™ä¹Ÿæ˜¯å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206164118.png" alt=""></fancybox></p><h3 id="Live-Template"><a href="#Live-Template" class="headerlink" title="Live Template"></a>Live Template</h3><p>é¡¹ç›®ä¸­è¯·æ±‚å†…å®¹å„æœ‰ä¸åŒï¼ŒIDEAæ ‡å‡†æä¾›çš„GET POST è¯·æ±‚æ¡ˆä¾‹å¯èƒ½è¿˜ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ Live Template å®šåˆ¶è‡ªå·±çš„æ¨¡ç‰ˆï¼Œè¿…é€Ÿç”Ÿæˆrequest å†…å®¹ï¼Œåƒè¿™æ ·ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgb9bb5b55-737f-40f2-aedc-24096909ff26.gif" alt=""></fancybox></p><h3 id="JSON-Viewer"><a href="#JSON-Viewer" class="headerlink" title="JSON Viewer"></a>JSON Viewer</h3><p>JSON Vieweræ˜¯ä¸€æ¬¾ Chromeæµè§ˆå™¨æ’ä»¶ï¼Œåœ¨æµè§ˆå™¨ Omini-box ä¸­è¾“å…¥ <code>json-viewer</code> + <code>Tab</code>, ç²˜è´´jsonåœ¨æ­¤å¤„ï¼Œå°±å¯ä»¥å¯¹jsonæ•°æ®è¿›è¡Œæ ¼å¼åŒ–äº†</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200206164811.png" alt=""></fancybox></p><p>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåœ¨Networkä¸‹åŒå‡»æŸä¸ªHTTPè¯·æ±‚ï¼Œä¼šè‡ªåŠ¨åœ¨ new tabä¸‹æ ¼å¼åŒ–è¿”å›çš„jsonæ•°æ®ï¼Œå…å»äº†ç²˜è´´æ•°æ®ç„¶åæ ¼å¼åŒ–çš„çƒ¦æ¼</p><p>å…³äºè‡ªæµ‹æ¥å£çš„å¹²è´§æˆ‘æŠ–çš„å·®ä¸å¤šäº†ï¼ŒæŠ–æŠ–æ›´å¥åº·</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å†æ¬¡é‡ç”³ï¼Œä¸åšå·¥å…·å…šï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ‰¹åˆ¤ä¹‹æ„ï¼Œå·¥å…·åªæ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ›´é«˜æ•ˆçš„å·¥ä½œï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„ã€‚ä»ä¸Šé¢çš„ä»‹ç»ä¸­æ¥çœ‹ï¼ŒIDEA HTTP client æ­é…æˆ‘è¯´çš„å‡ ä¸ªè¾…åŠ©åŠŸèƒ½å¾ˆå¥½çš„è§£å†³äº†æ–‡ç« å¼€å¤´è¯´æ˜çš„å‡ ä¸ªé—®é¢˜ï¼Œå¯¹æˆ‘ä¸ªäººæƒ…å†µæ¥è¯´ï¼Œè¶³çŸ£ï¼ï¼</p><p><strong>æˆªå›¾ç å­—ä¸æ˜“</strong></p><ul><li><p>å¦‚æœä½ è®¤ä¸ºæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¿˜è¯·ã€Œåœ¨çœ‹/è½¬å‘/èµã€ï¼ˆè¿™å°±æ˜¯é€æˆ‘çš„å¤§ç«ç®­ğŸš€ï¼Œå¤§è·‘è½¦ğŸš—ï¼Œå¤§ç°æœºâœˆï¸ï¼‰</p></li><li><p>å¦‚æœä½ è¿˜å‘ç°äº†æ›´å¥½çš„åŠŸèƒ½è¿˜è¯·è¡¥å……åœ¨ç•™è¨€åŒºï¼Œæˆ‘å›å¤´ç»§ç»­è¡¥å……è¿™å—å†…å®¹ï¼Œä¸‡åˆ†æ„Ÿè°¢</p></li><li><p>å…¬ä¼—å·å›å¤ã€Œå·¥å…·ã€ï¼Œè¿˜æœ‰æ›´ç²¾å½©çš„ç­‰ç€ä½ </p></li></ul><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>Kibanaçš„Dev Toolsç”¨æ¥è°ƒè¯•ESæ¥å£ï¼Œå¯ä»¥å»¶ä¼¸äº†è§£ä¸€ä¸‹</li><li>ä½ åœ¨é¡¹ç›®ä¸­å¦‚ä½•é«˜æ•ˆæµ‹è¯•æ¥å£ä¸è”è°ƒçš„å‘¢ï¼Ÿè¿˜è¯·å¤§æ–¹èµæ•™</li><li>åœ¨å®¶åŠå…¬å’Œå…¬å¸åŠå…¬å¯¹ä½ æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.jetbrains.com/help/idea/testing-restful-web-services.html" target="_blank" rel="noopener">Testing RESTful web servicesï»¿</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IntelliJ IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯»ã€ŠClean Code ä»£ç æ•´æ´ä¹‹é“ã€‹ä¹‹æ„Ÿæ‚Ÿ</title>
      <link href="//p/book-reviews-clean-code.html"/>
      <url>//p/book-reviews-clean-code.html</url>
      
        <content type="html"><![CDATA[<p>ç›²ç›®è‡ªä¿¡ï¼Œè‡ªè®¤ä¸ºå·²ç»æ•²äº†å‡ å¹´ä»£ç ï¼Œè¿˜çœ‹ä»€ä¹ˆæ•´æ´ä¹‹é“å•Šã€‚æˆ‘é‚£å¯çˆ±çš„ä¹¦æ¶è¯»æ‡‚äº†æˆ‘çš„å¿ƒæ€ï¼Œå¾ˆæ˜äº‹ç†çš„ä¿æŠ¤èµ·æ¥è¿™æœ¬å°å¯çˆ±ï¼Œæœªæ›¾è®©å®ƒä¸æˆ‘ç‰µæ‰‹</p><p>æœ€è¿‘é¡¹ç›®ä¸­çš„ bug æœ‰ç‚¹å¤šï¼Œæ”¹åŠ¨ä»£ç ååˆ†åƒåŠ›ï¼Œæ¯çœ‹ä¸€è¡Œä»£ç éƒ½å¸¦ä¸€å¥â€œè¿™æ˜¯ä»€ä¹ˆXXä»£ç å•Šï¼ŒçœŸXXéš¾æ”¹â€ï¼Œè¿™æ ·æŒç»­äº†å¥½å‡ å¤©ï¼Œæœ‰å¤©æ™šä¸Šååœ¨ä¹¦æˆ¿å›æƒ³è¿™å‡ å¤©å‘ç”Ÿçš„ä¸€åˆ‡ï¼Œä»°å¤´å®šç›æ€è€ƒï¼Œæˆ‘ç»ˆäºå’Œå®ƒé‡æ–°ç¡®è®¤äº†çœ¼ç¥ğŸ’—</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204180528.png" alt=""></p><blockquote><p><strong>è‚¡ç¥¨è§æ¶¨ä½ çŸ¥é“ä¹°äº†,  æ±½è½¦æ’å¢™çŸ¥é“æ‹äº†,  å­©å­æ­»äº†ä½ æ¥å¥¶äº†,  å¤§é¼»æ¶•åˆ°å˜´ä½ çŸ¥é“ç”©äº†, bugéš¾æ”¹çŸ¥é“æ„¤æ…¨äº†</strong></p></blockquote><p>é©¬ä¸Šç¿»å¼€ä¹¦ï¼Œå‰è¨€ç« èŠ‚ï¼Œæ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯ä¸‹é¢è¿™ä¸€å¼ å›¾</p><blockquote><p>ä»£ç è´¨é‡çš„å”¯ä¸€æœ‰æ•ˆåº¦é‡æ˜¯ï¼šWTFsï¼ˆwhat the fuckï¼‰/minute </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204135701.png" alt=""></p><p>çœŸçš„å¤ªç²¾è¾Ÿäº†ï¼Œè¿™ä¸å°±æ˜¯è¿™å‡ å¤©æˆ‘ç™½å¤©ç»å†çš„å—ï¼Ÿä»£ç å·²ç„¶æ˜¯ bad code äº†ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆé¢å¯¹è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>æ¯ä¸ªå…¬å¸çš„è§„èŒƒè¿˜ä¸ä¸€æ ·ï¼Œæœ¬æ–‡æ˜¯è¯»ä¹¦ç¬”è®°ï¼Œä¸ä¼šè¯´æ˜å¤ªå¤šçš„ä»£ç è§„èŒƒï¼Œåªæ˜¯é˜æ˜æˆ‘ä»¬åº”è¯¥æ€æ ·åšæˆ–è€…æŠ±ç€ä»€ä¹ˆæ ·çš„å¿ƒæ€æ¥å†™ä»£ç å§</p><p>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘è¦å¼•ç”¨ä¹¦ä¸­çš„ä¸€å¥è¯ï¼š</p><blockquote><p>ç¬¬ä¸€ï¼Œä½ æ˜¯ä¸ªç¨‹åºå‘˜ï¼›ç¬¬äºŒï¼›ä½ æƒ³æˆä¸ºæ›´å¥½çš„ç¨‹åºå‘˜ã€‚æˆ‘ä»¬éœ€è¦æ›´å¥½çš„ç¨‹åºå‘˜</p></blockquote><h2 id="ä¸“ä¸šçš„æ€åº¦"><a href="#ä¸“ä¸šçš„æ€åº¦" class="headerlink" title="ä¸“ä¸šçš„æ€åº¦"></a>ä¸“ä¸šçš„æ€åº¦</h2><p>åšå›½å†…é¡¹ç›®/äº§å“ï¼Œé€šå¸¸éƒ½æ˜¯æŒ‡æ˜deadlineçš„ï¼Œä½†æ˜¯æˆªæ­¢åˆ°deadlineä¹‹å‰ï¼Œéœ€æ±‚é‡çš„å¤šå°‘æ˜¯ä¸å›ºå®šçš„ï¼Œè¯´ç™½äº†æ˜¯â€œä»¥deadlineä¸å˜åº”éœ€æ±‚ä¸‡å˜â€ï¼Œç¾å…¶åæ›°ã€Œæ•æ·ã€</p><p>æˆ‘ä»¬ç»å¸¸è¦é¢å¯¹çŸ­æœŸå†…å¼€å‘å‡ºå¤§é‡éœ€æ±‚çš„è¯·æ±‚ï¼Œå¾ˆå¯èƒ½ä¸ºäº†å¿«é€Ÿå®Œæˆè¿™äº›éœ€æ±‚ï¼Œèƒ¡ä¹±çš„å †å ä»£ç ï¼Œä¸Šçº¿ä¹‹åä¸€å£°é•¿å¹åº†å¹¸è¿™ä¸ªåŠŸèƒ½å¼€å‘çš„ç»“æŸã€‚è¿‡äº†å¥½ä¹…ï¼Œæœ‰å…³è¿™ä¸ªåŠŸèƒ½çš„éœ€æ±‚æœ‰æ‰€å˜åŒ–ï¼Œé‡æ–°æŸ¥çœ‹ä»£ç æ—¶ï¼Œç›´æ¥å°± WTF äº†â€¦â€¦ï¼Œå†ä¸€çœ‹æ˜¯è‡ªå·±å†™çš„ï¼Œä½ è¯´å°´å°¬ä¸ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204173207.png" alt=""></p><p>å¦‚æœæ˜¯å› ä¸ºä»»åŠ¡å¤šèƒ¡ä¹±å åŠ ä»£ç ï¼Œæˆ‘ä»¬å°±åº”è¯¥åœ¨æ¥å—éœ€æ±‚çš„æ—¶å€™æå‡ºæˆ‘ä»¬çš„çœ‹æ³•ï¼š</p><blockquote><p>è¿‡å¤šçš„éœ€æ±‚åœ¨çŸ­æœŸå†…ä¸Šçº¿çš„ä»£ç è´¨é‡ä¸èƒ½å¾—åˆ°ä¿è¯</p></blockquote><p>å‡å¦‚ä½ æ˜¯åŒ»ç”Ÿï¼Œç—…äººè¦æ±‚ä½ ä¸ç”¨æ´—æ‰‹å°±å¯ä»¥ç»™ä»–åšæ‰‹æœ¯ï¼Œå› ä¸ºæ´—æ‰‹æµªè´¹æ—¶é—´ï¼Œä½ ä¼šç­”åº”å—ï¼ŸåŒ»ç”Ÿç»å¯¹ä¼šæ‹’ç»ï¼Œå› ä¸ºä½ æ¯”ç—…äººæ›´äº†è§£ç–¾ç—…å’Œæ„ŸæŸ“çš„é£é™©ã€‚å¦‚æœåŒ»ç”Ÿç…§åšï¼Œé‚£æ˜¯ç»å¯¹ä¸ä¸“ä¸šçš„åšæ³•</p><p><strong>ä½œä¸ºç¨‹åºå‘˜ï¼Œå¦‚æœéµä»äº†ä¸äº†è§£æ··ä¹±é£é™©ç»ç†çš„æ„æ„¿ï¼Œä¹Ÿæ˜¯ä¸ä¸“ä¸šçš„åšæ³•</strong></p><p>â€œä½ ä»¥ä¸ºå¯ä»¥ä¸å¬ç»ç†çš„ï¼Ÿä¸å¬ç»ç†çš„ï¼Œæ˜¯ä¼šè¢«ç‚’é±¿é±¼çš„â€ï¼Œç»ç†èƒ½å¦å¬çš„è¿›å»ï¼Œæˆ‘ä»¬éƒ½è¦æå‡ºæˆ‘ä»¬çš„çœ‹æ³•ã€‚æå‡ºå¤šæ¬¡è¿˜è¢«æ— è§†ï¼Œä¹Ÿä¸è¦ç°å¿ƒä¸§æ°”ï¼Œç»§ç»­æå‡ºæˆ‘ä»¬ä¸“ä¸šçš„çœ‹æ³•â€¦ untile die, ä¸ºäº†éƒ¨è½</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204201004.png" alt=""></p><p>å¦‚æœä½ æœ‰åº•çº¿ï¼Œå®ˆä½å°±å¥½ï¼›å¦‚æœæ²¡æœ‰ï¼Œé€‚åº”å°±å¥½ã€‚åªä¸ºå¾ˆä¹…ä¹‹åçœ‹åˆ°ä»£ç è¯´ WTF æ—¶ï¼Œé¿å…ä¸»è§’æ˜¯è‡ªå·±çš„å°´å°¬</p><h2 id="æˆ‘ä»¬æ˜¯ä½œè€…"><a href="#æˆ‘ä»¬æ˜¯ä½œè€…" class="headerlink" title="æˆ‘ä»¬æ˜¯ä½œè€…"></a>æˆ‘ä»¬æ˜¯ä½œè€…</h2><p>Javadoc ä¸­çš„<code>@author</code>å­—æ®µå‘Šè¯‰æˆ‘ä»¬è‡ªå·±æ˜¯ä»€ä¹ˆèº«ä»½ï¼Œæˆ‘ä»¬æ˜¯ä½œè€…ã€‚å¦‚æœç±»ä¸Šæ²¡æœ‰æ ‡æ³¨æ—¥æœŸå’Œä½œè€…ï¼Œalibabaä»£ç æ£€æŸ¥å·¥å…·ä¼šç»™å‡ºæç¤ºï¼Œå°±åƒè¿™æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204205328.png" alt=""></p><p>è¿™é‡Œå»ºè®®å¤§å®¶åœ¨ IDE ä¸­å®‰è£…è¯¥æ’ä»¶ï¼Œå¦‚æœä½ ä¸çŸ¥é“ä½œä¸ºä½œè€…åº”æœ‰çš„è§„èŒƒï¼Œé‚£å°±è®©è¿™ä¸ªæ’ä»¶è¾…åŠ©ä½ å§</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204205503.png" alt=""></p><p>æ®ç»Ÿè®¡ï¼Œè¯»ä»£ç ä¸å†™ä»£ç èŠ±è´¹çš„æ—¶é—´æ¯”ä¾‹è¶…è¿‡ <code>10:1</code>ï¼Œ å› ä¸ºæˆ‘ä»¬åœ¨å†™æ–°ä»£ç æ—¶ä¼šä¸€ç›´åœ¨è¯»æ—§ä»£ç ï¼Œé¡¹ç›®è¶Šåˆ°åæœŸè¿™ä¸ªæ¯”ä¾‹è¶Šæ˜æ˜¾</p><p><strong>æˆ‘ä»¬æ˜¯ä½œè€…ï¼Œå°±æœ‰è´£ä»»å’Œè¯»è€…åšå¥½æ²Ÿé€š</strong>ã€‚æ¯æ¬¡å†™ä»£ç çš„æ—¶å€™ï¼Œè®°å¾—è‡ªå·±æ˜¯ä½œè€…ï¼Œè¦ä¸ºè¯„åˆ¤ä½ å·¥ä½œçš„è¯»è€…å†™ä»£ç . </p><p><img src="http://ww3.sinaimg.cn/large/9150e4e5ly1ffmclcgjlij205a05awfc.jpg" alt="ä½ è¿™æœåŠ¡çš„æˆ‘è¦ç»™å·®è¯„"></p><p>è¿™äº›è¯»è€…å¯èƒ½æ˜¯ä½ ç°åœ¨ç»„å†…çš„ä¼™ä¼´ï¼Œä¹Ÿå¯èƒ½æ˜¯å°†æ¥è¦æ¥ç®¡ä½ çš„ä»»åŠ¡çš„æ–°ä¼™ä¼´ï¼Œé¿å…åˆ«äººå˜´é‡Œ WTF çš„ä¸»è§’æ˜¯ä½ ï¼Œå®šæœŸ Review è‡ªå·±çš„ä»£ç ï¼Œä½ å®šä¼šå‘ç°å¯ä»¥æ”¹å–„çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç”¨ç­–ç•¥æ¨¡å¼æ›´æ”¹è¿‡å¤šçš„ if elseç­‰ï¼Œä»£ç æ•´æ´äº†ï¼Œåˆå­¦ä¼šäº†è®¾è®¡æ¨¡å¼ï¼Œå²‚ä¸æ˜¯ä¸¤å…¨å…¶ç¾</p><h2 id="å¿ƒæœ‰ä½™ï¼ŒåŠ›è¦è¶³"><a href="#å¿ƒæœ‰ä½™ï¼ŒåŠ›è¦è¶³" class="headerlink" title="å¿ƒæœ‰ä½™ï¼ŒåŠ›è¦è¶³"></a>å¿ƒæœ‰ä½™ï¼ŒåŠ›è¦è¶³</h2><p>å¾ˆå¤šæœ‹å‹è¯´ï¼Œæˆ‘ä¹Ÿæƒ³å†™å‡ºæ•´æ´çš„ä»£ç ï¼Œä½†æ˜¯ç›®å‰å®åŠ›ä¸å…è®¸å•Šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204211853.png" alt=""></p><p>å†™å‡ºæ•´æ´çš„ä»£ç çš„åŠŸåŠ›ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œéœ€è¦æŒç»­ä¸æ–­çš„å­¦ä¹ å’Œä¿®æ­£</p><p>å­¦ä¼šè®¾è®¡æ¨¡å¼ï¼Œäº†è§£ RESTful æ¥å£è§„èŒƒï¼Œäº†è§£å‘½åè§„èŒƒï¼Œæ³¨é‡Šï¼Œå‡½æ•°å¤§å°ç­‰ç­‰å¤ªå¤šçš„ä¸œè¥¿éƒ½æ˜¯ä¹¦å†™å‡ºæ•´æ´ä»£ç å¿…ä¸å¯å°‘çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>è¿˜è®°å¾—å°æ—¶å€™å†™ä½œæ–‡çš„è¯è—»ä¸å¤Ÿç”¨ï¼Œè€å¸ˆè®©æ‘˜æŠ„å¥½æ–‡å¥½å¥ã€‚å¦‚æœç¨‹åºå†™çš„ä¸å¤Ÿæ•´æ´ï¼Œæˆ‘ä»¬å¯ä»¥æ…¢æ…¢å­¦ä¹ å’Œæ¨¡ä»¿å¥½çš„å†™æ³•ä¸è®¾è®¡ï¼Œæ…¢æ…¢æ”¹å–„å’Œç§¯ç´¯ï¼Œæœ‰æœä¸€æ—¥è‚¯å®šèƒ½å†™å‡ºé«˜åˆ†ä½œæ–‡çš„</p><h2 id="ä¸åšç ´çª—æ•ˆåº”ç¬¬ä¸€äºº"><a href="#ä¸åšç ´çª—æ•ˆåº”ç¬¬ä¸€äºº" class="headerlink" title="ä¸åšç ´çª—æ•ˆåº”ç¬¬ä¸€äºº"></a>ä¸åšç ´çª—æ•ˆåº”ç¬¬ä¸€äºº</h2><p>ä¸è¦è¯´ç°åœ¨çš„ä»£ç å¾ˆçƒ‚äº†ï¼Œæ²¡å¿…è¦å†æ”¹å–„äº†ï¼Œå¦‚æœä½ æ˜¯è¿™æ ·çš„å¿ƒæ€ï¼Œå³ä¾¿ä¸€ä¸ªå…¨æ–°çš„é¡¹ç›®å¼€å§‹è®©ä½ å»åšï¼Œä½ ä¹Ÿå¾ˆå¯èƒ½ä¼šæˆä¸ºç¬¬ä¸€ä¸ªæ‰“ç¢ç»ç’ƒï¼Œå¸¦æ¥ç ´çª—æ•ˆåº”çš„äººã€‚</p><p>å¦‚æœä¸¥é‡ä¸€ç‚¹è¯´ï¼Œå¤§å®¶éƒ½çŸ¥é“ä½ å†™çš„ä»£ç å¸¦ç»™åˆ«äººçš„æ˜¯ä¸€ç§è´Ÿæ‹…ï¼Œä½ å¯èƒ½å¾ˆéš¾æœ‰å¼€å§‹ä¸€ä¸ªå…¨æ–°é¡¹ç›®çš„æœºä¼šäº†</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200204212753.png" alt=""></p><p>å¦‚æœåŒäº‹å› æ”¹å–„ä½ çš„ä»£ç å¸¦æ¥äº†ä¸€äº›æ„å¤–çš„å½±å“ï¼Œè¯·ä½ ä¸è¦æŠ±æ€¨ç”©é”…ï¼Œè¿™äº›æ”¹å–„å°±æ˜¯ä¿®å¤ç»ç’ƒçš„å¼€å§‹ï¼Œç»ˆå°†ä¼šç»™å›¢é˜Ÿå¸¦æ¥æå¤§çš„å¥½å¤„</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç¼–å†™æ•´æ´ä»£ç çš„è·¯é€”æ¼«æ¼«ï¼Œæˆ‘ä»¬ä¸€èµ·æ±‚ç´¢ï¼Œæ¨èå¤§å®¶çœ‹ä¸‹é¢è¿™ä¸¤æœ¬ä¹¦ï¼Œä½ ä¸€å®šæœ‰æœ‰è‡ªå·±çš„å‘ç°ï¼Œè®©æˆ‘ä»¬æ‚‰å¿ƒç…§æ–™æˆ‘ä»¬å†™çš„æ¯ä¸€è¡Œä»£ç </p><ul><li><a href="https://book.douban.com/subject/4199741/" target="_blank" rel="noopener">ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹</a></li><li><a href="https://book.douban.com/subject/27605355/" target="_blank" rel="noopener">ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹</a></li></ul><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>å·¥ä½œä¸Šä½ æ¥åˆ°è¿‡ä»€ä¹ˆå¥‡è‘©è¦æ±‚ï¼Ÿ</li><li>å·¥ä½œä¸­é‡åˆ°äº†å“ªäº›æ— å¥ˆæˆ–è€…ä½ è§‰å¾—XXçš„äº‹ï¼Ÿ</li><li>ä½ æ˜¯æ€ä¹ˆåº”å¯¹é‚£äº›ä¸å¥½çš„é—®é¢˜çš„ï¼Ÿ</li></ol><p>æ¬¢è¿åœ¨ç•™è¨€åŒºè®¨è®ºï¼Œä½ ä»¬é¡¹ç›®ä¸­çš„æƒ…å†µï¼Œä½ æ˜¯æ€ä¹ˆçœ‹å¾…ä»£ç æ•´æ´è¿™ä¸ªé—®é¢˜çš„</p><hr>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IntelliJ IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL group_concat å‡½æ•°è¯¦è§£</title>
      <link href="//p/mysql-group-concat-function-usage.html"/>
      <url>//p/mysql-group-concat-function-usage.html</url>
      
        <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://dayarch.top/p/mysql-cross-table-update.html"><a href="https://dayarch.top/p/mysql-cross-table-update.html">è·¨è¡¨æ›´æ–°ï¼Œçœ‹åˆ°è‡ªå·±å†™çš„SQLåƒä¸ªæ†¨æ†¨</a></a> å†™äº†å…³äºè·¨è¡¨ä¸ªæ›´æ–°çš„å†…å®¹ã€‚ä¸€å¹´è¿‡çš„å¾ˆå¿«ï¼Œæ–‡ä¸­åæ¥çš„ä¸¤ä½å‘˜å·¥ <code>é¦®å¤§</code> å’Œ <code>é¦®äºŒ</code> ä¹Ÿè¦é¢å¯¹æ— æƒ…çš„ KPI è€ƒæ ¸äº†ï¼Œä»–ä»¬å·¥ä½œå¹²çš„å¾ˆä¸é”™ï¼Œperformance åˆ†åˆ«æ˜¯ 4 å’Œ 5</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203190431.png" alt=""></p><p>æ–°éœ€æ±‚æ¥äº†ï¼Œé™æ‚„æ‚„çš„æ¥äº†ï¼ï¼ï¼ é¢†å¯¼æƒ³è¦æŸ¥çœ‹æ¯ä¸ª performance ä¸‹éƒ½æœ‰è°ï¼ŒåŒæ—¶è¦æ±‚å°†è¿™äº›äººçš„åç§°è¦é€—å·æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´è¦å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203190752.png" alt=""></p><p>è¦å°†ç»“æœé›†ä¸­æŸä¸ªæŒ‡å®šçš„åˆ—è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™è¦æ€ä¹ˆåšå‘¢ï¼Ÿä¸»è§’é—ªäº®âœ¨ç™»åœº</p><h2 id="GROUP-CONCAT-expr"><a href="#GROUP-CONCAT-expr" class="headerlink" title="GROUP_CONCAT(expr)"></a>GROUP_CONCAT(expr)</h2><p>åœ¨ <a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-functions.html#function_group-concat" target="_blank" rel="noopener">Mysql å®˜æ–¹æ–‡æ¡£</a> ä¸­ï¼Œè¯¥å‡½æ•°è¢«æ”¾åœ¨èšåˆå‡½æ•°ç« èŠ‚ï¼Œå¦‚æœä½ è¦æŒ‰ç…§æŒ‡å®šå­—æ®µåˆ†ç»„æ‹¼æ¥ï¼Œå°±è¦é…åˆå…³é”®å­— <code>GROUP BY</code> æ¥ä½¿ç”¨çš„</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage-20200203192855823.png" alt=""></p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><blockquote><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœï¼Œè¯¥å­—ç¬¦ä¸²ç»“æœæ˜¯é€šè¿‡åˆ†ç»„ä¸²è”çš„<code>éNULLå€¼</code>ã€‚å¦‚æœæ²¡æœ‰éNULLå€¼ï¼Œåˆ™è¿”å›NULLã€‚å®Œæ•´è¯­æ³•å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT([DISTINCT] expr [,expr ...]</span><br><span class="line">             [ORDER BY &#123;unsigned_integer | col_name | expr&#125;</span><br><span class="line">                 [ASC | DESC] [,col_name ...]]</span><br><span class="line">             [SEPARATOR str_val])</span><br></pre></td></tr></table></figure><p>What?  è¿™ä¸ªè¯­æ³•çœ‹ç€å¤ªå¤æ‚äº†å§ï¼Œåˆ«ç€æ€¥ï¼Œä¸‹é¢ä¼šç”¨ä¾‹å­æ…¢æ…¢è¯´æ˜é€ä¸€éªŒè¯æ»´</p><h3 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h3><p>å…ˆå®Œæˆæ–‡ç« å¼€å¤´çš„éœ€æ±‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">performance</span>, <span class="keyword">GROUP_CONCAT</span>(employee_name) <span class="keyword">AS</span> employees</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">performance</span>;</span><br></pre></td></tr></table></figure><p>zouæ˜¯è¿™ä¸ªç»“æœï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203190644.png" alt=""></p><p>åˆ°è¿™é‡Œï¼Œé¢†å¯¼ç»™è¿‡æ¥çš„éœ€æ±‚å°±å®Œæˆäº†ğŸ˜œ</p><p><strong>å®¢å®˜è¯·ç•™æ­¥ï¼Œæ‚¨ç‚¹çš„èœè¿˜æ²¡ä¸Šå®Œå‘¢â€¦â€¦</strong></p><p>æˆ‘ä»¬æ˜¯å›½é™…åŒ–çš„å›¢é˜Ÿï¼Œæˆ‘ä»¬çš„å®¶ä¹¡éå¸ƒäº”æ¹–å››æµ·</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203200846.png" alt=""></fancybox></p><p>é¢†å¯¼æƒ³å…³æ€€ä¸€ä¸‹å‘˜å·¥ï¼Œè¦æŸ¥çœ‹å…¬å¸å…¨éƒ¨å‘˜å·¥çš„å®¶ä¹¡éƒ½æœ‰å“ªäº›åœ°æ–¹ã€‚å‘˜å·¥ä»¬å¯èƒ½æ¥è‡ªåŒä¸€ä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥è¦å°†ç»“æœé›†å»é‡å¤ï¼Œ<code>DISTINCT</code> å…³é”®å­—å°±æ´¾ä¸Šç”¨åœºäº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">DISTINCT</span> home_town)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ç»“æœï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203201356.png" alt=""></p><p>é¢†å¯¼çš„å…³æ€€éå¸ƒäº”æ¹–å››æµ·å•Šâ€¦â€¦</p><p>æ–‡æ¡ˆè¦æ”¹äº†ï¼Œé¢†å¯¼çš„å…³æ€€æ˜¯éå¸ƒ<code>å››æµ·äº”æ¹–</code>çš„, é‚£ä¹ˆ <code>ORDER BY</code> å…³é”®å­—å°±æ´¾ä¸Šç”¨åœºäº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">DISTINCT</span> home_town <span class="keyword">ORDER</span> <span class="keyword">BY</span> home_town <span class="keyword">DESC</span>) <span class="keyword">AS</span> <span class="string">'é¢†å¯¼å…³æ€€åœ°åŒº'</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ²¡æˆ‘è¿™ä¹ˆèµ·å˜é‡çš„å“ˆï¼Œè¿˜æ˜¯æ±‰è¯­ï¼Œæˆ‘çœ‹ä½ æ˜¯ç–¯äº†</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203201904.png" alt=""></p><p>è¿™é‡Œä½ çœ‹åˆ° <code>GROUP_CONCAT</code> å‡½æ•°æ‹¼æ¥å­—ç¬¦ä¸²é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯é€—å· <code>,</code>, é¢†å¯¼ä¸å¼€å¿ƒï¼Œé€—å·ä¹ˆçš„æ„Ÿæƒ…ï¼Œè¦ç”¨â•æ‰èƒ½ä½“ç°å‡ºå…³æ€€çš„å¼ºçƒˆï¼Œ <code>SEPARATOR</code> å…³é”®å­—å°±æ´¾ä¸Šç”¨åœºäº†</p><blockquote><p>åˆ†ç»„æ‹¼æ¥çš„å€¼ä¹‹é—´é»˜è®¤åˆ†éš”ç¬¦æ˜¯é€—å·ï¼ˆï¼Œï¼‰ã€‚è¦æ˜ç¡®æŒ‡å®šåˆ†éš”ç¬¦ï¼Œéœ€è¦ä½¿ç”¨ <code>SEPARATOR</code> å…³é”®å­—ï¼Œç´§è·Ÿå…¶åçš„æ˜¯ä½ æƒ³è®¾ç½®çš„åˆ†éš”ç¬¦ã€‚è¦å®Œå…¨æ¶ˆé™¤åˆ†éš”ç¬¦ï¼Œå°±åœ¨ <code>SEPARATOR</code> å…³é”®å­—åé¢å†™  â€˜â€™ å°±å¥½äº†</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">DISTINCT</span> home_town <span class="keyword">ORDER</span> <span class="keyword">BY</span> home_town <span class="keyword">DESC</span> SEPARATOR <span class="string">'!'</span>) <span class="keyword">AS</span> <span class="string">'é¢†å¯¼å…³æ€€åœ°åŒº'</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203202350.png" alt=""></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">DISTINCT</span> home_town SEPARATOR <span class="string">''</span>) <span class="keyword">AS</span> <span class="string">'é¢†å¯¼å…³æ€€åœ°åŒº'</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203203120.png" alt=""></p><p>è¿™å…³æ€€åˆ°ä½äº†å§ï¼Œä½ å“ï¼Œä½ ç»†å“ï¼ï¼ï¼</p><p>é¢†å¯¼çš„å…³æ€€èƒ½åŠ›ä¹Ÿæœ‰é™ï¼Œ<strong>æ‹¼æ¥çš„å­—ç¬¦ä¸²é»˜è®¤çš„æœ€å¤§é•¿åº¦æ˜¯1024ä¸ªå­—ç¬¦</strong>ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢è¯­å¥æŸ¥çœ‹å½“å‰é™åˆ¶æ˜¯å¤šå°‘ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'group_concat_max_len'</span>;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200203204525.png" alt=""></p><p>é¢†å¯¼çš„èƒ½åŠ›å¯æ˜¯é£˜å¿½ä¸å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çµæ´»çš„è®¾ç½®è¿™ä¸ªå€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> [<span class="keyword">GLOBAL</span> | <span class="keyword">SESSION</span>] group_concat_max_len = val;</span><br></pre></td></tr></table></figure><ul><li>SESSION: åœ¨å½“å‰å¯¹è¯ä¸­ç”Ÿæ•ˆ</li><li>GLOBALï¼šå…¨å±€éƒ½ç”Ÿæ•ˆ</li></ul><p>è¯¥è¯­å¥åœ¨æ‰§è¡Œåï¼ŒMySQLé‡å¯ä¹‹å‰ä¸€ç›´æœ‰ä½œç”¨ï¼Œä¸€æ—¦é‡å¯ MySQLï¼Œåˆ™ä¼šæ¢å¤é»˜è®¤å€¼</p><p>æœ‰æ—¶å€™ <code>GROUP_CONCAT()</code>  è¿˜è¦æ­é… <code>CONCAT_WS()</code> å‘æŒ¥å‡ºä¸€ç‚¹ç‚¹å¨åŠ›ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­</p><blockquote><p>å°†æ¶ˆè´¹è€…çš„åå’Œå§“ç”¨é€—å·è¿›è¡Œåˆ†éš”ï¼Œç„¶åå†ç”¨ <code>;</code> è¿›è¡Œåˆ†éš”</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">GROUP_CONCAT</span>(</span><br><span class="line">       <span class="keyword">CONCAT_WS</span>(<span class="string">', '</span>, contactLastName, contactFirstName)</span><br><span class="line">       SEPARATOR <span class="string">';'</span>)</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    customers;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ <a href="https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_concat-ws" target="_blank" rel="noopener">CONCAT_WS()å‡½æ•°ç”¨æ³•</a>, å¾ˆç®€å•ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹å§â€¦â€¦</p><h2 id="æ³¨æ„âš ï¸"><a href="#æ³¨æ„âš ï¸" class="headerlink" title="æ³¨æ„âš ï¸"></a>æ³¨æ„âš ï¸</h2><p>GROUP_CONCATï¼ˆï¼‰å‡½æ•°è¿”å›å•ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å€¼åˆ—è¡¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½åœ¨ IN è¿ç®—ç¬¦ä¸­ä½¿ç”¨GROUP_CONCATï¼ˆï¼‰å‡½æ•°çš„ç»“æœï¼Œä¾‹å¦‚ï¼Œåœ¨å­æŸ¥è¯¢ä¸­ï¼Œ åƒè¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">id</span>, <span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    table_name</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    <span class="keyword">id</span> <span class="keyword">IN</span> <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åº”ç”¨GROUP_CONCATï¼ˆï¼‰å‡½æ•°äº§ç”Ÿå‡ºæœ‰ç”¨çš„ç»“æœï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç»“åˆå…¶ä»–å‡½æ•°å‘æŒ¥å‡ºæ›´å¤§çš„å¨åŠ›. å•æ‹›å­¦ä¼šäº†ï¼Œå°±è¦å­¦ä¼šè¿æ‹› combo äº†</p><ul><li>å¦‚æœä½ ä¹Ÿåƒæˆ‘ä¸€æ ·åˆšçŸ¥é“è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œè¿˜è¯·ç‚¹ä¸ªã€Œåœ¨çœ‹ã€</li><li>å¦‚æœä½ æ—©éƒ½çŸ¥é“è¿™ä¸ªå°å„¿ç§‘å†…å®¹ï¼Œè¿˜è¯·ç•™è¨€é€ä¸Šã€Œå˜˜å£°ã€</li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> æ•°æ®åº“-æŒä¹…å±‚-SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·¨è¡¨æ›´æ–°ï¼Œçœ‹åˆ°è‡ªå·±å†™çš„SQLåƒä¸ªæ†¨æ†¨</title>
      <link href="//p/mysql-cross-table-update.html"/>
      <url>//p/mysql-cross-table-update.html</url>
      
        <content type="html"><![CDATA[<p>æœ‰ç‚¹ SQL åŸºç¡€çš„æœ‹å‹è‚¯å®šå¬è¿‡ ã€Œè·¨è¡¨æŸ¥è¯¢ã€ï¼Œé‚£å•¥æ˜¯è·¨è¡¨æ›´æ–°å•Šï¼Ÿ</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>é¡¹ç›®æ–°å¯¼å…¥äº†ä¸€æ‰¹äººå‘˜æ•°æ®ï¼Œè¿™äº›äººçš„æœ‰çš„éƒ¨é—¨åç§°å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ‰çš„è”ç³»æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œæš‚ä¸”ç§°è¯¥è¡¨ä¸º </p><p><code>t_dept_members</code>, ç³»ç»Ÿä¸­æœ‰å¦å¤–ä¸€å¼ è¡¨ <code>t_user_info</code> è®°å½•äº†äººå‘˜ä¿¡æ¯ã€‚è¦æ±‚å°† <code>t_dept_members</code> ä¸­æœ‰å˜åŒ–çš„ä¿¡æ¯æ›´æ–°åˆ° <code>t_user</code> è¡¨ä¸­ï¼Œè¿™ä¸ªéœ€æ±‚å°±æ˜¯ã€Œè·¨è¡¨æ›´æ–°ã€å•¦</p><h2 id="æ†¨B-SQL-ç›´æ¥è¢«ç§’æ€"><a href="#æ†¨B-SQL-ç›´æ¥è¢«ç§’æ€" class="headerlink" title="æ†¨B SQL ç›´æ¥è¢«ç§’æ€"></a>æ†¨B SQL ç›´æ¥è¢«ç§’æ€</h2><p>ä¸å¸¦è„‘å­å‡ºé—¨çš„å°±å†™å‡ºäº†ä¸‹é¢çš„ SQL </p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200121143958.png" alt=""></p><p>çœ‹åˆ°èº«å DBA å°æ®µæ€»åœ¨ä¿®ä»™ï¼Œæƒ³ç€è®©ä»–å¸®æ¶¦è‰²ä¸€ä¸‹ğŸ˜œï¼Œäºæ˜¯å‘ç»™äº†ä»–ï¼Œç„¶åç”©æ‰‹å›æ¥å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200121144308.png" alt=""></p><p>â€‹    </p><p>çœ‹åˆ°è¿™ä¸ª SQL è¯­å¥æˆ‘éƒ½æƒŠå‘†äº†ï¼Œè¿˜èƒ½è¿™æ ·å†™ï¼Œåœ¨æ— æƒ…çš„å˜²ç¬‘ä¸‹ï¼Œä¸€å£° KO æˆ‘ç›´æ¥å€’ä¸‹ã€‚æ­»ä¹Ÿå¾—æ­»çš„æ˜ç™½ï¼Œå’±å¾—æŸ¥æŸ¥è¿™æ˜¯å’‹å›äº‹å•Š</p><h2 id="Mysql-Update-Join"><a href="#Mysql-Update-Join" class="headerlink" title="Mysql Update Join"></a>Mysql Update Join</h2><p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ <code>join</code> æŸ¥è¯¢è¡¨ä¸­å…·æœ‰ï¼ˆåœ¨ <code>INNER JOIN</code> æƒ…å†µä¸‹ï¼‰æˆ–å¯èƒ½æ²¡æœ‰ï¼ˆåœ¨ <code>LEFT JOIN</code> æƒ…å†µä¸‹ï¼‰å¦ä¸€ä¸ªè¡¨ä¸­åŒ¹é…è¡Œçš„è¡¨ä¸­çš„è¡Œã€‚</p><p>åŒæ ·ï¼Œåœ¨ MySQL ä¸­, æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ UPDATE è¯­å¥ä¸­ä½¿ç”¨ JOIN å­å¥æ‰§è¡Œè·¨è¡¨æ›´æ–°ï¼Œè¯­æ³•å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> T1, T2,</span><br><span class="line">[<span class="keyword">INNER</span> <span class="keyword">JOIN</span> | <span class="keyword">LEFT</span> <span class="keyword">JOIN</span>] T1 <span class="keyword">ON</span> T1.C1 = T2. C1</span><br><span class="line"><span class="keyword">SET</span> T1.C2 = T2.C2,</span><br><span class="line">    T2.C3 = expr</span><br><span class="line"><span class="keyword">WHERE</span> condition</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜æ˜¯è¯¦ç»†çš„è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„è¯­æ³•ï¼š</p><ul><li>é¦–å…ˆï¼Œåœ¨ UPDATE å­å¥ä¹‹åï¼ŒæŒ‡å®šä¸»è¡¨ï¼ˆT1ï¼‰å’Œå¸Œæœ›ä¸»è¡¨è”æ¥åˆ°çš„è¡¨ï¼ˆT2ï¼‰ã€‚è¯·æ³¨æ„ï¼Œå¿…é¡»åœ¨UPDATE å­å¥ä¹‹åè‡³å°‘æŒ‡å®šä¸€ä¸ªè¡¨</li><li>æ¥ä¸‹æ¥ï¼ŒæŒ‡å®šä½ è¦ä½¿ç”¨çš„è”æ¥ç±»å‹ï¼Œå³ INNER JOIN æˆ– LEFT JOIN ä»¥åŠè”æ¥è°“è¯ã€‚ JOINå­å¥å¿…é¡»å‡ºç°åœ¨ UPDATE å­å¥ä¹‹åï¼ˆè¿™ä¸ªå¤§å®¶éƒ½æ˜¯çŸ¥é“çš„å“ˆï¼‰</li><li>ç„¶åï¼Œå°†æ–°å€¼åˆ†é…ç»™è¦æ›´æ–°çš„ T1æˆ– T2 è¡¨ä¸­çš„åˆ—</li><li>æœ€åï¼Œåœ¨ WHERE å­å¥ä¸­æŒ‡å®šä¸€ä¸ªæ¡ä»¶ä»¥å°†è¡Œé™åˆ¶ä¸ºè¦æ›´æ–°çš„è¡Œ</li></ul><p>å¦‚æœä½ éµå¾ª update è¯­æ³•ï¼Œä½ ä¼šå‘ç°æœ‰å¦å¤–ä¸€ç§è¯­æ³•ä¹Ÿå¯ä»¥å®Œæˆè·¨è¡¨æ›´æ–°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> T1, T2</span><br><span class="line"><span class="keyword">SET</span> T1.c2 = T2.c2,</span><br><span class="line">      T2.c3 = expr</span><br><span class="line"><span class="keyword">WHERE</span> T1.c1 = T2.c1 <span class="keyword">AND</span> condition</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¯­æ³•å…¶å®éšå¼ä½¿ç”¨äº† inner join å…³é”®å­—ï¼Œå®Œå…¨ç­‰åŒäºä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> T1,T2</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> T2 <span class="keyword">ON</span> T1.C1 = T2.C1</span><br><span class="line"><span class="keyword">SET</span> T1.C2 = T2.C2,</span><br><span class="line">      T2.C3 = expr</span><br><span class="line"><span class="keyword">WHERE</span> condition</span><br></pre></td></tr></table></figure><p><em>ä¸ªäººå»ºè®®è¿˜æ˜¯åŠ ä¸Š <code>inner join</code> å…³é”®å­—å§ï¼Œè¿™æ ·å¯è¯»æ€§æ›´å¥½ï¼Œå°½äº«ä¸æ»‘ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿ</em></p><blockquote><p>æˆ‘æ‘¸é±¼çœ‹åˆ°çš„ï¼Œè§‰å¾—æ˜¯çµé­‚ç¿»è¯‘</p><p>è°ˆå¤ªå»‰ï¼Œç§€ä½ ç   ï¼ˆTalk is cheapï¼Œshow me the codeï¼‰</p></blockquote><h2 id="Update-Join-ä¾‹å­"><a href="#Update-Join-ä¾‹å­" class="headerlink" title="Update Join ä¾‹å­"></a>Update Join ä¾‹å­</h2><p>å¹´åº•äº†ï¼Œåˆåˆ°äº†è¯„ç»©æ•ˆçš„æ—¶å€™äº†ï¼Œå°±æ˜¯é‚£ä¸ªå« KPI çš„ä¸œä¸œï¼ˆä½ ä»¬æœ‰å—ï¼‰ï¼Œå¬è¯´è¦æ ¹æ® KPI è°ƒå·¥èµ„äº†ã€‚æœ‰ä¸¤å¼ è¡¨</p><p>ç¬¬ä¸€å¼ è¡¨ã€Œemployees-å‘˜å·¥è¡¨ã€</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200121165912.png" alt=""></p><p>å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employees</span><br><span class="line">(</span><br><span class="line">employee_id <span class="built_in">bigint</span> auto_increment <span class="keyword">comment</span> <span class="string">'å‘˜å·¥IDï¼Œä¸»é”®'</span>,</span><br><span class="line">employee_name <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'å‘˜å·¥åç§°'</span>,</span><br><span class="line"><span class="keyword">performance</span> <span class="built_in">int</span>(<span class="number">4</span>) <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'ç»©æ•ˆåˆ†æ•° 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5'</span>,</span><br><span class="line">salary <span class="built_in">float</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'å‘˜å·¥è–ªæ°´'</span>,</span><br><span class="line"><span class="keyword">constraint</span> employees_pk</span><br><span class="line">primary <span class="keyword">key</span> (employee_id)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">comment</span> <span class="string">'å‘˜å·¥è¡¨'</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¼ è¡¨ã€Œmerits-ç»©æ•ˆå­—å…¸è¡¨ã€</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200121170053.png" alt=""></p><p>å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> merits</span><br><span class="line">(</span><br><span class="line"><span class="keyword">performance</span> <span class="built_in">int</span>(<span class="number">4</span>) <span class="literal">null</span>,</span><br><span class="line">percentage <span class="built_in">float</span> <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">comment</span> <span class="string">'ç»©æ•ˆå­—å…¸è¡¨'</span>;</span><br></pre></td></tr></table></figure><p>å…ˆç”Ÿæˆä¸€äº›æ¨¡æ‹Ÿæ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»©æ•ˆå­—å…¸åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> merits(<span class="keyword">performance</span>, percentage)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="number">0.01</span>),</span><br><span class="line">       (<span class="number">3</span>, <span class="number">0.03</span>),</span><br><span class="line">       (<span class="number">4</span>, <span class="number">0.05</span>),</span><br><span class="line">       (<span class="number">5</span>, <span class="number">0.08</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å‘˜å·¥è¡¨åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(employee_name, <span class="keyword">performance</span>, salary)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">'æ‹±å“¥'</span>, <span class="number">1</span>, <span class="number">1000</span>),</span><br><span class="line">       (<span class="string">'å°æ®µæ€»'</span>, <span class="number">3</span>, <span class="number">20000</span>),</span><br><span class="line">       (<span class="string">'å¤§äºº'</span>, <span class="number">4</span>, <span class="number">18000</span>),</span><br><span class="line">       (<span class="string">'å¸ä»¤'</span>, <span class="number">5</span>, <span class="number">28000</span>),</span><br><span class="line">       (<span class="string">'è€å…­'</span>, <span class="number">2</span>, <span class="number">10000</span>),</span><br><span class="line">       (<span class="string">'ç½—è’™'</span>, <span class="number">3</span>, <span class="number">20000</span>);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200122091333.png" alt=""></p><blockquote><p>è°ƒè–ªè§„åˆ™ï¼š</p><p>åŸæœ‰è–ªèµ„ + ï¼ˆåŸæœ‰è–ªèµ„ * å½“å‰ç»©æ•ˆå¯¹åº”çš„è°ƒè–ªç™¾åˆ†æ¯”ï¼‰</p></blockquote><p>æŒ‰ç…§è°ƒè–ªè§„åˆ™å†™ update è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">    merits <span class="keyword">ON</span> employees.performance = merits.performance</span><br><span class="line"><span class="keyword">SET</span> salary = salary + salary * percentage;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200122091505.png" alt=""></p><p>æ‹±å“¥ç»©æ•ˆä¸å¥½ï¼Œæ²¡ç»™æ¶¨å·¥èµ„â€¦â€¦</p><blockquote><p>ä¸‰æ¨ªä¸€ç«–ä¸€å’•å˜ï¼Œå››ä¸ªå°çŒªğŸ·æ¥åƒzhaï¼Œå’•å˜å’•å˜åˆæ¥ä¿©</p></blockquote><p>ä¸´è¿‘å¹´åº•ï¼Œå…¬å¸åˆæ¥äº†ä¸¤ä½æ–°åŒäº‹, ä½†æ˜¯å…¬å¸å¹´åº¦ç»©æ•ˆå·²ç»è¯„å®Œï¼Œæ‰€ä»¥æ–°å‘˜å·¥ç»©æ•ˆä¸º NULL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(employee_name, <span class="keyword">performance</span>, salary)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">'é¦®å¤§'</span>, <span class="literal">NULL</span>, <span class="number">8000</span>),</span><br><span class="line">       (<span class="string">'é¦®äºŒ'</span>, <span class="literal">NULL</span>, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><p>æ–°å‘˜å·¥å·¥ä½œå¹²çš„ä¸é”™ï¼Œä¹Ÿè¦ <code>1.5%</code>  æ¶¨ç‚¹å·¥èµ„çš„ã€‚å¦‚æœæˆ‘ä»¬è¿˜æ˜¯ç”¨ <code>UPDATE INNER JOIN</code>ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ›´æ–°è¯­å¥æ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œå› ä¸ºæ¡ä»¶ç­‰å¼ä¸æˆç«‹ï¼Œè¿™æ˜¯æˆ‘ä»¬å°±è¦ç”¨åˆ° <code>UPDATE LEFT JOIN</code> äº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    merits <span class="keyword">ON</span> employees.performance = merits.performance</span><br><span class="line"><span class="keyword">SET</span> salary = salary + salary * <span class="number">0.015</span></span><br><span class="line"><span class="keyword">WHERE</span> merits.percentage <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img20200122094147.png" alt=""></p><p>åˆ°è¿™é‡Œï¼Œæ–°å‘˜å·¥çš„æ¶¨è–ªå·¥ä½œä¹Ÿåšå®Œï¼Œæ‹±å“¥ç”±äºçŸ¥è¯†ç‚¹äº†è§£ä¸é€å½»ï¼Œç°æºœæºœçš„å›å®¶è¿‡å¹´</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> æ•°æ®åº“-æŒä¹…å±‚-SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ä¿¡ä¸Šçº¿äº†10æ¬¾é»˜è®¤æ–°è¡¨æƒ…</title>
      <link href="//p/wechat-new-expression.html"/>
      <url>//p/wechat-new-expression.html</url>
      
        <content type="html"><![CDATA[<h2 id="å¾®ä¿¡æ–°å¢è¡¨æƒ…"><a href="#å¾®ä¿¡æ–°å¢è¡¨æƒ…" class="headerlink" title="å¾®ä¿¡æ–°å¢è¡¨æƒ…"></a>å¾®ä¿¡æ–°å¢è¡¨æƒ…</h2><p>å¾®ä¿¡æ–°å¢åæ¬¾é»˜è®¤è¡¨æƒ…ï¼<br>å¾®ä¿¡æ–°å¢åæ¬¾é»˜è®¤è¡¨æƒ…ï¼<br>å¾®ä¿¡æ–°å¢åæ¬¾é»˜è®¤è¡¨æƒ…ï¼</p><hr><p><strong>å¾®ä¿¡ä»Šæ—¥æ‚„ç„¶ä¸Šçº¿äº†åæ¬¾æ–°é»˜è®¤è¡¨æƒ…ï¼Œ å…¶ä¸­åŒ…å«äº†</strong><br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgWechatIMG140.png" alt=""></p><ol><li>åƒç“œ</li><li>åŠ æ²¹</li><li>æ±—</li><li>å¤©å•Š</li><li>Emm</li><li>ç¤¾ä¼šç¤¾ä¼š</li><li>æ—ºæŸ´</li><li>å¥½çš„</li><li>æ‰“è„¸</li><li>å“‡</li></ol><p>æ„Ÿè§‰æ¯”ç”¨äº†è¡¨æƒ…åŒ…è¿˜æ¿€åŠ¨ã€‚æ®æ‚‰ï¼Œç›®å‰è¿™åæ¬¾æ–°é»˜è®¤è¡¨æƒ…æ­£åœ¨è¿›è¡Œç°åº¦æµ‹è¯•ï¼Œéƒ¨åˆ†å¾®ä¿¡ç”¨æˆ·å¯èƒ½æ— æ³•æ­£å¸¸æ˜¾ç¤º</p><p>ä¸€å›¾èƒœåƒè¨€ï¼Œå¯¹äºå–œæ¬¢ä½¿ç”¨è¡¨æƒ…çš„ä½ ï¼Œå¿«å¿«æ‰“å¼€ä½ çš„å¾®ä¿¡çœ‹çœ‹å§</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgWechatIMG141.jpeg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®ä¿¡ </tag>
            
            <tag> è¡¨æƒ… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019å½’é›¶ï¼Œ2020èµ°ä½ </title>
      <link href="//p/2019-summary.html"/>
      <url>//p/2019-summary.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgnight-1080547_1920.jpg" alt=""></p><a id="more"></a><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-17-10-25-28.png" alt=""></fancybox><br>ä½œä¸ºç”Ÿé•¿åœ¨å†…è’™çš„ï¼Œä¸ä¼šå¥—é©¬çš„ï¼Œé…’ç²¾è¿‡æ•çš„ï¼Œä¸åƒç¾Šè‚‰çš„ï¼Œä¹Ÿä¸é­æ¢§çš„å¥‡è‘©ï¼Œå•æ›²å¾ªç¯å¬ç€è…¾æ ¼å°”å¤§çˆ·çš„ç¿»å”±æ­Œæ›²ã€Œå¯èƒ½å¦ã€ï¼Œè¿˜æ˜¯å¼€å§‹å†™äº† 2019 å¹´æ€»ç»“ï¼Œè¿™ä¸ªæ€»ç»“æ¯” 2002 ğŸ˜† å¹´æ¥çš„æ›´æ™šä¸€äº›ï¼Œå› ä¸ºåœ¨ç­‰å¾… 2019 å¹´æœ«çš„ä¸€ä¸ª PMP(æ‹é©¬å±)çš„æˆç»©ï¼Œèµ¶ä¸ä¸Šå„ä¸ªå¹³å°çš„æ€»ç»“æ¯”èµ›äº†ï¼Œå†™ä¸‹æ¥ç»™è‡ªå·±ä¸ªç­”å¤</p><p>å¹´åˆçš„ä¸€æ¬¡æ—…è¡Œä¹‹åï¼Œå›æ¥å€æ„Ÿæƒ¶æï¼Œæ€»è§‰å¾—åº”è¯¥åšç‚¹ä»€ä¹ˆç»§ç»­å……å®è‡ªå·±çš„ç”Ÿæ´»ã€‚å†™åšå®¢è®°å½•å’Œç»´æŠ¤å…¬ä¼—å·çš„æƒ³æ³•ä¹Ÿå°±éšä¹‹æµ®ç°åœ¨è„‘æµ·ä¸­<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-19-10-58-08.png" alt=""></fancybox></p><p>ç¿»çœ‹å†å²è®°å½•ï¼Œåœ¨ 2015 å¹´å°±å·²ç»å°è¯•æ­å»ºè‡ªå·±çš„åšå®¢äº†ï¼Œå¥ˆä½•æ²¡æœ‰åšæŒåˆ†äº«ï¼Œä¸­é€”å¤­æŠ˜ã€‚ã€Œç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€ã€‚è¿™ä¸€åˆ»ï¼Œæˆ‘è¦ç§ä¸€æ£µæ ‘ï¼Œé™ªå¥¹é•¿å¤§ï¼Œæˆ‘å˜è€ï¼Œå¥¹èŒå£®é•¿é’</p><h2 id="å…¬ä¼—å·ä¸åšå®¢"><a href="#å…¬ä¼—å·ä¸åšå®¢" class="headerlink" title="å…¬ä¼—å·ä¸åšå®¢"></a>å…¬ä¼—å·ä¸åšå®¢</h2><p>ç£•ç£•ç¢°ç¢°ä¸€ç‚¹ç‚¹æ‘¸ç´¢ç€å®Œæˆäº†å…¬ä¼—å·çš„æ³¨å†Œã€Œæ—¥æ‹±ä¸€å…µã€ã€‚<code>æ—¥æ‹±ä¸€å’ï¼ŒåŠŸä¸å”æ</code>ï¼Œè¿™ä¸ªåå­—çœŸæ˜¯éå¸¸è´¨æœ´äº†ï¼Œå¥ˆä½•æ—¥æ‹±ä¸€å’è¢«æ³¨å†Œäº†ï¼Œä½†å¹¸è¿çš„æ˜¯æ—¥æ‹±ä¸€å…µæ²¡æœ‰è¢«æ³¨å†Œï¼Œå¦åˆ™æˆ‘å°±å¾—ã€Œè»Š/é¦¬/ç‚®ã€çš„å°è¯•ä¸‹å»äº†ï¼Œå¦‚æœåˆ°äº†<code>æ—¥æ‹±ä¸€ pao</code>çš„åœ°æ­¥æˆ‘åº”è¯¥å°±æ”¾å¼ƒè¿™ä¸ª ID äº†å§ ğŸ˜‚</p><p>æœæŸ¥è‚šå­é‡Œæœ‰é™çš„å¢¨æ°´ï¼Œ2019 å¹´ 5 æœˆ 22 å·ï¼Œæˆ‘æˆ˜æˆ˜å…¢å…¢åˆæ»¡æ€€æœŸå¾…çš„å‘å¸ƒäº†ç¬¬ä¸€ç¯‡æ–‡ç« <a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„ RESTful API</a>ã€‚æˆ‘åƒåšä¼ é”€çš„ä¸€æ ·ï¼Œå…ˆä»äº²æœ‹å¥½å‹å¼€å§‹å‘ï¼Œè®©ä»–ä»¬å…³æ³¨è¯„è®ºï¼Œç°åœ¨ä¸€çœ‹å·²ç»æœ‰äº† 17 ä¸ª<code>åœ¨çœ‹</code>ï¼Œä»–ä»¬ä¸€å®šè´¡çŒ®å¾ˆå¤š ğŸ˜œ</p><p>2019 å¹´ 7 æœˆ 11 æ—¥ï¼Œçªç„¶æ”¶åˆ°ä¸€ä¸ªèµèµé€šçŸ¥ï¼Œå¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯æœ‹å‹çš„å®‰æ…°ï¼Œåå¤ç¡®è®¤åï¼Œæ‰å‘ç°è¿™å°±æ˜¯è¯»è€…æœ‹å‹çš„èµèµï¼Œé‚£ä¸€åˆ»æˆ‘è§‰å¾—æˆ‘æ˜¯ç™¾ä¸‡å¯Œç¿ï¼Œæ€€ç€æ— æ¯”æ¿€åŠ¨çš„å¿ƒæƒ…å›å¤ã€Œæˆ‘ä¼šåŠªåŠ›è¾“å‡ºé«˜è´¨é‡åŸåˆ›å†…å®¹ã€</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-19-12-33-01.png" alt=""></fancybox></p><p>ç”Ÿå­©å­å®¹æ˜“ï¼Œå…»è‚²å­©å­éš¾ï¼Œä¸å…³æ³¨ç²‰ä¸çš„å¢é•¿ä¸€å®šæ˜¯å‡çš„ã€‚æˆ‘ä¹Ÿéœ€è¦å°å°çš„æˆå°±æ„Ÿæ¥é©±åŠ¨ï¼Œä¸€å¤©ä¸‹æ¥ï¼Œæ¯å¢é•¿ä¸€ä¸ªç²‰ä¸éƒ½ä½¿æˆ‘è¶³å¤Ÿå…´å¥‹ï¼Œç¬¬äºŒå¤©èµ·åºŠåˆç„¦è™‘çš„æœŸç›¼ç¬¬äºŒä¸ªç²‰ä¸çš„åˆ°æ¥ï¼Œå°±è¿™æ ·æœæœæš®æš®â€¦â€¦</p><p><a href="https://dayarch.top/">ä¸ªäººåšå®¢</a>é‡æ–°è¿è¥äº†èµ·æ¥ï¼Œåœ¨ç»´æŠ¤è¿‡ç¨‹ä¸­å·®ç‚¹è¿·å¤±åœ¨å®šåˆ¶ç‚«é…·çš„æ•ˆæœä¸­ï¼Œå¹¸äºæ²¡æœ‰èµ°ç«å¦‚é­”ï¼Œå›å½’åˆ°äº†åšæ–‡å†…å®¹æœ¬è´¨ä»¥åŠåšå®¢åŠŸèƒ½å¢å¼ºç­‰ï¼Œä½œä¸ºåç«¯ç¨‹åºçŒ¿çš„æˆ‘ï¼Œä¹Ÿä¸ºä¸»é¢˜åŠŸèƒ½è´¡çŒ®äº†ä¸ª PRï¼Œè¿˜è¯·å„ä½å¤§å£°å˜²ç¬‘<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-19-13-56-50.png" alt=""></fancybox></p><p>ä½çš„ç¦»å…¬å¸å¾ˆè¿‘ï¼Œæ— èŠçš„æ—¶å€™å°±å¯ä»¥è·‘åˆ°å…¬å¸å†™ç‚¹ä¸œè¥¿é™é™å¿ƒï¼Œä¸åˆ°ä¸€å¹´å†™äº† 39 ç¯‡åŸåˆ›æ–‡ç« ï¼Œä¸ç®—ä»£ç ï¼Œç´¯è®¡å­—æ•°å°†è¿‘ 10 ä¸‡å­—ï¼Œé•¿åº¦ä¸åˆ°åœ°çƒä¸€å‘¨ğŸ˜</p><h2 id="ä¿¡ä»°"><a href="#ä¿¡ä»°" class="headerlink" title="ä¿¡ä»°"></a>ä¿¡ä»°</h2><p>ä¸ºäº†åšå¥½è¿™äº›å†…å®¹ï¼Œæˆ‘ä¸ºæˆ‘çš„æ€æƒ³æ³¨å…¥ä¸¤æ¡ä¿¡ä»°:</p><blockquote><p>ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰äº†ä¸¤ä¸ªæ€æƒ³<br>è¿™ä¸ªä¿¡ä»°è®©æˆ‘å‹‡äºä¸ä»–äººäº¤æµï¼Œè¿›è¡Œæ€æƒ³ç¢°æ’ï¼Œç”šè‡³äº§ç”Ÿ 1+1&gt;2 çš„æ•ˆæœï¼Œä¹äºåˆ†äº«ä¹Ÿè®©æˆ‘æ”¶è·é¢‡å¤šå¿«ä¹ï¼Œä½ ä¼šå‘ç°ï¼Œæ¯ä¸ªä¸ªä½“çš„æ€æƒ³çœŸçš„å¾ˆå¥‡å¦™<br>If you can NOT explain it simply, you do NOT understand it well enough<br>æŠ€æœ¯æœ‰æ—¶ä¼šæ¯ç‡¥ï¼Œæ‰€ä»¥æœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼Œå°†æŠ½è±¡é—®é¢˜å›¾å½¢åŒ–çš„æ–¹å¼æ¥è¾“å‡ºæ–‡ç« ã€‚åœ¨è®²è§£çš„è¿‡ç¨‹ä¸­ä¹ŸåŠ æ·±äº†æˆ‘å¯¹é—®é¢˜çš„ç†è§£å±‚æ¬¡</p></blockquote><h2 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h2><p>2019 å¹´è¯» 30 å¤šæœ¬æ‚ä¹¦ï¼Œå·²ç»æ”¾åˆ°äº†<a href="https://dayarch.top/books/">åšå®¢ä¹¦æ¶</a>ï¼Œé—æ†¾çš„æ˜¯æ²¡æ€ä¹ˆå†™å®Œæ•´ä¹¦è¯„ï¼Œæˆ‘çƒ­è¡·äºçœ‹çº¸è´¨ä¹¦ç±ï¼Œéƒ½æ˜¯è¾¹è¯»è¾¹å†™è¾¹ç”»äº†ï¼Œè¿™é‡Œä»…ä»…è¯´å‡ ä¸ªå°è±¡æ·±åˆ»çš„æ„Ÿæ‚Ÿ</p><blockquote><ul><li>å…¥ä¸€è¡Œï¼Œå…ˆåˆ«æƒ¦è®°ç€èƒ½èµšé’±ï¼Œå…ˆå­¦ç€è®©è‡ªå·±å€¼é’±ï¼Œå˜å†…è¡Œäººã€‚æ²¡æœ‰å“ªä¸ªè¡Œä¸šçš„é’±æ˜¯å¥½èµšçš„ï¼Œå­¦ä¹ æ˜¯è®©è‡ªå·±å¿«é€Ÿå¢å€¼çš„æœ€å¥½é€”å¾„ã€‚è®©äººè¿·èŒ«çš„åŸå› åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯æœ¬è¯¥æ‹¼æçš„å¹´çºªï¼Œå´æƒ³å¾—å¤ªå¤šï¼Œåšå¾—å¤ªå°‘â€”â€”æ‘˜è‡ªã€Œè¤šæ—¶å¥ä¼ ã€</li><li>å¿ƒç†å­¦ç›¸å…³çš„ä¹¦è§£è¯»äº†æˆ‘æ—¥å¸¸ä¸€äº›ç–¯ç‹‚çš„æ€æƒ³å’Œè¡Œä¸ºï¼Œå¦‚æœæ²¡æœ‰ä»–ä»¬çš„è§£è¯»ï¼Œæˆ‘å¯èƒ½è§‰å¾—æˆ‘æ˜¯ä¸ªå˜æ€ğŸ˜‚ï¼Œç°åœ¨å¿ƒå®‰äº†è®¸å¤š</li><li>ä½ çš„ç¯è¿˜äº®ç€å—ï¼Ÿå§‹ç»ˆè®©æˆ‘å¸¦ç€è¿½é—®å»æ€è€ƒé—®é¢˜ï¼Œæ¯ç¯‡å…¬ä¼—å·æ¨æ–‡çš„ã€Œçµé­‚è¿½é—®ã€ç¯èŠ‚çš„çµæ„Ÿä¹Ÿæ¥æºäºæ­¤</li></ul></blockquote><p>è¯»ä¹¦åªä¸ºå–æ‚¦è‡ªå·±</p><h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>2019 å¹´åœ¨å·¥ä½œä¸Šæ•´ä½“èŠ‚å¥ä¾ç„¶å¹³ç¨³ã€‚å’Œä¼™ä¼´ä»¬å¹¶è‚©æˆ˜æ–—ï¼Œå¤šä¸ªäº§å“çº¿ä¹Ÿå¦‚æœŸä¸Šçº¿ã€‚å¾ˆæ„å¤–ç”³è¯·ä¸‹æ¥ä¸€ä¸ªä¸“åˆ©ã€Œè¯ä»¶æ–‡å­—ä¿¡æ¯è·å–æ–¹æ³•ã€è£…ç½®ä»¥åŠç”µå­è®¾å¤‡ã€ï¼ŒåŒæ—¶æœ‰ä¸€ç¯‡æ–‡ç« å…¥é€‰å…¬å¸æŠ€æœ¯æœŸåˆŠã€‚è¯·å…è®¸æˆ‘éª„å‚²ä¸€ç§’é’Ÿ</p><p>éª„å‚²ç»“æŸâ€¦â€¦ğŸ˜‚</p><h2 id="ç›¸è¯†ï¼Œå¹¸è¿çš„èµ·ç‚¹"><a href="#ç›¸è¯†ï¼Œå¹¸è¿çš„èµ·ç‚¹" class="headerlink" title="ç›¸è¯†ï¼Œå¹¸è¿çš„èµ·ç‚¹"></a>ç›¸è¯†ï¼Œå¹¸è¿çš„èµ·ç‚¹</h2><p>ä¸šä½™æ—¶é—´ä¸º <a href="http://www.spring4all.com/" target="_blank" rel="noopener">Spring4All ç¤¾åŒº</a> è´¡çŒ®ç¿»è¯‘å†…å®¹ï¼Œæ…¢æ…¢ç»“è¯†äº†<code>ç¨‹åºçŒ¿ DD</code> å’Œ <code>æ³¥ç“¦åŒ  BYSocket</code>ï¼Œè¢«å‰è¾ˆçš„æ€åº¦æŠ˜æœï¼Œæ›´è¢«ä¸€äº›æ•…äº‹æ„ŸåŠ¨ã€‚ä»–ä»¬è‡ªç„¶æ˜¯æˆ‘å­¦ä¹ å’Œè¿½èµ¶çš„æ¦œæ ·</p><p>ç»´æŠ¤ä¸ªäººåšå®¢å’Œå…¬ä¼—å·å°‘ä¸äº†å¹¶è‚©æˆ˜æ–—çš„ä¼™ä¼´ï¼Œ<code>ä¹±æ•²ä»£ç </code>ï¼Œ<code>ç å†œå°èƒ–å“¥</code>ï¼Œ<code>è¾‰å“¥</code>ï¼Œ<code>é”…å¤–çš„å¤§ä½¬</code>ï¼Œ<code>äºŒå¸ˆå…„</code>ç­‰ï¼Œæˆ‘å’Œç¾¤é‡Œå°ä¼™ä¼´æ— æ•°æ¬¡çš„æ¢è®¨æ–¹å‘å’Œä¿®è¡¥æ”¹è¿›æ–¹æ¡ˆç­‰ï¼Œå¢é•¿äº†è§è¯†åŒæ—¶ä¹Ÿåšå®šäº†åšå¥½çš„æ€åº¦å’Œä¿¡å¿µ</p><p>è®¤è¯†äº†å„å¤§ç½‘ç«™çš„è¿è¥å°å§å§ï¼Œå°å“¥å“¥ï¼Œå¶å°”å‘çš„æ–‡ç« èƒ½è¢«ç¿»ç‰Œåˆ°é¦–é¡µã€Œä¾å¯ã€ç€å®å¹¸è¿ï¼Œæˆ‘äº²çˆ±çš„å°ä¼™ä¼´å’Œæœ‹å‹ä»¬ï¼Œæ„Ÿè°¢ä¸ä½ ç›¸é‡ï¼Œæ›´æ„Ÿæ©ç›¸é‡å’Œç›¸çŸ¥ğŸ™</p><h2 id="PMP"><a href="#PMP" class="headerlink" title="PMP"></a>PMP</h2><p>PMP(Project Management Professional)ï¼Œä¿—ç§°ã€Œæ‹é©¬å±ã€ï¼Œå’Œã€Œåˆ«æ‘¸æˆ‘ã€æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ğŸ˜‚ã€‚æ¯•ä¸šåå°±æ²¡è€ƒè¿‡è¯•ï¼Œæ„Ÿè§‰å‰ 20 å¤šå¹´çš„æŠ€èƒ½åŒ…å¿«ä¸¢æ²¡äº†ï¼Œçœ‹åˆ°æœ‹å‹æœ‰æ‹¿åˆ°PMP è¯ä¹¦çš„ï¼Œæ°é€¢å…¬å¸è¿˜ç»™æŠ¥é”€éƒ¨åˆ†è´¹ç”¨(è¿™å¾ˆå…³é”®)ï¼Œå†³å®šå°è¯•ä¸€é­ï¼Œ2019 å¹´ 9 æœˆæŠ¥åï¼Œ12 æœˆ 7 æ—¥è€ƒè¯•ï¼Œ2020 å¹´ 1 æœˆ 17 æ—¥æ‹¿åˆ°ç»“æœï¼Œ5A é€šè¿‡è€ƒè¯•ï¼Œé¡ºåˆ©æ‹¿åˆ°çºªå¿µç‰ˆçº¢è‰²è¯ä¹¦ã€‚</p><p>è€ƒè¯•æœ¬èº«æ„Ÿè§‰æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œä½†æ˜¯æ„Ÿè§‰å­¦ä¹ è¿‡ç¨‹çš„æ€ç»´ï¼Œæ€è€ƒæ¨¡å¼ä»¥åŠä¸€äº›è½¯æŠ€èƒ½è¿˜æ˜¯å€¼å¾—é•¿æœŸæ·±å…¥æ€è€ƒç¢ç£¨çš„ã€‚æœ‰å…´è¶£çš„æœ‹å‹å’±ä»¬èŠä¸€èŠ</p><h2 id="è¿åŠ¨"><a href="#è¿åŠ¨" class="headerlink" title="è¿åŠ¨"></a>è¿åŠ¨</h2><p>æ•´ä¸ªä¸€å¹´è¿˜æ˜¯ä¿æŒäº†ç›¸å¯¹è§„å¾‹çš„è¿åŠ¨èŠ‚å¥ï¼ŒåŸºæœ¬ä¸€å‘¨ä¸€åœºç¾½æ¯›çƒï¼ŒKeep æ™¨ç»ƒ(æ—©æ™¨ç»ƒä¸€ä¼šç‘œä¼½æ‹‰ä¼¸ä¸€ä¸‹ç­‹éª¨æ„Ÿè§‰ä¸€å¤©éƒ½è½»æ¾äº†è®¸å¤š)ã€‚æ¯å¤©å¤šå‡ ç§’çš„ç´¯åŠ è®­ç»ƒï¼Œå¹³æ¿æ”¯æ’‘ï¼ˆplankï¼‰å¯ä»¥åšåˆ°åšæŒ 12 åˆ†é’Ÿã€‚</p><p>ä»¥ä¸ºè‡ªå·±è¦èµ·é£ï¼Œä¹°äº†å¥è…¹è½®ï¼Œæ ¸å¿ƒåŠ›é‡è¿˜æ˜¯ä¸è¶³ï¼Œè…°éƒ¨å—ä¼¤ï¼Œä¸€ä¸‹å›åˆ°è§£æ”¾å‰ã€‚ç›®å‰å·²ç»æ¢å¤è®­ç»ƒäº†ã€‚é™¤äº†æŒ‡å®šå­£èŠ‚çš„è¿‡æ•æ€§é¼»ç‚å¤–(æœ‰è‰¯æ–¹ï¼Œè¿˜è¯·ä¼¸å‡ºæ´åŠ©ä¹‹æ‰‹)ï¼Œèº«ä½“åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><h2 id="é¸¡æ±¤"><a href="#é¸¡æ±¤" class="headerlink" title="é¸¡æ±¤"></a>é¸¡æ±¤</h2><p>é¸¡æ±¤ä¸å–ä¸è¡Œï¼Œä½†å–å¤šäº†æˆ‘è®¤ä¸ºä¼šä¸­æ¯’ï¼Œæˆ‘æ‰¾åˆ°äº†æˆ‘çš„ä¸“å±é¸¡æ±¤ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ¬¾å‘³é“é†‡é¦™çš„é¸¡æ±¤ï¼Œå–è¿‡ä¹‹åè®©æˆ‘é£˜é£˜æ¬²ä»™<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-19-21-11-51.png" alt=""></fancybox></p><p>è¿˜æœ‰è¿™ç¨å¾®å‘æ¶©çš„é¸¡æ±¤ï¼Œå–è¿‡ä¹‹åå›å‘³æ— ç©·å•ŠğŸ˜‚<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-19-21-04-33.png" alt=""></fancybox></p><p>é¸¡æ±¤å‘³é“ä¸åŒï¼Œéƒ½å¾ˆè¡¥äººã€‚å¾—åˆ°è‚¯å®šï¼Œä¿æŒèŠ‚å¥ç»§ç»­å‰è¿›ï¼›è·å¾—æ‰¹è¯„ï¼Œæ€»ç»“åæ€åŠ ä»¥æé«˜</p><h2 id="å°æˆæœ"><a href="#å°æˆæœ" class="headerlink" title="å°æˆæœ"></a>å°æˆæœ</h2><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-19-21-48-03.png" alt=""></fancybox></p><blockquote><p>2019 è‡³æ­¤å½’é›¶â€¦â€¦ï¼Œã€Œå¹¸è¿ã€å’Œã€Œè¸å®ã€</p></blockquote><h2 id="2020-èµ°ä½ "><a href="#2020-èµ°ä½ " class="headerlink" title="2020 èµ°ä½ "></a>2020 èµ°ä½ </h2><p>ä¸æ•¢æ†§æ†¬å¤ªå¤šï¼Œå…ˆå¥–åŠ±è‡ªå·±ä¸€åŒç¾½æ¯›çƒé‹å§ï¼Œçƒåœºä¸å—ä¼¤ï¼Œç”Ÿæ´»ä¸æ„Ÿä¼¤ï¼Œè…¹è‚Œå†å‘ä¸‹æŒªä¸¤å—ï¼Œå…¨æ–°å‘µæŠ¤è¿™é¢— 2019 å¹´ç§ä¸‹çš„æ ‘ï¼Œè„šè¸å®åœ°â€¦â€¦</p><p>å•æ›²è¿˜åœ¨å¾ªç¯ï¼Œå†™åˆ°è¿™ä»€ä¹ˆå¿ƒæƒ…å‘¢ï¼Ÿçœ‹çœ‹è¿™é¦–æ­Œçš„è¯„è®ºå§ï¼Œå°±æ˜¯è¿™ç§æ’å—å¢™çš„å¿ƒæ€å§</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-17-11-13-16.png" alt=""></fancybox></p><hr><p>å—å¢™æ’çš„è¿˜æ˜¯æŒºç–¼ï¼Œå†™åˆ°è¿™å§ï¼Œæ„Ÿè°¢çœ‹åˆ°è¿™é‡Œçš„å¸…å“¥ç¾å¥³ä»¬ï¼Œè¯šå®çš„ä¸ºè‡ªå·±æ‹‰ä¸Šä¸€ç¥¨ï¼Œå–œæ¬¢çš„è¯ç»™ä¸ªèµï¼Œåˆ†äº«ï¼Œå…³æ³¨(å¥¢æ±‚æœ‰ç‚¹å¤š)ï¼ŒèƒŒååˆ›ä½œä¸æ˜“ï¼ŒåšæŒåšä¼˜è€Œç¾çš„æŠ€æœ¯å…¬ä¼—å·ã€‚è‡´æ•¬æœ‹å‹ï¼Œå¹²æ¯ğŸº (è¿™æ˜¯é¥®æ–™ï¼Œæˆ‘é…’ç²¾è¿‡æ•)</p><p>çœŸçš„åˆ°è¿™é‡Œäº†ï¼Œæˆ‘è¦æ’ç‰ˆäº†â€¦..</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°å°TODOä¹Ÿæœ‰å¤§é“ç†</title>
      <link href="//p/how-to-use-todo-feature.html"/>
      <url>//p/how-to-use-todo-feature.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ‡è®°éƒ¨åˆ†ä»£ç ä»¥ä¾›å°†æ¥å‚è€ƒï¼Œæ¯”å¦‚: ä¼˜åŒ–ï¼Œæ”¹è¿›ï¼Œå¯èƒ½çš„æ›´æ”¹ï¼Œè¦è®¨è®ºçš„é—®é¢˜ç­‰ã€‚ é€šå¸¸æˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­åŠ å…¥å¦‚ä¸‹çš„æ ‡è®°è¡¨ç¤ºå¾…åŠ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TODO æˆ‘å°†è¦åœ¨è¿™é‡Œåš xxx</span></span><br></pre></td></tr></table></figure><p>ä½ è¿™æ ·åšï¼Œåˆ«äººä¹Ÿä¼šè¿™æ ·åšã€‚ä¸€æ—¶é—´ï¼Œé¡¹ç›®ä¸­å¯èƒ½ä¼šå­˜åœ¨å¤§é‡çš„ <code>TODO</code>ï¼Œå½“ä½ æœå¯»ä½ çš„ <code>TODO</code> æ—¶ä¹Ÿå°±å˜å¾—éå¸¸éº»çƒ¦ï¼Œå¦‚åŒçŸ³æ²‰å¤§æµ·ï¼Œä¹Ÿå°±å¤±å»äº†è¿™ä¸ªæ ‡è®°çš„æ„ä¹‰ã€‚</p><p>IntelliJ IDEAå…è®¸æˆ‘ä»¬æ·»åŠ ç‰¹æ®Šç±»å‹çš„æ³¨é‡Šï¼Œä½¿å¾—è¿™äº›æ³¨é‡Šåœ¨ç¼–è¾‘å™¨ä¸­çªå‡ºæ˜¾ç¤ºï¼Œå®ƒä»¬è¢«ç´¢å¼•ï¼Œå¹¶åœ¨ <code>TODO å·¥å…·çª—å£</code> ä¸­åˆ—å‡ºã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®¹æ˜“è¿½è¸ªè‡ªå·±çš„ <code>TODO</code> äº†ã€‚</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgTODOexample.png" alt=""></fancybox></p><h2 id="é»˜è®¤çš„-TODO"><a href="#é»˜è®¤çš„-TODO" class="headerlink" title="é»˜è®¤çš„ TODO"></a>é»˜è®¤çš„ <code>TODO</code></h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒIntelliJ IDEAè¯†åˆ«ä¸¤ç§æ¨¡å¼ï¼šå°å†™å’Œå¤§å†™çš„ <code>TODO</code> å’Œ <code>FIXME</code> è¿™äº›æ¨¡å¼å¯åœ¨ä»»ä½•å—æ”¯æŒæ–‡ä»¶ç±»å‹çš„è¡Œæ³¨é‡Šå’Œå—æ³¨é‡Šå†…éƒ¨ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹é»˜è®¤æ¨¡å¼æˆ–æ·»åŠ è‡ªå·±çš„æ¨¡å¼</p><p>å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šè¡Œçš„ <code>TODO</code> (ç±»ä¼¼ Spring Boot ä¸­çš„ YAML é…ç½®å¤šä¸ªå€¼)ï¼Œéœ€è¦ç¼©è¿›ç¬¬ä¸€è¡Œä¹‹åçš„æ³¨é‡Šè¡Œã€‚å¦‚æœæ²¡æœ‰ç¼©è¿›ï¼Œåˆ™å°†è¡Œè§†ä¸ºå¸¸è§„æ³¨é‡Šè¡Œ</p><p>è¦ç¦ç”¨å¤šè¡Œ <code>TODO</code> é¡¹ç›®ï¼Œä½¿ç”¨å¿«æ·é”® <code>âŒ˜ + ,</code> æ‰“å¼€ Preferencesï¼Œ æœç´¢ <code>TODO</code> (Editor | TODO), ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-01-09_09-06-39.jpg" alt=""></fancybox></p><p>è¦æŸ¥çœ‹ç³»ç»Ÿä¸­çš„æ‰€æœ‰ <code>TODO</code>ï¼Œè¯·æ‰“å¼€ TODO å·¥å…·çª—å£ (å¿«æ·é”® <code>âŒ˜ + 6</code> )ã€‚åˆ‡æ¢é€‰é¡¹æŸ¥çœ‹ <code>TODO</code> èŒƒå›´:</p><ul><li>ä»å½“å‰é¡¹ç›®ä¸­çš„æ‰€æœ‰æ–‡ä»¶</li><li>ä»…åŸºäºå½“å‰æ–‡ä»¶çš„èŒƒå›´</li><li>æŒ‡å®šèŒƒå›´çš„æ–‡ä»¶</li><li>æ´»åŠ¨çš„å˜æ›´åˆ—è¡¨</li></ul><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-01-09_09-23-45.jpg" alt=""></fancybox></p><p>åˆ°è¿™é‡Œ Intellij IDEA é»˜è®¤æä¾›çš„ <code>TODO</code> å°±ä»‹ç»å®Œäº†ï¼Œä¸ºäº†èƒ½æ›´å¿«çš„æ‰¾åˆ°æˆ‘ä»¬è‡ªå·±çš„ TODOï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè‡ªå®šä¹‰</p><h2 id="è‡ªå®šä¹‰-TODO"><a href="#è‡ªå®šä¹‰-TODO" class="headerlink" title="è‡ªå®šä¹‰ TODO"></a>è‡ªå®šä¹‰ TODO</h2><p>é‡æ–°æ‰“å¼€ <code>TODO</code> ä½ç½®ï¼Œæ–°å¢ TODO itemï¼Œè¿™é‡Œæ–°å¢ <code>optimize</code>ï¼Œç”¨äºæ ‡è¯†å¾…ä¼˜åŒ–å†…å®¹</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-01-09_09-46-03.jpg" alt=""></fancybox></p><p>æ·»åŠ ä¸ªè¿‡æ»¤å™¨ï¼Œç”¨äº <code>TODO</code> çš„åˆ†ç»„<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-01-09_09-50-35.jpg" alt=""></fancybox></p><p>éšä¾¿æ·»åŠ ä¸€ä¸ªä¼˜åŒ–å¤‡æ³¨ï¼Œé€šè¿‡ä»¥ä¸Šä»‹ç»çš„åŠŸèƒ½ï¼Œå¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬è‡ªå·±çš„ <code>TODO</code></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2020-01-09_09-54-37.jpg" alt=""></fancybox></p><p>å¦‚æœä½ çš„å¾…åŠäº‹é¡¹é€šå¸¸æ˜¯ç›¸å¯¹å›ºå®šçš„æè¿°ï¼Œä½ ä¹Ÿå¯ä»¥é…åˆ Live Template å¿«é€Ÿç”Ÿæˆ <code>TODO</code> å†…å®¹</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å½“å›¢é˜Ÿè§„æ¨¡å¾ˆå¤§ï¼Œä½ åˆåŒæ—¶æœ‰å¾ˆå¤šå¾…åŠçš„æ—¶å€™ï¼Œ<code>TODO</code> ç‰¹æ€§å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšæ ‡è¯†ï¼Œè‡ªå®šä¹‰ <code>TODO</code> å¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿå®šä½ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä½†æ˜¯</p><blockquote><h4 id="å®šæœŸæ¸…ç†-TODO"><a href="#å®šæœŸæ¸…ç†-TODO" class="headerlink" title="å®šæœŸæ¸…ç† TODO"></a>å®šæœŸæ¸…ç† TODO</h4><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2020-01-09-10-45-53@2x.png" alt=""></fancybox></p></blockquote><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä½ è§‰å¾—é¡¹ç›®ä¸­ä»£ç æœ‰å“ªäº›ä¸è§„èŒƒ/ä¸å¤Ÿæ•´æ´çš„åœ°æ–¹ï¼Ÿ(æ¬¢è¿åˆ°åšå®¢ä¸‹æ–¹ç•™è¨€è®¨è®º)</li></ol><hr>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> å®‰å…¨-åè®®-è§„èŒƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IntelliJ IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Spring Bootå¯åŠ¨æ—¶æ‰§è¡Œä»£ç çš„å‡ ç§æ–¹æ³•</title>
      <link href="//p/spring-boot-execute-on-startup.html"/>
      <url>//p/spring-boot-execute-on-startup.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€äº›ä»£ç ç‰‡æ®µï¼Œè¿™äº›ç‰‡æ®µå¯èƒ½æ˜¯ä»…ä»…æ˜¯ä¸ºäº†è®°å½• logï¼Œä¹Ÿå¯èƒ½æ˜¯åœ¨<a href="https://dayarch.top/p/pkix-certificate-import.html">å¯åŠ¨æ—¶æ£€æŸ¥ä¸å®‰è£…è¯ä¹¦</a> ï¼Œè¯¸å¦‚ä¸Šè¿°ä¸šåŠ¡è¦æ±‚æˆ‘ä»¬å¯èƒ½ä¼šç»å¸¸ç¢°åˆ°</p><p>Spring Boot æä¾›äº†è‡³å°‘ 5 ç§æ–¹å¼ç”¨äºåœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œä»£ç ã€‚æˆ‘ä»¬åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæœ¬æ–‡å°†ä¼šé€æ­¥è§£é‡Šä¸åˆ†æè¿™å‡ ç§ä¸åŒæ–¹å¼</p><h2 id="CommandLineRunner"><a href="#CommandLineRunner" class="headerlink" title="CommandLineRunner"></a>CommandLineRunner</h2><p><code>CommandLineRunner</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å®ç°å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>Spring åº”ç”¨æˆåŠŸå¯åŠ¨ä¹‹å</code> æ‰§è¡Œä¸€äº›ä»£ç ç‰‡æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCommandLineRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">log.info(<span class="string">"MyCommandLineRunner order is 2"</span>);</span><br><span class="line"><span class="keyword">if</span> (args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">log.info(<span class="string">"MyCommandLineRunner current parameter is: &#123;&#125;"</span>, args[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ Spring Boot åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ° <code>CommandLineRunner</code> beanï¼Œå®ƒå°†ä¼šåœ¨åº”ç”¨æˆåŠŸå¯åŠ¨ä¹‹åè°ƒç”¨ <code>run()</code>  æ–¹æ³•ï¼Œå¹¶ä¼ é€’ç”¨äºå¯åŠ¨åº”ç”¨ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°</p><p>é€šè¿‡å¦‚ä¸‹ maven å‘½ä»¤ç”Ÿæˆ jar åŒ…:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»ˆç«¯å‘½ä»¤å¯åŠ¨åº”ç”¨ï¼Œå¹¶ä¼ é€’å‚æ•°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar springboot-application-startup-0.0.1-SNAPSHOT.jar --foo=bar --name=rgyb</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œç»“æœ:<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-23_20-32-41.jpg" alt=""></fancybox></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå‡ ä¸ªé—®é¢˜:</p><ol><li>å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°å¹¶æ²¡æœ‰è¢«è§£æï¼Œè€Œåªæ˜¯æ˜¾ç¤ºå‡ºæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²å†…å®¹ <code>--foo=bar</code>ï¼Œ<code>--name=rgyb</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>ApplicationRunner</code> è§£æï¼Œæˆ‘ä»¬ç¨åçœ‹</li><li>åœ¨é‡å†™çš„ <code>run()</code> æ–¹æ³•ä¸Šæœ‰ <code>throws Exception</code> æ ‡è®°ï¼ŒSpring Boot ä¼šå°† <code>CommandLineRunner</code> ä½œä¸ºåº”ç”¨å¯åŠ¨çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœè¿è¡Œ <code>run()</code> æ–¹æ³•æ—¶æŠ›å‡º Exceptionï¼Œåº”ç”¨å°†ä¼šç»ˆæ­¢å¯åŠ¨</li><li>æˆ‘ä»¬åœ¨ç±»ä¸Šæ·»åŠ äº† <code>@Order(2)</code> æ³¨è§£ï¼Œå½“æœ‰å¤šä¸ª <code>CommandLineRunner</code> æ—¶ï¼Œå°†ä¼šæŒ‰ç…§ <code>@Order</code> æ³¨è§£ä¸­çš„æ•°å­—ä»å°åˆ°å¤§æ’åº (æ•°å­—å½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¤æ•°)</li></ol><blockquote><h3 id="âš ï¸ä¸è¦ä½¿ç”¨-Order-å¤ªå¤š"><a href="#âš ï¸ä¸è¦ä½¿ç”¨-Order-å¤ªå¤š" class="headerlink" title="âš ï¸ä¸è¦ä½¿ç”¨ @Order å¤ªå¤š"></a>âš ï¸ä¸è¦ä½¿ç”¨ <code>@Order</code> å¤ªå¤š</h3><p>çœ‹åˆ° order è¿™ä¸ª â€œé»‘ç§‘æŠ€â€ æˆ‘ä»¬ä¼šè§‰å¾—å®ƒå¯ä»¥éå¸¸æ–¹ä¾¿å°†å¯åŠ¨é€»è¾‘æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œï¼Œä½†å¦‚æœä½ è¿™ä¹ˆå†™ï¼Œè¯´æ˜å¤šä¸ªä»£ç ç‰‡æ®µæ˜¯æœ‰ç›¸äº’ä¾èµ–å…³ç³»çš„ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„ä»£ç æ›´å¥½ç»´æŠ¤ï¼Œæˆ‘ä»¬åº”è¯¥å‡å°‘è¿™ç§ä¾èµ–ä½¿ç”¨</p></blockquote><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³ç®€å•çš„è·å–ä»¥ç©ºæ ¼åˆ†éš”çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œé‚£ <code>MyCommandLineRunner</code> å°±è¶³å¤Ÿä½¿ç”¨äº†</p><h2 id="ApplicationRunner"><a href="#ApplicationRunner" class="headerlink" title="ApplicationRunner"></a>ApplicationRunner</h2><p>ä¸Šé¢æåˆ°ï¼Œé€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨å¹¶ä¼ é€’å‚æ•°ï¼Œ<code>MyCommandLineRunner</code> ä¸èƒ½è§£æå‚æ•°ï¼Œå¦‚æœè¦è§£æå‚æ•°ï¼Œé‚£æˆ‘ä»¬å°±è¦ç”¨åˆ° <code>ApplicationRunner</code> å‚æ•°äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Order</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">log.info(<span class="string">"MyApplicationRunner order is 1"</span>);</span><br><span class="line">log.info(<span class="string">"MyApplicationRunner Current parameter is &#123;&#125;:"</span>, args.getOptionValues(<span class="string">"foo"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°æ‰“ jar åŒ…ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar springboot-application-startup-0.0.1-SNAPSHOT.jar --foo=bar,rgyb</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹:<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-23_21-10-14.jpg" alt=""></fancybox></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º: </p><ol><li>åŒ <code>MyCommandLineRunner</code> ç›¸ä¼¼ï¼Œä½† <code>ApplicationRunner</code> å¯ä»¥é€šè¿‡ run æ–¹æ³•çš„ <code>ApplicationArguments</code> å¯¹è±¡è§£æå‡ºå‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶ä¸”æ¯ä¸ªå‚æ•°å¯ä»¥æœ‰å¤šä¸ªå€¼åœ¨é‡Œé¢ï¼Œå› ä¸º <code>getOptionValues</code> æ–¹æ³•è¿”å› List<String> æ•°ç»„</li><li>åœ¨é‡å†™çš„ <code>run()</code> æ–¹æ³•ä¸Šæœ‰ <code>throws Exception</code> æ ‡è®°ï¼ŒSpring Boot ä¼šå°† <code>CommandLineRunner</code> ä½œä¸ºåº”ç”¨å¯åŠ¨çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœè¿è¡Œ <code>run()</code> æ–¹æ³•æ—¶æŠ›å‡º Exceptionï¼Œåº”ç”¨å°†ä¼šç»ˆæ­¢å¯åŠ¨</li><li><code>ApplicationRunner</code> ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@Order</code> æ³¨è§£è¿›è¡Œæ’åºï¼Œä»å¯åŠ¨ç»“æœæ¥çœ‹ï¼Œå®ƒä¸ <code>CommandLineRunner</code> å…±äº« order çš„é¡ºåºï¼Œç¨åæˆ‘ä»¬é€šè¿‡æºç æ¥éªŒè¯è¿™ä¸ªç»“è®º</li></ol><h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è·å–å¤æ‚çš„å‘½ä»¤è¡Œå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ApplicationRunner</code> </p><h2 id="ApplicationListener"><a href="#ApplicationListener" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h2><p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦è·å–å‘½ä»¤è¡Œå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯åŠ¨é€»è¾‘ç»‘å®šåˆ° Spring çš„ <code>ApplicationReadyEvent</code> ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationReadyEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationReadyEvent applicationReadyEvent)</span> </span>&#123;</span><br><span class="line">log.info(<span class="string">"MyApplicationListener is started up"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºæŸ¥çœ‹ç»“æœ:<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-23_21-27-09.jpg" alt=""></fancybox></p><p>åˆ°è¿™æˆ‘ä»¬å¯ä»¥çœ‹å‡º:</p><ol><li><code>ApplicationReadyEvent</code> <strong>å½“ä¸”ä»…å½“</strong> åœ¨åº”ç”¨ç¨‹åºå°±ç»ªä¹‹åæ‰è¢«è§¦å‘ï¼Œç”šè‡³æ˜¯è¯´ä¸Šé¢çš„ Listener è¦åœ¨æœ¬æ–‡è¯´çš„æ‰€æœ‰è§£å†³æ–¹æ¡ˆéƒ½æ‰§è¡Œäº†ä¹‹åæ‰ä¼šè¢«è§¦å‘ï¼Œæœ€ç»ˆç»“è®ºè¯·ç¨åçœ‹</li><li>ä»£ç ä¸­æˆ‘ç”¨ <code>Order(0)</code> æ¥æ ‡è®°ï¼Œæ˜¾ç„¶ ApplicationListener ä¹Ÿæ˜¯å¯ä»¥ç”¨è¯¥æ³¨è§£è¿›è¡Œæ’åºçš„ï¼ŒæŒ‰æ•°å­—å¤§å°æ’åºï¼Œåº”è¯¥æ˜¯æœ€å…ˆæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªé¡ºåºä»…ç”¨äºåŒç±»å‹çš„ ApplicationListener ä¹‹é—´çš„æ’åºï¼Œä¸å‰é¢æåˆ°çš„ <code>ApplicationRunners</code> å’Œ <code>CommandLineRunners</code> çš„æ’åºå¹¶ä¸å…±äº«</li></ol><h3 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦è·å–å‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>ApplicationListener&lt;ApplicationReadyEvent&gt;</code> åˆ›å»ºä¸€äº›å…¨å±€çš„å¯åŠ¨é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å®ƒè·å– <a href="https://dayarch.top/p/spring-boot-configurationProperties-usage.html">Spring Boot æ”¯æŒçš„ configuration properties ç¯å¢ƒå˜é‡å‚æ•°</a></p><hr><p>å¦‚æœä½ çœ‹è¿‡æˆ‘ä¹‹å‰å†™çš„ <strong>Spring Bean ç”Ÿå‘½å‘¨æœŸä¸‰éƒ¨æ›²:</strong></p><ul><li><a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a></li><li><a href="https://dayarch.top/p/spring-bean-lifecycle-destroy.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜å°½</a></li><li><a href="https://dayarch.top/p/spring-aware.html">Spring Aware åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</a></li></ul><p>é‚£ä¹ˆä½ ä¼šå¯¹ä¸‹é¢ä¸¤ç§æ–¹å¼éå¸¸ç†Ÿæ‚‰äº†</p><h2 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h2><p>åˆ›å»ºå¯åŠ¨é€»è¾‘çš„å¦ä¸€ç§ç®€å•è§£å†³æ–¹æ¡ˆæ˜¯æä¾›ä¸€ç§åœ¨ bean åˆ›å»ºæœŸé—´ç”± Spring è°ƒç”¨çš„åˆå§‹åŒ–æ–¹æ³•ã€‚æˆ‘ä»¬è¦åšçš„å°±åªæ˜¯å°† <code>@PostConstruct</code> æ³¨è§£æ·»åŠ åˆ°æ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@DependsOn</span>(<span class="string">"myApplicationListener"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPostConstructBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPostConstruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">log.info(<span class="string">"MyPostConstructBean"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œç»“æœ:<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-25_15-34-52.jpg" alt=""></fancybox></p><p>ä»ä¸Šé¢è¿è¡Œç»“æœå¯ä»¥çœ‹å‡º:</p><ol><li>Spring åˆ›å»ºå®Œ beanä¹‹å (<strong>åœ¨å¯åŠ¨ä¹‹å‰</strong>)ï¼Œä¾¿ä¼šç«‹å³è°ƒç”¨ <code>@PostConstruct</code> æ³¨è§£æ ‡è®°çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ä½¿ç”¨ <code>@Order</code> æ³¨è§£å¯¹å…¶è¿›è¡Œè‡ªç”±æ’åºï¼Œå› ä¸ºå®ƒå¯èƒ½ä¾èµ–äº <code>@Autowired</code> æ’å…¥åˆ°æˆ‘ä»¬ bean ä¸­çš„å…¶ä»– Spring beanã€‚</li><li>ç›¸åï¼Œå®ƒå°†åœ¨ä¾èµ–äºå®ƒçš„æ‰€æœ‰ bean è¢«åˆå§‹åŒ–ä¹‹åè¢«è°ƒç”¨ï¼Œå¦‚æœè¦æ·»åŠ äººä¸ºçš„ä¾èµ–å…³ç³»å¹¶ç”±æ­¤åˆ›å»ºä¸€ä¸ªæ’åºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>@DependsOn</code> æ³¨è§£ï¼ˆè™½ç„¶å¯ä»¥æ’åºï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨ï¼Œç†ç”±å’Œ <code>@Order</code> ä¸€æ ·ï¼‰</li></ol><h3 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><code>@PostConstruct</code> æ–¹æ³•å›ºæœ‰åœ°ç»‘å®šåˆ°ç°æœ‰çš„ Spring beanï¼Œå› æ­¤åº”ä»…å°†å…¶ç”¨äºæ­¤å•ä¸ª bean çš„åˆå§‹åŒ–é€»è¾‘ï¼›</p><h2 id="InitializingBean"><a href="#InitializingBean" class="headerlink" title="InitializingBean"></a>InitializingBean</h2><p>ä¸ <code>@PostConstruct</code> è§£å†³æ–¹æ¡ˆéå¸¸ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° <code>InitializingBean</code> æ¥å£ï¼Œå¹¶è®© Spring è°ƒç”¨æŸä¸ªåˆå§‹åŒ–æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInitializingBean</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">log.info(<span class="string">"MyInitializingBean.afterPropertiesSet()"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œç»“æœ:<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-25_15-30-31.jpg" alt=""></fancybox></p><p>ä»ä¸Šé¢çš„è¿è¡Œç»“æœä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å’Œ <code>@PostConstruct</code> ä¸€æ ·çš„æ•ˆæœï¼Œä½†äºŒè€…è¿˜æ˜¯æœ‰å·®åˆ«çš„</p><blockquote><h3 id="âš ï¸-PostConstruct-å’Œ-afterPropertiesSet-åŒºåˆ«"><a href="#âš ï¸-PostConstruct-å’Œ-afterPropertiesSet-åŒºåˆ«" class="headerlink" title="âš ï¸ @PostConstruct å’Œ afterPropertiesSet åŒºåˆ«"></a>âš ï¸ <code>@PostConstruct</code> å’Œ <code>afterPropertiesSet</code> åŒºåˆ«</h3><ol><li>afterPropertiesSetï¼Œé¡¾åæ€ä¹‰ã€Œåœ¨å±æ€§è®¾ç½®ä¹‹åã€ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œè¯¥ bean çš„æ‰€æœ‰å±æ€§å·²ç»è¢« Spring å¡«å……ã€‚å¦‚æœæˆ‘ä»¬åœ¨æŸäº›å±æ€§ä¸Šä½¿ç”¨ <code>@Autowired</code>ï¼ˆå¸¸è§„æ“ä½œåº”è¯¥ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼‰ï¼Œé‚£ä¹ˆ Spring å°†åœ¨è°ƒç”¨<code>afterPropertiesSet</code> ä¹‹å‰å°† bean æ³¨å…¥è¿™äº›å±æ€§ã€‚ä½† <code>@PostConstruct</code> å¹¶æ²¡æœ‰è¿™äº›å±æ€§å¡«å……é™åˆ¶</li><li>æ‰€ä»¥ <code>InitializingBean.afterPropertiesSet</code> è§£å†³æ–¹æ¡ˆæ¯”ä½¿ç”¨ <code>@PostConstruct</code> æ›´å®‰å…¨ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬ä¾èµ–å°šæœªè‡ªåŠ¨æ³¨å…¥çš„ <code>@Autowired</code> å­—æ®µï¼Œåˆ™ <code>@PostConstruct</code> æ–¹æ³•å¯èƒ½ä¼šé‡åˆ° NullPointerExceptions </li></ol></blockquote><h3 id="å°ç»“-4"><a href="#å°ç»“-4" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œåˆ™è¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½æ˜¯ç­‰æ•ˆçš„</p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>è¯·æ‰“å¼€ä½ çš„ IDE (é‡ç‚¹ä»£ç å·²æ ‡è®°æ³¨é‡Š):</p><blockquote><p><code>MyCommandLineRunner</code> å’Œ <code>ApplicationRunner</code> æ˜¯åœ¨ä½•æ—¶è¢«è°ƒç”¨çš„å‘¢ï¼Ÿ</p></blockquote><p>æ‰“å¼€ <code>SpringApplication.java</code> ç±»ï¼Œé‡Œé¢æœ‰ <code>callRunners</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callRunners</span><span class="params">(ApplicationContext context, ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">    List&lt;Object&gt; runners = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//ä»ä¸Šä¸‹æ–‡è·å– ApplicationRunner ç±»å‹çš„ bean</span></span><br><span class="line">    runners.addAll(context.getBeansOfType(ApplicationRunner.class).values());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»ä¸Šä¸‹æ–‡è·å– CommandLineRunner ç±»å‹çš„ bean</span></span><br><span class="line">    runners.addAll(context.getBeansOfType(CommandLineRunner.class).values());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹äºŒè€…è¿›è¡Œæ’åºï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆäºŒè€…çš„ order æ˜¯å¯ä»¥å…±äº«çš„äº†</span></span><br><span class="line">    AnnotationAwareOrderComparator.sort(runners);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†å¯¹å…¶è¿›è¡Œè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">for</span> (Object runner : <span class="keyword">new</span> LinkedHashSet&lt;&gt;(runners)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (runner <span class="keyword">instanceof</span> ApplicationRunner) &#123;</span><br><span class="line">            callRunner((ApplicationRunner) runner, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (runner <span class="keyword">instanceof</span> CommandLineRunner) &#123;</span><br><span class="line">            callRunner((CommandLineRunner) runner, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¼ºçƒˆå»ºè®®å®Œæ•´çœ‹ä¸€ä¸‹ <code>SpringApplication.java</code> çš„å…¨éƒ¨ä»£ç ï¼ŒSpring Boot å¯åŠ¨è¿‡ç¨‹åŠåŸç†éƒ½å¯ä»¥ä»è¿™ä¸ªç±»ä¸­æ‰¾åˆ°ä¸€äº›ç­”æ¡ˆ</strong></p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä¸Šé¢ç¨‹åºè¿è¡Œç»“æœï¼Œ <code>afterPropertiesSet</code> æ–¹æ³•è°ƒç”¨å…ˆäº <code>@PostConstruct</code> æ–¹æ³•ï¼Œä½†è¿™å’Œæˆ‘ä»¬åœ¨ <a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a> ä¸­çš„è°ƒç”¨é¡ºåºæ°æ°ç›¸åï¼Œä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿ</li><li><code>MyPostConstructBean</code> é€šè¿‡ <code>@DependsOn(&quot;myApplicationListener&quot;)</code> ä¾èµ–äº† MyApplicationListenerï¼Œä¸ºä»€ä¹ˆè°ƒç”¨ç»“æœå‰è€…å…ˆä¸åè€…å‘¢ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆä¸å»ºè®® <code>@Autowired</code> å½¢å¼ä¾èµ–æ³¨å…¥</li></ol><p>åœ¨å†™ Spring Bean ç”Ÿå‘½å‘¨æœŸæ—¶å°±æœ‰æœ‹å‹é—®æˆ‘ä¸ä¹‹ç›¸å…³çš„é—®é¢˜ï¼Œæ˜¾ç„¶ä»–ä»¬åœ¨æ¦‚å¿µä¸Šæœ‰ä¸€äº›å«æ··ï¼Œæ‰€ä»¥ï¼Œä»”ç»†ç†è§£ä¸Šé¢çš„é—®é¢˜å°†ä¼šå¸®åŠ©ä½ åŠ æ·±å¯¹ Spring Bean ç”Ÿå‘½å‘¨æœŸçš„ç†è§£</p><h2 id="Spring-Bootåº”ç”¨å¯åŠ¨æ‰§è¡Œä»£ç æ¦‚è§ˆå›¾"><a href="#Spring-Bootåº”ç”¨å¯åŠ¨æ‰§è¡Œä»£ç æ¦‚è§ˆå›¾" class="headerlink" title="Spring Bootåº”ç”¨å¯åŠ¨æ‰§è¡Œä»£ç æ¦‚è§ˆå›¾"></a>Spring Bootåº”ç”¨å¯åŠ¨æ‰§è¡Œä»£ç æ¦‚è§ˆå›¾</h2><p>æœ€åç”»ä¸€å¼ å›¾ç”¨æ¥æ€»ç»“è¿™å‡ ç§æ–¹å¼<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgSpringBoot_exec_in_start1.png" alt=""></fancybox></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Bean </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot @ConfigurationProperties æ³¨è§£æœ€å¼ºä½¿ç”¨è¯¦è§£</title>
      <link href="//p/spring-boot-configurationProperties-usage.html"/>
      <url>//p/spring-boot-configurationProperties-usage.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ç¼–å†™é¡¹ç›®ä»£ç æ—¶ï¼Œæˆ‘ä»¬è¦æ±‚æ›´çµæ´»çš„é…ç½®ï¼Œæ›´å¥½çš„æ¨¡å—åŒ–æ•´åˆã€‚åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œä¸ºæ»¡è¶³ä»¥ä¸Šè¦æ±‚ï¼Œæˆ‘ä»¬å°†å¤§é‡çš„å‚æ•°é…ç½®åœ¨ application.properties æˆ– application.yml æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ <code>@ConfigurationProperties</code> æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„è·å–è¿™äº›å‚æ•°å€¼</p><h2 id="ä½¿ç”¨-ConfigurationProperties-é…ç½®æ¨¡å—"><a href="#ä½¿ç”¨-ConfigurationProperties-é…ç½®æ¨¡å—" class="headerlink" title="ä½¿ç”¨ @ConfigurationProperties é…ç½®æ¨¡å—"></a>ä½¿ç”¨ @ConfigurationProperties é…ç½®æ¨¡å—</h2><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨æ­å»ºä¸€ä¸ªå‘é€é‚®ä»¶çš„æ¨¡å—ã€‚åœ¨æœ¬åœ°æµ‹è¯•ï¼Œæˆ‘ä»¬ä¸æƒ³è¯¥æ¨¡å—çœŸçš„å‘é€é‚®ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‚æ•°æ¥ã€Œå¼€å…³ã€ disable è¿™ä¸ªåŠŸèƒ½ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ºè¿™äº›é‚®ä»¶é…ç½®ä¸€ä¸ªé»˜è®¤çš„ä¸»é¢˜ï¼Œè¿™æ ·ï¼Œå½“æˆ‘ä»¬æŸ¥çœ‹é‚®ä»¶æ”¶ä»¶ç®±ï¼Œé€šè¿‡é‚®ä»¶ä¸»é¢˜å¯ä»¥å¿«é€Ÿåˆ¤æ–­å‡ºè¿™æ˜¯æµ‹è¯•é‚®ä»¶</p><p>åœ¨ application.properties æ–‡ä»¶ä¸­åˆ›å»ºè¿™äº›å‚æ•°:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-24-05%402x.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@Value</code> æ³¨è§£æˆ–ç€ä½¿ç”¨ Spring <code>Environment</code> bean è®¿é—®è¿™äº›å±æ€§ï¼Œæ˜¯è¿™ç§æ³¨å…¥é…ç½®æ–¹å¼æœ‰æ—¶æ˜¾å¾—å¾ˆç¬¨é‡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼(<code>@ConfigurationProperties</code> )æ¥è·å–è¿™äº›å±æ€§</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-24-34%402x.png" alt=""></p><p><code>@ConfigurationProperties</code> çš„åŸºæœ¬ç”¨æ³•éå¸¸ç®€å•:æˆ‘ä»¬ä¸ºæ¯ä¸ªè¦æ•è·çš„å¤–éƒ¨å±æ€§æä¾›ä¸€ä¸ªå¸¦æœ‰å­—æ®µçš„ç±»ã€‚è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p><ul><li>å‰ç¼€å®šä¹‰äº†å“ªäº›å¤–éƒ¨å±æ€§å°†ç»‘å®šåˆ°ç±»çš„å­—æ®µä¸Š</li><li>æ ¹æ® Spring Boot å®½æ¾çš„ç»‘å®šè§„åˆ™ï¼Œç±»çš„å±æ€§åç§°å¿…é¡»ä¸å¤–éƒ¨å±æ€§çš„åç§°åŒ¹é…</li><li>æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç”¨ä¸€ä¸ªå€¼åˆå§‹åŒ–ä¸€ä¸ªå­—æ®µæ¥å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼</li><li>ç±»æœ¬èº«å¯ä»¥æ˜¯åŒ…ç§æœ‰çš„</li><li>ç±»çš„å­—æ®µå¿…é¡»æœ‰å…¬å…± setter æ–¹æ³•</li></ul><blockquote><h3 id="Spring-å®½æ¾ç»‘å®šè§„åˆ™-relaxed-binding"><a href="#Spring-å®½æ¾ç»‘å®šè§„åˆ™-relaxed-binding" class="headerlink" title="Spring å®½æ¾ç»‘å®šè§„åˆ™ (relaxed binding)"></a>Spring å®½æ¾ç»‘å®šè§„åˆ™ (relaxed binding)</h3><p>Springä½¿ç”¨ä¸€äº›å®½æ¾çš„ç»‘å®šå±æ€§è§„åˆ™ã€‚å› æ­¤ï¼Œä»¥ä¸‹å˜ä½“éƒ½å°†ç»‘å®šåˆ° hostName å±æ€§ä¸Š:</p></blockquote><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-27-10%402x.png" alt=""></p><p>å¦‚æœæˆ‘ä»¬å°† MailModuleProperties ç±»å‹çš„ bean æ³¨å…¥åˆ°å¦ä¸€ä¸ª bean ä¸­ï¼Œè¿™ä¸ª bean ç°åœ¨å¯ä»¥ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼è®¿é—®é‚£äº›å¤–éƒ¨é…ç½®å‚æ•°çš„å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦è®© Spring çŸ¥é“æˆ‘ä»¬çš„ @ConfigurationProperties ç±»å­˜åœ¨ï¼Œä»¥ä¾¿å°†å…¶åŠ è½½åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­( <a href="https://dayarch.top/p/difference-between-beanfactory-and-applicationcontext.html">é¢è¯•è¿˜ä¸çŸ¥é“ BeanFactory å’Œ ApplicationContext çš„åŒºåˆ«ï¼Ÿ</a></p><h2 id="æ¿€æ´»-ConfigurationProperties"><a href="#æ¿€æ´»-ConfigurationProperties" class="headerlink" title="æ¿€æ´» @ConfigurationProperties"></a>æ¿€æ´» @ConfigurationProperties</h2><p>å¯¹äº Spring Bootï¼Œåˆ›å»ºä¸€ä¸ª MailModuleProperties ç±»å‹çš„ beanï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼å°†å…¶æ·»åŠ åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  @Component æ³¨è§£è®© Component Scan æ‰«æåˆ°<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-27-33%402x.png" alt=""></p><p>å¾ˆæ˜¾ç„¶ï¼Œåªæœ‰å½“ç±»æ‰€åœ¨çš„åŒ…è¢« Spring <code>@ComponentScan</code> æ³¨è§£æ‰«æåˆ°æ‰ä¼šç”Ÿæ•ˆï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ³¨è§£ä¼šæ‰«æåœ¨ä¸»åº”ç”¨ç±»ä¸‹çš„æ‰€æœ‰åŒ…ç»“æ„</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ Spring çš„ Java Configuration ç‰¹æ€§å®ç°åŒæ ·çš„æ•ˆæœ:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-29-20%402x.png" alt=""></p><p>åªè¦ MailModuleConfiguration ç±»è¢« Spring Boot åº”ç”¨æ‰«æåˆ°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­è®¿é—® MailModuleProperties bean</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>@EnableConfigurationProperties</code> æ³¨è§£è®©æˆ‘ä»¬çš„ç±»è¢« Spring Boot æ‰€çŸ¥é“ï¼Œåœ¨è¯¥æ³¨è§£ä¸­å…¶å®æ˜¯ç”¨äº†<code>@Import(EnableConfigurationPropertiesImportSelector.class)</code> å®ç°ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-29-42%402x.png" alt=""></p><blockquote><h3 id="æ¿€æ´»ä¸€ä¸ª-ConfigurationProperties-ç±»çš„æœ€ä½³æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ¿€æ´»ä¸€ä¸ª-ConfigurationProperties-ç±»çš„æœ€ä½³æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ¿€æ´»ä¸€ä¸ª @ConfigurationProperties ç±»çš„æœ€ä½³æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ¿€æ´»ä¸€ä¸ª @ConfigurationProperties ç±»çš„æœ€ä½³æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æ‰€æœ‰ä¸Šè¿°æ–¹æ³•éƒ½åŒæ ·æœ‰æ•ˆã€‚ç„¶è€Œï¼Œæˆ‘å»ºè®®æ¨¡å—åŒ–ä½ çš„åº”ç”¨ç¨‹åºï¼Œå¹¶è®©æ¯ä¸ªæ¨¡å—æä¾›è‡ªå·±çš„<code>@ConfigurationProperties</code> ç±»ï¼Œåªæä¾›å®ƒéœ€è¦çš„å±æ€§ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­å¯¹é‚®ä»¶æ¨¡å—æ‰€åšçš„é‚£æ ·ã€‚è¿™ä½¿å¾—åœ¨ä¸å½±å“å…¶ä»–æ¨¡å—çš„æƒ…å†µä¸‹é‡æ„ä¸€ä¸ªæ¨¡å—ä¸­çš„å±æ€§å˜å¾—å®¹æ˜“ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä¸å»ºè®®åœ¨åº”ç”¨ç¨‹åºç±»æœ¬èº«ä¸Šä½¿ç”¨ <code>@EnableConfigurationProperties</code>ï¼Œå¦‚è®¸å¤šå…¶ä»–æ•™ç¨‹ä¸­æ‰€ç¤ºï¼Œæ˜¯åœ¨ç‰¹å®šäºæ¨¡å—çš„ @Configuration ç±»ä¸Šä½¿ç”¨<code>@EnableConfigurationProperties</code>ï¼Œè¯¥ç±»ä¹Ÿå¯ä»¥åˆ©ç”¨åŒ…ç§æœ‰çš„å¯è§æ€§å¯¹åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†éšè—å±æ€§ã€‚</p></blockquote><h2 id="æ— æ³•è½¬æ¢çš„å±æ€§"><a href="#æ— æ³•è½¬æ¢çš„å±æ€§" class="headerlink" title="æ— æ³•è½¬æ¢çš„å±æ€§"></a>æ— æ³•è½¬æ¢çš„å±æ€§</h2><p>å¦‚æœæˆ‘ä»¬åœ¨ application.properties å±æ€§ä¸Šå®šä¹‰çš„å±æ€§ä¸èƒ½è¢«æ­£ç¡®çš„è§£æä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå‡å¦‚æˆ‘ä»¬ä¸ºåŸæœ¬åº”è¯¥ä¸ºå¸ƒå°”å€¼çš„å±æ€§æä¾›çš„å€¼ä¸º â€˜fooâ€™:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-30-09%402x.png" alt=""></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å°†ä¼šå¯åŠ¨å¤±è´¥ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under 'myapp.mail.enabled' to java.lang.Boolean:</span><br><span class="line"></span><br><span class="line">    Property: myapp.mail.enabled</span><br><span class="line">    Value: foo</span><br><span class="line">    Origin: class path resource [application.properties]:1:20</span><br><span class="line">    Reason: failed to convert java.lang.String to java.lang.Boolean</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä¸ºå±æ€§é…ç½®é”™è¯¯çš„å€¼æ—¶ï¼Œè€Œåˆä¸å¸Œæœ› Spring Boot åº”ç”¨å¯åŠ¨å¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® <code>ignoreInvalidFields</code> å±æ€§ä¸º true (é»˜è®¤ä¸º false)<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-49-56%402x.png" alt=""></p><p>è¿™æ ·ï¼ŒSpring Boot å°†ä¼šè®¾ç½® enabled å­—æ®µä¸ºæˆ‘ä»¬åœ¨ Java ä»£ç é‡Œè®¾å®šå¥½çš„é»˜è®¤å€¼ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®é»˜è®¤å€¼ï¼Œenabled å°†ä¸º nullï¼Œå› ä¸ºè¿™é‡Œå®šä¹‰çš„æ˜¯ boolean çš„åŒ…è£…ç±» Boolean</p><h2 id="æœªçŸ¥çš„å±æ€§"><a href="#æœªçŸ¥çš„å±æ€§" class="headerlink" title="æœªçŸ¥çš„å±æ€§"></a>æœªçŸ¥çš„å±æ€§</h2><p>å’Œä¸Šé¢çš„æƒ…å†µæœ‰äº›ç›¸åï¼Œå¦‚æœæˆ‘ä»¬åœ¨ application.properties æ–‡ä»¶æä¾›äº† MailModuleProperties ç±»ä¸çŸ¥é“çš„å±æ€§ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-52-20%402x.png" alt=""></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šå¿½ç•¥é‚£äº›ä¸èƒ½ç»‘å®šåˆ° <code>@ConfigurationProperties</code> ç±»å­—æ®µçš„å±æ€§</p><p>ç„¶è€Œï¼Œå½“é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå±æ€§å®é™…ä¸Šæ²¡æœ‰ç»‘å®šåˆ° <code>@ConfigurationProperties</code> ç±»æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å¯åŠ¨å¤±è´¥ã€‚ä¹Ÿè®¸æˆ‘ä»¬ä»¥å‰ä½¿ç”¨è¿‡è¿™ä¸ªé…ç½®å±æ€§ï¼Œä½†æ˜¯å®ƒå·²ç»è¢«åˆ é™¤äº†ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¸Œæœ›è¢«è§¦å‘å‘ŠçŸ¥æ‰‹åŠ¨ä» application.properties åˆ é™¤è¿™ä¸ªå±æ€§</p><p>ä¸ºäº†å®ç°ä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬ä»…éœ€è¦å°† <code>ignoreUnknownFields</code> å±æ€§è®¾ç½®ä¸º false (é»˜è®¤æ˜¯ true)<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-53-28%402x.png" alt=""></p><p>ç°åœ¨ï¼Œåº”ç”¨å¯åŠ¨æ—¶ï¼Œæ§åˆ¶å°ä¼šåé¦ˆæˆ‘ä»¬å¼‚å¸¸ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Binding to target [Bindable@cf65451 type = com.example.configurationproperties.properties.MailModuleProperties, value = 'provided', annotations = array&lt;Annotation&gt;[@org.springframework.boot.context.properties.ConfigurationProperties(value=myapp.mail, prefix=myapp.mail, ignoreInvalidFields=false, ignoreUnknownFields=false)]] failed:</span><br><span class="line"></span><br><span class="line">    Property: myapp.mail.unknown-property</span><br><span class="line">    Value: foo</span><br><span class="line">    Origin: class path resource [application.properties]:3:29</span><br><span class="line">    Reason: The elements [myapp.mail.unknown-property] were left unbound.</span><br></pre></td></tr></table></figure><blockquote><p> å¼ƒç”¨è­¦å‘Šâš ï¸(Deprecation Warning)<br> <code>ignoreUnknownFields</code> åœ¨æœªæ¥ Spring Boot çš„ç‰ˆæœ¬ä¸­ä¼šè¢«æ ‡è®°ä¸º deprecatedï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½æœ‰ä¸¤ä¸ªå¸¦æœ‰ <code>@ConfigurationProperties</code> çš„ç±»ï¼ŒåŒæ—¶ç»‘å®šåˆ°äº†åŒä¸€ä¸ªå‘½åç©ºé—´ (namespace) ä¸Šï¼Œå…¶ä¸­ä¸€ä¸ªç±»å¯èƒ½çŸ¥é“æŸä¸ªå±æ€§ï¼Œå¦ä¸€ä¸ªç±»å´ä¸çŸ¥é“æŸä¸ªå±æ€§ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥</p></blockquote><h2 id="å¯åŠ¨æ—¶æ ¡éªŒ-ConfigurationProperties"><a href="#å¯åŠ¨æ—¶æ ¡éªŒ-ConfigurationProperties" class="headerlink" title="å¯åŠ¨æ—¶æ ¡éªŒ @ConfigurationProperties"></a>å¯åŠ¨æ—¶æ ¡éªŒ @ConfigurationProperties</h2><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›é…ç½®å‚æ•°åœ¨ä¼ å…¥åˆ°åº”ç”¨ä¸­æ—¶æœ‰æ•ˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å­—æ®µä¸Šæ·»åŠ  <code>bean validation</code> æ³¨è§£ï¼ŒåŒæ—¶åœ¨ç±»ä¸Šæ·»åŠ  <code>@Validated</code> æ³¨è§£<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-55-40%402x.png" alt=""></p><p>å¦‚æœæˆ‘ä»¬å¿˜è®°åœ¨ application.properties æ–‡ä»¶è®¾ç½® enabled å±æ€§ï¼Œå¹¶ä¸”è®¾ç½® defaultSubject ä¸ºç©º<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-56-53%402x.png" alt=""></p><p>åº”ç”¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ° <code>BindValidationException</code> </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Binding to target org.springframework.boot.context.properties.bind.BindException: Failed to bind properties under 'myapp.mail' to com.example.configurationproperties.properties.MailModuleProperties failed:</span><br><span class="line"></span><br><span class="line">    Property: myapp.mail.enabled</span><br><span class="line">    Value: null</span><br><span class="line">    Reason: must not be null</span><br><span class="line"></span><br><span class="line">    Property: myapp.mail.defaultSubject</span><br><span class="line">    Value: null</span><br><span class="line">    Reason: must not be empty</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™äº›é»˜è®¤çš„éªŒè¯æ³¨è§£ä¸èƒ½æ»¡è¶³ä½ çš„éªŒè¯è¦æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ³¨è§£</p><p>å¦‚æœä½ çš„éªŒè¯é€»è¾‘å¾ˆç‰¹æ®Šï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ç”¨ @PostConstruct æ ‡è®°ï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œæ–¹æ³•æŠ›å‡ºå¼‚å¸¸å³å¯, å…³äº @PostConstructï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Bean çš„ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a></p><h2 id="å¤æ‚å±æ€§ç±»å‹"><a href="#å¤æ‚å±æ€§ç±»å‹" class="headerlink" title="å¤æ‚å±æ€§ç±»å‹"></a>å¤æ‚å±æ€§ç±»å‹</h2><p>å¤šæ•°æƒ…å†µï¼Œæˆ‘ä»¬ä¼ é€’ç»™åº”ç”¨çš„å‚æ•°æ˜¯åŸºæœ¬çš„å­—ç¬¦ä¸²æˆ–æ•°å­—ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦ä¼ é€’è¯¸å¦‚ List çš„æ•°æ®ç±»å‹</p><h3 id="List-å’Œ-Set"><a href="#List-å’Œ-Set" class="headerlink" title="List å’Œ Set"></a>List å’Œ Set</h3><p>å‡å¦‚ï¼Œæˆ‘ä»¬ä¸ºé‚®ä»¶æ¨¡å—æä¾›äº†ä¸€ä¸ª SMTP æœåŠ¡çš„åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è¯¥å±æ€§åˆ° MailModuleProperties ç±»ä¸­<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-58-11%402x.png" alt=""></p><p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼è®© Spring Boot è‡ªåŠ¨å¡«å……è¯¥ list å±æ€§</p><h4 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h4><p>åœ¨ application.properties æ–‡ä»¶ä¸­ä»¥æ•°ç»„å½¢å¼ä¹¦å†™<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-59-06%402x.png" alt=""></p><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p>YAML æœ¬èº«æ”¯æŒ list ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ application.yml æ–‡ä»¶ä¸­æ·»åŠ :<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-59-34%402x.png" alt=""></p><p>set é›†åˆä¹Ÿæ˜¯è¿™ç§æ–¹å¼çš„é…ç½®æ–¹å¼ï¼Œä¸å†é‡å¤ä¹¦å†™ã€‚å¦å¤–YAML æ˜¯æ›´å¥½çš„é˜…è¯»æ–¹å¼ï¼Œå±‚æ¬¡åˆ†æ˜ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­æ›´æ¨èå¤§å®¶ä½¿ç”¨è¯¥ç§æ–¹å¼åšæ•°æ®é…ç½®</p><h3 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h3><p>Spring Boot å†…ç½®æ”¯æŒä»é…ç½®å‚æ•°ä¸­è§£æ durations (æŒç»­æ—¶é—´)ï¼Œ<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-conversion-duration" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a> ç»™å‡ºäº†æ˜ç¡®çš„è¯´æ˜<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-00-08%402x.png" alt=""></p><p>æˆ‘ä»¬æ—¢å¯ä»¥é…ç½®æ¯«ç§’æ•°æ•°å€¼ï¼Œä¹Ÿå¯é…ç½®å¸¦æœ‰å•ä½çš„æ–‡æœ¬:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-01-01%402x.png" alt=""></p><p>å®˜ç½‘ä¸Šå·²æ˜ç¡®è¯´æ˜ï¼Œé…ç½® duration ä¸å†™å•ä½ï¼Œé»˜è®¤æŒ‰ç…§æ¯«ç§’æ¥æŒ‡å®šï¼Œæˆ‘ä»¬ä¹Ÿå¯å·²é€šè¿‡ @DurationUnit æ¥æŒ‡å®šå•ä½:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-01-47%402x.png" alt=""></p><p> å¸¸ç”¨å•ä½å¦‚ä¸‹:</p><ul><li><code>ns</code> for nanoseconds (çº³ç§’)</li><li><code>us</code> for microseconds (å¾®ç§’)</li><li><code>ms</code> for milliseconds (æ¯«ç§’)</li><li><code>s</code> for seconds (ç§’)</li><li><code>m</code> for minutes (åˆ†)</li><li><code>h</code> for hours (æ—¶)</li><li><code>d</code> for days (å¤©)</li></ul><h3 id="DataSize"><a href="#DataSize" class="headerlink" title="DataSize"></a>DataSize</h3><p>ä¸ Duration çš„ç”¨æ³•ä¸€æ¯›ä¸€æ ·ï¼Œé»˜è®¤å•ä½æ˜¯ byte (å­—èŠ‚)ï¼Œå¯ä»¥é€šè¿‡ @DataSizeUnit  å•ä½æŒ‡å®š:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-02-34%402x.png" alt=""></p><p>æ·»åŠ é…ç½®<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-03-17%402x.png" alt=""></p><p>ä½†æ˜¯ï¼Œæˆ‘æµ‹è¯•çš„æ—¶å€™æ‰“å°å‡ºæ¥ç»“æœéƒ½æ˜¯ä»¥ B (bytes) æ¥æ˜¾ç¤º</p><p>å¸¸è§å•ä½å¦‚ä¸‹:</p><ul><li><code>B</code> for bytes</li><li><code>KB</code> for kilobytes</li><li><code>MB</code> for megabytes</li><li><code>GB</code> for gigabytes</li><li><code>TB</code> for terabytes</li></ul><h2 id="è‡ªå®šä¹‰ç±»å‹"><a href="#è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹"></a>è‡ªå®šä¹‰ç±»å‹</h2><p>æœ‰äº›æƒ…å†µï¼Œæˆ‘ä»¬æƒ³è§£æé…ç½®å‚æ•°åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å¯¹è±¡ç±»å‹ä¸Šï¼Œå‡è®¾ï¼Œæˆ‘ä»¬æˆ‘ä»¬è®¾ç½®æœ€å¤§åŒ…è£¹é‡é‡:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-04-08%402x.png" alt=""></p><p>åœ¨ MailModuleProperties ä¸­æ·»åŠ  Weight å±æ€§<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-04-51%402x.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥æ¨¡ä»¿ DataSize å’Œ Duration åˆ›é€ è‡ªå·±çš„ converter (è½¬æ¢å™¨)<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-05-39%402x.png" alt=""></p><p>å°†å…¶æ³¨å†Œåˆ° Spring Boot ä¸Šä¸‹æ–‡ä¸­<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-07-03%402x.png" alt=""></p><p><code>@ConfigurationPropertiesBinding</code> æ³¨è§£æ˜¯è®© Spring Boot çŸ¥é“ä½¿ç”¨è¯¥è½¬æ¢å™¨åšæ•°æ®ç»‘å®š</p><h2 id="ä½¿ç”¨-Spring-Boot-Configuration-Processor-å®Œæˆè‡ªåŠ¨è¡¥å…¨"><a href="#ä½¿ç”¨-Spring-Boot-Configuration-Processor-å®Œæˆè‡ªåŠ¨è¡¥å…¨" class="headerlink" title="ä½¿ç”¨ Spring Boot Configuration Processor å®Œæˆè‡ªåŠ¨è¡¥å…¨"></a>ä½¿ç”¨ Spring Boot Configuration Processor å®Œæˆè‡ªåŠ¨è¡¥å…¨</h2><p>æˆ‘ä»¬å‘é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–:</p><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-09-28%402x.png" alt=""></p><h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-09-58%402x.png" alt=""></p><p>é‡æ–° build é¡¹ç›®ä¹‹åï¼Œconfiguration processor ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª JSON æ–‡ä»¶:<br><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-15-23-19.png" alt=""></fancybox></p><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨ application.properties å’Œ application.yml ä¸­å†™é…ç½®çš„æ—¶å€™ä¼šæœ‰è‡ªåŠ¨æé†’:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-15-24-36.png" alt=""></p><h2 id="æ ‡è®°é…ç½®å±æ€§ä¸º-Deprecated"><a href="#æ ‡è®°é…ç½®å±æ€§ä¸º-Deprecated" class="headerlink" title="æ ‡è®°é…ç½®å±æ€§ä¸º Deprecated"></a>æ ‡è®°é…ç½®å±æ€§ä¸º Deprecated</h2><p>configuration processor å…è®¸æˆ‘ä»¬æ ‡è®°æŸä¸€ä¸ªå±æ€§ä¸º deprecated<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-11-03%402x.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  <code>@DeprecatedConfigurationProperty</code> æ³¨è§£åˆ°å­—æ®µçš„ getter æ–¹æ³•ä¸Šï¼Œæ¥æ ‡ç¤ºè¯¥å­—æ®µä¸º deprecatedï¼Œé‡æ–° build é¡¹ç›®ï¼Œçœ‹çœ‹ JSON æ–‡ä»¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-17-12-06%402x.png" alt=""></p><p>å½“æˆ‘ä»¬å†ç¼–å†™é…ç½®æ–‡ä»¶æ—¶ï¼Œå·²ç»ç»™å‡ºäº†æ˜ç¡® deprecated æç¤º:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-15-52-19.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Spring Boot çš„ <code>@ConfigurationProperties</code> æ³¨è§£åœ¨ç»‘å®šç±»å‹å®‰å…¨çš„ Java Bean æ—¶æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œæˆ‘ä»¬å¯ä»¥é…åˆå…¶æ³¨è§£å±æ€§å’Œ  <code>@DeprecatedConfigurationProperty</code> æ³¨è§£è·å–åˆ°æ›´å‹å¥½çš„ç¼–ç¨‹æ–¹å¼ï¼ŒåŒæ—¶è¿™æ ·è®©æˆ‘ä»¬çš„é…ç½®æ›´åŠ æ¨¡å—åŒ–ã€‚</p><h2 id="é™„åŠ è¯´æ˜"><a href="#é™„åŠ è¯´æ˜" class="headerlink" title="é™„åŠ è¯´æ˜"></a>é™„åŠ è¯´æ˜</h2><p>ä»¥ä¸º  <code>@ConfigurationProperties</code> æ³¨è§£æ»¡è¶³æˆ‘ä»¬çš„å…¨éƒ¨éœ€è¦äº†å—ï¼Ÿå…¶å®ä¸ç„¶ï¼ŒSpring å®˜ç½‘æ˜ç¡®ç»™å‡ºäº†è¯¥æ³¨è§£å’Œ <code>@Value</code> æ³¨è§£çš„å¯¹æ¯”:<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-02-04.png" alt=""></p><p>å¦‚æœä½¿ç”¨ SpEL è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬åªèƒ½é€‰æ‹© <code>@Value</code> æ³¨è§£</p><p>å¦å¤–æˆ‘ä¹‹å‰åœ¨é˜…è¯» RabbitMQ æºç æ—¶ï¼Œå‘ç° RabbitProperties ç±»å……åˆ†çš„åˆ©ç”¨äº† <code>@ConfigurationProperties</code>  æ³¨è§£ç‰¹æ€§:</p><ul><li><p>deprecated<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-05-40.png" alt=""></p></li><li><p>Duration<br><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-23/2019-07-24-16-06-48.png" alt=""></p></li><li><p>Enum</p></li><li><p>åµŒå¥—å±æ€§</p></li></ul><blockquote><p> æ„Ÿè§‰è‡ªå·±åçŸ¥åè§‰ï¼Œæœ€è¿‘åœ¨æ€è€ƒï¼Œä¸ºä»€ä¹ˆå°æ—¶å€™è¦é˜…è¯»å’ŒèƒŒè¯µå¤è¯—è¯ï¼Œæ–‡è¨€æ–‡ç­‰ç»å…¸ï¼Œå› ä¸ºè¿™æ ·å†™æ–‡ç« å°±å¯ä»¥è½»æ¾ç†Ÿç»ƒçš„å¼•ç”¨ç»å…¸ã€‚æŠ€æœ¯ä¹Ÿä¸€æ ·ï¼Œå„ç§æ¡†æ¶çš„æºç å°±æ˜¯å­¦ç”Ÿæ—¶ä»£çš„å¤è¯—è¯å’Œæ–‡è¨€æ–‡ï¼Œæˆ‘ä»¬è¦å¤šå¤šæŸ¥çœ‹é˜…è¯»ï¼Œç”šè‡³èƒŒè¯µç¼–ç¨‹æ€æƒ³ï¼Œè¿™æ ·å°±å¯ä»¥å†™å‡ºè¶Šæ¥è¶Šä¼˜é›…çš„ä»£ç </p></blockquote><p>å…³äº <code>@ConfigurationProperties</code>  æ³¨è§£çš„ä½¿ç”¨ï¼Œè¿™é‡Œæ¨è <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java" target="_blank" rel="noopener">RabbitMQ Github æºç </a>ï¼Œåªéœ€çœ‹è¿™ä¸€ä¸ªç±»å°±å¯ä»¥ï¼ŒçŸ¥é“æ€æ ·å……åˆ†åˆ©ç”¨è¿™ä¸ªæ³¨è§£.</p><p>Demo ä»£ç è·å–ï¼Œå›å¤å…¬ä¼—å·ã€Œdemoã€ï¼Œæ‰“å¼€é“¾æ¥æŸ¥çœ‹å¯¹åº”çš„å­æ–‡ä»¶å¤¹å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Aware åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link href="//p/spring-aware.html"/>
      <url>//p/spring-aware.html</url>
      
        <content type="html"><![CDATA[<p>é€šè¿‡å¦‚ä¸‹å‰åºä¸¤ç¯‡æ–‡ç« :</p><ol><li><a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a></li><li><a href="https://dayarch.top/p/spring-bean-lifecycle-destroy.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜å°½</a><br>æˆ‘ä»¬äº†è§£äº† Spring Bean çš„ç”Ÿå‘½å‘¨æœŸæ ¸å¿ƒå†…å®¹ï¼Œbean æ˜¯å¦‚ä½•è¢«åˆå§‹åŒ–å˜ä¸º <code>Ready for Use</code> çš„çŠ¶æ€ï¼Œå½“èµ„æºè¢«å›æ”¶æ—¶åˆæ˜¯å¦‚ä½•è¢« destroy çš„ï¼Œä½† <code>Spring Bean Life Cycle</code>å›¾å¹¶æœªè¢«å…¨éƒ¨ç‚¹äº®ï¼Œè¿™ç¯‡æ–‡ç« å°†ç‚¹äº®å‰©ä½™å†…å®¹ï¼ŒåŒæ—¶è¯´è¯´ä½ å¸¸è§çš„ XxxxAware æ¥å£</li></ol><p>ä¸ºä»€ä¹ˆè¦è¯´ Spring Bean ç”Ÿå‘½å‘¨æœŸåˆè¯´ Aware å‘¢ï¼Ÿä¸‹æ¥ç‚¹äº®å‰©ä¸‹å†…å®¹ä½ ä¹Ÿè®¸å°±æ˜ç™½äº†ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-03/Xnip2019-07-03_13-45-04.jpg" alt=""></fancybox></p><ol><li>åœ¨ Spring Bean <code>Ready for Use</code>ä¹‹å‰çš„èµ·æºå½“ç„¶æ˜¯è¦è°ƒç”¨æ„é€ å™¨ï¼Œæ‰€ä»¥ Constructor æ¯‹åº¸ç½®ç–‘æ˜¯åˆ›å»º Spring Bean çš„ç¬¬ä¸€æ­¥</li><li>é€šè¿‡ Setter æ–¹æ³•å®Œæˆä¾èµ–æ³¨å…¥ï¼ŒSDI ï¼ˆSetter Dependency Injectionï¼‰</li><li>ä¾èµ–æ³¨å…¥ä¸€æ—¦ç»“æŸï¼Œ<code>BeanNameAware.setBeanName()</code> ä¼šè¢«è°ƒç”¨ï¼Œå®ƒè®¾ç½®è¯¥ bean åœ¨ Bean Factory ä¸­çš„åç§°</li><li>æ¥ä¸‹æ¥è°ƒç”¨ <code>BeanClassLoaderAware.setBeanClassLoader()</code>ï¼Œä¸º bean å®ä¾‹æä¾›ç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬çŸ¥é“æ‰€æœ‰ç±»éƒ½æ˜¯è¦é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½åˆ°ä¸Šä¸‹æ–‡çš„ï¼Œå…³äºç±»çš„åŠ è½½æœºåˆ¶/åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆå¤§å‚éƒ½çˆ±é—®çš„é¢è¯•é¢˜ï¼‰å†…å®¹ä¼šåœ¨åç»­ç»™å‡ºæ¥ï¼Œè®©ä½ é€å½»çš„äº†è§£</li><li>ç„¶å <code>BeanFactoryAware.setBeanFactory()</code> ä¼šè¢«è°ƒç”¨ä¸º bean å®ä¾‹æä¾›å…¶æ‰€æ‹¥æœ‰çš„ factory</li></ol><p>å…³äº 1ã€2 ä¸¤ç‚¹æˆ‘è¦é¢å¤–å¤šè¯´ä¸€äº›å†…å®¹ï¼Œè¯·çœ‹ä¸‹é¢ä»£ç ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-09-19-17-44%402x.png" alt=""></fancybox></p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡æ„é€ å™¨è®¿é—®è‡ªåŠ¨æ³¨å…¥çš„ field <code>Environment env</code>ï¼Œå½“æ„é€ å™¨è¢«è°ƒç”¨æ—¶ï¼ŒSpring Bean è¿˜æ²¡è¢«å®Œå…¨åˆå§‹åŒ–ï¼Œè¿™å°±ä¼šå¯¼è‡´ <code>NullPointerExceptions</code>ï¼›<br>æˆ‘ä»¬å˜æ¢ä¸€ä¸‹æ–¹å¼ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-09-19-19-37%402x.png" alt=""></fancybox></p><p>è¿™ç§æ–¹å¼ï¼ŒEnvironment å®ä¾‹è¢«å®‰å…¨æ³¨å…¥ä¹‹åæ‰è°ƒç”¨ <code>@PostConstruct</code>æ ‡è®°çš„æ–¹æ³•ï¼Œè¿™æ ·å°±ä¸ä¼šæŠ›å‡º <code>NullPointerException</code> äº†ã€‚</p><p>è¿™ä¼šå›çœ‹å‘¨æœŸå›¾ï¼Œæœ‰æ²¡æœ‰è±ç„¶å¼€æœ—ï¼Ÿ</p><blockquote><p>ç­‰æ‰€æœ‰ Spring Bean éƒ½å®Œæˆä¾èµ–æ³¨å…¥ï¼ˆå‘¨æœŸå›¾ä¸­çš„ Setter Methods éƒ¨åˆ†ï¼‰å†ä½¿ç”¨ bean çš„å¼•ç”¨æ‰æ˜¯å®‰å…¨çš„æ–¹å¼ï¼Œ</p></blockquote><p>åç»­ä¼šæœ‰ä¸€ä¸ªç« èŠ‚ä¸“é—¨è¯´ä¸€è¯´é¢è¯•ç»å¸¸è¢«é—®èµ·çš„ <code>Spring æœ‰å‡ ç§ä¾èµ–æ³¨å…¥æ–¹å¼</code>çš„å°´å°¬é—®é¢˜ï¼Œè¯·å…³æ³¨åç»­æ–‡ç« </p><p>åˆ°è¿™é‡Œç»ˆäºå¯ä»¥è¯´ä¸€è¯´ Aware äº†ï¼Œä¸”çœ‹</p><h2 id="Aware"><a href="#Aware" class="headerlink" title="Aware"></a>Aware</h2><p>Aware æ˜¯ Spring ä¸­çš„ä¸€ä¸ªæ ¹æ¥å£ï¼Œç»§æ‰¿è¯¥æ¥å£çš„å­æ¥å£æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å‘¨æœŸå›¾ä¸­çš„é‚£ä¸‰ä¸ª Awareï¼Œä½†æ˜¯è¯¥æ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªæ ‡è®°æ¥å£ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-09-19-20-29%402x.png" alt=""></fancybox></p><p>Aware ç¿»è¯‘è¿‡æ¥å¯ä»¥ç†è§£ä¸ºâ€å¯Ÿè§‰çš„ï¼›æ³¨æ„åˆ°çš„ï¼›æ„ŸçŸ¥çš„â€ ï¼ŒXxxxAware ä¹Ÿå°±æ˜¯å¯¹â€¦.æ„ŸçŸ¥çš„ï¼Œæ²¡æœ‰ Aware å°±æ˜¯æ— æ„ŸçŸ¥çš„å—ï¼Ÿå¯¹å–½</p><blockquote><p>Spring çš„ä¾èµ–æ³¨å…¥æœ€å¤§äº®ç‚¹å°±æ˜¯æ‰€æœ‰çš„ Bean å¯¹ Spring å®¹å™¨çš„å­˜åœ¨æ˜¯æ²¡æœ‰æ„è¯†çš„ï¼Œæ‹¿ <a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a> æ–‡ç« ä¸­â€œå°å­¦ç”Ÿå…¥å°‘å…ˆé˜Ÿâ€ä¸ºä¾‹å­è¯´æ˜ï¼Œå°å­¦ç”Ÿè¿˜æ˜¯é‚£ä¸ªå°å­¦ç”Ÿï¼ŒåŠ å…¥å°‘å…ˆé˜Ÿè¿˜æ˜¯åŠ å…¥å…±é’å›¢åªä¸è¿‡è§„åˆ™ä¸ä¸€æ ·ç½¢äº†<br>ä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸å¯é¿å…çš„è¦ç”¨åˆ° Spring å®¹å™¨æœ¬èº«æä¾›çš„èµ„æºï¼ˆéš¾å…è¦æœ‰äº‹æƒ…éœ€è¦å°‘å…ˆé˜Ÿç»„ç»‡çš„å¸®åŠ©ï¼‰ï¼Œè¿™æ—¶å€™è¦è®© Bean ä¸»åŠ¨æ„è¯†åˆ° Spring å®¹å™¨çš„å­˜åœ¨ï¼Œæ‰èƒ½è°ƒç”¨ Spring æ‰€æä¾›çš„èµ„æºï¼Œè¿™å°±æ˜¯ Spring Aware. å…¶å® Spring Aware æ˜¯ Spring è®¾è®¡ä¸ºæ¡†æ¶å†…éƒ¨ä½¿ç”¨çš„ï¼Œè‹¥ä½¿ç”¨äº†ï¼Œä½ çš„ Bean å°†ä¼šå’Œ Spring æ¡†æ¶è€¦åˆï¼Œæ‰€ä»¥è‡ªå·±ä¸å•ç‹¬ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨è¯»æ¡†æ¶æºç æ—¶å¸Œæœ›ä½ ä¸å†æ¨¡ç³Š.</p></blockquote><p>å¸¸è§çš„ Spring Aware æ¥å£</p><table><thead><tr><th align="left">Awareå­æ¥å£</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">BeanNameAware</td><td align="left">è·å–å®¹å™¨ä¸­ Bean çš„åç§°</td></tr><tr><td align="left">BeanFactoryAware</td><td align="left">è·å–å½“å‰ BeanFactory ï¼Œè¿™æ ·å¯ä»¥è°ƒç”¨å®¹å™¨çš„æœåŠ¡</td></tr><tr><td align="left">ApplicationContextAware</td><td align="left">åŒä¸Šï¼Œåœ¨<a href="https://dayarch.top/p/difference-between-beanfactory-and-applicationcontext.html">BeanFactory å’Œ ApplicationContext çš„åŒºåˆ«</a> ä¸­å·²æ˜ç¡®è¯´æ˜</td></tr><tr><td align="left">MessageSourceAware</td><td align="left">è·å– Message Source ç›¸å…³æ–‡æœ¬ä¿¡æ¯</td></tr><tr><td align="left">ApplicationEventPublisherAware</td><td align="left">å‘å¸ƒäº‹ä»¶</td></tr><tr><td align="left">ResourceLoaderAware</td><td align="left">è·å–èµ„æºåŠ è½½å™¨ï¼Œè¿™æ ·è·å–å¤–éƒ¨èµ„æºæ–‡ä»¶</td></tr></tbody></table><p>æ¥çœ‹ç±»å…³ç³»å›¾ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-03/Xnip2019-07-03_14-39-56.jpg" alt=""></fancybox></p><p>å½“ç„¶ä¸æ­¢ä»¥ä¸Šè¿™äº› Awareï¼Œ é€šå¸¸ä½¿ç”¨ Spring Aware çš„ç›®çš„æ˜¯ä¸ºäº†è®© Bean è·å¾— Spring å®¹å™¨çš„æœåŠ¡ã€‚</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><h3 id="BeanNameAware"><a href="#BeanNameAware" class="headerlink" title="BeanNameAware"></a>BeanNameAware</h3><p>è‡ªå®šä¹‰ bean å®ç° BeanNameAware</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-09-19-21-09%402x.png" alt=""></fancybox></p><p>æ³¨å†Œ bean</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-09-19-21-51%402x.png" alt=""></fancybox></p><p>è¿è¡Œ</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-09-19-22-45%402x.png" alt=""></fancybox></p><p>å’Œé¢„æƒ³ä¸€æ ·ï¼ŒBean Name è¾“å‡ºç»“æœä¸º <code>myCustomBeanName</code>ï¼Œå¦‚æœç§»é™¤æ‰ @Bean æ³¨è§£çš„ name å±æ€§ï¼Œ è¾“å‡ºç»“æœä¸º <code>getMyBeanName</code></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨ä»»ä½• Aware æ¥å£ï¼Œé™¤éæˆ‘ä»¬éœ€è¦å®ƒä»¬ã€‚å®ç°è¿™äº›æ¥å£ä¼šå°†ä»£ç è€¦åˆåˆ°Springæ¡†æ¶ï¼Œä½†æ˜¯å¸Œæœ›çœ‹è¿‡æœ¬èŠ‚å†…å®¹ä¹‹åé˜…è¯»æ¡†æ¶æºç æ€ç»´æ›´åŠ æ¸…æ™°</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>æ¡†æ¶ä¸­æœ‰å“ªäº›ç»å…¸çš„ Aware åº”ç”¨ï¼Ÿ</li><li>åˆ°ç°åœ¨ä½ èƒ½å¾ˆå¥½çš„ç†è§£ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</li></ol><h2 id="Demoä»£ç "><a href="#Demoä»£ç " class="headerlink" title="Demoä»£ç "></a>Demoä»£ç </h2><p>æ¶‰åŠåˆ° Spring Bean ç”Ÿå‘½å‘¨æœŸçš„æµ‹è¯•ä»£ç ç”±äºå†…å®¹è¾ƒå¤šï¼Œæ²¡æœ‰å†™åœ¨æ­¤å¤„ï¼Œå…³æ³¨å…¬ä¼—å·å¹¶å›å¤ ã€Œdemoã€è·å–ç›¸å…³ä»£ç ï¼Œè¯·è‡ªè¡Œå°è¯•è¿è¡Œç»“æœ</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Aware </tag>
            
            <tag> Spring Bean </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Beanç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜å°½</title>
      <link href="//p/spring-bean-lifecycle-destroy.html"/>
      <url>//p/spring-bean-lifecycle-destroy.html</url>
      
        <content type="html"><![CDATA[<p> ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://dayarch.top/p/spring-bean-lifecycle-creation.html">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</a> è¯´æ˜äº†<code>æˆ‘æ˜¯è°ï¼Ÿ</code> å’Œ <code>æˆ‘ä»å“ªé‡Œæ¥?</code> çš„ä¸¤å¤§å“²å­¦é—®é¢˜ï¼Œä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºä¸€ä¸‹ç»ˆæå“²å­¦<code>æˆ‘è¦åˆ°å“ªé‡Œå»ï¼Ÿ</code></p><p> åˆå§‹åŒ– Spring Bean æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ol><li>@PostConstruct</li><li>InitializingBean.afterPropertiesSet()</li><li>init-method</li></ol><p>é”€æ¯ Spring Bean åŒæ ·æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ol><li>@PreDestroy</li><li>DisposableBean.destroy()</li><li>destroy-method</li></ol><blockquote><p>æ­£æ‰€è°“ï¼Œå¤©å¯¹åœ°ï¼Œé›¨å¯¹é£ï¼› @PostConstruct å¯¹ @PreDestroyï¼›InitializingBean.afterPropertiesSet() å¯¹ DisposableBean.destroy()ï¼› init-method å¯¹ destroy-methodï¼›é›·éšéšï¼Œé›¾è’™è’™ï¼›å±±èŠ±å¯¹æµ·æ ‘ï¼Œèµ¤æ—¥å¯¹è‹ç©¹ï¼›å¹³ä»„å¹³ä»„å¹³å¹³ä»„ï¼Œä»„å¹³ä»„å¹³ä»„ä»„å¹³ï¼Œä»„ä»„å¹³â€¦â€¦</p></blockquote><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-02/%E5%B2%B3%E4%BA%91%E9%B9%8F1.gif" alt=""> </fancybox></p><p>æ„Ÿè§‰è®²åˆ°è¿™æ²¡å¿…è¦è®²ä¸‹å»äº†ï¼Œä¸€åˆ‡æ¸…æ™°æ˜äº†ï¼Œä½†æˆ‘è¿˜æœ‰è¯è¦è¯´</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-02/6bad7ce4875a2946.gif" alt=""> </fancybox></p><p>å½“ Spring Ioc å®¹å™¨è¦ç§»é™¤ bean æ—¶ï¼Œé”€æ¯ç›¸å…³å›è°ƒæ–¹æ³•å°†ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ—¶é‡Šæ”¾è¢« bean æŒæœ‰çš„èµ„æºï¼Œæˆ–è€…å»æ‰§è¡Œä¸€äº›ç»ˆæä»»åŠ¡. å½“ ApplicationContext è°ƒç”¨ registerShutdownHook æ–¹æ³•æ—¶ï¼Œè¿™äº›é”€æ¯æ–¹æ³•å°±ä¼šè¢«è§¦å‘ï¼Œä½†ä¸€èˆ¬æ­£å¸¸çš„ä¸šåŠ¡ä¸­å¾ˆå°‘ä¼šç”¨åˆ°è¿™äº›æ–¹æ³•</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-11-16-43-10%402x.png" alt=""></fancybox></p><p>æ¥ä¸‹æ¥å…·ä½“çš„å±•ç¤ºä¸€ä¸‹ä¸‰ç§æ–¹æ³•çš„ä½¿ç”¨æ–¹å¼</p><h2 id="ä¸‰ç§é”€æ¯-Spring-Bean-çš„æ–¹å¼"><a href="#ä¸‰ç§é”€æ¯-Spring-Bean-çš„æ–¹å¼" class="headerlink" title="ä¸‰ç§é”€æ¯ Spring Bean çš„æ–¹å¼"></a>ä¸‰ç§é”€æ¯ Spring Bean çš„æ–¹å¼</h2><h3 id="DisposableBean"><a href="#DisposableBean" class="headerlink" title="DisposableBean"></a>DisposableBean</h3><p>Spring ä¸ºæˆ‘ä»¬æä¾›äº† DisposableBean æ¥å£</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-11-16-43-30%402x.png" alt=""></fancybox></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° <code>DisposableBean</code> æ¥å£ï¼Œåœ¨å…¶å”¯ä¸€æ–¹æ³• <code>destroy</code> å†…å®Œæˆ bean é”€æ¯çš„å·¥ä½œï¼Œä½†æ˜¯ Spring Framework å®˜æ–¹å¹¶ä¸å»ºè®®æˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹æ³•æ¥é”€æ¯ beanï¼Œè¿™åŒæ ·æ˜¯ä¸€ç§å¼ºè€¦åˆçš„æ–¹å¼ï¼Œæˆ‘ä»¬çœ‹åˆ°æ¡†æ¶å±‚é¢æ‰ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="PreDestroy"><a href="#PreDestroy" class="headerlink" title="@PreDestroy"></a>@PreDestroy</h3><p>è¿™ç§æ–¹å¼æ˜¯ Spring éå¸¸æå€¡çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬é€šå¸¸å°†å…¶æ ‡è®°åœ¨æ–¹æ³•ä¸Šå³å¯ï¼Œé€šå¸¸ä¹ æƒ¯å°†è¿™ä¸ªæ–¹æ³•èµ·åä¸º <code>destory()</code></p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-11-16-43-52%402x.png" alt=""></fancybox></p><h3 id="destroy-method"><a href="#destroy-method" class="headerlink" title="destroy-method"></a>destroy-method</h3><p>åŒæ ·æ˜¯ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ–¹å¼ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-11-16-44-04%402x.png" alt=""></fancybox></p><p>ç¬¬äºŒç§æ–¹å¼</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07/2019-07-11-16-44-15%402x.png" alt=""></fancybox></p><p>ä»¥ä¸Šä¸‰ç§ Bean çš„é”€æ¯æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥ç»„åˆä½¿ç”¨çš„ï¼Œé‚£ä¹ˆç»„åˆåœ¨ä¸€èµ·çš„è°ƒç”¨é¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ol><li>é¦–å…ˆ @PreDestroy ä¼šè¢«è°ƒç”¨</li><li>å…¶æ¬¡ DisposableBean.destroy() ä¼šè¢«è°ƒç”¨ </li><li>æœ€åè°ƒç”¨é€šè¿‡ XML é…ç½®çš„ destroy-method æ–¹æ³•æˆ–é€šè¿‡è®¾ç½® @Bean æ³¨è§£ è®¾ç½® destroyMethod å±æ€§çš„æ–¹æ³•</li></ol><p>ç”¨å›¾ç¤ºæ¥è¯´æ˜ä¸€ä¸‹è°ƒç”¨é¡ºåº</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-02/Xnip2019-07-02_16-00-23.jpg" alt=""> </fancybox></p><p>è¿™ä¸ªè°ƒç”¨é¡ºåºä¹Ÿä¸éš¾è®°å¿†</p><blockquote><p>PreDestroy <code>(P)</code>ï¼Œdestroy <code>(D)</code>ï¼Œdestroy-method <code>(D)</code> â€”&gt; <code>PDD ï¼ˆé‚£ä¸ª3äº¿äººéƒ½åœ¨ pin çš„é‚£ä¸ª APP åç§°ï¼Œç›®å‰ 3 äº¿äººä¸­æ²¡æœ‰æˆ‘ï¼‰</code></p></blockquote><p>å†æ¥çœ‹çœ‹ Spring Bean ç”Ÿå‘½å‘¨æœŸå›¾ï¼Œæˆ‘ä»¬å·²ç»ç‚¹äº®äº†æ ¸å¿ƒéƒ¨åˆ†ï¼š</p><p><fancybox><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-02/Xnip2019-07-02_16-01-53.jpg" alt=""> </fancybox></p><p>æˆ‘ä»¬è¦æ³¨æ„ï¼Œåœ¨é”€æ¯çš„è¿‡ç¨‹å¹¶æ²¡æœ‰ç±»ä¼¼ BeanPostProcess é‚£ä¸­åˆ‡é¢çš„æ€æƒ³ï¼Œè¿™é‡Œè¦æ³¨æ„åˆ°åŒºåˆ«ã€‚</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>åœ¨é˜…è¯»æ¡†æ¶æºç æ—¶ï¼Œå“ªäº›åœ°æ–¹ç”¨åˆ°äº† bean çš„é”€æ¯æ–¹æ³•ï¼Ÿ</li><li>è¿˜æ²¡æœ‰è¢«ç‚¹äº®çš„åœ°æ–¹ï¼Œä½ è®¤ä¸ºè¿˜æœ‰å“ªäº›å†…å®¹æ²¡æœ‰åšï¼Ÿ</li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Bean </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Beanç”Ÿå‘½å‘¨æœŸä¹‹ç¼˜èµ·</title>
      <link href="//p/spring-bean-lifecycle-creation.html"/>
      <url>//p/spring-bean-lifecycle-creation.html</url>
      
        <content type="html"><![CDATA[<p>Spring bean çš„ç”Ÿå‘½å‘¨æœŸå¾ˆå®¹æ˜“ç†è§£ã€‚å®ä¾‹åŒ– bean æ—¶ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›åˆå§‹åŒ–ä»¥ä½¿å…¶è¿›å…¥å¯ç”¨ ï¼ˆReady for Useï¼‰çŠ¶æ€ã€‚ç±»ä¼¼åœ°ï¼Œå½“ä¸å†éœ€è¦ bean å¹¶å°†å…¶ä»å®¹å™¨ä¸­ç§»é™¤æ—¶ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œä¸€äº›æ¸…ç†ï¼Œè¿™å°±æ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸ</p><p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://dayarch.top/p/difference-between-beanfactory-and-applicationcontext.html">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a> ä¸­è¯´æ˜äº†æ¥å£ Beanfactory å’Œ Applicationcontext å¯ä»¥é€šè¿‡ <code>T getBean(String name, Class&lt;T&gt; requiredType)</code> æ–¹æ³•ä» Spring å®¹å™¨ä¸­è·å–beanï¼ŒåŒºåˆ«æ˜¯ï¼Œå‰è€…æ˜¯æ‡’åŠ è½½å½¢å¼ï¼Œåè€…æ˜¯é¢„åŠ è½½çš„å½¢å¼ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><blockquote><p>è¿™äº› Spring Beans æ˜¯æ€ä¹ˆç”Ÿæˆå‡ºæ¥çš„å‘¢ï¼Ÿ </p></blockquote><p>åœ¨æ­£å¼å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œå…ˆè§£ç­”ä¸€äº›æœ‰å…³ Java Beanï¼Œ Spring Bean å’Œ Spring IoC å®¹å™¨è¿™äº›æ¦‚å¿µæ€§çš„ç–‘æƒ‘ï¼Œæˆ‘å¸Œæœ›é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­å½¢è±¡è¯´æ˜è¿™äº›é—®é¢˜ï¼š</p><blockquote><p>å°å­¦ç”Ÿ ï¼ˆJava Beanï¼‰é€šè¿‡æäº¤èµ„æ–™ç”³è¯·ï¼ˆå…ƒæ•°æ®é…ç½®ï¼‰åŠ å…¥äº†å°‘å…ˆé˜Ÿï¼ˆSpring Ioc å®¹å™¨ï¼‰ï¼Œå­¦ä¹ äº†ä¸€äº›ç²¾ç¥ä¸è§„å®šä¹‹åï¼Œå˜æˆäº†å°‘å…ˆé˜Ÿå‘˜ï¼ˆSpring Beanï¼‰</p></blockquote><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒJava Bean å’Œ Spring Bean éƒ½æ˜¯å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„å¯¹è±¡ï¼Œå°å­¦ç”Ÿè¿˜æ˜¯é‚£ä¸ªå°å­¦ç”Ÿï¼Œåªä¸è¿‡åŠ å…¥äº†å°‘å…ˆé˜Ÿä¹‹åæœ‰äº†æ–°çš„èº«ä»½ï¼Œæ–°çš„èº«ä»½è¦æŒ‰ç…§ç»„ç»‡ ï¼ˆSpring Iocï¼‰çš„è§„å®šå±¥è¡Œç‰¹å®šä¹‰åŠ¡</p><p>æ¥çœ‹ä¸‹å›¾åŠ æ·±ä¸€ä¸‹äº†è§£<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-07-01_20-14-05.jpg" alt=""></fancybox></p><p>é¦–å…ˆè¦æœ‰å®¹å™¨ï¼Œå®ä¾‹åŒ– Spring Ioc å®¹å™¨æ˜¯éå¸¸ç®€å•çš„ï¼Œæ¥å£ <code>org.springframework.context.ApplicationContext</code> è¡¨ç¤ºSpring IoCå®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ï¼Œé…ç½®å’Œç»„è£…ä¸Šè¿° beanã€‚ å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®è·å–æœ‰å…³è¦å®ä¾‹åŒ–ï¼Œé…ç½®å’Œç»„è£…çš„å¯¹è±¡çš„æŒ‡ä»¤ã€‚ é…ç½®å…ƒæ•°æ®é€šå¸¸ä»¥XMLï¼ŒJava æ³¨è§£æˆ–ä»£ç çš„å½¢å¼è¡¨ç¤ºã€‚ å®ƒå…è®¸ä½ è‡ªå·±è¡¨è¾¾ç»„æˆåº”ç”¨ç¨‹åºçš„å¯¹è±¡ä»¥åŠè¿™äº›å¯¹è±¡ä¹‹é—´ä¸°å¯Œçš„ç›¸äº’ä¾èµ–æ€§ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> String[] &#123;<span class="string">"spring.xml"</span>, <span class="string">"spring1.xml"</span>&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰äº†å®¹å™¨ï¼Œæˆ‘ä»¬éœ€è¦åšå“ªäº›å¤„ç†ï¼Œä½¿å…¶å†…éƒ¨å¯¹è±¡å˜ä¸º <code>Ready for Use</code> çš„çŠ¶æ€?  </p></blockquote><p>æˆ‘ä»¬éœ€è¦é€šè¿‡ Spring å®¹å™¨å®ä¾‹åŒ–å®ƒä»¬ï¼ŒSpring ä¸ºæˆ‘ä»¬æä¾›äº†ä¸‰ç§æ–¹å¼ï¼š</p><h2 id="ä¸‰ç§åˆå§‹åŒ–æ–¹å¼"><a href="#ä¸‰ç§åˆå§‹åŒ–æ–¹å¼" class="headerlink" title="ä¸‰ç§åˆå§‹åŒ–æ–¹å¼"></a>ä¸‰ç§åˆå§‹åŒ–æ–¹å¼</h2><h3 id="InitializingBean"><a href="#InitializingBean" class="headerlink" title="InitializingBean"></a>InitializingBean</h3><p>Spring ä¸ºæˆ‘ä»¬æä¾›äº† <code>InitializingBean</code> æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° <code>InitializingBean</code> æ¥å£ï¼Œåœ¨å…¶å”¯ä¸€æ–¹æ³• <code>afterPropertiesSet</code> å†…å®Œæˆå®ä¾‹åŒ–çš„å·¥ä½œï¼Œä½†æ˜¯ Spring Framework å®˜æ–¹å¹¶ä¸å»ºè®®æˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹æ³•æ¥å®Œæˆ Bean çš„å®ä¾‹åŒ–ï¼Œè¿™æ˜¯ä¸€ç§å¼ºè€¦åˆçš„æ–¹å¼ï¼Œæˆ‘ä»¬çœ‹åˆ°æ¡†æ¶å±‚é¢æ‰ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h3><p>è¿™ç§æ–¹å¼æ˜¯ Spring éå¸¸æå€¡çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬é€šå¸¸å°†å…¶æ ‡è®°åœ¨æ–¹æ³•ä¸Šå³å¯ï¼Œé€šå¸¸ä¹ æƒ¯å°†è¿™ä¸ªæ–¹æ³•èµ·åä¸º <code>init()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"Inside init() method..."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="init-method"><a href="#init-method" class="headerlink" title="init-method"></a>init-method</h3><p>ä½ åº”è¯¥è§è¿‡è¿™ç§åˆå§‹åŒ–æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// perform post-creation logic here</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> MyClass <span class="title">myclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MyClass ();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿåº”è¯¥è§è¿‡è¿™ç§é…ç½®æ–¹å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myClass"</span> <span class="attr">class</span>=<span class="string">"com.demo.MyClass"</span> <span class="attr">init-method</span>=<span class="string">"init"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œè¿™åªæ˜¯åŒæ ·åŠŸèƒ½çš„ä¸åŒå®ç°æ–¹å¼ç½¢äº†<br>ä»¥ä¸Šå°±æ˜¯ä¸‰ç§åˆå§‹åŒ– Spring Beans çš„æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨æ¡†æ¶ä¸­çœ‹åˆ°è¿‡ä¸‰ç§æ–¹å¼åœ¨ç»„åˆä½¿ç”¨ï¼Œé‚£ä¹ˆç»„åˆä½¿ç”¨çš„è°ƒç”¨é¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ol><li>é¦–å…ˆ@PostConstruct ä¼šè¢«æœ€å…ˆè°ƒç”¨</li><li>å…¶æ¬¡ <code>InitializingBean.afterPropertiesSet()</code> æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ </li><li>æœ€åè°ƒç”¨é€šè¿‡ XML é…ç½®çš„ init-method æ–¹æ³•æˆ–é€šè¿‡è®¾ç½® @Bean æ³¨è§£ è®¾ç½® initMethod å±æ€§çš„æ–¹æ³•</li></ol><p>äº†è§£äº†è¿™äº›ï¼Œä½ ä¹Ÿå°±äº†è§£äº† Spring Bean æ˜¯æ€ä¹ˆæ¥çš„äº†</p><p>é€šè¿‡å›¾ç¤ºæ¥è¯´æ˜ä¸€ä¸‹ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-07-01_21-46-24.jpg" alt=""></fancybox></p><p>è¿™ä¸ªè°ƒç”¨é¡ºåºå¾ˆéš¾è®°å¿†å—å—ï¼Ÿ </p><blockquote><p>PostConstruct <code>(P)</code>ï¼ŒafterPropertiesSet <code>(A)</code>ï¼Œinit-method <code>(I)</code> â€”&gt; <code>PAI ï¼ˆåœ†å‘¨ç‡Ï€ï¼‰</code></p></blockquote><h2 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h2><p>BeanPostProcessor æ¥å£ï¼Œå¤§å®¶ä¹Ÿåº”è¯¥æœ‰å°è±¡ï¼Œé‡Œé¢åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object var1, String var2)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object var1, String var2)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹æ–¹æ³•åï¼ŒBeforeInitialization å’Œ AfterInitializationï¼Œæˆ‘ä»¬åº”è¯¥çŒœå¾—å‡ºï¼Œè¿™æ˜¯åœ¨ä¸Šè¿°ä¸‰ç§æ–¹å¼çš„å‰å’Œåï¼Œç®—æ˜¯ä¸€ç§å…¨å±€çš„åˆ‡é¢æ€æƒ³ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ <code>postProcessAfterInitialization</code> æ–¹æ³•ï¼Œé€šè¿‡è¯»å– Bean çš„æ³¨è§£å®Œæˆä¸€äº›åç»­é€»è¾‘ç¼–å†™ä¸å±æ€§çš„è®¾å®šï¼Œç°åœ¨ <code>Ready for Use</code>ä¹‹å‰æ˜¯è¿™æ ·ï¼š</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-07-02_08-38-03.jpg" alt=""></fancybox></p><p>åœ¨ <code>Ready for Use</code> ä¹‹å‰ï¼Œäº†è§£è¿™äº›å†…å®¹ï¼Œå·²å¯ä»¥åŸºæœ¬æ»¡è¶³æ—¥å¸¸çš„å·¥ä½œå†…å®¹ï¼Œä½†è¿™å¹¶ä¸æ˜¯ Ready for Use çš„å…¨éƒ¨å†…å®¹ï¼ŒSpring Bean æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„æµç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œåç»­æ–‡ç« ä¼šé€æ­¥ç‚¹äº®ï¼š<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-07-02_09-34-02.jpg" alt=""></fancybox></p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>äº†è§£äº† Spring Bean æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿé‚£å®ƒæ˜¯æ€ä¹ˆæ²¡çš„å‘¢ï¼Ÿä»€ä¹ˆæ—¶å€™éœ€è¦é”€æ¯ä»–ä»¬å‘¢ï¼Ÿ</li><li>Spring æ¡†æ¶ä¸­ XxxxAwareï¼Œè¿™äº›ç±»æœ‰ä»€ä¹ˆä½œç”¨ï¼Œèƒ½åœ¨ <code>Ready for Use</code> ä¹‹å‰æœ‰ç”¨å¤„å—ï¼Ÿ</li><li>ä½ æ—¥å¸¸çš„å·¥ä½œä¸­æœ‰å……åˆ†åˆ©ç”¨ä»Šå¤©è¯´æ˜çš„è¿™äº›å†…å®¹å—ï¼Ÿæ‡‚å¾—è¿™äº›ä¼šå¤§å¤§æ–¹ä¾¿ä½ çš„ç¼–ç¨‹</li></ol><h2 id="è¡¥å……è¯´æ˜"><a href="#è¡¥å……è¯´æ˜" class="headerlink" title="è¡¥å……è¯´æ˜"></a>è¡¥å……è¯´æ˜</h2><ol><li>è™½ç„¶å½“ä¸‹æµè¡Œä»¥æ³¨è§£å£°æ˜æ–¹å¼è¿›è¡Œç¼–ç¨‹ï¼Œç”šè‡³é«˜ç‰ˆæœ¬ Spring ä¼šå°†ä¸€äº›æ–¹æ³•æ ‡è®°ä¸ºè¿‡æ—¶ï¼Œä½†æ–‡ç« è¯´æ˜ä¾æ—§ä¼šä½¿ç”¨ <code>XMLBeanFactory</code> è¿™ç±»æ–¹æ³•ï¼ŒåŒ…æ‹¬ XML é…ç½®ã€‚è¿™æ ·åšï¼Œåªä¸è¿‡ä¸ºäº†æ›´æ¸…æ™°çš„è¯´æ˜é—®é¢˜ã€‚</li><li>å¦å¤–å°† Spring Bean å£°æ˜å‘¨æœŸçš„è®²è§£ï¼Œè¿›è¡Œæ‹†åˆ†ï¼Œæ˜¯ä¸ºäº†è®©å¤§å®¶æœ‰ç‹¬ç«‹çš„æ€è€ƒç©ºé—´ï¼Œå¸¦ç€é—®é¢˜å»æ€è€ƒã€æ—¶é—´ï¼Œè€Œä¸æ˜¯è¢«åŠ¨çš„å¡«å……ï¼Œæœ€ç»ˆä¸²è”èµ·è‡ªå·±çš„å­¦ä¹ ç½‘ç»œï¼Œè¿™æ ·ç†è§£çš„æ›´æ·±åˆ»ï¼Œå…·ä½“è¯·çœ‹ä¹‹å‰å†™çš„æ–‡ç«   <a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç </a>, åç»­å†…å®¹è¯·æŒç»­å…³æ³¨</li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Bean </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</title>
      <link href="//p/difference-between-beanfactory-and-applicationcontext.html"/>
      <url>//p/difference-between-beanfactory-and-applicationcontext.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>æ¥å£ BeanFactory å’Œ ApplicationContext éƒ½æ˜¯ç”¨æ¥ä»å®¹å™¨ä¸­è·å– Spring beans çš„ï¼Œä½†æ˜¯ï¼Œä»–ä»¬äºŒè€…æœ‰å¾ˆå¤§ä¸åŒ</p></blockquote><p>æˆ‘çœ‹åˆ°è¿‡å¾ˆå¤šé—® BeanFactory å’Œ ApplicationContext ä¸åŒç‚¹çš„é—®é¢˜ï¼Œè€ƒè™‘åˆ°è¿™ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨å‰è€…è¿˜æ˜¯åè€…ä» Spring å®¹å™¨ä¸­è·å– beans å‘¢ï¼Ÿè¯·å‘ä¸‹çœ‹</p><h2 id="ä»€ä¹ˆæ˜¯-Spring-Bean"><a href="#ä»€ä¹ˆæ˜¯-Spring-Bean" class="headerlink" title="ä»€ä¹ˆæ˜¯ Spring Bean"></a>ä»€ä¹ˆæ˜¯ Spring Bean</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•è€Œåˆå¾ˆå¤æ‚çš„é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´ï¼ŒSpring beans å°±æ˜¯è¢« Spring å®¹å™¨æ‰€ç®¡ç†çš„ Java å¯¹è±¡ï¼Œæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zoltanraffai;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123; </span><br><span class="line">   <span class="keyword">private</span> String message;  </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span></span>&#123; </span><br><span class="line">      <span class="keyword">this</span>.message  = message; </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMessage</span><span class="params">()</span></span>&#123; </span><br><span class="line">      System.out.println(<span class="string">"My Message : "</span> + message); </span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åŸºäº XML çš„é…ç½®ä¸­ï¼Œ beans.xml ä¸º Spring å®¹å™¨ç®¡ç† bean æä¾›å…ƒæ•°æ®</p><h2 id="ä»€ä¹ˆæ˜¯-Spring-å®¹å™¨"><a href="#ä»€ä¹ˆæ˜¯-Spring-å®¹å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯ Spring å®¹å™¨"></a>ä»€ä¹ˆæ˜¯ Spring å®¹å™¨</h2><p>Spring å®¹å™¨è´Ÿè´£å®ä¾‹åŒ–ï¼Œé…ç½®å’Œè£…é… Spring beansï¼Œä¸‹é¢æ¥çœ‹å¦‚ä½•ä¸º IoC å®¹å™¨é…ç½®æˆ‘ä»¬çš„ HelloWorld POJO</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span> = <span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span> = <span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span> = <span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"helloWorld"</span> <span class="attr">class</span> = <span class="string">"com.zoltanraffai.HelloWorld"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span> = <span class="string">"message"</span> <span class="attr">value</span> = <span class="string">"Hello World!"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå®ƒå·²ç»è¢« Spring å®¹å™¨ç®¡ç†äº†ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬æ€æ ·è·å–å®ƒï¼Ÿ</p><h2 id="BeanFactory-å’Œ-ApplicationContext-çš„ä¸åŒç‚¹"><a href="#BeanFactory-å’Œ-ApplicationContext-çš„ä¸åŒç‚¹" class="headerlink" title="BeanFactory å’Œ ApplicationContext çš„ä¸åŒç‚¹"></a>BeanFactory å’Œ ApplicationContext çš„ä¸åŒç‚¹</h2><h3 id="BeanFactory-æ¥å£"><a href="#BeanFactory-æ¥å£" class="headerlink" title="BeanFactory æ¥å£"></a>BeanFactory æ¥å£</h3><p>è¿™æ˜¯ä¸€ä¸ªç”¨æ¥è®¿é—® Spring å®¹å™¨çš„ root æ¥å£ï¼Œè¦è®¿é—® Spring å®¹å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring ä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼Œä½¿ç”¨ BeanFactory æ¥å£å’Œå®ƒçš„å­æ¥å£</p><p><strong>ç‰¹æ€§ï¼š</strong></p><ul><li>Bean çš„å®ä¾‹åŒ–/ä¸²è”<br>é€šå¸¸æƒ…å†µï¼ŒBeanFactory çš„å®ç°æ˜¯ä½¿ç”¨æ‡’åŠ è½½çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€ beans åªæœ‰åœ¨æˆ‘ä»¬é€šè¿‡ getBean() æ–¹æ³•ç›´æ¥è°ƒç”¨å®ƒä»¬æ—¶æ‰è¿›è¡Œå®ä¾‹åŒ–<br>å®ç° BeanFactory æœ€å¸¸ç”¨çš„ API æ˜¯ XMLBeanFactory<br>è¿™é‡Œæ˜¯å¦‚ä½•é€šè¿‡ BeanFactory è·å–ä¸€ä¸ª bean çš„ä¾‹å­ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zoltanraffai;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean; </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.XmlBeanFactory; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldApp</span></span>&#123; </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">      XmlBeanFactory factory = <span class="keyword">new</span> XmlBeanFactory (<span class="keyword">new</span> ClassPathResource(<span class="string">"beans.xml"</span>)); </span><br><span class="line">      HelloWorld obj = (HelloWorld) factory.getBean(<span class="string">"helloWorld"</span>);    </span><br><span class="line">      obj.getMessage();    </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ApplicationContext-æ¥å£"><a href="#ApplicationContext-æ¥å£" class="headerlink" title="ApplicationContext æ¥å£"></a>ApplicationContext æ¥å£</h3><p>ApplicationContext æ˜¯ Spring åº”ç”¨ç¨‹åºä¸­çš„ä¸­å¤®æ¥å£ï¼Œç”¨äºå‘åº”ç”¨ç¨‹åºæä¾›é…ç½®ä¿¡æ¯<br>å®ƒç»§æ‰¿äº† BeanFactory æ¥å£ï¼Œæ‰€ä»¥ ApplicationContext åŒ…å« BeanFactory çš„æ‰€æœ‰åŠŸèƒ½ä»¥åŠæ›´å¤šåŠŸèƒ½ï¼å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æ”¯æŒå¤§å‹çš„ä¸šåŠ¡åº”ç”¨çš„åˆ›å»º</p><p><strong>ç‰¹æ€§ï¼š</strong></p><ul><li>Bean instantiation/wiring</li><li>Bean çš„å®ä¾‹åŒ–/ä¸²è”</li><li>è‡ªåŠ¨çš„ BeanPostProcessor æ³¨å†Œ</li><li>è‡ªåŠ¨çš„ BeanFactoryPostProcessor æ³¨å†Œ</li><li>æ–¹ä¾¿çš„ MessageSource è®¿é—®ï¼ˆi18nï¼‰</li><li>ApplicationEvent çš„å‘å¸ƒ</li></ul><p>ä¸ BeanFactory æ‡’åŠ è½½çš„æ–¹å¼ä¸åŒï¼Œå®ƒæ˜¯é¢„åŠ è½½ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸€ä¸ª bean éƒ½åœ¨ ApplicationContext å¯åŠ¨ä¹‹åå®ä¾‹åŒ–</p><p>è¿™é‡Œæ˜¯ ApplicationContext çš„ä½¿ç”¨ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zoltanraffai;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean; </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.XmlBeanFactory; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldApp</span></span>&#123; </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">      ApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>); </span><br><span class="line">      HelloWorld obj = (HelloWorld) context.getBean(<span class="string">"helloWorld"</span>);    </span><br><span class="line">      obj.getMessage();    </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ApplicationContext åŒ…å« BeanFactory çš„æ‰€æœ‰ç‰¹æ€§ï¼Œé€šå¸¸æ¨èä½¿ç”¨å‰è€…ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›é™åˆ¶æƒ…å½¢ï¼Œæ¯”å¦‚ç§»åŠ¨åº”ç”¨å†…å­˜æ¶ˆè€—æ¯”è¾ƒä¸¥è‹›ï¼Œåœ¨é‚£äº›æƒ…æ™¯ä¸­ï¼Œä½¿ç”¨æ›´è½»é‡çº§çš„ BeanFactory æ˜¯æ›´åˆç†çš„ã€‚ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°ä¼ä¸šçº§çš„åº”ç”¨ä¸­ï¼ŒApplicationContext æ˜¯ä½ çš„é¦–é€‰ã€‚</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ul><li>å¦‚ä½•ä½¿ç”¨ BeanPostProcessor å’Œ BeanFactoryPostProcessor ï¼Ÿ</li><li>ä½ äº†è§£ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿäº†è§£äº†è¿™äº›å¯¹ä¸ bean çš„ä½¿ç”¨å°†æœ‰éå¸¸å¤§çš„å¸®åŠ©.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java equals å’Œ hashCode é¢è¯•é‚£ç‚¹äº‹</title>
      <link href="//p/java-equals-hashcode.html"/>
      <url>//p/java-equals-hashcode.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://dayarch.top/p/spring-data-binding-mechanism.html">å¦‚ä½•å¦™ç”¨ Spring æ•°æ®ç»‘å®šï¼Ÿ</a> ï¼Œ<strong>çµé­‚è¿½é—®</strong> ç¯èŠ‚ç•™ä¸‹äº†ä¸€ä¸ªæœ‰å…³ equals å’Œ hashcode é—®é¢˜ ã€‚åŸºç¡€é¢è¯•ç»å¸¸ä¼šç¢°åˆ°ä¸ä¹‹ç›¸å…³çš„é—®é¢˜ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ï¼Œä½†å¾ˆå¤šæœ‹å‹éƒ½è‹¦äºè¯´æ˜ä»–ä»¬äºŒè€…çš„å…³ç³»å’Œçº¦æŸï¼Œäºæ˜¯å†™æœ¬æ–‡åšå•ç‹¬è¯´æ˜ï¼Œæœ¬ç¯‡æ–‡ç« å°†å¾ªåºæ¸è¿› ( <em>é€šè¿‡ä¸¾ä¾‹ï¼Œè®©è®°å¿†ä¸ç†è§£æ›´è½»æ¾</em> ) è¯´æ˜è¿™äº›è®©ä½ æœ‰äº›è‹¦æ¼çš„é—®é¢˜ï¼ŒLetâ€™s go â€¦â€¦.</p><h2 id="é¢è¯•é—®é¢˜"><a href="#é¢è¯•é—®é¢˜" class="headerlink" title="é¢è¯•é—®é¢˜"></a>é¢è¯•é—®é¢˜</h2><h3 id="1-Java-é‡Œé¢æœ‰äº†-è¿ç®—ç¬¦ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦-equals-ï¼Ÿ"><a href="#1-Java-é‡Œé¢æœ‰äº†-è¿ç®—ç¬¦ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦-equals-ï¼Ÿ" class="headerlink" title="1. Java é‡Œé¢æœ‰äº† == è¿ç®—ç¬¦ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ equals ï¼Ÿ"></a>1. Java é‡Œé¢æœ‰äº† == è¿ç®—ç¬¦ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ equals ï¼Ÿ</h3><blockquote><p> <code>==</code> æ¯”è¾ƒçš„æ˜¯å¯¹è±¡åœ°å€ï¼Œ<code>equals</code> æ¯”è¾ƒçš„æ˜¯å¯¹è±¡å€¼</p></blockquote><p>å…ˆæ¥çœ‹ä¸€çœ‹ <code>Object</code> ç±»ä¸­ <code>equals</code> æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ° <code>equals</code> æ–¹æ³•åŒæ ·æ˜¯é€šè¿‡ <code>==</code> æ¯”è¾ƒå¯¹è±¡åœ°å€ï¼Œå¹¶æ²¡æœ‰å¸®æˆ‘ä»¬æ¯”è¾ƒå€¼ã€‚Java ä¸–ç•Œä¸­ <code>Object</code> ç»å¯¹æ˜¯â€è€ç¥–å®—â€ çš„å­˜åœ¨ï¼Œ<code>==</code> å·æˆ‘ä»¬æ²¡åŠæ³•æ”¹å˜æˆ–é‡å†™ã€‚ä½† <code>equals</code> æ˜¯æ–¹æ³•ï¼Œè¿™å°±ç»™äº†æˆ‘ä»¬é‡å†™ <code>equals</code> æ–¹æ³•çš„å¯èƒ½ï¼Œè®©æˆ‘ä»¬å®ç°å…¶å¯¹å€¼çš„æ¯”è¾ƒ: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//é‡å†™é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°ä¹°çš„ç”µè„‘ï¼Œæ¯ä¸ªç”µè„‘éƒ½æœ‰å”¯ä¸€çš„åºåˆ—å·ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç”µè„‘æ”¾åœ¨é¢å‰ï¼Œä½ ä¼šè¯´ç”±äºåºåˆ—å·ä¸ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªç”µè„‘ä¸ä¸€æ ·å—ï¼Ÿ</p><p>å¦‚æœæˆ‘ä»¬è¦è¯´ä¸¤ä¸ªç”µè„‘ä¸€æ ·ï¼Œé€šå¸¸æ˜¯æ¯”è¾ƒå…¶ã€Œå“ç‰Œ/å°ºå¯¸/é…ç½® ã€(å€¼) ï¼Œæ¯”å¦‚è¿™æ ·:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> å“ç‰Œç›¸ç­‰ &amp;&amp; å°ºå¯¸ç›¸ç­‰ &amp;&amp; é…ç½®ç›¸ç­‰</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“é‡åˆ°å¦‚ä¸Šåœºæ™¯æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡å†™ <code>equals</code> æ–¹æ³•ã€‚è¿™å°±è§£é‡Šäº† Java ä¸–ç•Œä¸ºä»€ä¹ˆæœ‰äº† <code>==</code> è¿˜æœ‰<code>equals</code> è¿™ä¸ªé—®é¢˜äº†. </p><h3 id="2-equalsç›¸ç­‰-å’Œ-hashcode-ç›¸ç­‰é—®é¢˜"><a href="#2-equalsç›¸ç­‰-å’Œ-hashcode-ç›¸ç­‰é—®é¢˜" class="headerlink" title="2.  equalsç›¸ç­‰ å’Œ hashcode ç›¸ç­‰é—®é¢˜"></a>2.  <code>equals</code>ç›¸ç­‰ å’Œ <code>hashcode</code> ç›¸ç­‰é—®é¢˜</h3><p>å…³äºäºŒè€…ï¼Œä½ ç»å¸¸ä¼šç¢°åˆ°ä¸‹é¢çš„ä¸¤ä¸ªé—®é¢˜:</p><ul><li>ä¸¤ä¸ªå¯¹è±¡ <code>equals</code> ç›¸ç­‰ï¼Œé‚£ä»–ä»¬ <code>hashCode</code> ç›¸ç­‰å—ï¼Ÿ</li><li>ä¸¤ä¸ªå¯¹è±¡ <code>hashCode</code> ç›¸ç­‰ï¼Œé‚£ä»–ä»¬ <code>equals</code> ç›¸ç­‰å—ï¼Ÿ</li></ul><p><em>ä¸ºäº†è¯´æ˜ä¸Šé¢ä¸¤ä¸ªé—®é¢˜çš„ç»“è®ºï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªä¸å¤ªæ°å½“çš„ä¾‹å­ï¼Œåªä¸ºæ–¹ä¾¿è®°å¿†</em>ï¼Œæˆ‘ä»¬å°† <code>equals</code> æ¯”ä½œä¸€ä¸ªå•è¯çš„æ‹¼å†™ï¼›<code>hashCode</code> æ¯”ä½œä¸€ä¸ªå•è¯çš„å‘éŸ³ï¼Œåœ¨ç›¸åŒè¯­å¢ƒä¸‹:</p><blockquote><p>sea / sea ã€Œå¤§æµ·ã€ï¼Œä¸¤ä¸ªå•è¯æ‹¼å†™ä¸€æ ·ï¼Œæ‰€ä»¥ <code>equals</code> ç›¸ç­‰ï¼Œä»–ä»¬è¯»éŸ³ <code>/siË/</code> ä¹Ÿä¸€æ ·ï¼Œæ‰€ä»¥ <code>hashCode</code> å°±ç›¸ç­‰ï¼Œè¿™å°±å›ç­”äº†ç¬¬ä¸€ä¸ªé—®é¢˜:</p><h4 id="ä¸¤ä¸ªå¯¹è±¡-equals-ç›¸ç­‰ï¼Œé‚£ä»–ä»¬-hashCode-ä¸€å®šä¹Ÿç›¸ç­‰"><a href="#ä¸¤ä¸ªå¯¹è±¡-equals-ç›¸ç­‰ï¼Œé‚£ä»–ä»¬-hashCode-ä¸€å®šä¹Ÿç›¸ç­‰" class="headerlink" title="ä¸¤ä¸ªå¯¹è±¡ equals ç›¸ç­‰ï¼Œé‚£ä»–ä»¬ hashCode ä¸€å®šä¹Ÿç›¸ç­‰"></a>ä¸¤ä¸ªå¯¹è±¡ <code>equals</code> ç›¸ç­‰ï¼Œé‚£ä»–ä»¬ <code>hashCode</code> ä¸€å®šä¹Ÿç›¸ç­‰</h4><p> sea / see ã€Œå¤§æµ·/çœ‹ã€ï¼Œä¸¤ä¸ªå•è¯çš„è¯»éŸ³  <code>/siË/</code> ä¸€æ ·ï¼Œæ˜¾ç„¶å•è¯æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™å°±å›ç­”äº†ç¬¬äºŒä¸ªé—®é¢˜:</p><h4 id="ä¸¤ä¸ªå¯¹è±¡-hashCode-ç›¸ç­‰ï¼Œé‚£ä»–ä»¬-equals-ä¸ä¸€å®šç›¸ç­‰"><a href="#ä¸¤ä¸ªå¯¹è±¡-hashCode-ç›¸ç­‰ï¼Œé‚£ä»–ä»¬-equals-ä¸ä¸€å®šç›¸ç­‰" class="headerlink" title="ä¸¤ä¸ªå¯¹è±¡ hashCode ç›¸ç­‰ï¼Œé‚£ä»–ä»¬ equals ä¸ä¸€å®šç›¸ç­‰"></a>ä¸¤ä¸ªå¯¹è±¡ <code>hashCode</code> ç›¸ç­‰ï¼Œé‚£ä»–ä»¬ <code>equals</code> ä¸ä¸€å®šç›¸ç­‰</h4></blockquote><p>æŸ¥çœ‹ <code>Object</code> ç±»çš„ <code>hashCode</code> æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>ç»§ç»­æŸ¥çœ‹è¯¥æ–¹æ³•çš„æ³¨é‡Šï¼Œæ˜ç¡®å†™æ˜å…³äºè¯¥æ–¹æ³•çš„çº¦æŸ<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-16_21-06-16.jpg" alt=""></fancybox></p><p>å…¶å®åœ¨è¿™ä¸ªç»“æœçš„èƒŒåï¼Œè¿˜æœ‰çš„æ˜¯å…³äºé‡å†™ <code>equals</code> æ–¹æ³•çš„çº¦æŸ</p><h3 id="3-é‡å†™-equals-æœ‰å“ªäº›çº¦æŸï¼Ÿ"><a href="#3-é‡å†™-equals-æœ‰å“ªäº›çº¦æŸï¼Ÿ" class="headerlink" title="3. é‡å†™ equals æœ‰å“ªäº›çº¦æŸï¼Ÿ"></a>3. é‡å†™ <code>equals</code> æœ‰å“ªäº›çº¦æŸï¼Ÿ</h3><p>å…³äºé‡å†™ <code>equals</code> æ–¹æ³•çš„çº¦æŸï¼ŒåŒæ ·åœ¨è¯¥æ–¹æ³•çš„æ³¨é‡Šä¸­å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘åœ¨è¿™é‡Œå†è¯´æ˜ä¸€ä¸‹:<br><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-16_20-49-14.jpg" alt=""></fancybox></p><p><strong>èµ¤æ©™çº¢ç»¿é’è“ç´«ï¼Œä¸ƒå½©ä»¥è‰²åˆ—ï¼›å“†æ¥å’ªå‘å”†æ‹‰è¥¿, ä¸€æ›²å®‰å“¥æ‹‰</strong> ï¼Œè¿™äº›è§„åˆ™ä¸æ˜¯ç”¨æ¥èƒŒè¯µçš„ï¼Œåªæ˜¯åœ¨ä½ éœ€è¦é‡å†™ <code>equals</code> æ–¹æ³•æ—¶ï¼Œæ‰“å¼€ JDK æŸ¥çœ‹è¯¥æ–¹æ³•ï¼ŒæŒ‰ç…§å‡†åˆ™é‡å†™å°±å¥½</p><h3 id="4-ä»€ä¹ˆæ—¶å€™éœ€è¦æˆ‘ä»¬é‡å†™-hashCodeï¼Ÿ"><a href="#4-ä»€ä¹ˆæ—¶å€™éœ€è¦æˆ‘ä»¬é‡å†™-hashCodeï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ—¶å€™éœ€è¦æˆ‘ä»¬é‡å†™ hashCodeï¼Ÿ"></a>4. ä»€ä¹ˆæ—¶å€™éœ€è¦æˆ‘ä»¬é‡å†™ <code>hashCode</code>ï¼Ÿ</h3><p>ä¸ºäº†æ¯”è¾ƒå€¼ï¼Œæˆ‘ä»¬é‡å†™ <code>equals</code> æ–¹æ³•ï¼Œé‚£ä»€ä¹ˆæ—¶å€™åˆéœ€è¦é‡å†™ <code>hashCode</code> æ–¹æ³•å‘¢ï¼Ÿ</p><blockquote><p>é€šå¸¸åªè¦æˆ‘ä»¬é‡å†™ <code>equals</code> æ–¹æ³•å°±è¦é‡å†™ <code>hashCode</code> æ–¹æ³•</p></blockquote><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„çº¦æŸå‘¢ï¼ŸæŒ‰ç…§ä¸Šé¢è®²çš„åŸåˆ™ï¼Œä¸¤ä¸ªå¯¹è±¡ <code>equals</code> ç›¸ç­‰ï¼Œé‚£ä»–ä»¬çš„ <code>hashCode</code> ä¸€å®šä¹Ÿç›¸ç­‰ã€‚å¦‚æœæˆ‘ä»¬åªé‡å†™ <code>equals</code> æ–¹æ³•è€Œä¸é‡å†™ <code>hashCode</code> æ–¹æ³•ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä¸¾ä¸ªä¾‹å­æ¥çœ‹:</p><p>å®šä¹‰å­¦ç”Ÿç±»ï¼Œå¹¶é€šè¿‡ IDE åªå¸®æˆ‘ä»¬ç”Ÿæˆ <code>equals</code> æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">Student student = (Student) o;</span><br><span class="line"><span class="keyword">return</span> age == student.age &amp;&amp;</span><br><span class="line">Objects.equals(name, student.name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™æµ‹è¯•ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Student student1 = <span class="keyword">new</span> Student();</span><br><span class="line">student1.setName(<span class="string">"æ—¥æ‹±ä¸€å…µ"</span>);</span><br><span class="line">student1.setAge(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">Student student2 = <span class="keyword">new</span> Student();</span><br><span class="line">student2.setName(<span class="string">"æ—¥æ‹±ä¸€å…µ"</span>);</span><br><span class="line">student2.setAge(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"student1.equals(student2)çš„ç»“æœæ˜¯ï¼š"</span> + student1.equals(student2));</span><br><span class="line"></span><br><span class="line">Set&lt;Student&gt; students = <span class="keyword">new</span> HashSet&lt;Student&gt;();</span><br><span class="line">students.add(student1);</span><br><span class="line">students.add(student2);</span><br><span class="line">System.out.println(<span class="string">"Student Set é›†åˆé•¿åº¦æ˜¯ï¼š"</span> + students.size());</span><br><span class="line"></span><br><span class="line">Map&lt;Student, java.lang.String&gt; map = <span class="keyword">new</span> HashMap&lt;Student, java.lang.String&gt;();</span><br><span class="line">map.put(student1, <span class="string">"student1"</span>);</span><br><span class="line">map.put(student2, <span class="string">"student2"</span>);</span><br><span class="line">System.out.println(<span class="string">"Student Map é›†åˆé•¿åº¦æ˜¯ï¼š"</span> + map.keySet().size());</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œç»“æœ:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">student1.equals(student2)çš„ç»“æœæ˜¯ï¼štrue</span><br><span class="line">Student Set é›†åˆé•¿åº¦æ˜¯ï¼š2</span><br><span class="line">Student Map é›†åˆé•¿åº¦æ˜¯ï¼š2</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼ŒæŒ‰ç…§é›†åˆ Set å’Œ Map åŠ å…¥å…ƒç´ çš„æ ‡å‡†æ¥çœ‹ï¼Œstudent1 å’Œ student2 æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œå› ä¸ºåœ¨è°ƒç”¨ä»–ä»¬çš„ put (Set add æ–¹æ³•çš„èƒŒåä¹Ÿæ˜¯ HashMap çš„ put)æ–¹æ³•æ—¶ï¼Œ ä¼šå…ˆåˆ¤æ–­ hash å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè¿™ä¸ªå°ä¼™ä¼´ä»¬æ‰“å¼€ JDK è‡ªè¡ŒæŸ¥çœ‹å§</p><p>æ‰€ä»¥æˆ‘ä»¬ç»§ç»­é‡å†™ Student ç±»çš„ <code>hashCode</code> æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(name, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œä¸Šé¢çš„æµ‹è¯•ï¼ŒæŸ¥çœ‹ç»“æœ:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">student1.equals(student2)çš„ç»“æœæ˜¯ï¼štrue</span><br><span class="line">Student Set é›†åˆé•¿åº¦æ˜¯ï¼š1</span><br><span class="line">Student Map é›†åˆé•¿åº¦æ˜¯ï¼š1</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æˆ‘ä»¬é¢„æœŸçš„ç»“æœï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆé€šå¸¸æˆ‘ä»¬é‡å†™ <code>equals</code> æ–¹æ³•ä¸ºä»€ä¹ˆæœ€å¥½ä¹Ÿé‡å†™ <code>hashCode</code> æ–¹æ³•çš„åŸå› </p><ul><li><p>å¦‚æœä½ åœ¨ä½¿ç”¨ Lombokï¼Œä¸çŸ¥é“ä½ æ˜¯å¦æ³¨æ„åˆ° Lombok åªæœ‰ä¸€ä¸ª <code>@EqualsAndHashCode</code> æ³¨è§£ï¼Œè€Œæ²¡æœ‰æ‹†åˆ†æˆ  @Equals å’Œ @HashCode ä¸¤ä¸ªæ³¨è§£ï¼Œæƒ³äº†è§£æ›´å¤š Lombok çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„æ–‡ç«  <a href="https://dayarch.top/p/lombok-usage.html">Lomok ä½¿ç”¨è¯¦è§£</a></p></li><li><p>å¦å¤–é€šè¿‡ IDE å¿«æ·é”®ç”Ÿæˆé‡å†™æ–¹æ³•æ—¶ï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯åƒ getter å’Œ setter é‚£æ ·åˆ†å¼€<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-17_11-36-14.jpg" alt=""></p></li></ul><p>ä»¥ä¸Šä¸¤ç‚¹éƒ½æ˜¯éšå½¢çš„è§„èŒƒçº¦æŸï¼Œå¸Œæœ›å¤§å®¶ä¹Ÿä¸¥æ ¼éµå®ˆè¿™ä¸ªè§„èŒƒï¼Œä»¥é˜²å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ï¼Œè®°å¿†çš„æ–¹å¼æœ‰å¤šæ ·ï¼Œå¦‚æœè®°ä¸ä½è¿™ä¸ªæ–‡å­—çº¦æŸï¼Œè„‘æµ·ä¸­è®°ä½ä¸Šé¢çš„å›¾ä½ ä¹Ÿå°±æ‡‚äº†</p><h3 id="5-é‡å†™-hashCode-ä¸ºä»€ä¹ˆæ€»æœ‰-31-è¿™ä¸ªæ•°å­—ï¼Ÿ"><a href="#5-é‡å†™-hashCode-ä¸ºä»€ä¹ˆæ€»æœ‰-31-è¿™ä¸ªæ•°å­—ï¼Ÿ" class="headerlink" title="5. é‡å†™ hashCode ä¸ºä»€ä¹ˆæ€»æœ‰ 31 è¿™ä¸ªæ•°å­—ï¼Ÿ"></a>5. é‡å†™ <code>hashCode</code> ä¸ºä»€ä¹ˆæ€»æœ‰ 31 è¿™ä¸ªæ•°å­—ï¼Ÿ</h3><p>ç»†å¿ƒçš„æœ‹å‹å¯èƒ½æ³¨æ„åˆ°ï¼Œæˆ‘ä¸Šé¢é‡å†™ <code>hashCode</code>çš„æ–¹æ³•å¾ˆç®€ç­”ï¼Œ å°±æ˜¯ç”¨äº† <code>Objects.hash</code>  æ–¹æ³•ï¼Œè¿›å»æŸ¥çœ‹é‡Œé¢çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">(Object a[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Object element : a)</span><br><span class="line">        result = <span class="number">31</span> * result + (element == <span class="keyword">null</span> ? <span class="number">0</span> : element.hashCode());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé€šè¿‡ 31 æ¥è®¡ç®—å¯¹è±¡ hash å€¼</p><p>åœ¨ <a href="https://dayarch.top/p/spring-data-binding-mechanism.html">å¦‚ä½•å¦™ç”¨ Spring æ•°æ®ç»‘å®šï¼Ÿ</a> æ–‡ç« æœ«å°¾æåˆ°çš„åœ¨ <code>HandlerMethodArgumentResolverComposite</code> ç±»ä¸­æœ‰è¿™æ ·ä¸€ä¸ªæˆå‘˜å˜é‡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MethodParameter, HandlerMethodArgumentResolver&gt; argumentResolverCache =</span><br><span class="line"><span class="keyword">new</span> ConcurrentHashMap&lt;MethodParameter, HandlerMethodArgumentResolver&gt;(<span class="number">256</span>);</span><br></pre></td></tr></table></figure><p>Map çš„ key æ˜¯ <code>MethodParameter</code> ï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„åˆ†æï¼Œè¿™ä¸ªç±»ä¸€å®šä¹Ÿä¼šé‡å†™ <code>equals</code> å’Œ <code>hashCode</code> æ–¹æ³•ï¼Œè¿›å»æŸ¥çœ‹å‘ç°ï¼ŒhashCode çš„è®¡ç®—ä¹Ÿç”¨åˆ°äº† 31 è¿™ä¸ªæ•°å­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object other)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == other) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!(other <span class="keyword">instanceof</span> MethodParameter)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    MethodParameter otherParam = (MethodParameter) other;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span>.parameterIndex == otherParam.parameterIndex &amp;&amp; getMember().equals(otherParam.getMember()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (getMember().hashCode() * <span class="number">31</span> + <span class="keyword">this</span>.parameterIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè®¡ç®— hash å€¼è¦ç”¨åˆ° 31 è¿™ä¸ªæ•°å­—å‘¢ï¼Ÿæˆ‘åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡ä¸é”™çš„æ–‡ç« ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œä½œä¸ºç§‘æ™®ï¼Œå¯ä»¥ç®€å•æŸ¥çœ‹ä¸€ä¸‹:<br><a href="https://www.cnblogs.com/nullllun/p/8350178.html" target="_blank" rel="noopener">String hashCode æ–¹æ³•ä¸ºä»€ä¹ˆé€‰æ‹©æ•°å­—31ä½œä¸ºä¹˜å­</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœè¿˜å¯¹<code>equals</code> å’Œ <code>hashCode</code> å…³ç³»åŠçº¦æŸå«æ··ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é€æ­¥å›å¿†å³å¯ï¼Œæ›´å¥½çš„æ˜¯ç›´æ¥æŸ¥çœ‹ JDK æºç ï¼›å¦å¤–æ‹¿å‡ºå®é™…çš„ä¾‹å­æ¥åæ¨éªŒè¯æ˜¯éå¸¸å¥½çš„åŠæ³•ã€‚å¦‚æœä½ è¿˜æœ‰ç›¸å…³ç–‘é—®ï¼Œä¹Ÿå¯ä»¥ç•™è¨€æ¢è®¨. </p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>Thread ç±»å°±æ²¡æœ‰é‡å†™ <code>equals</code> æ–¹æ³•ï¼Œä½ è¿˜çŸ¥é“å“ªäº›æƒ…å†µæ²¡å¿…è¦é‡å†™ <code>equals</code> æ–¹æ³•å—ï¼Ÿ</li><li>ä»ä¸Šé¢ HandlerMethodArgumentResolverComposite ç±»ä¸­å®šä¹‰çš„ Map æˆå‘˜å˜é‡ï¼Œä½ æ³¨æ„åˆ°å“ªäº›çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚ finalï¼ŒConcurrentHashMapï¼Œåˆè¯†å®¹é‡ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ï¼Ÿä½ èƒ½è§£é‡Šå‡ºåŸå› å—ï¼Ÿ</li></ol><hr>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring æ•°æ®ç»‘å®šå‰–æ</title>
      <link href="//p/spring-data-binding-mechanism.html"/>
      <url>//p/spring-data-binding-mechanism.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å‰–æå®Œ ã€Œ<a href="https://dayarch.top/p/spring-boot-global-return.html">Spring Boot ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a> ã€æ–‡ç« ä¹‹åï¼Œä¸€ç›´è§‰å¾—æœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ Springâ€™s Data Binding Mechanism ã€ŒSpring æ•°æ®ç»‘å®šæœºåˆ¶ã€ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring åªçŸ¥é“å¦‚ä½•è½¬æ¢ç®€å•æ•°æ®ç±»å‹ã€‚æ¯”å¦‚æˆ‘ä»¬æäº¤çš„ intã€String æˆ– booleanç±»å‹çš„è¯·æ±‚æ•°æ®ï¼Œå®ƒä¼šè‡ªåŠ¨ç»‘å®šåˆ°ä¸ä¹‹å¯¹åº”çš„ Java ç±»å‹ã€‚ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿œè¿œä¸å¤Ÿï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½éœ€è¦ç»‘å®šæ›´å¤æ‚çš„å¯¹è±¡ç±»å‹ã€‚</p><p>æˆ‘ä»¬éœ€è¦äº†è§£ Spring æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ›´çµæ´»çš„åšå…¨å±€é…ç½®æˆ–è‡ªå®šä¹‰é…ç½®ï¼Œè¿›è€Œè®©æˆ‘ä»¬çš„ RESTful API æ›´ç®€æ´ï¼Œå¯è¯»æ€§ä¹Ÿæ›´å¥½ã€‚æœ¬æ–‡ä¾æ—§å…ˆé€šè¿‡ç¤ºä¾‹ä»£ç è¯´æ˜å®ç°ï¼Œç„¶åè¿›è¡Œæºç åˆ†æï¼Œå¸¦é¢†å¤§å®¶äº†è§£è¿™ä¸ªæœºåˆ¶æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œ Letâ€™s goâ€¦â€¦</p><h2 id="Spring-æ•°æ®ç»‘å®š"><a href="#Spring-æ•°æ®ç»‘å®š" class="headerlink" title="Spring æ•°æ®ç»‘å®š"></a>Spring æ•°æ®ç»‘å®š</h2><h3 id="æ—¥æœŸç»‘å®š"><a href="#æ—¥æœŸç»‘å®š" class="headerlink" title="æ—¥æœŸç»‘å®š"></a>æ—¥æœŸç»‘å®š</h3><p>å…ˆæ¥çœ‹ä¸‹é¢ä¸€å°æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/bindings/"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;date&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSpecificDateInfo</span><span class="params">(@PathVariable LocalDateTime date)</span> </span>&#123;</span><br><span class="line">log.info(date.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç”¨ Postman è¯·æ±‚è¿™ä¸ª API</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/rgyb/bindings/2019-12-10 12:00:00</span><br></pre></td></tr></table></figure><p>å¦‚æˆ‘ä»¬æ‰€æ–™ï¼ŒæŠ›å‡ºæ•°æ®ç±»å‹è½¬æ¢å¼‚å¸¸<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_13-44-29.jpg" alt=""><br>å› ä¸º Spring é»˜è®¤ä¸æ”¯æŒå°† String ç±»å‹çš„è¯·æ±‚å‚æ•°è½¬æ¢ä¸º LocalDateTime ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ converter ã€Œè½¬æ¢å™¨ã€å®Œæ•´æ•´ä¸ªè½¬æ¢è¿‡ç¨‹</p><p>è‡ªå®šä¹‰è½¬æ¢å™¨ <code>StringToLocalDateTimeConverter</code>ï¼Œä½¿å…¶å®ç° <code>org.springframework.core.convert.converter.Converter&lt;S, T&gt;</code> æ¥å£ï¼Œåœ¨é‡å†™çš„ convert æ–¹æ³•ä¸­å®ç°æˆ‘ä»¬è‡ªå®šä¹‰çš„è½¬æ¢é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToLocalDateTimeConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">LocalDateTime</span>&gt; </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalDateTime <span class="title">convert</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>, Locale.CHINESE);</span><br><span class="line"><span class="keyword">return</span> LocalDateTime.parse(s, formatter);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†è½¬æ¢å™¨æ³¨å†Œåˆ°ä¸Šä¸‹æ–‡ä¸­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnifiedReturnConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">registry.addConverter(<span class="keyword">new</span> StringToLocalDateTimeConverter());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°è®¿é—®ä¸Šé¢é“¾æ¥ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼ŒæŒ‰ç…§é¢„æœŸå¾—åˆ°ç›¸åº”è½¬æ¢ç»“æœ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.e.unifiedreturn.api.BindingController  : 2019-12-10T12:00</span><br></pre></td></tr></table></figure><p>çŸ¥é“äº†è¿™ä¸ªï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„æšä¸¾ç±»å‹ä¹Ÿå¯ä»¥åº”ç”¨è¿™ç§æ–¹å¼åšæ•°æ®ç»‘å®š</p><h3 id="æšä¸¾ç±»å‹ç»‘å®š"><a href="#æšä¸¾ç±»å‹ç»‘å®š" class="headerlink" title="æšä¸¾ç±»å‹ç»‘å®š"></a>æšä¸¾ç±»å‹ç»‘å®š</h3><p>åŒæ ·çš„å¥—è·¯ï¼Œè‡ªå®šä¹‰è½¬æ¢å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToEnumConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Modes</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Modes <span class="title">convert</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Modes.valueOf(s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å…¶æ·»åŠ è‡³ä¸Šä¸‹æ–‡ï¼Œè¯·å°ä¼™ä¼´ä»¬è‡ªè¡Œå°è¯•å§ï¼ŒçŸ¥é“äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å†ä¹Ÿä¸ç”¨åœ¨ RESTful API å†…éƒ¨åšæ•°æ®è½¬æ¢äº†ï¼Œæˆ‘ä»¬åšåˆ°äº†å…¨å±€æ§åˆ¶ï¼ŒåŒæ—¶è®©æ•´ä¸ª API çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ç®€æ´</p><h3 id="ç»‘å®šå¯¹è±¡"><a href="#ç»‘å®šå¯¹è±¡" class="headerlink" title="ç»‘å®šå¯¹è±¡"></a>ç»‘å®šå¯¹è±¡</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ•°æ®ç»‘å®šåˆ°å¯¹è±¡ï¼Œè¿™æ—¶æˆ‘ä»¬å¯èƒ½é©¬ä¸Šè”æƒ³èµ·æ¥ä½¿ç”¨ <code>@RequestBody</code> æ³¨è§£ï¼Œè¯¥æ³¨è§£é€šå¸¸ç”¨äºè·å– POST è¯·æ±‚ä½“ï¼Œå¹¶å°†å…¶è½¬æ¢ç›¸åº”çš„æ•°æ®å¯¹è±¡</p><p>åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œé™¤äº†<code>è¯·æ±‚ä½“</code>ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦<code>è¯·æ±‚å¤´</code>ä¸­çš„æ•°æ®ï¼Œæ¯”å¦‚ <code>token</code> ï¼Œtoken ä¸­åŒ…å«å½“å‰ç™»é™†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¯ä¸€æ¬¡ RESTful è¯·æ±‚æˆ‘ä»¬éƒ½éœ€è¦ä» header ä¸­è·å– token æ•°æ®å¤„ç†å®é™…ä¸šåŠ¡ï¼Œè¿™ç§åœºæ™¯ï¼Œä¸Šæ–‡æåˆ°çš„ <code>Converter</code> ä»¥åŠ <code>@RequestBody</code> æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±è¦æ¢å¦ä¸€ç§è§£å†³æ–¹æ¡ˆ : <code>HandlerMethodArgumentResolver</code></p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ <code>LoginUser</code> (<strong>è¿è¡Œæ—¶ç”Ÿæ•ˆï¼Œä½œç”¨äºå‚æ•°ä¸Š</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.PARAMETER)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LoginUser &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè‡ªå®šä¹‰ <code>LoginUserArgumentResolver</code> ï¼Œä½¿å…¶å®ç° <code>HandlerMethodArgumentResolver</code> æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginUserArgumentResolver</span> <span class="keyword">implements</span> <span class="title">HandlerMethodArgumentResolver</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter methodParameter)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å‚æ•°æ˜¯å¦æœ‰è‡ªå®šä¹‰æ³¨è§£ LoginUser ä¿®é¥°</span></span><br><span class="line"><span class="keyword">return</span> methodParameter.hasParameterAnnotation(LoginUser.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter methodParameter, ModelAndViewContainer modelAndViewContainer, NativeWebRequest nativeWebRequest, WebDataBinderFactory webDataBinderFactory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">HttpServletRequest request = (HttpServletRequest) nativeWebRequest.getNativeRequest();</span><br><span class="line"></span><br><span class="line">LoginUserVo loginUserVo = <span class="keyword">new</span> LoginUserVo();</span><br><span class="line"></span><br><span class="line">String token = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line"><span class="keyword">if</span> (Strings.isNotBlank(token))&#123;</span><br><span class="line"><span class="comment">//é€šå¸¸è¿™é‡Œéœ€è¦ç¼–å†™ token è§£æé€»è¾‘ï¼Œå¹¶å°†å…¶æ”¾åˆ° LoginUserVo å¯¹è±¡ä¸­</span></span><br><span class="line"><span class="comment">//logic</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨æ­¤ä¸ºäº†å¿«é€Ÿç®€æ´çš„åšæ¼”ç¤ºè¯´æ˜ï¼Œçœç•¥æ‰è§£æ token éƒ¨åˆ†ï¼Œç›´æ¥ä» header æŒ‡å®š key ä¸­è·å–æ•°æ®</span></span><br><span class="line">loginUserVo.setId(Long.valueOf(request.getHeader(<span class="string">"userId"</span>)));</span><br><span class="line">loginUserVo.setName(request.getHeader(<span class="string">"userName"</span>));</span><br><span class="line"><span class="keyword">return</span> loginUserVo;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾æ—§å°†è‡ªå®šä¹‰çš„ <code>LoginUserArgumentResolver</code> æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; resolvers)</span> </span>&#123;</span><br><span class="line">    resolvers.add(<span class="keyword">new</span> LoginUserArgumentResolver());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™ API:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getLoginUserInfo</span><span class="params">(@LoginUser LoginUserVo loginUserVo)</span> </span>&#123;</span><br><span class="line">    log.info(loginUserVo.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Postman è¯·æ±‚ï¼Œåœ¨ header ä¸­è®¾ç½®å¥½ç›¸åº”çš„ K-Vï¼Œå¦‚ä¸‹å›¾</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://localhost:8080/rgyb/bindings/id</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_15-32-15.jpg" alt=""></p><p>å‘é€è¯·æ±‚ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼Œå¾—åˆ°é¢„æœŸç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.e.unifiedreturn.api.BindingController  : LoginUserVo(id=111111, name=rgyb)</span><br></pre></td></tr></table></figure><p>ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ å·²ç»äº†è§£äº†åŸºæœ¬çš„ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œæºç åˆ†æï¼Œé€è¿‡ç°è±¡çœ‹æœ¬è´¨ (å¸Œæœ›å¯ä»¥æ‰“å¼€ IDE è·Ÿç€æ­¥éª¤æŸ¥çœ‹)</p><h2 id="Spring-æ•°æ®ç»‘å®šæºç åˆ†æ"><a href="#Spring-æ•°æ®ç»‘å®šæºç åˆ†æ" class="headerlink" title="Spring æ•°æ®ç»‘å®šæºç åˆ†æ"></a>Spring æ•°æ®ç»‘å®šæºç åˆ†æ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£æˆ‘ä»¬è‡ªå®šä¹‰çš„  <code>LoginUserArgumentResolver</code> æ˜¯å¦‚ä½•è¢«åŠ è½½åˆ°ä¸Šä¸‹æ–‡ä¸­çš„ï¼Œåœ¨ä½ çœ‹è¿‡  <a href="https://dayarch.top/p/spring-boot-messageconverter.html">HttpMessageConverterè½¬æ¢åŸç†è§£æ</a>  å’Œ <a href="https://dayarch.top/p/spring-boot-global-return.html">Springbootè¿”å›ç»Ÿä¸€JSONæ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a>åï¼Œä½ ä¹Ÿè®¸å·²ç»æœ‰äº†çœ‰ç›®ï¼ŒåŒåŠ è½½ MessageConverter å¦‚å‡ºä¸€è¾™ï¼Œåœ¨ <code>RequestMappingHandlerAdapter</code> ç±»ä¸­ï¼ŒåŒæ ·æœ‰æ·»åŠ  ArgumentResolver çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæŠŠç³»ç»Ÿå†…ç½®çš„ resolver å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ resolver éƒ½åŠ è½½åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œå…³é”®ä»£ç å±•ç¤ºå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;HandlerMethodArgumentResolver&gt; <span class="title">getDefaultArgumentResolvers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;HandlerMethodArgumentResolver&gt; resolvers = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    resolvers.add(<span class="keyword">new</span> RequestParamMethodArgumentResolver(<span class="keyword">this</span>.getBeanFactory(), <span class="keyword">false</span>));</span><br><span class="line">    <span class="comment">//å…¶ä»–å†…ç½® resolver</span></span><br><span class="line"></span><br><span class="line">    resolvers.add(<span class="keyword">new</span> RequestResponseBodyMethodProcessor(<span class="keyword">this</span>.getMessageConverters(), <span class="keyword">this</span>.requestResponseBodyAdvice));</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.getCustomArgumentResolvers() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        resolvers.addAll(<span class="keyword">this</span>.getCustomArgumentResolvers());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> resolvers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <a href="https://dayarch.top/p/spring-boot-messageconverter.html">HttpMessageConverterè½¬æ¢åŸç†è§£æ</a> æ–‡ç« ä¸­æœ‰ä¸€æ®µè°ƒç”¨æ ˆè·Ÿè¸ªï¼Œæˆ‘å†æ¬¡ç²˜è´´åœ¨æ­¤å¤„ï¼Œå¹¶ç”¨çº¢æ¡†åšå‡ºæ ‡è®°ï¼Œå…¶å®æˆ‘ä»¬åœ¨åˆ†æ messageConverter æ—¶å·²ç»æ‚„æ‚„çš„è·¯è¿‡äº†æˆ‘ä»¬æœ¬èŠ‚è¦è¯´çš„å†…å®¹<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_16-00-32.jpg" alt=""></p><p>æˆ‘ä»¬è¿›å…¥ç›¸åº”çš„ç±»ä¸­ç§ä¸€ç§:<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_16-02-47.jpg" alt=""></p><p>åˆ°è¿™é‡Œä½ åº”è¯¥çŒ›çš„äº†è§£è¿™èƒŒåçš„é“ç†äº†å§</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥éªŒè¯æˆ‘ä»¬å¤©å¤©ç”¨çš„ <code>@RequestBody</code> æ³¨è§£æ˜¯ä¸æ˜¯è¿™ä¸ªå¥—è·¯å‘¢ï¼Ÿ<br>å¤„ç†è¯¥æ³¨è§£çš„ç±»æ˜¯ <code>RequestResponseBodyMethodProcessor</code>ï¼ŒæŸ¥çœ‹å…¶ç±»å›¾ï¼Œå‘ç°å…¶ä¾æ—§å®ç°äº† <code>HandlerMethodArgumentResolver</code> æ¥å£</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_16-09-04.jpg" alt=""></p><p>æ‰“å¼€è¯¥ç±»ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹å›¾ä»£ç ï¼Œé‡ç‚¹åœ°æ–¹æˆ‘å·²æ ‡è®°å‡ºæ¥<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_16-18-36.jpg" alt=""></p><p>æ•´ä½“å¤„ç†æµç¨‹å¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡åœ¨é‡Œé¢è°ƒç”¨äº† messageConverter æ¥è§£æ JSON æ•°æ®ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è¯´çš„ Converter å’Œ ArgumentResolver ä»¥åŠåœ¨ Spring MVC ä¸­å¸¸ç”¨çš„ <code>@InitBinder</code> æ³¨è§£æ•´ä½“è¿‡ç¨‹éƒ½å¦‚å‡ºä¸€è¾™ï¼Œå¤§å®¶éƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ€è·¯æ¥æŸ¥çœ‹å…·ä½“çš„å®ç°ã€‚å¦å¤–ï¼Œåœ¨æˆ‘ä»¬å®Œæˆæ—¥å¸¸ç¼–ç å·¥ä½œæ—¶ï¼Œéƒ½å¯ä»¥ä» Spring ç°æœ‰çš„å¤„ç†æ–¹å¼ä¸­æ‘¸ç´¢åˆ°ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œä½†å‰ææ˜¯ä½ äº†è§£ Spring åº•å±‚çš„ä¸€äº›è°ƒç”¨è¿‡ç¨‹</p><p>æœ€åå¸Œæœ›å°ä¼™ä¼´æ‰“å¼€ IDE åˆ‡å®æŸ¥çœ‹ç›¸åº”ä»£ç ï¼Œä½ ä¸€å®šè¿˜ä¼šæœ‰æ–°å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ¢è®¨ã€‚æœ¬æ–‡ä»£ç å·²ä¸Šä¼ ï¼Œå…¬ä¼—å·å›å¤ã€Œdemoã€ï¼Œæ‰“å¼€é“¾æ¥æŸ¥çœ‹ ã€Œspring-boot-unified-returnã€æ–‡ä»¶å¤¹å†…å®¹å³å¯ï¼Œä¹Ÿå¯ä»¥é¡ºè·¯å›é¡¾ä»¥å‰ Spring Boot ç»Ÿä¸€è¿”å›æ ¼å¼çš„ä»£ç å®ç°</p><hr><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-12-12_18-12-09.jpg" alt=""></p><ol><li>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨è¿½ä¸­æºç æ—¶ï¼Œå‘ç°<code>HandlerMethodArgumentResolverComposite</code> æ˜¯ <code>HandlerMethodArgumentResolver</code> çš„å®ç°ç±»ä¹‹ä¸€ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª Map ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨ Mapï¼Œkey çš„ç±»å‹å¤šæ•°ä¸º String ç±»å‹ï¼Œä½†çœ‹åˆ°è¿™ä¸ª Map ä¸­æœ‰è¿™æ ·çš„ key ä½ é©¬ä¸Šæƒ³åˆ°çš„æ˜¯ä»€ä¹ˆï¼ŸåŸºç¡€é¢è¯•ç»å¸¸ä¼šé—® equals å’Œ hashcode çš„é—®é¢˜ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šå€Ÿç€è¿™ä¸ªç±»æ¥åˆ†æè¯´æ˜ä¸€ä¸‹ä½ æ€»å›°æƒ‘çš„è¿™ä»¶å°äº‹</li><li>å¯¹äº Spring Boot çš„æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ï¼Œä½ èƒ½æè¿°å‡ºæ•´ä½“æµç¨‹å—ï¼Ÿ</li><li>Spring å†…ç½®å¤šå°‘ä¸ª Resolverï¼Ÿä½ å¯ä»¥è·Ÿè¸ªè°ƒè¯•è·å–åˆ°</li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Data Binding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lombok ä½¿ç”¨æ•™ç¨‹è¯¦è§£</title>
      <link href="//p/lombok-usage.html"/>
      <url>//p/lombok-usage.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Java åº”ç”¨ç¨‹åºä¸­å­˜åœ¨è®¸å¤šé‡å¤ç›¸ä¼¼çš„ã€ç”Ÿæˆä¹‹åå‡ ä¹ä¸å¯¹å…¶åšæ›´æ”¹çš„ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ä¸å¾—ä¸èŠ±è´¹å¾ˆå¤šç²¾åŠ›ç¼–å†™å®ƒä»¬æ¥æ»¡è¶³ Java çš„ç¼–è¯‘éœ€æ±‚</p><p>æ¯”å¦‚ï¼Œåœ¨ Java åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å‡ ä¹è¦ä¸ºæ‰€æœ‰ Bean çš„æˆå‘˜å˜é‡æ·»åŠ  get() ,set() ç­‰æ–¹æ³•ï¼Œè¿™äº›ç›¸å¯¹å›ºå®šä½†åˆä¸å¾—ä¸ç¼–å†™çš„ä»£ç æµªè´¹ç¨‹åºå‘˜å¾ˆå¤šç²¾åŠ›ï¼ŒåŒæ—¶è®©ç±»å†…å®¹çœ‹ç€æ›´æ‚ä¹±ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æœ‰é™çš„ç²¾åŠ›å…³æ³¨åœ¨æ›´é‡è¦çš„åœ°æ–¹ã€‚</p><p>Lombok å·²ç»è¯ç”Ÿå¾ˆä¹…äº†ï¼Œç”šè‡³åœ¨ Spring Boot Initalizr ä¸­éƒ½å·²åŠ å…¥äº† Lombok é€‰é¡¹ï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-25_11-53-49.jpg" alt=""></p><p>è¿™é‡Œæˆ‘ä»¬å°† Lombok åšä¸€ä¸‹è¯¦ç»†è¯´æ˜:</p><h2 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h2><blockquote><p><strong>å®˜ç½‘çš„ä»‹ç»</strong>ï¼šProject Lombok is a java library that automatically plugs into your editor and build tools, spicing up your java. Never write another getter or equals method again. Early access to future java features such as val, and much more.</p></blockquote><p><strong>ç›´ç™½çš„è¯´ï¼š</strong> Lombok æ˜¯ä¸€ç§ Javaâ„¢ å®ç”¨å·¥å…·ï¼Œå¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜æ¶ˆé™¤ Java çš„å†—é•¿ï¼Œå°¤å…¶æ˜¯å¯¹äºç®€å•çš„ Java å¯¹è±¡ï¼ˆPOJOï¼‰ã€‚å®ƒé€šè¿‡æ³¨è§£å®ç°è¿™ä¸€ç›®çš„ï¼Œä¸”çœ‹:</p><h3 id="Bean-çš„å¯¹æ¯”"><a href="#Bean-çš„å¯¹æ¯”" class="headerlink" title="Bean çš„å¯¹æ¯”"></a>Bean çš„å¯¹æ¯”</h3><p>ä¼ ç»Ÿçš„ POJO ç±»æ˜¯è¿™æ ·çš„<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage001.png" alt=""></p><p>é€šè¿‡Lombokæ”¹é€ åçš„ POJO ç±»æ˜¯è¿™æ ·çš„<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage003.png" alt=""></p><p>ä¸€çœ¼å¯ä»¥è§‚å¯Ÿå‡ºæ¥æˆ‘ä»¬åœ¨ç¼–å†™ Employee è¿™ä¸ªç±»çš„æ—¶å€™é€šè¿‡ <code>@Data</code> æ³¨è§£å°±å·²ç»å®ç°äº†æ‰€æœ‰æˆå‘˜å˜é‡çš„ <code>get()</code> ä¸ <code>set()</code> æ–¹æ³•ç­‰ï¼ŒåŒæ—¶ Employee ç±»çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ç®€æ´ã€‚Lombok çš„ç¥å¥‡ä¹‹å¤„ä¸æ­¢è¿™äº›ï¼Œä¸°å¯Œçš„æ³¨è§£æ»¡è¶³äº†æˆ‘ä»¬å¼€å‘çš„å¤šæ•°éœ€æ±‚ã€‚</p><h3 id="Lombokçš„å®‰è£…"><a href="#Lombokçš„å®‰è£…" class="headerlink" title="Lombokçš„å®‰è£…"></a>Lombokçš„å®‰è£…</h3><p>æŸ¥çœ‹ä¸‹å›¾ï¼Œ@Dataçš„å®ç°ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªæ³¨è§£æ˜¯åº”ç”¨åœ¨ç¼–è¯‘é˜¶æ®µçš„<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage005.png" alt=""></p><p>è¿™å’Œæˆ‘ä»¬å¤§å¤šæ•°ä½¿ç”¨çš„æ³¨è§£ï¼Œå¦‚ Spring çš„æ³¨è§£ï¼ˆåœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡åå°„æ¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼‰æ˜¯æœ‰å¾ˆå¤§å·®åˆ«çš„ï¼Œå¦‚Spring çš„@RestController æ³¨è§£<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage007.png" alt=""> </p><p>ä¸€ä¸ªæ›´ç›´æ¥çš„ä½“ç°å°±æ˜¯ï¼Œæ™®é€šçš„åŒ…åœ¨å¼•ç”¨ä¹‹åä¸€èˆ¬çš„ IDE éƒ½èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«è¯­æ³•ï¼Œä½†æ˜¯ Lombok çš„è¿™äº›æ³¨è§£ï¼Œä¸€èˆ¬çš„ IDE éƒ½æ— æ³•è‡ªåŠ¨è¯†åˆ«ï¼Œå› æ­¤å¦‚æœè¦ä½¿ç”¨ Lombok çš„è¯è¿˜éœ€è¦é…åˆå®‰è£…ç›¸åº”çš„æ’ä»¶æ¥æ”¯æŒ IDE çš„ç¼–è¯‘ï¼Œé˜²æ­¢IDE çš„è‡ªåŠ¨æ£€æŸ¥æŠ¥é”™ï¼Œä¸‹é¢ä»¥ IntelliJ IDEA ä¸¾ä¾‹å®‰è£…æ’ä»¶ã€‚</p><p>åœ¨Repositoriesä¸­æœç´¢Lombokï¼Œå®‰è£…åé‡å¯IDEå³å¯<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage009.png" alt=""></p><p>åœ¨Mavenæˆ–Gradleå·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-25_11-32-32.jpg" alt=""></p><p>è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥åº”ç”¨ Lombok æä¾›çš„æ³¨è§£å¹²äº›äº‹æƒ…äº†ã€‚</p><h2 id="Lombokæ³¨è§£è¯¦è§£"><a href="#Lombokæ³¨è§£è¯¦è§£" class="headerlink" title="Lombokæ³¨è§£è¯¦è§£"></a>Lombokæ³¨è§£è¯¦è§£</h2><p>Lombokå®˜ç½‘æä¾›äº†è®¸å¤šæ³¨è§£ï¼Œä½†æ˜¯ â€œåŠ²é…’è™½å¥½ï¼Œå¯ä¸è¦è´ªæ¯å“¦â€ï¼Œæ¥ä¸‹æ¥é€ä¸€è®²è§£å®˜ç½‘æ¨èä½¿ç”¨çš„æ³¨è§£(æœ‰äº›æ³¨è§£å’ŒåŸæœ‰Javaç¼–å†™æ–¹å¼æ²¡å¤ªå¤§å·®åˆ«çš„ä¹Ÿæ²¡æœ‰åœ¨æ­¤å¤„åˆ—ä¸¾ï¼Œå¦‚@ Synchronizedç­‰)<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage013.png" alt=""></p><h3 id="Getterå’Œ-Setter"><a href="#Getterå’Œ-Setter" class="headerlink" title="@Getterå’Œ@Setter"></a>@Getterå’Œ@Setter</h3><p>è¯¥æ³¨è§£å¯åº”ç”¨åœ¨ç±»æˆ–æˆå‘˜å˜é‡ä¹‹ä¸Šï¼Œå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€æ ·ï¼Œ<code>@Getter</code> å’Œ <code>@Setter</code> å°±æ˜¯ä¸ºæˆå‘˜å˜é‡è‡ªåŠ¨ç”Ÿæˆ get å’Œ set æ–¹æ³•ï¼Œé»˜è®¤ç”Ÿæˆè®¿é—®æƒé™ä¸º public æ–¹æ³•ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè®¿é—®æƒé™ protected ç­‰ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage015.png" alt=""> </p><p>æˆå‘˜å˜é‡nameæŒ‡å®šç”Ÿæˆsetæ–¹æ³•ï¼Œå¹¶ä¸”è®¿é—®æƒé™ä¸ºprotectedï¼›booleanç±»å‹çš„æˆå‘˜å˜é‡ female åªç”Ÿæˆgetæ–¹æ³•ï¼Œå¹¶ä¿®æ”¹æ–¹æ³•åç§°ä¸º isFemale()ã€‚å½“æŠŠè¯¥æ³¨è§£åº”ç”¨åœ¨ç±»ä¸Šï¼Œé»˜è®¤ä¸ºæ‰€æœ‰éé™æ€æˆå‘˜å˜é‡ç”Ÿæˆ get å’Œ set æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ AccessLevel.NONE æ‰‹åŠ¨ç¦æ­¢ç”Ÿæˆgetæˆ–setæ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage017.png" alt=""></p><h3 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h3><p>è¯¥æ³¨è§£éœ€åº”ç”¨åœ¨ç±»ä¸Šï¼Œä¸ºæˆ‘ä»¬ç”Ÿæˆ Object çš„ toString æ–¹æ³•ï¼Œè€Œè¯¥æ³¨è§£é‡Œé¢çš„å‡ ä¸ªå±æ€§èƒ½æ›´åŠ ä¸°å¯Œæˆ‘ä»¬æƒ³è¦çš„å†…å®¹, <code>exclude</code> å±æ€§ç¦æ­¢åœ¨ toString æ–¹æ³•ä¸­ä½¿ç”¨æŸå­—æ®µï¼Œè€Œofå±æ€§å¯ä»¥æŒ‡å®šéœ€è¦ä½¿ç”¨çš„å­—æ®µï¼Œå¦‚ä¸‹å›¾ï¼š</p><p> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage019.png" alt=""></p><p>æŸ¥çœ‹ç¼–è¯‘åçš„Employee.classå¾—åˆ°æˆ‘ä»¬é¢„æœŸçš„ç»“æœï¼Œå¦‚ä¸‹å›¾<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage021.png" alt=""></p><h3 id="EqualsAndHashCode"><a href="#EqualsAndHashCode" class="headerlink" title="@EqualsAndHashCode"></a>@EqualsAndHashCode</h3><p>è¯¥æ³¨è§£éœ€åº”ç”¨åœ¨ç±»ä¸Šï¼Œä½¿ç”¨è¯¥æ³¨è§£ï¼Œlombokä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆ equals(Object other) å’Œ hashcode() æ–¹æ³•ï¼ŒåŒ…æ‹¬æ‰€æœ‰éé™æ€å±æ€§å’Œétransientçš„å±æ€§ï¼ŒåŒæ ·è¯¥æ³¨è§£ä¹Ÿå¯ä»¥é€šè¿‡ exclude å±æ€§æ’é™¤æŸäº›å­—æ®µï¼Œof å±æ€§æŒ‡å®šæŸäº›å­—æ®µï¼Œä¹Ÿå¯ä»¥é€šè¿‡ callSuper å±æ€§åœ¨é‡å†™çš„æ–¹æ³•ä¸­ä½¿ç”¨çˆ¶ç±»çš„å­—æ®µï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´çµæ´»çš„å®šä¹‰beançš„æ¯”å¯¹ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage023.png" alt=""></p><p>æŸ¥çœ‹ç¼–è¯‘åçš„Employee.classæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage025.png" alt=""></p><h3 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h3><p>è¯¥æ³¨è§£éœ€åº”ç”¨åœ¨æ–¹æ³•æˆ–æ„é€ å™¨çš„å‚æ•°ä¸Šæˆ–å±æ€§ä¸Šï¼Œç”¨æ¥åˆ¤æ–­å‚æ•°çš„åˆæ³•æ€§ï¼Œé»˜è®¤æŠ›å‡º NullPointerException å¼‚å¸¸</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage027.png" alt=""> </p><p>æŸ¥çœ‹NonNullExample.classæ–‡ä»¶ï¼Œä¼šä¸ºæˆ‘ä»¬æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage029.png" alt=""></p><p>å½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šå¼‚å¸¸ç±»å‹æŠ›å‡ºå…¶ä»–å¼‚å¸¸ï¼Œlombok.nonNull.exceptionType = [NullPointerException | IllegalArgumentException] , ä¸ºå®ç°æ­¤åŠŸèƒ½æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ–°å»ºlombok.configæ–‡ä»¶ï¼š</p><p> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage031.png" alt=""></p><p>é‡æ–°ç¼–è¯‘NonNullExampleç±»ï¼Œå·²ç»ä¸ºæˆ‘ä»¬æŠ›å‡ºéæ³•å‚æ•°å¼‚å¸¸ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage033.png" alt=""></p><h3 id="NoArgsConstructor-RequiredArgsConstructor-AllArgsConstructor"><a href="#NoArgsConstructor-RequiredArgsConstructor-AllArgsConstructor" class="headerlink" title="@NoArgsConstructor, @RequiredArgsConstructor, @AllArgsConstructor"></a>@NoArgsConstructor, @RequiredArgsConstructor, @AllArgsConstructor</h3><p>ä»¥ä¸Šä¸‰ä¸ªæ³¨è§£åˆ†åˆ«ä¸ºæˆ‘ä»¬ç”Ÿæˆæ— å‚æ„é€ å™¨ï¼ŒæŒ‡å®šå‚æ•°æ„é€ å™¨å’ŒåŒ…å«æ‰€æœ‰å‚æ•°çš„æ„é€ å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>@RequiredArgsConstructor</code>, <code>@AllArgsConstructor</code> ç”Ÿæˆçš„æ„é€ å™¨ä¼šå¯¹æ‰€æœ‰æ ‡è®° <code>@NonNull</code> çš„å±æ€§åšéç©ºæ ¡éªŒã€‚</p><p>æ— å‚æ„é€ å™¨å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹çœ‹åä¸¤ç§ï¼Œå…ˆçœ‹ <code>@RequiredArgsConstructor</code><br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-25_13-03-17.jpg" alt=""></p><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ <code>@RequiredArgsConstructor</code> æ³¨è§£ç”Ÿæˆæœ‰å‚æ•°æ„é€ å™¨æ—¶åªä¼šåŒ…å«æœ‰ final å’Œ <code>@NonNull</code> æ ‡è¯†çš„ fieldï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥æŒ‡å®š staticName é€šè¿‡ç”Ÿæˆé™æ€æ–¹æ³•æ¥æ„é€ å¯¹è±¡</p><p>æŸ¥çœ‹Employee.classæ–‡ä»¶<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-25_13-06-48.jpg" alt=""></p><p>å½“æˆ‘ä»¬æŠŠ staticName å±æ€§å»æ‰æˆ‘ä»¬æ¥çœ‹éä»¥åçš„æ–‡ä»¶:<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-25_13-08-48.jpg" alt=""></p><p>ç›¸ä¿¡ä½ å·²ç»æ³¨æ„åˆ°ç»†èŠ‚</p><p><code>@AllArgsConstructor</code>  å°±æ›´ç®€å•äº†ï¼Œè¯·å¤§å®¶è‡ªè¡ŒæŸ¥çœ‹å§</p><h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h3><p>ä»‹ç»äº†ä»¥ä¸Šçš„æ³¨è§£ï¼Œå†æ¥ä»‹ç» <code>@Data</code> å°±éå¸¸å®¹æ˜“æ‡‚äº†ï¼Œ<code>@Data</code> æ³¨è§£åº”ç”¨åœ¨ç±»ä¸Šï¼Œæ˜¯<code>@ToString</code>, <code>@EqualsAndHashCode</code>, <code>@Getter / @Setter</code> å’Œ <code>@RequiredArgsConstructor</code>åˆåŠ›çš„ä½“ç°ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage039.png" alt=""></p><h3 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h3><p>å‡½æ•°å¼ç¼–ç¨‹æˆ–è€…è¯´æµå¼çš„æ“ä½œè¶Šæ¥è¶Šæµè¡Œï¼Œåº”ç”¨åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œè®©ç¨‹åºæ›´å…·æ›´ç®€ä»‹ï¼Œå¯è¯»æ€§æ›´é«˜ï¼Œç¼–å†™æ›´è¿è´¯ï¼Œ<code>@Builder</code>å°±å¸¦æ¥äº†è¿™ä¸ªåŠŸèƒ½ï¼Œç”Ÿæˆä¸€ç³»åˆ—çš„builder APIï¼Œè¯¥æ³¨è§£ä¹Ÿéœ€è¦åº”ç”¨åœ¨ç±»ä¸Šï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­å°±ä¼šæ›´åŠ æ¸…æ™°æ˜äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage041.png" alt=""></p><p>ç¼–è¯‘åçš„Employee.classæ–‡ä»¶å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage043.png" alt=""></p><p>å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘ set å€¼é‚£ä¹ˆéº»çƒ¦äº†ï¼Œæµå¼æ“ä½œæå®šï¼š<br> <img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage045.png" alt=""> </p><h3 id="Log"><a href="#Log" class="headerlink" title="@Log"></a>@Log</h3><p>è¯¥æ³¨è§£éœ€è¦åº”ç”¨åˆ°ç±»ä¸Šï¼Œåœ¨ç¼–å†™æœåŠ¡å±‚ï¼Œéœ€è¦æ·»åŠ ä¸€äº›æ—¥å¿—ï¼Œä»¥ä¾¿å®šä½é—®é¢˜ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ªé™æ€å¸¸é‡Loggerï¼Œç„¶ååº”ç”¨åˆ°æˆ‘ä»¬æƒ³æ—¥å¿—çš„åœ°æ–¹ï¼Œç°åœ¨ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥å®ç°ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage047.png" alt=""></p><p>æŸ¥çœ‹classæ–‡ä»¶ï¼Œå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage049.png" alt=""></p><p>Logæœ‰å¾ˆå¤šå˜ç§ï¼ŒCommonLogï¼ŒLog4jï¼ŒLog4j2ï¼ŒSlf4jç­‰ï¼Œlombokä¾æ—§è‰¯å¥½çš„é€šè¿‡å˜ç§æ³¨è§£åšè‰¯å¥½çš„æ”¯æŒï¼š<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage051.png" alt=""> </p><p>æˆ‘å®é™…ä½¿ç”¨çš„æ˜¯ <code>@Slf4j</code> æ³¨è§£</p><h3 id="val"><a href="#val" class="headerlink" title="val"></a>val</h3><p>ç†Ÿæ‚‰ Javascript çš„åŒå­¦éƒ½çŸ¥é“ï¼Œvar å¯ä»¥å®šä¹‰ä»»ä½•ç±»å‹çš„å˜é‡ï¼Œè€Œåœ¨ java çš„å®ç°ä¸­æˆ‘ä»¬éœ€è¦æŒ‡å®šå…·ä½“å˜é‡çš„ç±»å‹ï¼Œè€Œ val è®©æˆ‘ä»¬æ‘†è„±æŒ‡å®šï¼Œç¼–è¯‘ä¹‹åå°±ç²¾å‡†åŒ¹é…ä¸Šç±»å‹ï¼Œé»˜è®¤æ˜¯ final ç±»å‹ï¼Œå°±åƒ java8 çš„å‡½æ•°å¼è¡¨è¾¾å¼ï¼Œ()-&gt;System.out.println(â€œhello lombokâ€);  å°±å¯ä»¥è§£æåˆ°Runnableå‡½æ•°å¼æ¥å£ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage053.png" alt=""><br>æŸ¥çœ‹è§£æåçš„classæ–‡ä»¶ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage055.png" alt=""></p><h3 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h3><p>å½“æˆ‘ä»¬å¯¹æµè¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è°ƒç”¨ close æ–¹æ³•æ¥å…³é—­æˆ–ç»“æŸæŸèµ„æºï¼Œè€Œ @Cleanup æ³¨è§£å¯ä»¥å¸®åŠ©æˆ‘ä»¬è°ƒç”¨ close æ–¹æ³•ï¼Œå¹¶ä¸”æ”¾åˆ° try/finally å¤„ç†å—ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage057.png" alt=""></p><p>ç¼–è¯‘åçš„classæ–‡ä»¶å¦‚ä¸‹ï¼Œæˆ‘ä»¬å‘ç°è¢«try/finallyåŒ…å›´å¤„ç†ï¼Œå¹¶è°ƒç”¨äº†æµçš„closeæ–¹æ³•<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage059.png" alt=""></p><p>å…¶å®åœ¨ JDK1.7 ä¹‹åå°±æœ‰äº† <code>try-with-resource</code>ï¼Œä¸ç”¨æˆ‘ä»¬æ˜¾å¼çš„å…³é—­æµï¼Œè¿™ä¸ªè¯·å¤§å®¶è‡ªè¡Œçœ‹å§</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Lombokçš„åŸºæœ¬æ“ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å®šä¹‰ç¼–è¯‘æœŸçš„æ³¨è§£</li><li>åˆ©ç”¨JSR269 api(Pluggable Annotation Processing API )åˆ›å»ºç¼–è¯‘æœŸçš„æ³¨è§£å¤„ç†å™¨</li><li>åˆ©ç”¨tools.jarçš„javac apiå¤„ç†AST(æŠ½è±¡è¯­æ³•æ ‘)</li><li>å°†åŠŸèƒ½æ³¨å†Œè¿›jaråŒ…</li></ol><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgimage061.jpg" alt=""></p><blockquote><p>Lombok å½“ç„¶è¿˜æœ‰å¾ˆå¤šæ³¨è§£ï¼Œæˆ‘æ¨èä½¿ç”¨ä»¥ä¸Šå°±è¶³å¤Ÿäº†ï¼Œè¿™ä¸ªå·¥å…·æ˜¯å¸¦æ¥ä¾¿åˆ©çš„ï¼Œè€Œä¸èƒ½è¢«å…¶æ†ç»‘ï¼Œâ€œå¼±æ°´ä¸‰åƒåªå–ä¸€ç“¢é¥®ï¼Œä»£ç åƒä¸‡éœ€æŠ“é‡ç‚¹çœ‹â€ï¼ŒLombok èƒ½è®©æˆ‘æ›´åŠ ä¸“æ³¨æœ‰æ•ˆä»£ç æ’é™¤æ„ä¹‰å¾®å°çš„éšœçœ¼ä»£ç ï¼ˆgetï¼Œsetç­‰ï¼‰ï¼Œå¦å¤–Lombokç”Ÿæˆçš„ä»£ç è¿˜èƒ½åƒä½¿ç”¨å·¥å…·ç±»ä¸€æ ·æ–¹ä¾¿ï¼ˆ@Builderï¼‰ã€‚</p></blockquote><p>æ›´å¤šå†…å®¹è¯·æŸ¥çœ‹å®˜ç½‘ï¼š<a href="https://www.projectlombok.org/" target="_blank" rel="noopener">https://www.projectlombok.org/</a></p><hr><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªæ•´ä½“ <code>@EqualsAndHashCode</code> æ³¨è§£ï¼Ÿè€Œä¸æ˜¯ <code>@Equals</code> å’Œ <code>@HashCode</code>ï¼Ÿè¿™æ¶‰åŠåˆ°ä¸€ä¸ªè§„èŒƒå“¦</li><li>å¦‚æœæŠŠä¸‰ç§æ„é€ å™¨æ–¹å¼åŒæ—¶åº”ç”¨åˆåŠ ä¸Šäº† <code>@Builder</code> æ³¨è§£ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li><li><strong>ä½ çš„ç¯è¿˜äº®ç€å—ï¼Ÿ</strong></li></ol><hr>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Lombok </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SDKMAN ç»Ÿä¸€çµæ´»ç®¡ç†å¤šç‰ˆæœ¬Java</title>
      <link href="//p/multiple-java-management.html"/>
      <url>//p/multiple-java-management.html</url>
      
        <content type="html"><![CDATA[<p>è¿‘ä¸¤å¹´ï¼ŒJava ç‰ˆæœ¬å‡çº§é¢‘ç¹ï¼Œæ„Ÿè§‰åˆšåˆšæŒæ¡ Java8ï¼Œå†™æœ¬æ–‡æ—¶ï¼Œå·²å¬åˆ° java14 çš„æ¶ˆæ¯ï¼Œæ— è®ºæ˜¯å°é²œæ–°ç‰¹æ€§(<a href="https://dayarch.top/p/jdk12-collectors-teeing-api-usage.html">Java12 ä¸­è¶…çº§é¦™çš„ä¸€ä¸ªåŠŸèƒ½</a>)ï¼Œè¿˜æ˜¯ç”±äºé¡¹ç›®å‡çº§/å…¼å®¹éœ€è¦ï¼Œæˆ‘ä»¬å¯èƒ½éƒ½è¦é¢ä¸´ç®¡ç†å¤šä¸ª Java ç‰ˆæœ¬çš„æƒ…</p><blockquote><p>å¦å¤– Oracle è‡ª Java11 å¼€å§‹ï¼Œæ›´æ”¹äº†ç”¨æˆ·åè®®ï¼Œä»»ä½•å•†ç”¨éƒ½ä¼šæ”¶è´¹ã€‚åœ¨å†™æœ¬æ–‡æ—¶ï¼Œå¾—åˆ°æ¶ˆæ¯ã€Œå¾®è½¯å®£å¸ƒåŠ å…¥ OpenJDKã€ï¼Œæ‰“ä¸è¿‡å°±é€‰æ‹© OpenJDKã€‚éšä¾¿ G ä¸€ä¸‹ï¼Œå½“ä¸ªæ•…äº‹äº†è§£å°±å¯ä»¥</p></blockquote><p>é…ç½®å•ä¸ª Java ç¯å¢ƒå˜é‡æœ¬èº«æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡å¯è¨€ï¼Œä½†å½“éœ€è¦ç®¡ç†å¤šä¸ª Java ç‰ˆæœ¬ï¼Œé‡å¤é…ç½®ç¯å¢ƒå˜é‡æ˜¾ç„¶æ˜¯éå¸¸æ¯ç‡¥çš„ï¼ŒæŒ‰ç…§ä¼ ç»Ÿçš„é…ç½®æ–¹å¼æˆ‘ä»¬åˆä¸èƒ½çµæ´»çš„åˆ‡æ¢ Java ç‰ˆæœ¬</p><p>é‚£è¦å¦‚ä½•è½»æ¾ç®¡ç†ä¸ä½¿ç”¨å¤šä¸ªç‰ˆæœ¬ Javaï¼Ÿ</p><h2 id="å¤šç‰ˆæœ¬-Java-ç®¡ç†"><a href="#å¤šç‰ˆæœ¬-Java-ç®¡ç†" class="headerlink" title="å¤šç‰ˆæœ¬ Java ç®¡ç†"></a>å¤šç‰ˆæœ¬ Java ç®¡ç†</h2><p>æ˜¾ç„¶æˆ‘ä»¬ä¸æ˜¯ç¬¬ä¸€ä¸ªæœ‰è¿™ç§å›°å¢ƒçš„äººï¼Œæˆ‘æ‰€çŸ¥é“çš„ç°æœ‰æ–¹æ¡ˆæœ‰ä¸‰ç§:</p><ol><li><a href="https://github.com/shyiko/jabba" target="_blank" rel="noopener">Jabba</a></li><li><a href="https://github.com/jenv/jenv" target="_blank" rel="noopener">jenv</a></li><li><a href="https://sdkman.io/" target="_blank" rel="noopener">sdkman</a></li></ol><p>æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•é€šè¿‡ sdkman æ‰“ç ´æˆ‘ä»¬é¢ä¸´çš„å›°å¢ƒï¼Œå¸®åŠ©æˆ‘ä»¬çµæ´»é…ç½®ä¸ä½¿ç”¨ Java</p><h2 id="sdkman-ä»‹ç»"><a href="#sdkman-ä»‹ç»" class="headerlink" title="sdkman ä»‹ç»"></a>sdkman ä»‹ç»</h2><p>SDKMAN æ˜¯ä¸€ä¸ªç”¨äºåœ¨å¤§å¤šæ•°åŸºäº Unix ç³»ç»Ÿä¸Šç®¡ç† <strong>å¤šä¸ªè½¯ä»¶å¼€å‘å·¥å…·åŒ…</strong> (Java, Groovy, Scala, Kotlin and Ceylon. Ant, Gradle ç­‰) çš„å¹¶è¡Œç‰ˆæœ¬çš„å·¥å…· ã€‚</p><p>å®ƒæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å‘½ä»¤è¡Œæ¥å£ (CLI) å’Œ APIï¼Œç”¨äº<code>å®‰è£…</code>ã€<code>åˆ‡æ¢</code>ã€<code>åˆ é™¤</code>å’Œ<code>åˆ—å‡ºå€™é€‰å¯¹è±¡</code>ã€‚æœ¬æ–‡ä¸»è¦é€šè¿‡ç®¡ç† Java æ¥è¯´æ˜ sdkman çš„ä½¿ç”¨</p><h2 id="sdkman-å®‰è£…"><a href="#sdkman-å®‰è£…" class="headerlink" title="sdkman å®‰è£…"></a>sdkman å®‰è£…</h2><p>åœ¨ç±» unix å¹³å°ä¸Šå®‰è£… sdkman éå¸¸å®¹æ˜“ã€‚å®ƒå¯ä»¥é¡ºåˆ©çš„å®‰è£…åœ¨Mac OSXã€Linuxã€WLSã€Cygwinã€Solariså’ŒFreeBSD ä¸Šï¼ŒåŒæ—¶è¿˜æ”¯æŒBashå’Œ ZSH shellã€‚</p><p>åªéœ€æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯æœºå¹¶è¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -s <span class="string">"https://get.sdkman.io"</span> | bash</span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ç›¸åº”çš„æŒ‡ä»¤æç¤ºï¼Œå®Œæˆç›¸åº”çš„æ“ä½œåç»§ç»­è¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> <span class="string">"<span class="variable">$HOME</span>/.sdkman/bin/sdkman-init.sh"</span></span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥éªŒè¯ sdk çš„å®‰è£…ç‰ˆæœ¬äº†:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk version</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_14-45-11.jpg" alt="sdk version"></p><p>ä¸Šå›¾çº¢è‰²æ¡†æ ‡è®°æ˜¾ç¤ºæˆ‘å½“å‰ sdkman çš„ç‰ˆæœ¬ï¼Œæ¯æ¬¡æ‰§è¡Œ <code>sdk version</code> å‘½ä»¤æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥æ˜¯å¦ä¼šæœ‰æ–°ç‰ˆæœ¬ï¼Œå¦‚æœè¦æ›´æ–°è¾“å…¥ <code>y</code> å°±å¯ä»¥</p><p>æœ‰äº›ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬ä¸åŒ…å« <code>zip</code> å’Œ <code>unzip</code>ï¼Œå¦‚æœå®‰è£…æ—¶é‡åˆ°ç›¸å…³é”™è¯¯ï¼Œå¯ä»¥è¾“å…¥å¦‚ä¸‹å‘½ä»¤å®‰è£… <code>zip</code> å’Œ <code>unzip</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install zip unzip</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¸Šå¯ä»¥çœ‹å‡ºï¼Œsdkman é»˜è®¤çš„å®‰è£…è·¯å¾„æ˜¯åœ¨<code>$HOME/.sdkman</code> ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®‰è£…è·¯å¾„ï¼Œåªéœ€è¦æŒ‡å®š <code>SDKMAN_DIR</code> å˜é‡å€¼å°±å¥½äº†:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> SDKMAN_DIR=<span class="string">"/usr/local/sdkman"</span> &amp;&amp; curl -s <span class="string">"https://get.sdkman.io"</span> | bash</span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œ sdkman çš„å®‰è£…å°±ç»“æŸäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨</p><h2 id="sdkman-ä½¿ç”¨æ•™ç¨‹"><a href="#sdkman-ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="sdkman ä½¿ç”¨æ•™ç¨‹"></a>sdkman ä½¿ç”¨æ•™ç¨‹</h2><p>å‘½ä»¤è¡Œä¸‹å­¦ä¹ ä¸€ä¸ªæ–°ç©æ„å½“ç„¶æ˜¯æŸ¥çœ‹å®ƒçš„ help å‘½ä»¤ï¼Œè¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdkman <span class="built_in">help</span></span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_15-35-22.jpg" alt="sdk help"></p><p>æ„Ÿè§‰ä¸Šå›¾æŒ‰é¢œè‰²åŒºåˆ†å†…å®¹åï¼Œsdkman çš„ä½¿ç”¨è¯´æ˜ä¹Ÿå°±ç»“æŸäº†ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„å›¾æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹ä½¿ç”¨æ•™ç¨‹</p><h3 id="sdk-list"><a href="#sdk-list" class="headerlink" title="sdk list"></a>sdk list</h3><p>å…ˆæ¥è¾“å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sdk list</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_16-07-35.jpg" alt="sdk list"></p><p>ç»¿è‰²çš„æ ‡è®°å°±æ˜¯ sdkman é›†æˆçš„æ‰€æœ‰å¯ç”¨çš„ candidateï¼Œé€šè¿‡æŒ‰å›è½¦ã€Œenterã€æŒ‰é”®ï¼Œä¼šçœ‹åˆ°æ›´å¤šå¯ç”¨ candidate</p><p>æˆ‘ä»¬æŒ‡å®š candidateï¼Œè¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk list java</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_16-14-36.jpg" alt="sdk list java"></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰ java å¯ç”¨çš„ç‰ˆæœ¬ versionï¼Œä»¥åŠæ ‡è¯† indentifierï¼Œä»¥åŠçŠ¶æ€ statusï¼Œæˆ‘å·²ç»å®‰è£…äº† java 12 å’Œ 11</p><p>æœ‰äº†è¿™äº›ä¿¡æ¯åšé“ºå«ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…ä»»æ„ sdkman å†…ç½®çš„è½¯ä»¶å¼€å‘åŒ…äº†ï¼Œç»§ç»­ä»¥ java ä¸ºä¾‹</p><h3 id="sdk-install"><a href="#sdk-install" class="headerlink" title="sdk install"></a>sdk install</h3><p>å›çœ‹ sdkman help å‘½ä»¤çš„è¾“å‡ºï¼Œä½¿ç”¨ install å‘½ä»¤ï¼Œæˆ‘ä»¬å†å®‰è£…ä¸€ä¸ª Java æœ€æ–° <code>13.0.1.j9</code> ç‰ˆæœ¬</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_16-28-17.jpg" alt=""></p><p>ä»ä¸Šå›¾ä½ å¯ä»¥çœ‹å‡ºï¼Œç»¿è‰²æ ‡è®°çš„å†…å®¹æ˜¯ list å‘½ä»¤ç»“æœä¸­çš„ version å€¼ï¼Œä½†æ˜¯æŠ¥é”™ä¸å¯ç”¨ï¼Œè¾“å…¥<code>indentifier</code> ç¼–å·æ‰èƒ½æ­£å¸¸ä¸‹è½½ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„</p><p>å®‰è£…å®Œåï¼Œstatus å°±ä¼šç¼–ç¨‹ installed çŠ¶æ€</p><h3 id="sdk-current"><a href="#sdk-current" class="headerlink" title="sdk current"></a>sdk current</h3><p>å½“å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„ java æ—¶ï¼Œæˆ‘ä»¬è¾“å…¥ä¸‹é¢å‘½ä»¤è·å–å½“å‰æ­£åœ¨ç”¨ candidate çš„ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk current java</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_17-53-25.jpg" alt="sdk current java"></p><h3 id="sdk-use"><a href="#sdk-use" class="headerlink" title="sdk use"></a>sdk use</h3><p>äº†è§£äº†å½“å‰ä½¿ç”¨ç‰ˆæœ¬ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬, å¯ä»¥è¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk use java 12.0.2.j9-adpt</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„âš ï¸: è¿™é‡ŒåŒæ ·æ˜¯æŒ‡å®šçš„ indentifier çš„å€¼<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_17-56-22.jpg" alt=""></p><h3 id="sdk-default"><a href="#sdk-default" class="headerlink" title="sdk default"></a>sdk default</h3><p>å¦‚æœæˆ‘ä»¬æƒ³æŒ‡å®šæŸä¸ªç‰ˆæœ¬ä¸ºé»˜è®¤ç‰ˆæœ¬ï¼Œå¯ä»¥è¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk default java jdk1.8.0_162.jdk</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„âš ï¸: è¿™é‡ŒåŒæ ·æ˜¯æŒ‡å®šçš„ indentifier çš„å€¼</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_18-00-41.jpg" alt=""></p><h3 id="sdk-uninstall"><a href="#sdk-uninstall" class="headerlink" title="sdk uninstall"></a>sdk uninstall</h3><p>å½“æˆ‘ä»¬æƒ³å¸è½½æŸä¸ªç‰ˆæœ¬å¯ä»¥è¾“å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sdk uninstall java 12.0.2.j9-adpt</span><br></pre></td></tr></table></figure><p>æ³¨æ„âš ï¸: è¿™é‡ŒåŒæ ·æ˜¯æŒ‡å®šçš„ indentifier çš„å€¼</p><h3 id="sdk-upgrade"><a href="#sdk-upgrade" class="headerlink" title="sdk upgrade"></a>sdk upgrade</h3><p>å¦‚æœæˆ‘ä»¬æƒ³å‡çº§æŸä¸ª candidateï¼Œå¯ä»¥è¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk upgrade java</span></span><br></pre></td></tr></table></figure><h3 id="sdk-flush"><a href="#sdk-flush" class="headerlink" title="sdk flush"></a>sdk flush</h3><p>ä½¿ç”¨ sdkman æ—¶é—´å˜é•¿ä¹Ÿä¼šæ…¢æ…¢äº§ç”Ÿå¾ˆå¤šç¼“å­˜å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥<br>æ¸…ç†å¹¿æ’­æ¶ˆæ¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk flush broadcast</span></span><br></pre></td></tr></table></figure><p>æ¸…ç†ä¸‹è½½çš„ sdk äºŒè¿›åˆ¶æ–‡ä»¶(é•¿æ—¶é—´ä½¿ç”¨åæ¸…ç†ï¼Œå¯ä»¥èŠ‚çœå‡ºå¾ˆå¤šç©ºé—´):</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk flush archives</span></span><br></pre></td></tr></table></figure><p>æ¸…ç†ä¸´æ—¶æ–‡ä»¶å†…å®¹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sdk flush temp</span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œ sdkman çš„åŸºæœ¬ä½¿ç”¨å°±å·²ç»ä»‹ç»å®Œäº†ï¼Œå…¶å®è¿™äº›å‘½ä»¤éƒ½ä¸ç”¨æ€¥ï¼Œæƒ³ä¸èµ·æ¥çš„æ—¶å€™æ‰§è¡Œ <code>sdk help</code> æ¥ä¸´æ—¶æŸ¥çœ‹ä¸€ä¸‹å°±å¥½</p><h2 id="sdkman-å¸è½½"><a href="#sdkman-å¸è½½" class="headerlink" title="sdkman å¸è½½"></a>sdkman å¸è½½</h2><p>å¦‚æœæˆ‘ä»¬ä¸å–œæ¬¢ sdkman äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è½»æ¾çš„å¸è½½æ‰å®ƒ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar zcvf ~/sdkman-backup_$(date +%F-%kh%M).tar.gz -C ~/ .sdkman</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rm -rf ~/.sdkman</span></span><br></pre></td></tr></table></figure><p>æœ€åæ‰“å¼€ä½ çš„ .bashrcã€.bash_profile å’Œ/æˆ–è€… .profileï¼Œæ‰¾åˆ°å¹¶åˆ é™¤ä¸‹é¢è¿™å‡ è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!</span></span><br><span class="line">[[ -s "/home/dudette/.sdkman/bin/sdkman-init.sh" ]] &amp;&amp; source "/home/dudette/.sdkman/bin/sdkman-init.sh"</span><br></pre></td></tr></table></figure><p>æˆ‘ç”¨çš„ zshrcï¼Œæ‰¾åˆ° .zshrc æ–‡ä»¶åˆ é™¤æ‰ä¸Šé¢å†…å®¹å³å¯</p><p>åˆ°è¿™é‡ŒåŸºäº Unix ç³»ç»Ÿçš„ï¼Œæœ‰å…³ sdkman çš„å®‰è£…ï¼Œä½¿ç”¨åŠä¸‹è½½éƒ½å·²ç»ä»‹ç»å®Œäº†ï¼Œå¯ä»¥ä¸Šæ‰‹è¯•ä¸€è¯•äº†ï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´ç”¨çš„æ˜¯ Windowsï¼Œé™¤äº† jenvï¼Œ sdkman å’Œ Jabba éƒ½æœ‰ windows ç”¨æˆ·çš„è§£å†³æ–¹æ¡ˆ:</p><h2 id="sdkman-windows-è§£å†³æ–¹æ¡ˆ"><a href="#sdkman-windows-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="sdkman windows è§£å†³æ–¹æ¡ˆ"></a>sdkman windows è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨ sdkman å®˜ç½‘é¦–é¡µåŒæ ·ä¸º windows ç”¨æˆ·æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå°ä¼™ä¼´ä»¬æ‰¾åˆ°å¦‚ä¸‹ä½ç½®æŸ¥çœ‹å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgXnip2019-11-13_18-19-21.jpg" alt=""></p><p>æˆ‘çœ‹äº†ä¸€ä¸‹è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œç”±äºæ‰‹å¤´æ²¡æœ‰ windows ç”µè„‘ï¼Œè¿™ä¸ªè¯·å°ä¼™ä¼´ä»¬è‡ªè¡Œå°è¯•å§ï¼Œæœ‰é—®é¢˜æ¬¢è¿ç•™è¨€ </p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä½ ç°åœ¨ç”¨çš„ Java ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</li><li>æœ‰è·Ÿéšæ–°ç‰ˆæœ¬å°è¯•æ›´å¤šæ–°ç‰¹æ€§å—ï¼Ÿ</li><li><strong>ä½ çš„ç¯è¿˜äº®ç€å—ï¼Ÿ</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JDK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HttpMessageConverterè½¬æ¢åŸç†è§£æ</title>
      <link href="//p/spring-boot-messageconverter.html"/>
      <url>//p/spring-boot-messageconverter.html</url>
      
        <content type="html"><![CDATA[<p>Java Web äººå‘˜ç»å¸¸è¦è®¾è®¡ RESTful APIï¼ˆ<a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjIxMjA1Ng==&mid=2247483661&idx=1&sn=048af6543c7baf6cefa691f80587b4c3&chksm=cf34fb3af843722c839977948df95b881b9bc3a4124b36a091af8435451643470d7db0af51de&token=1506224503&lang=zh_CN#rd" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a>ï¼‰ï¼Œé€šè¿‡ json æ•°æ®è¿›è¡Œäº¤äº’ã€‚é‚£ä¹ˆå‰ç«¯ä¼ å…¥çš„ json æ•°æ®å¦‚ä½•è¢«è§£ææˆ Java å¯¹è±¡ä½œä¸º APIå…¥å‚ï¼ŒAPI è¿”å›ç»“æœåˆå¦‚ä½•å°† Java å¯¹è±¡è§£ææˆ json æ ¼å¼æ•°æ®è¿”å›ç»™å‰ç«¯ï¼Œå…¶å®åœ¨æ•´ä¸ªæ•°æ®æµè½¬è¿‡ç¨‹ä¸­ï¼Œ<code>HttpMessageConverter</code> èµ·åˆ°äº†é‡è¦ä½œç”¨ï¼›å¦å¤–åœ¨è½¬æ¢çš„è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥åŠ å…¥å“ªäº›å®šåˆ¶åŒ–å†…å®¹ï¼Ÿ</p><h2 id="HttpMessageConverter-ä»‹ç»"><a href="#HttpMessageConverter-ä»‹ç»" class="headerlink" title="HttpMessageConverter ä»‹ç»"></a>HttpMessageConverter ä»‹ç»</h2><p><code>org.springframework.http.converter.HttpMessageConverter</code> æ˜¯ä¸€ä¸ªç­–ç•¥æ¥å£ï¼Œæ¥å£è¯´æ˜å¦‚ä¸‹ï¼š</p><blockquote><p> Strategy interface that specifies a converter that can convert from and to HTTP requests and responses. ç®€å•è¯´å°±æ˜¯ HTTP request (è¯·æ±‚)å’Œresponse (å“åº”)çš„è½¬æ¢å™¨ã€‚è¯¥æ¥å£æœ‰åªæœ‰5ä¸ªæ–¹æ³•ï¼Œç®€å•æ¥è¯´å°±æ˜¯è·å–æ”¯æŒçš„ MediaTypeï¼ˆapplication/jsonä¹‹ç±»ï¼‰ï¼Œæ¥æ”¶åˆ°è¯·æ±‚æ—¶åˆ¤æ–­æ˜¯å¦èƒ½è¯»ï¼ˆcanReadï¼‰ï¼Œèƒ½è¯»åˆ™è¯»ï¼ˆreadï¼‰ï¼›è¿”å›ç»“æœæ—¶åˆ¤æ–­æ˜¯å¦èƒ½å†™ï¼ˆcanWriteï¼‰ï¼Œèƒ½å†™åˆ™å†™ï¼ˆwriteï¼‰ã€‚è¿™å‡ ä¸ªæ–¹æ³•å…ˆæœ‰ä¸ªå°è±¡å³å¯ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">canRead</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">canWrite</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span></span>;</span><br><span class="line"><span class="function">List&lt;MediaType&gt; <span class="title">getSupportedMediaTypes</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">T <span class="title">read</span><span class="params">(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(T t, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException</span>;</span><br></pre></td></tr></table></figure><h3 id="ç¼ºçœé…ç½®"><a href="#ç¼ºçœé…ç½®" class="headerlink" title="ç¼ºçœé…ç½®"></a>ç¼ºçœé…ç½®</h3><p>æˆ‘ä»¬å†™ Demo æ²¡æœ‰é…ç½®ä»»ä½• MessageConverterï¼Œä½†æ˜¯æ•°æ®å‰åä¼ é€’ä¾æ—§å¥½ç”¨ï¼Œæ˜¯å› ä¸º SpringMVC å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é…ç½®ä¸€äº›HttpMessageConverterï¼Œåœ¨ <code>WebMvcConfigurationSupport</code> ç±»ä¸­æ·»åŠ äº†ç¼ºçœ MessageConverterï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">addDefaultHttpMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)</span> </span>&#123;</span><br><span class="line">StringHttpMessageConverter stringConverter = <span class="keyword">new</span> StringHttpMessageConverter();</span><br><span class="line">stringConverter.setWriteAcceptCharset(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">messageConverters.add(<span class="keyword">new</span> ByteArrayHttpMessageConverter());</span><br><span class="line">messageConverters.add(stringConverter);</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> ResourceHttpMessageConverter());</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> SourceHttpMessageConverter&lt;Source&gt;());</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> AllEncompassingFormHttpMessageConverter());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (romePresent) &#123;</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> AtomFeedHttpMessageConverter());</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> RssChannelHttpMessageConverter());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (jackson2XmlPresent) &#123;</span><br><span class="line">ObjectMapper objectMapper = Jackson2ObjectMapperBuilder.xml().applicationContext(<span class="keyword">this</span>.applicationContext).build();</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> MappingJackson2XmlHttpMessageConverter(objectMapper));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (jaxb2Present) &#123;</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> Jaxb2RootElementHttpMessageConverter());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (jackson2Present) &#123;</span><br><span class="line">ObjectMapper objectMapper = Jackson2ObjectMapperBuilder.json().applicationContext(<span class="keyword">this</span>.applicationContext).build();</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> MappingJackson2HttpMessageConverter(objectMapper));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (gsonPresent) &#123;</span><br><span class="line">messageConverters.add(<span class="keyword">new</span> GsonHttpMessageConverter());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°å¾ˆç†Ÿæ‚‰çš„ <code>MappingJackson2HttpMessageConverter</code> ï¼Œå¦‚æœæˆ‘ä»¬å¼•å…¥ jackson ç›¸å…³åŒ…ï¼ŒSpring å°±ä¼šä¸ºæˆ‘ä»¬æ·»åŠ è¯¥ MessageConverterï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸åœ¨æ­å»ºæ¡†æ¶çš„æ—¶å€™è¿˜æ˜¯ä¼šæ‰‹åŠ¨æ·»åŠ é…ç½® <code>MappingJackson2HttpMessageConverter</code>ï¼Œä¸ºä»€ä¹ˆï¼Ÿ å…ˆæ€è€ƒä¸€ä¸‹ï¼š</p><blockquote><p>å½“æˆ‘ä»¬é…ç½®äº†è‡ªå·±çš„ MessageConverterï¼Œ SpringMVC å¯åŠ¨è¿‡ç¨‹å°±ä¸ä¼šè°ƒç”¨ <code>addDefaultHttpMessageConverters</code> æ–¹æ³•ï¼Œä¸”çœ‹ä¸‹é¢ä»£ç  <code>if</code> æ¡ä»¶ï¼Œè¿™æ ·åšä¹Ÿæ˜¯ä¸ºäº†å®šåˆ¶åŒ–æˆ‘ä»¬è‡ªå·±çš„ MessageConverter</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.messageConverters == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.messageConverters = <span class="keyword">new</span> ArrayList&lt;HttpMessageConverter&lt;?&gt;&gt;();</span><br><span class="line">configureMessageConverters(<span class="keyword">this</span>.messageConverters);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.messageConverters.isEmpty()) &#123;</span><br><span class="line">addDefaultHttpMessageConverters(<span class="keyword">this</span>.messageConverters);</span><br><span class="line">&#125;</span><br><span class="line">extendMessageConverters(<span class="keyword">this</span>.messageConverters);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.messageConverters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»å…³ç³»å›¾"><a href="#ç±»å…³ç³»å›¾" class="headerlink" title="ç±»å…³ç³»å›¾"></a>ç±»å…³ç³»å›¾</h3><p>åœ¨æ­¤å¤„ä»…åˆ—å‡º <code>MappingJackson2HttpMessageConverter</code> å’Œ <code>StringHttpMessageConverter</code> ä¸¤ä¸ªè½¬æ¢å™¨ï¼Œæˆ‘ä»¬å‘ç°ï¼Œ å‰è€…å®ç°äº† <code>GenericHttpMessageConverter</code> æ¥å£, è€Œåè€…å´æ²¡æœ‰ï¼Œç•™æœ‰è¿™ä¸ª<strong>å…³é”®</strong>å°è±¡ï¼Œè¿™æ˜¯æ•°æ®æµè½¬è¿‡ç¨‹ä¸­å…³é”®é€»è¾‘åˆ¤æ–­<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2019-05-24-15-41-26.png" alt=""></p><h2 id="æ•°æ®æµè½¬è§£æ"><a href="#æ•°æ®æµè½¬è§£æ" class="headerlink" title="æ•°æ®æµè½¬è§£æ"></a>æ•°æ®æµè½¬è§£æ</h2><p>æ•°æ®çš„è¯·æ±‚å’Œå“åº”éƒ½è¦ç»è¿‡ <code>DispatcherServlet</code> ç±»çš„ <code>doDispatch(HttpServletRequest request, HttpServletResponse response)</code> æ–¹æ³•çš„å¤„ç†</p><h3 id="è¯·æ±‚è¿‡ç¨‹è§£æ"><a href="#è¯·æ±‚è¿‡ç¨‹è§£æ" class="headerlink" title="è¯·æ±‚è¿‡ç¨‹è§£æ"></a>è¯·æ±‚è¿‡ç¨‹è§£æ</h3><p>çœ‹ doDispatch æ–¹æ³•ä¸­çš„å…³é”®ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„ Adapter å®é™…ä¸Šæ˜¯ RequestMappingHandlerAdapter</span></span><br><span class="line">HandlerAdapter ha = <span class="keyword">this</span>.getHandlerAdapter(mappedHandler.getHandler()); </span><br><span class="line"><span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®é™…å¤„ç†çš„handler</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br></pre></td></tr></table></figure><p>ä»è¿›å…¥handleä¹‹åæˆ‘å…ˆå°†è°ƒç”¨æ ˆç²˜è´´åœ¨æ­¤å¤„ï¼Œå¸Œæœ›å°ä¼™ä¼´å¯ä»¥æŒ‰ç…§è°ƒç”¨æ ˆè·¯çº¿åŠ¨æ‰‹è·Ÿè¸ªå°è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">readWithMessageConverters:<span class="number">192</span>, AbstractMessageConverterMethodArgumentResolver (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">readWithMessageConverters:<span class="number">150</span>, RequestResponseBodyMethodProcessor (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">resolveArgument:<span class="number">128</span>, RequestResponseBodyMethodProcessor (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">resolveArgument:<span class="number">121</span>, HandlerMethodArgumentResolverComposite (org.springframework.web.method.support)</span><br><span class="line">getMethodArgumentValues:<span class="number">158</span>, InvocableHandlerMethod (org.springframework.web.method.support)</span><br><span class="line">invokeForRequest:<span class="number">128</span>, InvocableHandlerMethod (org.springframework.web.method.support)</span><br><span class="line"> <span class="comment">// ä¸‹é¢çš„è°ƒç”¨æ ˆé‡ç‚¹å…³æ³¨ï¼Œå¤„ç†è¯·æ±‚å’Œè¿”å›å€¼çš„åˆ†å‰å£å°±åœ¨è¿™é‡Œ</span></span><br><span class="line">invokeAndHandle:<span class="number">97</span>, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">invokeHandlerMethod:<span class="number">849</span>, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">handleInternal:<span class="number">760</span>, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">handle:<span class="number">85</span>, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)</span><br><span class="line">doDispatch:<span class="number">967</span>, DispatcherServlet (org.springframework.web.servlet)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡ç‚¹è¯´æ˜è°ƒç”¨æ ˆæœ€é¡¶å±‚ <code>readWithMessageConverters</code> æ–¹æ³•ä¸­å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå† messageConverters</span></span><br><span class="line"><span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="keyword">this</span>.messageConverters) &#123;</span><br><span class="line">    Class&lt;HttpMessageConverter&lt;?&gt;&gt; converterType = (Class&lt;HttpMessageConverter&lt;?&gt;&gt;) converter.getClass();</span><br><span class="line">        <span class="comment">// ä¸Šæ–‡ç±»å…³ç³»å›¾å¤„è¦é‡ç‚¹è®°ä½çš„åœ°æ–¹ï¼Œä¸»è¦åˆ¤æ–­ MappingJackson2HttpMessageConverter æ˜¯å¦æ˜¯ GenericHttpMessageConverter ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (converter <span class="keyword">instanceof</span> GenericHttpMessageConverter) &#123;</span><br><span class="line">        GenericHttpMessageConverter&lt;?&gt; genericConverter = (GenericHttpMessageConverter&lt;?&gt;) converter;</span><br><span class="line">        <span class="keyword">if</span> (genericConverter.canRead(targetType, contextClass, contentType)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Read ["</span> + targetType + <span class="string">"] as \""</span> + contentType + <span class="string">"\" with ["</span> + converter + <span class="string">"]"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (inputMessage.getBody() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                inputMessage = getAdvice().beforeBodyRead(inputMessage, parameter, targetType, converterType);</span><br><span class="line">                body = genericConverter.read(targetType, contextClass, inputMessage);</span><br><span class="line">                body = getAdvice().afterBodyRead(body, inputMessage, parameter, targetType, converterType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                body = getAdvice().handleEmptyBody(<span class="keyword">null</span>, inputMessage, parameter, targetType, converterType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (targetClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (converter.canRead(targetClass, contentType)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Read ["</span> + targetType + <span class="string">"] as \""</span> + contentType + <span class="string">"\" with ["</span> + converter + <span class="string">"]"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (inputMessage.getBody() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                inputMessage = getAdvice().beforeBodyRead(inputMessage, parameter, targetType, converterType);</span><br><span class="line">                body = ((HttpMessageConverter&lt;T&gt;) converter).read(targetClass, inputMessage);</span><br><span class="line">                body = getAdvice().afterBodyRead(body, inputMessage, parameter, targetType, converterType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                body = getAdvice().handleEmptyBody(<span class="keyword">null</span>, inputMessage, parameter, targetType, converterType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±åˆ¤æ–­æ˜¯å¦canReadï¼Œèƒ½è¯»å°±readï¼Œæœ€ç»ˆèµ°åˆ°ä¸‹é¢ä»£ç å¤„å°†è¾“å…¥çš„å†…å®¹ååºåˆ—åŒ–å‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">_readMapAndClose</span><span class="params">(JsonParser p0, JavaType valueType)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (JsonParser p = p0) &#123;</span><br><span class="line">            Object result;</span><br><span class="line">            JsonToken t = _initForReading(p);</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_NULL) &#123;</span><br><span class="line">                <span class="comment">// Ask JsonDeserializer what 'null value' to use:</span></span><br><span class="line">                DeserializationContext ctxt = createDeserializationContext(p,</span><br><span class="line">                        getDeserializationConfig());</span><br><span class="line">                result = _findRootDeserializer(ctxt, valueType).getNullValue(ctxt);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == JsonToken.END_ARRAY || t == JsonToken.END_OBJECT) &#123;</span><br><span class="line">                result = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                DeserializationConfig cfg = getDeserializationConfig();</span><br><span class="line">                DeserializationContext ctxt = createDeserializationContext(p, cfg);</span><br><span class="line">                JsonDeserializer&lt;Object&gt; deser = _findRootDeserializer(ctxt, valueType);</span><br><span class="line">                <span class="keyword">if</span> (cfg.useRootWrapping()) &#123;</span><br><span class="line">                    result = _unwrapAndDeserialize(p, ctxt, cfg, valueType, deser);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    result = deser.deserialize(p, ctxt);</span><br><span class="line">                &#125;</span><br><span class="line">                ctxt.checkUnresolvedObjectId();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Need to consume the token too</span></span><br><span class="line">            p.clearCurrentToken();</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä»è¯·æ±‚ä¸­è§£æå‚æ•°è¿‡ç¨‹å°±åˆ°æ­¤ç»“æŸäº†ï¼Œè¶çƒ­æ‰“é“æ¥çœ‹å°†å“åº”ç»“æœè¿”å›ç»™å‰ç«¯çš„è¿‡ç¨‹</p><h3 id="è¿”å›è¿‡ç¨‹è§£æ"><a href="#è¿”å›è¿‡ç¨‹è§£æ" class="headerlink" title="è¿”å›è¿‡ç¨‹è§£æ"></a>è¿”å›è¿‡ç¨‹è§£æ</h3><p>åœ¨ä¸Šé¢è°ƒç”¨æ ˆè¯·æ±‚å’Œè¿”å›ç»“æœåˆ†å‰å£å¤„åŒæ ·å¤„ç†è¿”å›çš„å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">writeWithMessageConverters:<span class="number">224</span>, AbstractMessageConverterMethodProcessor (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">handleReturnValue:<span class="number">174</span>, RequestResponseBodyMethodProcessor (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">handleReturnValue:<span class="number">81</span>, HandlerMethodReturnValueHandlerComposite (org.springframework.web.method.support)</span><br><span class="line"><span class="comment">// åˆ†å‰å£</span></span><br><span class="line">invokeAndHandle:<span class="number">113</span>, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨è°ƒç”¨æ ˆé¡¶å±‚å†…å®¹ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„æ ·å­ï¼Œå®Œå…¨ä¸€æ ·çš„é€»è¾‘,  åˆ¤æ–­æ˜¯å¦èƒ½å†™canWriteï¼Œèƒ½å†™åˆ™writeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; messageConverter : <span class="keyword">this</span>.messageConverters) &#123;</span><br><span class="line">    <span class="keyword">if</span> (messageConverter <span class="keyword">instanceof</span> GenericHttpMessageConverter) &#123;</span><br><span class="line">        <span class="keyword">if</span> (((GenericHttpMessageConverter) messageConverter).canWrite(</span><br><span class="line">                declaredType, valueType, selectedMediaType)) &#123;</span><br><span class="line">            outputValue = (T) getAdvice().beforeBodyWrite(outputValue, returnType, selectedMediaType,</span><br><span class="line">                    (Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt;) messageConverter.getClass(),</span><br><span class="line">                    inputMessage, outputMessage);</span><br><span class="line">            <span class="keyword">if</span> (outputValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">                addContentDispositionHeader(inputMessage, outputMessage);</span><br><span class="line">                ((GenericHttpMessageConverter) messageConverter).write(</span><br><span class="line">                        outputValue, declaredType, selectedMediaType, outputMessage);</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">"Written ["</span> + outputValue + <span class="string">"] as \""</span> + selectedMediaType +</span><br><span class="line">                            <span class="string">"\" using ["</span> + messageConverter + <span class="string">"]"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (messageConverter.canWrite(valueType, selectedMediaType)) &#123;</span><br><span class="line">        outputValue = (T) getAdvice().beforeBodyWrite(outputValue, returnType, selectedMediaType,</span><br><span class="line">                (Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt;) messageConverter.getClass(),</span><br><span class="line">                inputMessage, outputMessage);</span><br><span class="line">        <span class="keyword">if</span> (outputValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">            addContentDispositionHeader(inputMessage, outputMessage);</span><br><span class="line">            ((HttpMessageConverter) messageConverter).write(outputValue, selectedMediaType, outputMessage);</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Written ["</span> + outputValue + <span class="string">"] as \""</span> + selectedMediaType +</span><br><span class="line">                        <span class="string">"\" using ["</span> + messageConverter + <span class="string">"]"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°æœ‰è¿™æ ·ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">outputValue = (T) getAdvice().beforeBodyWrite(outputValue, returnType, selectedMediaType,</span><br><span class="line">                    (Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt;) messageConverter.getClass(),</span><br><span class="line">                    inputMessage, outputMessage);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è®¾è®¡ RESTful API æ¥å£çš„æ—¶å€™é€šå¸¸ä¼šå°†è¿”å›çš„æ•°æ®å°è£…æˆç»Ÿä¸€æ ¼å¼ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå®ç° ResponseBodyAdvice<T> æ¥å£æ¥å¤„ç†æ‰€æœ‰ API çš„è¿”å›å€¼ï¼Œåœ¨çœŸæ­£ write ä¹‹å‰å°†æ•°æ®è¿›è¡Œç»Ÿä¸€çš„å°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span>()</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonResultResponseAdvice</span> <span class="keyword">implements</span> <span class="title">ResponseBodyAdvice</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">beforeBodyWrite</span><span class="params">(Object body, MethodParameter returnType, MediaType selectedContentType,</span></span></span><br><span class="line"><span class="function"><span class="params">Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">ServerHttpResponse response)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (body <span class="keyword">instanceof</span> CommonResult) &#123;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;Object&gt;(body);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªå¤„ç†æµç¨‹å°±æ˜¯è¿™æ ·ï¼Œæ•´ä¸ªå®ç°è¿‡ç¨‹ç»†èŠ‚è¿˜éœ€å°ä¼™ä¼´è‡ªè¡Œè¿½è¸ªå‘ç°ï¼Œæ–‡ç« å¼€å¤´æˆ‘ä»¬è¯´è¿‡ æ·»åŠ è‡ªå·±çš„ MessageConverter èƒ½æ›´å¥½çš„æ»¡è¶³æˆ‘ä»¬çš„å®šåˆ¶åŒ–ï¼Œéƒ½æœ‰å“ªäº›å¯ä»¥å®šåˆ¶çš„å‘¢ï¼Ÿ</p><h2 id="å®šåˆ¶åŒ–"><a href="#å®šåˆ¶åŒ–" class="headerlink" title="å®šåˆ¶åŒ–"></a>å®šåˆ¶åŒ–</h2><h3 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h3><p>è¯·æ±‚å’Œè¿”å›çš„æ•°æ®æœ‰å¾ˆå¤šç©ºå€¼ï¼Œè¿™äº›å€¼æœ‰æ—¶å€™å¹¶æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤æ‰å’Œä¸è¿”å›ï¼Œæˆ–è®¾ç½®æˆé»˜è®¤å€¼ã€‚æ¯”å¦‚é€šè¿‡é‡å†™ <code>getObjectMapper</code> æ–¹æ³•ï¼Œå°†è¿”å›ç»“æœçš„ç©ºå€¼ä¸è¿›è¡Œåºåˆ—åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">converters.add(<span class="number">0</span>, <span class="keyword">new</span> MappingJackson2HttpMessageConverter()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">getObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.getObjectMapper();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="XSS-è„šæœ¬æ”»å‡»"><a href="#XSS-è„šæœ¬æ”»å‡»" class="headerlink" title="XSS è„šæœ¬æ”»å‡»"></a>XSS è„šæœ¬æ”»å‡»</h3><p>ä¸ºäº†ä¿è¯è¾“å…¥çš„æ•°æ®æ›´å®‰å…¨ï¼Œé˜²æ­¢ XSS è„šæœ¬æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹åº”æ— æ³•ç›´æ¥è¿”å›Stringç±»å‹</span></span><br><span class="line">converters.add(<span class="number">0</span>, <span class="keyword">new</span> MappingJackson2HttpMessageConverter()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">getObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// XSS è„šæœ¬è¿‡æ»¤</span></span><br><span class="line">        SimpleModule simpleModule = <span class="keyword">new</span> SimpleModule();</span><br><span class="line">        simpleModule.addDeserializer(String.class, <span class="keyword">new</span> StringXssDeserializer());</span><br><span class="line">        <span class="keyword">super</span>.getObjectMapper().registerModule(simpleModule);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getObjectMapper();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»†èŠ‚åˆ†æ"><a href="#ç»†èŠ‚åˆ†æ" class="headerlink" title="ç»†èŠ‚åˆ†æ"></a>ç»†èŠ‚åˆ†æ</h2><p>canRead å’Œ canWrite çš„åˆ¤æ–­é€»è¾‘æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ è¯·çœ‹ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2019-05-24-20-34-47.png" alt=""></p><p>å®¢æˆ·ç«¯ Request Header ä¸­è®¾ç½®å¥½ Content-Typeï¼ˆä¼ å…¥çš„æ•°æ®æ ¼å¼ï¼‰å’ŒAcceptï¼ˆæ¥æ”¶çš„æ•°æ®æ ¼å¼ï¼‰ï¼Œæ ¹æ®é…ç½®å¥½çš„MessageConverteræ¥åˆ¤æ–­æ˜¯å¦ canRead æˆ– canWriteï¼Œç„¶åå†³å®š response.body çš„ Content-Type çš„ç¬¬ä¸€è¦ç´ æ˜¯å¯¹åº”çš„request.headers.Accept å±æ€§çš„å€¼ï¼Œåˆå«åš MediaTypeã€‚å¦‚æœæœåŠ¡ç«¯æ”¯æŒè¿™ä¸ª Acceptï¼Œé‚£ä¹ˆåº”è¯¥æŒ‰ç…§è¿™ä¸ª Accept æ¥ç¡®å®šè¿”å›response.body å¯¹åº”çš„æ ¼å¼ï¼ŒåŒæ—¶æŠŠ response.headers.Content-Type è®¾ç½®æˆè‡ªå·±æ”¯æŒçš„ç¬¦åˆé‚£ä¸ª Accept çš„ MediaType</p><h2 id="æ€»ç»“ä¸æ€è€ƒ"><a href="#æ€»ç»“ä¸æ€è€ƒ" class="headerlink" title="æ€»ç»“ä¸æ€è€ƒ"></a>æ€»ç»“ä¸æ€è€ƒ</h2><p>ç«™åœ¨ä¸Šå¸è§†è§’çœ‹ï¼Œæ•´ä¸ªæµç¨‹å¯ä»¥æŒ‰ç…§ä¸‹å›¾è¿›è¡Œæ¦‚æ‹¬ï¼Œè¯·æ±‚æŠ¥æ–‡å…ˆè½¬æ¢æˆ HttpInputMessage, ç„¶åå†é€šè¿‡ HttpMessageConverter å°†å…¶è½¬æ¢æˆ SpringMVC çš„ java å¯¹è±¡ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2019-05-26-10-25-17.png" alt=""></p><p>å°†å„ç§å¸¸ç”¨ HttpMessageConverter æ”¯æŒçš„MediaType å’Œ JavaType ä»¥åŠå¯¹åº”å…³ç³»æ€»ç»“åœ¨æ­¤å¤„ï¼š</p><table><thead><tr><th align="left">ç±»å</th><th align="left">æ”¯æŒçš„JavaType</th><th align="left">æ”¯æŒçš„MediaType</th></tr></thead><tbody><tr><td align="left">ByteArrayHttpMessageConverter</td><td align="left">byte[]</td><td align="left">application/octet-stream, */*</td></tr><tr><td align="left">StringHttpMessageConverter</td><td align="left">String</td><td align="left">text/plain, */*</td></tr><tr><td align="left">MappingJackson2HttpMessageConverter</td><td align="left">Object</td><td align="left">application/json, application/*+json</td></tr><tr><td align="left">AllEncompassingFormHttpMessageConverter</td><td align="left">Map&lt;K, List&lt;?&gt;&gt;</td><td align="left">application/x-www-form-urlencoded, multipart/form-data</td></tr><tr><td align="left">SourceHttpMessageConverter</td><td align="left">Source</td><td align="left">application/xml, text/xml, application/*+xml</td></tr></tbody></table><p>æœ€åæ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆ HttpMessageConverter åœ¨å†™çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆåˆ¤æ–­ canWrite ååˆ¤æ–­æ˜¯å¦æœ‰ responseBodyAdvice çš„æ•°æ®å°è£…å‘¢ï¼Ÿ å¦‚æœå…ˆè¿›è¡Œ responseBodyAdvice çš„æ•°æ®å°è£…ååˆ¤æ–­ canWrite ä¼šæ€æ ·å‘¢ï¼Ÿ </p><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p>ä¾æ—§ä»‹ç»å†™è¯¥æ–‡ç« ç”¨åˆ°çš„ä¸€äº›å¥½çš„å·¥å…·</p><h3 id="processon"><a href="#processon" class="headerlink" title="processon"></a>processon</h3><p>ProcessOnæ˜¯ä¸€ä¸ªåœ¨çº¿ä½œå›¾å·¥å…·çš„èšåˆå¹³å°ï¼Œå®ƒå¯ä»¥åœ¨çº¿ç”»æµç¨‹å›¾ã€æ€ç»´å¯¼å›¾ã€UIåŸå‹å›¾ã€UMLã€ç½‘ç»œæ‹“æ‰‘å›¾ã€ç»„ç»‡ç»“æ„å›¾ç­‰ç­‰ï¼Œ<br>æ‚¨æ— éœ€æ‹…å¿ƒä¸‹è½½å’Œæ›´æ–°çš„é—®é¢˜ï¼Œä¸ç®¡Macè¿˜æ˜¯Windowsï¼Œä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥éšæ—¶éšåœ°çš„å‘æŒ¥åˆ›æ„ï¼Œè§„åˆ’å·¥ä½œï¼ŒåŒæ—¶æ‚¨å¯ä»¥æŠŠä½œå“åˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜æˆ–å¥½å‹ï¼Œæ— è®ºä½•æ—¶ä½•åœ°å¤§å®¶éƒ½å¯ä»¥å¯¹ä½œå“è¿›è¡Œç¼–è¾‘ã€é˜…è¯»å’Œè¯„è®º</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2019-05-26-10-40-06.jpg" alt=""></p><h3 id="SequenceDiagram"><a href="#SequenceDiagram" class="headerlink" title="SequenceDiagram"></a>SequenceDiagram</h3><p><a href="https://plugins.jetbrains.com/plugin/8286-sequencediagram" target="_blank" rel="noopener">SequenceDiagram</a> æ˜¯ IntelliJ IDEA çš„ä¸€ä¸ªæ’ä»¶ï¼Œæœ‰äº†è¿™ä¸ªæ’ä»¶ï¼Œä½ å¯ä»¥</p><ol><li>ç”Ÿæˆç®€å•åºåˆ—å›¾ã€‚</li><li>å•å‡»å›¾å½¢å½¢çŠ¶æ¥å¯¼èˆªä»£ç ã€‚</li><li>ä»å›¾ä¸­åˆ é™¤ç±»ã€‚</li><li>å°†å›¾è¡¨å¯¼å‡ºä¸ºå›¾åƒã€‚</li><li>é€šè¿‡â€œè®¾ç½®â€&gt;â€œå…¶ä»–è®¾ç½®â€&gt;â€œåºåˆ—â€ä»å›¾è¡¨ä¸­æ’é™¤ç±»</li></ol><p>æ–¹ä¾¿å¿«é€Ÿçš„å®šä½æ–¹æ³•å’Œç†è§£ç±»çš„è°ƒç”¨è¿‡ç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-img2019-05-26-10-43-55.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> HTTP </tag>
            
            <tag> MessageConverter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java12 Collectors.teeing çš„ä½¿ç”¨è¯¦è§£</title>
      <link href="//p/jdk12-collectors-teeing-api-usage.html"/>
      <url>//p/jdk12-collectors-teeing-api-usage.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Java 12 é‡Œé¢æœ‰ä¸ªéå¸¸å¥½ç”¨ä½†åœ¨å®˜æ–¹ JEP æ²¡æœ‰å…¬å¸ƒçš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒåªæ˜¯ Collector ä¸­çš„ä¸€ä¸ªå°æ”¹åŠ¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ merge ä¸¤ä¸ª collector çš„ç»“æœï¼Œè¿™å¥è¯æ˜¾å¾—å¾ˆæŠ½è±¡ï¼Œè€è§„çŸ©ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªå›¾:<br><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgtee.jpg" alt=""></p><p>ç®¡é“æ”¹é€ ç»å¸¸ä¼šç”¨è¿™ä¸ªå°ä¸œè¥¿ï¼Œé€šå¸¸æˆ‘ä»¬å«å®ƒã€Œä¸‰é€šã€ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯å°† downstream1 å’Œ downstream2 çš„æµå…¥åˆå¹¶ï¼Œç„¶åä» merger æµå‡º</p><p>æœ‰äº†è¿™ä¸ªå½¢è±¡çš„è¯´æ˜æˆ‘ä»¬å°±è¿›å…¥æ­£é¢˜å§</p><h2 id="Collectors-teeing"><a href="#Collectors-teeing" class="headerlink" title="Collectors.teeing"></a>Collectors.teeing</h2><p>ä¸Šé¢æåˆ°çš„å°åŠŸèƒ½å°±æ˜¯ Collectors.teeing API, å…ˆæ¥çœ‹ä¸€ä¸‹ JDK å…³äºè¯¥ API çš„è¯´æ˜ï¼Œ<strong>çœ‹ç€è§‰å¾—éš¾å—çš„ç›´æ¥å¿½ç•¥ï¼Œç»§ç»­å‘ä¸‹çœ‹ä¾‹å­å°±å¥½äº†:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a &#123;<span class="doctag">@code</span> Collector&#125; that is a composite of two downstream collectors.</span></span><br><span class="line"><span class="comment"> * Every element passed to the resulting collector is processed by both downstream</span></span><br><span class="line"><span class="comment"> * collectors, then their results are merged using the specified merge function</span></span><br><span class="line"><span class="comment"> * into the final result.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The resulting collector functions do the following:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;supplier: creates a result container that contains result containers</span></span><br><span class="line"><span class="comment"> * obtained by calling each collector's supplier</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;accumulator: calls each collector's accumulator with its result container</span></span><br><span class="line"><span class="comment"> * and the input element</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;combiner: calls each collector's combiner with two result containers</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;finisher: calls each collector's finisher with its result container,</span></span><br><span class="line"><span class="comment"> * then calls the supplied merger and returns its result.</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The resulting collector is &#123;<span class="doctag">@link</span> Collector.Characteristics#UNORDERED&#125; if both downstream</span></span><br><span class="line"><span class="comment"> * collectors are unordered and &#123;<span class="doctag">@link</span> Collector.Characteristics#CONCURRENT&#125; if both downstream</span></span><br><span class="line"><span class="comment"> * collectors are concurrent.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;         the type of the input elements</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;R1&gt;        the result type of the first collector</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;R2&gt;        the result type of the second collector</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;R&gt;         the final result type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> downstream1 the first downstream collector</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> downstream2 the second downstream collector</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> merger      the function which merges two results into the single one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Collector&#125; which aggregates the results of two supplied collectors.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R1, R2, R&gt;</span><br><span class="line">Collector&lt;T, ?, R&gt; teeing(Collector&lt;? <span class="keyword">super</span> T, ?, R1&gt; downstream1,</span><br><span class="line">                          Collector&lt;? <span class="keyword">super</span> T, ?, R2&gt; downstream2,</span><br><span class="line">                          BiFunction&lt;? <span class="keyword">super</span> R1, ? <span class="keyword">super</span> R2, R&gt; merger) &#123;</span><br><span class="line">    <span class="keyword">return</span> teeing0(downstream1, downstream2, merger);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>API æè¿°é‡çš„ä¸€å¥è¯éå¸¸å…³é”®:</p><blockquote><p> <em>Every element passed to the resulting collector is processed by both downstream collectors</em><br> ç»“åˆã€Œä¸‰é€šå›¾ã€æ¥è¯´æ˜å°±æ˜¯ï¼Œé›†åˆä¸­æ¯ä¸€ä¸ªè¦è¢«ä¼ å…¥ merger çš„å…ƒç´ éƒ½ä¼šç»è¿‡ downstream1 å’Œ downstream2 çš„åŠ å·¥å¤„ç†</p></blockquote><p><strong>å…¶ä¸­ merger ç±»å‹æ˜¯ BiFunctionï¼Œä¹Ÿå°±æ˜¯è¯´æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªå€¼ï¼Œè¯·çœ‹å®ƒçš„ apply æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BiFunction</span>&lt;<span class="title">T</span>, <span class="title">U</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Applies this function to the given arguments.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the first function argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> u the second function argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the function result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t, U u)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³äºå¯ä»¥å¦‚ä½•å¤„ç†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­å§</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜ teeing çš„ä½¿ç”¨ï¼Œåˆ—ä¸¾äº†å››ä¸ªä¾‹å­ï¼Œçœ‹è¿‡è¿™å››ä¸ªä¾‹å­å†å›çœ‹ä¸Šé¢çš„ API è¯´æ˜ï¼Œç›¸ä¿¡ä½ ä¼šæŸ³æš—èŠ±æ˜äº†</p><h3 id="è®¡æ•°å’Œç´¯åŠ "><a href="#è®¡æ•°å’Œç´¯åŠ " class="headerlink" title="è®¡æ•°å’Œç´¯åŠ "></a>è®¡æ•°å’Œç´¯åŠ </h3><p>å…ˆæ¥çœ‹ä¸€ä¸ªç»å…¸çš„é—®é¢˜ï¼Œç»™å®šçš„æ•°å­—é›†åˆï¼Œéœ€è¦æ˜ å°„æ•´æ•°æµä¸­çš„å…ƒç´ æ•°é‡å’Œå®ƒä»¬çš„å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountSum</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Long count;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Integer sum;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CountSum</span><span class="params">(Long count, Integer sum)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.count = count;</span><br><span class="line"><span class="keyword">this</span>.sum = sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"CountSum&#123;"</span> +</span><br><span class="line"><span class="string">"count="</span> + count +</span><br><span class="line"><span class="string">", sum="</span> + sum +</span><br><span class="line"><span class="string">'&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Collectors.teeing å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CountSum countsum = Stream.of(<span class="number">2</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">12</span>)</span><br><span class="line">        .collect(Collectors.teeing(</span><br><span class="line">                counting(),</span><br><span class="line">                summingInt(e -&gt; e),</span><br><span class="line">                CountSum::<span class="keyword">new</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(countsum.toString());</span><br></pre></td></tr></table></figure><ul><li>downstream1 é€šè¿‡ Collectors çš„é™æ€æ–¹æ³• counting è¿›è¡Œé›†åˆè®¡æ•°</li><li>downstream2 é€šè¿‡ Collectors çš„é™æ€æ–¹æ³• summingInt è¿›è¡Œé›†åˆå…ƒç´ å€¼çš„ç´¯åŠ </li><li>merger é€šè¿‡ CountSum æ„é€ å™¨æ”¶é›†ç»“æœ</li></ul><p>è¿è¡Œç»“æœ:</p><blockquote><p> CountSum{count=7, sum=46}</p></blockquote><p>æˆ‘ä»¬é€šè¿‡ teeing ä¸€æ¬¡æ€§å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œç»§ç»­å‘ä¸‹çœ‹å…¶ä»–ä¾‹å­:</p><h3 id="æœ€å¤§å€¼ä¸æœ€å°å€¼"><a href="#æœ€å¤§å€¼ä¸æœ€å°å€¼" class="headerlink" title="æœ€å¤§å€¼ä¸æœ€å°å€¼"></a>æœ€å¤§å€¼ä¸æœ€å°å€¼</h3><p>é€šè¿‡ç»™å®šçš„é›†åˆï¼Œ ä¸€æ¬¡æ€§è®¡ç®—å‡ºé›†åˆçš„æœ€å¤§å€¼ä¸æœ€å°å€¼ï¼ŒåŒæ ·æ–°å»ºä¸€ä¸ªç±» MinMaxï¼Œå¹¶åˆ›å»ºæ„é€ å™¨ç”¨äº merger æ”¶é›†ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinMax</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Integer min;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Integer max;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MinMax</span><span class="params">(Integer min, Integer max)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.min = min;</span><br><span class="line"><span class="keyword">this</span>.max = max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"MinMax&#123;"</span> +</span><br><span class="line"><span class="string">"min="</span> + min +</span><br><span class="line"><span class="string">", max="</span> + max +</span><br><span class="line"><span class="string">'&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ teeing API è®¡ç®—ç»“æœ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MinMax minmax = Stream.of(<span class="number">2</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">12</span>)</span><br><span class="line">        .collect(Collectors.teeing(</span><br><span class="line">                minBy(Comparator.naturalOrder()),</span><br><span class="line">                maxBy(Comparator.naturalOrder()),</span><br><span class="line">                (Optional&lt;Integer&gt; a, Optional&lt;Integer&gt; b) -&gt; <span class="keyword">new</span> MinMax(a.orElse(Integer.MIN_VALUE), b.orElse(Integer.MAX_VALUE))));</span><br><span class="line"></span><br><span class="line">System.out.println(minmax.toString());</span><br></pre></td></tr></table></figure><ul><li>downstream1 é€šè¿‡ Collectors çš„é™æ€æ–¹æ³• minByï¼Œé€šè¿‡ Comparator æ¯”è¾ƒå™¨æŒ‰ç…§è‡ªç„¶æ’åºæ‰¾åˆ°æœ€å°å€¼</li><li>downstream2 é€šè¿‡ Collectors çš„é™æ€æ–¹æ³• maxByï¼Œé€šè¿‡ Comparator æ¯”è¾ƒå™¨æŒ‰ç…§è‡ªç„¶æ’åºæ‰¾åˆ°æœ€å¤§å€¼</li><li>merger é€šè¿‡ MinMax æ„é€ å™¨æ”¶é›†ç»“æœï¼Œåªä¸è¿‡ä¸ºäº†åº”å¯¹ NPEï¼Œå°† BiFunction çš„ä¸¤ä¸ªå…¥å‚ç»è¿‡ Optional å¤„ç†</li></ul><p>è¿è¡Œç»“æœ:</p><blockquote><p> MinMax{min=1, max=12}</p></blockquote><p>ä¸ºäº†éªŒè¯ä¸€ä¸‹ Optionalï¼Œæˆ‘ä»¬å°†é›†åˆä¸­æ·»åŠ ä¸€ä¸ª null å…ƒç´ ï¼Œå¹¶ä¿®æ”¹ä¸€ä¸‹æ’åºè§„åˆ™æ¥çœ‹ä¸€ä¸‹æ’åºç»“æœ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MinMax minmax = Stream.of(<span class="keyword">null</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">12</span>)</span><br><span class="line">.collect(Collectors.teeing(</span><br><span class="line">minBy(Comparator.nullsFirst(Comparator.naturalOrder())),</span><br><span class="line">maxBy(Comparator.nullsLast(Comparator.naturalOrder())),</span><br><span class="line">(Optional&lt;Integer&gt; a, Optional&lt;Integer&gt; b) -&gt; <span class="keyword">new</span> MinMax(a.orElse(Integer.MIN_VALUE), b.orElse(Integer.MAX_VALUE))));</span><br></pre></td></tr></table></figure><ul><li>downstream1 å¤„ç†è§„åˆ™æ˜¯å°† null æ”¾åœ¨æ’åºçš„æœ€å‰é¢</li><li>downstream2 å¤„ç†è§„åˆ™æ˜¯å°† null æ”¾åœ¨æ’åºçš„æœ€åé¢</li><li>merger å¤„ç†æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œ optional.orElse æ–¹æ³•ï¼Œåˆ†åˆ«è¾“å‡ºæœ€å°å€¼ä¸æœ€å¤§å€¼</li></ul><p>è¿è¡Œç»“æœ:</p><blockquote><p> MinMax{min=-2147483648, max=2147483647}</p></blockquote><h3 id="ç“œçš„æ€»é‡å’Œå•ä¸ªé‡é‡"><a href="#ç“œçš„æ€»é‡å’Œå•ä¸ªé‡é‡" class="headerlink" title="ç“œçš„æ€»é‡å’Œå•ä¸ªé‡é‡"></a>ç“œçš„æ€»é‡å’Œå•ä¸ªé‡é‡</h3><p>æ¥ä¸‹æ¥ä¸¾ä¸€ä¸ªæ›´è´´åˆå®é™…çš„æ“ä½œå¯¹è±¡çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ç“œçš„ç±»å‹å’Œé‡é‡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Melon</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String type;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> weight;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Melon</span><span class="params">(String type, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.type = type;</span><br><span class="line"><span class="keyword">this</span>.weight = weight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> weight;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€»é‡å’Œå•ä¸ªé‡é‡åˆ—è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeightsAndTotal</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> totalWeight;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;Integer&gt; weights;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">WeightsAndTotal</span><span class="params">(<span class="keyword">int</span> totalWeight, List&lt;Integer&gt; weights)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.totalWeight = totalWeight;</span><br><span class="line"><span class="keyword">this</span>.weights = weights;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"WeightsAndTotal&#123;"</span> +</span><br><span class="line"><span class="string">"totalWeight="</span> + totalWeight +</span><br><span class="line"><span class="string">", weights="</span> + weights +</span><br><span class="line"><span class="string">'&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ teeing API è®¡ç®—æ€»é‡é‡å’Œå•ä¸ªåˆ—è¡¨é‡é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Melon&gt; melons = Arrays.asList(<span class="keyword">new</span> Melon(<span class="string">"Crenshaw"</span>, <span class="number">1200</span>),</span><br><span class="line">    <span class="keyword">new</span> Melon(<span class="string">"Gac"</span>, <span class="number">3000</span>), <span class="keyword">new</span> Melon(<span class="string">"Hemi"</span>, <span class="number">2600</span>),</span><br><span class="line">    <span class="keyword">new</span> Melon(<span class="string">"Hemi"</span>, <span class="number">1600</span>), <span class="keyword">new</span> Melon(<span class="string">"Gac"</span>, <span class="number">1200</span>),</span><br><span class="line">    <span class="keyword">new</span> Melon(<span class="string">"Apollo"</span>, <span class="number">2600</span>), <span class="keyword">new</span> Melon(<span class="string">"Horned"</span>, <span class="number">1700</span>),</span><br><span class="line">    <span class="keyword">new</span> Melon(<span class="string">"Gac"</span>, <span class="number">3000</span>), <span class="keyword">new</span> Melon(<span class="string">"Hemi"</span>, <span class="number">2600</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WeightsAndTotal weightsAndTotal = melons.stream()</span><br><span class="line">    .collect(Collectors.teeing(</span><br><span class="line">            summingInt(Melon::getWeight),</span><br><span class="line">            mapping(m -&gt; m.getWeight(), toList()),</span><br><span class="line">            WeightsAndTotal::<span class="keyword">new</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(weightsAndTotal.toString());</span><br></pre></td></tr></table></figure><ul><li>downstream1 é€šè¿‡ Collectors çš„é™æ€æ–¹æ³• summingInt åšé‡é‡ç´¯åŠ </li><li>downstream2 é€šè¿‡ Collectors çš„é™æ€æ–¹æ³• mapping æå–å‡ºç“œçš„é‡é‡ï¼Œå¹¶é€šè¿‡æµçš„ç»ˆç»“æ“ä½œ toList() è·å–ç»“æœ</li><li>merger é€šè¿‡ WeightsAndTotal æ„é€ å™¨è·å–ç»“æœ</li></ul><p>è¿è¡Œç»“æœ:</p><blockquote><p> WeightsAndTotal{totalWeight=19500, weights=[1200, 3000, 2600, 1600, 1200, 2600, 1700, 3000, 2600]}</p></blockquote><p>ç»§ç»­ä¸€ä¸ªæ›´è´´åˆå®é™…çš„ä¾‹å­å§:</p><h3 id="é¢„çº¦äººå‘˜åˆ—è¡¨å’Œé¢„çº¦äººæ•°"><a href="#é¢„çº¦äººå‘˜åˆ—è¡¨å’Œé¢„çº¦äººæ•°" class="headerlink" title="é¢„çº¦äººå‘˜åˆ—è¡¨å’Œé¢„çº¦äººæ•°"></a>é¢„çº¦äººå‘˜åˆ—è¡¨å’Œé¢„çº¦äººæ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Guest</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> participating;</span><br><span class="line"><span class="keyword">private</span> Integer participantsNumber;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Guest</span><span class="params">(String name, <span class="keyword">boolean</span> participating, Integer participantsNumber)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.participating = participating;</span><br><span class="line"><span class="keyword">this</span>.participantsNumber = participantsNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isParticipating</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> participating;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getParticipantsNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> participantsNumber;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventParticipation</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; guestNameList;</span><br><span class="line"><span class="keyword">private</span> Integer totalNumberOfParticipants;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EventParticipation</span><span class="params">(List&lt;String&gt; guestNameList, Integer totalNumberOfParticipants)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.guestNameList = guestNameList;</span><br><span class="line"><span class="keyword">this</span>.totalNumberOfParticipants = totalNumberOfParticipants;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"EventParticipation &#123; "</span> +</span><br><span class="line"><span class="string">"guests = "</span> + guestNameList +</span><br><span class="line"><span class="string">", total number of participants = "</span> + totalNumberOfParticipants +</span><br><span class="line"><span class="string">" &#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ teeing API å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Guest(<span class="string">"Marco"</span>, <span class="keyword">true</span>, <span class="number">3</span>),</span><br><span class="line">                <span class="keyword">new</span> Guest(<span class="string">"David"</span>, <span class="keyword">false</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> Guest(<span class="string">"Roger"</span>,<span class="keyword">true</span>, <span class="number">6</span>))</span><br><span class="line">                .collect(Collectors.teeing(</span><br><span class="line">                        Collectors.filtering(Guest::isParticipating, Collectors.mapping(Guest::getName, Collectors.toList())),</span><br><span class="line">                        Collectors.summingInt(Guest::getParticipantsNumber),</span><br><span class="line">                        EventParticipation::<span class="keyword">new</span></span><br><span class="line">                ));</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure><ul><li>downstream1 é€šè¿‡ filtering æ–¹æ³•è¿‡æ»¤å‡ºç¡®å®šå‚åŠ çš„äººï¼Œå¹¶ mapping å‡ºä»–ä»¬çš„å§“åï¼Œæœ€ç»ˆæ”¾åˆ° toList é›†åˆä¸­</li><li>downstream2 é€šè¿‡ summingInt æ–¹æ³•è®¡æ•°ç´¯åŠ </li><li>merger é€šè¿‡ EventParticipation æ„é€ å™¨æ”¶é›†ç»“æœ</li></ul><p>å…¶ä¸­æˆ‘ä»¬å®šä¹‰äº† var result æ¥æ”¶é›†ç»“æœï¼Œå¹¶æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œè¿™ä¸ªè¯­æ³•ç³–ä¹ŸåŠ é€Ÿäº†æˆ‘ä»¬ç¼–ç¨‹çš„æ•ˆç‡</p><p>è¿è¡Œç»“æœ:</p><blockquote><p> EventParticipation { guests = [Marco, Roger], total number of participants = 11 }</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…¶å® teeing API å°±æ˜¯çµæ´»åº”ç”¨ Collectors é‡Œé¢å®šä¹‰çš„é™æ€æ–¹æ³•ï¼Œå°†é›†åˆå…ƒç´ é€šè¿‡ downstream1 å’Œ downstream2 è¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆé€šè¿‡ merger æ”¶é›†èµ·æ¥ï¼Œå½“é¡¹ç›®ä¸­æœ‰åŒæ—¶è·å–ä¸¤ä¸ªæ”¶é›†ç»“æœæ—¶ï¼Œæ˜¯æ—¶å€™åº”ç”¨æˆ‘ä»¬çš„ teeing API äº†</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>Collectors é‡Œé¢çš„é™æ€æ–¹æ³•ä½ åº”ç”¨çš„ç†Ÿç»ƒå—ï¼Ÿ</li><li>é¡¹ç›®ä¸­ä½ ä»¬åœ¨ç”¨ JDK çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</li><li>Lambda çš„ä½¿ç”¨ç†Ÿç»ƒå—ï¼Ÿ</li><li>ä½ çš„ç¯è¿˜äº®ç€å—ï¼Ÿ</li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JDKæºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¹¶å‘æ­»é”è§£å†³æ€è·¯</title>
      <link href="//p/java-concurrency-dead-lock.html"/>
      <url>//p/java-concurrency-dead-lock.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://dayarch.top/p/33b9e35c.html">å…±äº«èµ„æºé‚£ä¹ˆå¤šï¼Œå¦‚ä½•ç”¨ä¸€æŠŠé”ä¿æŠ¤å¤šä¸ªèµ„æºï¼Ÿ</a> æ–‡ç« æˆ‘ä»¬è°ˆåˆ°äº†é“¶è¡Œè½¬è´¦ç»å…¸æ¡ˆä¾‹ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªé—®é¢˜:</p><ol><li>å•çº¯çš„ç”¨ synchronized æ–¹æ³•èµ·ä¸åˆ°ä¿æŠ¤ä½œç”¨(ä¸èƒ½ä¿æŠ¤ target)</li><li>ç”¨ Account.class é”æ–¹æ¡ˆï¼Œé”çš„ç²’åº¦åˆè¿‡å¤§ï¼Œå¯¼è‡´æ¶‰åŠåˆ°è´¦æˆ·çš„æ‰€æœ‰æ“ä½œ(å–æ¬¾ï¼Œè½¬è´¦ï¼Œä¿®æ”¹å¯†ç ç­‰)éƒ½ä¼šå˜æˆä¸²è¡Œæ“ä½œ</li></ol><p>å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å‘¢ï¼Ÿå’±ä»¬å…ˆæ¢å¥½è¡£æœç©¿è¶Šå›åˆ°è¿‡å»å¯»æ‰¾ä¸€ä¸‹é’±åº„ï¼Œä¸€èµ·é€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œdengdeng dengâ€¦â€¦.</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-17/2019-10-17-16-08-25.png" alt=""></p><p>æ¥åˆ°é’±åº„ï¼Œå‘Šè¯‰æŸœå‘˜ä½ è¦ç»™é“è›‹å„¿è½¬ 100 é“œé’±ï¼Œè¿™æ—¶æŸœå‘˜è½¬èº«åœ¨å¢™ä¸Šå¯»æ‰¾ä½ å’Œé“è›‹å„¿çš„è´¦æœ¬ï¼Œæ­¤æ—¶æŸœå‘˜å¯èƒ½é¢ä¸´ä¸‰ç§æƒ…å†µ:</p><ol><li>ç†æƒ³çŠ¶æ€: ä½ å’Œé“è›‹å„¿çš„è´¦æœ¬éƒ½æ˜¯ç©ºé—²çŠ¶æ€ï¼Œä¸€èµ·æ‹¿å›æ¥ï¼Œåœ¨ä½ çš„è´¦æœ¬ä¸Šå‡ 100 é“œé’±ï¼Œåœ¨é“è›‹å„¿è´¦æœ¬ä¸ŠåŠ  100 é“œé’±ï¼ŒæŸœå‘˜è½¬èº«å°†è´¦æœ¬æŒ‚å›åˆ°å¢™ä¸Šï¼Œå®Œæˆä½ çš„ä¸šåŠ¡</li><li>å°´å°¬çŠ¶æ€: ä½ çš„è´¦æœ¬åœ¨ï¼Œé“è›‹å„¿çš„è´¦æœ¬è¢«å…¶ä»–æŸœå‘˜æ‹¿å‡ºå»ç»™åˆ«äººè½¬è´¦ï¼Œä½ è¦ç­‰å¾…å…¶ä»–æŸœå‘˜æŠŠé“è›‹å„¿çš„è´¦æœ¬å½’è¿˜</li><li>æŠ“ç‹‚çŠ¶æ€: ä½ çš„è´¦æœ¬ä¸åœ¨ï¼Œé“è›‹å„¿çš„è´¦æœ¬ä¹Ÿä¸åœ¨ï¼Œä½ åªèƒ½ç­‰å¾…ä¸¤ä¸ªè´¦æœ¬éƒ½å½’è¿˜</li></ol><p>æ”¾æ…¢æŸœå‘˜çš„å–è´¦æœ¬æ“ä½œï¼Œä»–ä¸€å®šæ˜¯å…ˆæ‹¿åˆ°ä½ çš„è´¦æœ¬ï¼Œç„¶åå†å»æ‹¿é“è›‹å„¿çš„è´¦æœ¬ï¼Œä¸¤ä¸ªè´¦æœ¬éƒ½æ‹¿åˆ°(ç†æƒ³çŠ¶æ€)ä¹‹åæ‰èƒ½å®Œæˆè½¬è´¦ï¼Œç”¨ç¨‹åºæ¨¡å‹æ¥æè¿°ä¸€ä¸‹è¿™ä¸ªæ‹¿å–è´¦æœ¬çš„è¿‡ç¨‹:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-17/%E9%93%B6%E8%A1%8C%E8%BD%AC%E5%B8%90%E6%AD%BB%E9%94%81%20%281%29.png" alt=""></p><p>æˆ‘ä»¬ç»§ç»­ç”¨ç¨‹åºä»£ç æè¿°ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªæ¨¡å‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line">  <span class="comment">// è½¬è´¦</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Account target, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line">    <span class="comment">// é”å®šè½¬å‡ºè´¦æˆ·</span></span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;              </span><br><span class="line">      <span class="comment">// é”å®šè½¬å…¥è´¦æˆ·</span></span><br><span class="line">      <span class="keyword">synchronized</span>(target) &#123;           </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amt) &#123;</span><br><span class="line">          <span class="keyword">this</span>.balance -= amt;</span><br><span class="line">          target.balance += amt;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆçœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œè§£å†³äº†æ–‡ç« å¼€å¤´è¯´çš„ä¸¤ä¸ªé—®é¢˜ï¼Œä½†çœŸæ˜¯è¿™æ ·å—ï¼Ÿ</p><hr><p>æˆ‘ä»¬åˆšåˆšè¯´è¿‡çš„ç†æƒ³çŠ¶æ€æ˜¯é’±åº„åªæœ‰ä¸€ä¸ªæŸœå‘˜(æ—¢å•çº¿ç¨‹)ã€‚éšç€é’±åº„è§„æ¨¡å˜å¤§ï¼Œå¢™ä¸Šæ—©å·²æŒ‚äº†éå¸¸å¤šä¸ªè´¦æœ¬ï¼Œé’±åº„ä¸ºäº†åº”å¯¹ç¹å¿™çš„ä¸šåŠ¡ï¼Œå¼€é€šäº†å¤šä¸ªçª—å£ï¼Œæ­¤æ—¶æœ‰å¤šä¸ªæŸœå‘˜(å¤šçº¿ç¨‹)å¤„ç†é’±åº„ä¸šåŠ¡ã€‚</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-17/2019-10-17-18-42-42.png" alt=""></p><p>æŸœå‘˜ 1 æ­£åœ¨åŠç†ç»™é“è›‹å„¿è½¬è´¦çš„ä¸šåŠ¡ï¼Œä½†åªæ‹¿åˆ°äº†ä½ çš„è´¦æœ¬ï¼›æŸœå‘˜ 2 æ­£åœ¨åŠç†é“è›‹å„¿ç»™ä½ è½¬è´¦çš„ä¸šåŠ¡ï¼Œä½†åªæ‹¿åˆ°äº†é“è›‹å„¿çš„è´¦æœ¬ï¼Œæ­¤æ—¶åŒæ–¹å‡ºç°äº†å°´å°¬çŠ¶æ€ï¼Œä¸¤ä½æŸœå‘˜éƒ½åœ¨ç­‰å¾…å¯¹æ–¹å½’è¿˜è´¦æœ¬ä¸ºå½“å‰å®¢æˆ·åŠç†è½¬è´¦ä¸šåŠ¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgbank.png" alt=""></p><p>ç°å®ä¸­æŸœå‘˜ä¼šæ²Ÿé€šï¼Œå–Šå‡ºä¸€å—“å­ <strong><em>è€é“ï¼Œé“è›‹å„¿çš„è´¦æœ¬å…ˆç»™æˆ‘ç”¨ä¸€ä¸‹ï¼Œç”¨å®Œè¿˜ç»™ä½ </em></strong>ï¼Œä½†ç¨‹åºå´æ²¡è¿™ä¹ˆæ™ºèƒ½ï¼Œsynchronized å†…ç½®é”éå¸¸æ‰§ç€ï¼Œå®ƒä¼šå‘Šè¯‰ä½ ã€Œæ­»ç­‰ã€çš„é“ç†ï¼Œæœ€ç»ˆå‡ºç°æ­»é”</p><blockquote><p> Java æœ‰äº† synchronized å†…ç½®é”ï¼Œè¿˜å‘æ˜äº†æ˜¾ç¤ºé” Lockï¼Œæ˜¯ä¸æ˜¯å°±ä¸ºäº†æ²»ä¸€æ²» synchronized ã€Œæ­»ç­‰ã€çš„æ‰§ç€å‘¢ï¼ŸğŸ˜</p></blockquote><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜å‘¢ï¼Ÿæ­£æ‰€è°“çŸ¥å·±çŸ¥å½¼æ–¹èƒ½ç™¾æˆ˜ä¸æ®†ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿæ­»é”ï¼Œæ‰èƒ½çŸ¥é“å¦‚ä½•é¿å…æ­»é”ï¼Œå¾ˆå¹¸è¿æˆ‘ä»¬å¯ä»¥ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šçœ‹å¾…é—®é¢˜</p><p><code>Coffman</code> æ€»ç»“å‡ºäº†å››ä¸ªæ¡ä»¶è¯´æ˜å¯ä»¥å‘ç”Ÿæ­»é”çš„æƒ…å½¢:</p><h4 id="Coffman-æ¡ä»¶"><a href="#Coffman-æ¡ä»¶" class="headerlink" title="Coffman æ¡ä»¶"></a>Coffman æ¡ä»¶</h4><p><strong>äº’æ–¥æ¡ä»¶ï¼š</strong>æŒ‡è¿›ç¨‹å¯¹æ‰€åˆ†é…åˆ°çš„èµ„æºè¿›è¡Œæ’å®ƒæ€§ä½¿ç”¨ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºåªç”±ä¸€ä¸ªè¿›ç¨‹å ç”¨ã€‚å¦‚æœæ­¤æ—¶è¿˜æœ‰å…¶å®ƒè¿›ç¨‹è¯·æ±‚èµ„æºï¼Œåˆ™è¯·æ±‚è€…åªèƒ½ç­‰å¾…ï¼Œç›´è‡³å æœ‰èµ„æºçš„è¿›ç¨‹ç”¨æ¯•é‡Šæ”¾ã€‚</p><p><strong>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼š</strong>æŒ‡è¿›ç¨‹å·²ç»ä¿æŒè‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶å®ƒè¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œä½†åˆå¯¹è‡ªå·±å·²è·å¾—çš„å…¶å®ƒèµ„æºä¿æŒä¸æ”¾ã€‚</p><p><strong>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼š</strong>æŒ‡è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œæ—¶ç”±è‡ªå·±é‡Šæ”¾ã€‚</p><p><strong>ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼š</strong>æŒ‡åœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹â€”â€”èµ„æºçš„ç¯å½¢é“¾ï¼Œå³è¿›ç¨‹é›†åˆ{P1ï¼ŒP2ï¼ŒÂ·Â·Â·ï¼ŒPn}ä¸­çš„ P1 æ­£åœ¨ç­‰å¾…ä¸€ä¸ª P2 å ç”¨çš„èµ„æºï¼›P2 æ­£åœ¨ç­‰å¾… P3 å ç”¨çš„èµ„æºï¼Œâ€¦â€¦ï¼ŒPn æ­£åœ¨ç­‰å¾…å·²è¢« P0 å ç”¨çš„èµ„æºã€‚</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-17/%E9%93%B6%E8%A1%8C%E8%BD%AC%E5%B8%90%E7%8E%AF%E5%BD%A2.png" alt=""></p><p>è¿™å‡ ä¸ªæ¡ä»¶å¾ˆå¥½ç†è§£ï¼Œå…¶ä¸­ã€Œäº’æ–¥æ¡ä»¶ã€æ˜¯å¹¶å‘ç¼–ç¨‹çš„æ ¹åŸºï¼Œè¿™ä¸ªæ¡ä»¶æ²¡åŠæ³•æ”¹å˜ã€‚ä½†å…¶ä»–ä¸‰ä¸ªæ¡ä»¶éƒ½æœ‰æ”¹å˜çš„å¯èƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ç ´åå¦å¤–ä¸‰ä¸ªæ¡ä»¶å°±ä¸ä¼šå‡ºç°ä¸Šé¢è¯´åˆ°çš„æ­»é”é—®é¢˜</p><h4 id="ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶"><a href="#ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶" class="headerlink" title="ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶"></a>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶</h4><p>æ¯ä¸ªæŸœå‘˜éƒ½å¯ä»¥å–æ”¾è´¦æœ¬ï¼Œå¾ˆå®¹æ˜“å‡ºç°äº’ç›¸ç­‰å¾…çš„æƒ…å†µã€‚è¦æƒ³ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼Œå°±è¦ä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰èµ„æºã€‚</p><p>ä½œä¸ºç¨‹åºçŒ¿ä½ ä¸€å®šå¬è¿‡è¿™å¥è¯:</p><blockquote><p> ä»»ä½•è½¯ä»¶å·¥ç¨‹é‡åˆ°çš„é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³</p></blockquote><p>æˆ‘ä»¬ä¸å…è®¸æŸœå‘˜éƒ½å¯ä»¥å–æ”¾è´¦æœ¬ï¼Œè´¦æœ¬è¦ç”±å•ç‹¬çš„è´¦æœ¬ç®¡ç†å‘˜æ¥ç®¡ç†</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-17/%E9%93%B6%E8%A1%8C%E8%BD%AC%E5%B8%90%E8%B4%A6%E6%9C%AC%E7%AE%A1%E7%90%86%E5%91%98.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´è´¦æœ¬ç®¡ç†å‘˜æ‹¿å–è´¦æœ¬æ˜¯ä¸´ç•ŒåŒºï¼Œå¦‚æœåªæ‹¿åˆ°å…¶ä¸­ä¹‹ä¸€çš„è´¦æœ¬ï¼Œé‚£ä¹ˆä¸ä¼šç»™æŸœå‘˜ï¼Œè€Œæ˜¯ç­‰å¾…æŸœå‘˜ä¸‹ä¸€æ¬¡è¯¢é—®æ˜¯å¦ä¸¤ä¸ªè´¦æœ¬éƒ½åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"><span class="comment">//å•ä¾‹çš„è´¦æœ¬ç®¡ç†å‘˜</span></span><br><span class="line"><span class="keyword">private</span> AccountBookManager accountBookManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Account target, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line"><span class="comment">// ä¸€æ¬¡æ€§ç”³è¯·è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line"><span class="keyword">while</span>(accountBookManager.getAllRequiredAccountBook(<span class="keyword">this</span>, target));</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="comment">// é”å®šè½¬å‡ºè´¦æˆ·</span></span><br><span class="line"><span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line"><span class="comment">// é”å®šè½¬å…¥è´¦æˆ·</span></span><br><span class="line"><span class="keyword">synchronized</span>(target)&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amt)&#123;</span><br><span class="line"><span class="keyword">this</span>.balance -= amt;</span><br><span class="line">target.balance += amt;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">accountBookManager.releaseObtainedAccountBook(<span class="keyword">this</span>, target);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountBookManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; accounts = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">getAllRequiredAccountBook</span><span class="params">( Object from, Object to)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(accounts.contains(from) || accounts.contains(to))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">accounts.add(from);</span><br><span class="line">accounts.add(to);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½’è¿˜èµ„æº</span></span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">releaseObtainedAccountBook</span><span class="params">(Object from, Object to)</span></span>&#123;</span><br><span class="line">accounts.remove(from);</span><br><span class="line">accounts.remove(to);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç ´åä¸å¯å‰¥å¤ºæ¡ä»¶"><a href="#ç ´åä¸å¯å‰¥å¤ºæ¡ä»¶" class="headerlink" title="ç ´åä¸å¯å‰¥å¤ºæ¡ä»¶"></a>ç ´åä¸å¯å‰¥å¤ºæ¡ä»¶</h4><p>ä¸Šé¢å·²ç»ç»™äº†ä½ å°å°çš„æç¤ºï¼Œä¸ºäº†è§£å†³å†…ç½®é”çš„æ‰§ç€ï¼ŒJava æ˜¾ç¤ºé”æ”¯æŒé€šçŸ¥(notify/notifyall)å’Œç­‰å¾…(wait)ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥åŠŸèƒ½å¯ä»¥å®ç°å–Šä¸€å—“å­ <strong><em>è€é“ï¼Œé“è›‹å„¿çš„è´¦æœ¬å…ˆç»™æˆ‘ç”¨ä¸€ä¸‹ï¼Œç”¨å®Œè¿˜ç»™ä½ </em></strong> çš„åŠŸèƒ½ï¼Œè¿™ä¸ªåç»­å°†åˆ° Java SDK ç›¸å…³å†…å®¹æ—¶ä¼šåšè¯´æ˜</p><h4 id="ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶"><a href="#ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶" class="headerlink" title="ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶"></a>ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶</h4><p>ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†èµ„æºåºå·å¤§å°æ’åºè·å–å°±ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†ç¯è·¯æ‹†é™¤</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-17/%E9%93%B6%E8%A1%8C%E8%BD%AC%E5%B8%90%E6%8E%92%E5%BA%8F.png" alt=""></p><p>ç»§ç»­ç”¨ä»£ç æ¥è¯´æ˜:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line">  <span class="comment">// è½¬è´¦</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Account target, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line">    Account smaller = <span class="keyword">this</span>        </span><br><span class="line">    Account larger = target;    </span><br><span class="line">    <span class="comment">// æ’åº</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.id &gt; target.id) &#123; </span><br><span class="line">      smaller = target;           </span><br><span class="line">      larger = <span class="keyword">this</span>;            </span><br><span class="line">    &#125;                          </span><br><span class="line">    <span class="comment">// é”å®šåºå·å°çš„è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">synchronized</span>(smaller)&#123;</span><br><span class="line">      <span class="comment">// é”å®šåºå·å¤§çš„è´¦æˆ·</span></span><br><span class="line">      <span class="keyword">synchronized</span>(larger)&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amt)&#123;</span><br><span class="line">          <span class="keyword">this</span>.balance -= amt;</span><br><span class="line">          target.balance += amt;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ smaller è¢«å ç”¨æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œä¹Ÿå°±ä¸ä¼šå­˜åœ¨æ­»é”äº†. </p><h2 id="é™„åŠ è¯´æ˜"><a href="#é™„åŠ è¯´æ˜" class="headerlink" title="é™„åŠ è¯´æ˜"></a>é™„åŠ è¯´æ˜</h2><p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œå…³äº Account éƒ½ä¼šæ˜¯æ•°æ®åº“å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡äº‹åŠ¡æˆ–æ•°æ®åº“çš„ä¹è§‚é”æ¥è§£å†³çš„ã€‚å¦å¤–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè´¦æœ¬ç®¡ç†å‘˜è¿™ä¸ªè§’è‰²çš„å¤„ç†ä¹Ÿå¯èƒ½ä¼šç”¨ redis åˆ†å¸ƒå¼é”æ¥è§£å†³. </p><p>åœ¨å¤„ç†ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ while å¾ªç¯æ–¹å¼æ¥ä¸æ–­è¯·æ±‚é”çš„æ—¶å€™ï¼Œåœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ timeout çš„è®¾ç½®ï¼Œé˜²æ­¢æ— ä¼‘æ­¢çš„æµªè´¹ CPU ä½¿ç”¨ç‡</p><p>å¦å¤–å¤§å®¶å¯ä»¥å°è¯•ä½¿ç”¨é˜¿é‡Œå¼€æºå·¥å…· Arthas æ¥æŸ¥çœ‹ CPU ä½¿ç”¨ç‡ï¼Œçº¿ç¨‹ç­‰ç›¸å…³é—®é¢˜ï¼Œgithub ä¸Šæœ‰æ˜ç¡®çš„è¯´æ˜</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›è¿œè¿œè¶…è¿‡äººç±»ï¼Œä½†æ˜¯ä»–çš„æ™ºæ…§è¿˜éœ€è¦æœ‰å¸¦æé«˜ï¼Œå½“çœ‹å¾…å¹¶å‘é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€è®¤ä¸ºäººç±»çš„æœ€åŸºæœ¬æ²Ÿé€šè®¡ç®—æœºä¹Ÿå¯ä»¥åšåˆ°ï¼Œå…¶å®ä¸ç„¶ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œç¼–å†™å¹¶å‘ç¨‹åºï¼Œè¦ç«™åœ¨è®¡ç®—æœºçš„è§’åº¦æ¥çœ‹å¾…é—®é¢˜</p><p>ç²—ç²’åº¦é”æˆ‘ä»¬ä¸æå€¡ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨ç»†ç²’åº¦é”ï¼Œä½†ä½¿ç”¨ç»†ç²’åº¦é”çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä¸¥æ ¼æŒ‰ç…§ Coffman çš„å››å¤§æ¡ä»¶æ¥é€æ¡åˆ¤æ–­ï¼Œè¿™æ ·å†åº”ç”¨æˆ‘ä»¬è¿™å‡ ä¸ªè§£å†³æ–¹æ¡ˆæ¥è§£å†³å°±å¥½äº†</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶æ—¶ï¼Œå¤„ç†èƒ½åŠ›çš„ç“¶é¢ˆåœ¨è´¦æœ¬ç®¡ç†å‘˜é‚£é‡Œï¼Œé‚£ä½ è§‰å¾—è¿™ç§å¤„ç†æ–¹å¼ä¼šæé«˜å¹¶å‘é‡å—ï¼Ÿ</li><li>ç ´åè¯·æ±‚ä¿æŒæ¡ä»¶çš„æ–¹æ³•å’Œç ´åç¯è·¯ç­‰å¾…çš„æ–¹æ³•ï¼Œä½ è§‰å¾—é‚£ç§æ–¹å¼æ›´å¥½</li><li>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶æ—¶ï¼Œå¦‚æœä»£ç æ¢æˆä¸‹é¢çš„æ ·å­ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Account target, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸€æ¬¡æ€§ç”³è¯·è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">while</span>(accountBookManager.getAllRequiredAccountBook(<span class="keyword">this</span>, target))&#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// é”å®šè½¬å‡ºè´¦æˆ·</span></span><br><span class="line">            <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">                <span class="comment">// é”å®šè½¬å…¥è´¦æˆ·</span></span><br><span class="line">                <span class="keyword">synchronized</span>(target)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amt)&#123;</span><br><span class="line">                        <span class="keyword">this</span>.balance -= amt;</span><br><span class="line">                        target.balance += amt;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            accountBookManager.releaseObtainedAccountBook(<span class="keyword">this</span>, target);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""> </p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ol><li><a href="https://dayarch.top/p/d7e125a1.html">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡</a></li><li><a href="https://dayarch.top/p/86243a5b.html">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a></li><li><a href="https://dayarch.top/p/6d12b8cf.html">å¹¶å‘Bugä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a></li><li><a href="https://dayarch.top/p/815d7647.html">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://dayarch.top/p/32b8e26a.html">è§£å†³åŸå­æ€§é—®é¢˜ï¼Ÿä½ é¦–å…ˆéœ€è¦çš„æ˜¯å®è§‚ç†è§£</a></li><li><a href="https://dayarch.top/p/fb3c7eeb.html">é¢è¯•å¹¶å‘volatileå…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…·å¤‡å“ªäº›è°ˆèµ„ï¼Ÿ</a></li></ol><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº« </li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­” </li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ­»é” </tag>
            
            <tag> é”ç²’åº¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot è‡ªå®šä¹‰starter å…¨é¢æ•™ç¨‹</title>
      <link href="//p/spring-boot-starter-custom.html"/>
      <url>//p/spring-boot-starter-custom.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æˆ‘ä»¬æ¯æ¬¡æ„å»ºä¸€ä¸ª Spring åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¸å¸Œæœ›ä»å¤´å¼€å§‹å®ç°å…·æœ‰ã€Œæ¨ªåˆ‡å…³æ³¨ç‚¹ã€çš„å†…å®¹ï¼›ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€æ¬¡æ€§å®ç°è¿™äº›åŠŸèƒ½ï¼Œå¹¶æ ¹æ®éœ€è¦å°†å®ƒä»¬åŒ…å«åˆ°ä»»ä½•æˆ‘ä»¬è¦æ„å»ºçš„åº”ç”¨ç¨‹åºä¸­</p><blockquote><h4 id="æ¨ªåˆ‡å…³æ³¨ç‚¹"><a href="#æ¨ªåˆ‡å…³æ³¨ç‚¹" class="headerlink" title="æ¨ªåˆ‡å…³æ³¨ç‚¹"></a>æ¨ªåˆ‡å…³æ³¨ç‚¹</h4><p> æ¨ªåˆ‡å…³æ³¨ç‚¹: æŒ‡çš„æ˜¯ä¸€äº›å…·æœ‰æ¨ªè¶Šå¤šä¸ªæ¨¡å—çš„è¡Œä¸º (æ¥è‡ªç»´åŸºç™¾ç§‘çš„ä»‹ç»)<br> <strong>è¯´ç™½äº†å°±æ˜¯å¤šä¸ªé¡¹ç›®æˆ–æ¨¡å—éƒ½å¯ä»¥ç”¨åˆ°çš„å†…å®¹ï¼Œæ¯”å¦‚ä¸€ä¸ª SDK</strong></p></blockquote><p>åœ¨Spring Bootä¸­ï¼Œç”¨äºè¡¨ç¤ºæä¾›è¿™ç§æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—çš„æœ¯è¯­æ˜¯ <strong>starter</strong>ï¼Œé€šè¿‡ä¾èµ– starter å¯ä»¥è½»æ¾ä½¿ç”¨å…¶åŒ…å«çš„ä¸€äº›åŠŸèƒ½ç‰¹æ€§ï¼Œ<strong>æ— è®ºä½ çš„å·¥ä½œä¸­æ˜¯å¦ä¼šæ„å»ºè‡ªå·±çš„ starterï¼Œä½ éƒ½è¦å…·æœ‰æ„å»º ã€Œstarterã€çš„æ€æƒ³</strong>ï¼Œæœ¬æ–‡å°†ç»“åˆ Spring Boot å®˜æ–¹æ ‡å‡†æ„å»ºä¸€ä¸ªç®€å•çš„ starter</p><h2 id="è‡ªå®šä¹‰-starter"><a href="#è‡ªå®šä¹‰-starter" class="headerlink" title="è‡ªå®šä¹‰ starter"></a>è‡ªå®šä¹‰ starter</h2><p>åœ¨æˆ‘ä»¬æ·±å…¥äº†è§£å¦‚ä½•è‡ªå®šä¹‰ starter ä¹‹å‰ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£æˆ‘ä»¬æ¯ä¸€æ­¥åœ¨å¹²ä»€ä¹ˆï¼Œä»¥åŠ starter æ˜¯å¦‚ä½•èµ·ä½œç”¨çš„ï¼Œæˆ‘ä»¬å…ˆä»å®è§‚è§’åº¦æ¥çœ‹ starter çš„ç»“æ„ç»„æˆåˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„</p><p>é€šå¸¸ä¸€ä¸ªå®Œæ•´çš„ starter éœ€è¦åŒ…å«ä¸‹é¢ä¸¤ä¸ªç»„ä»¶:</p><ol><li>Auto-Configure Module</li><li>Starter Module</li></ol><p>å¦‚æœä½ çœ‹ä¸‹é¢è¿™ä¸¤ä¸ªç»„ä»¶çš„è§£é‡Šæœ‰äº›æŠ½è±¡ï¼Œå¤§æ¦‚äº†è§£ä¸€ä¸‹ï¼Œé˜…è¯»å®Œè¯¥æ–‡ç« å›çœ‹è¿™é‡Œå°±ä¼šè±ç„¶å¼€æœ—äº†</p><h3 id="Auto-Configure-Module"><a href="#Auto-Configure-Module" class="headerlink" title="Auto-Configure Module"></a>Auto-Configure Module</h3><p>Auto-Configure Module (è‡ªåŠ¨é…ç½®æ¨¡å—) æ˜¯åŒ…å«è‡ªåŠ¨é…ç½®ç±»çš„ Maven æˆ– Gradle æ¨¡å—ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æ„å»ºå¯ä»¥è‡ªåŠ¨è´¡çŒ®äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„æ¨¡å—ï¼Œä»¥åŠæ·»åŠ æŸä¸ªç‰¹æ€§æˆ–æä¾›å¯¹æŸä¸ªå¤–éƒ¨åº“çš„è®¿é—®</strong></p><h3 id="Starter-Module"><a href="#Starter-Module" class="headerlink" title="Starter Module"></a>Starter Module</h3><p>Spring Boot Starter æ˜¯ä¸€ä¸ª Maven æˆ– Gradle æ¨¡å—ï¼Œå…¶å”¯ä¸€ç›®çš„æ˜¯æä¾› â€œå¯åŠ¨â€ æŸä¸ªç‰¹æ€§æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª Auto-Configure Module (è‡ªåŠ¨é…ç½®æ¨¡å—)çš„ä¾èµ–é¡¹ï¼Œä»¥åŠå¯èƒ½éœ€è¦çš„ä»»ä½•å…¶ä»–ä¾èµ–é¡¹ã€‚è¿™æ ·ï¼Œåœ¨Spring å¯åŠ¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ è¿™ä¸ª starter ä¾èµ–å°±å¯ä»¥ä½¿ç”¨å…¶ç‰¹æ€§</p><blockquote><p> âš ï¸: Spring å®˜æ–¹å‚è€ƒæ‰‹å†Œå»ºè®®å°†è‡ªåŠ¨é…ç½®åˆ†ç¦»ï¼Œå¹¶å°†æ¯ä¸ªè‡ªåŠ¨é…ç½®å¯åŠ¨åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ Maven æˆ– Gradle æ¨¡å—ä¸­ï¼Œä»è€Œå°†è‡ªåŠ¨é…ç½®å’Œä¾èµ–é¡¹ç®¡ç†åˆ†ç¦»å¼€æ¥ã€‚å¦‚æœä½ æ²¡æœ‰å»ºç«‹ä¸€ä¸ªä¾›æˆåƒä¸Šä¸‡ç”¨æˆ·ä½¿ç”¨çš„å¼€æºåº“ï¼Œä¹Ÿå¯ä»¥å°†äºŒè€…åˆå¹¶åˆ°ä¸€ä¸ª module ä¸­<br> <em>You may combine the auto-configuration code and the dependency management in a single module if you do not need to separate those two concerns</em></p></blockquote><h3 id="å‘½å"><a href="#å‘½å" class="headerlink" title="å‘½å"></a>å‘½å</h3><p>æ¥è‡ª Spring å®˜æ–¹çš„ starter éƒ½æ˜¯ ä»¥ <code>spring-boot-starter</code> å¼€å¤´ï¼Œæ¯”å¦‚:</p><ul><li>spring-boot-starter-web</li><li>spring-boot-starter-aop</li></ul><p>å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ starter åŠŸèƒ½åç§°å«<code>acme</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å‘½åæ˜¯è¿™æ ·çš„:</p><ul><li>acme-spring-boot-starter</li><li>acme-spring-boot-autoconfigure</li></ul><p>å¦‚æœ starter ä¸­ç”¨åˆ°äº†é…ç½® keysï¼Œä¹Ÿè¦æ³¨æ„ä¸è¦ä½¿ç”¨ Spring Boot ä½¿ç”¨çš„å‘½åç©ºé—´ï¼Œæ¯”å¦‚(serverï¼Œmanagementï¼Œspring)</p><h3 id="Parent-Module-åˆ›å»º"><a href="#Parent-Module-åˆ›å»º" class="headerlink" title="Parent Module åˆ›å»º"></a>Parent Module åˆ›å»º</h3><p>å…ˆæ¥å…¨å±€çœ‹ä¸€ä¸‹é¡¹ç›®ç»“æ„:<br>ä¸€çº§ç›®å½•ç»“æ„:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â”œâ”€â”€ rgyb-spring-boot-autoconfigure</span><br><span class="line">â”œâ”€â”€ rgyb-spring-boot-sample</span><br><span class="line">â””â”€â”€ rgyb-spring-boot-starter</span><br></pre></td></tr></table></figure><p>äºŒçº§ç›®å½•ç»“æ„:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â”œâ”€â”€ rgyb-spring-boot-autoconfigure</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src</span><br><span class="line">â”œâ”€â”€ rgyb-spring-boot-sample</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src</span><br><span class="line">â””â”€â”€ rgyb-spring-boot-starter</span><br><span class="line">    â”œâ”€â”€ pom.xml</span><br><span class="line">    â””â”€â”€ src</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç©ºçš„çˆ¶äº² Maven Moduleï¼Œä¸»è¦æä¾›ä¾èµ–ç®¡ç†ï¼Œè¿™æ · SubModule ä¸ç”¨å•ç‹¬ç»´æŠ¤ä¾èµ–ç‰ˆæœ¬å·ï¼Œæ¥çœ‹ pom.xml å†…å®¹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  æ·»åŠ å…¶ä»–å…¨å±€ä¾èµ–ç®¡ç†åˆ°è¿™é‡Œï¼Œsubmoduleé»˜è®¤ä¸å¼•å…¥è¿™äº›ä¾èµ–ï¼Œéœ€è¦æ˜¾å¼çš„æŒ‡å®š  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Auto-Configure-Module-æ„å»º"><a href="#Auto-Configure-Module-æ„å»º" class="headerlink" title="Auto-Configure Module æ„å»º"></a>Auto-Configure Module æ„å»º</h3><p>æ–°å»ºç±» <code>GreetingAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GreetingService <span class="title">greetingService</span><span class="params">(GreetingProperties greetingProperties)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> GreetingService(greetingProperties.getMembers());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨ <code>@Configuration</code> æ³¨è§£æ ‡è®°ç±» GreetingAutoConfigurationï¼Œä½œä¸º starter çš„å…¥å£ç‚¹ã€‚è¿™ä¸ªé…ç½®åŒ…å«äº†æˆ‘ä»¬éœ€è¦æä¾›starterç‰¹æ€§çš„æ‰€æœ‰ <code>@Bean</code> å®šä¹‰ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œä¸ºäº†ç®€å•é˜è¿°é—®é¢˜ï¼Œæˆ‘ä»¬åªå°† GreetingService Bean æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡</p><p>GreetingService å†…å®¹å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; members = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">members.forEach(s -&gt; System.out.println(<span class="string">"hello "</span> + s));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ resources ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ <code>META-INF/spring.factories</code> (å¦‚æœç›®å½• <code>META-INF</code> ä¸å­˜åœ¨éœ€è¦æ‰‹å·¥åˆ›å»º)ï¼Œå‘æ–‡ä»¶å†™å…¥å†…å®¹:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"> <span class="attr">top.dayarch.autoconfigure.GreetingAutoConfiguration</span></span><br></pre></td></tr></table></figure><p>Spring å¯åŠ¨æ—¶ä¼šåœ¨å…¶ classpath ä¸­æ‰€æœ‰çš„ <code>spring.factoreis</code> æ–‡ä»¶ï¼Œå¹¶åŠ è½½é‡Œé¢çš„å£°æ˜é…ç½®ï¼ŒGreetingAutoConfiguration ç±»å°±ç»ªåï¼Œæˆ‘ä»¬çš„ Spring Boot Starter å°±æœ‰äº†ä¸€ä¸ªè‡ªåŠ¨æ¿€æ´»çš„å…¥å£ç‚¹</p><p>åˆ°è¿™é‡Œè¿™ä¸ª â€œä¸å®Œå…¨çš„ starterâ€ å·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚ä½†å› ä¸ºå®ƒæ˜¯è‡ªåŠ¨æ¿€æ´»çš„ï¼Œä¸ºäº†ä¸ªè®©å…¶çµæ´»å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦è®©å…¶æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿æ¥æ¿€æ´»ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¡ä»¶æ³¨è§£æ¥å¸®å¿™</p><h4 id="æ¡ä»¶é…ç½®"><a href="#æ¡ä»¶é…ç½®" class="headerlink" title="æ¡ä»¶é…ç½®"></a>æ¡ä»¶é…ç½®</h4><p>ä¸ºç±»æ·»åŠ ä¸¤ä¸ªæ¡ä»¶æ³¨è§£:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(value = <span class="string">"rgyb.greeting.enable"</span>, havingValue = <span class="string">"true"</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(DummyEmail.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingAutoConfiguration</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ä½¿ç”¨ <code>@ConditionalOnProperty</code> æ³¨è§£ï¼Œæˆ‘ä»¬å‘Šè¯‰ Springï¼Œåªæœ‰å±æ€§ <code>rgyb.greeting.enable</code> å€¼è¢«è®¾ç½®ä¸º true æ—¶ï¼Œæ‰å°† GreetingAutoConfiguration (ä»¥åŠå®ƒå£°æ˜çš„æ‰€æœ‰ bean ) åŒ…å«åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­</li><li>é€šè¿‡ä½¿ç”¨ <code>@ConditionalOnClass</code> æ³¨è§£ï¼Œæˆ‘ä»¬å‘Šè¯‰Spring åªæœ‰ç±» DummyEmail.class å­˜åœ¨äº classpath æ—¶ï¼Œæ‰å°† GreetingAutoConfiguration (ä»¥åŠå®ƒå£°æ˜çš„æ‰€æœ‰ bean ) åŒ…å«åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­</li></ul><p>å¤šä¸ªæ¡ä»¶æ˜¯ <code>and/ä¸</code>çš„å…³ç³»ï¼Œæ—¢åªæœ‰æ»¡è¶³å…¨éƒ¨æ¡ä»¶æ—¶ï¼Œæ‰ä¼šåŠ è½½ GreetingAutoConfiguration</p><p>å¦‚æœä½ å¯¹æ¡ä»¶æ³¨è§£çš„ä½¿ç”¨è¿˜ä¸æ˜¯å¾ˆæ˜ç¡®ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« : <a href="https://dayarch.top/p/d66d57ce.html">@Conditionalæ³¨è§£ï¼Œçµæ´»é…ç½® Spring Boot</a></p><h4 id="é…ç½®å±æ€§ç®¡ç†"><a href="#é…ç½®å±æ€§ç®¡ç†" class="headerlink" title="é…ç½®å±æ€§ç®¡ç†"></a>é…ç½®å±æ€§ç®¡ç†</h4><p>ä¸Šé¢ä½¿ç”¨äº† <code>@ConditionalOnProperty</code> æ³¨è§£ï¼Œå®é™… starter ä¸­å¯èƒ½æœ‰éå¸¸å¤šçš„å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™äº›å±æ€§é›†ä¸­ç®¡ç†:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"rgyb.greeting"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GreetingProperties å¼€å…³</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">boolean</span> enable = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éœ€è¦æ‰“æ‹›å‘¼çš„æˆå‘˜åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;String&gt; members = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“è¿™äº›å±æ€§æ˜¯è¦åœ¨ application.yml ä¸­ä½¿ç”¨çš„ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™äº›å±æ€§æ—¶ï¼Œä¸ºäº†è®© IDE ç»™å‡ºæ›´å‹å¥½çš„æç¤ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“æˆ‘ä»¬ mvn compile æ—¶ï¼Œä¼šåœ¨ç”Ÿæˆä¸€ä¸ªåä¸º <code>spring-configuration-metadata.json</code> JSON æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-14/2019-10-15-11-17-51.png" alt=""></p><p>ç”Ÿæˆçš„å†…å®¹åœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ç”¨åˆ°ï¼Œä¸”çœ‹</p><h4 id="æå‡å¯åŠ¨æ—¶é—´"><a href="#æå‡å¯åŠ¨æ—¶é—´" class="headerlink" title="æå‡å¯åŠ¨æ—¶é—´"></a>æå‡å¯åŠ¨æ—¶é—´</h4><p>å¯¹äºç±»è·¯å¾„ä¸Šçš„æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼ŒSpring Boot å¿…é¡»è®¡ç®— <code>@Conditionalâ€¦</code> æ¡ä»¶å€¼ï¼Œç”¨äºå†³å®šæ˜¯å¦åŠ è½½è‡ªåŠ¨é…ç½®åŠå…¶æ‰€éœ€çš„æ‰€æœ‰ç±»ï¼Œæ ¹æ® Spring å¯åŠ¨åº”ç”¨ç¨‹åºä¸­ starter çš„å¤§å°å’Œæ•°é‡ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸æ˜‚è´µçš„æ“ä½œï¼Œå¹¶ä¸”ä¼šå½±å“å¯åŠ¨æ—¶é—´ï¼Œä¸ºäº†æå‡å¯åŠ¨æ—¶é—´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ pom.xml ä¸­æ·»åŠ å¦å¤–ä¸€ä¸ªä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ³¨è§£ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>spring-autoconfigure-metadata.properties</code> Property æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-14/2019-10-15-11-26-42.png" alt=""></p><p>è¿™æ ·ï¼ŒSpring Boot åœ¨å¯åŠ¨æœŸé—´è¯»å–è¿™äº›å…ƒæ•°æ®ï¼Œå¯ä»¥è¿‡æ»¤å‡ºä¸æ»¡è¶³æ¡ä»¶çš„é…ç½®ï¼Œè€Œä¸å¿…å®é™…æ£€æŸ¥è¿™äº›ç±»ï¼Œæå‡å¯åŠ¨é€Ÿåº¦</p><p>åˆ°è¿™é‡Œå…³äº Auto-Configure Module å°±æ„å»ºå®Œäº†ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­å®Œæˆ Starter Module çš„æ„å»º</p><h3 id="Starter-Module-æ„å»º"><a href="#Starter-Module-æ„å»º" class="headerlink" title="Starter Module æ„å»º"></a>Starter Module æ„å»º</h3><p>Starter Module çš„æ„å»ºå¾ˆç®€å•äº†ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªç©º moduleï¼Œé™¤äº†ä¾èµ– Auto-Configure Moduleï¼Œå…¶å”¯ä¸€ä½œç”¨å°±æ˜¯ä¸ºäº†ä½¿ç”¨ starter åŠŸèƒ½ç‰¹æ€§æä¾›æ‰€æœ‰å¿…é¡»ä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸º starter module çš„ pom.xml æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.dayarch.learnings<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rgyb-spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨æ­¤å¤„æ·»åŠ å…¶ä»–å¿…è¦ä¾èµ–ï¼Œä¿è¯starterå¯ç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·åœ¨ resources ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ <code>META-INF/spring.providers</code> , å…¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">providers</span>: <span class="string">rgyb-spring-boot-autoconfigure</span></span><br></pre></td></tr></table></figure><p>è¯¥æ–‡ä»¶ä¸»è¦ä½œç”¨æ˜¯è¯´æ˜ starter module çš„ä¾èµ–ä¿¡æ¯ï¼Œå¤šä¸ªä¾èµ–ä»¥é€—å·åˆ†éš”å°±å¥½ï¼Œè¯¥æ–‡ä»¶ä¸ä¼šå½±å“ starter çš„ä½¿ç”¨ï¼Œå¯æœ‰å¯æ— </p><p>Starter Module å°±å¯ä»¥è¿™ä¹ˆç®€å•ï¼Œå°†ä¸¤ä¸ª module åˆ†åˆ« mvn install åˆ°æœ¬åœ° Maven Repositoryï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»º sample module å¼•å…¥è¿™ä¸ª starter ä¾èµ–æ—¶å°±ä¼šä»æœ¬åœ° Maven Repository ä¸­æ‹‰å–</p><h2 id="åˆ›å»º-Sample-Module"><a href="#åˆ›å»º-Sample-Module" class="headerlink" title="åˆ›å»º Sample Module"></a>åˆ›å»º Sample Module</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Spring Initializr æ­£å¸¸åˆå§‹åŒ–ä¸€ä¸ª Spring Boot é¡¹ç›® (rgyb-spring-boot-sample)ï¼Œå¼•å…¥æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ starter ä¾èµ–ï¼Œåœ¨ sample pom.xml ä¸­æ·»åŠ ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.dayarch.learnings<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rgyb-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥é…ç½® application.yml å±æ€§</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rgyb:</span></span><br><span class="line"><span class="attr">  greeting:</span></span><br><span class="line"><span class="attr">    enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    members:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">æé›·</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">éŸ©æ¢…æ¢…</span></span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬é…ç½® YAML çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸‹å›¾çš„æç¤ºï¼Œè¿™æ ·ä¼šæ›´å‹å¥½ï¼Œå½“ç„¶ä¸ºäº†è§„èŒƒï¼Œå±æ€§æè¿°æœ€å¥½ä¹Ÿç”¨è‹±æ–‡æè¿°ï¼Œè¿™é‡Œä¸ºäº†è¯´æ˜é—®é¢˜ç”¨äº†ä¸­æ–‡æè¿°:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-14/2019-10-15-11-43-14.png" alt=""></p><h2 id="ç¼–å†™æµ‹è¯•ç±»"><a href="#ç¼–å†™æµ‹è¯•ç±»" class="headerlink" title="ç¼–å†™æµ‹è¯•ç±»"></a>ç¼–å†™æµ‹è¯•ç±»</h2><p>æˆ‘ä»¬ç¼–å†™æµ‹è¯•ç”¨ä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">private</span> GreetingService greetingService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGreeting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    greetingService.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello æé›·</span><br><span class="line">hello éŸ©æ¢…æ¢…</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œå®Œæ•´çš„ starter å¼€å‘å°±ç»“æŸäº†ï¼Œå¸Œæœ›å¤§å®¶äº†è§£å…¶æ„å»ºè¿‡ç¨‹ï¼Œç›®å½•ç»“æ„åŠå‘½åç­‰æ ‡å‡†ï¼Œè¿™æ ·æœ‰ç›¸åº”çš„ä¸šåŠ¡éœ€æ±‚æ—¶éƒ½å¯ä»¥å¼€å‘è‡ªå·±çš„ starter è¢«å…¶ä»–äººåº”ç”¨èµ·æ¥</p><p>starter å¼€å‘å¥½äº†ï¼Œåˆ«äººå¯ä»¥æ‰‹åŠ¨æ·»åŠ ä¾èµ–å¼•å…¥ starter çš„ç›¸å…³åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•åƒ Spring Initializr ä¸€æ ·ï¼Œé€šè¿‡ä¸‹æ¥èœå•é€‰æ‹©æˆ‘ä»¬çš„ starter å‘¢ï¼Œè¿™æ ·ç›´æ¥åˆå§‹åŒ–å¥½æ•´ä¸ªé¡¹ç›®ï¼Œæ¥ä¸‹æ¥çš„æ–‡ç« æˆ‘ä»¬ä¼šæ¨¡ä»¿ Spring Initializr è‡ªå®šä¹‰æˆ‘ä»¬è‡ªçš„ Initializr</p><h2 id="çŸ¥è¯†ç‚¹è¯´æ˜"><a href="#çŸ¥è¯†ç‚¹è¯´æ˜" class="headerlink" title="çŸ¥è¯†ç‚¹è¯´æ˜"></a>çŸ¥è¯†ç‚¹è¯´æ˜</h2><h3 id="Dependency-optinal"><a href="#Dependency-optinal" class="headerlink" title="Dependency optinal"></a>Dependency optinal</h3><blockquote><p>ä¸ºä»€ä¹ˆ Auto-Configure Module çš„ dependency éƒ½æ˜¯ optional = true å‘¢ï¼Ÿ<br>è¿™æ¶‰åŠåˆ° Maven ä¼ é€’æ€§ä¾èµ–çš„é—®é¢˜ï¼Œè¯¦æƒ…è¯·çœ‹ <a href="https://dayarch.top/p/b674819.html">Maven ä¾èµ–ä¼ é€’æ€§é€å½»ç†è§£</a></p></blockquote><h3 id="spring-factories"><a href="#spring-factories" class="headerlink" title="spring.factories"></a>spring.factories</h3><blockquote><p> Spring Boot æ˜¯å¦‚ä½•åŠ è½½è¿™ä¸ªæ–‡ä»¶å¹¶æ‰¾åˆ°æˆ‘ä»¬çš„é…ç½®ç±»çš„<br>ä¸‹å›¾æ˜¯ Spring Boot åº”ç”¨ç¨‹åºå¯åŠ¨çš„è°ƒç”¨æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘æ·»åŠ äº†æ–­ç‚¹:</p></blockquote><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-14/2019-10-15-12-38-42.png" alt=""></p><p>æ‰“å¼€ SpringFactoriesLoader ç±»ï¼Œæ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯è¿™ä¸ªå†…å®¹:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-14/2019-10-15-12-39-32.png" alt=""></p><p>è¿™ä¸¤å¼ å›¾åº”è¯¥è¶³å¤Ÿè¯´æ˜é—®é¢˜äº†ï¼Œæ˜¯ SPI çš„ä¸€ç§åŠ è½½æ–¹å¼ï¼Œæ›´ç»†èŠ‚çš„å†…å®¹è¯·å¤§å®¶è‡ªå·±å»å‘ç°å§</p><h2 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h2><p>è¿™é‡Œæ¨èæŸ¥çœ‹ <a href="https://github.com/mybatis/spring-boot-starter" target="_blank" rel="noopener">mybatis-spring-boot-starter</a> è¿™ä¸ªé Spring å®˜æ–¹çš„æ¡ˆä¾‹ï¼Œä»ä¸­æˆ‘ä»¬:</p><ul><li>æ¨¡ä»¿å…¶ç›®å½•ç»“æ„</li><li>æ¨¡ä»¿å…¶è®¾è®¡ç†å¿µ</li><li>æ¨¡ä»¿å…¶ç¼–ç è§„èŒƒ</li></ul><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-14/2019-10-15-12-51-17.png" alt=""></p><p>å¦å¤–ï¼Œæœ¬æ–‡çš„æ¡ˆä¾‹æˆ‘å·²ä¸Šä¼ ï¼Œå…¬ä¼—å·å›å¤ã€Œdemoã€ï¼Œæ‰“å¼€é“¾æ¥ï¼ŒæŸ¥çœ‹ customstarter ç›®å½•ä¸‹å†…å®¹å³å¯</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>åœ¨ç”Ÿæˆ spring-autoconfigure-metadata.properties æ–‡ä»¶æ—¶ï¼Œä¸ºä»€ä¹ˆ @ConditionalOnProperty çš„å†…å®¹æ²¡æœ‰è¢«å†™è¿›å»</li><li>å¦‚æœæˆ‘ä»¬è¦å°†ä¾èµ–ä¸Šä¼ è‡³ remote central repositoryï¼Œä½ çŸ¥é“æ€æ ·æ­å»ºè‡ªå·±çš„ maven repository å—ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""> </p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ol><li><a href="https://dayarch.top/p/d7e125a1.html">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡</a></li><li><a href="https://dayarch.top/p/86243a5b.html">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a></li><li><a href="https://dayarch.top/p/6d12b8cf.html">å¹¶å‘Bugä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a></li><li><a href="https://dayarch.top/p/815d7647.html">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://dayarch.top/p/32b8e26a.html">è§£å†³åŸå­æ€§é—®é¢˜ï¼Ÿä½ é¦–å…ˆéœ€è¦çš„æ˜¯å®è§‚ç†è§£</a></li><li><a href="https://dayarch.top/p/fb3c7eeb.html">é¢è¯•å¹¶å‘volatileå…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…·å¤‡å“ªäº›è°ˆèµ„ï¼Ÿ</a></li></ol><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº« </li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­” </li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> Starter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven ä¾èµ–ä¼ é€’æ€§é€å½»ç†è§£</title>
      <link href="//p/maven-dependency-optional-transitive.html"/>
      <url>//p/maven-dependency-optional-transitive.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æœ¬æ¥æƒ³å†™ä¸€ç¯‡ã€Œå¦‚ä½•è‡ªå®šä¹‰Spring Boot Starterã€ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½ç†è§£ Starter çš„ä¸€äº›è®¾è®¡ç†å¿µå’Œå…¶ä¸­çš„å…³é”®ç‚¹ï¼Œæ‰€ä»¥æå‰å°†ä¸€äº›ç»†èŠ‚å†…å®¹å•ç‹¬æå–å‡ºæ¥è®²è§£è¯´æ˜</p><p>åœ¨ Maven pom.xml ä¸­ï¼Œä½ ç»å¸¸ä¼šçœ‹åˆ°ä¾èµ–é¡¹ä¸­æœ‰ç±»ä¼¼ä¸‹é¢çš„ä»£ç :</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sample.ProjectA<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Project-A<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>&lt;optional&gt;true&lt;/optional&gt;</code> æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><h2 id="optional-å…³é”®å­—çš„å¥¥ç§˜"><a href="#optional-å…³é”®å­—çš„å¥¥ç§˜" class="headerlink" title="optional å…³é”®å­—çš„å¥¥ç§˜"></a>optional å…³é”®å­—çš„å¥¥ç§˜</h2><p>è€è§„çŸ©ï¼Œç”»ä¸ªå›¾è¯´æ˜é—®é¢˜:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-11/maven%20optional%20%283%29.png" alt=""></p><p>ç”±äº project C ä½¿ç”¨åˆ°äº†ä¸¤ä¸ªæ¥è‡ª project A çš„ç±» (OptionalFeatureAClass) å’Œ project B çš„ç±» (OptionalFeatureBClass). å¦‚æœ project C æ²¡æœ‰ä¾èµ– packageA å’Œ packageBï¼Œé‚£ä¹ˆç¼–è¯‘å°†ä¼šå¤±è´¥ã€‚</p><p>project D ä¾èµ– project Cï¼Œä½†æ˜¯å¯¹äº project D æ¥è¯´ï¼Œç±» (OptionalFeatureAClass) å’Œç±» (OptionalFeatureBClass) <strong>æ˜¯å¯é€‰çš„ç‰¹æ€§</strong>ï¼Œæ‰€ä»¥ä¸ºäº†è®©æœ€ç»ˆçš„ war/ejb package ä¸åŒ…å«ä¸å¿…è¦çš„ä¾èµ–ï¼Œä½¿ç”¨<code>&lt;optional&gt;</code> å£°æ˜å½“å‰ä¾èµ–æ˜¯å¯é€‰çš„, é»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¸ä¼šè¢«å…¶ä»–é¡¹ç›®ç»§æ‰¿(å¥½æ¯” Java ä¸­çš„ final ç±»ï¼Œä¸èƒ½è¢«å…¶ä»–ç±»ç»§æ‰¿ä¸€æ ·)</p><p>å¦‚æœ project D ç¡®å®éœ€è¦ç”¨åˆ° project C ä¸­çš„ OptionalFeatureAClass æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£æˆ‘ä»¬å°±éœ€è¦åœ¨ project D çš„ pom.xml ä¸­æ˜¾å¼çš„æ·»åŠ å£°æ˜ project A ä¾èµ–ï¼Œç»§ç»­çœ‹ä¸‹å›¾:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-11/maven%20optional%202.png" alt=""></p><p>Project D éœ€è¦ç”¨åˆ° Project A çš„ OptionalFeatureAClassï¼Œé‚£ä¹ˆéœ€è¦åœ¨ Project D çš„ pom.xml æ–‡ä»¶ä¸­æ˜¾å¼çš„æ·»åŠ å¯¹ Project A çš„ä¾èµ–</p><p>åˆ°è¿™ä¹Ÿå°±å¾ˆå¥½ç†è§£ä¸ºä»€ä¹ˆ Maven ä¸ºä»€ä¹ˆè¦è®¾è®¡ optional å…³é”®å­—äº†ï¼Œå‡è®¾ä¸€ä¸ªå…³äºæ•°æ®åº“æŒä¹…åŒ–çš„é¡¹ç›®(Project C), ä¸ºäº†é€‚é…æ›´å¤šç±»å‹çš„æ•°æ®åº“æŒä¹…åŒ–è®¾è®¡ï¼Œæ¯”å¦‚ Mysql æŒä¹…åŒ–è®¾è®¡(Project A) å’Œ Oracle æŒä¹…åŒ–è®¾è®¡(Project B)ï¼Œå½“æˆ‘ä»¬çš„é¡¹ç›®(Project D) è¦ç”¨çš„ Project C çš„æŒä¹…åŒ–è®¾è®¡ï¼Œä¸å¯èƒ½æ—¢å¼•å…¥ mysql é©±åŠ¨åˆå¼•å…¥ oracle é©±åŠ¨å§ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ˜¾å¼çš„æŒ‡å®šä¸€ä¸ªï¼Œå°±æ˜¯è¿™ä¸ªé“ç†äº†</p><h2 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h2><p>åœ¨ <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-actuator/1.3.3.RELEASE/spring-boot-actuator-1.3.3.RELEASE.pom" target="_blank" rel="noopener">spring-boot-actuator</a> pom.xml æ–‡ä»¶ä¸­ï¼Œæœ‰è¶…è¿‡ 20 ä¸ªä¾èµ–æ˜¯ optional</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-11/2019-10-11-20-34-58.png" alt=""></p><p>å› ä¸º Spring Boot ä¸å¯èƒ½å°†æ²¡å¿…è¦çš„ä¾èµ–ä¹Ÿæ‰“åŒ…åˆ°ä½ æœ€ç»ˆçš„ jar package ä¸­ï¼Œæ‰€ä»¥ç”¨åˆ° spring boot actuator çš„é¡¹ç›®æœ€ç»ˆç”Ÿæˆçš„ jar package ä¸­ä¸ä¼šåŒ…å«è¿™ 20 å¤šä¸ªä¾èµ– jarï¼Œå¦‚æœä½ è¦ç”¨åˆ°å“ªä¸€ä¸ªï¼Œæ˜¾å¼çš„åŠ å…¥åˆ°ä½ çš„é¡¹ç›®å°±å¥½äº†</p><p>åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ï¼Œè‡ªå®šä¹‰ Spring Boot Starter ä¹Ÿæ˜¯è¿™ä¸ªç­–ç•¥ï¼Œå› ä¸º starter æ˜¯åŒ…å«ç‰¹å®šåŠŸèƒ½ä¸ºå…¶ä»–é¡¹ç›®æœåŠ¡ç”¨çš„ï¼Œç±»ä¼¼æœ¬æ–‡çš„ Project C çš„è§’è‰²äº†ï¼Œåˆ°è¿™é‡Œä½ ç†è§£ optional çš„å¥¥ç§˜äº†å—ï¼Ÿ</p><h2 id="åå‘åº”ç”¨"><a href="#åå‘åº”ç”¨" class="headerlink" title="åå‘åº”ç”¨"></a>åå‘åº”ç”¨</h2><p>å¦‚æœ Project C å¼•å…¥çš„ä¾èµ–æ²¡æœ‰åŠ  <code>&lt;optional&gt;true&lt;/optional&gt;</code>ï¼ŒProject D åˆéœ€è¦ä¾èµ– Project Cï¼Œä½†åªç”¨åˆ° Project A çš„ç±»æ€ä¹ˆåŠå‘¢ï¼ŸMaven ä¹Ÿæ˜¯æœ‰è§£å†³åŠæ³•çš„ï¼Œä½¿ç”¨ exclusion å…³é”®å­—ï¼Œä¸å¤šè¯´ï¼Œä¸Šä¸€æ®µä»£ç å°±æ‡‚äº†:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.dayarch.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Project-C<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.dayarch.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Project-B<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œï¼Œåœ¨ä½ ä»Šåè®¾è®¡åŠŸèƒ½æ€§ä¾èµ–æ—¶ï¼Œä½ åº”è¯¥æ˜ç™½æ€æ ·è®¾è®¡ä¾èµ–å…³ç³»äº†, æˆ‘è¿™é‡Œæ¨èä½¿ç”¨ optional çš„å½¢å¼ï¼Œç®€å•æ¥è¯´ï¼Œä½ è®¾è®¡çš„ä¾èµ–ä»€ä¹ˆèœéƒ½æœ‰ï¼Œæƒ³åƒä»€ä¹ˆèœè‡ªå·± â€œæŠ±è”¡æ˜â€ å°±å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¨¡æ‹Ÿå®˜æ–¹æ ‡å‡†åˆ›å»ºè‡ªå®šä¹‰çš„ starterâ€¦â€¦</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>æœ‰å¾ˆå¤šç«¥é‹é¡¹ç›®ç»„ç”¨çš„æ„å»ºå·¥å…·æ—¶ Gradleï¼Œä½ çŸ¥é“ Gradle ä¸­æ˜¯æ€æ ·è¡¨ç¤ºçš„å—ï¼Ÿ</li><li>è‡ªå®šä¹‰ starterï¼Œä½ çŸ¥é“å®˜æ–¹æ ‡å‡† starter çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å—ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""> </p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ol><li><a href="https://dayarch.top/p/d7e125a1.html">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡</a></li><li><a href="https://dayarch.top/p/86243a5b.html">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a></li><li><a href="https://dayarch.top/p/6d12b8cf.html">å¹¶å‘Bugä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a></li><li><a href="https://dayarch.top/p/815d7647.html">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://dayarch.top/p/32b8e26a.html">è§£å†³åŸå­æ€§é—®é¢˜ï¼Ÿä½ é¦–å…ˆéœ€è¦çš„æ˜¯å®è§‚ç†è§£</a></li><li><a href="https://dayarch.top/p/fb3c7eeb.html">é¢è¯•å¹¶å‘volatileå…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…·å¤‡å“ªäº›è°ˆèµ„ï¼Ÿ</a></li></ol><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº« </li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­” </li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é”ä¿æŠ¤èµ„æºï¼Œsynchronizedæ–¹æ³•å°±å¤Ÿäº†å—</title>
      <link href="//p/java-concurrency-lock-resource.html"/>
      <url>//p/java-concurrency-lock-resource.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://dayarch.top/p/java-concurrency-atomic.html">åŸå­æ€§é—®é¢˜çš„å®è§‚ç†è§£</a> å¸¦é¢†å¤§å®¶äº†è§£äº†é”å’Œèµ„æºçš„æ¨¡å‹ï¼Œæœ‰äº†è¿™ç¯‡æ–‡ç« çš„é“ºå«ï¼Œç›¸ä¿¡ç†è§£è¿™ä¸€ç¯‡æ–‡ç« å°±éå¸¸è½»æ¾äº†</p><p>å½“æˆ‘ä»¬è¦ä¿æŠ¤å•ä¸ªèµ„æºå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹å…¶å®å¾ˆç®€å•ï¼Œåªéœ€æŒ‰ç…§ä¸‹å›¾åˆ†ä¸‰æ­¥èµ°</p><ol><li>åˆ›å»ºå—ä¿æŠ¤èµ„æº R çš„é”</li><li>åŠ é”è¿›å…¥ä¸´ç•ŒåŒº</li><li>è§£é”èµ°å‡ºä¸´ç•ŒåŒº</li></ol><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-09/%E5%8D%95%E4%B8%AA%E8%B5%84%E6%BA%90%E9%94%81%E6%A8%A1%E5%9E%8B.png" alt=""></p><p><strong>ä¸Šå›¾çš„å…³é”®æ˜¯ã€ŒR1 çš„é”ä¿æŠ¤ R1ã€çš„æŒ‡å‘å…³ç³»æ˜¯å¦æ­£ç¡®</strong></p><p>å¦‚æœéƒ½æ˜¯ä¿æŠ¤å•ä¸ªèµ„æºè¿™æ ·ç®€å•ï¼Œç¨‹åºçŒ¿çš„ä¸–ç•Œè¯¥æœ‰å¤šç¾å¥½ï¼Œå¯æƒœå¹¶ä¸æ˜¯ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦ä¿æŠ¤å¤šä¸ªèµ„æº</p><h2 id="ä¿æŠ¤å¤šä¸ªèµ„æº"><a href="#ä¿æŠ¤å¤šä¸ªèµ„æº" class="headerlink" title="ä¿æŠ¤å¤šä¸ªèµ„æº"></a>ä¿æŠ¤å¤šä¸ªèµ„æº</h2><h3 id="ä¿æŠ¤å¤šä¸ªæ²¡æœ‰å…³ç³»çš„èµ„æº"><a href="#ä¿æŠ¤å¤šä¸ªæ²¡æœ‰å…³ç³»çš„èµ„æº" class="headerlink" title="ä¿æŠ¤å¤šä¸ªæ²¡æœ‰å…³ç³»çš„èµ„æº"></a>ä¿æŠ¤å¤šä¸ªæ²¡æœ‰å…³ç³»çš„èµ„æº</h3><p>å¦‚æœå¤šä¸ªèµ„æºæ²¡æœ‰å…³ç³»ï¼Œé‚£å°±æ˜¯ä¿æŠ¤ä¸€ä¸ªèµ„æºæ¨¡å‹çš„å¤åˆ¶ï¼ŒåŒæ ·éå¸¸ç®€å•ï¼Œä¸”çœ‹ä¸‹å›¾:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-09/%E5%A4%9A%E4%B8%AA%E6%97%A0%E5%85%B3%E8%81%94%E8%B5%84%E6%BA%90%E9%94%81%E6%A8%A1%E5%9E%8B.png" alt=""></p><blockquote><p>æ¯”å¦‚ç°å®ä¸­é“¶è¡Œå–æ¬¾å’Œä¿®æ”¹å¯†ç æ“ä½œã€‚<br>é“¶è¡Œå–æ¬¾æ“ä½œå¯¹åº”çš„èµ„æºæ˜¯ã€Œä½™é¢ã€, ä¿®æ”¹å¯†ç æ“ä½œå¯¹åº”çš„èµ„æºæ˜¯ã€Œå¯†ç ã€ï¼Œä½™é¢å’Œå¯†ç ä¸¤ä¸ªèµ„æºå®Œå…¨æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥å„è‡ªç”¨è‡ªå®¶çš„é”ä¿æŠ¤è‡ªå®¶çš„èµ„æºå°±å¥½äº†</p></blockquote><p>å¦‚æœå¤šä¸ªèµ„æºæ²¡æœ‰å…³ç³»ï¼Œç¨‹åºçŒ¿çš„ä¸–ç•Œè¯¥æœ‰å¤šç¾å¥½ï¼Œå¯æƒœå¹¶ä¸æ˜¯ï¼Œæˆ‘ä»¬ä¿æŠ¤çš„èµ„æºå¤šæ•°æƒ…å†µéƒ½æœ‰å…³è”å…³ç³»</p><h3 id="ä¿æŠ¤å¤šä¸ªå…³ç³»çš„èµ„æº"><a href="#ä¿æŠ¤å¤šä¸ªå…³ç³»çš„èµ„æº" class="headerlink" title="ä¿æŠ¤å¤šä¸ªå…³ç³»çš„èµ„æº"></a>ä¿æŠ¤å¤šä¸ªå…³ç³»çš„èµ„æº</h3><p>æ‹¿ç»å…¸çš„é“¶è¡Œè½¬è´¦æ¡ˆä¾‹æ¥è¯´æ˜ï¼Œè´¦æˆ· A ç»™è´¦æˆ· B è½¬è´¦ï¼Œè´¦æˆ· A ä½™é¢å‡å°‘ 100 å…ƒï¼Œè´¦æˆ· B ä½™é¢å¢åŠ  100 å…ƒï¼Œè¿™ä¸ªæ“ä½œè¦æ˜¯åŸå­æ€§çš„ï¼Œé‚£ä¹ˆèµ„æºã€ŒA ä½™é¢ã€å’Œèµ„æºã€ŒB ä½™é¢ã€å°±è¿™æ ·â€æœ‰äº†å…³ç³»â€ï¼Œå…ˆæ¥çœ‹ç¨‹åº:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line">  <span class="comment">// è½¬è´¦</span></span><br><span class="line">  <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      Account target, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amt) &#123;</span><br><span class="line">      <span class="keyword">this</span>.balance -= amt;</span><br><span class="line">      target.balance += amt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ synchronized ç›´æ¥ä¿æŠ¤ transfer æ–¹æ³•ï¼Œç„¶åæ“ä½œèµ„æºã€ŒA ä½™é¢ã€å’Œèµ„æºã€ŒB ä½™é¢ã€å°±å¯ä»¥äº†</p><p>âš ï¸: çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ</p><p>å…ˆåœæ­¢å‘ä¸‹çœ‹ï¼Œåœ¨ä½ çš„ç¬”è®°æœ¬ä¸ŠæŒ‰ç…§æ–‡ç« å¼€å¤´çš„ä¸‰æ­¥èµ°æ¥ç”»ä¸ªå›¾çœ‹ä¸€çœ‹ï¼Œæ˜¯å¦å’Œä¸‹å›¾ä¸€æ ·å‘¢ï¼Ÿ</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-09/%E5%A4%9A%E8%B5%84%E6%BA%90%E6%9C%89%E5%85%B3%E7%B3%BB.png" alt=""></p><p><strong>æˆ‘ä»¬é€šå¸¸å®¹æ˜“å¿½ç•¥é”å’Œèµ„æºçš„æŒ‡å‘å…³ç³»</strong>ï¼Œæˆ‘ä»¬æƒ³å½“ç„¶çš„ç”¨é” this æ¥ä¿æŠ¤ target èµ„æºäº†ï¼Œä¹Ÿå°±æ²¡æœ‰èµ·åˆ°ä¿æŠ¤ä½œç”¨</p><blockquote><p> å‡è®¾ Aï¼ŒBï¼ŒC è´¦æˆ·åˆå§‹ä½™é¢éƒ½æ˜¯ 200 åŸï¼ŒA å‘ B è½¬è´¦ 100ï¼ŒB å‘ C è½¬è´¦ 100</p></blockquote><p><strong>æˆ‘ä»¬æœŸç›¼æœ€ç»ˆçš„ç»“æœæ˜¯:</strong><br>è´¦æˆ· A ä½™é¢: 100 å…ƒ<br>è´¦æˆ· B ä½™é¢: 200 å…ƒ<br>è´¦æˆ· C ä½™é¢: 300 å…ƒ</p><p>å‡çº¿ç¨‹ 1ã€ŒA å‘ B è½¬è´¦ã€ä¸çº¿ç¨‹ 2ã€ŒB å‘ C è½¬è´¦ã€ä¸¤ä¸ªæ“ä½œåŒæ—¶æ‰§è¡Œï¼Œæ ¹æ® JMM æ¨¡å‹å¯çŸ¥ï¼Œçº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 è¯»å–çº¿ç¨‹ B å½“å‰çš„ä½™é¢éƒ½æ˜¯ 200 å…ƒ:</p><ul><li>çº¿ç¨‹ 1 æ‰§è¡Œ transfer æ–¹æ³•é”å®šçš„æ˜¯ A çš„å®ä¾‹(A.this)ï¼Œ<strong>å¹¶æ²¡æœ‰é”å®š B çš„å®ä¾‹</strong></li><li>çº¿ç¨‹ 2 æ‰§è¡Œ transfer æ–¹æ³•é”å®šçš„æ˜¯ B çš„å®ä¾‹(B.this)ï¼Œå¹¶æ²¡æœ‰é”å®š C çš„å®ä¾‹</li></ul><p>æ‰€ä»¥çº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 å¯ä»¥åŒæ—¶è¿›å…¥ transfer ä¸´ç•ŒåŒºï¼Œä¸Šé¢ä½ è®¤ä¸ºå¯¹çš„æ¨¡å‹å…¶å®å°±ä¼šå˜æˆè¿™ä¸ªæ ·å­:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-09/%E9%93%B6%E8%A1%8C%E8%BD%AC%E8%B4%A61.png" alt=""></p><p>è¿˜è®°å¾— <a href="https://dayarch.top/p/815d7647.html">happens-before è§„åˆ™</a> è¿™ç¯‡æ–‡ç« æåˆ°çš„<strong>ç›‘è§†å™¨é”è§„åˆ™</strong>å’Œ<strong>ä¼ é€’æ€§è§„åˆ™</strong>å—ï¼Ÿ</p><blockquote><h4 id="ç›‘è§†å™¨é”è§„åˆ™"><a href="#ç›‘è§†å™¨é”è§„åˆ™" class="headerlink" title="ç›‘è§†å™¨é”è§„åˆ™"></a>ç›‘è§†å™¨é”è§„åˆ™</h4><p> å¯¹ä¸€ä¸ªé”çš„è§£é” happens-before äºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”</p><h4 id="ä¼ é€’æ€§è§„åˆ™"><a href="#ä¼ é€’æ€§è§„åˆ™" class="headerlink" title="ä¼ é€’æ€§è§„åˆ™"></a>ä¼ é€’æ€§è§„åˆ™</h4><p>å¦‚æœ A happens-before B, ä¸” B happens-before C, é‚£ä¹ˆ A happens-before C</p></blockquote><p><strong>èµ„æº B.balance å­˜åœ¨äºä¸¤ä¸ªâ€ä¸´ç•ŒåŒºâ€ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªâ€ä¸´ç•ŒåŒºâ€å¯¹ B.balance æ¥è¯´å½¢åŒè™šè®¾ï¼Œä¹Ÿå°±ä¸æ»¡è¶³ç›‘è§†å™¨é”è§„åˆ™ï¼Œè¿›è€Œå¯¼è‡´ä¼ é€’æ€§è§„åˆ™ä¹Ÿä¸ç”Ÿæ•ˆï¼Œè¯´ç™½äº†ï¼Œå‰åºçº¿ç¨‹çš„æ›´æ”¹ç»“æœå¯¹åä¸€ä¸ªçº¿ç¨‹ä¸å¯è§</strong></p><p>è¿™æ ·æœ€ç»ˆå¯¼è‡´:</p><ul><li><p><strong>è´¦æˆ· B çš„ä½™é¢å¯èƒ½æ˜¯ 100:</strong> çº¿ç¨‹ 1 å†™ B.balance 100(balance = 300) <strong>å…ˆäº</strong> çº¿ç¨‹ 2 å†™ B.balance(balance = 100)ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ 1 çš„ç»“æœä¼šè¢«çº¿ç¨‹ 2 è¦†ç›–ï¼Œå¯¼è‡´æœ€ç»ˆè´¦æˆ· B çš„ä½™é¢ä¸º 100</p></li><li><p><strong>è´¦æˆ· B çš„ä½™é¢å¯èƒ½æ˜¯ 300:</strong> ä¸ä¸Šè¿°æƒ…å†µç›¸åï¼Œçº¿ç¨‹ 1 å†™ B.balance 100(balance = 300) <strong>åäº</strong> çº¿ç¨‹ 2 å†™ B.balance(balance = 100)ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ 2 çš„ç»“æœçº¿ç¨‹ 1 è¦†ç›–ï¼Œå¯¼è‡´æœ€ç»ˆè´¦æˆ· B çš„ä½™é¢ä¸º 300</p></li></ul><p>å°±æ˜¯ä¸èƒ½å¾—åˆ°æˆ‘ä»¬ç†æƒ³ç»“æœ 200ï¼Œæ„Ÿè§‰ç”Ÿæ´»æ— æ¯”çš„è‰°éš¾ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h2 id="æ­£ç¡®å§¿åŠ¿"><a href="#æ­£ç¡®å§¿åŠ¿" class="headerlink" title="æ­£ç¡®å§¿åŠ¿"></a>æ­£ç¡®å§¿åŠ¿</h2><p>ä¸Šé¢çš„é—®é¢˜å°±æ˜¯ä¸ºèµ„æºåˆ›å»ºçš„é”ä¸èƒ½ä¿æŠ¤æ‰€æœ‰å…³è”çš„èµ„æºï¼Œé‚£æˆ‘ä»¬å°±æƒ³åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¥çœ‹ä¸‹é¢ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line">  <span class="comment">// è½¬è´¦</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Account target, <span class="keyword">int</span> amt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(Account.class) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amt) &#123;</span><br><span class="line">        <span class="keyword">this</span>.balance -= amt;</span><br><span class="line">        target.balance += amt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°† this é”å˜ä¸º Account.class é”ï¼ŒAccount.class æ˜¯è™šæ‹ŸæœºåŠ è½½ Account ç±»æ—¶åˆ›å»ºçš„ï¼Œè‚¯å®šæ˜¯å”¯ä¸€çš„(<a href="https://dayarch.top/p/java-parents-delegation-model.html">åŒäº²å§”æ´¾æ¨¡å‹è§£é‡Šäº†ä¸ºä½•è¯¥å¯¹è±¡æ˜¯å”¯ä¸€çš„</a>)ï¼Œ æ‰€æœ‰ Account å¯¹è±¡éƒ½å…±äº« Account.class, ä¹Ÿå°±æ˜¯è¯´ï¼ŒAccount.class é”èƒ½ä¿æŠ¤æ‰€æœ‰ Account å¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä¸Šé¢ç¨‹åºå†ç”¨æ¨¡å‹è§£é‡Šä¸€ä¸‹</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-10-09/%E9%93%B6%E8%A1%8C%E8%BD%AC%E8%B4%A62.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œå…³äºé”å’Œèµ„æºçš„å…³ç³»ä½ åº”è¯¥äº†è§£çš„æ›´åŠ é€å½»äº†ï¼Œå•ä¸ªèµ„æºå’Œå¤šä¸ªæ— å…³è”èµ„æºçš„æƒ…å½¢éƒ½å¾ˆå¥½å¤„ç†ï¼Œä¸ºå„è‡ªèµ„æºåˆ›å»ºç›¸åº”çš„é”å°±å¥½ï¼Œå¦‚æœå¤šä¸ªèµ„æºæœ‰å…³è”ï¼Œä¸ºäº†è®©é”èµ·åˆ°ä¿æŠ¤ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°†é”çš„ç²’åº¦å˜å¤§ï¼Œæ¯”å¦‚å°† this é”å˜æˆäº† Account.class é”ã€‚</p><p>è½¬è´¦ä¸šåŠ¡éå¸¸å¸¸è§ï¼Œå¹¶å‘é‡éå¸¸å¤§ï¼Œå¦‚æœæˆ‘ä»¬å°†é”çš„ç²’åº¦éƒ½æå‡åˆ° Account.class è¿™ä¸ªçº§åˆ«(åˆ†ä¹…å¿…åˆ)ï¼Œå‡è®¾æ¯æ¬¡è½¬è´¦ä¸šåŠ¡éƒ½å¾ˆè€—æ—¶ï¼Œé‚£ä¹ˆæ˜¾ç„¶è¿™ä¸ªé”çš„æ€§èƒ½æ˜¯æ¯”è¾ƒä½çš„ï¼Œ<strong>æ‰€ä»¥æ¥ä¸‹æ¥çš„æ–‡ç« ï¼Œæˆ‘ä»¬è¿˜ä¼šç»§ç»­ä¼˜åŒ–è¿™ä¸ªæ¨¡å‹ï¼Œé€‰æ‹©åˆé€‚çš„é”ç²’åº¦ï¼ŒåŒæ—¶èƒ½ä¿æŠ¤å¤šä¸ªæœ‰å…³è”çš„èµ„æº</strong>ï¼Œ</p><p>æˆ‘ä»¬çš„é”ç²’åº¦è™½ç„¶å¤§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¿éšœäº†è´¦æˆ·çš„å®‰å…¨ï¼Œæ‰€ä»¥å¹¶å‘ç¼–ç¨‹å¯ä»¥å…ˆä¿è¯äº‹æƒ…åšå¯¹ï¼Œé‡åˆ°ç“¶é¢ˆäº†ï¼Œæ…¢æ…¢ä¼˜åŒ–æ”¹å˜ç›¸åº”çš„æ¨¡å‹å°±å¥½äº†ï¼Œå½“ç„¶ç†Ÿç»ƒç†è§£è¿™ä¸ªæ¨¡å‹ä»¥åï¼Œä¸€æ­¥åˆ°ä½çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹å½“ç„¶æ˜¯æå¥½çš„â€¦â€¦</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>è¿˜è®°å¾— happens-before çš„å‡ ä¸ªåŸåˆ™å—ï¼Ÿ</li><li>åå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”æ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬è¿™èŠ‚å†…å®¹æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„å‘¢ï¼Ÿ</li><li>æå‰æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•æ¥ä¼˜åŒ–è¿™ä¸ªæ¨¡å‹å‘¢ï¼Ÿ </li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EasyExcelè¯»å–Excelå®é™…åº”ç”¨</title>
      <link href="//p/easyexcel-read.html"/>
      <url>//p/easyexcel-read.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>Java åç«¯ç¨‹åºå‘˜åº”è¯¥ä¼šé‡åˆ°è¯»å– Excel ä¿¡æ¯åˆ° DB ç­‰ç›¸å…³éœ€æ±‚ï¼Œè„‘æµ·ä¸­å¯èƒ½çªç„¶é—´æƒ³èµ· Apache POI è¿™ä¸ªæŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å½“ Excel çš„æ•°æ®é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œä½ ä¹Ÿè®¸å‘ç°ï¼ŒPOI æ˜¯å°†æ•´ä¸ª Excel çš„å†…å®¹å…¨éƒ¨è¯»å‡ºæ¥æ”¾å…¥åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥å†…å­˜æ¶ˆè€—éå¸¸ä¸¥é‡ï¼Œå¦‚æœåŒæ—¶è¿›è¡ŒåŒ…å«å¤§æ•°æ®é‡çš„ Excel è¯»æ“ä½œï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æº¢å‡ºé—®é¢˜</p><p>ä½† EasyExcel çš„å‡ºç°å¾ˆå¥½çš„è§£å†³äº† POI ç›¸å…³é—®é¢˜ï¼ŒåŸæœ¬ä¸€ä¸ª 3M çš„ Excel ç”¨ POI éœ€è¦100Må·¦å³å†…å­˜, è€Œ EasyExcel å¯ä»¥å°†å…¶é™ä½åˆ°å‡  Mï¼ŒåŒæ—¶å†å¤§çš„ Excel éƒ½ä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œå› ä¸ºæ˜¯é€è¡Œè¯»å– Excel çš„å†…å®¹ (è€è§„çŸ©ï¼Œè¿™é‡Œä¸ç”¨è¿‡åˆ†å…³å¿ƒä¸‹å›¾ï¼Œè„‘æµ·ä¸­æœ‰ä¸ªå°è±¡å³å¯ï¼Œçœ‹å®Œä¸‹é¢çš„ç”¨ä¾‹å†å›çœ‹è¿™ä¸ªå›¾ï¼Œå°±å¾ˆç®€å•äº†)</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-17-09-51.jpg" alt=""></p><p>å¦å¤– EasyExcel åœ¨ä¸Šå±‚åšäº†æ¨¡å‹è½¬æ¢çš„å°è£…ï¼Œä¸éœ€è¦ cell ç­‰ç›¸å…³æ“ä½œï¼Œè®©ä½¿ç”¨è€…æ›´åŠ ç®€å•å’Œæ–¹ä¾¿ï¼Œä¸”çœ‹</p><h2 id="ç®€å•è¯»"><a href="#ç®€å•è¯»" class="headerlink" title="ç®€å•è¯»"></a>ç®€å•è¯»</h2><p>å‡è®¾æˆ‘ä»¬ excel ä¸­æœ‰ä»¥ä¸‹å†…å®¹:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-09-09-50.png" alt=""></p><p>æˆ‘ä»¬éœ€è¦æ–°å»º User å®ä½“ï¼ŒåŒæ—¶ä¸ºå…¶æ·»åŠ æˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å§“å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExcelProperty</span>(index = <span class="number">0</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¹´é¾„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExcelProperty</span>(index = <span class="number">1</span>)</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿè®¸å…³æ³¨åˆ°äº† <code>@ExcelProperty</code> æ³¨è§£ï¼ŒåŒæ—¶ä½¿ç”¨äº† index å±æ€§ (0 ä»£è¡¨ç¬¬ä¸€åˆ—ï¼Œä»¥æ­¤ç±»æ¨)ï¼Œè¯¥æ³¨è§£åŒæ—¶æ”¯æŒä»¥ã€Œåˆ—åã€name çš„æ–¹å¼åŒ¹é…ï¼Œæ¯”å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExcelProperty</span>(<span class="string">"å§“å"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ github æ–‡æ¡£çš„è¯´æ˜:</p><blockquote><p> ä¸å»ºè®® index å’Œ name åŒæ—¶ç”¨ï¼Œè¦ä¹ˆä¸€ä¸ªå¯¹è±¡åªç”¨indexï¼Œè¦ä¹ˆä¸€ä¸ªå¯¹è±¡åªç”¨nameå»åŒ¹é…</p></blockquote><ol><li>å¦‚æœè¯»å–çš„ Excel æ¨¡æ¿ä¿¡æ¯åˆ—å›ºå®šï¼Œè¿™é‡Œå»ºè®®ä»¥ index çš„å½¢å¼ä½¿ç”¨ï¼Œå› ä¸ºå¦‚æœç”¨åå­—å»åŒ¹é…ï¼Œåå­—é‡å¤ï¼Œä¼šå¯¼è‡´åªæœ‰ä¸€ä¸ªå­—æ®µè¯»å–åˆ°æ•°æ®ï¼Œæ‰€ä»¥ index æ˜¯æ›´ç¨³å¦¥çš„æ–¹å¼</li><li>å¦‚æœ Excel æ¨¡æ¿çš„åˆ— index ç»å¸¸æœ‰å˜åŒ–ï¼Œé‚£è¿˜æ˜¯é€‰æ‹© name æ–¹å¼æ¯”è¾ƒå¥½ï¼Œä¸ç”¨ç»å¸¸æ€§ä¿®æ”¹å®ä½“çš„æ³¨è§£ index æ•°å€¼</li></ol><p>æ‰€ä»¥å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µè‡ªè¡Œé€‰æ‹©</p><p>ç¼–å†™æµ‹è¯•ç”¨ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExcel</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String fileName = TestUtils.getPath() + <span class="string">"excel"</span> + File.separator + <span class="string">"users1.xlsx"</span>;</span><br><span class="line">    EasyExcel.read(fileName, User.class, <span class="keyword">new</span> UserExcelListener()).sheet().doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EasyExcel ç±»ä¸­é‡è½½äº†å¾ˆå¤šä¸ª read æ–¹æ³•ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾è¯´æ˜ï¼Œè¯·å¤§å®¶è‡ªè¡ŒæŸ¥çœ‹ï¼›åŒæ—¶ sheet æ–¹æ³•ä¹Ÿå¯ä»¥æŒ‡å®š sheetNoï¼Œé»˜è®¤æ˜¯ç¬¬ä¸€ä¸ª sheet çš„ä¿¡æ¯</p><p>ä¸Šé¢ä»£ç çš„ <code>new UserExcelListener()</code> å¼‚å¸¸é†’ç›®ï¼Œè¿™ä¹Ÿæ˜¯ EasyExcel é€è¡Œè¯»å– Excel å†…å®¹çš„å…³é”®æ‰€åœ¨ï¼Œè‡ªå®šä¹‰ <code>UserExcelListener</code> ç»§æ‰¿ <code>AnalysisEventListener</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserExcelListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹å¤„ç†é˜ˆå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_COUNT = <span class="number">2</span>;</span><br><span class="line">List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;(BATCH_COUNT);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(User user, AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">log.info(<span class="string">"è§£æåˆ°ä¸€æ¡æ•°æ®:&#123;&#125;"</span>, JSON.toJSONString(user));</span><br><span class="line">list.add(user);</span><br><span class="line"><span class="keyword">if</span> (list.size() &gt;= BATCH_COUNT) &#123;</span><br><span class="line">saveData();</span><br><span class="line">list.clear();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">saveData();</span><br><span class="line">log.info(<span class="string">"æ‰€æœ‰æ•°æ®è§£æå®Œæˆï¼"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveData</span><span class="params">()</span></span>&#123;</span><br><span class="line">log.info(<span class="string">"&#123;&#125;æ¡æ•°æ®ï¼Œå¼€å§‹å­˜å‚¨æ•°æ®åº“ï¼"</span>, list.size());</span><br><span class="line">log.info(<span class="string">"å­˜å‚¨æ•°æ®åº“æˆåŠŸï¼"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œè¯·å›çœ‹æ–‡ç« å¼€å¤´çš„ EasyExcel åŸç†å›¾ï¼Œinvoke  æ–¹æ³•é€è¡Œè¯»å–æ•°æ®ï¼Œå¯¹åº”çš„å°±æ˜¯è®¢é˜…è€… 1ï¼›doAfterAllAnalysed æ–¹æ³•å¯¹åº”çš„å°±æ˜¯è®¢é˜…è€… 2ï¼Œè¿™æ ·ä½ ç†è§£äº†å—ï¼Ÿ</p><p>æ‰“å°ç»“æœ:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-15-56-41.png" alt=""></p><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æ˜¯é€è¡Œè§£ææ•°æ®ï¼Œä½†æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰é˜ˆå€¼ï¼Œå®Œæˆæ•°æ®çš„æ‰¹å¤„ç†æ“ä½œï¼Œå¯è§ EasyExcel æ“ä½œçš„çµæ´»æ€§</p><h2 id="è‡ªå®šä¹‰è½¬æ¢å™¨"><a href="#è‡ªå®šä¹‰è½¬æ¢å™¨" class="headerlink" title="è‡ªå®šä¹‰è½¬æ¢å™¨"></a>è‡ªå®šä¹‰è½¬æ¢å™¨</h2><p>è¿™æ˜¯æœ€åŸºæœ¬çš„æ•°æ®è¯»å†™ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡æ•°æ®é€šå¸¸ä¸å¯èƒ½è¿™ä¹ˆç®€å•ï¼Œæœ‰æ—¶ç”šè‡³éœ€è¦å°†å…¶è½¬æ¢ä¸ºç¨‹åºå¯è¯»çš„æ•°æ®</p><h3 id="æ€§åˆ«ä¿¡æ¯è½¬æ¢"><a href="#æ€§åˆ«ä¿¡æ¯è½¬æ¢" class="headerlink" title="æ€§åˆ«ä¿¡æ¯è½¬æ¢"></a>æ€§åˆ«ä¿¡æ¯è½¬æ¢</h3><p>æ¯”å¦‚ Excel ä¸­æ–°å¢ã€Œæ€§åˆ«ã€åˆ—ï¼Œå…¶æ€§åˆ«ä¸ºç”·/å¥³ï¼Œæˆ‘ä»¬éœ€è¦å°† Excel ä¸­çš„æ€§åˆ«ä¿¡æ¯è½¬æ¢æˆç¨‹åºä¿¡æ¯: ã€Œ1: ç”·ï¼›2:å¥³ã€</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-16-04-49.png" alt=""></p><p>é¦–å…ˆåœ¨ User å®ä½“ä¸­æ·»åŠ æˆå‘˜å˜é‡ gender:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExcelProperty</span>(index = <span class="number">2</span>)</span><br><span class="line"><span class="keyword">private</span> Integer gender;</span><br></pre></td></tr></table></figure><p>EasyExcel æ”¯æŒæˆ‘ä»¬è‡ªå®šä¹‰ converterï¼Œå°† excel çš„å†…å®¹è½¬æ¢ä¸ºæˆ‘ä»¬ç¨‹åºéœ€è¦çš„ä¿¡æ¯ï¼Œè¿™é‡Œæ–°å»º GenderConverterï¼Œç”¨æ¥è½¬æ¢æ€§åˆ«ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenderConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MALE = <span class="string">"ç”·"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FEMALE = <span class="string">"å¥³"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class <span class="title">supportJavaTypeKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Integer.class;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CellDataTypeEnum <span class="title">supportExcelTypeKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> CellDataTypeEnum.STRING;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">convertToJavaData</span><span class="params">(CellData cellData, ExcelContentProperty excelContentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">String stringValue = cellData.getStringValue();</span><br><span class="line"><span class="keyword">if</span> (MALE.equals(stringValue))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CellData <span class="title">convertToExcelData</span><span class="params">(Integer integer, ExcelContentProperty excelContentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> ä¸Šé¢ç¨‹åºçš„ Converter æ¥å£çš„æ³›å‹æ˜¯æŒ‡è¦è½¬æ¢çš„ Java æ•°æ®ç±»å‹ï¼Œä¸ supportJavaTypeKey æ–¹æ³•ä¸­çš„è¿”å›å€¼ç±»å‹ä¸€è‡´</p></blockquote><p>æ‰“å¼€æ³¨è§£ <code>@ExcelProperty</code> æŸ¥çœ‹ï¼Œè¯¥æ³¨è§£æ˜¯æ”¯æŒè‡ªå®šä¹‰ Converter çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸º User å®ä½“æ·»åŠ  <strong>gender</strong> æˆå‘˜å˜é‡ï¼Œå¹¶æŒ‡å®š converter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ€§åˆ« 1ï¼šç”·ï¼›2ï¼šå¥³</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExcelProperty</span>(index = <span class="number">2</span>, converter = GenderConverter.class)</span><br><span class="line"><span class="keyword">private</span> Integer gender;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹è¿è¡Œç»“æœ:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-16-09-14.png" alt=""></p><p>æ•°æ®æŒ‰ç…§æˆ‘ä»¬é¢„æœŸåšå‡ºäº†è½¬æ¢ï¼Œä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒConverter å¯ä»¥ä¸€æ¬¡å®šä¹‰åˆ°å¤„æ˜¯ç”¨çš„ä¾¿åˆ©æ€§</p><h3 id="æ—¥æœŸä¿¡æ¯è½¬æ¢"><a href="#æ—¥æœŸä¿¡æ¯è½¬æ¢" class="headerlink" title="æ—¥æœŸä¿¡æ¯è½¬æ¢"></a>æ—¥æœŸä¿¡æ¯è½¬æ¢</h3><p>æ—¥æœŸä¿¡æ¯ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è§çš„è½¬æ¢æ•°æ®ï¼Œæ¯”å¦‚ Excel ä¸­æ–°å¢ã€Œå‡ºç”Ÿå¹´æœˆã€åˆ—ï¼Œæˆ‘ä»¬è¦è§£ææˆ <strong>yyyy-MM-dd</strong> æ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼ŒEasyExcel é€šè¿‡ <code>@DateTimeFormat</code> æ³¨è§£è¿›è¡Œæ ¼å¼åŒ–</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-16-11-16.png" alt=""></p><p>åœ¨ User å®ä½“ä¸­æ·»åŠ æˆå‘˜å˜é‡ <strong>birth</strong>ï¼ŒåŒæ—¶åº”ç”¨ <code>@DateTimeFormat</code> æ³¨è§£ï¼ŒæŒ‰ç…§è¦æ±‚åšæ ¼å¼åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡ºç”Ÿæ—¥æœŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExcelProperty</span>(index = <span class="number">3</span>)</span><br><span class="line"><span class="meta">@DateTimeFormat</span>(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line"><span class="keyword">private</span> String birth;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹è¿è¡Œç»“æœ:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-16-13-08.png" alt=""></p><p>å¦‚æœè¿™é‡Œä½ æŒ‡å®š birth çš„ç±»å‹ä¸º Dateï¼Œè¯•è¯•çœ‹ï¼Œä½ å¾—åˆ°çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>åˆ°è¿™é‡Œéƒ½æ˜¯ä»¥æµ‹è¯•çš„æ–¹å¼æ¥ç¼–å†™ç¨‹åºä»£ç ï¼Œä½œä¸º Java Web å¼€å‘äººå‘˜ï¼Œå°¤å…¶åœ¨ç›®å‰ä¸»æµ Spring Boot çš„æ¶æ„ä¸‹ï¼Œæ‰€ä»¥å¦‚ä½•å®ç° Web æ–¹å¼è¯»å– Excel çš„ä¿¡æ¯å‘¢ï¼Ÿ</p><h2 id="web-è¯»"><a href="#web-è¯»" class="headerlink" title="web è¯»"></a>web è¯»</h2><h3 id="ç®€å•-Web"><a href="#ç®€å•-Web" class="headerlink" title="ç®€å• Web"></a>ç®€å• Web</h3><p>å¾ˆç®€å•ï¼Œåªæ˜¯å°†æµ‹è¯•ç”¨ä¾‹çš„å…³é”®ä»£ç ç§»åŠ¨åˆ° Controller ä¸­å³å¯ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª <code>UserController</code>ï¼Œåœ¨å…¶æ·»åŠ  <code>upload</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/upload"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">EasyExcel.read(file.getInputStream(), User.class, <span class="keyword">new</span> UserExcelListener()).sheet().doRead();</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®åœ¨å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ä½ ä¹Ÿè®¸å·²ç»å‘ç°ï¼Œlistener æ˜¯ä»¥ new çš„å½¢å¼ä½œä¸ºå‚æ•°ä¼ å…¥åˆ° EasyExcel.read æ–¹æ³•ä¸­çš„ï¼Œè¿™æ˜¯ä¸ç¬¦åˆ Spring IoC çš„è§„åˆ™çš„ï¼Œæˆ‘ä»¬é€šå¸¸è¯»å– Excel æ•°æ®ä¹‹åéƒ½è¦é’ˆå¯¹è¯»å–çš„æ•°æ®ç¼–å†™ä¸€äº›ä¸šåŠ¡é€»è¾‘çš„ï¼Œè€Œä¸šåŠ¡é€»è¾‘é€šå¸¸åˆä¼šå†™åœ¨ Service å±‚ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ listener ä¸­è°ƒç”¨åˆ°æˆ‘ä»¬çš„ service ä»£ç å‘¢ï¼Ÿ</p><p>*<em>å…ˆä¸è¦å‘ä¸‹çœ‹ï¼Œä½ è„‘æµ·ä¸­æœ‰å“ªäº›æ–¹æ¡ˆå‘¢ï¼Ÿ *</em></p><h3 id="åŒ¿åå†…éƒ¨ç±»æ–¹å¼"><a href="#åŒ¿åå†…éƒ¨ç±»æ–¹å¼" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»æ–¹å¼"></a>åŒ¿åå†…éƒ¨ç±»æ–¹å¼</h3><p>åŒ¿åå†…éƒ¨ç±»æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ–°å»º Service å±‚çš„ä¿¡æ¯:<br>æ–°å»º IUser æ¥å£:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUser</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveData</span><span class="params">(List&lt;User&gt; users)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º IUser æ¥å£å®ç°ç±» UserServiceImpl:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUser</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveData</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">log.info(<span class="string">"UserService &#123;&#125;æ¡æ•°æ®ï¼Œå¼€å§‹å­˜å‚¨æ•°æ®åº“ï¼"</span>, users.size());</span><br><span class="line">log.info(JSON.toJSONString(users));</span><br><span class="line">log.info(<span class="string">"UserService å­˜å‚¨æ•°æ®åº“æˆåŠŸï¼"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåœ¨ Controller ä¸­æ³¨å…¥ IUser:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IUser iUser;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ upload æ–¹æ³•ï¼Œä»¥åŒ¿åå†…éƒ¨ç±»é‡å†™ listener æ–¹æ³•çš„å½¢å¼æ¥å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/uploadWithAnonyInnerClass"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">uploadWithAnonyInnerClass</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">EasyExcel.read(file.getInputStream(), User.class, <span class="keyword">new</span> AnalysisEventListener&lt;User&gt;()&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹å¤„ç†é˜ˆå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_COUNT = <span class="number">2</span>;</span><br><span class="line">List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(User user, AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">log.info(<span class="string">"è§£æåˆ°ä¸€æ¡æ•°æ®:&#123;&#125;"</span>, JSON.toJSONString(user));</span><br><span class="line">list.add(user);</span><br><span class="line"><span class="keyword">if</span> (list.size() &gt;= BATCH_COUNT) &#123;</span><br><span class="line">saveData();</span><br><span class="line">list.clear();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">saveData();</span><br><span class="line">log.info(<span class="string">"æ‰€æœ‰æ•°æ®è§£æå®Œæˆï¼"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveData</span><span class="params">()</span></span>&#123;</span><br><span class="line">iUser.saveData(list);</span><br><span class="line">&#125;</span><br><span class="line">&#125;).sheet().doRead();</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç»“æœ:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-10-06/2019-10-07-17-57-32.png" alt=""></p><p>è¿™ç§å®ç°æ–¹å¼ï¼Œå…¶å®è¿™åªæ˜¯å°† listener ä¸­çš„å†…å®¹å…¨éƒ¨é‡å†™ï¼Œå¹¶åœ¨ controller ä¸­å±•ç°å‡ºæ¥ï¼Œå½“ä½ çœ‹ç€è¿™ä¹ˆè‡ƒè‚¿çš„ controller æ˜¯ä¸æ˜¯éå¸¸éš¾å—ï¼Ÿå¾ˆæ˜¾ç„¶è¿™ç§æ–¹å¼ä¸æ˜¯æˆ‘ä»¬çš„æœ€ä½³ç¼–ç å®ç°</p><h3 id="æ„é€ å™¨ä¼ å‚"><a href="#æ„é€ å™¨ä¼ å‚" class="headerlink" title="æ„é€ å™¨ä¼ å‚"></a>æ„é€ å™¨ä¼ å‚</h3><p>åœ¨ä¹‹å‰åˆ†æ SpringBoot ç»Ÿä¸€è¿”å›æºç æ—¶ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦å‘ç°ï¼ŒSpring åº•å±‚æºç å¤šæ•°ä»¥æ„é€ å™¨çš„å½¢å¼ä¼ å‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸º listener æ·»åŠ æœ‰å‚æ„é€ å™¨ï¼Œå°† Controller ä¸­ä¾èµ–æ³¨å…¥çš„ IUser ä»¥æ„é€ å™¨çš„å½¢å¼ä¼ å…¥åˆ° listener :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserExcelListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> IUser iUser;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">UserExcelListener</span><span class="params">(IUser iUser)</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.iUser = iUser;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥ç›¸åº”ä»£ç ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveData</span><span class="params">()</span></span>&#123;</span><br><span class="line">iUser.saveData(list); <span class="comment">//è°ƒç”¨ userService ä¸­çš„ saveData æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹ Controller æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/uploadWithConstructor"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">uploadWithConstructor</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    EasyExcel.read(file.getInputStream(), User.class, <span class="keyword">new</span> UserExcelListener(iUser)).sheet().doRead();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ: åŒä¸Š</p><p>è¿™æ ·æ›´æ”¹åï¼Œcontroller ä»£ç çœ‹ç€å¾ˆæ¸…æ™°ï¼Œä½†å¦‚æœåç»­ä¸šåŠ¡è¿˜æœ‰åˆ«çš„ Service éœ€è¦æ³¨å…¥ï¼Œæˆ‘ä»¬éš¾é“è¦ä¸€ç›´æ·»åŠ æœ‰å‚æ„é€ å™¨å—ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹å¼åŒæ ·ä¸æ˜¯å¾ˆçµæ´»ã€‚</p><p>å…¶å®åœ¨ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„æ—¶å€™ï¼Œä½ ä¹Ÿè®¸ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Java8 lambda çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><h3 id="Lambda-ä¼ å‚"><a href="#Lambda-ä¼ å‚" class="headerlink" title="Lambda ä¼ å‚"></a>Lambda ä¼ å‚</h3><p>ä¸ºäº†è§£å†³æ„é€ å™¨ä¼ å‚çš„ç—›ç‚¹ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå¸Œæœ› listener æ›´å…·æœ‰é€šç”¨æ€§ï¼Œæ²¡å¿…è¦ä¸ºæ¯ä¸ª Excel ä¸šåŠ¡éƒ½æ–°å»ºä¸€ä¸ª listenerï¼Œå› ä¸º listener éƒ½æ˜¯é€è¡Œè¯»å– Excel æ•°æ®ï¼Œåªéœ€è¦å°†æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ä»£ç ä¼ å…¥ç»™ listener å³å¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€ç”¨åˆ° <code>Consumer&lt;T&gt;</code> ï¼Œå°†å…¶ä½œä¸ºæ„é€  listener çš„å‚æ•°ã€‚</p><p>æ–°å»ºä¸€ä¸ªå·¥å…·ç±» ExcelDemoUtilsï¼Œç”¨æ¥æ„é€  listener:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelDemoUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‡å®šé˜ˆå€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> consumer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> threshold</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">AnalysisEventListener&lt;T&gt; <span class="title">getListener</span><span class="params">(Consumer&lt;List&lt;T&gt;&gt; consumer, <span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> AnalysisEventListener&lt;T&gt;() &#123;</span><br><span class="line"><span class="keyword">private</span> LinkedList&lt;T&gt; linkedList = <span class="keyword">new</span> LinkedList&lt;T&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(T t, AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">linkedList.add(t);</span><br><span class="line"><span class="keyword">if</span> (linkedList.size() == threshold)&#123;</span><br><span class="line">consumer.accept(linkedList);</span><br><span class="line">linkedList.clear();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (linkedList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">consumer.accept(linkedList);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸æŒ‡å®šé˜ˆå€¼ï¼Œé˜ˆå€¼é»˜è®¤ä¸º10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> consumer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">AnalysisEventListener&lt;T&gt; <span class="title">getListener</span><span class="params">(Consumer&lt;List&lt;T&gt;&gt; consumer)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> getListener(consumer, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒgetListener æ–¹æ³•æ¥æ”¶ä¸€ä¸ª <code>Consumer&lt;List&lt;T&gt;&gt;</code> çš„å‚æ•°ï¼Œè¿™æ ·ä¸‹é¢ä»£ç è¢«è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿå°±ä¼šè¢«ç›¸åº”çš„æ‰§è¡Œäº†:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer.accept(linkedList);</span><br></pre></td></tr></table></figure><p>ç»§ç»­æ”¹é€  Controller æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/uploadWithLambda"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">uploadWithLambda</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    AnalysisEventListener&lt;User&gt; userAnalysisEventListener = ExcelDemoUtils.getListener(<span class="keyword">this</span>.batchInsert(), <span class="number">2</span>);</span><br><span class="line">    EasyExcel.read(file.getInputStream(), User.class, userAnalysisEventListener).sheet().doRead();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Consumer&lt;List&lt;User&gt;&gt; batchInsert()&#123;</span><br><span class="line">    <span class="comment">//å…¶ä»–ä¸šåŠ¡é€»è¾‘åªéœ€è¦æ·»åŠ åˆ°è¯¥æ–¹æ³•ä¸­å³å¯</span></span><br><span class="line">    <span class="keyword">return</span> users -&gt; iUser.saveData(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ: åŒä¸Š</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä¸šåŠ¡é€»è¾‘å®šåˆ¶åœ¨ <code>batchInsert</code> æ–¹æ³•ä¸­:</p><ol><li>æ»¡è¶³ Controller RESTful API çš„ç®€æ´æ€§</li><li>listener æ›´åŠ é€šç”¨å’Œçµæ´»ï¼Œå®ƒæ›´å¤šæ˜¯æ‰®æ¼”äº†æŠ½è±¡ç±»çš„è§’è‰²ï¼Œå…·ä½“çš„é€»è¾‘äº¤ç»™æŠ½è±¡æ–¹æ³•çš„å®ç°æ¥å®Œæˆ</li><li>ä¸šåŠ¡é€»è¾‘å¯æ‰©å±•æ€§ä¹Ÿæ›´å¥½ï¼Œé€»è¾‘æ›´åŠ æ¸…æ™°</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œï¼Œå…³äºå¦‚ä½•ä½¿ç”¨ EasyExcel è¯»å– Excel ä¿¡æ¯çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å·²ç»ä»‹ç»å®Œäº†ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚å†…å®¹æ²¡æœ‰è®²ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜… <a href="https://github.com/alibaba/easyexcel" target="_blank" rel="noopener">EasyExcel Github</a> æ–‡æ¡£å»å‘ç°æ›´å¤šå†…å®¹</p><p>é™¤äº†è¯»å– Excel çš„è¯»å–ï¼Œè¿˜æœ‰ Excel çš„å†™å…¥ï¼Œå¦‚æœéœ€è¦å°†å…¶å†™å…¥åˆ°æŒ‡å®šä½ç½®ï¼Œé…åˆ HuTool çš„å·¥å…·ç±» FileWriter çš„ä½¿ç”¨æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œé’ˆå¯¹ EasyExcel çš„ä½¿ç”¨ï¼Œå¦‚æœå¤§å®¶æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¹Ÿæ¬¢è¿åˆ°åšå®¢ä¸‹æ–¹æ¢è®¨</p><p>å®Œæ•´ä»£ç è¯·åœ¨å…¬ä¼—å·å›å¤ã€Œdemoã€ï¼Œç‚¹å¼€é“¾æ¥ï¼ŒæŸ¥çœ‹ã€Œeasyexceldemoã€æ–‡ä»¶å¤¹çš„å†…å®¹å³å¯</p><h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><p>éå¸¸æ„Ÿè°¢ EasyExcel çš„ä½œè€… ğŸŒ¹ğŸŒ¹ï¼Œè®© Excel çš„è¯»å†™æ›´åŠ æ–¹ä¾¿ </p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>é™¤äº† Consumerï¼Œå¦‚æœéœ€è¦è¿”å›å€¼çš„ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ°å“ªä¸ªå‡½æ•°å¼æ¥å£å‘¢ï¼Ÿ</li><li>å½“å‡ºç°å¤æ‚è¡¨å¤´çš„æ—¶å€™è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</li><li>å°† DB æ•°æ®å†™å…¥åˆ° Excel å¹¶ä¸‹è½½ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ</li><li>ä» EasyExcel çš„è®¾è®¡ä¸Šï¼Œä½ å­¦åˆ°äº†ä»€ä¹ˆï¼Œæ¬¢è¿åšå®¢ä¸‹æ–¹ç•™è¨€è®¨è®º</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""> </p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ol><li><a href="https://dayarch.top/2019/08/25/bing-fa-bian-cheng-zhi-chu-tan/">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡</a></li><li><a href="https://dayarch.top/2019/08/28/bing-fa-bian-cheng-san-da-he-xin/">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a></li><li><a href="https://dayarch.top/2019/09/04/bing-fa-bian-cheng-san-da-wen-ti/">å¹¶å‘Bugä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a></li><li><a href="https://dayarch.top/2019/09/12/you-xu-xing-ke-jian-xing-happens-before-lai-gao-ding/">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://dayarch.top/2019/09/19/jie-jue-yuan-zi-xing-wen-ti-ni-shou-xian-xu-yao-de-shi-hong-guan-li-jie/">è§£å†³åŸå­æ€§é—®é¢˜ï¼Ÿä½ é¦–å…ˆéœ€è¦çš„æ˜¯å®è§‚ç†è§£</a></li><li><a href="https://dayarch.top/2019/09/29/mian-shi-bing-fa-volatile-guan-jian-zi-shi-wo-men-ying-gai-ju-bei-na-xie-tan-zi/">é¢è¯•å¹¶å‘volatileå…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…·å¤‡å“ªäº›è°ˆèµ„ï¼Ÿ</a></li></ol><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº« </li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­” </li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Excel </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> EasyExcel </tag>
            
            <tag> POI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•volatileå…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…·å¤‡å“ªäº›è°ˆèµ„ï¼Ÿ</title>
      <link href="//p/java-concurrency-volatile.html"/>
      <url>//p/java-concurrency-volatile.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>åœ¨ <a href="https://dayarch.top/2019/09/12/you-xu-xing-ke-jian-xing-happens-before-lai-gao-ding/">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a> æ–‡ç« ä¸­ï¼Œhappens-before çš„åŸåˆ™ä¹‹ä¸€: volatileå˜é‡è§„åˆ™</p><blockquote><p> å¯¹ä¸€ä¸ª volatile åŸŸçš„å†™, happens-before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»</p></blockquote><p>æŒ‰ç†è¯´äº†è§£äº†è¿™ä¸ªè§„åˆ™ï¼Œå¯¹ volatile çš„ä½¿ç”¨å°±å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯é¢è¯•å®˜å¯æ˜¯å–œæ¬¢åˆ¨æ ¹é—®åˆ°åº•çš„ï¼Œä¸ºäº†æ›´é€å½»çš„äº†è§£ volatile çš„å†…å­˜è¯­ä¹‰ä¸è¯»å†™è¯­ä¹‰ï¼Œä¸ºäº†é¢è¯•å¤šä¸€äº›è°ˆèµ„è¿›è€Œè·å¾—ä¸€äº›åŠ åˆ†é¡¹ï¼ŒåŒæ—¶å°½æ—©å¡«è¡¥å‰åºæ–‡ç« ç•™ä¸‹çš„å‘ï¼Œäºæ˜¯ä¹è¿™ç¯‡æ–‡ç« å°±è¿™æ ·å°´å°¬çš„è¯ç”Ÿäº†</p><h2 id="happens-before-ä¹‹-volatile-å˜é‡è§„åˆ™"><a href="#happens-before-ä¹‹-volatile-å˜é‡è§„åˆ™" class="headerlink" title="happens-before ä¹‹ volatile å˜é‡è§„åˆ™"></a>happens-before ä¹‹ volatile å˜é‡è§„åˆ™</h2><p>ä¸‹é¢çš„è¡¨æ ¼ä½ è¿˜è®°å¾—å—ï¼Ÿ(æ˜¯çš„ï¼Œä½ è®°å¾—ğŸ˜‚)</p><table><thead><tr><th>èƒ½å¦é‡æ’åº</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th></tr></thead><tbody><tr><td>ç¬¬ä¸€ä¸ªæ“ä½œ</td><td>æ™®é€šè¯»/å†™</td><td>volatile è¯»</td><td>volatile å†™</td></tr><tr><td>æ™®é€šè¯»/å†™</td><td>-</td><td>-</td><td>NO</td></tr><tr><td>volatile è¯»</td><td>NO</td><td>NO</td><td>NO</td></tr><tr><td>volatile å†™</td><td>-</td><td>NO</td><td>NO</td></tr></tbody></table><p>ä¸Šé¢çš„è¡¨æ ¼æ˜¯ JMM é’ˆå¯¹ç¼–è¯‘å™¨å®šåˆ¶çš„ volatile é‡æ’åºçš„è§„åˆ™ï¼Œé‚£ JMM æ˜¯æ€æ ·ç¦æ­¢é‡æ’åºçš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>å†…å­˜å±éšœ</strong></p><h2 id="å†…å­˜å±éšœ-Memory-Barriers-Fences"><a href="#å†…å­˜å±éšœ-Memory-Barriers-Fences" class="headerlink" title="å†…å­˜å±éšœ (Memory Barriers / Fences)"></a>å†…å­˜å±éšœ (Memory Barriers / Fences)</h2><p>æ— è®ºä½ å¬è¿‡è¿™ä¸ªåè¯ä¸å¦éƒ½æ²¡å…³ç³»ï¼Œå¾ˆç®€å•ï¼Œä¸”çœ‹</p><blockquote><p>ä¸ºäº†å®ç° volatile çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åº</p></blockquote><p>è¿™å¥è¯æœ‰ç‚¹æŠ½è±¡ï¼Œè¯•ç€æƒ³è±¡å†…å­˜å±éšœæ˜¯ä¸€é¢é«˜å¢™ï¼Œå¦‚æœä¸¤ä¸ªå˜é‡ä¹‹é—´æœ‰è¿™ä¸ªå±éšœï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¸èƒ½äº’æ¢ä½ç½®(é‡æ’åº)äº†ï¼Œå˜é‡æœ‰è¯»(Load)æœ‰å†™(Store)ï¼Œæ“ä½œæœ‰å‰æœ‰åï¼ŒJMM å°±å°†å†…å­˜å±éšœæ’å…¥ç­–ç•¥åˆ†ä¸º 4 ç§:</p><ol><li>åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœ</li><li>åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœ</li><li>åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœ</li><li>åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœ</li></ol><p>1 å’Œ 2 ç”¨å›¾å½¢æè¿°ä»¥åŠå¯¹åº”è¡¨æ ¼è§„åˆ™å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­äº†:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-24/volatilepingzhang12.png" alt=""></p><p>3 å’Œ 4 ç”¨å›¾å½¢æè¿°ä»¥åŠå¯¹åº”è¡¨æ ¼è§„åˆ™å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­äº†:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-24/volatilepingzhang34.png" alt=""></p><blockquote><p>å…¶å®å›¾å½¢ä¹Ÿæ˜¯è¡¨æ ¼å†…å®¹çš„ä½“ç°ï¼Œåªä¸è¿‡å‘Šè¯‰å¤§å®¶å†…å­˜å±éšœæ˜¯å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„ï¼Œæ‰€ä»¥å¤§å®¶åªè¦ç‰¢è®°è¡¨æ ¼å†…å®¹å³å¯</p></blockquote><p>ä¸€æ®µç¨‹åºçš„è¯»å†™é€šå¸¸ä¸ä¼šåƒä¸Šé¢ä¸¤ç§æƒ…å†µè¿™æ ·ç®€å•ï¼Œè¿™äº›å±éšœç»„åˆèµ·æ¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå…¶å®ä¸€ç‚¹éƒ½ä¸éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›æŒ‡ä»¤å¸¦å…¥åˆ°æ–‡ç« å¼€å¤´çš„è¡¨æ ¼ä¸­ï¼Œç„¶åå†æŒ‰ç…§ç¨‹åºé¡ºåºæ‹¼æ¥æŒ‡ä»¤å°±å¥½äº†</p><p>æ¥çœ‹ä¸€å°æ®µç¨‹åº:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileBarrierExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> v1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> v2 = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readAndWrite</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = v1; <span class="comment">//ç¬¬ä¸€ä¸ªvolatileè¯»</span></span><br><span class="line"><span class="keyword">int</span> j = v2;<span class="comment">//ç¬¬äºŒä¸ªvolatileè¯»</span></span><br><span class="line">a = i + j;<span class="comment">//æ™®é€šå†™</span></span><br><span class="line">v1 = i + <span class="number">1</span>;<span class="comment">//ç¬¬ä¸€ä¸ªvolatileå†™</span></span><br><span class="line">v2 = j * <span class="number">2</span>;<span class="comment">//ç¬¬äºŒä¸ªvolatileå†™</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å±éšœæŒ‡ä»¤å¸¦å…¥åˆ°ç¨‹åºå°±æ˜¯è¿™ä¸ªæ ·å­:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-24/volatile1234.png" alt=""></p><p>æˆ‘ä»¬å°†ä¸Šå›¾åˆ†å‡ ä¸ªè§’åº¦æ¥çœ‹:</p><ol><li>å½©è‰²æ˜¯å°†å±éšœæŒ‡ä»¤å¸¦å…¥åˆ°ç¨‹åºä¸­ç”Ÿæˆçš„å…¨éƒ¨å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„<strong>ã€Œæœ€ç¨³å¦¥ã€</strong>çš„æ–¹æ¡ˆ</li><li>æ˜¾ç„¶æœ‰å¾ˆå¤šå±éšœæ˜¯é‡å¤å¤šä½™çš„ï¼Œå³ä¾§è™šçº¿æ¡†æŒ‡å‘çš„å±éšœæ˜¯å¯ä»¥è¢«<strong>ã€Œä¼˜åŒ–ã€</strong>åˆ é™¤æ‰çš„å±éšœ</li></ol><p>åˆ°è¿™é‡Œä½ åº”è¯¥äº†è§£äº† volatile æ˜¯å¦‚ä½•é€šè¿‡å†…å­˜å±éšœä¿è¯ç¨‹åºä¸è¢«â€æ“…è‡ªâ€æ’åºçš„ï¼Œé‚£ volatile æ˜¯å¦‚ä½•ä¿è¯å¯è§æ€§çš„å‘¢ï¼Ÿ</p><h2 id="volatile-å†™-è¯»çš„å†…å­˜è¯­ä¹‰"><a href="#volatile-å†™-è¯»çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="volatile å†™-è¯»çš„å†…å­˜è¯­ä¹‰"></a>volatile å†™-è¯»çš„å†…å­˜è¯­ä¹‰</h2><p>å›é¡¾ä¸€ä¸‹ä¹‹å‰æ–‡ç« å†…å®¹ä¸­çš„ç¨‹åºï¼Œå‡å®šçº¿ç¨‹ A å…ˆæ‰§è¡Œ writer æ–¹æ³•ï¼Œéšåçº¿ç¨‹ B æ‰§è¡Œ reader æ–¹æ³•ï¼Œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReorderExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span>&#123;</span><br><span class="line">x = <span class="number">42</span>;<span class="comment">//1</span></span><br><span class="line">y = <span class="number">50</span>;<span class="comment">//2</span></span><br><span class="line">flag = <span class="keyword">true</span>;<span class="comment">//3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (flag)&#123;<span class="comment">//4</span></span><br><span class="line">System.out.println(<span class="string">"x:"</span> + x);<span class="comment">//5</span></span><br><span class="line">System.out.println(<span class="string">"y:"</span> + y);<span class="comment">//6</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä½ æ˜¯å¦è¿˜è®°å¾—ä¹‹å‰è¯´è¿‡çš„ JMMï¼Œæ˜¯çš„ï¼Œä½ è¿˜è®°å¾—ğŸ˜‚ï¼Œå½“çº¿ç¨‹ A æ‰§è¡Œ writer æ–¹æ³•æ—¶ï¼Œä¸”çœ‹ä¸‹å›¾:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-24/volatile%E5%8F%AF%E8%A7%81%E6%80%A7.png" alt=""></p><p>çº¿ç¨‹ A å°†æœ¬åœ°å†…å­˜æ›´æ”¹çš„å˜é‡å†™å›åˆ°ä¸»å†…å­˜ä¸­</p><blockquote><h3 id="volatile-è¯»çš„å†…å­˜è¯­ä¹‰"><a href="#volatile-è¯»çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="volatile è¯»çš„å†…å­˜è¯­ä¹‰:"></a>volatile è¯»çš„å†…å­˜è¯­ä¹‰:</h3><p>å½“è¯»ä¸€ä¸ª volatile å˜é‡æ—¶, JMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æ¥ä¸‹æ¥å°†ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚</p></blockquote><p>æ‰€ä»¥å½“çº¿ç¨‹ B æ‰§è¡Œ reader æ–¹æ³•æ—¶ï¼Œå›¾å½¢ç»“æ„å°±å˜æˆäº†è¿™ä¸ªæ ·å­:</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-24/volatile%E5%8F%AF%E8%A7%81%E6%80%A7%E8%AF%BB.png" alt=""></p><p>çº¿ç¨‹ B æœ¬åœ°å†…å­˜å˜é‡æ— æ•ˆï¼Œä»ä¸»å†…å­˜ä¸­è¯»å–å˜é‡åˆ°æœ¬åœ°å†…å­˜ä¸­ï¼Œä¹Ÿå°±å¾—åˆ°äº†çº¿ç¨‹ A æ›´æ”¹åçš„ç»“æœï¼Œè¿™å°±æ˜¯ volatile æ˜¯å¦‚ä½•ä¿è¯å¯è§æ€§çš„</p><p>å¦‚æœä½ çœ‹è¿‡å‰é¢çš„æ–‡ç« ä½ å°±ä¸éš¾ç†è§£ä¸Šé¢çš„ä¸¤å¼ å›¾äº†ï¼Œç»¼åˆèµ·æ¥è¯´:</p><ol><li>çº¿ç¨‹ A å†™ä¸€ä¸ªvolatileå˜é‡, å®è´¨ä¸Šæ˜¯çº¿ç¨‹ A å‘æ¥ä¸‹æ¥å°†è¦è¯»è¿™ä¸ª volatile å˜é‡çš„æŸä¸ªçº¿ç¨‹å‘å‡ºäº†(å…¶å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„)æ¶ˆæ¯</li><li>çº¿ç¨‹ B è¯»ä¸€ä¸ª volatile å˜é‡,å®è´¨ä¸Šæ˜¯çº¿ç¨‹ B æ¥æ”¶äº†ä¹‹å‰æŸä¸ªçº¿ç¨‹å‘å‡ºçš„(åœ¨å†™è¿™ä¸ª volatile å˜é‡ä¹‹å‰å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„)æ¶ˆæ¯ã€‚</li><li>çº¿ç¨‹ A å†™ä¸€ä¸ª volatile å˜é‡, éšåçº¿ç¨‹ B è¯»è¿™ä¸ª volatile å˜é‡, è¿™ä¸ªè¿‡ç¨‹å®è´¨ä¸Šæ˜¯çº¿ç¨‹ A é€šè¿‡ä¸»å†…å­˜å‘çº¿ç¨‹B å‘é€æ¶ˆæ¯ã€‚</li></ol><p>åˆ°è¿™é‡Œï¼Œé¢è¯• volatile æ—¶ï¼Œä½ åº”è¯¥æœ‰ä¸€äº›è°ˆèµ„äº†ï¼ŒåŒæ—¶ä¹Ÿå¯¹ volatile çš„è¯­ä¹‰æœ‰äº†æ›´æ·±å±‚æ¬¡çš„äº†è§£</p><h2 id="å½©è›‹"><a href="#å½©è›‹" class="headerlink" title="å½©è›‹"></a>å½©è›‹</h2><p>ä¹‹å‰çš„æ–‡ç« æåˆ°è¿‡è¿™æ ·ä¸€å¥è¯:</p><blockquote><p> ä»å†…å­˜è¯­ä¹‰çš„è§’åº¦æ¥è¯´, volatile çš„<code>å†™-è¯»</code>ä¸é”çš„<code>é‡Šæ”¾-è·å–</code>æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæœï¼›volatile å†™å’Œé”çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰; volatile è¯»ä¸é”çš„è·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰</p></blockquote><p>è®°ä½æ–‡ä¸­æœ€åä¸¤å¼ å›¾ï¼Œ å½“æˆ‘ä»¬è¯´åˆ° synchronized çš„æ—¶å€™ï¼Œä½ å°±ä¼šçŒ›çš„ç†è§£è¿™å¥è¯çš„å«ä¹‰äº†, æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å…ˆäº†è§£ synchronized çš„å†™-è¯»è¯­ä¹‰</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±èŠä¸€èŠé”ç›¸å…³çš„å†…å®¹äº†ï¼Œæ•¬è¯·æœŸå¾…â€¦</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>å¦‚æœ volatile å†™ä¹‹åç›´æ¥ returnï¼Œé‚£è¿˜ä¼šç”Ÿæˆ StoreLoad æŒ‡ä»¤å—ï¼Ÿ</li><li>synchronized æ˜¯æ€æ ·é€æ­¥è¢«ä¼˜åŒ–çš„ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""> </p><h3 id="tool-lu"><a href="#tool-lu" class="headerlink" title="tool.lu"></a>tool.lu</h3><p><a href="https://tool.lu" target="_blank" rel="noopener">https://tool.lu</a> æ˜¯ä¸€æ¬¾é›†æˆäº†éå¸¸å¤šåŠŸèƒ½çš„åœ¨çº¿å·¥å…·ï¼ŒåŸºæœ¬æ»¡è¶³æ—¥å¸¸å¼€å‘æ‰€éœ€</p><p><img src="http://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-24/2019-09-29-19-28-22.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/I53l5W_Wl-lMc-_FAeJ6WQ" target="_blank" rel="noopener">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡ </a></li><li><a href="https://mp.weixin.qq.com/s/SrNsvp2NjhAEqYugx6c-3Q" target="_blank" rel="noopener">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a></li><li><a href="https://mp.weixin.qq.com/s/fQcozKziqMxFMBkptpnuTw" target="_blank" rel="noopener">å¹¶å‘Bugä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a></li><li><a href="https://mp.weixin.qq.com/s/074jYZWZODJ5Z2qXyWy4gw" target="_blank" rel="noopener">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/SSfs_kz60MjfrvtwNhY7pg" target="_blank" rel="noopener">è§£å†³åŸå­æ€§é—®é¢˜ï¼Ÿä½ é¦–å…ˆéœ€è¦çš„æ˜¯å®è§‚ç†è§£</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº« </li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­” </li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> volatile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³åŸå­æ€§é—®é¢˜ï¼Ÿä½ é¦–å…ˆéœ€è¦çš„æ˜¯å®è§‚ç†è§£</title>
      <link href="//p/java-concurrency-atomic.html"/>
      <url>//p/java-concurrency-atomic.html</url>
      
        <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://mp.weixin.qq.com/s/074jYZWZODJ5Z2qXyWy4gw" target="_blank" rel="noopener">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a>ï¼Œè§£å†³äº†å¹¶å‘ä¸‰å¤§é—®é¢˜ä¸­çš„ä¸¤ä¸ªï¼Œä»Šå¤©æˆ‘ä»¬å°±èŠèŠå¦‚ä½•è§£å†³åŸå­æ€§é—®é¢˜</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-17/prairie-679014.jpg" alt=""></p><p>åŸå­æ€§é—®é¢˜çš„æºå¤´å°±æ˜¯ <strong>çº¿ç¨‹åˆ‡æ¢</strong>ï¼Œä½†åœ¨å¤šæ ¸ CPU çš„å¤§èƒŒæ™¯ä¸‹ï¼Œä¸å…è®¸çº¿ç¨‹åˆ‡æ¢æ˜¯ä¸å¯èƒ½çš„ï¼Œæ­£æ‰€è°“ã€Œé­”é«˜ä¸€å°ºï¼Œé“é«˜ä¸€ä¸ˆã€ï¼Œæ–°è§„çŸ©æ¥äº†:</p><blockquote><p> äº’æ–¥: åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</p></blockquote><p>å®é™…ä¸Šï¼Œä¸Šé¢è¿™å¥è¯çš„æ„æ€æ˜¯: å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ A ä¿®æ”¹å…±äº«å˜é‡æ—¶å…¶ä»–çº¿ç¨‹ä¸èƒ½ä¿®æ”¹ï¼Œè¿™å°±ä¸å­˜åœ¨æ“ä½œè¢«æ‰“æ–­çš„é—®é¢˜äº†ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°äº’æ–¥å‘¢ï¼Ÿ</p><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><p>å¯¹å¹¶å‘æœ‰æ‰€äº†è§£çš„å°ä¼™ä¼´é©¬ä¸Šå°±èƒ½æƒ³åˆ° <strong>é”</strong> è¿™ä¸ªæ¦‚å¿µï¼Œå¹¶ä¸”ä½ çš„ç¬¬ä¸€ååº”å¾ˆå¯èƒ½å°±æ˜¯ä½¿ç”¨ synchronizedï¼Œè¿™é‡Œåˆ—å‡ºæ¥ä½ å¸¸è§çš„ synchronized çš„ä¸‰ç§ç”¨æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeSync</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">normalSyncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">staticSyncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncBlockMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span> (object)&#123;</span><br><span class="line"><span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰ç§ synchronized é”çš„å†…å®¹æœ‰ä¸€äº›å·®åˆ«:</p><ul><li>å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œé€šå¸¸æŒ‡ this</li><li>å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰ç±»çš„ Class å¯¹è±¡ï¼Œå¦‚ ThreeSync.class</li><li>å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”çš„æ˜¯ synchronized æ‹¬å·å†…çš„å¯¹è±¡</li></ul><p>æˆ‘ç‰¹æ„åœ¨ä¸‰ç§ synchronized ä»£ç é‡Œé¢æ·»åŠ äº†ã€Œä¸´ç•ŒåŒºã€å­—æ ·çš„æ³¨é‡Šï¼Œé‚£ä»€ä¹ˆæ˜¯ä¸´ç•ŒåŒºå‘¢ï¼Ÿ</p><blockquote><p> ä¸´ç•ŒåŒº: æˆ‘ä»¬æŠŠéœ€è¦äº’æ–¥æ‰§è¡Œçš„ä»£ç çœ‹æˆä¸ºä¸´ç•ŒåŒº</p></blockquote><p>è¯´åˆ°è¿™é‡Œï¼Œå’Œå¤§å®¶ä¸²çš„çŸ¥è¯†éƒ½æ˜¯è¡¨å±‚è®¤çŸ¥ï¼Œ<strong>å¦‚ä½•ç”¨é”ä¿æŠ¤æœ‰æ•ˆçš„ä¸´ç•ŒåŒºæ‰æ˜¯å…³é”®</strong>ï¼Œè¿™ç›´æ¥å…³ç³»åˆ°ä½ æ˜¯å¦ä¼šå†™å‡ºå¹¶å‘çš„ bugï¼Œäº†è§£è¿‡æœ¬ç« å†…å®¹åï¼Œä½ ä¼šå‘ç°æ— è®ºæ˜¯éšå¼é”/å†…ç½®é” (synchronized) è¿˜æ˜¯æ˜¾ç¤ºé” (Lock) çš„ä½¿ç”¨éƒ½æ˜¯åœ¨æ‰¾å¯»è¿™ç§å…³ç³»ï¼Œå…³ç³»å¯¹äº†ï¼Œä¸€åˆ‡å°±å¯¹äº†ï¼Œä¸”çœ‹</p><p>ä¸Šé¢é”çš„ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨è¾¾:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-17/%E7%AE%80%E6%98%93%E9%94%81%E6%A8%A1%E5%9E%8B.png" alt=""></p><p>çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œå°è¯•åŠ é” lock()ï¼Œ åŠ é”æˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒº(å¯¹å…±äº«å˜é‡è¿›è¡Œä¿®æ”¹)ï¼ŒæŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œå®Œä¸´ç•ŒåŒºä»£ç åï¼Œæ‰§è¡Œ unlock()ï¼Œé‡Šæ”¾é”ã€‚é’ˆå¯¹è¿™ä¸ªæ¨¡å‹ï¼Œå¤§å®¶ç»å¸¸ç”¨æŠ¢å å•æ‰€å‘ä½æ¥å½¢å®¹:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-17/ABUIABADGAAg5Jf5yAUouJmMgAEw7gU4pAM.gif" alt=""></p><p>åœ¨å­¦ä¹  Java æ—©æœŸæˆ‘å°±æ˜¯è¿™æ ·è®°å¿†ä¸ç†è§£é”çš„ï¼Œä½†è½å®åˆ°ä»£ç ä¸Šï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¿½ç•¥ä¸¤ç‚¹:</p><ol><li>æˆ‘ä»¬é”çš„æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>æˆ‘ä»¬ä¿æŠ¤çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>å°†è¿™ä¸¤å¥è¯è”åˆèµ·æ¥å°±æ˜¯ä½ çš„é”èƒ½å¦å¯¹ä¸´ç•ŒåŒºçš„èµ„æºèµ·åˆ°ä¿æŠ¤çš„ä½œç”¨ï¼Ÿæ‰€ä»¥æˆ‘ä»¬è¦å°†ä¸Šé¢çš„æ¨¡å‹è¿›ä¸€æ­¥ç»†åŒ–</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-17/%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%8C%E6%9C%89%E6%95%88%E4%B8%B4%E7%95%8C%E5%8C%BA%20%281%29%20%281%29.png" alt=""></p><p>ç°å®ä¸­ï¼Œ<strong>æˆ‘ä»¬éƒ½çŸ¥é“è‡ªå·±çš„é”æ¥é”è‡ªå·±éœ€è¦ä¿æŠ¤çš„ä¸œè¥¿</strong> ï¼Œè¿™å¥è¯ç¿»è¯‘æˆä½ çš„è¡ŒåŠ¨è¯­è¨€ä¹‹åä½ å·²ç»æ˜ç¡®çŸ¥é“äº†:</p><ol><li>ä½ é”çš„æ˜¯ä»€ä¹ˆ</li><li>ä½ ä¿æŠ¤çš„èµ„æºæ˜¯ä»€ä¹ˆ</li></ol><p>CPU å¯ä¸åƒæˆ‘ä»¬å¤§è„‘è¿™ä¹ˆæ™ºèƒ½ï¼Œæˆ‘ä»¬è¦æ˜ç¡®è¯´æ˜æˆ‘ä»¬é”çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬è¦ä¿æŠ¤çš„èµ„æºæ˜¯ä»€ä¹ˆï¼Œå®ƒæ‰ä¼šç”¨é”ä¿æŠ¤æˆ‘ä»¬æƒ³è¦ä¿æŠ¤çš„èµ„æº(å…±äº«å˜é‡)</p><p>æ‹¿ä¸Šå›¾æ¥è¯´ï¼Œèµ„æº R (å…±äº«å˜é‡) å°±æ˜¯æˆ‘ä»¬è¦ä¿æŠ¤çš„èµ„æºï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦åˆ›å»ºèµ„æº R çš„é”æ¥ä¿æŠ¤èµ„æº Rï¼Œç»†å¿ƒçš„æœ‹å‹å¯èƒ½å‘ç°ä¸Šå›¾å‡ ä¸ªé—®é¢˜:</p><blockquote><p> LR å’Œ R ä¹‹é—´æœ‰æ˜ç¡®çš„æŒ‡å‘å…³ç³»<br>æˆ‘ä»¬ç¼–å†™ç¨‹åºæ—¶ï¼Œå¾€å¾€è„‘å­ä¸­çš„æ¨¡å‹æ˜¯å¯¹çš„ï¼Œä½†æ˜¯å¿½ç•¥äº†è¿™ä¸ªæŒ‡å‘å…³ç³»ï¼Œå¯¼è‡´è‡ªå·±çš„é”ä¸èƒ½èµ·åˆ°ä¿æŠ¤èµ„æº R çš„ä½œç”¨(ç”¨åˆ«äººå®¶çš„é”ä¿æŠ¤è‡ªå·±å®¶çš„ä¸œè¥¿æˆ–ç”¨è‡ªå·±å®¶çš„é”ä¿æŠ¤åˆ«äººå®¶çš„ä¸œè¥¿)ï¼Œæœ€ç»ˆå¼•å‘å¹¶å‘ bugï¼Œ<strong>æ‰€ä»¥åœ¨ä½ å‹¾ç”»è‰å›¾æ—¶ï¼Œè¦æ˜ç¡®æ‰¾åˆ°è¿™ä¸ªå…³ç³»</strong></p></blockquote><blockquote><p> å·¦å›¾ LR è™šçº¿æŒ‡å‘äº†éå…±äº«å˜é‡<br>æˆ‘ä»¬å†™ç¨‹åºçš„æ—¶å€™å¾ˆå®¹æ˜“è¿™ä¹ˆåšï¼Œä¸ç¡®å®šå“ªä¸ªæ˜¯è¦ä¿æŠ¤çš„èµ„æºï¼Œç›´æ¥å¤§æ‚çƒ©ï¼Œç”¨ LR å°†è¦ä¿æŠ¤çš„èµ„æº R å’Œæ²¡å¿…è¦ä¿æŠ¤çš„éå…±äº«å˜é‡ä¸€èµ·ä¿æŠ¤èµ·æ¥äº†ï¼Œä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯´ä½ å°±æ˜ç™½è¿™ä¹ˆåšçš„åå¤„äº†</p></blockquote><ol><li>ç¼–å†™ä¸²è¡Œç¨‹åºæ—¶ï¼Œæ˜¯ä¸å»ºè®® tryâ€¦catch æ•´ä¸ªæ–¹æ³•çš„ï¼Œè¿™æ ·å¦‚æœå‡ºç°é—®æ˜¯å¾ˆéš¾å®šä½çš„ï¼Œé“ç†ä¸€æ ·ï¼Œæˆ‘ä»¬è¦ç”¨é”ç²¾ç¡®çš„é”ä½æˆ‘ä»¬è¦ä¿æŠ¤çš„èµ„æºå°±å¤Ÿäº†ï¼Œå…¶ä»–æ— æ„ä¹‰çš„èµ„æºæ˜¯ä¸è¦é”çš„</li><li>é”ä¿æŠ¤çš„ä¸œè¥¿è¶Šå¤šï¼Œä¸´ç•ŒåŒºå°±è¶Šå¤§ï¼Œä¸€ä¸ªçº¿ç¨‹ä»èµ°å…¥ä¸´ç•ŒåŒºåˆ°èµ°å‡ºä¸´ç•ŒåŒºçš„æ—¶é—´å°±è¶Šé•¿ï¼Œè¿™å°±è®©å…¶ä»–çº¿ç¨‹ç­‰å¾…çš„æ—¶é—´è¶Šä¹…ï¼Œè¿™æ ·å¹¶å‘çš„æ•ˆç‡å°±æœ‰æ‰€ä¸‹é™ï¼Œå…¶å®è¿™æ˜¯æ¶‰åŠåˆ°é”ç²’åº¦çš„é—®é¢˜ï¼Œåç»­ä¹Ÿéƒ½ä¼šåšç›¸å…³è¯´æ˜</li></ol><p>ä½œä¸ºç¨‹åºçŒ¿è¿˜æ˜¯ç®€å•æ‹¿ä»£ç è¯´æ˜ä¸€ä¸‹å¿ƒé‡Œæ¯”è¾ƒè¸å®ï¼Œä¸”çœ‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">badSync</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//å…¶ä»–ä¸å…±äº«å˜é‡countæ— å…³çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goodSync</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//å…¶ä»–ä¸å…±äº«å˜é‡countæ— å…³çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="keyword">synchronized</span> (object)&#123;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>è¿™é‡Œå¹¶ä¸æ˜¯è¯´ synchronized æ”¾åœ¨æ–¹æ³•ä¸Šä¸å¥½ï¼Œåªæ˜¯æé†’å¤§å®¶ç”¨åˆé€‚çš„é”çš„ç²’åº¦æ‰ä¼šæ›´é«˜æ•ˆ</em></p><p>åœ¨è®¡æ•°å™¨ç¨‹åºä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸è¿™ä¹ˆå†™:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SafeCounter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">counter</span><span class="params">()</span></span>&#123;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾å°±æ˜¯ä¸Šé¢ç¨‹åºçš„æ¨¡å‹å±•ç¤º:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-17/%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%8C%E4%B8%80%E9%94%81%E5%A4%9A%E4%B8%AA%E8%B5%84%E6%BA%90%20%281%29.png" alt=""></p><p>è¿™é‡Œæˆ‘ä»¬é”çš„æ˜¯ thisï¼Œå¯ä»¥ä¿æŠ¤ this.countã€‚ä½†æœ‰äº›åŒå­¦è®¤ä¸º getCount æ–¹æ³•æ²¡å¿…è¦åŠ  synchronized å…³é”®å­—ï¼Œå› ä¸ºæ˜¯è¯»çš„æ“ä½œï¼Œä¸ä¼šå¯¹å…±äº«å˜é‡åšä¿®æ”¹ï¼Œå¦‚æœä¸åŠ ä¸Š synchronized å…³é”®å­—ï¼Œå°±è¿èƒŒäº†æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç«  happens-before è§„åˆ™ä¸­çš„ç›‘è§†å™¨é”è§„åˆ™:</p><blockquote><p> å¯¹ä¸€ä¸ªé”çš„è§£é” happens-before äºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”<br>ä¹Ÿå°±æ˜¯è¯´å¯¹ count çš„å†™å¾ˆå¯èƒ½å¯¹ count çš„è¯»ä¸å¯è§ï¼Œä¹Ÿå°±å¯¼è‡´è„è¯»</p></blockquote><p>ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ª this é”æ˜¯å¯ä»¥ä¿æŠ¤å¤šä¸ªèµ„æºçš„ï¼Œé‚£ç”¨å¤šä¸ªä¸åŒçš„é”ä¿æŠ¤ä¸€ä¸ªèµ„æºå¯ä»¥å—ï¼Ÿæ¥çœ‹ä¸€æ®µç¨‹åº:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnsafeCounter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">counter</span><span class="params">()</span></span>&#123;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çå¤§çœ¼ç›ä»”ç»†çœ‹ï¼Œä¸€ä¸ªé”çš„æ˜¯ thisï¼Œä¸€ä¸ªé”çš„æ˜¯ UnsafeCounter.class, ä»–ä»¬éƒ½æƒ³ä¿æŠ¤å…±äº«å˜é‡ countï¼Œä½ è§‰å¾—å¦‚ä½•ï¼Ÿä¸‹å›¾å°±æ˜¯è¡Œé¢ç¨‹åºçš„æ¨¡å‹å±•ç¤º:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-17/%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%8C%E5%A4%9A%E9%94%81%E4%B8%80%E4%B8%AA%E8%B5%84%E6%BA%90-2.png" alt=""></p><p>ä¸¤ä¸ªä¸´ç•ŒåŒºæ˜¯ç”¨ä¸¤ä¸ªä¸åŒçš„é”æ¥ä¿æŠ¤çš„ï¼Œæ‰€ä»¥ä¸´ç•ŒåŒºæ²¡æœ‰äº’æ–¥å…³ç³»ï¼Œä¹Ÿå°±ä¸èƒ½ä¿æŠ¤ countï¼Œæ‰€ä»¥è¿™æ ·åŠ é”æ˜¯æ— æ„ä¹‰çš„</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>è§£å†³åŸå­æ€§é—®é¢˜ï¼Œå°±æ˜¯è¦äº’æ–¥ï¼Œå°±æ˜¯è¦ä¿è¯ä¸­é—´çŠ¶æ€å¯¹å¤–ä¸å¯è§</li><li>é”æ˜¯è§£å†³åŸå­æ€§é—®é¢˜çš„å…³é”®ï¼Œæ˜ç¡®çŸ¥é“æˆ‘ä»¬é”çš„æ˜¯ä»€ä¹ˆï¼Œè¦ä¿æŠ¤çš„èµ„æºæ˜¯ä»€ä¹ˆï¼Œæ›´é‡è¦çš„è¦çŸ¥é“ä½ çš„é”èƒ½å¦ä¿æŠ¤è¿™ä¸ªå—ä¿æŠ¤çš„èµ„æº(å›¾ä¸­çš„ç®­å¤´æŒ‡å‘)</li><li>æœ‰æ•ˆçš„ä¸´ç•ŒåŒºæ˜¯ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£ï¼Œå¤šä¸ªä¸´ç•ŒåŒºä¿æŠ¤ä¸€ä¸ªèµ„æºï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªèµ„æºæœ‰å¤šä¸ªå¹¶è¡Œçš„å…¥å£å’Œå¤šä¸ªå‡ºå£ï¼Œè¿™å°±æ²¡æœ‰èµ·åˆ°äº’æ–¥çš„ä¿æŠ¤ä½œç”¨ï¼Œä¸´ç•ŒåŒºå½¢åŒè™šè®¾</li><li>é”è‡ªå·±å®¶é—¨èƒ½ä¿æŠ¤èµ„æºå°±æ²¡å¿…è¦é”æ•´ä¸ªå°åŒºï¼Œå¦‚æœé”äº†æ•´ä¸ªå°åŒºï¼Œè¿™ä¸¥é‡å½±å“å…¶ä»–ä¸šä¸»çš„æ´»åŠ¨(é”ç²’åº¦çš„é—®é¢˜)</li></ol><p>æœ¬æ–‡ä»¥ synchronized é”ä¸¾ä¾‹æ¥è¯´æ˜å¦‚ä½•è§£å†³åŸå­æ€§é—®é¢˜ï¼Œä¸»è¦æ˜¯å¸®åŠ©å¤§å®¶å»ºç«‹å®è§‚çš„ç†å¿µï¼Œç”¨äºè§£å†³åŸå­æ€§é—®é¢˜ï¼Œè¿™æ ·åç»­ä½ çœ‹åˆ°æ— è®ºä»€ä¹ˆé”ï¼Œåªè¦è„‘æµ·ä¸­å›æƒ³èµ·æœ¬èŠ‚è¯´æ˜çš„æ¨¡å‹ï¼Œä½ ä¼šå‘ç°éƒ½æ˜¯æ¢æ±¤ä¸æ¢è¯ï¼Œå­¦ä¹ èµ·æ¥å°±éå¸¸è½»æ¾äº†.</p><p>åˆ°è¿™é‡Œå¹¶å‘çš„ä¸‰å¤§é—®é¢˜ æœ‰åºæ€§ï¼Œå¯è§æ€§ï¼ŒåŸå­æ€§éƒ½æœ‰äº†è§£å†³æ–¹æ¡ˆï¼Œè¿™æ˜¯è¿œçœ‹å¹¶å‘ï¼Œè®©å¤§å®¶æœ‰äº†å®è§‚çš„æ¦‚å¿µï¼›ä½†é¢è¯•å’Œå®æˆ˜éƒ½æ˜¯è®²æ±‚ç»†èŠ‚çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”±è¿œåŠè¿‘ï¼Œé€æ­¥çœ‹å¹¶å‘çš„ç»†èŠ‚ï¼Œé¡ºå¸¦è¯´æ˜é‚£äº›é¢è¯•å®˜ç»å¸¸ä¼šé—®åˆ°çš„é—®é¢˜</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>å¤šä¸ªé”é”ä¸€ä¸ªèµ„æºä¸€å®šä¼šæœ‰é—®é¢˜å—ï¼Ÿ</li><li>ä»€ä¹ˆæ—¶å€™éœ€è¦é”å°åŒºï¼Œè€Œä¸èƒ½é”æŸä¸€æˆ·å‘¢ï¼Ÿ</li><li>é“¶è¡Œè½¬è´¦ï¼Œä¸¤äººäº’è½¬å’Œåˆ«äººç»™è‡ªå·±è½¬ï¼Œç”¨ä»€ä¹ˆæ ·çš„é”ç²’åº¦åˆé€‚å‘¢ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/I53l5W_Wl-lMc-_FAeJ6WQ" target="_blank" rel="noopener">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡ </a></li><li><a href="https://mp.weixin.qq.com/s/SrNsvp2NjhAEqYugx6c-3Q" target="_blank" rel="noopener">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a></li><li><a href="https://mp.weixin.qq.com/s/fQcozKziqMxFMBkptpnuTw" target="_blank" rel="noopener">å¹¶å‘Bugä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a></li><li><a href="https://mp.weixin.qq.com/s/074jYZWZODJ5Z2qXyWy4gw" target="_blank" rel="noopener">å¯è§æ€§æœ‰åºæ€§ï¼ŒHappens-beforeæ¥æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/VEWMz9XW95_syiHInUnI0w" target="_blank" rel="noopener">åŸºç¡€é¢è¯•ï¼Œä¸ºä»€ä¹ˆé¢è¯•å®˜æ€»å–œæ¬¢é—®Stringï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰åºæ€§å¯è§æ€§ï¼ŒHappens-beforeæ¥æå®š</title>
      <link href="//p/java-concurrency-happens-before-rule.html"/>
      <url>//p/java-concurrency-happens-before-rule.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://mp.weixin.qq.com/s/fQcozKziqMxFMBkptpnuTw" target="_blank" rel="noopener">å¹¶å‘ Bug ä¹‹æºæœ‰ä¸‰ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…å®ƒä»¬</a> è°ˆåˆ°äº†<code>å¯è§æ€§/åŸå­æ€§/æœ‰åºæ€§</code>ä¸‰ä¸ªé—®é¢˜ï¼Œè¿™äº›é—®é¢˜é€šå¸¸è¿èƒŒæˆ‘ä»¬çš„ç›´è§‰å’Œæ€è€ƒæ¨¡å¼ï¼Œä¹Ÿå°±å¯¼è‡´äº†å¾ˆå¤šå¹¶å‘ Bug</p><ul><li>ä¸ºäº†è§£å†³ CPUï¼Œå†…å­˜ï¼ŒIO çš„çŸ­æ¿ï¼Œå¢åŠ äº†ç¼“å­˜ï¼Œä½†è¿™å¯¼è‡´äº†å¯è§æ€§é—®é¢˜</li><li>ç¼–è¯‘å™¨/å¤„ç†å™¨<code>æ“…è‡ª</code>ä¼˜åŒ– ( Javaä»£ç åœ¨ç¼–è¯‘åä¼šå˜æˆ Java å­—èŠ‚ç , å­—èŠ‚ç è¢«ç±»åŠ è½½å™¨åŠ è½½åˆ° JVM é‡Œ,  JVM æ‰§è¡Œå­—èŠ‚ç ,  æœ€ç»ˆéœ€è¦è½¬åŒ–ä¸ºæ±‡ç¼–æŒ‡ä»¤åœ¨ CPU ä¸Šæ‰§è¡Œ) ï¼Œå¯¼è‡´æœ‰åºæ€§é—®é¢˜</li></ul><p>åˆè¡·æ˜¯å¥½çš„ï¼Œä½†å¼•å‘äº†æ–°é—®é¢˜ï¼Œæœ€æœ‰æ•ˆçš„åŠæ³•å°±ç¦æ­¢ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–ï¼Œé—®é¢˜è™½ç„¶èƒ½è§£å†³ï¼Œä½†ã€Œåˆå›åˆ°æœ€åˆçš„èµ·ç‚¹ï¼Œå‘†å‘†åœ°ç«™åœ¨é•œå­å‰ã€æ˜¯å¾ˆå°´å°¬çš„ï¼Œæˆ‘ä»¬ç¨‹åºçš„æ€§èƒ½å°±å ªå¿§äº†.</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><ol><li>ä½œä¸ºæˆ‘ä»¬ç¨‹åºçŒ¿ä¸æƒ³å†™å‡º bug å½±å“ KPIï¼Œæ‰€ä»¥å¸Œæœ›å†…å­˜æ¨¡å‹æ˜“äºç†è§£ã€æ˜“äºç¼–ç¨‹ã€‚è¿™å°±éœ€è¦åŸºäºä¸€ä¸ª<strong>å¼ºå†…å­˜æ¨¡å‹</strong>æ¥ç¼–å†™ä»£ç </li><li>ä½œä¸ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸æƒ³è®©å¤–äººè¯´å®ƒå¤„ç†é€Ÿåº¦å¾ˆæ…¢ï¼Œæ‰€ä»¥å¸Œæœ›å†…å­˜æ¨¡å‹å¯¹ä»–ä»¬æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œå¯ä»¥ç”±ä»–ä»¬<strong>æ“…è‡ªä¼˜åŒ–</strong>ï¼Œè¿™å°±éœ€è¦åŸºäºä¸€ä¸ª<strong>å¼±å†…å­˜æ¨¡å‹</strong></li></ol><blockquote><p>ä¿—è¯è¯´:ã€Œæ²¡æœ‰ä»€ä¹ˆäº‹æ˜¯å¼€ä¼šè§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰ï¼Œé‚£å°±å†å¼€ä¸€æ¬¡ã€ğŸ˜‚</p></blockquote><p>JSR-133 çš„ä¸“å®¶ä»¬å°±æœ‰äº†æ–°æƒ³æ³•ï¼Œæ—¢ç„¶ä¸èƒ½å®Œå…¨ç¦æ­¢ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–ï¼Œé‚£å°±<strong>æŒ‰éœ€</strong>ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–ï¼ŒæŒ‰éœ€å°±æ˜¯è¦åŠ ä¸€äº›çº¦æŸï¼Œçº¦æŸä¸­å°±åŒ…æ‹¬äº†ä¸Šä¸€ç¯‡æ–‡ç« ç®€å•æåˆ°è¿‡çš„ <strong>volatileï¼Œsynchronizedï¼Œfinal</strong> ä¸‰ä¸ªå…³é”®å­—ï¼ŒåŒæ—¶è¿˜æœ‰ä½ å¯èƒ½å¬è¿‡çš„ <strong>Happens-Before</strong> åŸåˆ™(åŒ…å«å¯è§æ€§å’Œæœ‰åºæ€§çš„çº¦æŸ)ï¼ŒHappens-before è§„åˆ™ä¹Ÿæ˜¯æœ¬ç« çš„ä¸»è¦å†…å®¹</p><p>ä¸ºäº†æ»¡è¶³äºŒè€…çš„å¼ºçƒˆéœ€æ±‚ï¼Œç…§é¡¾åˆ°åŒæ–¹çš„æƒ…ç»ªï¼Œäºæ˜¯ä¹: JMM å°±å¯¹ç¨‹åºçŒ¿è¯´äº†ä¸€ä¸ªå–„æ„çš„è°è¨€: ã€Œä¼šä¸¥æ ¼éµå®ˆ Happpen-Befores è§„åˆ™ï¼Œä¸ä¼šé‡æ’åºã€è®©ç¨‹åºçŒ¿æ”¾å¿ƒï¼Œç§ä¸‹å´æœ‰è‡ªå·±çš„ç­–ç•¥:</p><ol><li>å¯¹äºä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åº,JMMè¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æ’åºã€‚</li><li>å¯¹äºä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åº, JMMå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸åšè¦æ±‚ (JMMå…è®¸è¿™ç§é‡æ’åº)ã€‚</li></ol><p>æˆ‘ä»¬æ¥ç”¨ä¸ªå›¾è¯´æ˜ä¸€ä¸‹:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-05/JMM%E4%BF%9D%E8%AF%81%20%281%29.png" alt=""></p><blockquote><p>è¿™å°±æ˜¯é‚£ä¸ªå–„æ„çš„è°è¨€ï¼Œè™½æ˜¯è°è¨€ï¼Œä½†è¿˜æ˜¯ç…§é¡¾åˆ°äº†ç¨‹åºçŒ¿çš„åˆ©ç›Šï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦äº†è§£ happens-before è§„åˆ™å°±èƒ½å¾—åˆ°ä¿è¯ (å›¾ç”»äº†å¥½ä¹…ï¼Œä¸çŸ¥é“æ˜¯å¦è¯´æ˜äº†è°è¨€çš„æ‰€åœ¨ğŸ˜…ï¼Œæ¬¢è¿ç•™è¨€)</p></blockquote><h2 id="Happens-before"><a href="#Happens-before" class="headerlink" title="Happens-before"></a>Happens-before</h2><p>Happens-before è§„åˆ™ä¸»è¦ç”¨æ¥çº¦æŸä¸¤ä¸ªæ“ä½œï¼Œä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰ happens-before å…³ç³», å¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼Œ<strong>happens-before ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œ(æ‰§è¡Œçš„ç»“æœ)å¯¹åä¸€ä¸ªæ“ä½œå¯è§</strong>,   (the first is <strong>visible</strong> to and ordered before the second)</p><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå…ˆæ¥çœ‹ä¸€å°æ®µä»£ç å¸¦ä½ é€æ­¥èµ°è¿› Happen-Befores åŸåˆ™ï¼Œçœ‹çœ‹æ˜¯æ€æ ·ç”¨è¯¥åŸåˆ™è§£å†³ <strong>å¯è§æ€§</strong> å’Œ <strong>æœ‰åºæ€§</strong> çš„é—®é¢˜:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReorderExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    x = <span class="number">42</span>;    <span class="comment">//1</span></span><br><span class="line">    flag = <span class="keyword">true</span>;    <span class="comment">//2</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123; <span class="comment">//3</span></span><br><span class="line">      System.out.println(x);    <span class="comment">//4</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾ A çº¿ç¨‹æ‰§è¡Œ writer æ–¹æ³•ï¼ŒB çº¿ç¨‹æ‰§è¡Œ reader æ–¹æ³•ï¼Œæ‰“å°å‡ºæ¥çš„ x å¯èƒ½ä¼šæ˜¯ 0ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è¯´æ˜è¿‡: å› ä¸ºä»£ç  1 å’Œ 2 æ²¡æœ‰<strong>æ•°æ®ä¾èµ–</strong>å…³ç³»ï¼Œæ‰€ä»¥å¯èƒ½è¢«é‡æ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="keyword">true</span>;    <span class="comment">//2</span></span><br><span class="line">x = <span class="number">42</span>;    <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œçº¿ç¨‹ A å°† <code>flag = true</code> å†™å…¥<strong>ä½†æ²¡æœ‰ä¸º x é‡æ–°èµ‹å€¼æ—¶</strong>ï¼Œçº¿ç¨‹ B å¯èƒ½å°±å·²ç»æ‰“å°äº† x æ˜¯ 0</p><p>é‚£ä¹ˆä¸º flag åŠ ä¸Š volatile å…³é”®å­—è¯•ä¸€ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br></pre></td></tr></table></figure><p><em>å³ä¾¿åŠ ä¸Šäº† volatile å…³é”®å­—ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ java1.5 ä¹‹å‰è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Œä½† java1.5 å’Œå…¶ä¹‹åçš„ç‰ˆæœ¬å¯¹ volatile è¯­ä¹‰åšäº†å¢å¼º</em>ï¼Œé—®é¢˜å¾—ä»¥è§£å†³ï¼Œè¿™å°±ç¦»ä¸å¼€ Happens-before è§„åˆ™çš„çº¦æŸäº†ï¼Œæ€»å…±æœ‰ 6 ä¸ªè§„åˆ™ï¼Œä¸”çœ‹</p><h3 id="ç¨‹åºé¡ºåºæ€§è§„åˆ™"><a href="#ç¨‹åºé¡ºåºæ€§è§„åˆ™" class="headerlink" title="ç¨‹åºé¡ºåºæ€§è§„åˆ™"></a>ç¨‹åºé¡ºåºæ€§è§„åˆ™</h3><blockquote><p> <strong>ä¸€ä¸ªçº¿ç¨‹ä¸­</strong>çš„æ¯ä¸ªæ“ä½œ, happens-before äºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œ<br>ç¬¬ä¸€æ„Ÿè§‰è¿™ä¸ªåŸåˆ™æ˜¯ä¸€ä¸ªåœ¨ç†æƒ³çŠ¶æ€ä¸‹çš„â€åºŸè¯â€ï¼Œå¹¶ä¸”å’Œä¸Šé¢æåˆ°çš„ä¼šå‡ºç°é‡æ’åºçš„æƒ…å†µæ˜¯çŸ›ç›¾çš„ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ“ä½œï¼Œå…¶å®éšå«äº†ã€Œas-if-serialã€è¯­ä¹‰: è¯´ç™½äº†å°±æ˜¯åªè¦æ‰§è¡Œç»“æœä¸è¢«æ”¹å˜ï¼Œæ— è®ºæ€ä¹ˆâ€æ’åºâ€ï¼Œéƒ½æ˜¯å¯¹çš„</p></blockquote><p>è¿™ä¸ªè§„åˆ™æ˜¯ä¸€ä¸ªåŸºç¡€è§„åˆ™ï¼Œhappens-before æ˜¯å¤šçº¿ç¨‹çš„è§„åˆ™ï¼Œæ‰€ä»¥è¦å’Œå…¶ä»–è§„åˆ™çº¦æŸåœ¨ä¸€èµ·æ‰èƒ½ä½“ç°å‡ºå®ƒçš„é¡ºåºæ€§ï¼Œåˆ«ç€æ€¥ï¼Œç»§ç»­å‘ä¸‹çœ‹</p><h3 id="volatileå˜é‡è§„åˆ™"><a href="#volatileå˜é‡è§„åˆ™" class="headerlink" title="volatileå˜é‡è§„åˆ™"></a>volatileå˜é‡è§„åˆ™</h3><blockquote><p> å¯¹ä¸€ä¸ª volatile åŸŸçš„å†™, happens-before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»</p></blockquote><p>æˆ‘å°†ä¸Šé¢çš„ç¨‹åºæ·»åŠ ä¸¤è¡Œä»£ç ä½œè¯´æ˜:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReorderExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span>&#123;</span><br><span class="line">x = <span class="number">42</span>;<span class="comment">//1</span></span><br><span class="line">y = <span class="number">50</span>;<span class="comment">//2</span></span><br><span class="line">flag = <span class="keyword">true</span>;<span class="comment">//3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (flag)&#123;<span class="comment">//4</span></span><br><span class="line">System.out.println(<span class="string">"x:"</span> + x);<span class="comment">//5</span></span><br><span class="line">System.out.println(<span class="string">"y:"</span> + y);<span class="comment">//6</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠåˆ°äº† volatile çš„å†…å­˜å¢å¼ºè¯­ä¹‰ï¼Œå…ˆæ¥çœ‹ä¸ªè¡¨æ ¼:</p><table><thead><tr><th>èƒ½å¦é‡æ’åº</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th></tr></thead><tbody><tr><td>ç¬¬ä¸€ä¸ªæ“ä½œ</td><td>æ™®é€šè¯»/å†™</td><td>volatile è¯»</td><td>volatile å†™</td></tr><tr><td>æ™®é€šè¯»/å†™</td><td>-</td><td>-</td><td>NO</td></tr><tr><td>volatile è¯»</td><td>NO</td><td>NO</td><td>NO</td></tr><tr><td>volatile å†™</td><td>-</td><td>NO</td><td>NO</td></tr></tbody></table><p>ä»è¿™ä¸ªè¡¨æ ¼ <strong>æœ€åä¸€åˆ—</strong> å¯ä»¥çœ‹å‡º:</p><blockquote><p> å¦‚æœç¬¬äºŒä¸ªæ“ä½œä¸º volatile å†™ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºï¼Œ<strong>è¿™å°±ç¡®ä¿äº† volatile å†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ° volatile å†™ä¹‹å</strong><br>æ‹¿ä¸Šé¢çš„ä»£ç æ¥è¯´ï¼Œä»£ç  1 å’Œ 2 ä¸ä¼šè¢«é‡æ’åºåˆ°ä»£ç  3 çš„åé¢ï¼Œä½†ä»£ç  1 å’Œ 2 å¯èƒ½è¢«é‡æ’åº (æ²¡æœ‰ä¾èµ–ä¹Ÿä¸ä¼šå½±å“åˆ°æ‰§è¡Œç»“æœ)ï¼Œè¯´åˆ°è¿™é‡Œå’Œ <strong>ç¨‹åºé¡ºåºæ€§è§„åˆ™</strong>æ˜¯ä¸æ˜¯å°±å·²ç»å…³è”èµ·æ¥äº†å‘¢ï¼Ÿ</p></blockquote><p>ä»è¿™ä¸ªè¡¨æ ¼çš„ <strong>å€’æ•°ç¬¬äºŒè¡Œ</strong> å¯ä»¥çœ‹å‡º:</p><blockquote><p> å¦‚æœç¬¬ä¸€ä¸ªæ“ä½œä¸º volatile è¯»ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºï¼Œ<strong>è¿™ç¡®ä¿äº† volatile è¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ° volatile è¯»ä¹‹å‰</strong><br>æ‹¿ä¸Šé¢çš„ä»£ç æ¥è¯´ï¼Œä»£ç  4 æ˜¯è¯»å– volatile å˜é‡ï¼Œä»£ç  5 å’Œ 6 ä¸ä¼šè¢«é‡æ’åºåˆ°ä»£ç  4 ä¹‹å‰</p></blockquote><p><em>volatile å†…å­˜è¯­ä¹‰çš„å®ç°æ˜¯åº”ç”¨åˆ°äº† ã€Œå†…å­˜å±éšœã€ï¼Œå› ä¸ºè¿™å®Œå…¨å¤Ÿå•ç‹¬å†™ä¸€ç« çš„å†…å®¹ï¼Œè¿™é‡Œä¸ºäº†ä¸æ©ç›–ä¸»è§’ Happens-before çš„å…‰ç¯ï¼Œä¿æŒç†è§£ Happens-before çš„è¿ç»­æ€§ï¼Œå…ˆä¸åšè¿‡å¤šè¯´æ˜</em></p><p>åˆ°è¿™é‡Œï¼Œçœ‹è¿™ä¸ªè§„åˆ™ï¼Œè²Œä¼¼ä¹Ÿæ²¡è§£å†³å•¥é—®é¢˜ï¼Œå› ä¸ºå®ƒè¿˜è¦è”åˆç¬¬ä¸‰ä¸ªè§„åˆ™æ‰èµ·ä½œç”¨</p><h3 id="ä¼ é€’æ€§è§„åˆ™"><a href="#ä¼ é€’æ€§è§„åˆ™" class="headerlink" title="ä¼ é€’æ€§è§„åˆ™"></a>ä¼ é€’æ€§è§„åˆ™</h3><blockquote><p> å¦‚æœ A happens-before B, ä¸” B happens-before C, é‚£ä¹ˆ A happens-before C<br>ç›´æ¥ä¸Šå›¾è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-09-05/%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E5%9B%BE.png" alt=""></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º</p><ul><li><code>x =42</code> å’Œ <code>y = 50</code> Happens-before <code>flag = true</code>, è¿™æ˜¯<strong>è§„åˆ™ 1</strong></li><li>å†™å˜é‡(ä»£ç  3) <code>flag=true</code> Happens-before è¯»å˜é‡(ä»£ç  4) <code>if(flag)</code>ï¼Œè¿™æ˜¯<strong>è§„åˆ™ 2</strong></li></ul><p>æ ¹æ®<strong>è§„åˆ™ 3</strong>ä¼ é€’æ€§è§„åˆ™ï¼Œ<code>x =42</code> Happens-before è¯»å˜é‡ <code>if(flag)</code></p><blockquote><p><strong>è°œæ¡ˆè¦æ­æ™“äº†</strong>: å¦‚æœçº¿ç¨‹ B è¯»åˆ°äº† flag æ˜¯ trueï¼Œé‚£ä¹ˆ <code>x =42</code> å’Œ <code>y = 50</code> å¯¹çº¿ç¨‹ B å°±ä¸€å®šå¯è§äº†ï¼Œè¿™å°±æ˜¯ Java1.5 çš„å¢å¼º (ä¹‹å‰ç‰ˆæœ¬æ˜¯å¯ä»¥æ™®é€šå˜é‡å†™å’Œ volatile å˜é‡å†™çš„é‡æ’åºçš„)</p></blockquote><p>é€šå¸¸ä¸Šé¢ä¸‰ä¸ªè§„åˆ™æ˜¯ä¸€ç§è”åˆçº¦æŸï¼Œåˆ°è¿™é‡Œä½ æ‡‚äº†å—ï¼Ÿè§„åˆ™è¿˜æ²¡å®Œï¼Œç»§ç»­çœ‹</p><h3 id="ç›‘è§†å™¨é”è§„åˆ™"><a href="#ç›‘è§†å™¨é”è§„åˆ™" class="headerlink" title="ç›‘è§†å™¨é”è§„åˆ™"></a>ç›‘è§†å™¨é”è§„åˆ™</h3><blockquote><p> å¯¹ä¸€ä¸ªé”çš„è§£é” happens-before äºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”</p></blockquote><p>è¿™ä¸ªè§„åˆ™æˆ‘è§‰å¾—ä½ åº”è¯¥æœ€ç†Ÿæ‚‰äº†ï¼Œå°±æ˜¯è§£é‡Š synchronized å…³é”®å­—çš„ï¼Œæ¥çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synBlock</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// 1.åŠ é”</span></span><br><span class="line"><span class="keyword">synchronized</span> (SynchronizedExample.class)&#123;</span><br><span class="line">x = <span class="number">1</span>; <span class="comment">// å¯¹xèµ‹å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.è§£é”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŠ é”</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">synMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">x = <span class="number">2</span>; <span class="comment">// å¯¹xèµ‹å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3. è§£é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆè·å–é”çš„çº¿ç¨‹ï¼Œå¯¹ x èµ‹å€¼ä¹‹åé‡Šæ”¾é”ï¼Œå¦å¤–ä¸€ä¸ªå†è·å–é”ï¼Œä¸€å®šèƒ½çœ‹åˆ°å¯¹ x èµ‹å€¼çš„æ”¹åŠ¨ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œè¯·å°ä¼™ä¼´ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ä¸Šé¢ç¨‹åºï¼Œçœ‹åŒæ­¥å—å’ŒåŒæ­¥æ–¹æ³•è¢«è½¬æ¢æˆæ±‡ç¼–æŒ‡ä»¤æœ‰ä½•ä¸åŒï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -c -v SynchronizedExample</span><br></pre></td></tr></table></figure><p>è¿™å’Œ synchronized çš„è¯­ä¹‰ç›¸å…³ï¼Œå°ä¼™ä¼´å¯ä»¥å…ˆè‡ªè¡Œäº†è§£ä¸€ä¸‹ï¼Œé”çš„å†…å®¹æ—¶ä¼šåšè¯¦ç»†è¯´æ˜</p><h3 id="start-è§„åˆ™"><a href="#start-è§„åˆ™" class="headerlink" title="start()è§„åˆ™"></a>start()è§„åˆ™</h3><blockquote><p> å¦‚æœçº¿ç¨‹ A æ‰§è¡Œæ“ä½œ ThreadB.start() (å¯åŠ¨çº¿ç¨‹B),  é‚£ä¹ˆ A çº¿ç¨‹çš„ ThreadB.start() æ“ä½œ happens-before äºçº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»çº¿ç¨‹ A å¯åŠ¨å­çº¿ç¨‹ B åï¼Œå­çº¿ç¨‹ B èƒ½çœ‹åˆ°ä¸»çº¿ç¨‹åœ¨å¯åŠ¨å­çº¿ç¨‹ B å‰çš„æ“ä½œï¼Œçœ‹ä¸ªç¨‹åºå°±ç§’æ‡‚äº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartExample</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">StartExample startExample = <span class="keyword">new</span> StartExample();</span><br><span class="line"></span><br><span class="line">Thread thread1 = <span class="keyword">new</span> Thread(startExample::writer, <span class="string">"çº¿ç¨‹1"</span>);</span><br><span class="line">startExample.x = <span class="number">10</span>;</span><br><span class="line">startExample.y = <span class="number">20</span>;</span><br><span class="line">startExample.flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">thread1.start();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"ä¸»çº¿ç¨‹ç»“æŸ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"x:"</span> + x );</span><br><span class="line">System.out.println(<span class="string">"y:"</span> + y );</span><br><span class="line">System.out.println(<span class="string">"flag:"</span> + flag );</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¸»çº¿ç¨‹ç»“æŸ</span><br><span class="line">x:10</span><br><span class="line">y:20</span><br><span class="line">flag:true</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ 1 çœ‹åˆ°äº†ä¸»çº¿ç¨‹è°ƒç”¨ thread1.start() ä¹‹å‰çš„æ‰€æœ‰èµ‹å€¼ç»“æœï¼Œè¿™é‡Œæ²¡æœ‰æ‰“å°ã€Œä¸»çº¿ç¨‹ç»“æŸã€ï¼Œä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿè¿™ä¸ªå®ˆæŠ¤çº¿ç¨‹çŸ¥è¯†æœ‰å…³ç³»</p><h3 id="join-è§„åˆ™"><a href="#join-è§„åˆ™" class="headerlink" title="join()è§„åˆ™"></a>join()è§„åˆ™</h3><blockquote><p>å¦‚æœçº¿ç¨‹ A æ‰§è¡Œæ“ä½œ ThreadB.join() å¹¶æˆåŠŸè¿”å›, é‚£ä¹ˆçº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œ happens-before äºçº¿ç¨‹ A ä» ThreadB.join() æ“ä½œæˆåŠŸè¿”å›ï¼Œ<strong>å’Œ start è§„åˆ™åˆšå¥½ç›¸å</strong>ï¼Œä¸»çº¿ç¨‹ A ç­‰å¾…å­çº¿ç¨‹ B å®Œæˆï¼Œå½“å­çº¿ç¨‹ B å®Œæˆåï¼Œä¸»çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°å­çº¿ç¨‹ B çš„èµ‹å€¼æ“ä½œï¼Œå°†ç¨‹åºåšä¸ªå°æ”¹åŠ¨ï¼Œä½ ä¹Ÿä¼šç§’æ‡‚çš„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinExample</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">JoinExample joinExample = <span class="keyword">new</span> JoinExample();</span><br><span class="line"></span><br><span class="line">Thread thread1 = <span class="keyword">new</span> Thread(joinExample::writer, <span class="string">"çº¿ç¨‹1"</span>);</span><br><span class="line">thread1.start();</span><br><span class="line"></span><br><span class="line">thread1.join();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"x:"</span> + joinExample.x );</span><br><span class="line">System.out.println(<span class="string">"y:"</span> + joinExample.y );</span><br><span class="line">System.out.println(<span class="string">"flag:"</span> + joinExample.flag );</span><br><span class="line">System.out.println(<span class="string">"ä¸»çº¿ç¨‹ç»“æŸ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.x = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">this</span>.y = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x:100</span><br><span class="line">y:200</span><br><span class="line">flag:true</span><br><span class="line">ä¸»çº¿ç¨‹ç»“æŸ</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p>ã€Œä¸»çº¿ç¨‹ç»“æŸã€è¿™å‡ ä¸ªå­—æ‰“å°å‡ºæ¥å–½ï¼Œä¾æ—§å’Œçº¿ç¨‹ä½•æ—¶é€€å‡ºæœ‰å…³ç³»</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li><strong>Happens-before é‡ç‚¹æ˜¯è§£å†³å‰ä¸€ä¸ªæ“ä½œç»“æœå¯¹åä¸€ä¸ªæ“ä½œå¯è§</strong>ï¼Œç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯¹ Happens-before è§„åˆ™æœ‰æ‰€äº†è§£ï¼Œè¿™äº›è§„åˆ™è§£å†³äº†å¤šçº¿ç¨‹ç¼–ç¨‹çš„å¯è§æ€§ä¸æœ‰åºæ€§é—®é¢˜ï¼Œä½†è¿˜æ²¡æœ‰å®Œå…¨è§£å†³åŸå­æ€§é—®é¢˜(é™¤äº† synchronized)</li><li>start å’Œ join è§„åˆ™ä¹Ÿæ˜¯è§£å†³ä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹é€šä¿¡çš„æ–¹å¼ä¹‹ä¸€</li><li>ä»å†…å­˜è¯­ä¹‰çš„è§’åº¦æ¥è¯´, volatile çš„<code>å†™-è¯»</code>ä¸é”çš„<code>é‡Šæ”¾-è·å–</code>æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæœï¼›volatile å†™å’Œé”çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰; volatile è¯»ä¸é”çš„è·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼Œâš ï¸âš ï¸âš ï¸(æ•²é»‘æ¿äº†) volatile è§£å†³çš„æ˜¯å¯è§æ€§é—®é¢˜ï¼Œsynchronized è§£å†³çš„æ˜¯åŸå­æ€§é—®é¢˜ï¼Œè¿™ç»å¯¹ä¸æ˜¯ä¸€å›äº‹ï¼Œåç»­æ–‡ç« ä¹Ÿä¼šè¯´æ˜</li></ol><h2 id="é™„åŠ è¯´æ˜"><a href="#é™„åŠ è¯´æ˜" class="headerlink" title="é™„åŠ è¯´æ˜"></a>é™„åŠ è¯´æ˜</h2><ol><li>ä¸ªäººåšå®¢ä¼šé¦–å‘åŸåˆ›æ–‡ç« ï¼Œå¦‚æ–‡ç« æœ‰å¯†ç ä¿æŠ¤ï¼Œé€šè¿‡æŸ¥çœ‹æ–‡ç« çš„<strong>åˆ›å»ºæ—¥æœŸ</strong>ï¼Œå¦‚æœæ˜¯ 1 æœˆä»½ï¼Œè¯·å…¬ä¼—å·å›å¤å½“å‰æœˆä»½æ•°å€¼å³å¯ï¼Œå¦‚å›å¤ã€Œ1ã€</li><li>å¤šçº¿ç¨‹ç³»åˆ—æ–‡ç« æ•´ä½“ä¼šæŒ‰ç…§æˆ‘çš„å¤§çº²èŠ‚å¥æ¥å†™ï¼Œä½†æ˜¯å¦‚æœå¤§å®¶æœ‰ä»€ä¹ˆç–‘é—®ï¼Œä¹Ÿæ¬¢è¿åˆ°æˆ‘å•ç‹¬å»ºç«‹çš„<a href="https://dayarch.top/2019/09/11/duo-xian-cheng-xi-lie-wen-ti-liu-yan-hui-zong/">å¤šçº¿ç¨‹ç³»åˆ—é—®é¢˜ç•™è¨€æ±‡æ€»</a> æ–‡ç« ä¸­ç•™è¨€ï¼Œæˆ‘ä¼šç»Ÿä¸€å›å¤ï¼Œå¦‚æœå…±é€šç–‘é—®å¾ˆå¤šï¼Œæˆ‘ä¼šæ’å…¥ç›¸å…³ç« èŠ‚å•ç‹¬åšè¯´æ˜</li><li>å¹¶å‘æ–‡ç« çš„ç›¸å…³ä»£ç ï¼Œæˆ‘ä¹Ÿä¼šåŒæ­¥ä¸Šä¼ åˆ°ä»£ç åº“ï¼Œå…¬ä¼—å·å›å¤ã€Œdemoã€ï¼Œç‚¹å‡»é“¾æ¥ï¼Œæ‰¾åˆ°concurrency å­é¡¹ç›®å³å¯</li><li>å¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œçƒ¦è¯·å°ä¼™ä¼´è½¬å‘åˆ†äº«ç»™æ›´å¤šæœ‹å‹ï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥</li></ol><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>åŒæ­¥å—å’ŒåŒæ­¥æ–¹æ³•åœ¨ç¼–è¯‘æˆ CPU æŒ‡ä»¤åæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</li><li>çº¿ç¨‹æœ‰ Daemon(å®ˆæŠ¤çº¿ç¨‹)å’Œé Daemon çº¿ç¨‹ï¼Œä½ çŸ¥é“çº¿ç¨‹çš„é€€å‡ºç­–ç•¥å—ï¼Ÿ</li><li>å…³äº Happens-before ä½ è¿˜æœ‰å“ªäº›ç–‘æƒ‘å‘¢ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><h3 id="MarkDown-è¡¨æ ¼ç”Ÿæˆå™¨"><a href="#MarkDown-è¡¨æ ¼ç”Ÿæˆå™¨" class="headerlink" title="MarkDown è¡¨æ ¼ç”Ÿæˆå™¨"></a>MarkDown è¡¨æ ¼ç”Ÿæˆå™¨</h3><p>æœ¬æ–‡çš„å¥½å¤šè¡¨æ ¼æ˜¯ä»å®˜ç½‘ç²˜è´´çš„ï¼Œå¦‚ä½•å°†å…¶ç›´æ¥è½¬æ¢æˆ MD table å‘¢ï¼Ÿé‚£ä¹ˆ <a href="https://www.tablesgenerator.com/markdown_tables" target="_blank" rel="noopener">https://www.tablesgenerator.com/markdown_tables</a> å°±å¯ä»¥å¸®åˆ°ä½ äº†ï¼Œæ— è®ºæ˜¯ç”Ÿæˆ MD tableï¼Œè¿˜æ˜¯ç²˜è´´å†…å®¹ç”Ÿæˆ table å’Œå†…å®¹éƒ½æ˜¯æå¥½çš„ï¼Œå½“ç„¶äº†ä¸æ­¢ MD tableï¼Œè‡ªå·±å‘ç°å§ï¼Œæ›´å¤šå·¥å…·ï¼Œå…¬ä¼—å·å›å¤ ã€Œå·¥å…·ã€è·å¾—</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-10-52-55.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/q5cyK14WGiMm-R6NIFBcTg" target="_blank" rel="noopener">æ¯å¤©ç”¨SpringBootï¼Œè¿˜ä¸æ‡‚RESTful APIè¿”å›ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/ilND8u_8HGSTSrJiMB4X8g" target="_blank" rel="noopener">çº¢é»‘æ ‘ï¼Œè¶…å¼ºåŠ¨é™å›¾è¯¦è§£ï¼Œç®€å•æ˜“æ‡‚</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> Happens-before </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹ä¸‰å¤§é—®é¢˜</title>
      <link href="//p/java-concurrency-three-questions.html"/>
      <url>//p/java-concurrency-three-questions.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><blockquote><ul><li>ç”Ÿæ´»ä¸­ä½ ä¸€å®šå¬è¯´è¿‡â€”â€”èƒ½è€…å¤šåŠ³</li><li>ä½œä¸º Java ç¨‹åºå‘˜ï¼Œä½ ä¸€å®šå¬è¿‡â€”â€”è¿™ä¸ªåŠŸèƒ½è¯·æ±‚æ…¢ï¼Œèƒ½åŠ ä¸€å±‚ç¼“å­˜æˆ–ä¼˜åŒ–ä¸€ä¸‹ SQL å—ï¼Ÿ</li><li>çœ‹è¿‡ä¸­å›½å¤ä»£ç¥è¯æ•…äº‹çš„ä¹Ÿä¸€å®šå¬è¿‡â€”â€”å¤©ä¸Šä¸€å¤©ï¼Œåœ°ä¸Šä¸€å¹´</li></ul></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/scotland-540119_1920.jpg" alt=""></p><p>ä¸€åˆ‡è®¾è®¡æ¥æºäºç”Ÿæ´»ï¼Œä¸Šä¸€ç«  <a href="https://mp.weixin.qq.com/s/SrNsvp2NjhAEqYugx6c-3Q" target="_blank" rel="noopener">å­¦å¹¶å‘ç¼–ç¨‹ï¼Œé€å½»ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ˜¯å…³é”®</a>  ä¸­æœ‰è®²è¿‡ï¼Œä½œä¸ºâ€èµ„æœ¬å®¶â€ï¼Œä½ è¦å°½å¯èƒ½çš„æ¦¨å– CPUï¼Œå†…å­˜ä¸ IO çš„å‰©ä½™ä»·å€¼ï¼Œä½†ä¸‰è€…å®Œæˆä»»åŠ¡çš„é€Ÿåº¦ç›¸å·®å¾ˆå¤§ï¼ŒCPU &gt; å†…å­˜ &gt; IOåˆ†ï¼ŒCPU æ˜¯å¤©ï¼Œé‚£å†…å­˜å°±æ˜¯åœ°ï¼Œå†…å­˜æ˜¯å¤©ï¼Œé‚£ IO å°±æ˜¯åœ°ï¼Œé‚£æ€æ ·å¹³è¡¡ä¸‰è€…ï¼Œæå‡æ•´ä½“é€Ÿåº¦å‘¢ï¼Ÿ</p><ol><li>CPU å¢åŠ ç¼“å­˜ï¼Œè¿˜ä¸æ­¢ä¸€å±‚ç¼“å­˜ï¼Œå¹³è¡¡å†…å­˜çš„æ…¢</li><li>CPU èƒ½è€…å¤šåŠ³ï¼Œé€šè¿‡åˆ†æ—¶å¤ç”¨ï¼Œå¹³è¡¡ IO çš„é€Ÿåº¦å·®å¼‚</li><li>ä¼˜åŒ–ç¼–è¯‘æŒ‡ä»¤</li></ol><p>ä¸Šé¢çš„æ–¹å¼è²Œä¼¼è§£å†³äº†æœ¨æ¡¶çŸ­æ¿é—®é¢˜ï¼Œä½†åŒæ—¶è¿™ç§è§£å†³æ–¹æ¡ˆä¹Ÿä¼´éšç€äº§ç”Ÿæ–°çš„<strong>å¯è§æ€§ï¼ŒåŸå­æ€§ï¼Œå’Œæœ‰åºæ€§</strong>çš„é—®é¢˜ï¼Œä¸”çœ‹</p><h2 id="ä¸‰å¤§é—®é¢˜"><a href="#ä¸‰å¤§é—®é¢˜" class="headerlink" title="ä¸‰å¤§é—®é¢˜"></a>ä¸‰å¤§é—®é¢˜</h2><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><p><strong>ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ï¼Œæˆ‘ä»¬ç§°ä¸ºå¯è§æ€§</strong></p><p>è°ˆåˆ°å¯è§æ€§ï¼Œè¦å…ˆå¼•å‡º JMM (Java Memory Model) æ¦‚å¿µ, å³ Java å†…å­˜æ¨¡å‹ï¼ŒJava å†…å­˜æ¨¡å‹è§„å®šï¼Œå°†æ‰€æœ‰çš„å˜é‡éƒ½å­˜æ”¾åœ¨ <strong>ä¸»å†…å­˜</strong> ä¸­ï¼Œå½“çº¿ç¨‹ä½¿ç”¨å˜é‡æ—¶ï¼Œä¼šæŠŠä¸»å†…å­˜é‡Œé¢çš„å˜é‡ <strong>å¤åˆ¶</strong> åˆ°è‡ªå·±çš„å·¥ä½œç©ºé—´æˆ–è€…å«ä½œ <strong>ç§æœ‰å†…å­˜</strong> ï¼Œçº¿ç¨‹è¯»å†™å˜é‡æ—¶æ“ä½œçš„æ˜¯è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ã€‚</p><p>ç”¨ Git çš„å·¥ä½œæµç¨‹ç†è§£ä¸Šé¢çš„æè¿°å°±å¾ˆç®€å•äº†ï¼Œ<strong>Git è¿œç¨‹ä»“åº“å°±æ˜¯ä¸»å†…å­˜ï¼ŒGit æœ¬åœ°ä»“åº“å°±æ˜¯è‡ªå·±çš„å·¥ä½œå†…å­˜</strong></p><p>æ–‡å­—æè¿°æœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬æ¥å›¾è§£è¯´æ˜:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/Untitled%20Diagram%20%281%29.png" alt=""></p><p>çœ‹è¿™ä¸ªåœºæ™¯:</p><blockquote><ol><li>ä¸»å†…å­˜ä¸­æœ‰å˜é‡ xï¼Œåˆå§‹å€¼ä¸º 0</li><li>çº¿ç¨‹ A è¦å°† x åŠ  1ï¼Œå…ˆå°† x=0 æ‹·è´åˆ°è‡ªå·±çš„ç§æœ‰å†…å­˜ä¸­ï¼Œç„¶åæ›´æ–° x çš„å€¼</li><li><strong>çº¿ç¨‹ A å°†æ›´æ–°åçš„ x å€¼å›åˆ·åˆ°ä¸»å†…å­˜çš„æ—¶é—´æ˜¯ä¸å›ºå®šçš„</strong></li><li>åˆšå¥½åœ¨çº¿ç¨‹ A æ²¡æœ‰å›åˆ· x åˆ°ä¸»å†…å­˜æ—¶ï¼Œçº¿ç¨‹ B åŒæ ·ä»ä¸»å†…å­˜ä¸­è¯»å– xï¼Œæ­¤æ—¶ä¸º 0ï¼Œå’Œçº¿ç¨‹ A ä¸€æ ·çš„æ“ä½œï¼Œæœ€åæœŸç›¼çš„ x=2 å°±ä¼šç¼–ç¨‹ x=1</li></ol></blockquote><p>è¿™å°±æ˜¯çº¿ç¨‹å¯è§æ€§çš„é—®é¢˜</p><p>JMM æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œåœ¨å®é™…å®ç°ä¸­ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜æ˜¯è¿™æ ·çš„:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/Untitled%20Diagram%20%282%29.png" alt=""></p><p>ä¸ºäº†å¹³è¡¡å†…å­˜/IO çŸ­æ¿ï¼Œä¼šåœ¨ CPU ä¸Šå¢åŠ ç¼“å­˜ï¼Œæ¯ä¸ªæ ¸éƒ½åªæœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼Œç”šè‡³æœ‰ä¸€ä¸ªæ‰€æœ‰ CPU éƒ½å…±äº«çš„äºŒçº§ç¼“å­˜ï¼Œå°±æ˜¯ä¸Šå›¾çš„æ ·å­äº†ï¼Œéƒ½è¯´è¿™ä¹ˆè®¾è®¡æ˜¯ç¡¬ä»¶åŒå­¦ç•™ç»™è½¯ä»¶åŒå­¦çš„ä¸€ä¸ªå‘ï¼Œä½†èƒ½å¦è·³è¿‡å»è¿™ä¸ªå‘ä¹Ÿæ˜¯è¡¡é‡è½¯ä»¶åŒå­¦æ˜¯å¦èµ°å‘ Java è¿›é˜¶çš„å…³é”®æŒ‡æ ‡å§â€¦â€¦</p><blockquote><h4 id="å°æç¤º"><a href="#å°æç¤º" class="headerlink" title="å°æç¤º"></a>å°æç¤º</h4><p>ä»ä¸Šå›¾ä¸­ä½ ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å®ä¾‹åŸŸï¼Œé™æ€åŸŸå’Œæ•°ç»„å…ƒç´ éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼Œå †å†…å­˜åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œè¿™äº›åœ¨åç»­æ–‡ç« ä¸­éƒ½ç§°ä¹‹ä¸ºã€Œå…±äº«å˜é‡ã€ï¼Œå±€éƒ¨å˜é‡ï¼Œæ–¹æ³•å®šä¹‰å‚æ•°å’Œå¼‚å¸¸å¤„ç†å™¨å‚æ•°ä¸ä¼šåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œæ‰€ä»¥ä»–ä»¬ä¸ä¼šæœ‰å†…å­˜å¯è§æ€§çš„é—®é¢˜ï¼Œä¹Ÿå°±ä¸å—å†…å­˜æ¨¡å‹çš„å½±å“</p></blockquote><p><strong>ä¸€å¥è¯ï¼Œè¦æƒ³è§£å†³å¤šçº¿ç¨‹å¯è§æ€§é—®é¢˜ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¿…é¡»è¦åˆ·å–ä¸»å†…å­˜ä¸­çš„å˜é‡</strong><br>æ€ä¹ˆè§£å†³å¯è§æ€§é—®é¢˜å‘¢ï¼ŸJava å…³é”®å­— <strong>volatile</strong> å¸®ä½ æå®šï¼Œåç»­ç« èŠ‚ä¼šåˆ†æâ€¦â€¦</p><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><p>åŸå­ï¼ˆatomï¼‰æŒ‡åŒ–å­¦ååº”ä¸å¯å†åˆ†çš„åŸºæœ¬å¾®ç²’ï¼ŒåŸå­æ€§æ“ä½œä½ åº”è¯¥èƒ½æ„Ÿå—åˆ°å…¶å«ä¹‰:</p><blockquote><p> æ‰€è°“åŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch</p></blockquote><p>å°å“ã€Œé’Ÿç‚¹å·¥ã€æœ‰ä¸€å¥éå¸¸ç»å…¸çš„å°è¯ï¼Œè¦æŠŠå¤§è±¡è£…å†°ç®±ï¼Œæ€»å…±åˆ†å‡ æ­¥ï¼Ÿ</p><p>æ¥çœ‹ä¸€å°æ®µç¨‹åº:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/2019-09-04-15-47-39%402x.png" alt=""></p><p>å¤šçº¿ç¨‹æƒ…å†µä¸‹èƒ½å¾—åˆ°æˆ‘ä»¬æœŸç›¼çš„ <code>count = 20000</code> çš„å€¼å—ï¼Ÿ ä¹Ÿè®¸æœ‰åŒå­¦ä¼šè®¤ä¸ºï¼Œçº¿ç¨‹è°ƒç”¨çš„ counter æ–¹æ³•åªæœ‰ä¸€ä¸ª count++ æ“ä½œï¼Œæ˜¯å•ä¸€æ“ä½œï¼Œæ‰€ä»¥æ˜¯åŸå­æ€§çš„ï¼Œéä¹Ÿã€‚åœ¨çº¿ç¨‹ç¬¬ä¸€è®²ä¸­è¯´è¿‡æˆ‘ä»¬ä¸èƒ½ç”¨é«˜çº§è¯­è¨€æ€ç»´æ¥ç†è§£ CPU çš„å¤„ç†æ–¹å¼ï¼Œcount++ è½¬æ¢æˆ CPU æŒ‡ä»¤åˆ™éœ€è¦ä¸‰æ­¥ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤è§£æå‡ºæ±‡ç¼–æŒ‡ä»¤ç­‰ä¿¡æ¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -c UnsafeCounter</span><br></pre></td></tr></table></figure><p>æˆªå– counter æ–¹æ³•çš„æ±‡ç¼–æŒ‡ä»¤æ¥çœ‹:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/2019-09-04-15-48-42%402x.png" alt=""></p><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„æŒ‡ä»¤ï¼Œ<br>16 : è·å–å½“å‰ count å€¼ï¼Œå¹¶ä¸”æ”¾å…¥æ ˆé¡¶<br>19 : å°†å¸¸é‡ 1 æ”¾å…¥æ ˆé¡¶<br>20 : å°†å½“å‰æ ˆé¡¶ä¸­ä¸¤ä¸ªå€¼ç›¸åŠ ï¼Œå¹¶æŠŠç»“æœæ”¾å…¥æ ˆé¡¶<br>21 : æŠŠæ ˆé¡¶çš„ç»“æœå†èµ‹å€¼ç»™ count</p><p>ç”±æ­¤å¯è§ï¼Œç®€å•çš„ count++ ä¸æ˜¯ä¸€æ­¥æ“ä½œï¼Œè¢«è½¬æ¢ä¸ºæ±‡ç¼–åå°±ä¸å…·å¤‡åŸå­æ€§äº†ï¼Œå°±å¥½æ¯”å¤§è±¡è£…å†°ç®±ï¼Œå…¶å®è¦åˆ†ä¸‰æ­¥:</p><blockquote><p>ç¬¬ä¸€æ­¥ï¼ŒæŠŠå†°ç®±é—¨æ‰“å¼€ï¼›ç¬¬äºŒæ­¥ï¼ŒæŠŠå¤§è±¡æ”¾è¿›å»ï¼›ç¬¬ä¸‰æ­¥ï¼ŒæŠŠå†°ç®±é—¨å¸¦ä¸Š</p></blockquote><p>ç»“åˆ JMM ç»“æ„å›¾ç†è§£ï¼Œè¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆå¾ˆéš¾å¾—åˆ° <code>count=20000</code> çš„ç»“æœ:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/Untitled%20Diagram%20%284%29.png" alt=""></p><p>å¤šçº¿ç¨‹è®¡æ•°å™¨ï¼Œå¦‚ä½•ä¿è¯å¤šä¸ªæ“ä½œçš„åŸå­æ€§å‘¢ï¼Ÿæœ€ç²—æš´çš„æ–¹å¼æ˜¯åœ¨æ–¹æ³•ä¸ŠåŠ  <strong>synchronized</strong> å…³é”®å­—ï¼Œæ¯”å¦‚è¿™æ ·:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/2019-09-04-15-49-53%402x.png" alt=""></p><p>é—®é¢˜æ˜¯è§£å†³äº†ï¼Œå¦‚æœ synchronized æ˜¯ä¸‡èƒ½è‰¯æ–¹ï¼Œé‚£ä¹ˆä¹Ÿè®¸å¹¶å‘å°±æ²¡é‚£ä¹ˆå¤šäº‹äº†ï¼Œå¯ä»¥é ä¸€ä¸ª synchronized èµ°å¤©ä¸‹äº†ï¼Œäº‹å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œsynchronized æ˜¯ç‹¬å é” (åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è°ƒç”¨)ï¼Œæ²¡æœ‰è·å–é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼›å¦å¤–ä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šçº¿ç¨‹åˆ‡æ¢çš„ä¸Šä¸‹æ–‡å¼€é”€</p><p>æ‰€ä»¥ JDK ä¸­å°±æœ‰äº†éé˜»å¡ CAS (Compare and <strong>Swap</strong>) ç®—æ³•å®ç°çš„åŸå­æ“ä½œç±» AtomicLong ç­‰å·¥å…·ç±»ï¼Œçœ‹è¿‡æºç çš„åŒå­¦ä¹Ÿè®¸ä¼šå‘ç°ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼Œæ‰€æœ‰åŸå­ç±»ä¸­éƒ½æœ‰ä¸‹é¢è¿™æ ·ä¸€æ®µä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»æ˜¯ JDK çš„ rt.jar åŒ…ä¸­çš„ Unsafe ç±»æä¾›äº† <strong>ç¡¬ä»¶çº§åˆ«</strong> çš„åŸå­æ€§æ“ä½œï¼Œç±»ä¸­çš„æ–¹æ³•éƒ½æ˜¯ native ä¿®é¥°çš„ï¼Œåé¢ä»‹ç»åŸå­ç±»ä¹‹å‰ä¹Ÿä¼šå…ˆè¯´æ˜è¿™ä¸ªç±»ä¸­çš„å‡ ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œå…ˆç®€å•ä»‹ç»æœ‰ä¸ªå°è±¡å³å¯ã€‚</p><p>æœ‰åŒå­¦ä¸ç†è§£æˆ‘åˆšåˆšæåˆ°çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¾ˆå¤§æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸¾ 2ä¸ªä¾‹å­ä½ å°±æ‡‚äº†:</p><blockquote><ul><li>ä½ (CPU)åœ¨çœ‹ä¸¤æœ¬ä¹¦(ä¸¤ä¸ªçº¿ç¨‹)ï¼Œçœ‹ç¬¬ä¸€æœ¬ä¹¦å¾ˆçŸ­æ—¶é—´åè¦å»çœ‹ç¬¬äºŒæœ¬ä¹¦ï¼Œçœ‹ç¬¬äºŒæœ¬ä¹¦å¾ˆçŸ­æ—¶é—´ååˆå›çœ‹ç¬¬ä¸€æœ¬ä¹¦ï¼Œå¹¶è¦ç²¾ç¡®çš„è®°å¾—çœ‹åˆ°ç¬¬å‡ è¡Œï¼Œå½“åˆçœ‹åˆ°äº†ä»€ä¹ˆ(CPU è®°ä½çº¿ç¨‹çº§åˆ«çš„ä¿¡æ¯)ï¼Œå½“è®©ä½  <strong>â€œåŒæ—¶â€</strong> çœ‹ 10 æœ¬ç”šè‡³æ›´å¤šï¼Œåˆ‡æ¢çš„å¼€é”€å°±å¾ˆå¤§äº†å§</li><li>ç»¼è‰ºèŠ‚ç›®ä¸­æœ‰å¾ˆå¤šæ¸¸æˆï¼Œè®©ä½ ä¸€è¾¹æ•°é’±ï¼Œåˆè¦ä¸€è¾¹åšå…¶ä»–çš„äº‹ï¼Œæœ€ç»ˆä¿è¯å¤šæ ·äº‹æƒ…éƒ½åšæ­£ç¡®ï¼Œå¤§è„‘å¼€é”€å¤§ä¸å¤§ï¼Œä½ è¯•è¯•å°±çŸ¥é“äº†ğŸ˜Š</li></ul></blockquote><h3 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h3><p>ç”Ÿæ´»ä¸­ä½ é—®å€™ä»–äººã€Œåƒäº†å—ä½ ï¼Ÿã€å’Œã€Œä½ åƒäº†å—ï¼Ÿã€æ˜¯ä¸€ä¸ªæ„æ€ï¼Œä½ å†™çš„æ˜¯ä¸‹é¢ç¨‹åº:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span>ï¼›</span><br><span class="line">b =  <span class="number">2</span>;</span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼˜åŒ–åå¯èƒ½å°±å˜æˆäº†è¿™æ ·:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b =  <span class="number">2</span>;</span><br><span class="line">a = <span class="number">1</span>ï¼›</span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæƒ…å†µï¼Œç¼–è¯‘å™¨è°ƒæ•´äº†è¯­å¥é¡ºåºæ²¡ä»€ä¹ˆå½±å“ï¼Œä½†ç¼–è¯‘å™¨ <strong>æ“…è‡ª</strong> ä¼˜åŒ–é¡ºåºï¼Œå°±ç»™æˆ‘ä»¬åŸ‹ä¸‹äº†é›·ï¼Œæ¯”å¦‚åº”ç”¨åŒé‡æ£€æŸ¥æ–¹å¼å®ç°çš„å•ä¾‹</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/2019-09-04-15-50-34%402x.png" alt=""></p><p>ä¸€åˆ‡åˆå¾ˆå®Œç¾æ˜¯ä¸æ˜¯ï¼Œéä¹Ÿï¼Œé—®é¢˜å‡ºç°åœ¨ <code>instance = new Singleton();</code>ï¼Œè¿™ 1 è¡Œä»£ç è½¬æ¢æˆäº† CPU æŒ‡ä»¤ååˆå˜æˆäº† 3 ä¸ªï¼Œæˆ‘ä»¬ç†è§£ new å¯¹è±¡åº”è¯¥æ˜¯è¿™æ ·çš„:</p><ol><li>åˆ†é…ä¸€å—å†…å­˜ M</li><li>åœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ– Singleton å¯¹è±¡</li><li>ç„¶å M çš„åœ°å€èµ‹å€¼ç»™ instance å˜é‡</li></ol><p>ä½†ç¼–è¯‘å™¨<strong>æ“…è‡ª</strong>ä¼˜åŒ–åå¯èƒ½å°±å˜æˆäº†è¿™æ ·:</p><ol><li>åˆ†é…ä¸€å—å†…å­˜ M</li><li>ç„¶åå°† M çš„åœ°å€èµ‹å€¼ç»™ instance å˜é‡</li><li>åœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ– Singleton å¯¹è±¡</li></ol><p>é¦–å…ˆ new å¯¹è±¡åˆ†äº†ä¸‰æ­¥ï¼Œç»™ CPU ç•™ä¸‹äº†åˆ‡æ¢çº¿ç¨‹çš„æœºä¼šï¼›å¦å¤–ï¼Œç¼–è¯‘å™¨ä¼˜åŒ–åçš„é¡ºåºå¯èƒ½å¯¼è‡´é—®é¢˜çš„å‘ç”Ÿï¼Œæ¥çœ‹:</p><blockquote><ol><li>çº¿ç¨‹ A å…ˆæ‰§è¡Œ getInstance æ–¹æ³•ï¼Œå½“æ‰§è¡Œåˆ°æŒ‡ä»¤ 2 æ—¶ï¼Œæ°å¥½å‘ç”Ÿäº†çº¿ç¨‹åˆ‡æ¢</li><li>çº¿ç¨‹ B åˆšè¿›å…¥åˆ° getInstance æ–¹æ³•ï¼Œåˆ¤æ–­ if è¯­å¥ instance æ˜¯å¦ä¸ºç©º</li><li>çº¿ç¨‹ A å·²ç»å°† M çš„åœ°å€èµ‹å€¼ç»™äº† instance å˜é‡ï¼Œæ‰€ä»¥çº¿ç¨‹ B è®¤ä¸º instance ä¸ä¸ºç©º</li><li>çº¿ç¨‹ B ç›´æ¥ return instance å˜é‡</li><li>CPU åˆ‡æ¢å›çº¿ç¨‹ Aï¼Œçº¿ç¨‹ A å®Œæˆåç»­åˆå§‹åŒ–å†…å®¹</li></ol></blockquote><p>æˆ‘ä»¬è¿˜æ˜¯ç”»ä¸ªå›¾è¯´æ˜ä¸€ä¸‹:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-28/%E5%8D%95%E4%BE%8B%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2.png" alt=""></p><p>å¦‚æœçº¿ç¨‹ A æ‰§è¡Œåˆ°ç¬¬ 2 æ­¥ï¼Œçº¿ç¨‹åˆ‡æ¢ï¼Œç”±äºçº¿ç¨‹ A æ²¡æœ‰æŠŠçº¢è‰²ç®­å¤´æ‰§è¡Œå®Œå…¨ï¼Œçº¿ç¨‹ B å°±ä¼šå¾—åˆ°ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œå…¨çš„å¯¹è±¡ï¼Œè®¿é—® instance æˆå‘˜å˜é‡çš„æ—¶å€™å°±å¯èƒ½å‘ç”Ÿ NPEï¼Œå¦‚æœå°†å˜é‡ instance ç”¨ volatile æˆ–è€… final ä¿®é¥°(æ¶‰åŠåˆ°ç±»çš„åŠ è½½æœºåˆ¶ï¼Œå¯çœ‹æˆ‘ä¹‹å‰å†™çš„æ–‡ç« : <a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a>)ï¼Œé—®é¢˜å°±è§£å†³äº†.</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½ æ‰€çœ‹åˆ°çš„ç¨‹åºå¹¶ä¸ä¸€å®šæ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–/ç¼–è¯‘åçš„ CPU æŒ‡ä»¤ï¼Œå¤§è±¡è£…å†°ç®±æ˜¯æ˜¯ä¸ªç¨‹åºï¼Œä½†å…¶éšå«ä¸‰ä¸ªæ­¥éª¤ï¼Œå­¦ä¹ å¹¶å‘ç¼–ç¨‹ï¼Œä½ è¦æŒ‰ç…§ CPU çš„æ€ç»´è€ƒè™‘é—®é¢˜ï¼Œæ‰€ä»¥ä½ éœ€è¦æ·±åˆ»ç†è§£ <strong>å¯è§æ€§/åŸå­æ€§/æœ‰åºæ€§</strong> ï¼Œè¿™æ˜¯äº§ç”Ÿå¹¶å‘ Bug çš„æºå¤´</p><p>æœ¬èŠ‚è¯´æ˜äº†ä¸‰ä¸ªé—®é¢˜ï¼Œä¸‹é¢çš„æ–‡ç« ä¹Ÿä¼šé€ä¸ªåˆ†æè§£å†³ä»¥ä¸Šé—®é¢˜çš„åŠæ³•ï¼Œä»¥åŠç›¸å¯¹ä¼˜çš„æ–¹æ¡ˆï¼Œè¯·æŒç»­å…³æ³¨ï¼Œå¦å¤–å…³äºå¹¶å‘çš„æµ‹è¯•ä»£ç æˆ‘éƒ½ä¼šæŒ‰ä¾‹ä¸Šä¼ åˆ° githubï¼Œå…¬ä¼—å·å›å¤ã€Œdemoã€â€”â€”&gt; concurrency è·å–æ›´å¤šå†…å®¹</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>ä¸ºä»€ä¹ˆç”¨ final ä¿®é¥°çš„å˜é‡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„äº†å‘¢ï¼Ÿ</li><li>ä½ ä¼šç»å¸¸æŸ¥çœ‹ CPU æ±‡ç¼–æŒ‡ä»¤å—ï¼Ÿ</li><li>å¦‚æœè®©ä½ å†™å•ä¾‹ï¼Œä½ é€šå¸¸ä¼šé‡‡ç”¨å“ªç§å®ç°ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><h3 id="Material-Theme-UI"><a href="#Material-Theme-UI" class="headerlink" title="Material Theme UI"></a>Material Theme UI</h3><p>è¿™æ˜¯ä¸€æ¬¾ IDEA çš„ä¸»é¢˜æ’ä»¶ï¼Œå®‰è£…åï¼Œé€‰æ‹© <code>Material Palenight</code> ä¸»é¢˜ï¼ŒåŒæ—¶ä½œå‡ºå¦‚ä¸‹è®¾ç½®<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-31-11-43-17.png" alt=""></p><p>è®¾ç½®å®Œåï¼Œä½ çš„ IDEA å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼Œå¼•èµ·æåº¦èˆ’é€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-31-11-39-58.jpg" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/q5cyK14WGiMm-R6NIFBcTg" target="_blank" rel="noopener">æ¯å¤©ç”¨SpringBootï¼Œè¿˜ä¸æ‡‚RESTful APIè¿”å›ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/ilND8u_8HGSTSrJiMB4X8g" target="_blank" rel="noopener">çº¢é»‘æ ‘ï¼Œè¶…å¼ºåŠ¨é™å›¾è¯¦è§£ï¼Œç®€å•æ˜“æ‡‚</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> å¯è§æ€§ </tag>
            
            <tag> åŸå­æ€§ </tag>
            
            <tag> æœ‰åºæ€§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatisæ‹¦æˆªå™¨å®ç°æ•°æ®åŠ å¯†ä¸è§£å¯†</title>
      <link href="//p/mybatis-interceptor-encrypt-decrypt.html"/>
      <url>//p/mybatis-interceptor-encrypt-decrypt.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ‹¦æˆªå™¨ä»‹ç»"><a href="#æ‹¦æˆªå™¨ä»‹ç»" class="headerlink" title="æ‹¦æˆªå™¨ä»‹ç»"></a>æ‹¦æˆªå™¨ä»‹ç»</h2><p><code>Mybatis Interceptor</code>  åœ¨ Mybatis ä¸­è¢«å½“ä½œ Plugin(æ’ä»¶)ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†ç¡®å®æ˜¯åœ¨ <code>org.apache.ibatis.plugin</code> åŒ…ä¸‹é¢</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/_image/2019-06-04/sunset-3689760.jpg" alt=""></p><p>æ—¢ç„¶æ˜¯æ‹¦æˆªå™¨ï¼Œå¯ä»¥æ‹¦æˆªå“ªäº›å†…å®¹å‘¢ï¼Ÿè¯•æƒ³ä¸€ä¸‹â€¦â€¦ å½“ç¨‹åºå†™åˆ°æŒä¹…å±‚æ—¶ï¼ŒMybatis ä¼š <strong>æ‰§è¡Œ</strong> æŒ‡å®š <strong>SQL è¯­å¥</strong>ï¼Œå¹¶å¤„ç† <strong>è¯·æ±‚å‚æ•°</strong> å’Œ <strong>è¿”å›å€¼</strong>ã€‚æ²¡é”™ï¼ŒMybatis æ‹¦æˆªå™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†ä¸Šè¿°å†…å®¹ï¼Œè¯·çœ‹<a href="http://www.mybatis.org/mybatis-3/zh/configuration.html#plugins" target="_blank" rel="noopener">å®˜ç½‘</a>çš„ Plugins çš„ç‰‡æ®µ, å†…å®¹ä¸å¤š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</span><br><span class="line"><span class="comment">// è¯·æ±‚å‚æ•°å¤„ç†</span></span><br><span class="line">ParameterHandler (getParameterObject, setParameters)</span><br><span class="line"><span class="comment">// è¿”å›ç»“æœé›†å¤„ç†</span></span><br><span class="line">ResultSetHandler (handleResultSets, handleOutputParameters)</span><br><span class="line"><span class="comment">// SQLè¯­å¥æ„å»º</span></span><br><span class="line">StatementHandler (prepare, parameterize, batch, update, query)</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨çš„ä½¿ç”¨"><a href="#æ‹¦æˆªå™¨çš„ä½¿ç”¨" class="headerlink" title="æ‹¦æˆªå™¨çš„ä½¿ç”¨"></a>æ‹¦æˆªå™¨çš„ä½¿ç”¨</h2><p>å¦‚æœéœ€è¦å®ç°è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œåªéœ€è¦å®ç° <code>org.apache.ibatis.plugin.Interceptor</code> æ¥å£ï¼Œè¯¥æ¥å£æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Object <span class="title">plugin</span><span class="params">(Object target)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span></span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å®ç°æ•°æ®åŠ å¯†ï¼Œè¿›å…¥æ•°æ®åº“çš„å­—æ®µä¸èƒ½æ˜¯çœŸå®çš„æ•°æ®ï¼Œä½†æ˜¯è¿”å›æ¥çš„æ•°æ®è¦çœŸå®å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é’ˆå¯¹ Parameter å’Œ ResultSet ä¸¤ç§ç±»å‹å¤„ç†ï¼ŒåŒæ—¶ä¸ºäº†æ›´çµæ´»çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ³¨è§£</p><h3 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h3><p>ç±»æ³¨è§£ï¼Œå°†æ³¨è§£æ”¾åœ¨å®ä½“ç±»ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éœ€è¦åŠ è§£å¯†çš„ç±»æ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Target</span>(&#123; ElementType.TYPE &#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EncryptDecryptClass &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—æ®µæ³¨è§£ï¼Œå°†æ³¨è§£æ”¾åœ¨å®ä½“å­—æ®µä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ å¯†å­—æ®µæ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Target</span>(&#123; ElementType.FIELD &#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EncryptDecryptField &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸¤ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬å¯ä»¥æ ‡è®°æˆ‘ä»¬è¦å¤„ç†çš„å®ä½“å’Œå®ä½“ä¸­çš„å­—æ®µ</p><h3 id="è‡ªå®šä¹‰å‚æ•°å¤„ç†æ‹¦æˆªå™¨"><a href="#è‡ªå®šä¹‰å‚æ•°å¤„ç†æ‹¦æˆªå™¨" class="headerlink" title="è‡ªå®šä¹‰å‚æ•°å¤„ç†æ‹¦æˆªå™¨"></a>è‡ªå®šä¹‰å‚æ•°å¤„ç†æ‹¦æˆªå™¨</h3><p>å‚è€ƒå®˜ç½‘ï¼Œé€šè¿‡ <code>@Intercepts</code> å’Œ <code>@Signature</code> çš„è”åˆä½¿ç”¨ï¼ŒæŒ‡å®š <code>ParameterHandler.class</code> ç±»å‹ï¼ŒåŒæ—¶é€šè¿‡ <code>@Component</code> æ³¨è§£æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œå³å¯åœ¨è®¾ç½®å‚æ•°çš„æ—¶å€™è¿›è¡Œæ‹¦æˆªï¼Œé€šè¿‡è‡ªå®šä¹‰æ¥å£ <code>IEncryptDecrypt</code>, æ ¹æ® Field çš„å„ç§ç±»å‹è‡ªå®šä¹‰åŠ å¯†è§£å¯†ç®—æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line"><span class="meta">@Signature</span>(type = ParameterHandler.class, method = <span class="string">"setParameters"</span>, args = PreparedStatement.class),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(value = <span class="string">"domain.encrypt"</span>, havingValue = <span class="string">"true"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParammeterInterceptor</span>  <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IEncryptDecrypt encryptDecrypt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"æ‹¦æˆªå™¨ParamInterceptor"</span>);</span><br><span class="line"><span class="comment">//æ‹¦æˆª ParameterHandler çš„ setParameters æ–¹æ³• åŠ¨æ€è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (invocation.getTarget() <span class="keyword">instanceof</span> ParameterHandler) &#123;</span><br><span class="line">ParameterHandler parameterHandler = (ParameterHandler) invocation.getTarget();</span><br><span class="line">PreparedStatement ps = (PreparedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åå°„è·å– BoundSql å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åŒ…å«ç”Ÿæˆçš„sqlå’Œsqlçš„å‚æ•°mapæ˜ å°„</span></span><br><span class="line"><span class="comment">/*Field boundSqlField = parameterHandler.getClass().getDeclaredField("boundSql");</span></span><br><span class="line"><span class="comment">boundSqlField.setAccessible(true);</span></span><br><span class="line"><span class="comment">BoundSql boundSql = (BoundSql) boundSqlField.get(parameterHandler);*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åå°„è·å– å‚æ•°å¯¹åƒ</span></span><br><span class="line">Field parameterField =</span><br><span class="line">parameterHandler.getClass().getDeclaredField(<span class="string">"parameterObject"</span>);</span><br><span class="line">parameterField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object parameterObject = parameterField.get(parameterHandler);</span><br><span class="line"><span class="keyword">if</span> (Objects.nonNull(parameterObject))&#123;</span><br><span class="line">Class&lt;?&gt; parameterObjectClass = parameterObject.getClass();</span><br><span class="line">EncryptDecryptClass encryptDecryptClass = AnnotationUtils.findAnnotation(parameterObjectClass, EncryptDecryptClass.class);</span><br><span class="line"><span class="keyword">if</span> (Objects.nonNull(encryptDecryptClass))&#123;</span><br><span class="line">Field[] declaredFields = parameterObjectClass.getDeclaredFields();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Object encrypt = encryptDecrypt.encrypt(declaredFields, parameterObject);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> invocation.proceed();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Plugin.wrap(o, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æ–°å»ºç»“æœé›†æ‹¦æˆªå™¨</p><h3 id="ç»“æœé›†æ‹¦æˆªå™¨"><a href="#ç»“æœé›†æ‹¦æˆªå™¨" class="headerlink" title="ç»“æœé›†æ‹¦æˆªå™¨"></a>ç»“æœé›†æ‹¦æˆªå™¨</h3><p>ä¸å‚æ•°æ‹¦æˆªå™¨åŸºæœ¬ä¸€æ ·, åªä¸è¿‡ç±»å‹æŒ‡å®šä¸º <code>ResultSetHandler.class</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line"><span class="meta">@Signature</span>(type = ResultSetHandler.class, method = <span class="string">"handleResultSets"</span>, args=&#123;Statement.class&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(value = <span class="string">"domain.decrypt"</span>, havingValue = <span class="string">"true"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IEncryptDecrypt encryptDecrypt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">Object result = invocation.proceed();</span><br><span class="line"><span class="keyword">if</span> (Objects.isNull(result))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (result <span class="keyword">instanceof</span> ArrayList) &#123;</span><br><span class="line">ArrayList resultList = (ArrayList) result;</span><br><span class="line"><span class="keyword">if</span> (CollectionUtils.isNotEmpty(resultList) &amp;&amp; needToDecrypt(resultList.get(<span class="number">0</span>)))&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; resultList.size(); i++) &#123;</span><br><span class="line">encryptDecrypt.decrypt(resultList.get(i));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (needToDecrypt(result))&#123;</span><br><span class="line">encryptDecrypt.decrypt(result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">needToDecrypt</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">Class&lt;?&gt; objectClass = object.getClass();</span><br><span class="line">EncryptDecryptClass encryptDecryptClass = AnnotationUtils.findAnnotation(objectClass, EncryptDecryptClass.class);</span><br><span class="line"><span class="keyword">if</span> (Objects.nonNull(encryptDecryptClass))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠ å¯†è§£å¯†"><a href="#åŠ å¯†è§£å¯†" class="headerlink" title="åŠ å¯†è§£å¯†"></a>åŠ å¯†è§£å¯†</h3><p><code>IEncryptDecrypt</code> æ¥å£å®šä¹‰äº† åŠ å¯†å’Œè§£å¯†ä¸¤ä¸ªæ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEncryptDecrypt</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ å¯†æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> declaredFields åå°„beanæˆå‘˜å˜é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parameterObject Mybatiså…¥å‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">encrypt</span><span class="params">(Field[] declaredFields, T parameterObject)</span> <span class="keyword">throws</span> IllegalAccessException</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£å¯†æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> result Mybatis è¿”å›å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯ArrayListç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">decrypt</span><span class="params">(T result)</span> <span class="keyword">throws</span> IllegalAccessException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ‹¦æˆªå™¨é€šè¿‡åœ¨ YAML ä¸­é…ç½®å±æ€§ï¼ŒæŒ‰æ¡ä»¶æ³¨å…¥ï¼Œå¤–åŠ è‡ªå®šä¹‰åŠ å¯†è§£å¯†ç®—æ³•ï¼Œå®Œæˆå…¨å±€çµæ´»çš„é…ç½®ã€‚<br>æ ¸å¿ƒä»£ç å·²ä¸Šä¼ è‡³ <a href="https://github.com/FraserYu/learnings/tree/master/mybatis-interceptor/interceptor" target="_blank" rel="noopener">Github Demo</a></p><h2 id="é—®é¢˜å½©è›‹"><a href="#é—®é¢˜å½©è›‹" class="headerlink" title="é—®é¢˜å½©è›‹"></a>é—®é¢˜å½©è›‹</h2><p>ä¹Ÿè®¸åº”å¯¹å½“å‰çš„ä¸šåŠ¡ï¼Œçœ‹äº†è¯¥æ–‡ç« æ»¡è¶³äº†å½“ä¸‹éœ€æ±‚ï¼Œæˆ‘ä»¬ç›®å‰åªçœ‹åˆ°äº†ä»€ä¹ˆæ˜¯ Mybatis æ‹¦æˆªå™¨ï¼Œæ€æ ·ç®€å•ä½¿ç”¨ï¼Œæ‹¦æˆªå™¨çš„å…¶ä»–ç”¨æ³•ä»¥åŠå…¶ä»–å¾ˆå¤šä¸ºä»€ä¹ˆéƒ½æ²¡æœ‰è§£å†³ï¼Œå…³æ³¨å…¬ä¼—å·ï¼Œå›å¤â€œäººè¿¹ç½•è‡³â€ è¯»å®Œæ–‡ç«  ã€Œç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ã€å ï¼Œæˆ‘ä¸ä¼šæ»¡è¶³çœ¼å‰çš„è¿™äº›åŸºæœ¬åº”ç”¨ï¼Œæˆ‘ä¼šæœ‰è¯¸å¤šç–‘é—®ï¼Œ</p><ol><li>æˆ‘ä»¬æ—¥å¸¸å†™ CRUD çš„ä¸šåŠ¡ï¼Œä¸ºä»€ä¹ˆ Executor ä¸­åªæœ‰ R(query) å’Œ U(update), é‚£ä¹ˆC(insert) å’Œ D(delete) æ€æ ·å¤„ç†çš„ï¼Ÿ</li><li>è‡ªå®šä¹‰æ‹¦æˆªå™¨æ˜¯ä»¥ä»€ä¹ˆæ–¹å¼è¢«æ‰§è¡Œçš„ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>åˆ†é¡µä¹Ÿæ˜¯ Mybatis æ‹¦æˆªå™¨çš„ä¸€ç§ï¼Œå¸¦æœ‰åˆ†é¡µçš„æ¡†æ¶æ˜¯æ€æ ·ä½¿ç”¨æ‹¦æˆªå™¨çš„å‘¢ï¼Ÿå¦‚ <code>Mybatis Plus</code>, <code>PageHelper</code></li><li>è™½ç„¶é‡å†™äº† Inteceptor æ¥å£çš„ <code>public void setProperties(Properties properties)</code> æ–¹æ³•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å†™ä»€ä¹ˆä¸šåŠ¡é€»è¾‘ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½æ€æ ·ä½¿ç”¨ï¼Ÿ</li><li>â€¦â€¦<br>åç»­æ–‡ç« ä¹Ÿä¼šé€šè¿‡è¯»æºç çš„æ–¹å¼é€æ­¥è§£æè¿™äº›é—®é¢˜ï¼Œå½“ç„¶ä½ æœ‰ç›¸å…³é—®é¢˜ä¹Ÿå¯ä»¥ç•™è¨€äº¤æµè®¨è®º</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p>ä¾æ—§æ¨èåœ¨å†™æ–‡ç« æ—¶ç”¨åˆ°çš„é«˜æ•ˆå·¥å…·ï¼Œåç»­ç›¸å…³å·¥å…·ä¹Ÿä¼šåœ¨æ–‡ç« ä¸­é™†ç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨</p><h3 id="MyBatis-Log-Plugin"><a href="#MyBatis-Log-Plugin" class="headerlink" title="MyBatis Log Plugin"></a>MyBatis Log Plugin</h3><p>MyBatis Log Plugin æ˜¯ Intelligj IDEA çš„ä¸€ä¸ªæ’ä»¶ï¼Œç”¨æ¥ä» Mybatis è¾“å‡ºçš„ log ä¸­æå–å‡ºå½“å‰è°ƒç”¨çš„ SQL è¯­å¥ï¼Œå¹¶å°†å‚æ•°å°è£…åœ¨ SQL è¯­å¥ä¸­ç»„æˆå®Œæ•´çš„ SQLï¼Œè¿™æ ·ï¼Œå½“æˆ‘ä»¬è°ƒè¯•çš„æ—¶å€™æ›´åŠ æ¸…æ™°æ–¹ä¾¿ï¼Œå¯ä»¥è½»æ¾å®šä½æ˜¯å¦ SQL åˆé—®é¢˜</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/_image/2019-06-04/MyBatisLogPlugin.gif" alt=""></p><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/q5cyK14WGiMm-R6NIFBcTg" target="_blank" rel="noopener">æ¯å¤©ç”¨SpringBootï¼Œè¿˜ä¸æ‡‚RESTful APIè¿”å›ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/ilND8u_8HGSTSrJiMB4X8g" target="_blank" rel="noopener">çº¢é»‘æ ‘ï¼Œè¶…å¼ºåŠ¨é™å›¾è¯¦è§£ï¼Œç®€å•æ˜“æ‡‚</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> æ•°æ®åº“-æŒä¹…å±‚-SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java StringåŸºç¡€é¢è¯•</title>
      <link href="//p/java-string-interview.html"/>
      <url>//p/java-string-interview.html</url>
      
        <content type="html"><![CDATA[<p>å…³äº Java Stringï¼Œè¿™æ˜¯é¢è¯•çš„åŸºç¡€ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šç«¥é‹ä¸èƒ½è¯´æ¸…æ¥šï¼Œæ‰€ä»¥æœ¬æ–‡å°†ç®€å•è€Œåˆé€å½»çš„è¯´æ˜ä¸€ä¸‹é‚£ä¸ªè®©ä½ è¿·æƒ‘çš„ String</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/mountain-landscape-2031539_1920.jpg" alt=""></p><p>åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String x = <span class="string">"abc"</span>;</span><br><span class="line">String y = <span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br></pre></td></tr></table></figure><p>ä½ å¸¸è§ä¹Ÿå¸¸å†™ç¬¬ä¸€ç§ï¼Œå¾ˆå°‘è§ç¬¬äºŒç§ï¼Œä½†é¢è¯•è¿˜æ€»é—®è¿™ç±»é—®é¢˜ï¼ŒåŒå¼•å·å’Œæ„é€ å™¨ä¸¤ç§å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²åˆ°åº•æœ‰ä»€ä¹ˆå·®åˆ«å‘¢ï¼Ÿ</p><p>å…ˆæ¥çœ‹ä¾‹å­</p><h3 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­ 1"></a>ä¾‹å­ 1</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String a = <span class="string">"abcd"</span>;</span><br><span class="line">String b = <span class="string">"abcd"</span>;</span><br><span class="line">System.out.println(a == b);  <span class="comment">// True</span></span><br><span class="line">System.out.println(a.equals(b)); <span class="comment">// True</span></span><br></pre></td></tr></table></figure><p><code>a == b</code> ç»“æœä¸º trueï¼Œæ˜¯å› ä¸º a å’Œ b éƒ½æŒ‡å‘ <strong>æ–¹æ³•åŒº(method area)</strong> åŒä¸€ä¸ªå­—ç¬¦ä¸²æ–‡å­—ï¼Œå†…å­˜å¼•ç”¨æ˜¯åŒä¸€ä¸ª</p><p>å½“å¤šæ¬¡åˆ›å»ºç›¸åŒçš„å­—ç¬¦ä¸²æ–‡å­—æ—¶ï¼Œåªå­˜å‚¨æ¯ä¸ªä¸åŒå­—ç¬¦ä¸²å€¼çš„ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™ä¸ªå«åš<strong>å­—ç¬¦ä¸²ç•™é©»/ç•™ç”¨</strong>ï¼ŒJava ä¸­æ‰€æœ‰ç¼–è¯‘æœŸå­—ç¬¦ä¸²å¸¸é‡éƒ½ä¼šè¢«è‡ªåŠ¨ç•™é©»</p><h3 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="headerlink" title="ä¾‹å­ 2"></a>ä¾‹å­ 2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String c = <span class="keyword">new</span> String(<span class="string">"abcd"</span>);</span><br><span class="line">String d = <span class="keyword">new</span> String(<span class="string">"abcd"</span>);</span><br><span class="line">System.out.println(c == d);  <span class="comment">// False</span></span><br><span class="line">System.out.println(c.equals(d)); <span class="comment">// True</span></span><br></pre></td></tr></table></figure><p><code>c==d</code> ç»“æœä¸º falseï¼Œå› ä¸º c å’Œ d çš„å¼•ç”¨æŒ‡å‘<strong>å †</strong>ä¸­ä¸åŒçš„å¯¹è±¡ï¼Œ<code>ä¸åŒçš„å¯¹è±¡è‚¯å®šæœ‰ä¸åŒçš„å†…å­˜å¼•ç”¨</code></p><p>ä¸¾äº†ä¸¤ä¸ªä¾‹å­ï¼Œæ–‡å­—æè¿°æœ‰ç‚¹æ‡µï¼Ÿæˆ‘ä»¬æ¥è¯•å›¾é€šè¿‡å›¾å½¢æ¥ç†è§£ä¸Šè¿°ä¸¤ç§æƒ…å†µ:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-30-18-44-15.jpg" alt=""></p><p>ä¹Ÿè®¸ä½ å·²ç»çœ‹çœ‹å‡ºæ¥äº†ï¼Œä¸€ä¸ªæ˜¯åœ¨<code>æ–¹æ³•åŒº</code>ï¼Œä¸€ä¸ªæ˜¯åœ¨<code>å †</code>ä¸­ï¼Œåœ¨ JVM æ¨¡å‹ä¸­è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼Œä¹Ÿè®¸ä½ é¢è¯•æ—¶ä¹Ÿç»å¸¸è¢«é—®åˆ°å§ï¼Œæ¥çœ‹ä¸‹å›¾:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-30-18-47-02.jpg" alt=""></p><p>å†æ¬¡æé†’ä¸€ä¸‹ï¼Œæ‰€æœ‰ new çš„å¯¹è±¡éƒ½ä¼šåœ¨ Heap ä¸­ï¼Œè¿™æ ·ä»¥åä½ å°±å¥½åŒºåˆ†äº†</p><h2 id="è¿è¡ŒæœŸå­—ç¬¦ä¸²ç•™é©»"><a href="#è¿è¡ŒæœŸå­—ç¬¦ä¸²ç•™é©»" class="headerlink" title="è¿è¡ŒæœŸå­—ç¬¦ä¸²ç•™é©»"></a>è¿è¡ŒæœŸå­—ç¬¦ä¸²ç•™é©»</h2><p>ä¸Šé¢è¯´çš„å­—ç¬¦ä¸²ç•™é©»æ˜¯åœ¨ç¼–è¯‘æœŸï¼Œé‚£ä¹ˆè¿è¡ŒæœŸå¯ä»¥å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥å¸®å¿™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String c = <span class="keyword">new</span> String(<span class="string">"abcd"</span>).intern();</span><br><span class="line">String d = <span class="keyword">new</span> String(<span class="string">"abcd"</span>).intern();</span><br><span class="line">System.out.println(c == d);  <span class="comment">// Now true</span></span><br><span class="line">System.out.println(c.equals(d)); <span class="comment">// True</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ° <code>c == d</code> ç»“æœä¸º trueï¼Œä½ åº”è¯¥ç†è§£ intern (è‹±æ–‡æœ‰æ‹˜ç•™ï¼Œè½¯ç¦çš„æ„æ€)çš„ä½œç”¨äº†ï¼Œé€šè¿‡è°ƒç”¨ intern()æ–¹æ³•ï¼Œå°±å¥½æ¯”æŠŠåˆ›å»ºçš„å­—ç¬¦ä¸²æ‹˜ç•™åœ¨æ–¹æ³•åŒºä¸€æ ·äº†</p><p>åœ¨é¢è¯•æ—¶ç”šè‡³è¿˜ä¼šé—®ä½ ä¸‹é¢ä»£ç åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String d = <span class="keyword">new</span> String(<span class="string">"abcd"</span>)</span><br></pre></td></tr></table></figure><ol><li>å¦‚æœæ–¹æ³•åŒºå·²å­˜åœ¨â€abcdâ€, é‚£ä¹ˆåªåˆ›å»ºä¸€ä¸ª new String çš„å¯¹è±¡</li><li>å¦‚æœæ–¹æ³•åŒºæ²¡æœ‰â€abcdâ€, é‚£ä¹ˆè¦åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªåœ¨æ–¹æ³•åŒºï¼Œä¸€ä¸ªåœ¨å †ä¸­</li></ol><p>æ‰€ä»¥ï¼Œ<strong>æ­£å¸¸æƒ…å†µ</strong>ä¸‹æˆ‘ä»¬æ²¡å¿…è¦ä½¿ç”¨æ„é€ å™¨åˆ›å»ºå¯¹è±¡ï¼Œå› ä¸ºè¿™å¾ˆå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªé¢å¤–çš„æ²¡ç”¨çš„å¯¹è±¡ï¼Œä½†æ˜¯æœ‰ä¾‹å¤–å“¦ï¼Œæˆ‘ä»¬ä¸‹é¢è¯´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"abcd"</span>;</span><br><span class="line">s = s.concat(<span class="string">"ef"</span>);</span><br></pre></td></tr></table></figure><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-30-20-38-21.jpg" alt=""></p><p>å½“æˆ‘ä»¬æƒ³åœ¨å­—ç¬¦ä¸² s åé¢æ‹¼æ¥å­—ç¬¦â€efâ€æ—¶ï¼Œä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°† s çš„å¼•ç”¨æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œç”±äº String åˆ›å»ºçš„æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ‰€ä»¥ <strong>String ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¸ä¼šæ”¹å˜å®ƒè‡ªèº«ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²(å¿«æ‰“å¼€ä½ çš„ IDEï¼Œçœ‹çœ‹æ˜¯å¦æ¯ä¸ªæ“ä½œString çš„æ–¹æ³•æœ€åéƒ½æ˜¯è¿”å›æœ‰ return new String å­—æ ·)</strong>ï¼Œåˆ°è¿™é‡Œä½ ä¹Ÿåº”è¯¥ç†è§£äº†ä¸€ä¸ªé“ç†:</p><blockquote><p> å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²è¢«ä¿®æ”¹ï¼Œæˆ‘ä»¬æœ€å¥½ä½¿ç”¨ StringBuffer æˆ–è€… StringBuilderï¼Œå¦åˆ™ï¼Œç”±äºæ¯æ¬¡æ“ä½œå­—ç¬¦ä¸²éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œæ—§çš„å¯¹è±¡ä¸ä¼šæœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œè¿™æ ·æˆ‘ä»¬ä¼šæµªè´¹å¾ˆå¤šåƒåœ¾å›æ”¶çš„æ—¶é—´</p></blockquote><p>åˆ°è¿™é‡Œè¿˜æ²¡å®Œï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆ String ä¼šè¢«è®¾ç½®/åˆ¶é€ æˆ finalï¼Ÿ</p><h2 id="ä¸ºä»€ä¹ˆ-String-ç±»è¢«-final-ä¿®é¥°"><a href="#ä¸ºä»€ä¹ˆ-String-ç±»è¢«-final-ä¿®é¥°" class="headerlink" title="ä¸ºä»€ä¹ˆ String ç±»è¢« final ä¿®é¥°"></a>ä¸ºä»€ä¹ˆ String ç±»è¢« final ä¿®é¥°</h2><p>è°ˆåŠè¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦ä¸€äº›å€’æ¨çš„æˆ–è€…ç›¸äº’çº¦æŸæ€ç»´æ¥æ€è€ƒ</p><h3 id="å­—ç¬¦ä¸²æ± çš„éœ€æ±‚"><a href="#å­—ç¬¦ä¸²æ± çš„éœ€æ±‚" class="headerlink" title="å­—ç¬¦ä¸²æ± çš„éœ€æ±‚"></a>å­—ç¬¦ä¸²æ± çš„éœ€æ±‚</h3><p>å­—ç¬¦ä¸²æ± (String intern pool)æ˜¯æ–¹æ³•åŒºåŸŸä¸­çš„ä¸€ä¸ªç‰¹æ®Šå­˜å‚¨åŒºåŸŸã€‚å½“åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²å·²ç»å­˜åœ¨äºæ± ä¸­ï¼Œé‚£ä¹ˆè¿”å›ç°æœ‰å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚æ‰€ä»¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆæ”¹å˜ä¸€ä¸ªå¼•ç”¨çš„å€¼ï¼Œå°†å¯¼è‡´åŸæœ¬æŒ‡å‘è¯¥å€¼çš„å¼•ç”¨è·å–åˆ°é”™è¯¯çš„å€¼</p><h3 id="ç¼“å­˜-hashcode"><a href="#ç¼“å­˜-hashcode" class="headerlink" title="ç¼“å­˜ hashcode"></a>ç¼“å­˜ hashcode</h3><p>å­—ç¬¦ä¸²çš„hashcodeåœ¨Javaä¸­ç»å¸¸ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨HashMapæˆ–HashSetä¸­ã€‚ä¸å¯å˜ä¿è¯hashcodeå§‹ç»ˆæ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸æ‹…å¿ƒæ›´æ”¹çš„æƒ…å†µä¸‹å…‘ç°å®ƒã€‚è¿™æ„å‘³ç€ï¼Œä¸éœ€è¦æ¯æ¬¡ä½¿ç”¨hashcodeæ—¶éƒ½è®¡ç®—å®ƒã€‚è¿™æ ·æ›´æœ‰æ•ˆç‡ã€‚æ‰€ä»¥ä½ ä¼šåœ¨ String ç±»ä¸­çœ‹åˆ°ä¸‹é¢çš„æˆå‘˜å˜é‡çš„å®šä¹‰:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache the hash code for the string */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hash; <span class="comment">// Default to 0</span></span><br></pre></td></tr></table></figure><h3 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h3><p>Stringè¢«å¹¿æ³›ç”¨ä½œè®¸å¤šjavaç±»çš„å‚æ•°ï¼Œä¾‹å¦‚ç½‘ç»œè¿æ¥ã€æ‰“å¼€æ–‡ä»¶ç­‰ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸æ˜¯ä¸å¯å˜çš„ï¼Œè¿æ¥æˆ–æ–‡ä»¶å°†è¢«æ›´æ”¹ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸¥é‡çš„å®‰å…¨å¨èƒã€‚è¯¥æ–¹æ³•è®¤ä¸ºå®ƒè¿æ¥åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ã€‚<strong>å¯å˜å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½å¯¼è‡´åå°„ä¸­çš„å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå‚æ•°æ˜¯å­—ç¬¦ä¸²</strong>ã€‚</p><h3 id="ä¸å¯å˜å¯¹è±¡å¤©ç”Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„"><a href="#ä¸å¯å˜å¯¹è±¡å¤©ç”Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„" class="headerlink" title="ä¸å¯å˜å¯¹è±¡å¤©ç”Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„"></a>ä¸å¯å˜å¯¹è±¡å¤©ç”Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„</h3><p>ç”±äºä¸å¯å˜å¯¹è±¡ä¸èƒ½è¢«æ›´æ”¹ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´è‡ªç”±å…±äº«ã€‚è¿™æ¶ˆé™¤äº†åŒæ­¥çš„éœ€æ±‚ã€‚</p><p>æ€»ä¹‹ï¼Œå‡ºäºæ•ˆç‡å’Œå®‰å…¨æ€§çš„è€ƒè™‘ï¼ŒString è¢«è®¾è®¡ä¸ºä¸å¯å˜çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å¯å˜ç±»æ˜¯é¦–é€‰çš„åŸå› ã€‚</p><h2 id="é™„åŠ è¯´æ˜"><a href="#é™„åŠ è¯´æ˜" class="headerlink" title="é™„åŠ è¯´æ˜"></a>é™„åŠ è¯´æ˜</h2><p>å…³äºä¸å¯å˜å¯¹è±¡å’Œä¸å¯å˜å¼•ç”¨æ€»æ˜¯æœ‰åŒå­¦æä¸æ¸…æ¥š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> User user = <span class="keyword">new</span> User();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æŒ‡çš„æ˜¯ user å¼•ç”¨ä¸èƒ½è¢«æ›´æ”¹æŒ‡å‘å†…å­˜çš„å…¶ä»–åœ°å€ï¼Œä½†æ˜¯ç”±äº User æ˜¯å¯å˜å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ user çš„ setter æ–¹æ³•ä¿®æ”¹å…¶å±æ€§</p><p>åœ¨Stringç±»ä¸­åŒ…å«å¾ˆå¤šå­¦é—®ï¼ŒåŒ…æ‹¬ä½ å¯¹JVMæ¨¡å‹çš„ç†è§£ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆé¢è¯•å®˜ä¸ºä»€ä¹ˆå–œæ¬¢é—®Stringï¼Œä¸»è¦è€ƒå¯Ÿä½ çš„åŸºæœ¬åŠŸ</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>String å’ŒåŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å¦‚ Integer å’Œ Long éƒ½è¢« final ä¿®é¥°ï¼Œä½†ä¸ºä»€ä¹ˆä¸å»ºè®®ä½œä¸º synchronized åŒæ­¥å—çš„å‚æ•°é€‚ç”¨å‘¢ï¼Ÿ</li><li>åŸºæœ¬ç±»å‹è‡ªåŠ¨è£…ç®±ä½ çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿå’Œä¸Šä¸€ä¸ªé—®é¢˜æœ‰å…³ç³»</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><h3 id="Material-Theme-UI"><a href="#Material-Theme-UI" class="headerlink" title="Material Theme UI"></a>Material Theme UI</h3><p>è¿™æ˜¯ä¸€æ¬¾ IDEA çš„ä¸»é¢˜æ’ä»¶ï¼Œå®‰è£…åï¼Œé€‰æ‹© <code>Material Palenight</code> ä¸»é¢˜ï¼ŒåŒæ—¶ä½œå‡ºå¦‚ä¸‹è®¾ç½®<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-31-11-43-17.png" alt=""></p><p>è®¾ç½®å®Œåï¼Œä½ çš„ IDEA å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼Œå¼•èµ·æåº¦èˆ’é€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-08-30/2019-08-31-11-39-58.jpg" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/q5cyK14WGiMm-R6NIFBcTg" target="_blank" rel="noopener">æ¯å¤©ç”¨SpringBootï¼Œè¿˜ä¸æ‡‚RESTful APIè¿”å›ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/ilND8u_8HGSTSrJiMB4X8g" target="_blank" rel="noopener">çº¢é»‘æ ‘ï¼Œè¶…å¼ºåŠ¨é™å›¾è¯¦è§£ï¼Œç®€å•æ˜“æ‡‚</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹ä¸‰å¤§æ ¸å¿ƒ</title>
      <link href="//p/java-concurrency-core.html"/>
      <url>//p/java-concurrency-core.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://mp.weixin.qq.com/s/I53l5W_Wl-lMc-_FAeJ6WQ" target="_blank" rel="noopener">è¿™æ¬¡èµ°è¿›å¹¶å‘çš„ä¸–ç•Œï¼Œè¯·ä¸è¦é”™è¿‡</a> ç»™å¤§å®¶å¸¦äº†å¹¶å‘ç¼–ç¨‹çš„å¼€èƒƒèœï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€æ­¥ä¸Šæ­£é¤ï¼Œåœ¨åƒæ­£é¤ä¹‹å‰ï¼Œæˆ‘è¿˜è¦å¼•ç”¨é‚£é¦–è¯—è¯: ã€Œæ¨ªçœ‹æˆå²­ä¾§æˆå³°ï¼Œè¿œè¿‘é«˜ä½å„ä¸åŒã€ï¼Œè¿œçœ‹çœ‹è½®å»“ï¼Œè¿‘çœ‹çœ‹ç»†èŠ‚ï¼Œä¸æ–­åˆ‡æ¢æ€ç»´æˆ–è§†è§’æ¥å­¦ä¹ </p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-27/team-3393037.jpg" alt=""></p><p>è¿œçœ‹å¹¶å‘ï¼Œ<strong>å¹¶å‘ç¼–ç¨‹å¯ä»¥æŠ½è±¡æˆä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜: åˆ†å·¥ã€åŒæ­¥/åä½œã€äº’æ–¥</strong></p><p>å¦‚æœä½ å·²ç»å·¥ä½œäº†ï¼Œé‚£ä¹ˆä½ ä¸€å®šå¬è¯´è¿‡æˆ–è€…æ­£åœ¨åº”ç”¨æ•æ·å¼€å‘æ¨¡å¼æ¥äº¤ä»˜æ—¥å¸¸çš„å·¥ä½œä»»åŠ¡ï¼Œæˆ‘ä»¬å°±ç”¨ä½ ç†Ÿæ‚‰çš„æµç¨‹æ¥è§£é‡Šè¿™ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜</p><h2 id="åˆ†å·¥"><a href="#åˆ†å·¥" class="headerlink" title="åˆ†å·¥"></a>åˆ†å·¥</h2><blockquote><p>å°†å½“å‰ Sprint çš„ Story æ‹†åˆ†æˆã€Œåˆé€‚ã€å¤§å°çš„ Taskï¼Œå¹¶ä¸”å®‰æ’ç»™ã€Œåˆé€‚ã€çš„ Team Member å»å®Œæˆ</p></blockquote><p>è¿™é‡Œé¢ç”¨äº†ä¸¤ä¸ªã€Œåˆé€‚ã€ï¼Œå°† Story æ‹†åˆ†æˆå¤§å°é€‚ä¸­ï¼Œå¯å®Œæˆçš„ Task æ˜¯éå¸¸é‡è¦çš„ã€‚æ‹†åˆ†çš„ç²’åº¦å¤ªç²—ï¼Œå¯¼è‡´è¿™ä¸ªä»»åŠ¡å®Œæˆéš¾åº¦å˜é«˜ï¼Œè€—æ—¶é•¿ï¼Œä¸æ˜“ä¸å…¶ä»–äººé…åˆï¼›æ‹†åˆ†çš„ç²’åº¦å¤ªç»†ï¼Œåˆå¯¼è‡´ä»»åŠ¡å¤ªå¤šï¼Œä¸å¥½ç®¡ç†ä¸è¿½è¸ªï¼Œæµªè´¹ç²¾åŠ›å’Œèµ„æºã€‚(<strong>åˆé€‚çš„çº¿ç¨‹æ‰èƒ½æ›´å¥½çš„å®Œæˆæ•´å—å·¥ä½œï¼Œå½“ç„¶ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è½»æ¾æå®šçš„å°±æ²¡å¿…è¦å¤šçº¿ç¨‹</strong>)ï¼›å®‰æ’ç»™åˆé€‚çš„äººå‘˜å»å®ŒæˆåŒæ ·é‡è¦ï¼ŒUX-UE é—®é¢˜äº¤ç»™åç«¯äººå‘˜å¤„ç†ï¼Œå¾ˆæ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ (<strong>ä¸»çº¿ç¨‹åº”è¯¥åšçš„äº‹äº¤ç»™å­çº¿ç¨‹æ˜¾ç„¶æ˜¯è§£å†³ä¸äº†é—®é¢˜çš„ï¼Œæ¯ä¸ªçº¿ç¨‹åšæ­£ç¡®çš„äº‹æ‰èƒ½å‘æŒ¥ä½œç”¨</strong>)</p><p>å…³äºåˆ†å·¥ï¼Œå¸¸è§çš„ Executorï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒFork/Join ç­‰ï¼Œè¿™éƒ½æ˜¯åˆ†å·¥æ€æƒ³çš„ä½“ç°</p><h2 id="åŒæ­¥-åä½œ"><a href="#åŒæ­¥-åä½œ" class="headerlink" title="åŒæ­¥/åä½œ"></a>åŒæ­¥/åä½œ</h2><p>ä»»åŠ¡æ‹†åˆ†å®Œæ¯•ï¼Œæˆ‘è¦ç­‰å¼ ä¸‰çš„ä»»åŠ¡ï¼Œå¼ ä¸‰è¦ç­‰æå››çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œåé¢çš„ä»»åŠ¡æ‰å¯ä»¥æ‰§è¡Œï¼Œäººé«˜çº§åœ¨å¯ä»¥é€šè¿‡æ²Ÿé€šåå¤ç¡®è®¤ï¼Œç¡®ä¿è‡ªå·±çš„ä»»åŠ¡å¯ä»¥å¼€å§‹æ‰§è¡Œã€‚<strong>ä½†é¢å¯¹ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ç¨‹åºçš„æ²Ÿé€šæ–¹å¼ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ï¼Œå¦‚ä½•é€šçŸ¥åç»­çº¿ç¨‹æ‰§è¡Œ</strong></p><p>æ‰€æœ‰çš„åŒæ­¥/åä½œå…³ç³»æˆ‘ä»¬éƒ½å¯ä»¥ç”¨ä½ æœ€ç†Ÿæ‚‰çš„ If-then-else æ¥è¡¨ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(å‰åºä»»åŠ¡å®Œæˆ)&#123;</span><br><span class="line">    execute();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°±æ˜¯è¯´:<strong>å½“æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ï¼›å½“æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹éœ€è¦è¢«å”¤é†’æ‰§è¡Œ</strong>ï¼Œçº¿ç¨‹ä¹‹é—´çš„åä½œå¯èƒ½æ˜¯ä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹çš„åä½œï¼Œå¯èƒ½æ˜¯å­çº¿ç¨‹ä¸å­çº¿ç¨‹çš„åˆä½œï¼Œ Java SDK ä¸­ CountDownLatch å’Œ CyclicBarrier å°±æ˜¯ç”¨æ¥è§£å†³çº¿ç¨‹åä½œé—®é¢˜çš„</p><h2 id="äº’æ–¥"><a href="#äº’æ–¥" class="headerlink" title="äº’æ–¥"></a>äº’æ–¥</h2><p><strong>åˆ†å·¥å’ŒåŒæ­¥å¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œä½†æ˜¯äº’æ–¥æ˜¯å¼ºè°ƒæ­£ç¡®æ€§</strong>ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸å¸¸æåˆ°çš„ã€Œçº¿ç¨‹å®‰å…¨ã€ï¼Œå½“å¤šä¸ªçº¿ç¨‹<strong>åŒæ—¶</strong>è®¿é—®ä¸€ä¸ªå…±äº«å˜é‡/æˆå‘˜å˜é‡æ—¶ï¼Œå°±å¯èƒ½å‘ç”Ÿä¸ç¡®å®šæ€§ï¼Œé€ æˆä¸ç¡®å®šæ€§ä¸»è¦æ˜¯æœ‰<code>å¯è§æ€§</code>ã€<code>åŸå­æ€§</code>ã€<code>æœ‰åºæ€§</code>è¿™ä¸‰å¤§é—®é¢˜ï¼Œè€Œè§£å†³è¿™äº›é—®é¢˜çš„æ ¸å¿ƒå°±æ˜¯äº’æ–¥</p><blockquote><h3 id="äº’æ–¥-1"><a href="#äº’æ–¥-1" class="headerlink" title="äº’æ–¥"></a>äº’æ–¥</h3><p> åŒä¸€æ—¶åˆ»ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«å˜é‡</p></blockquote><p>æ¥çœ‹ä¸‹å›¾ï¼Œä¸»å¹²è·¯å°±æ˜¯å…±äº«å˜é‡ï¼Œè¿›å…¥ä¸»å¹²è·¯ä¸€æ¬¡åªèƒ½æœ‰ä¸€è¾†è½¦ï¼Œè¿™æ ·ä½ æ˜¯å¦ç†è§£äº†å‘¢ï¼Ÿã€Œ<strong>å¤©ä¸‹å¤§äº‹ï¼Œåˆ†ä¹…å¿…åˆ</strong>ã€</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-27/42f62cfa83224f5b8735bc03df7deb39.gif" alt=""></p><p>åŒæ · Java SDK ä¹Ÿæœ‰å¾ˆå¤šäº’æ–¥çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½ é©¬ä¸Šå°±èƒ½æƒ³åˆ° synchronized å…³é”®å­—ï¼ŒLockï¼ŒThreadLocal ç­‰å°±æ˜¯äº’æ–¥çš„è§£å†³æ–¹æ¡ˆ</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>èµ„æœ¬å®¶ç–¯ç‹‚æ¦¨å–åŠ³åŠ¨å·¥äººçš„å‰©ä½™ä»·å€¼ï¼Œè·å¾—æœ€å¤§æ”¶ç›Šã€‚å½“ä½ é¢å¯¹ CPUï¼Œå†…å­˜ï¼ŒIO è¿™äº›åŠ³åŠ¨å·¥äººæ—¶ï¼Œä½ å°±æ˜¯é‚£ä¸ªèµ„æœ¬å®¶ï¼Œä½ è¦æ€è€ƒå¦‚ä½•<code>å……åˆ†æ¦¨å–</code>å®ƒä»¬çš„ä»·å€¼</p><blockquote><p> å½“ä¸€ä¸ªå·¥äººèƒ½å¹²çš„æ´»ï¼Œç»ä¸è®©ä¸¤ä¸ªäººæ¥å¹²(å•çº¿ç¨‹èƒ½æ»¡è¶³å°±æ²¡å¿…è¦ä¸ºäº†å¤šçº¿ç¨‹)<br>å½“å¤šä¸ªå·¥äººå¹²æ´»æ—¶ï¼Œå°±è¦è®©ä»–ä»¬åˆ†å·¥æ˜ç¡®ï¼Œåˆä½œé¡ºç•…ï¼Œæ²¡çŸ›ç›¾</p></blockquote><p>å½“ä»»åŠ¡å¾ˆå¤§æ—¶ï¼Œç”±äº IO å¹²æ´»æ…¢ï¼ŒCPU å¹²æ´»å¿«ï¼Œå°±æ²¡å¿…è¦è®© CPU æ­»ç­‰å½“å‰çš„ IOï¼Œè½¬è€Œå»æ‰§è¡Œå…¶ä»–æŒ‡ä»¤ï¼Œè¿™å°±æ˜¯<code>æ¦¨å–å‰©ä½™ä»·å€¼</code>ï¼Œå¦‚ä½•æœ€å¤§é™åº¦çš„æ¦¨å–å…¶ä»·å€¼ï¼Œè¿™å°±æ¶‰åŠåˆ°åç»­çš„è°ƒä¼˜é—®é¢˜ï¼Œæ¯”å¦‚å¤šå°‘çº¿ç¨‹åˆé€‚ç­‰</p><p><strong>åˆ†å·¥æ˜¯è®¾è®¡ï¼ŒåŒæ­¥å’Œäº’æ–¥æ˜¯å®ç°</strong>ï¼Œæ²¡æœ‰å¥½çš„è®¾è®¡ä¹Ÿå°±æ²¡æœ‰å¥½çš„å®ç°ï¼Œæ‰€ä»¥åœ¨åˆ†å·¥é˜¶æ®µï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶å‹¾åˆ’è‰å›¾ï¼Œäº†è§£ç“¶é¢ˆæ‰€åœ¨ï¼Œè¿™æ ·æ‰ä¼šæœ‰æ›´å¥½çš„å®ç°ï¼Œåç»­ç« èŠ‚çš„å†…å®¹ï¼Œæˆ‘ä¹Ÿä¼šå¸¦é¢†å¤§å®¶ç”»è‰å›¾ï¼Œåˆ†æé—®é¢˜ï¼Œé€æ­¥å…»æˆè¿™ä¸ªä¹ æƒ¯</p><p>æœ¬ç« å†…å®¹å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥ç®€å•æ¦‚æ‹¬ï¼Œå¶å­ç»“ç‚¹çš„å†…å®¹æˆ‘ä»¬ä¼šé€æ­¥ç‚¹äº®ï¼Œç°é˜¶æ®µä¸ç”¨è¿‡åˆ†å…³æ³¨(å¦‚æœä½ ä¸Šæ¥å°±å•ƒ JDK æºç ï¼Œä¹Ÿè®¸ä½ ä¼šç—›è‹¦çš„è¿·å¤±ï¼Œå¹¶æœ€ç»ˆæ”¾å¼ƒä½ çš„è¿›é˜¶ä¹‹è·¯çš„)</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-08-27/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83.png" alt=""></p><p><strong>ç†è§£ä¸‰å¤§æ ¸å¿ƒé—®é¢˜ï¼Œä½ è¦å……åˆ†ç»“åˆç”Ÿæ´»ä¸­çš„å®é™…ï¼Œç¨‹åºä¸­çš„å¹¶å‘é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šéƒ½èƒ½åœ¨å®é™…ç”Ÿæ´»ä¸­æ‰¾å¾—åˆ°åŸå‹</strong></p><p>ä¸‹ä¸€ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±è¦èŠèŠï¼Œå¼•èµ·çº¿ç¨‹å®‰å…¨çš„ä¸‰ä¸ªé—®é¢˜:ã€Œå¯è§æ€§ï¼ŒåŸå­æ€§ï¼Œæœ‰åºæ€§ã€ï¼Œè¿™æ¶‰åŠåˆ° JMM çš„ä¸€ç‚¹å†…å®¹ï¼Œå¯ä»¥æå‰äº†è§£ä¸€ä¸‹çš„ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ›´å¥½çš„ç¢°æ’</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>å·¥ä½œä¸­å¤šçº¿ç¨‹ç¼–ç¨‹çš„åœºæ™¯å¤šå—ï¼Ÿ</li><li>æƒ³åˆ°å¤šçº¿ç¨‹ï¼Œåªä¼šæƒ³åˆ° synchronized å—ï¼Ÿ</li><li>Java å¹¶å‘åŒ…å„ä¸ªç±»ï¼Œä½ æœ‰äº†è§£åº•å±‚å®ç°å’Œè®¾è®¡ç†å¿µå—ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/q5cyK14WGiMm-R6NIFBcTg" target="_blank" rel="noopener">æ¯å¤©ç”¨SpringBootï¼Œè¿˜ä¸æ‡‚RESTful APIè¿”å›ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/ilND8u_8HGSTSrJiMB4X8g" target="_blank" rel="noopener">çº¢é»‘æ ‘ï¼Œè¶…å¼ºåŠ¨é™å›¾è¯¦è§£ï¼Œç®€å•æ˜“æ‡‚</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å·¥ </tag>
            
            <tag> åŒæ­¥ </tag>
            
            <tag> äº’æ–¥ </tag>
            
            <tag> Java-Concurrency </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹ä¹‹åˆæ¢</title>
      <link href="//p/java-concurrency-metaphor.html"/>
      <url>//p/java-concurrency-metaphor.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p><code>Java æœ‰è¿›é˜¶ï¼Œå…¶åä¸ºå¹¶å‘ï¼Œå¹¶å‘çŸ¥è¯†ä¹‹å¤§ï¼Œä¸€å£åƒä¸ä¸‹</code>ã€‚é‚£å¥½ï¼Œè¯·æ‚¨å¤šåƒå‡ å£ï¼Œåˆæ²¡è¯´ä¸€é¡¿åƒå®Œï¼Œç»†åš¼æ…¢å’½æ‰æœ‰å‘³.  æ‰€æœ‰ Java ä¹¦ç±éƒ½å°†å¹¶å‘ç¼–ç¨‹æ”¾åœ¨å…¶é«˜çº§/è¿›é˜¶ç¯‡ç« ä¸­ï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œå­¦å¥½å¹¶å‘ä¹Ÿæ˜¯è‡ªèº«èµ°å…¥é«˜çº§è¡Œåˆ—çš„å¿…å¤‡ç´ è´¨ä¹‹ä¸€</p><p><code>å¹¶å‘/å¹¶è¡Œ</code>ï¼Œ<code>è¿›ç¨‹/çº¿ç¨‹</code> è¿™äº›æ¦‚å¿µæ€»æ˜¯æ˜¾å¾—è¿‡äºæŠ½è±¡ï¼Œå› ä¸ºè¿™æ˜¯ä¸æ“ä½œç³»ç»Ÿæ²Ÿé€šç”¨åˆ°çš„è¯æ±‡ï¼Œå°±åƒæˆ‘ä»¬ä¹ æƒ¯äº†ä½¿ç”¨åè¿›åˆ¶ç®—æ³•ï¼ŒäºŒè¿›åˆ¶å’Œ 16 è¿›åˆ¶å°±éœ€è¦æ€ç»´çš„åˆ‡æ¢ï¼›ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å½¼æ­¤æ€»æ˜¯ä¸èƒ½äº’ç›¸ç†è§£ï¼Œå¹³é™ä¹‹åï¼Œæˆ‘ä»¬çŸ¥é“è¦æ¢ä½æ€è€ƒï¼›ç¨‹åºçš„ä¸–ç•Œä¹Ÿä¸€æ ·ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£é—®é¢˜ï¼Œä½ ä¹Ÿè¦ç«™åœ¨æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥æ€è€ƒé—®é¢˜ï¼Œä½†å½“ä½ å°è¯•ç†è§£å¯¹æ–¹æ—¶ï¼Œæ˜¯è¿èƒŒè‡ªå·±è®¤çŸ¥ä¹ æƒ¯çš„ï¼Œæ‰€ä»¥æœ‰äº›å›°éš¾åœ¨æ‰€éš¾å…</p><p>ç”Ÿæ´»ä¸­ä½ ä¸€å®šè¯´è¿‡ã€Œæ€é¸¡ç„‰ç”¨ç‰›åˆ€ï¼Ÿã€è¿™å¥è¯ï¼Œå¹¶å‘ç¼–ç¨‹ä¸­çš„å„ç§é”(å†…ç½®é”/æ˜¾ç¤ºé”/åå‘é”/è½»é‡é”/é‡é‡é”/ä¹è§‚é”/æ‚²è§‚é”)ï¼Œçœ‹åˆ°çœ¼èŠ±ç¼­ä¹±ï¼Œæœ‰æ—¶å€™å¾ˆå°çš„é—®é¢˜å´ç”¨äº†å¾ˆé‡çš„é”ï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼›ä½†æ˜¯è¿™äº›é”ï¼Œæ²¡æœ‰æœ€å¥½çš„é‚£ä¸ªï¼Œåªæœ‰æœ€åˆé€‚å’Œæ›´é«˜æ•ˆçš„é‚£ä¸ª</p><p>JUC (java.util.concurrent) åŒ…éšç€ JDK çš„ç‰ˆæœ¬å‡çº§å†…å®¹ä¹Ÿå˜çš„è¶Šæ¥è¶Šå¤šï¼Œé¢å¯¹ç³ç…æ»¡ç›®çš„å¹¶å‘ç±»ï¼Œåˆæœ‰äº›æ— ä»ä¸‹æ‰‹ï¼Œå…¶å®ä»–ä»¬éƒ½æœ‰ä¸€å®šçš„è”ç³»ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å‡çº§çš„ä¸»çº¿ï¼Œè®©å…¶å˜å¾—æœ‰è¿¹å¯å¾ª.</p><p>è°ˆåŠå¹¶å‘ç¼–ç¨‹ï¼Œæˆ‘è¿˜æ˜¯å¸¦æœ‰ä¸€ä¸æƒ¶æ:</p><ul><li>å¦‚ä½•å°†è¿™äº›æŠ½è±¡çš„æ¦‚å¿µå˜å¾—å…·è±¡ï¼Ÿ</li><li>å¦‚ä½•å°†ç¼–ç¨‹é—®é¢˜è”ç³»åˆ°ç”Ÿæ´»å®é™…?</li><li>å¦‚ä½•åœ¨æŠ½è±¡å’Œå…·è±¡ä¹‹é—´åˆ‡æ¢æ€ç»´?</li></ul><p>ä¸ªäººè§‰å¾—è¿™äº›éƒ½æ˜¯å­¦å¥½å¹¶å‘ç¼–ç¨‹çš„å…³é”®ã€‚æ‰€ä»¥å…³äºå¹¶å‘ç¼–ç¨‹çš„ç³»åˆ—æ–‡ç« ï¼Œæˆ‘æ‰“ç®—ä»ä»¥ä¸Šå‡ ç‚¹å‡ºå‘ï¼Œå°†æŠ€æœ¯é—®é¢˜ä»¥å¹½é»˜é£è¶£å…·è±¡çš„æ–¹å¼è½åœ°</p><h2 id="å¦‚ä½•å­¦å¹¶å‘"><a href="#å¦‚ä½•å­¦å¹¶å‘" class="headerlink" title="å¦‚ä½•å­¦å¹¶å‘"></a>å¦‚ä½•å­¦å¹¶å‘</h2><p>ã€Œæ¨ªçœ‹æˆå²­ä¾§æˆå³°ï¼Œè¿œè¿‘é«˜ä½å„ä¸åŒã€ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å¤šæ¬¡å¼•ç”¨äº†è¿™æ®µè¯—è¯ï¼Œæˆ‘ä»¬å­¦ä¹ æŠ€æœ¯ä¹Ÿè¦è¿™æ ·ï¼Œè¿œè§‚çœ‹è½®å»“ï¼Œè¿‘è§‚çœ‹ç»†èŠ‚ï¼Œä»ä¸åŒçš„è§’åº¦çœ‹å¾…é—®é¢˜ï¼Œåœ¨åç»­çš„æ–‡ç« ä¸­ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ä¸è¦å°†æ€ç»´å±€é™ï¼Œå°è¯•è·³å…¥/è·³å‡ºï¼ŒæŠ½è±¡/å…·è±¡</p><blockquote><p>éƒ‘é‡å£°æ˜ï¼Œæ¥ä¸‹æ¥ä¸æ˜¯å¹¿å‘Š<br>æˆ‘å¸Œæœ›å’Œå¤§å®¶å…±åŒå®Œæˆå¹¶å‘ç¼–ç¨‹ç³»åˆ—æœ‰æ›´å¤šçš„æ€æƒ³ç¢°æ’ï¼Œå¸Œæœ›å¤§å®¶åœ¨è¯»è¿™ä¸ªç³»åˆ—çš„åŒæ—¶ä¹Ÿé˜…è¯»ä»¥ä¸‹ä¹¦ç±é€æ­¥å½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»ï¼Œè¿™é‡Œé™„ä¸Šä¸ªäººè®¤ä¸ºçš„æœ€ä½³é˜…è¯»é¡ºåº:</p></blockquote><blockquote><h4 id="1-ã€ŒJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€"><a href="#1-ã€ŒJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€" class="headerlink" title="1.ã€ŒJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€"></a>1.ã€ŒJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€</h4><p> è¯¥ä¹¦ç±æ˜¯å€¼å¾—è¿”å›çœ‹çš„ï¼Œç¬¬ä¸€éä¸éœ€è¦ç²¾åº¦ï¼Œä¸»è¦æ˜¯ä¸ºäº†å»ºç«‹ä¸€ä¸ªå¹¶å‘çš„æ€æƒ³ï¼Œå’Œå…³é”®æœ¯è¯­çš„å¤§è‡´è®°å¿†ï¼Œå…ˆé˜…è¯»ç¬¬ 16 ç« ä¹Ÿæ˜¯æå¥½çš„ï¼Œç†è§£ JMM æ˜¯å®è·µå¹¶å‘ç¼–ç¨‹çš„åŸºç¡€</p><h4 id="2-ã€Œç å‡ºé«˜æ•ˆã€"><a href="#2-ã€Œç å‡ºé«˜æ•ˆã€" class="headerlink" title="2. ã€Œç å‡ºé«˜æ•ˆã€"></a>2. ã€Œç å‡ºé«˜æ•ˆã€</h4><p>å¯ç›´æ¥é˜…è¯»ç¬¬ä¸ƒç« ã€Œå¹¶å‘ä¸å¤šçº¿ç¨‹ã€ï¼Œè¿™ä¸ªç« èŠ‚æ›´å¥½çš„å°†æŠ€æœ¯é—®é¢˜è”ç³»åˆ°äº†ç”Ÿæ´»å®é™…ï¼Œæœ‰äº†ã€Œå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€çš„é“ºåº•ï¼Œç›¸ä¿¡ï¼Œçœ‹è¿™ä¸ªç« èŠ‚ä¼šæ›´æœ‰æ„Ÿè§‰</p><h4 id="3-ã€ŒJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€"><a href="#3-ã€ŒJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€" class="headerlink" title="3. ã€ŒJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€"></a>3. ã€ŒJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€</h4><p> è¿™æœ¬ä¹¦ä»ç¬¬ 5 ç« å¼€å§‹ï¼Œå°±ä¼šæœ‰æºç åˆ†æï¼Œæœ‰å‰è¾ˆå¸¦é¢†è¯»æºç ï¼Œè½»æ¾å¤šäº†ï¼Œè¿™å›è®©ä½ æ›´åŠ äº†è§£æœ¬è´¨ï¼ŒåŒæ—¶ä¹Ÿä¼šæ‰¾åˆ° JUC å‡çº§çš„ä¸»çº¿</p><h4 id="4-ã€ŒJava-å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€"><a href="#4-ã€ŒJava-å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€" class="headerlink" title="4. ã€ŒJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€"></a>4. ã€ŒJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€</h4><p>è¿™æœ¬ä¹¦ä¼šæ»¡è¶³ä½ ä»å„ä¸ªè§’åº¦çœ‹å¾…å¹¶å‘ç¼–ç¨‹é—®é¢˜</p></blockquote><p>æ…é‡ï¼Œå¦‚æœä½ æ˜¯ä¹°ä¹¦å¦‚å±±å€’ï¼Œè¯»ä¹¦å¦‚æŠ½ä¸çš„ç«¥é‹ï¼Œè¯·å¿½ç•¥è¿™ç‚¹å†…å®¹ï¼Œåœæ­¢ä½ çš„ä¹°ä¹¦è¡ŒåŠ¨ï¼Œè¯·å®‰å¿ƒè·Ÿè¸ªå…¬ä¼—å·çš„å†…å®¹å³å¯</p><h2 id="è®¡åˆ’"><a href="#è®¡åˆ’" class="headerlink" title="è®¡åˆ’"></a>è®¡åˆ’</h2><p>å¦‚æ— ç‰¹æ®Šå¼‚å¸¸ï¼Œä¼šæŒ‰ç…§ 1 å‘¨ 1 ç¯‡çš„èŠ‚å¥æ¥åˆ†äº«ï¼Œä¼šæ§åˆ¶ç¯‡å¹…å¤§å°ï¼Œç»™å¤§å®¶ç•™æœ‰æ€è€ƒç©ºé—´ï¼ŒæœŸå¾…å¤§å®¶å¸¦ç€ç–‘é—®ç­‰å¾…ä¸‹ä¸€ç¯‡æ–‡ç« çš„åˆ°æ¥ï¼Œæˆ‘ä¼šä»å¤§å®¶æ›´å¤šäº†è§£çš„å†…å®¹å‡ºå‘ï¼Œé€æ­¥èµ°å…¥å¹¶å‘çš„ä¸–ç•Œ</p><h2 id="å¹¶å‘å¼€èƒƒèœ"><a href="#å¹¶å‘å¼€èƒƒèœ" class="headerlink" title="å¹¶å‘å¼€èƒƒèœ"></a>å¹¶å‘å¼€èƒƒèœ</h2><p>ä¸å†å¤šåºŸè¯ï¼Œæ‹¿å‡ºä¹‹å‰æ”¶è—çš„ä¸€ç¯‡æ–‡ç« ä½œä¸ºå¹¶å‘ç¼–ç¨‹çš„å¼€èƒƒå°èœï¼Œé€šè¿‡è¿™ä¸ªå½¢è±¡æ¯”å–»ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¯¹å¹¶å‘æœ‰ä¸ªåˆæ­¥çš„äº†è§£:</p><blockquote><p>æ‘˜è‡ª: <a href="https://www.cnblogs.com/CoolRandy/p/3169938.html" target="_blank" rel="noopener">https://www.cnblogs.com/CoolRandy/p/3169938.html</a></p></blockquote><p>è§‰å¾—å›¾è§£çš„å¾ˆåˆ°ä½ï¼Œå°†å¹¶å‘ç¼–ç¨‹çš„å‡ ä¸ªæ ¸å¿ƒè¦ç´ éƒ½ä»¥å…·è±¡çš„å½¢å¼è¡¨è¾¾å‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ä½•ä¸º <strong>è¿›ç¨‹</strong>ï¼ˆ<strong>process</strong>ï¼‰å’Œ <strong>çº¿ç¨‹</strong>ï¼ˆ<strong>thread</strong>ï¼‰</p><p>1.è®¡ç®—æœºçš„æ ¸å¿ƒæ˜¯CPUï¼Œå®ƒæ‰¿æ‹…äº†æ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡ã€‚å®ƒå°±åƒä¸€åº§å·¥å‚ï¼Œæ—¶åˆ»åœ¨è¿è¡Œã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-23-20.jpg" alt=""></p><p>2.å‡å®šå·¥å‚çš„ç”µåŠ›æœ‰é™ï¼Œä¸€æ¬¡åªèƒ½ä¾›ç»™ä¸€ä¸ªè½¦é—´ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè½¦é—´å¼€å·¥çš„æ—¶å€™ï¼Œå…¶ä»–è½¦é—´éƒ½å¿…é¡»åœå·¥ã€‚èƒŒåçš„å«ä¹‰å°±æ˜¯ï¼Œå•ä¸ª CPU ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-24-05.jpg" alt=""></p><p>3.<strong>è¿›ç¨‹</strong>å°±å¥½æ¯”å·¥å‚çš„è½¦é—´ï¼Œå®ƒä»£è¡¨ CPU æ‰€èƒ½å¤„ç†çš„å•ä¸ªä»»åŠ¡ã€‚ä»»ä¸€æ—¶åˆ»ï¼ŒCPU æ€»æ˜¯è¿è¡Œä¸€ä¸ª <strong>è¿›ç¨‹</strong>ï¼Œå…¶ä»– <strong>è¿›ç¨‹</strong> å¤„äºéè¿è¡ŒçŠ¶æ€ã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-24-41.jpg" alt=""></p><p>4.ä¸€ä¸ªè½¦é—´é‡Œï¼Œå¯ä»¥æœ‰å¾ˆå¤šå·¥äººã€‚ä»–ä»¬ååŒå®Œæˆä¸€ä¸ªä»»åŠ¡ã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-25-08.jpg" alt=""></p><p>5.<strong>çº¿ç¨‹</strong> å°±å¥½æ¯”è½¦é—´é‡Œçš„å·¥äººã€‚ä¸€ä¸ª <strong>è¿›ç¨‹</strong> å¯ä»¥åŒ…æ‹¬å¤šä¸ª <strong>çº¿ç¨‹</strong>ã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-25-36.jpg" alt=""></p><p>6.è½¦é—´çš„ç©ºé—´æ˜¯å·¥äººä»¬å…±äº«çš„ï¼Œæ¯”å¦‚è®¸å¤šæˆ¿é—´æ˜¯æ¯ä¸ªå·¥äººéƒ½å¯ä»¥è¿›å‡ºçš„ã€‚è¿™è±¡å¾ä¸€ä¸ª <strong>è¿›ç¨‹</strong> çš„å†…å­˜ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ¯ä¸ª <strong>çº¿ç¨‹</strong> éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›å…±äº«å†…å­˜ã€‚</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-26-04.jpg" alt=""></p><p>7.å¯æ˜¯ï¼Œæ¯é—´æˆ¿é—´çš„å¤§å°ä¸åŒï¼Œæœ‰äº›æˆ¿é—´æœ€å¤šåªèƒ½å®¹çº³ä¸€ä¸ªäººï¼Œæ¯”å¦‚å•æ‰€ã€‚é‡Œé¢æœ‰äººçš„æ—¶å€™ï¼Œå…¶ä»–äººå°±ä¸èƒ½è¿›å»äº†ã€‚è¿™ä»£è¡¨ä¸€ä¸ª <strong>çº¿ç¨‹</strong> ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»– <strong>çº¿ç¨‹</strong> å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-26-34.jpg" alt=""></p><p>8.ä¸€ä¸ªé˜²æ­¢ä»–äººè¿›å…¥çš„ç®€å•æ–¹æ³•ï¼Œå°±æ˜¯é—¨å£åŠ ä¸€æŠŠé”ã€‚å…ˆåˆ°çš„äººé”ä¸Šé—¨ï¼Œååˆ°çš„äººçœ‹åˆ°ä¸Šé”ï¼Œå°±åœ¨é—¨å£æ’é˜Ÿï¼Œç­‰é”æ‰“å¼€å†è¿›å»ã€‚è¿™å°±å« â€œäº’æ–¥é”â€ï¼ˆMutual exclusionï¼Œç¼©å†™ Mutexï¼‰ï¼Œé˜²æ­¢å¤šä¸ª <strong>çº¿ç¨‹</strong> åŒæ—¶è¯»å†™æŸä¸€å—å†…å­˜åŒºåŸŸã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-27-08.jpg" alt=""></p><p>9.è¿˜æœ‰äº›æˆ¿é—´ï¼Œå¯ä»¥åŒæ—¶å®¹çº³ n ä¸ªäººï¼Œæ¯”å¦‚å¨æˆ¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœäººæ•°å¤§äºnï¼Œå¤šå‡ºæ¥çš„äººåªèƒ½åœ¨å¤–é¢ç­‰ç€ã€‚è¿™å¥½æ¯”æŸäº›å†…å­˜åŒºåŸŸï¼Œåªèƒ½ä¾›ç»™å›ºå®šæ•°ç›®çš„ <strong>çº¿ç¨‹</strong> ä½¿ç”¨ã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-27-37.jpg" alt=""></p><p>10.è¿™æ—¶çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯åœ¨é—¨å£æŒ‚ n æŠŠé’¥åŒ™ã€‚è¿›å»çš„äººå°±å–ä¸€æŠŠé’¥åŒ™ï¼Œå‡ºæ¥æ—¶å†æŠŠé’¥åŒ™æŒ‚å›åŸå¤„ã€‚ååˆ°çš„äººå‘ç°é’¥åŒ™æ¶ç©ºäº†ï¼Œå°±çŸ¥é“å¿…é¡»åœ¨é—¨å£æ’é˜Ÿç­‰ç€äº†ã€‚è¿™ç§åšæ³•å«åš â€œä¿¡å·é‡â€ï¼ˆSemaphoreï¼‰ï¼Œç”¨æ¥ä¿è¯å¤šä¸ª <strong>çº¿ç¨‹</strong> ä¸ä¼šäº’ç›¸å†²çªã€‚</p><p>ä¸éš¾çœ‹å‡ºï¼ŒMutex (äº’æ–¥é”) æ˜¯ Semaphore (ä¿¡å·é‡)çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼ˆn=1æ—¶ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®Œå…¨å¯ä»¥ç”¨åè€…æ›¿ä»£å‰è€…ã€‚ä½†æ˜¯ï¼Œå› ä¸º mutex è¾ƒä¸ºç®€å•ï¼Œä¸”æ•ˆç‡é«˜ï¼Œæ‰€ä»¥åœ¨å¿…é¡»ä¿è¯èµ„æºç‹¬å çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯é‡‡ç”¨è¿™ç§è®¾è®¡ã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-28-09.jpg" alt=""></p><p>11.æ“ä½œç³»ç»Ÿçš„è®¾è®¡ï¼Œå› æ­¤å¯ä»¥å½’ç»“ä¸ºä¸‰ç‚¹ï¼š<br>ï¼ˆ1ï¼‰ä»¥å¤š <strong>è¿›ç¨‹</strong> å½¢å¼ï¼Œå…è®¸å¤šä¸ªä»»åŠ¡åŒæ—¶è¿è¡Œï¼›<br>ï¼ˆ2ï¼‰ä»¥å¤š <strong>çº¿ç¨‹</strong> å½¢å¼ï¼Œå…è®¸å•ä¸ªä»»åŠ¡åˆ†æˆä¸åŒçš„éƒ¨åˆ†è¿è¡Œï¼›<br>ï¼ˆ3ï¼‰æä¾›åè°ƒæœºåˆ¶ï¼Œä¸€æ–¹é¢é˜²æ­¢ <strong>è¿›ç¨‹</strong> ä¹‹é—´å’Œ <strong>çº¿ç¨‹</strong> ä¹‹é—´äº§ç”Ÿå†²çªï¼Œå¦ä¸€æ–¹é¢å…è®¸ <strong>è¿›ç¨‹</strong> ä¹‹é—´å’Œ <strong>çº¿ç¨‹</strong> ä¹‹é—´å…±äº«èµ„æºã€‚</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B/_image/2019-07-25/2019-08-25-20-28-40.jpg" alt=""></p><p>ç›¸ä¿¡çœ‹è¿‡è¿™ä¹‹åå°±äº†è§£äº†å¹¶å‘ç¼–ç¨‹å¤§æ¦‚è¦å…³æ³¨çš„ä¸€äº›å†…å®¹äº†ï¼Œåœ¨åç»­çš„æ–‡ç« ä¸­ï¼Œå¸Œæœ›å¤§å®¶ç‰¢è®°ï¼Œä½ æ˜¯ä¸€ä¸ªå·¥å‚åªèƒ½æœ‰ä¸€ä¸ªè½¦é—´è¿è¡Œçš„è´Ÿè´£äººï¼Œå¦‚ä½•è®©å·¥äººé«˜æ•ˆçš„å¹²æ´»ä¸”ä¸å‡ºå·®é”™ï¼Œä¹Ÿä¸èµ·å†²çªï¼Œä½ å°±æ˜¯åˆæ ¼çš„è´Ÿè´£äººâ€¦â€¦</p><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""> [center]</p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/6dg3u2PkcTSQHu_3T_QYnA" target="_blank" rel="noopener">åªä¼šç”¨ git pull ï¼Ÿæœ‰æ—¶å€™ä½ å¯ä»¥å°è¯•æ›´ä¼˜é›…çš„å¤„ç†æ–¹å¼ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java-Concurrency </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java-Concurrency </tag>
            
            <tag> thread </tag>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootç»Ÿä¸€å¼‚å¸¸å¤„ç†</title>
      <link href="//p/spring-boot-global-exception.html"/>
      <url>//p/spring-boot-global-exception.html</url>
      
        <content type="html"><![CDATA[<h2 id="è¯è¯´å¼‚å¸¸"><a href="#è¯è¯´å¼‚å¸¸" class="headerlink" title="è¯è¯´å¼‚å¸¸"></a>è¯è¯´å¼‚å¸¸</h2><p><code>ã€Œæ¬²æ¸¡é»„æ²³å†°å¡å·ï¼Œå°†ç™»å¤ªè¡Œé›ªæ»¡å¤©ã€</code>ï¼Œæ— è®ºç”Ÿæ´»è¿˜æ˜¯è®¡ç®—æœºä¸–ç•Œéš¾å…å‘ç”Ÿå¼‚å¸¸ï¼Œä¸Šä¸€ç¯‡æ–‡ç« <a href="https://fraseryu.github.io/2019/08/08/mei-tian-yong-springboot-huan-bu-dong-tong-yi-fan-hui-shu-ju-ge-shi-shi-zen-me-shi-xian-de/#toc-heading-2" target="_blank" rel="noopener">RESTful API è¿”å›ç»Ÿä¸€JSONæ•°æ®æ ¼å¼</a> è¯´æ˜äº†ç»Ÿä¸€è¿”å›çš„å¤„ç†ï¼Œè¿™æ˜¯è¯·æ±‚ä¸€åˆ‡æ­£å¸¸çš„æƒ…å½¢ï¼›<strong>è¿™ç¯‡æ–‡ç« å°†è¯´æ˜å¦‚ä½•ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼Œä»¥åŠå…¶èƒŒåçš„å®ç°åŸç†</strong>ï¼Œè€å¥—è·¯ï¼Œå…ˆå®ç°ï¼Œåè¯´æ˜åŸç†ï¼Œæœ‰äº†ä¸Šä¸€ç¯‡æ–‡ç« çš„é“ºåº•ï¼Œç›¸ä¿¡ï¼Œç†è§£è¿™ç¯‡æ–‡ç« å°±é©¾è½»å°±ç†Ÿäº†</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-09/sunset-3325080_1920.jpg" alt=""></p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="æ–°å»ºä¸šåŠ¡å¼‚å¸¸"><a href="#æ–°å»ºä¸šåŠ¡å¼‚å¸¸" class="headerlink" title="æ–°å»ºä¸šåŠ¡å¼‚å¸¸"></a>æ–°å»ºä¸šåŠ¡å¼‚å¸¸</h3><p>æ–°å»º BusinessException.class ç±»è¡¨ç¤ºä¸šåŠ¡å¼‚å¸¸ï¼Œ<strong>æ³¨æ„è¿™æ˜¯ä¸€ä¸ª Runtime å¼‚å¸¸</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String errorCode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String errorMsg;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ ç»Ÿä¸€å¼‚å¸¸å¤„ç†é™æ€æ–¹æ³•"><a href="#æ·»åŠ ç»Ÿä¸€å¼‚å¸¸å¤„ç†é™æ€æ–¹æ³•" class="headerlink" title="æ·»åŠ ç»Ÿä¸€å¼‚å¸¸å¤„ç†é™æ€æ–¹æ³•"></a>æ·»åŠ ç»Ÿä¸€å¼‚å¸¸å¤„ç†é™æ€æ–¹æ³•</h3><p>åœ¨ CommonResult ç±»ä¸­æ·»åŠ é™æ€æ–¹æ³• errorResult ç”¨äºæ¥æ”¶å¼‚å¸¸ç å’Œå¼‚å¸¸æ¶ˆæ¯:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">CommonResult&lt;T&gt; <span class="title">errorResult</span><span class="params">(String errorCode, String errorMsg)</span></span>&#123;</span><br><span class="line">    CommonResult&lt;T&gt; commonResult = <span class="keyword">new</span> CommonResult&lt;&gt;();</span><br><span class="line">    commonResult.errorCode = errorCode;</span><br><span class="line">    commonResult.errorMsg = errorMsg;</span><br><span class="line">    commonResult.status = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> commonResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åŒæ ·è¦ç”¨åˆ° <code>@RestControllerAdvice</code> æ³¨è§£ï¼Œå°†ç»Ÿä¸€å¼‚å¸¸æ·»åŠ åˆ°é…ç½®ä¸­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span>(<span class="string">"com.example.unifiedreturn.api"</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UnifiedExceptionHandler</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(BusinessException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Void&gt; <span class="title">handleBusinessException</span><span class="params">(BusinessException be)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> CommonResult.errorResult(be.getErrorCode(), be.getErrorMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰éƒ¨æå®šï¼Œåˆ°è¿™é‡Œæ— è®ºæ˜¯ Controller è¿˜æ˜¯ Service ä¸­ï¼Œåªè¦æŠ›å‡º BusinessException, æˆ‘ä»¬éƒ½ä¼šè¿”å›ç»™å‰ç«¯ä¸€ä¸ªç»Ÿä¸€æ•°æ®æ ¼å¼</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å°† UserController ä¸­çš„æ–¹æ³•è¿›è¡Œæ”¹é€ ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> UserVo <span class="title">getUserById</span><span class="params">(@PathVariable Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">"1001"</span>, <span class="string">"æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨ä¸­è¾“å…¥:  <em><a href="http://localhost:8080/users/1" target="_blank" rel="noopener">http://localhost:8080/users/1</a></em></p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-09/2019-08-09-14-29-07.png" alt=""></p><p>åœ¨ Service ä¸­æŠ›å‡ºå¼‚å¸¸:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserVo <span class="title">getUserById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">"1001"</span>, <span class="string">"æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ˜¯å¾—åˆ°åŒæ ·çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬å°½å¯èƒ½çš„æŠ›å‡ºå¼‚å¸¸å§ (ä½œä¸ºä¸€ä¸ªç¨‹åºçŒ¿è¿™ç§å¿ƒç†å¾ˆå¯æ‹)</p><h2 id="è§£å‰–å®ç°è¿‡ç¨‹"><a href="#è§£å‰–å®ç°è¿‡ç¨‹" class="headerlink" title="è§£å‰–å®ç°è¿‡ç¨‹"></a>è§£å‰–å®ç°è¿‡ç¨‹</h2><p>è§£å‰–è¿™ä¸ªè¿‡ç¨‹æ˜¯ç›¸å½“çº ç»“çš„ï¼Œä¸ºäº†æ›´å¥½çš„è¯´(yin)æ˜(wei)é—®(wo)é¢˜(lan)ï¼Œæˆ‘è¦è¯´é‡ä¸­ä¹‹é‡äº†ï¼ŒçœŸå¿ƒå¸Œæœ›çœ‹è¯¥æ–‡ç« çš„ç«¥é‹è‡ªå·±å»æ¡ˆå‘ç°åœºå‘ç°çº¿ç´¢<br>è¿˜æ˜¯åœ¨ WebMvcConfigurationSupport ç±»ä¸­å®ä¾‹åŒ–äº† HandlerExceptionResolver Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HandlerExceptionResolver <span class="title">handlerExceptionResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;HandlerExceptionResolver&gt; exceptionResolvers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    configureHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    <span class="keyword">if</span> (exceptionResolvers.isEmpty()) &#123;</span><br><span class="line">        addDefaultHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    extendHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    HandlerExceptionResolverComposite composite = <span class="keyword">new</span> HandlerExceptionResolverComposite();</span><br><span class="line">    composite.setOrder(<span class="number">0</span>);</span><br><span class="line">    composite.setExceptionResolvers(exceptionResolvers);</span><br><span class="line">    <span class="keyword">return</span> composite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ¯›ä¸€æ ·çš„å¥—è·¯ï¼ŒExceptionHandlerExceptionResolver å®ç°äº† InitializingBean æ¥å£ï¼Œé‡å†™äº† afterPropertiesSet æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do this first, it may add ResponseBodyAdvice beans</span></span><br><span class="line">    initExceptionHandlerAdviceCache();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initExceptionHandlerAdviceCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getApplicationContext() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;ControllerAdviceBean&gt; adviceBeans = ControllerAdviceBean.findAnnotatedBeans(getApplicationContext());</span><br><span class="line">    AnnotationAwareOrderComparator.sort(adviceBeans);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ControllerAdviceBean adviceBean : adviceBeans) &#123;</span><br><span class="line">        Class&lt;?&gt; beanType = adviceBean.getBeanType();</span><br><span class="line">        <span class="keyword">if</span> (beanType == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unresolvable type for ControllerAdviceBean: "</span> + adviceBean);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡ç‚¹çœ‹è¿™ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line">        ExceptionHandlerMethodResolver resolver = <span class="keyword">new</span> ExceptionHandlerMethodResolver(beanType);</span><br><span class="line">        <span class="keyword">if</span> (resolver.hasExceptionMappings()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.exceptionHandlerAdviceCache.put(adviceBean, resolver);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ResponseBodyAdvice.class.isAssignableFrom(beanType)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.responseBodyAdvice.add(adviceBean);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹çœ‹ä¸Šé¢æˆ‘ç”¨æ³¨é‡Šæ ‡è®°çš„æ„é€ æ–¹æ³•ï¼Œä»£ç å¾ˆå¥½æ‡‚ï¼Œä»”ç»†çœ‹çœ‹å§ï¼Œå…¶å®å°±æ˜¯ç­›é€‰å‡ºæˆ‘ä»¬ç”¨ @ExceptionHandler æ³¨è§£æ ‡è®°çš„æ–¹æ³•å¹¶æ”¾åˆ°é›†åˆå½“ä¸­ï¼Œç”¨äºåç»­å…¨å±€å¼‚å¸¸æ•è·çš„åŒ¹é…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A constructor that finds &#123;<span class="doctag">@link</span> ExceptionHandler&#125; methods in the given type.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handlerType the type to introspect</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ExceptionHandlerMethodResolver</span><span class="params">(Class&lt;?&gt; handlerType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Method method : MethodIntrospector.selectMethods(handlerType, EXCEPTION_HANDLER_METHODS)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;? extends Throwable&gt; exceptionType : detectExceptionMappings(method)) &#123;</span><br><span class="line">            addExceptionMapping(exceptionType, method);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Extract exception mappings from the &#123;<span class="doctag">@code</span> <span class="doctag">@ExceptionHandler</span>&#125; annotation first,</span></span><br><span class="line"><span class="comment"> * and then as a fallback from the method signature itself.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="keyword">private</span> List&lt;Class&lt;? extends Throwable&gt;&gt; detectExceptionMappings(Method method) &#123;</span><br><span class="line">    List&lt;Class&lt;? extends Throwable&gt;&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    detectAnnotationExceptionMappings(method, result);</span><br><span class="line">    <span class="keyword">if</span> (result.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; paramType : method.getParameterTypes()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Throwable.class.isAssignableFrom(paramType)) &#123;</span><br><span class="line">                result.add((Class&lt;? extends Throwable&gt;) paramType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"No exception types mapped to "</span> + method);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">detectAnnotationExceptionMappings</span><span class="params">(Method method, List&lt;Class&lt;? extends Throwable&gt;&gt; result)</span> </span>&#123;</span><br><span class="line">    ExceptionHandler ann = AnnotatedElementUtils.findMergedAnnotation(method, ExceptionHandler.class);</span><br><span class="line">    Assert.state(ann != <span class="keyword">null</span>, <span class="string">"No ExceptionHandler annotation"</span>);</span><br><span class="line">    result.addAll(Arrays.asList(ann.value()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ <code>@RestControllerAdvice</code> å’Œ <code>@ExceptionHandler</code> æ³¨è§£å°±ä¼šè¢« Spring æ‰«æåˆ°ä¸Šä¸‹æ–‡ï¼Œä¾›æˆ‘ä»¬ä½¿ç”¨</p><p>è®©æˆ‘ä»¬å›åˆ°ä½ æœ€ç†Ÿæ‚‰çš„è°ƒç”¨çš„å…¥å£ DispatcherServlet ç±»çš„  doDispatch æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">null</span>;</span><br><span class="line">        Exception dispatchException = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// å½“è¯·æ±‚å‘ç”Ÿå¼‚å¸¸ï¼Œè¯¥æ–¹æ³•ä¼šé€šè¿‡ catch æ•è·å¼‚å¸¸</span></span><br><span class="line">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">            <span class="comment">// As of 4.3, we're processing Errors thrown from handler methods as well,</span></span><br><span class="line">            <span class="comment">// making them available for @ExceptionHandler methods and other scenarios.</span></span><br><span class="line">            dispatchException = <span class="keyword">new</span> NestedServletException(<span class="string">"Handler dispatch failed"</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨è¯¥æ–¹æ³•åˆ†ææ•è·çš„å¼‚å¸¸</span></span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ processDispatchResult æ–¹æ³•ï¼Œè¿™é‡Œåªè¦å±•ç¤ºè°ƒç”¨æ ˆä½ å°±ä¼šçœ¼å‰ä¸€äº®äº†ï¼Œåˆæ˜¯ä¸ºäº†è¿”å›ç»Ÿä¸€æ ¼å¼æ•°æ®:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-09/2019-08-09-15-01-27.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« çš„è¿”å›ç»Ÿä¸€æ•°æ®æ ¼å¼æ˜¯åŸºç¡€ï¼Œå½“å¼‚å¸¸æƒ…å†µå‘ç”Ÿæ—¶ï¼Œåªä¸è¿‡éœ€è¦å°†å¼‚å¸¸ä¿¡æ¯æå–å‡ºæ¥ã€‚æœ¬æ–‡ä¸»è¦ä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œå‰–æåŸç†ï¼Œå¥½å¤šåœ°æ–¹è®¾è®¡æ–¹å¼æ˜¯ä¸å¯å–ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¥½å°†å¼‚å¸¸å°è£…åœ¨ä¸€ä¸ª Enum ç±»ï¼Œé€šè¿‡ enum å¯¹è±¡æŠ›å‡ºå¼‚å¸¸ç­‰ï¼Œå¦‚æœä½ ç”¨åˆ°è¿™äº›ï¼Œå»å®Œå–„ä½ çš„è®¾è®¡æ–¹æ¡ˆå§</p><p>å›å¤ ã€Œdemoã€ï¼Œæ‰“å¼€é“¾æ¥ï¼ŒæŸ¥çœ‹æ–‡ä»¶å¤¹ ã€Œunifiedreturnã€ä¸‹å†…å®¹ï¼Œè·å–å®Œæ•´ä»£ç </p><h2 id="é™„åŠ è¯´æ˜"><a href="#é™„åŠ è¯´æ˜" class="headerlink" title="é™„åŠ è¯´æ˜"></a>é™„åŠ è¯´æ˜</h2><p>ä¹‹å‰çœ‹åˆ°çš„ä¸€æœ¬ä¹¦å¯¹å¼‚å¸¸çš„åˆ†ç±»è®©æˆ‘å°è±¡æ·±åˆ»ï¼Œåœ¨æ­¤æ‘˜å½•ä¸€å°æ®µåˆ†äº«ç»™å¤§å®¶:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-09/Untitled%20Diagram.png" alt=""></p><p>ç»“åˆå‡ºå›½æ—…è¡Œçš„ä¾‹å­è¯´æ˜å¼‚å¸¸åˆ†ç±»:</p><blockquote><ul><li>æœºåœºåœ°éœ‡ï¼Œå±äºä¸å¯æŠ—åŠ›ï¼Œå¯¹åº”å¼‚å¸¸åˆ†ç±»ä¸­çš„ <code>Error</code>ï¼Œåœ¨åˆ¶è®¢å‡ºè¡Œè®¡åˆ’æ—¶ï¼Œæ ¹æœ¬ä¸éœ€è¦æŠŠè¿™ä¸ªéƒ¨åˆ†çš„å¼‚å¸¸è€ƒè™‘è¿›å»</li><li>å µè½¦å±äº <code>checked</code> å¼‚å¸¸ï¼Œåº”å¯¹è¿™ç§å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥æå‰å‡ºå‘ï¼Œæˆ–è€…æ”¹ç­¾æœºç¥¨ã€‚è€Œé£æœºå»¶è¯¯å¼‚å¸¸,è™½ç„¶ä¹Ÿéœ€è¦ checkï¼Œä½†æˆ‘ä»¬æ— èƒ½ä¸ºåŠ›ï¼Œåªèƒ½æŒç»­å…³æ³¨èˆªç­åŠ¨æ€</li><li>æ²¡æœ‰å¸¦æŠ¤ç…§ï¼Œæ˜æ˜¾å±äºå¯<code>æå‰é¢„æµ‹çš„å¼‚å¸¸</code>ï¼Œåªè¦å‡ºå‘å‰æ£€æŸ¥å³å¯é¿å…ï¼›å»æœºåœºè·¯ä¸Šè½¦å­æŠ›é”šï¼Œè¿™ä¸ªå¼‚å¸¸æ˜¯çªå‘çš„ï¼Œè™½ç„¶éš¾ä»¥é¢„æ–™ï¼Œä½†æ˜¯å¿…é¡»å¤„ç†ï¼Œå±äº<code>éœ€è¦æ•æ‰çš„å¼‚å¸¸</code>ï¼Œå¯ä»¥é€šè¿‡æ›´æ¢äº¤é€šå·¥å…·ï¼›åº”å¯¹æ£€ç¥¨æœºå™¨æ•…éšœå±äº <code>å¯é€å‡ºå¼‚å¸¸</code>ï¼Œäº¤ç”±èˆªç©ºå…¬å¸å¤„ç†,æˆ‘ä»¬æ— é¡»å…³å¿ƒ</li></ul></blockquote><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>è¿™ä¸¤ç¯‡æ–‡ç« ï¼Œä½ å­¦åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</li><li>ä½ èƒ½ç†Ÿç»ƒçš„ä½¿ç”¨åå°„å—ï¼Ÿå½“çœ‹æºç æ˜¯ä¼šçœ‹åˆ°å¾ˆå¤šåå°„çš„åº”ç”¨</li><li>ä½ äº†è§£ Spring CGLIB å—ï¼Ÿå®ƒçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><h3 id="JSON-Viewer"><a href="#JSON-Viewer" class="headerlink" title="JSON-Viewer"></a>JSON-Viewer</h3><p>JSON-Viewer  æ˜¯ Chrome æµè§ˆå™¨çš„æ’ä»¶ï¼Œç”¨äºå¿«é€Ÿè§£æåŠæ ¼å¼åŒ– json å†…å®¹ï¼Œåœ¨ Chrome omniboxï¼ˆå¤šåŠŸèƒ½è¾“å…¥æ¡†ï¼‰è¾“å…¥<code>json-viewer + TAB</code> ï¼Œå°† json å†…å®¹æ‹·è´è¿›å»ï¼Œç„¶åè¾“å…¥å›è½¦é”®ï¼Œå°†çœ‹åˆ°ç»“æ„æ¸…æ™°çš„ json æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜</p><p><img src="http://ww1.sinaimg.cn/large/8dc363e6ly1g39u1u0er6j21v80tyadz.jpg" alt=""></p><h2 id="å¦å¤–ï¼Œå‰ç«¯äººå‘˜æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒåŒå‡»è¯·æ±‚é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å°†-response-ä¸­çš„-json-æ•°æ®è§£æå‡ºæ¥ï¼Œéå¸¸æ–¹ä¾¿"><a href="#å¦å¤–ï¼Œå‰ç«¯äººå‘˜æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒåŒå‡»è¯·æ±‚é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å°†-response-ä¸­çš„-json-æ•°æ®è§£æå‡ºæ¥ï¼Œéå¸¸æ–¹ä¾¿" class="headerlink" title="å¦å¤–ï¼Œå‰ç«¯äººå‘˜æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒåŒå‡»è¯·æ±‚é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å°† response ä¸­çš„ json æ•°æ®è§£æå‡ºæ¥ï¼Œéå¸¸æ–¹ä¾¿"></a>å¦å¤–ï¼Œå‰ç«¯äººå‘˜æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒåŒå‡»è¯·æ±‚é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å°† response ä¸­çš„ json æ•°æ®è§£æå‡ºæ¥ï¼Œéå¸¸æ–¹ä¾¿</h2><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/6dg3u2PkcTSQHu_3T_QYnA" target="_blank" rel="noopener">åªä¼šç”¨ git pull ï¼Ÿæœ‰æ—¶å€™ä½ å¯ä»¥å°è¯•æ›´ä¼˜é›…çš„å¤„ç†æ–¹å¼ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Exception </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springbootè¿”å›ç»Ÿä¸€JSONæ•°æ®æ ¼å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</title>
      <link href="//p/spring-boot-global-return.html"/>
      <url>//p/spring-boot-global-return.html</url>
      
        <content type="html"><![CDATA[<p>å…³äº Spring çš„å…¨å±€å¤„ç†ï¼Œæˆ‘æœ‰ä¸¤æ–¹é¢è¦è¯´:</p><ol><li>ç»Ÿä¸€æ•°æ®è¿”å›æ ¼å¼</li><li>ç»Ÿä¸€å¼‚å¸¸å¤„ç†<br>ä¸ºäº†å°†ä¸¤ä¸ªé—®é¢˜è¯´æ˜æ¸…æ¥šï¼Œå°†åˆ†ä¸¤ä¸ªç« èŠ‚åˆ†åˆ«è¯´æ˜ï¼Œæœ¬ç« ä¸»è¦è¯´ç¬¬ä¸€ç‚¹</li></ol><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-07-25/landscape-615429_1920.jpg" alt=""></p><p>æœ‰ç«¥é‹è¯´ï¼Œæˆ‘ä»¬é¡¹ç›®éƒ½åšäº†è¿™ç§å¤„ç†ï¼Œå°±æ˜¯åœ¨æ¯ä¸ª API éƒ½å•ç‹¬å·¥å…·ç±»å°†è¿”å›å€¼è¿›è¡Œå°è£…ï¼Œä½†è¿™ç§ä¸å¤Ÿä¼˜é›…ï¼›æˆ‘æƒ³å†™æœ€å°‘çš„ä»£ç å®Œæˆè¿™ä»¶äº‹ï¼Œä¹Ÿè®¸æœ‰ç«¥é‹è¯´ï¼ŒåŠ å‡ ä¸ªæ³¨è§£å°±è§£å†³é—®é¢˜äº†ï¼Œè¯´çš„æ²¡é”™ï¼Œ<strong>ä½†è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜ä¸ºä»€ä¹ˆåŠ äº†å‡ ä¸ªæ³¨è§£å°±è§£å†³é—®é¢˜äº†ï¼Œç›®çš„æ˜¯å¸Œæœ›å¤§å®¶çŸ¥å…¶æ‰€ä»¥ç„¶</strong>ã€‚</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-08/comic-4388763_1920.png" alt=""></p><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜é—®é¢˜ï¼Œæœ¬æ–‡å…ˆè¯´æ˜å¦‚ä½•å®ç°ï¼Œç„¶åå†è¯¦ç»†å‰–æå®ç°åŸç†(è¿™å¾ˆå…³é”®)</p><h2 id="ä¸ºä»€ä¹ˆè¦åšç»Ÿä¸€æ•°æ®è¿”å›æ ¼å¼"><a href="#ä¸ºä»€ä¹ˆè¦åšç»Ÿä¸€æ•°æ®è¿”å›æ ¼å¼" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åšç»Ÿä¸€æ•°æ®è¿”å›æ ¼å¼"></a>ä¸ºä»€ä¹ˆè¦åšç»Ÿä¸€æ•°æ®è¿”å›æ ¼å¼</h2><p>å‰åç«¯åˆ†ç¦»æ˜¯å½“ä»ŠæœåŠ¡å½¢å¼çš„ä¸»æµï¼Œ<a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„ RESTful API</a> ï¼Œä»¥åŠå¦‚ä½•è®©å‰ç«¯å°ä¼™ä¼´å¯ä»¥å¤„ç†æ ‡å‡†çš„ response JSON æ•°æ®ç»“æ„éƒ½è‡³å…³é‡è¦ï¼Œä¸ºäº†è®©å‰ç«¯æœ‰æ›´å¥½çš„é€»è¾‘å±•ç¤ºä¸é¡µé¢äº¤äº’å¤„ç†ï¼Œæ¯ä¸€æ¬¡ RESTful è¯·æ±‚éƒ½åº”è¯¥åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯:</p><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>status</td><td>çŠ¶æ€ç ï¼Œæ ‡è¯†è¯·æ±‚æˆåŠŸä¸å¦ï¼Œå¦‚ [1:æˆåŠŸï¼›-1:å¤±è´¥]</td></tr><tr><td>errorCode</td><td>é”™è¯¯ç ï¼Œç»™å‡ºæ˜ç¡®é”™è¯¯ç ï¼Œæ›´å¥½çš„åº”å¯¹ä¸šåŠ¡å¼‚å¸¸ï¼›è¯·æ±‚æˆåŠŸè¯¥å€¼å¯ä¸ºç©º</td></tr><tr><td>errorMsg</td><td>é”™è¯¯æ¶ˆæ¯ï¼Œä¸é”™è¯¯ç ç›¸å¯¹åº”ï¼Œæ›´å…·ä½“çš„æè¿°å¼‚å¸¸ä¿¡æ¯</td></tr><tr><td>resultBody</td><td>è¿”å›ç»“æœï¼Œé€šå¸¸æ˜¯ Bean å¯¹è±¡å¯¹åº”çš„ JSON æ•°æ®, é€šå¸¸ä¸ºäº†åº”å¯¹ä¸åŒè¿”å›å€¼ç±»å‹ï¼Œå°†å…¶å£°æ˜ä¸ºæ³›å‹ç±»å‹</td></tr></tbody></table><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="é€šç”¨è¿”å›å€¼ç±»å®šä¹‰"><a href="#é€šç”¨è¿”å›å€¼ç±»å®šä¹‰" class="headerlink" title="é€šç”¨è¿”å›å€¼ç±»å®šä¹‰"></a>é€šç”¨è¿”å›å€¼ç±»å®šä¹‰</h3><p>æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œç”¨ Java Bean æ¥ä½“ç°è¿™ä¸ªç»“æ„å°±æ˜¯è¿™æ ·:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonResult</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> status = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String errorCode = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String errorMsg = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> T resultBody;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CommonResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CommonResult</span><span class="params">(T resultBody)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.resultBody = resultBody;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æ²¡é”™ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©å‡ ä¸ªå…³é”®æ³¨è§£æ¥å®Œæˆä¸€ä¸‹ç›¸å…³é…ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnifiedReturnConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span>(<span class="string">"com.example.unifiedreturn.api"</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonResultResponseAdvice</span> <span class="keyword">implements</span> <span class="title">ResponseBodyAdvice</span>&lt;<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(MethodParameter methodParameter, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">beforeBodyWrite</span><span class="params">(Object body, MethodParameter methodParameter, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (body <span class="keyword">instanceof</span> CommonResult)&#123;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;Object&gt;(body);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥çºµæƒ…çš„å†™ä»»ä½• RESTful API äº†ï¼Œæ‰€æœ‰çš„è¿”å›å€¼éƒ½ä¼šæœ‰ç»Ÿä¸€çš„ JSON ç»“æ„</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æ–°å»º UserControllerï¼Œæ·»åŠ ç›¸åº”çš„ RESTful APIï¼Œæµ‹è¯•ç”¨ä¾‹å†™çš„æ¯”è¾ƒç®€å•ï¼Œåªä¸ºäº†è¯´æ˜è¿”å›å€¼çš„å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">""</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserVo&gt; <span class="title">getUserList</span><span class="params">()</span></span>&#123;</span><br><span class="line">List&lt;UserVo&gt; userVoList = Lists.newArrayListWithCapacity(<span class="number">2</span>);</span><br><span class="line">userVoList.add(UserVo.builder().id(<span class="number">1L</span>).name(<span class="string">"æ—¥æ‹±ä¸€å…µ"</span>).age(<span class="number">18</span>).build());</span><br><span class="line">userVoList.add(UserVo.builder().id(<span class="number">2L</span>).name(<span class="string">"tan"</span>).age(<span class="number">19</span>).build());</span><br><span class="line"><span class="keyword">return</span> userVoList;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥åœ°å€æµ‹è¯•:  <em><a href="http://localhost:8080/users/" target="_blank" rel="noopener">http://localhost:8080/users/</a></em> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿”å›äº† List JSON æ•°æ®</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-08/2019-08-08-20-16-04.png" alt=""></p><p>ç»§ç»­æ·»åŠ  RESTful APIï¼Œæ ¹æ®ç”¨æˆ· ID æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> UserVo <span class="title">getUserByName</span><span class="params">(@PathVariable Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UserVo.builder().id(<span class="number">1L</span>).name(<span class="string">"æ—¥æ‹±ä¸€å…µ"</span>).age(<span class="number">18</span>).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥åœ°å€æµ‹è¯•:  <em><a href="http://localhost:8080/users/1" target="_blank" rel="noopener">http://localhost:8080/users/1</a></em> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿”å›äº†å•ä¸ª User JSON æ•°æ®</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-08/2019-08-08-20-16-32.png" alt=""></p><p>æ·»åŠ ä¸€ä¸ªè¿”å›å€¼ç±»å‹ä¸º ResponseEntity çš„ API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/testResponseEntity"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">getUserByAge</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity(UserVo.builder().id(<span class="number">1L</span>).name(<span class="string">"æ—¥æ‹±ä¸€å…µ"</span>).age(<span class="number">18</span>).build(), HttpStatus.OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥åœ°å€æµ‹è¯•:  <em><a href="http://localhost:8080/users/testResponseEntity" target="_blank" rel="noopener">http://localhost:8080/users/testResponseEntity</a></em> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒæ ·è¿”å›äº†å•ä¸ª User JSON æ•°æ®</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-08/2019-08-08-20-17-07.png" alt=""></p><h2 id="è§£å‰–å®ç°è¿‡ç¨‹"><a href="#è§£å‰–å®ç°è¿‡ç¨‹" class="headerlink" title="è§£å‰–å®ç°è¿‡ç¨‹"></a>è§£å‰–å®ç°è¿‡ç¨‹</h2><p>æˆ‘ä¼šå°†å…³é”®éƒ¨åˆ†ä¸€ä¸€è¯´æ˜æ¸…æ¥šï¼Œæ–­æ¡ˆè¿˜éœ€å°ä¼™ä¼´è‡ªå·±å»æ¡ˆå‘ç°åœº(æ‰“å¼€è‡ªå·±çš„ IDE æŸ¥çœ‹)</p><p>æ•…äº‹è¦ä» <code>@EnableWebMvc</code> è¿™ä¸ªæ³¨è§£è¯´èµ·ï¼Œæ‰“å¼€è¯¥æ³¨è§£çœ‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import</span>(DelegatingWebMvcConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>@Import</code> æ³¨è§£å¼•å…¥äº† <code>DelegatingWebMvcConfiguration.class</code>ï¼Œé‚£æ¥çœ‹è¿™ä¸ªç±»å§:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ <code>@Configuration</code> æ³¨è§£ï¼Œä½ åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œè¯¥ç±»çš„çˆ¶ç±» <code>WebMvcConfigurationSupport</code> ä¸­å´éšè—ç€ä¸€æ®µå…³é”®ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestMappingHandlerAdapter <span class="title">requestMappingHandlerAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RequestMappingHandlerAdapter adapter = createRequestMappingHandlerAdapter();</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RequestMappingHandlerAdapter æ˜¯æ¯ä¸€æ¬¡è¯·æ±‚å¤„ç†çš„å…³é”®ï¼Œæ¥çœ‹è¯¥ç±»çš„å®šä¹‰:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestMappingHandlerAdapter</span> <span class="keyword">extends</span> <span class="title">AbstractHandlerMethodAdapter</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">BeanFactoryAware</span>, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ç±»å®ç°äº† InitializingBean æ¥å£ï¼Œæˆ‘åœ¨ <a href="https://mp.weixin.qq.com/s/I7zgbOoCgAUnRFy4avipiQ" target="_blank" rel="noopener">Spring Bean ç”Ÿå‘½å‘¨æœŸä¹‹â€œæˆ‘ä»å“ªé‡Œæ¥â€ï¼Ÿ</a> è¿™ç¯‡æ–‡ç« ä¸­æ˜ç¡®è¯´æ˜äº† Spring Bean åˆå§‹åŒ–çš„å‡ ä¸ªå…³é”®ï¼Œå…¶ä¸­ InitializingBean æ¥å£çš„<br><code>afterPropertiesSet</code> æ–¹æ³•å°±æ˜¯å…³é”®ä¹‹ä¸€ï¼Œåœ¨ RequestMappingHandlerAdapter ç±»ä¸­åŒæ ·é‡å†™äº†è¯¥æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do this first, it may add ResponseBody advice beans</span></span><br><span class="line">    initControllerAdviceCache();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">        List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultArgumentResolvers();</span><br><span class="line">        <span class="keyword">this</span>.argumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.initBinderArgumentResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">        List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultInitBinderArgumentResolvers();</span><br><span class="line">        <span class="keyword">this</span>.initBinderArgumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers == <span class="keyword">null</span>) &#123;</span><br><span class="line">        List&lt;HandlerMethodReturnValueHandler&gt; handlers = getDefaultReturnValueHandlers();</span><br><span class="line">        <span class="keyword">this</span>.returnValueHandlers = <span class="keyword">new</span> HandlerMethodReturnValueHandlerComposite().addHandlers(handlers);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•å†…å®¹éƒ½éå¸¸å…³é”®ï¼Œä½†æˆ‘ä»¬å…ˆæ¥çœ‹ <code>initControllerAdviceCache</code> æ–¹æ³•ï¼Œå…¶ä»–å†…å®¹åç»­å†å•ç‹¬è¯´æ˜:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initControllerAdviceCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">        logger.info(<span class="string">"Looking for @ControllerAdvice: "</span> + getApplicationContext());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;ControllerAdviceBean&gt; beans = ControllerAdviceBean.findAnnotatedBeans(getApplicationContext());</span><br><span class="line">    AnnotationAwareOrderComparator.sort(beans);</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; requestResponseBodyAdviceBeans = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ControllerAdviceBean bean : beans) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (ResponseBodyAdvice.class.isAssignableFrom(bean.getBeanType())) &#123;</span><br><span class="line">            requestResponseBodyAdviceBeans.add(bean);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ ControllerAdviceBean é™æ€æ–¹æ³•æ‰«æ <code>ControllerAdvice</code> æ³¨è§£ï¼Œå¯æ˜¯æˆ‘ä»¬åœ¨å®ç°ä¸Šä½¿ç”¨çš„æ˜¯ <code>@RestControllerAdvice</code> æ³¨è§£ï¼Œæ‰“å¼€çœ‹è¯¥æ³¨è§£:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RestControllerAdvice &#123;</span><br></pre></td></tr></table></figure><blockquote><p>è¯¥æ³¨è§£ç”± <code>@ControllerAdvice</code> å’Œ <code>@ResponseBody</code> æ ‡è®°ï¼Œå°±å¥½æ¯”ä½ ç†Ÿæ‚‰çš„ <code>@RestController</code> æ³¨è§£ç”± <code>@Controller</code> å’Œ <code>@ResponseBody</code>  æ ‡è®°æ˜¯ä¸€æ ·çš„</p></blockquote><p>åˆ°è¿™é‡Œä½ å·²ç»çŸ¥é“æˆ‘ä»¬ç”¨ <code>@RestControllerAdvice</code> æ ‡è®°çš„ Bean æ˜¯å¦‚ä½•è¢«åŠ è½½åˆ° Spring ä¸Šä¸‹æ–‡çš„ï¼Œæ¥ä¸‹æ¥å°±è¦çŸ¥é“æ˜¯ Spring æ˜¯å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„ bean ä»¥åŠå¯¹è¿”å› body åšå¤„ç†çš„</p><p>å…¶å®åœ¨ <a href="https://mp.weixin.qq.com/s/wWj8M46EmxRRgBWdch2Big" target="_blank" rel="noopener">HttpMessageConverteræ˜¯å¦‚ä½•è½¬æ¢æ•°æ®çš„ï¼Ÿ</a> è¿™ç¯‡æ–‡ç« ä¸­å·²ç»è¯´æ˜äº†ä¸€éƒ¨åˆ†ï¼Œå¸Œæœ›å°ä¼™ä¼´å…ˆçœ‹è¿™ç¯‡æ–‡ç« ï¼Œä¸‹é¢çš„éƒ¨åˆ†å°±ä¼šç§’æ‡‚äº†ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåšè¿›ä¸€æ­¥çš„è¯´æ˜</p><p>åœ¨ AbstractMessageConverterMethodProcessor çš„ <code>writeWithMessageConverters</code> æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€æ®µæ ¸å¿ƒä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (messageConverter <span class="keyword">instanceof</span> GenericHttpMessageConverter) &#123;</span><br><span class="line">    <span class="keyword">if</span> (((GenericHttpMessageConverter) messageConverter).canWrite(</span><br><span class="line">            declaredType, valueType, selectedMediaType)) &#123;</span><br><span class="line">        outputValue = (T) getAdvice().beforeBodyWrite(outputValue, returnType, selectedMediaType,</span><br><span class="line">                (Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt;) messageConverter.getClass(),</span><br><span class="line">                inputMessage, outputMessage);</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é€šè¿‡ getAdvice() è°ƒç”¨äº† <code>beforeBodyWrite</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å·²ç»æ¥è¿‘çœŸç›¸äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> RequestResponseBodyAdviceChain <span class="title">getAdvice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.advice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RequestResponseBodyAdviceChainï¼Œçœ‹åå­—å¸¦æœ‰ Chainï¼Œå¾ˆæ˜æ˜¾ç”¨åˆ°äº†ã€Œè´£ä»»é“¾è®¾è®¡æ¨¡å¼ã€ï¼Œè¿™äº›å†…å®¹åœ¨ <a href="https://mp.weixin.qq.com/s/SqIkX01JwR6QXKTa6Kqp4Q" target="_blank" rel="noopener">ä¸å¾—ä¸çŸ¥çš„è´£ä»»é“¾è®¾è®¡æ¨¡å¼</a> æ–‡ç« ä¸­æ˜ç¡®è¯´æ˜è¿‡ï¼Œåªä¸è¿‡å®ƒä¼ é€’è´£ä»»é“¾ä»¥å¾ªç¯çš„æ–¹å¼å®Œæˆ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestResponseBodyAdviceChain</span> <span class="keyword">implements</span> <span class="title">RequestBodyAdvice</span>, <span class="title">ResponseBodyAdvice</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">beforeBodyWrite</span><span class="params">(Object body, MethodParameter returnType, MediaType contentType,</span></span></span><br><span class="line"><span class="function"><span class="params">Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType,</span></span></span><br><span class="line"><span class="function"><span class="params">ServerHttpRequest request, ServerHttpResponse response)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> processBody(body, returnType, contentType, converterType, request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Object <span class="title">processBody</span><span class="params">(Object body, MethodParameter returnType, MediaType contentType,</span></span></span><br><span class="line"><span class="function"><span class="params">Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType,</span></span></span><br><span class="line"><span class="function"><span class="params">ServerHttpRequest request, ServerHttpResponse response)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (ResponseBodyAdvice&lt;?&gt; advice : getMatchingAdvice(returnType, ResponseBodyAdvice.class)) &#123;</span><br><span class="line"><span class="keyword">if</span> (advice.supports(returnType, converterType)) &#123;</span><br><span class="line">body = ((ResponseBodyAdvice&lt;T&gt;) advice).beforeBodyWrite((T) body, returnType,</span><br><span class="line">contentType, converterType, request, response);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é‡å†™çš„ <code>beforeBodyWrite</code> æ–¹æ³•ç»ˆç©¶ä¼šè¢«è°ƒç”¨åˆ°ï¼ŒçœŸç›¸å°±æ˜¯è¿™æ ·äº†!!!</p><p>å…¶å®è¿˜æ²¡å®Œï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå¦‚æœæˆ‘ä»¬çš„ API æ–¹æ³•è¿”å›å€¼æ˜¯ <code>org.springframework.http.ResponseEntity&lt;T&gt;</code> ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š HTTP è¿”å›çŠ¶æ€ç ï¼Œä½†æ˜¯è¿™ä¸ªè¿”å›å€¼ä¼šç›´æ¥æ”¾åˆ°æˆ‘ä»¬çš„ beforeBodyWrite æ–¹æ³•çš„ body å‚æ•°ä¸­å—ï¼Ÿå¦‚æœè¿™æ ·åšå¾ˆæ˜æ˜¾æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º ResponseEntity åŒ…å«å¾ˆå¤šæˆ‘ä»¬éä¸šåŠ¡æ•°æ®åœ¨é‡Œé¢ï¼Œé‚£ Spring æ˜¯æ€ä¹ˆå¸®æˆ‘ä»¬å¤„ç†çš„å‘¢ï¼Ÿ</p><p>åœ¨æˆ‘ä»¬æ–¹æ³•å–å¾—è¿”å›å€¼å¹¶ä¸”åœ¨è°ƒç”¨ <code>beforeBodyWrite</code> æ–¹æ³•ä¹‹å‰ï¼Œè¿˜è¦é€‰æ‹© HandlerMethodReturnValueHandler ç”¨äºå¤„ç†ä¸åŒçš„ Handler æ¥å¤„ç†è¿”å›å€¼</p><p>åœ¨ç±» HandlerMethodReturnValueHandlerComposite ä¸­çš„ handleReturnValue æ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(Object returnValue, MethodParameter returnType,</span></span></span><br><span class="line"><span class="function"><span class="params">        ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    HandlerMethodReturnValueHandler handler = selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown return value type: "</span> + returnType.getParameterType().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨ selectHandler æ–¹æ³•æ¥é€‰æ‹©åˆé€‚çš„ handlerï¼ŒSpring å†…ç½®äº†å¾ˆå¤šä¸ª Handlerï¼Œæˆ‘ä»¬æ¥çœ‹ç±»å›¾:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-08/2019-08-08-16-36-31.png" alt=""></p><p>HttpEntityMethodProcessor å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒé‡å†™äº† supportsParameter æ–¹æ³•ï¼Œæ”¯æŒ HttpEntity ç±»å‹ï¼Œå³æ”¯æŒ ResponseEntity ç±»å‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (HttpEntity.class == parameter.getParameterType() ||</span><br><span class="line">            RequestEntity.class == parameter.getParameterType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å½“æˆ‘ä»¬è¿”å›çš„ç±»å‹ä¸º ResponseEntity æ—¶ï¼Œå°±è¦é€šè¿‡ HttpEntityMethodProcessor çš„ handleReturnValue æ–¹æ³•æ¥å¤„ç†æˆ‘ä»¬çš„ç»“æœ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(Object returnValue, MethodParameter returnType,</span></span></span><br><span class="line"><span class="function"><span class="params">        ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (responseEntity <span class="keyword">instanceof</span> ResponseEntity) &#123;</span><br><span class="line">        <span class="keyword">int</span> returnStatus = ((ResponseEntity&lt;?&gt;) responseEntity).getStatusCodeValue();</span><br><span class="line">        outputMessage.getServletResponse().setStatus(returnStatus);</span><br><span class="line">        <span class="keyword">if</span> (returnStatus == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (SAFE_METHODS.contains(inputMessage.getMethod())</span><br><span class="line">                    &amp;&amp; isResourceNotModified(inputMessage, outputMessage)) &#123;</span><br><span class="line">                <span class="comment">// Ensure headers are flushed, no body should be written.</span></span><br><span class="line">                outputMessage.flush();</span><br><span class="line">                <span class="comment">// Skip call to converters, as they may update the body.</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Try even with null body. ResponseBodyAdvice could get involved.</span></span><br><span class="line">    writeWithMessageConverters(responseEntity.getBody(), returnType, inputMessage, outputMessage);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure headers are flushed even if no body was written.</span></span><br><span class="line">    outputMessage.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•æå–å‡º responseEntity.getBody()ï¼Œå¹¶ä¼ é€’ä¸ª MessageConverterï¼Œç„¶åå†ç»§ç»­è°ƒç”¨ <code>beforeBodyWrite</code> æ–¹æ³•ï¼Œè¿™æ‰æ˜¯çœŸç›¸!!!</p><p><strong>è¿™æ˜¯ RESTful API æ­£å¸¸è¿”å›å†…å®¹çš„æƒ…å†µï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œè®©æˆ‘ä»¬æ¥ä¾¦æŸ¥ä¸€ä¸‹ç»Ÿä¸€å¼‚å¸¸æƒ…å†µçš„å¤„ç†ä»¥åŠå®ç°åŸç†</strong></p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>è¿”å›å€¼æ˜¯é ResponseEntity ç±»å‹æ—¶ï¼Œç”¨çš„æ˜¯ä»€ä¹ˆ handlerï¼Ÿå®ƒæ”¯æŒçš„è¿”å›å€¼ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿçœ‹è¿‡ä½ ä¹Ÿè®¸å°±çŸ¥é“ä¸ºä»€ä¹ˆè¦ç”¨ <code>@ResponseBody</code> æ³¨è§£äº†</li><li>ä½ æœ‰è¿½è¸ªè¿‡ DispatchServlet çš„æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å—ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/6dg3u2PkcTSQHu_3T_QYnA" target="_blank" rel="noopener">åªä¼šç”¨ git pull ï¼Ÿæœ‰æ—¶å€™ä½ å¯ä»¥å°è¯•æ›´ä¼˜é›…çš„å¤„ç†æ–¹å¼ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» | å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– | å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiroâ€”å°è€Œç¾çš„å®‰å…¨æ¡†æ¶</title>
      <link href="//p/shiro-in-practice.html"/>
      <url>//p/shiro-in-practice.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>åœ¨ä¸€æ¬¾åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬éƒ½ä¼šè°ˆåŠè¯¥åº”ç”¨çš„æ•°æ®å®‰å…¨é—®é¢˜ã€‚ç”¨æˆ·çš„åˆæ³•æ€§ä¸æ•°æ®çš„å¯è§æ€§æ˜¯æ•°æ®å®‰å…¨ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œä¸€æ–¹é¢ï¼Œä¸åŒçš„åº”ç”¨å¯¹äºæ•°æ®çš„åˆæ³•æ€§å’Œå¯è§æ€§è¦æ±‚çš„ç»´åº¦ä¸ç²’åº¦éƒ½æœ‰æ‰€åŒºåˆ«ï¼›å¦ä¸€æ–¹é¢ï¼Œä»¥å½“å‰å¾®æœåŠ¡ã€å¤šæœåŠ¡çš„æ¶æ„æ–¹å¼ï¼Œå¦‚ä½•å…±äº«Sessionï¼Œå¦‚ä½•ç¼“å­˜è®¤è¯å’Œæˆæƒæ•°æ®åº”å¯¹é«˜å¹¶å‘è®¿é—®éƒ½è¿«åˆ‡éœ€è¦æˆ‘ä»¬è§£å†³ã€‚Shiroçš„å‡ºç°è®©æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå’Œç®€å•çš„åº”å¯¹æˆ‘ä»¬åº”ç”¨çš„æ•°æ®å®‰å…¨é—®é¢˜</p><h2 id="Shiroä»‹ç»"><a href="#Shiroä»‹ç»" class="headerlink" title="Shiroä»‹ç»"></a>Shiroä»‹ç»</h2><h3 id="Shiroç®€ä»‹"><a href="#Shiroç®€ä»‹" class="headerlink" title="Shiroç®€ä»‹"></a>Shiroç®€ä»‹</h3><p>è¿™ä¸ªå®˜ç½‘è§£é‡Šä¸æŠ½è±¡ï¼Œæ‰€ä»¥ç›´æ¥ç”¨å®˜ç½‘è§£é‡Šï¼šApache Shiroâ„¢æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„ Java å®‰å…¨æ¡†æ¶ï¼Œå¯ä»¥æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ç­‰ã€‚åŸºäº Shiro çš„æ˜“äºç†è§£çš„APIï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€è½»æ¾åœ°ä½¿ä»»ä½•åº”ç”¨ç¨‹åºå˜å¾—å®‰å…¨ï¼ˆä»æœ€å°çš„ç§»åŠ¨åº”ç”¨åˆ°æœ€å¤§çš„ç½‘ç»œå’Œä¼ä¸šåº”ç”¨ï¼‰ã€‚</p><p>è°ˆåŠå®‰å…¨ï¼Œå¤šæ•° Java å¼€å‘äººå‘˜éƒ½ç¦»ä¸å¼€ Spring æ¡†æ¶çš„æ”¯æŒï¼Œè‡ªç„¶ä¹Ÿå°±ä¼šå…ˆæƒ³åˆ° Spring Securityï¼Œé‚£æˆ‘ä»¬å…ˆæ¥çœ‹äºŒè€…çš„å·®åˆ«</p><table><thead><tr><th>Shiro</th><th>Spring Security</th></tr></thead><tbody><tr><td>ç®€å•ã€çµæ´»</td><td>å¤æ‚ã€ç¬¨é‡</td></tr><tr><td>å¯è„±ç¦»Spring</td><td>ä¸å¯è„±ç¦»Spring</td></tr><tr><td>ç²’åº¦è¾ƒç²—</td><td>ç²’åº¦è¾ƒç»†</td></tr></tbody></table><p>è™½ç„¶ Spring Security å±äºåéœ‡ä¸­å¤– Spring å®¶æ—çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯äº†è§£ Shiro ä¹‹åï¼Œä½ ä¸ä¼šæƒ³ â€œå«å…¥è±ªé—¨â€ï¼Œè€Œæ˜¯é€‰æ‹©è¿½æ±‚ã€Œè¯—å’Œè¿œæ–¹ã€å†²åŠ¨ã€‚</p><p>æ¨ªçœ‹æˆå²­ä¾§æˆå³°ï¼Œè¿œè¿‘é«˜ä½å„ä¸åŒ (ä¾æ—§æ˜¯å…ˆäº†è§£æ¦‚å¿µå°±å¥½)</p><h3 id="è¿œçœ‹-Shiro-çœ‹è½®å»“"><a href="#è¿œçœ‹-Shiro-çœ‹è½®å»“" class="headerlink" title="è¿œçœ‹ Shiro çœ‹è½®å»“"></a>è¿œçœ‹ Shiro çœ‹è½®å»“</h3><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/image001.png" alt=""></p><h4 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h4><p>å®ƒæ˜¯ä¸€ä¸ªä¸»ä½“ï¼Œä»£è¡¨äº†å½“å‰â€œç”¨æˆ·â€ï¼Œè¿™ä¸ªç”¨æˆ·ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå…·ä½“çš„äººï¼Œä¸å½“å‰åº”ç”¨äº¤äº’çš„ä»»ä½•ä¸œè¥¿éƒ½æ˜¯Subjectï¼Œå¦‚ç½‘ç»œçˆ¬è™«ï¼Œæœºå™¨äººç­‰ï¼›å³ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼›æ‰€æœ‰ Subject éƒ½ç»‘å®šåˆ° SecurityManagerï¼Œä¸ Subject çš„æ‰€æœ‰äº¤äº’éƒ½ä¼šå§”æ‰˜ç»™SecurityManagerï¼›å¯ä»¥æŠŠ Subject è®¤ä¸ºæ˜¯ä¸€ä¸ªé—¨é¢ï¼›SecurityManager æ‰æ˜¯å®é™…çš„æ‰§è¡Œè€…</p><h4 id="SecurityManager"><a href="#SecurityManager" class="headerlink" title="SecurityManager"></a>SecurityManager</h4><p>å®‰å…¨ç®¡ç†å™¨ï¼›å³æ‰€æœ‰ä¸å®‰å…¨æœ‰å…³çš„æ“ä½œéƒ½ä¼šä¸ SecurityManager äº¤äº’ï¼›ä¸”å®ƒç®¡ç†ç€æ‰€æœ‰ Subjectï¼›å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ Shiro çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ä¸åè¾¹ä»‹ç»çš„å…¶ä»–ç»„ä»¶è¿›è¡Œäº¤äº’ï¼Œå¦‚æœå­¦ä¹ è¿‡ SpringMVCï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆ DispatcherServletå‰ç«¯æ§åˆ¶å™¨</p><h4 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h4><p>åŸŸï¼ŒShiro ä» Realm è·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰ï¼Œå°±æ˜¯è¯´ SecurityManager è¦éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä» Realm è·å–ç›¸åº”çš„ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒä»¥ç¡®å®šç”¨æˆ·èº«ä»½æ˜¯å¦åˆæ³•ï¼›ä¹Ÿéœ€è¦ä» Realm å¾—åˆ°ç”¨æˆ·ç›¸åº”çš„è§’è‰²/æƒé™è¿›è¡ŒéªŒè¯ç”¨æˆ·æ˜¯å¦èƒ½è¿›è¡Œæ“ä½œï¼›å¯ä»¥æŠŠ Realm çœ‹æˆ DataSourceï¼Œå³å®‰å…¨æ•°æ®æºã€‚</p><h3 id="è¿‘çœ‹-Shiro-çœ‹ç»†èŠ‚"><a href="#è¿‘çœ‹-Shiro-çœ‹ç»†èŠ‚" class="headerlink" title="è¿‘çœ‹ Shiro çœ‹ç»†èŠ‚"></a>è¿‘çœ‹ Shiro çœ‹ç»†èŠ‚</h3><p>çœ‹å›¾ç¬é—´æ‡µé€¼ï¼Ÿåˆ«æ…Œï¼Œä¼šä¸ºä½ æ‹†è§£æ¥çœ‹ï¼Œç»“åˆç€å›¾çœ‹ä¸‹é¢çš„è§£é‡Šï¼Œè¿™ä¸æ˜¯å•¥å¤§é—®é¢˜ï¼Œä¸”çœ‹:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/image002.png" alt=""></p><h4 id="Subject-1"><a href="#Subject-1" class="headerlink" title="Subject"></a>Subject</h4><p>ä¸»ä½“ï¼Œå¯ä»¥çœ‹åˆ°ä¸»ä½“å¯ä»¥æ˜¯ä»»ä½•å¯ä»¥ä¸åº”ç”¨äº¤äº’çš„ â€œç”¨æˆ·â€</p><h4 id="SecurityManager-1"><a href="#SecurityManager-1" class="headerlink" title="SecurityManager"></a>SecurityManager</h4><p>ç›¸å½“äº SpringMVC ä¸­çš„ DispatcherServletï¼›æ˜¯ Shiro çš„å¿ƒè„ï¼›æ‰€æœ‰å…·ä½“çš„äº¤äº’éƒ½é€šè¿‡ SecurityManager è¿›è¡Œæ§åˆ¶ï¼›å®ƒç®¡ç†ç€æ‰€æœ‰ Subjectã€ä¸”è´Ÿè´£è¿›è¡Œè®¤è¯å’Œæˆæƒã€åŠä¼šè¯ã€ç¼“å­˜çš„ç®¡ç†</p><h4 id="Authenticator"><a href="#Authenticator" class="headerlink" title="Authenticator"></a>Authenticator</h4><p>è®¤è¯å™¨ï¼Œè´Ÿè´£ä¸»ä½“è®¤è¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚æœç”¨æˆ·è§‰å¾— Shiro é»˜è®¤çš„ä¸å¥½ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°ï¼›éœ€è¦è‡ªå®šä¹‰è®¤è¯ç­–ç•¥ï¼ˆAuthentication Strategyï¼‰ï¼Œå³ä»€ä¹ˆæƒ…å†µä¸‹ç®—ç”¨æˆ·è®¤è¯é€šè¿‡äº†</p><h4 id="Authrizer"><a href="#Authrizer" class="headerlink" title="Authrizer"></a>Authrizer</h4><p>æˆæƒå™¨ï¼Œæˆ–è€…è®¿é—®æ§åˆ¶å™¨ï¼Œç”¨æ¥å†³å®šä¸»ä½“æ˜¯å¦æœ‰æƒé™è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›å³æ§åˆ¶ç€ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ä¸­çš„å“ªäº›åŠŸèƒ½</p><h4 id="Realm-1"><a href="#Realm-1" class="headerlink" title="Realm"></a>Realm</h4><p>å¯ä»¥æœ‰ 1 ä¸ªæˆ–å¤šä¸ª Realmï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨å®ä½“æ•°æ®æºï¼Œå³ç”¨äºè·å–å®‰å…¨å®ä½“çš„ï¼›å¯ä»¥æ˜¯JDBCå®ç°ï¼Œä¹Ÿå¯ä»¥æ˜¯LDAPå®ç°ï¼Œæˆ–è€…å†…å­˜å®ç°ç­‰ç­‰ï¼›ç”±ç”¨æˆ·æä¾›ï¼›æ³¨æ„ï¼šShiro ä¸çŸ¥é“ä½ çš„ç”¨æˆ·/æƒé™å­˜å‚¨åœ¨å“ªåŠä»¥ä½•ç§æ ¼å¼å­˜å‚¨ï¼›æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨åº”ç”¨ä¸­éƒ½éœ€è¦å®ç°è‡ªå·±çš„Realm</p><h4 id="SessionManager"><a href="#SessionManager" class="headerlink" title="SessionManager"></a>SessionManager</h4><p>å¦‚æœå†™è¿‡ Servlet å°±åº”è¯¥çŸ¥é“ Session çš„æ¦‚å¿µï¼ŒSession éœ€è¦æœ‰äººå»ç®¡ç†å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªç»„ä»¶å°±æ˜¯ SessionManagerï¼›è€ŒShiro å¹¶ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ Web ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å¦‚æ™®é€šçš„ JavaSE ç¯å¢ƒã€EJBç­‰ç¯å¢ƒï¼›æ‰€ä»¥ï¼ŒShiro å°±æŠ½è±¡äº†ä¸€ä¸ªè‡ªå·±çš„Session æ¥ç®¡ç†ä¸»ä½“ä¸åº”ç”¨ä¹‹é—´äº¤äº’çš„æ•°æ®ï¼›è¿™æ ·çš„è¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ Web ç¯å¢ƒç”¨ï¼Œåˆšå¼€å§‹æ˜¯ä¸€å°WebæœåŠ¡å™¨ï¼›æ¥ç€åˆä¸Šäº†å°EJB æœåŠ¡å™¨ï¼›è¿™æ—¶åˆæƒ³æŠŠä¸¤å°æœåŠ¡å™¨çš„ä¼šè¯æ•°æ®æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°è‡ªå·±çš„åˆ†å¸ƒå¼ä¼šè¯ï¼ˆå¦‚æŠŠæ•°æ®æ”¾åˆ°Memcached æœåŠ¡å™¨ï¼‰</p><h4 id="SessionDAO"><a href="#SessionDAO" class="headerlink" title="SessionDAO"></a>SessionDAO</h4><p>DAOå¤§å®¶éƒ½ç”¨è¿‡ï¼Œæ•°æ®è®¿é—®å¯¹è±¡ï¼Œç”¨äºä¼šè¯çš„ CRUDï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æŠŠ Session ä¿å­˜åˆ°æ•°æ®åº“ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°è‡ªå·±çš„SessionDAOï¼Œé€šè¿‡å¦‚JDBCå†™åˆ°æ•°æ®åº“ï¼›æ¯”å¦‚æƒ³æŠŠ Session æ”¾åˆ° Memcached ä¸­ï¼Œå¯ä»¥å®ç°è‡ªå·±çš„ Memcached SessionDAOï¼›å¦å¤– SessionDAO ä¸­å¯ä»¥ä½¿ç”¨ Cache è¿›è¡Œç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ï¼›</p><h4 id="CacheManager"><a href="#CacheManager" class="headerlink" title="CacheManager"></a>CacheManager</h4><p>ç¼“å­˜æ§åˆ¶å™¨ï¼Œæ¥ç®¡ç†å¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰çš„ç¼“å­˜çš„ï¼›å› ä¸ºè¿™äº›æ•°æ®åŸºæœ¬ä¸Šå¾ˆå°‘å»æ”¹å˜ï¼Œæ”¾åˆ°ç¼“å­˜ä¸­åå¯ä»¥æé«˜è®¿é—®çš„æ€§èƒ½</p><h4 id="Cryptography"><a href="#Cryptography" class="headerlink" title="Cryptography"></a>Cryptography</h4><p>å¯†ç æ¨¡å—ï¼ŒShiroæé«˜äº†ä¸€äº›å¸¸è§çš„åŠ å¯†ç»„ä»¶ç”¨äºå¦‚å¯†ç ã€ŒåŠ å¯†/è§£å¯†ã€çš„</p><p><strong>æ³¨æ„ä¸Šå›¾çš„ç»“æ„ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®è¿™å¼ å›¾æ¥é€æ­¥æ‹†åˆ†è®²è§£ï¼Œè®°ä½è¿™å¼ å›¾ä¹Ÿæ›´æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ Shiro çš„å·¥ä½œåŸç†</strong>ï¼Œæ‰€ä»¥ä¾æ—§æ˜¯æ‰“å¼€ä¸¤ä¸ªç½‘é¡µä¸€èµ·çœ‹å°±å¥½å–½</p><h2 id="æ­å»ºæ¦‚è§ˆ"><a href="#æ­å»ºæ¦‚è§ˆ" class="headerlink" title="æ­å»ºæ¦‚è§ˆ"></a>æ­å»ºæ¦‚è§ˆ</h2><p>å¤šæ•°å°ä¼™ä¼´éƒ½åœ¨ä½¿ç”¨ Spring Bootï¼Œ Shiro ä¹Ÿå¾ˆåº”æ™¯çš„å®šä¹‰äº† starterï¼Œåšäº†æ›´å¥½çš„å°è£…ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ä½¿ç”¨èµ·æ¥ä¹Ÿå°±æ›´åŠ æ–¹ä¾¿ï¼Œæ¥çœ‹é€‰å‹æ¦‚è§ˆ</p><table><thead><tr><th>åºå·</th><th>åç§°</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>1</td><td>Springboot</td><td>2.0.4</td></tr><tr><td>2</td><td>JPA</td><td>2.0.4</td></tr><tr><td>3</td><td>Mysql</td><td>8.0.12</td></tr><tr><td>4</td><td>Redis</td><td>2.0.4</td></tr><tr><td>5</td><td>Lombok</td><td>1.16.22</td></tr><tr><td>6</td><td>Guava</td><td>26.0-jre</td></tr><tr><td>7</td><td>Shiro</td><td>1.4.0</td></tr></tbody></table><p>ä½¿ç”¨ Spring Bootï¼Œå¤§å¤šéƒ½æ˜¯é€šè¿‡æ·»åŠ  starter ä¾èµ–ï¼Œä¼šè‡ªåŠ¨è§£å†³ä¾èµ–åŒ…ç‰ˆæœ¬ï¼Œæ‰€ä»¥è‡ªå·±å°è¯•çš„æ—¶å€™ç”¨æœ€æ–°ç‰ˆæœ¬ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¯”å¦‚ Shiro ç°åœ¨çš„ç‰ˆæœ¬æ˜¯ 1.5.0 äº†ï¼Œæ•´ä½“é—®é¢˜ä¸å¤§ï¼Œå¤§å®¶è‡ªè¡Œå°è¯•å°±å¥½</p><h3 id="æ·»åŠ -Gradle-ä¾èµ–ç®¡ç†"><a href="#æ·»åŠ -Gradle-ä¾èµ–ç®¡ç†" class="headerlink" title="æ·»åŠ  Gradle ä¾èµ–ç®¡ç†"></a>æ·»åŠ  Gradle ä¾èµ–ç®¡ç†</h3><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-11-06-41%402x.png" alt=""></p><h3 id="å¤§ä½“ç›®å½•ç»“æ„"><a href="#å¤§ä½“ç›®å½•ç»“æ„" class="headerlink" title="å¤§ä½“ç›®å½•ç»“æ„"></a>å¤§ä½“ç›®å½•ç»“æ„</h3><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-09-29-54.png" alt=""></p><h3 id="application-yml-é…ç½®"><a href="#application-yml-é…ç½®" class="headerlink" title="application.yml é…ç½®"></a>application.yml é…ç½®</h3><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-11-07-29%402x.png" alt=""></p><h3 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h3><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-11-08-17%402x.png" alt=""></p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/6af89bc8gw1f8su5fhsizg208c08ct9n.gif" alt=""></p><p>ä½ å°±è®©æˆ‘çœ‹è¿™ï¼Ÿè¿™åªæ˜¯ä¸€ä¸ªæ¦‚è§ˆï¼Œå…ˆåšåˆ°å¿ƒä¸­æœ‰æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹å…·ä½“é…ç½®ï¼Œé€æ­¥å®Œæˆæ­å»º</p><p>å…¶ä¸­ shiroFilter bean éƒ¨åˆ†æŒ‡å®šäº†æ‹¦æˆªè·¯å¾„å’Œç›¸åº”çš„è¿‡æ»¤å™¨ï¼Œâ€/user/loginâ€, â€/userâ€, â€/user/loginoutâ€ å¯ä»¥åŒ¿åè®¿é—®ï¼Œå…¶ä»–è·¯å¾„éƒ½éœ€è¦æˆæƒè®¿é—®ï¼Œshiro æä¾›å’Œå¤šä¸ªé»˜è®¤çš„è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›è¿‡æ»¤å™¨æ¥é…ç½®æ§åˆ¶æŒ‡å®šurlçš„æƒé™(å…ˆäº†è§£ä¸ªå¤§æ¦‚å³å¯)ï¼š</p><table><thead><tr><th>é…ç½®ç¼©å†™</th><th>å¯¹åº”çš„è¿‡æ»¤å™¨</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>anon</td><td>AnonymousFilter</td><td>æŒ‡å®šurlå¯ä»¥åŒ¿åè®¿é—®</td></tr><tr><td>authc</td><td>FormAuthenticationFilter</td><td>æŒ‡å®šurléœ€è¦formè¡¨å•ç™»å½•ï¼Œé»˜è®¤ä¼šä»è¯·æ±‚ä¸­è·å–usernameã€password,rememberMeç­‰å‚æ•°å¹¶å°è¯•ç™»å½•ï¼Œå¦‚æœç™»å½•ä¸äº†å°±ä¼šè·³è½¬åˆ°loginUrlé…ç½®çš„è·¯å¾„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªè¿‡æ»¤å™¨åšé»˜è®¤çš„ç™»å½•é€»è¾‘ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±åœ¨æ§åˆ¶å™¨å†™ç™»å½•é€»è¾‘çš„ï¼Œè‡ªå·±å†™çš„è¯å‡ºé”™è¿”å›çš„ä¿¡æ¯éƒ½å¯ä»¥å®šåˆ¶å˜›ã€‚</td></tr><tr><td>authcBasic</td><td>BasicHttpAuthenticationFilter</td><td>æŒ‡å®šurléœ€è¦basicç™»å½•</td></tr><tr><td>Logout</td><td>LogoutFilter</td><td>ç™»å‡ºè¿‡æ»¤å™¨ï¼Œé…ç½®æŒ‡å®šurlå°±å¯ä»¥å®ç°é€€å‡ºåŠŸèƒ½ï¼Œéå¸¸æ–¹ä¾¿</td></tr><tr><td>noSessionCreation</td><td>NoSessionCreationFilter</td><td>ç¦æ­¢åˆ›å»ºä¼šè¯</td></tr><tr><td>perms</td><td>PermissionsAuthorizationFilter</td><td>éœ€è¦æŒ‡å®šæƒé™æ‰èƒ½è®¿é—®</td></tr><tr><td>port</td><td>PortFilter</td><td>éœ€è¦æŒ‡å®šç«¯å£æ‰èƒ½è®¿é—®</td></tr><tr><td>rest</td><td>HttpMethodPermissionFilter</td><td>å°†httpè¯·æ±‚æ–¹æ³•è½¬åŒ–æˆç›¸åº”çš„åŠ¨è¯æ¥æ„é€ ä¸€ä¸ªæƒé™å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ„Ÿè§‰æ„ä¹‰ä¸å¤§ï¼Œæœ‰å…´è¶£è‡ªå·±çœ‹æºç çš„æ³¨é‡Š</td></tr><tr><td>roles</td><td>RolesAuthorizationFilter</td><td>éœ€è¦æŒ‡å®šè§’è‰²æ‰èƒ½è®¿é—®</td></tr><tr><td>ssl</td><td>SslFilter</td><td>éœ€è¦httpsè¯·æ±‚æ‰èƒ½è®¿é—®</td></tr><tr><td>user</td><td>UserFilter</td><td>éœ€è¦å·²ç™»å½•æˆ–â€œè®°ä½æˆ‘â€çš„ç”¨æˆ·æ‰èƒ½è®¿é—®</td></tr></tbody></table><h3 id="æ•°æ®åº“è¡¨è®¾è®¡"><a href="#æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡"></a>æ•°æ®åº“è¡¨è®¾è®¡</h3><p>æ•°æ®åº“è¡¨è®¾è®¡è¯·å‚è€ƒ entity packageä¸‹çš„ beanï¼Œé€šè¿‡@Entity æ³¨è§£ä¸ JPA çš„è®¾ç½®è‡ªåŠ¨ç”Ÿæˆè¡¨ç»“æ„ (ä½ éœ€è¦ç®€å•çš„äº†è§£ä¸€ä¸‹ JPA çš„åŠŸèƒ½)ã€‚</p><p>æˆ‘ä»¬è¦è¯´é‡ç‚¹å•¦ï½ï½ï½</p><h2 id="èº«ä»½è®¤è¯"><a href="#èº«ä»½è®¤è¯" class="headerlink" title="èº«ä»½è®¤è¯"></a>èº«ä»½è®¤è¯</h2><p>èº«ä»½è®¤è¯æ˜¯ä¸€ä¸ªè¯æ˜ â€œæé›·æ˜¯æé›·ï¼ŒéŸ©æ¢…æ¢…æ˜¯éŸ©æ¢…æ¢…â€ çš„è¿‡ç¨‹ï¼Œå›çœ‹ä¸Šå›¾ï¼ŒRealm æ¨¡å—å°±æ˜¯ç”¨æ¥åšè¿™ä»¶äº‹çš„ï¼ŒShiro æä¾›äº† IniRealmï¼ŒJdbcReamlï¼ŒLDAPReamç­‰è®¤è¯æ–¹å¼ï¼Œä½†è‡ªå®šä¹‰çš„ Realm é€šå¸¸æ˜¯æœ€é€‚åˆæˆ‘ä»¬ä¸šåŠ¡éœ€è¦çš„ï¼Œè®¤è¯é€šå¸¸æ˜¯æ ¡éªŒç™»å½•ç”¨æˆ·æ˜¯å¦åˆæ³•ã€‚</p><h3 id="æ–°å»ºç”¨æˆ·-User"><a href="#æ–°å»ºç”¨æˆ·-User" class="headerlink" title="æ–°å»ºç”¨æˆ· User"></a>æ–°å»ºç”¨æˆ· User</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(unique =<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰-Repository"><a href="#å®šä¹‰-Repository" class="headerlink" title="å®šä¹‰ Repository"></a>å®šä¹‰ Repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™UserControllerï¼š"><a href="#ç¼–å†™UserControllerï¼š" class="headerlink" title="ç¼–å†™UserControllerï¼š"></a>ç¼–å†™UserControllerï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line">    token.setRememberMe(<span class="keyword">true</span>);</span><br><span class="line">    Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">    currentUser.login(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰-Realm"><a href="#è‡ªå®šä¹‰-Realm" class="headerlink" title="è‡ªå®šä¹‰ Realm"></a>è‡ªå®šä¹‰ Realm</h3><p>è‡ªå®šä¹‰ Realmï¼Œä¸»è¦æ˜¯ä¸ºäº†é‡å†™ doGetAuthenticationInfo(â€¦)æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;</span><br><span class="line">    String username = token.getUsername();</span><br><span class="line">    User user = userRepository.findUserByUsername(username);</span><br><span class="line">    SimpleAuthenticationInfo simpleAuthenticationInfo = <span class="keyword">new</span> SimpleAuthenticationInfo(user, user.getPassword(), getName());</span><br><span class="line">    simpleAuthenticationInfo.setCredentialsSalt(ByteSource.Util.bytes(user.getSalt()));</span><br><span class="line">    <span class="keyword">return</span> simpleAuthenticationInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›ä»£ç æˆ‘éœ€è¦åšä¸€ä¸ªè¯´æ˜ï¼Œä½ å¯èƒ½ä¹Ÿæ»¡è‚šå­ç–‘æƒ‘:</p><ol><li>è¿™æ®µä»£ç æ€ä¹ˆåº”ç”¨äº† shiroï¼Ÿ</li><li>controller æ˜¯æ€ä¹ˆè°ƒç”¨åˆ° custom realm çš„ï¼Ÿ</li><li>é‡å†™çš„  doGetAuthenticationInfo(â€¦) æ–¹æ³•ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><h3 id="è®¤è¯æµç¨‹è¯´æ˜"><a href="#è®¤è¯æµç¨‹è¯´æ˜" class="headerlink" title="è®¤è¯æµç¨‹è¯´æ˜"></a>è®¤è¯æµç¨‹è¯´æ˜</h3><p>ç”¨æˆ·è®¿é—®<code>/user/login</code> è·¯å¾„ï¼Œç”Ÿæˆ UsernamePasswordToken,  é€šè¿‡SecurityUtils.getSubject()è·å–Subjectï¼ˆcurrentUserï¼‰ï¼Œè°ƒç”¨ login æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œè®©æˆ‘ä»¬è·Ÿè¸ªä¸€ä¸‹ä»£ç ï¼Œç§ä¸€ç§å°±çŸ¥é“è‡ªå®šä¹‰çš„CustomRealmæ€æ ·èµ·ä½œç”¨çš„ï¼Œä¸€èµ·æ¥çœ‹æºç ï¼š</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/image013.png" alt=""></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬è¦åœä¸€åœäº†ï¼Œè¯·å›çœ‹ Shiro è¿‘æ™¯å›¾ï¼Œå°†æºç è¿½è¸ªè·¯å¾„ä¸å…¶å¯¹æ¯”ï¼Œæ˜¯å®Œå…¨ä¸€è‡´çš„</p><h2 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h2><p>èº«ä»½è®¤è¯æ˜¯éªŒè¯ä½ æ˜¯è°çš„é—®é¢˜ï¼Œè€Œæˆæƒæ˜¯ä½ èƒ½å¹²ä»€ä¹ˆçš„é—®é¢˜ï¼Œ</p><blockquote><p>äº§å“ç»ç†ï¼šç”³è´­æ¨¡å—åªèƒ½ç§‘å®¤çœ‹<br>ç¨‹åºå‘˜ï¼šå¥½çš„<br>äº§å“ç»ç†ï¼šç§‘é•¿æƒé™å¤§ä¸€äº›ï¼Œä»–ä¹Ÿèƒ½çœ‹ç”³è´­æ¨¡å—<br>ç¨‹åºå‘˜ï¼šå¥½çš„(é»‘è„¸)<br>äº§å“ç»ç†ï¼šç§‘é•¿ä¸ä½†èƒ½çœ‹ï¼Œè¿˜èƒ½ä¿®æ”¹æ•°æ®<br>ç¨‹åºå‘˜ï¼šå…³å…¬æå¤§åˆ€ï¼Œæ‹¿å‘½æ¥<br>â€¦</p></blockquote><p>ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬çš„å®—æ—¨æ˜¯ï¼šã€Œèƒ½åŠ¨æ‰‹å°±ä¸åµåµã€; ç¡çƒŸæ€’ç«æ‹”åœ°èµ·ï¼Œè€³è¾¹å“èµ·é©¼é“ƒå£°ï¼ˆShiroï¼‰ï¼šã€Œæ”¾ä¸‹å± åˆ€ï¼Œç«‹åœ°æˆä½›ã€æˆæƒæ²¡æœ‰é‚£ä¹ˆéº»çƒ¦ï¼Œå¤§å®¶å¥½å•†é‡â€¦</p><p>æ•´ä¸ªè¿‡ç¨‹å’Œèº«ä»½è®¤è¯åŸºæœ¬æ˜¯ä¸€æ¯›ä¸€æ ·ï¼Œä½ å¯¹æ¯”çœ‹çœ‹</p><h3 id="è§’è‰²å®ä½“åˆ›å»º"><a href="#è§’è‰²å®ä½“åˆ›å»º" class="headerlink" title="è§’è‰²å®ä½“åˆ›å»º"></a>è§’è‰²å®ä½“åˆ›å»º</h3><p>æ¶‰åŠåˆ°æˆæƒï¼Œè‡ªç„¶è¦å’Œè§’è‰²ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»º Role å®ä½“:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(unique =<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String roleCode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å»º-Role-Repository"><a href="#æ–°å»º-Role-Repository" class="headerlink" title="æ–°å»º Role Repository"></a>æ–°å»º Role Repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Role</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(value = <span class="string">"select roleId from UserRoleRel ur where ur.userId = ?1"</span>)</span><br><span class="line">    <span class="function">List&lt;Long&gt; <span class="title">findUserRole</span><span class="params">(Long userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Role&gt; <span class="title">findByIdIn</span><span class="params">(List&lt;Long&gt; ids)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æƒé™å®ä½“-Permission"><a href="#å®šä¹‰æƒé™å®ä½“-Permission" class="headerlink" title="å®šä¹‰æƒé™å®ä½“ Permission"></a>å®šä¹‰æƒé™å®ä½“ Permission</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Permission</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(unique =<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String permCode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String permName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰-Permission-Repository"><a href="#å®šä¹‰-Permission-Repository" class="headerlink" title="å®šä¹‰ Permission Repository"></a>å®šä¹‰ Permission Repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Permission</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(value = <span class="string">"select permId from RolePermRel pr where pr.roleId in ?1"</span>)</span><br><span class="line">    <span class="function">List&lt;Long&gt; <span class="title">findRolePerm</span><span class="params">(List&lt;Long&gt; roleIds)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Permission&gt; <span class="title">findByIdIn</span><span class="params">(List&lt;Long&gt; ids)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹ç”¨æˆ·ä¸è§’è‰²å…³ç³»"><a href="#å»ºç«‹ç”¨æˆ·ä¸è§’è‰²å…³ç³»" class="headerlink" title="å»ºç«‹ç”¨æˆ·ä¸è§’è‰²å…³ç³»"></a>å»ºç«‹ç”¨æˆ·ä¸è§’è‰²å…³ç³»</h3><p>å…¶å®å¯ä»¥é€šè¿‡ JPA æ³¨è§£æ¥åˆ¶å®šå…³ç³»çš„ï¼Œè¿™é‡Œä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œä»¥å•ç‹¬å¤–é”®å½¢å¼è¯´æ˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRoleRel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹è§’è‰²ä¸æƒé™å…³ç³»"><a href="#å»ºç«‹è§’è‰²ä¸æƒé™å…³ç³»" class="headerlink" title="å»ºç«‹è§’è‰²ä¸æƒé™å…³ç³»"></a>å»ºç«‹è§’è‰²ä¸æƒé™å…³ç³»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RolePermRel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long permId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™-UserController"><a href="#ç¼–å†™-UserController" class="headerlink" title="ç¼–å†™ UserController"></a>ç¼–å†™ UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermissions</span>(<span class="string">"user:list:view"</span>)</span><br><span class="line"><span class="meta">@GetMapping</span>()</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAllUsers</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userRepository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@RequiresPermissions(&quot;user:list:view&quot;)</code> æ³¨è§£è¯´æ˜å…·æœ‰ç”¨æˆ·ï¼šåˆ—è¡¨ï¼šæŸ¥çœ‹æƒé™çš„æ‰å¯ä»¥è®¿é—®ï¼‰ï¼Œå®˜ç½‘æ˜ç¡®ç»™å‡ºæƒé™å®šä¹‰æ ¼å¼ï¼ŒåŒ…æ‹¬é€šé…ç¬¦ç­‰ï¼Œæˆ‘å¸Œæœ›ä½ è‡ªè¡Œå»æŸ¥çœ‹</p><p>è‡ªå®šä¹‰ CustomRealm (ä¸»è¦é‡å†™ doGetAuthorizationInfo) æ–¹æ³•:</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-11-10-16%402x.png" alt=""></p><p>ä¸è®¤è¯æµç¨‹å¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡å¤šäº†ç”¨æˆ·ï¼Œè§’è‰²ï¼Œæƒé™çš„å…³ç³»ç½¢äº†</p><h3 id="æˆæƒæµç¨‹è¯´æ˜"><a href="#æˆæƒæµç¨‹è¯´æ˜" class="headerlink" title="æˆæƒæµç¨‹è¯´æ˜"></a>æˆæƒæµç¨‹è¯´æ˜</h3><p>è¿™é‡Œé€šè¿‡è¿‡æ»¤å™¨ï¼ˆè§Shiroé…ç½®ï¼‰å’Œæ³¨è§£äºŒè€…ç»“åˆçš„æ–¹å¼æ¥è¿›è¡Œæˆæƒï¼Œå’Œè®¤è¯æµç¨‹ä¸€æ ·ï¼Œæœ€ç»ˆä¼šèµ°åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ CustomRealm ä¸­ï¼ŒåŒæ · Shiro é»˜è®¤æä¾›äº†è®¸å¤šæ³¨è§£ç”¨æ¥å¤„ç†ä¸åŒçš„æˆæƒæƒ…å†µ</p><table><thead><tr><th>æ³¨è§£</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>@RequiresGuest</td><td>åªæœ‰æ¸¸å®¢å¯ä»¥è®¿é—®</td></tr><tr><td>@RequiresAuthentication</td><td>éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®</td></tr><tr><td>@RequiresUser</td><td>å·²ç™»å½•çš„ç”¨æˆ·æˆ–â€œè®°ä½æˆ‘â€çš„ç”¨æˆ·èƒ½è®¿é—®</td></tr><tr><td>@RequiresRoles</td><td>å·²ç™»å½•çš„ç”¨æˆ·éœ€å…·æœ‰æŒ‡å®šçš„è§’è‰²æ‰èƒ½è®¿é—®</td></tr><tr><td>@RequiresPermissions</td><td>å·²ç™»å½•çš„ç”¨æˆ·éœ€å…·æœ‰æŒ‡å®šçš„æƒé™æ‰èƒ½è®¿é—®ï¼ˆå¦‚æœä¸æƒ³å’Œäº§å“ç»ç†åå±±è®ºå‰‘ï¼Œæ¨èç”¨è¿™ä¸ªæ³¨è§£ï¼‰</td></tr></tbody></table><p>æˆæƒå®˜ç½‘ç»™å‡ºæ˜ç¡®çš„æˆæƒç­–ç•¥ä¸æ¡ˆä¾‹ï¼Œè¯·æŸ¥çœ‹ï¼š<a href="http://shiro.apache.org/permissions.html" target="_blank" rel="noopener">http://shiro.apache.org/permissions.html</a></p><p>ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬é€šè¿‡ä¸€ç›´åœ¨é€šè¿‡è®¿é—® Mysql è·å–ç”¨æˆ·è®¤è¯å’Œæˆæƒä¿¡æ¯ï¼Œè¿™ä¸­æ–¹å¼æ˜æ˜¾ä¸ç¬¦åˆç”Ÿäº§ç¯å¢ƒçš„éœ€æ±‚</p><h2 id="Sessionä¼šè¯ç®¡ç†"><a href="#Sessionä¼šè¯ç®¡ç†" class="headerlink" title="Sessionä¼šè¯ç®¡ç†"></a>Sessionä¼šè¯ç®¡ç†</h2><p>åšè¿‡ Web å¼€å‘çš„åŒå­¦éƒ½çŸ¥é“ Session çš„æ¦‚å¿µï¼Œæœ€å¸¸ç”¨çš„æ˜¯ Session è¿‡æœŸæ—¶é—´ï¼Œæ•°æ®åœ¨ Session çš„ CRUDï¼ŒåŒæ ·çœ‹ä¸Šå›¾ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ SessionManager å’Œ SessionDAO æ¨¡å—ï¼ŒShiro starter å·²ç»æä¾›äº†åŸºæœ¬çš„ Sessioné…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬æŒ‰éœ€åœ¨YAMLä¸­é…ç½®å°±å¥½ï¼ˆå®˜ç½‘<a href="https://shiro.apache.org/spring-boot.html" target="_blank" rel="noopener">https://shiro.apache.org/spring-boot.html</a> å·²ç»æ˜ç¡®ç»™å‡ºSessionçš„é…ç½®ä¿¡æ¯ï¼‰</p><table><thead><tr><th>Key</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>shiro.enabled</td><td>true</td><td>Enables Shiroâ€™s Spring module</td></tr><tr><td>shiro.web.enabled</td><td>true</td><td>Enables Shiroâ€™s Spring web module</td></tr><tr><td>shiro.annotations.enabled</td><td>true</td><td>Enables Spring support for Shiroâ€™s annotations</td></tr><tr><td>shiro.sessionManager.deleteInvalidSessions</td><td>true</td><td>Remove invalid session from session storage</td></tr><tr><td>shiro.sessionManager.sessionIdCookieEnabled</td><td>true</td><td>Enable session ID to cookie, for session tracking</td></tr><tr><td>shiro.sessionManager.sessionIdUrlRewritingEnabled</td><td>true</td><td>Enable session URL rewriting support</td></tr><tr><td>shiro.userNativeSessionManager</td><td>false</td><td>If enabled Shiro will manage the HTTP sessions instead of the container</td></tr><tr><td>shiro.sessionManager.cookie.name</td><td>JSESSIONID</td><td>Session cookie name</td></tr><tr><td>shiro.sessionManager.cookie.maxAge</td><td>-1</td><td>Session cookie max age</td></tr><tr><td>shiro.sessionManager.cookie.domain</td><td>null</td><td>Session cookie domain</td></tr><tr><td>shiro.sessionManager.cookie.path</td><td>null</td><td>Session cookie path</td></tr><tr><td>shiro.sessionManager.cookie.secure</td><td>false</td><td>Session cookie secure flag</td></tr><tr><td>shiro.rememberMeManager.cookie.name</td><td>rememberMe</td><td>RememberMe cookie name</td></tr><tr><td>shiro.rememberMeManager.cookie.maxAge</td><td>one year</td><td>RememberMe cookie max age</td></tr><tr><td>shiro.rememberMeManager.cookie.domain</td><td>null</td><td>RememberMe cookie domain</td></tr><tr><td>shiro.rememberMeManager.cookie.path</td><td>null</td><td>RememberMe cookie path</td></tr><tr><td>shiro.rememberMeManager.cookie.secure</td><td>false</td><td>RememberMe cookie secure flag</td></tr><tr><td>shiro.loginUrl</td><td>/login.jsp</td><td>Login URL used when unauthenticated users are redirected to login page</td></tr><tr><td>shiro.successUrl</td><td>/</td><td>Default landing page after a user logs in (if alternative cannot be found in the current session)</td></tr><tr><td>shiro.unauthorizedUrl</td><td>null</td><td>Page to redirect user to if they are unauthorized (403 page)</td></tr></tbody></table><p>åˆ†å¸ƒå¼æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å°†Sessionä¿¡æ¯æ”¾å…¥Redisä¸­æ¥ç®¡ç†ï¼Œæ¥åº”å¯¹é«˜å¹¶å‘çš„è®¿é—®éœ€æ±‚ï¼Œè¿™æ—¶åªéœ€é‡å†™SessionDAOå³å¯å®Œæˆè‡ªå®šä¹‰çš„Sessionç®¡ç†</p><h3 id="æ•´åˆRedis"><a href="#æ•´åˆRedis" class="headerlink" title="æ•´åˆRedis"></a>æ•´åˆRedis</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory redisConnectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">stringObjectRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        template.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        template.setValueSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å†™SessionDao"><a href="#é‡å†™SessionDao" class="headerlink" title="é‡å†™SessionDao"></a>é‡å†™SessionDao</h3><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-11-10-59%402x.png" alt=""></p><p>æŸ¥çœ‹æºç ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨é»˜è®¤SessionManagerçš„retriveSessionæ–¹æ³•ï¼Œæˆ‘ä»¬é‡å†™è¯¥æ–¹æ³•ï¼Œå°†Sessionæ”¾å…¥HttpRequestä¸­ï¼Œè¿›ä¸€æ­¥æé«˜sessionè®¿é—®æ•ˆç‡</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-11-11-37%402x.png" alt=""></p><h3 id="å‘ShiroConfigä¸­æ·»åŠ é…ç½®"><a href="#å‘ShiroConfigä¸­æ·»åŠ é…ç½®" class="headerlink" title="å‘ShiroConfigä¸­æ·»åŠ é…ç½®"></a>å‘ShiroConfigä¸­æ·»åŠ é…ç½®</h3><p> å…¶å®åœ¨æ¦‚è§ˆæ¨¡å—å·²ç»ç»™å‡ºä»£ç å±•ç¤ºï¼Œè¿™é‡Œå•ç‹¬åˆ—å‡ºæ¥åšè¯´æ˜:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰RedisSessionDaoç”¨æ¥ç®¡ç†Sessionåœ¨Redisä¸­çš„CRUD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"redisSessionDao"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisSessionDao <span class="title">redisSessionDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RedisSessionDao();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰SessionManager,åº”ç”¨è‡ªå®šä¹‰SessionDao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"customerSessionManager"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CustomerWebSessionManager <span class="title">customerWebSessionManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">    CustomerWebSessionManager customerWebSessionManager = <span class="keyword">new</span> CustomerWebSessionManager();</span><br><span class="line">    customerWebSessionManager.setSessionDAO(redisSessionDao());</span><br><span class="line">    <span class="keyword">return</span> customerWebSessionManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰Security manager</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> customRealm</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"securityManager"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">defaultWebSecurityManager</span><span class="params">(CustomRealm customRealm)</span> </span>&#123;</span><br><span class="line">    DefaultWebSecurityManager  securityManager = <span class="keyword">new</span> DefaultWebSecurityManager ();</span><br><span class="line">    securityManager.setRealm(customRealm);</span><br><span class="line">    securityManager.setSessionManager(customerWebSessionManager()); <span class="comment">// å¯ä¸æŒ‡å®šï¼ŒShiroä¼šç”¨é»˜è®¤Session manager</span></span><br><span class="line">    securityManager.setCacheManager(redisCacheManagers());  <span class="comment">//å¯ä¸æŒ‡å®šï¼ŒShiroä¼šç”¨é»˜è®¤CacheManager</span></span><br><span class="line"><span class="comment">//        securityManager.setSessionManager(defaultWebSessionManager());</span></span><br><span class="line">    <span class="keyword">return</span> securityManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰sessionç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"sessionManager"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultWebSessionManager <span class="title">defaultWebSessionManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">    DefaultWebSessionManager defaultWebSessionManager = <span class="keyword">new</span> DefaultWebSessionManager();</span><br><span class="line">    defaultWebSessionManager.setSessionDAO(redisSessionDao());</span><br><span class="line">    <span class="keyword">return</span> defaultWebSessionManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå°† session ä¿¡æ¯ç”± redis ç®¡ç†åŠŸèƒ½å°±è¿™æ ·å®Œæˆäº†</p><h2 id="ç¼“å­˜ç®¡ç†"><a href="#ç¼“å­˜ç®¡ç†" class="headerlink" title="ç¼“å­˜ç®¡ç†"></a>ç¼“å­˜ç®¡ç†</h2><p>åº”å¯¹åˆ†å¸ƒå¼æœåŠ¡ï¼Œå¯¹äºé«˜å¹¶å‘è®¿é—®æ•°æ®åº“æƒé™å†…å®¹æ˜¯éå¸¸ä½æ•ˆçš„æ–¹å¼ï¼ŒåŒæ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Redisæ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå°†æˆæƒæ•°æ®ç¼“å­˜åˆ°Redisä¸­</p><h3 id="æ–°å»º-RedisCache"><a href="#æ–°å»º-RedisCache" class="headerlink" title="æ–°å»º RedisCache"></a>æ–°å»º RedisCache</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Cache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SHIRO_PREFIX = <span class="string">"shiro-cache:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; stringObjectRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getKey</span><span class="params">(K key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">            <span class="keyword">return</span> (SHIRO_PREFIX + key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> key.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K k)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        log.info(<span class="string">"read from redis..."</span>);</span><br><span class="line">        V v = (V) stringObjectRedisTemplate.opsForValue().get(getKey(k));</span><br><span class="line">        <span class="keyword">if</span> (v != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K k, V v)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        stringObjectRedisTemplate.opsForValue().set(getKey(k), v);</span><br><span class="line">        stringObjectRedisTemplate.expire(getKey(k), <span class="number">100</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K k)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        V v = (V) stringObjectRedisTemplate.opsForValue().get(getKey(k));</span><br><span class="line">        stringObjectRedisTemplate.delete((String) get(k));</span><br><span class="line">        <span class="keyword">if</span> (v != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        <span class="comment">//ä¸è¦é‡å†™ï¼Œå¦‚æœåªä¿å­˜shiroæ•°æ®æ— æ‰€è°“</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;K&gt; <span class="title">keys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;V&gt; <span class="title">values</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å»º-RedisCacheManager"><a href="#æ–°å»º-RedisCacheManager" class="headerlink" title="æ–°å»º RedisCacheManager"></a>æ–°å»º RedisCacheManager</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCacheManager</span> <span class="keyword">implements</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Cache&lt;K, V&gt; <span class="title">getCache</span><span class="params">(String s)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisCache;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä¸ç”¨æ¯æ¬¡è®¿é—® Mysql DB æ¥è·å–è®¤è¯å’Œæˆæƒä¿¡æ¯ï¼Œè€Œæ˜¯é€šè¿‡ Redis æ¥ç¼“å­˜è¿™äº›ä¿¡æ¯ï¼Œå¤§å¤§æå‡äº†æ•ˆç‡ï¼Œä¹Ÿæ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡éœ€æ±‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å›å¤å…¬ä¼—å· ã€Œdemoã€è·å– demo ä»£ç ã€‚è¿™é‡Œåªæ˜¯æ¢³ç†äº†Springbootæ•´åˆShiroçš„æµç¨‹ï¼Œä»¥åŠåº”ç”¨Redisæœ€å¤§åŒ–åˆ©ç”¨Shiroï¼ŒShiroçš„ä½¿ç”¨ç»†èŠ‚è¿˜å¾ˆå¤šï¼Œå®˜ç½‘è¯´çš„ä¹Ÿå¾ˆæ˜ç¡®ï¼Œå¸¦ç€ä¸Šé¢çš„æ¶æ„å›¾æ¥ç†è§£Shiroä¼šäº‹åŠåŠŸå€ï¼Œæ„Ÿè§‰è¿™é‡Œé¢çš„ä»£ç æŒºå¤šæŒºå¤´å¤§çš„ï¼Ÿé‚£æ˜¯ä½ æ²¡æœ‰è‡ªå·±åŠ¨æ‰‹å»å°è¯•ï¼Œç»“åˆå®˜ç½‘ä¸ demo ç›¸ä¿¡ä½ ä¼šå¯¹ Shiro æœ‰æ›´å¥½çš„ç†è§£ï¼Œå¦å¤–ä½ å¯ä»¥ç†è§£ Shiro æ˜¯ mini ç‰ˆæœ¬çš„ Spring Securityï¼Œæˆ‘å¸Œæœ›ä»¥å°è§å¤§ï¼Œå½“éœ€è¦æ›´ç»†ç²’åº¦çš„è®¤è¯æˆæƒæ—¶ï¼Œä¹Ÿä¼šå¯¹ç†è§£ Spring Security æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œç‚¹å‡»æ–‡æœ«ã€Œé˜…è¯»åŸæ–‡ã€ï¼Œæ•ˆæœæ›´å¥½</p><p>è½éœä¸å­¤é¹œé½é£ ç§‹æ°´å…±é•¿å¤©ä¸€è‰²ï¼Œäº§å“ç»ç†å’Œç¨‹åºå‘˜ä¸€ç‰‡ç¥¥å’Œâ€¦  </p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>éƒ½è¯´ Redis æ˜¯å•çº¿ç¨‹ï¼Œä½†æ˜¯å¾ˆå¿«ï¼Œä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿ</li><li>ä½ ä»¬é¡¹ç›®ä¸­æ˜¯æ€æ ·æ§åˆ¶è®¤è¯æˆæƒçš„å‘¢ï¼Ÿå½“æˆæƒæœ‰å˜åŒ–ï¼Œå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ä¸ªä¿®æ”¹æ˜¯ç¾éš¾å—ï¼Ÿ</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><h3 id="MarkDown-è¡¨æ ¼ç”Ÿæˆå™¨"><a href="#MarkDown-è¡¨æ ¼ç”Ÿæˆå™¨" class="headerlink" title="MarkDown è¡¨æ ¼ç”Ÿæˆå™¨"></a>MarkDown è¡¨æ ¼ç”Ÿæˆå™¨</h3><p>æœ¬æ–‡çš„å¥½å¤šè¡¨æ ¼æ˜¯ä»å®˜ç½‘ç²˜è´´çš„ï¼Œå¦‚ä½•å°†å…¶ç›´æ¥è½¬æ¢æˆ MD table å‘¢ï¼Ÿé‚£ä¹ˆ <a href="https://www.tablesgenerator.com/markdown_tables" target="_blank" rel="noopener">https://www.tablesgenerator.com/markdown_tables</a> å°±å¯ä»¥å¸®åˆ°ä½ äº†ï¼Œæ— è®ºæ˜¯ç”Ÿæˆ MD tableï¼Œè¿˜æ˜¯ç²˜è´´å†…å®¹ç”Ÿæˆ table å’Œå†…å®¹éƒ½æ˜¯æå¥½çš„ï¼Œå½“ç„¶äº†ä¸æ­¢ MD tableï¼Œè‡ªå·±å‘ç°å§ï¼Œæ›´å¤šå·¥å…·ï¼Œå…¬ä¼—å·å›å¤ ã€Œå·¥å…·ã€è·å¾—</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-08-05/2019-08-05-10-52-55.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/6dg3u2PkcTSQHu_3T_QYnA" target="_blank" rel="noopener">åªä¼šç”¨ git pull ï¼Ÿæœ‰æ—¶å€™ä½ å¯ä»¥å°è¯•æ›´ä¼˜é›…çš„å¤„ç†æ–¹å¼ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€»  å›å¤ã€Œå·¥å…·ã€</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å– å›å¤ã€Œèµ„æ–™ã€</li></ul></blockquote><p>åç»­ä¼šæ¨å‡ºã€Œå¤šçº¿ç¨‹ã€ä¸ã€ŒElasticSearchã€ç­‰è¿è½½å†…å®¹</p><blockquote><p>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shiro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>@Conditionalæ³¨è§£ï¼ŒSpring Boot çš„çµæ´»é…ç½®</title>
      <link href="//p/spring-boot-condition-annotation.html"/>
      <url>//p/spring-boot-condition-annotation.html</url>
      
        <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://mp.weixin.qq.com/s/fvgL73R_4ANp4wsSiEhUGA" target="_blank" rel="noopener">ä½ åº”è¯¥çŸ¥é“çš„ @ConfigurationProperties æ³¨è§£çš„ä½¿ç”¨å§¿åŠ¿ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a> ä»‹ç»äº†å¦‚ä½•é€šè¿‡ <code>@ConfigurationProperties</code> æ³¨è§£çµæ´»è¯»å–é…ç½®å±æ€§ï¼Œè¿™ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•çµæ´»é…ç½® Spring Bean</p><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å½“æˆ‘ä»¬æ„å»ºä¸€ä¸ª Spring åº”ç”¨çš„æ—¶å€™ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³åœ¨æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„æ—¶å€™æ‰å°†æŸä¸ª bean åŠ è½½åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œ åœ¨Spring 4.0 æ—¶ä»£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>@Conditional</code> æ³¨è§£æ¥å®ç°è¿™ç±»æ“ä½œ<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-14-13-28%402x.png" alt=""></p><p>æˆ‘ä»¬çœ‹åˆ°  <code>@Conditional</code>  æ³¨è§£æ¥æ”¶çš„å‚æ•°æ˜¯ extends Condition æ¥å£çš„æ³›å‹ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ <code>@Conditional</code> æ³¨è§£ï¼Œåªéœ€è¦å®ç° Condition æ¥å£å¹¶é‡å†™å…¶æ–¹æ³•å³å¯:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-14-14-40%402x.png" alt=""></p><p>çœ‹åˆ°æ¥å£çš„ matches æ–¹æ³•è¿”å›çš„æ˜¯ boolean ç±»å‹ï¼Œæ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬è‡ªå®šä¹‰ validation annotation æœ‰äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ»¡è¶³æŒ‡å®šæ¡ä»¶ã€‚å¦å¤–æ³¨æ„çœ‹ï¼Œä»¥ä¸Šæ³¨è§£å’Œæ¥å£éƒ½åœ¨  <code>org.springframework.context.annotation</code>  package ä¸­</p><p>ç»ˆäºåˆ°äº† Spring Boot æ—¶ä»£ï¼Œåœ¨è¿™ä¸ªå…¨æ–°çš„æ—¶ä»£ï¼ŒSpring Boot åœ¨  <code>@Conditional</code>  æ³¨è§£çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ç»†åŒ–ï¼Œæ— éœ€å‡ºç¤ºå¤æ‚çš„ä»‹ç»ä¿¡ (å®ç° Condition æ¥å£)ï¼Œåªéœ€è¦æ‰‹æŒé¢„å®šä¹‰å¥½çš„ <code>@ConditionalOnXxxx</code> æ³¨è§£å°ç« çš„é—¨ç¥¨ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±ä¼šèµ°è¿› Application Context å¤§å…</p><h2 id="æ³¨è§£è¯¦è§£"><a href="#æ³¨è§£è¯¦è§£" class="headerlink" title="æ³¨è§£è¯¦è§£"></a>æ³¨è§£è¯¦è§£</h2><p>Spring Boot å¯¹ <code>@Conditional</code> æ³¨è§£ä¸ºæˆ‘ä»¬åšäº†ç»†åŒ–ï¼Œè¿™äº›æ³¨è§£éƒ½å®šä¹‰åœ¨ <code>org.springframework.boot.autoconfigure.condition</code> package ä¸‹<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-11-07-51.png" alt=""></p><p>é€ä¸ªæ‰“å¼€è¿™ 13 ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å‘ç°è¿™äº›æ³¨è§£ä¸Šæœ‰ç›¸åŒçš„å…ƒæ³¨è§£:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-45-29%402x.png" alt=""></p><p>ä»è¿™äº›æ ‡è®°ä¸Šæˆ‘ä»¬å¯ä»¥äº†è§£å¦‚ä¸‹å†…å®¹:</p><ul><li><p>éƒ½å¯ä»¥åº”ç”¨åœ¨ TYPE ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring è‡ªåŠ¨æ‰«æçš„ä¸€åˆ‡ç±» (@Configuration, @Component, @Service, @Repository, or @Controller) éƒ½å¯ä»¥é€šè¿‡æ·»åŠ ç›¸åº”çš„ <code>@ConditionalOnXxxx</code> æ¥åˆ¤æ–­æ˜¯å¦åŠ è½½</p></li><li><p>éƒ½å¯ä»¥åº”ç”¨åœ¨ METHOD ä¸Šï¼Œæ‰€ä»¥æœ‰ @Bean æ ‡è®°çš„æ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨è¿™äº›æ³¨è§£</p></li><li><p>éƒ½æ˜¯ç”¨äº† <code>@Conditional</code> æ³¨è§£æ¥æ ‡è®°ï¼ŒOnBeanCondition ç­‰è‡ªå®šä¹‰ Condition è¿˜æ˜¯å®ç°äº† Condition æ¥å£çš„ï¼Œæ¢æ±¤ä¸æ¢è¯ï¼Œæ²¡ä»€ä¹ˆç¥ç§˜çš„ï¼Œåªä¸è¿‡åšäº†æ›´å…·è±¡çš„å°è£…ç½¢äº†ï¼Œæ¥çœ‹ç±»ä¾èµ–å›¾:</p></li></ul><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-13-40-16.png" alt=""></p><p>å…¶å®çœ‹è¿™äº›æ³¨è§£å­—é¢æ„æ€å·²ç»èƒ½ç†è§£è¿™äº›æ³¨è§£çš„å«ä¹‰ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦è¯´æ˜å…·ä½“çš„ä½¿ç”¨ä»¥åŠä¸€äº›æ³¨æ„äº‹é¡¹ï¼Œæˆ‘æŒ‰ç…§ä¸ªäººä½¿ç”¨é¢‘æ¬¡ç”±é«˜åˆ°ä½è®²è§£:</p><h3 id="ConditionalOnProperty"><a href="#ConditionalOnProperty" class="headerlink" title="@ConditionalOnProperty"></a>@ConditionalOnProperty</h3><p>æ¯«æ— ç–‘é—®è¿™ä¸ªæ³¨è§£æ˜¯æ¦œé¦–<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-49-03%402x.png" alt=""></p><p>è¿™ä¸ªæ¡ä»¶è§£é‡Šæ˜¯:  application.properties æˆ– application.yml æ–‡ä»¶ä¸­ mybean.enable ä¸º true æ‰ä¼šåŠ è½½ MyCondition è¿™ä¸ª Beanï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šä¹Ÿä¼šåŠ è½½ï¼Œå› ä¸º matchIfMissing = trueï¼Œé»˜è®¤å€¼æ˜¯ falseã€‚<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-49-57%402x.png" alt=""></p><h3 id="ConditionalOnBean-å’Œ-ConditionalOnMissingBean"><a href="#ConditionalOnBean-å’Œ-ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnBean å’Œ ConditionalOnMissingBean"></a>@ConditionalOnBean å’Œ ConditionalOnMissingBean</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŸä¸ª Bean å·²ç»å­˜åœ¨åº”ç”¨ä¸Šä¸‹æ–‡æ—¶æ‰ä¼šåŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šç”¨åˆ° <code>@ConditionalOnBean</code> æ³¨è§£:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-51-16%402x.png" alt=""></p><p>ä¸ä¹‹ç›¸åï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŸä¸ª Bean ä¸å­˜åœ¨äºåº”ç”¨ä¸Šä¸‹æ–‡æ—¶æ‰ä¼šåŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šç”¨åˆ° <code>@ConditionalOnMissingBean</code> æ³¨è§£</p><h3 id="ConditionalOnClass-å’Œ-ConditionalOnMissingClass"><a href="#ConditionalOnClass-å’Œ-ConditionalOnMissingClass" class="headerlink" title="@ConditionalOnClass å’Œ @ConditionalOnMissingClass"></a>@ConditionalOnClass å’Œ @ConditionalOnMissingClass</h3><p>ä¸è¦å«Œæˆ‘åºŸè¯ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·ï¼Œåªä¸è¿‡åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å­˜åœ¨äº classpath ä¸­ï¼Œè¿™å°±ä¸åšè¿‡å¤šè¯´æ˜äº†</p><h3 id="ConditionalOnExpression"><a href="#ConditionalOnExpression" class="headerlink" title="@ConditionalOnExpression"></a>@ConditionalOnExpression</h3><p>å¦‚æœæˆ‘ä»¬æœ‰æ›´å¤æ‚çš„å¤šä¸ªé…ç½®å±æ€§ä¸€èµ·åˆ¤æ–­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªè¡¨è¾¾å¼äº†:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-54-28%402x.png" alt=""></p><p>åªæœ‰å½“ä¸¤ä¸ªå±æ€§éƒ½ä¸º true çš„æ—¶å€™æ‰åŠ è½½ MyModuleï¼Œåˆ°è¿™é‡Œè¦é¡ºä¾¿æ­æ™“ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://mp.weixin.qq.com/s/fvgL73R_4ANp4wsSiEhUGA" target="_blank" rel="noopener">ä½ åº”è¯¥çŸ¥é“çš„ @ConfigurationProperties æ³¨è§£çš„ä½¿ç”¨å§¿åŠ¿ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a> çµé­‚è¿½é—® 3ï¼Œå…¶ä¸­ <code>:true</code> å°±æ˜¯: å¦‚æœæ²¡æœ‰ä¸ºè¯¥å±æ€§è®¾ç½®å€¼ï¼Œåˆ™ä¸ºè¯¥å±æ€§è®¾ç½®é»˜è®¤å€¼true, å…¶å®è¿™å°±æ˜¯<code>@Vaue</code> æ³¨è§£çš„è§„èŒƒï¼Œä¸€åˆ‡ SpEL éƒ½å¯ä»¥åº”ç”¨åœ¨è¿™é‡Œ.</p><p>å†™åˆ°è¿™ï¼Œæˆ‘å¸¸ç”¨çš„å·²ç»ç”¨å®Œäº†ï¼Œè¿˜è¦ç¡¬ç€å¤´çš®ä»‹ç»å…¶ä»–å‡ ä¸ªå†…å®¹ ğŸ˜„ï¼Œå¼€ä¸ªç©ç¬‘ï¼Œå’±ä»¬ç»§ç»­:</p><h3 id="ConditionalOnSingleCandidate"><a href="#ConditionalOnSingleCandidate" class="headerlink" title="@ConditionalOnSingleCandidate"></a>@ConditionalOnSingleCandidate</h3><p>è¿™ä¸ªæ³¨è§£å’Œ @ConditionalOnBean ç±»ä¼¼ï¼Œä¸ºäº†æ›´å¥½çš„è¯´æ˜è¯¥æ³¨è§£çš„ä½¿ç”¨ (å…¶å®æ˜¯ <code>æ‰ç–å­¦æµ…</code> ) ï¼Œæˆ‘åªèƒ½ç¿»è¯‘ä¸€ä¸‹ç±»çš„æ³¨é‡Šäº†<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-56-07%402x.png" alt=""></p><blockquote><p> åªæœ‰æŒ‡å®šç±»å·²å­˜åœ¨äº BeanFactory ä¸­ï¼Œå¹¶ä¸”å¯ä»¥ç¡®å®šå•ä¸ªå€™é€‰é¡¹æ‰ä¼šåŒ¹é…æˆåŠŸ</p><p>BeanFactory å­˜åœ¨å¤šä¸ª bean å®ä¾‹ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ª primary å€™é€‰é¡¹è¢«æŒ‡å®š(é€šå¸¸åœ¨ç±»ä¸Šä½¿ç”¨ <code>@Primary</code> æ³¨è§£)ï¼Œä¹Ÿä¼šåŒ¹é…æˆåŠŸã€‚å®è´¨ä¸Šï¼Œå¦‚æœè‡ªåŠ¨è¿æ¥å…·æœ‰å®šä¹‰ç±»å‹çš„ bean åŒ¹é…å°±ä¼šæˆåŠŸ</p><p>ç›®å‰ï¼Œæ¡ä»¶åªæ˜¯åŒ¹é…å·²ç»è¢«åº”ç”¨ä¸Šä¸‹æ–‡å¤„ç†çš„ bean å®šä¹‰ï¼Œæœ¬èº«æ¥è®²ï¼Œå¼ºçƒˆå»ºè®®ä»…ä»…åœ¨ auto-configuration ç±»ä¸­ä½¿ç”¨è¿™ä¸ªæ¡ä»¶ï¼Œå¦‚æœå€™é€‰ bean è¢«å¦å¤–ä¸€ä¸ª auto-configuration åˆ›å»ºï¼Œç¡®ä¿ä½¿ç”¨è¯¥æ¡ä»¶çš„è¦åœ¨å…¶åé¢è¿è¡Œ</p></blockquote><h3 id="ConditionalOnResource"><a href="#ConditionalOnResource" class="headerlink" title="@ConditionalOnResource"></a>@ConditionalOnResource</h3><p>å¦‚æœæˆ‘ä»¬è¦åŠ è½½çš„ bean ä¾èµ–æŒ‡å®šèµ„æºæ˜¯å¦å­˜åœ¨äº classpath ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-57-04%402x.png" alt=""></p><p>çœ‹åˆ°è¿™ä¸ª logback.xml æ˜¯ä¸æ˜¯å¾ˆäº²åˆ‡ï¼Œåœ¨æˆ‘ä»¬å¼•å…¥ç¬¬ä¸‰æ–¹å·¥å…·ç±»å¦‚ <a href="https://mp.weixin.qq.com/s/rE_cX0Z7nccY5D6z3O7mUQ" target="_blank" rel="noopener">Dozer</a> ç­‰éƒ½å¯ä»¥æ·»åŠ ç±»ä¼¼çš„å¼€å…³</p><p>æ¥ä¸‹æ¥çš„æ˜¯çœŸå†·é—¨ï¼Œå¤§å®¶æœ‰ä¸ªå°è±¡ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œè‡³å°‘èƒ½æƒ³åˆ°ç”¨è¿™äº›æ³¨è§£å®ç°çµæ´»é…ç½®å°±å¥½äº†</p><h3 id="ConditionalOnJndi"><a href="#ConditionalOnJndi" class="headerlink" title="@ConditionalOnJndi"></a>@ConditionalOnJndi</h3><p>åªæœ‰æŒ‡å®šçš„èµ„æºé€šè¿‡ JNDI åŠ è½½åæ‰åŠ è½½ bean<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-58-52%402x.png" alt=""></p><h3 id="ConditionalOnJava"><a href="#ConditionalOnJava" class="headerlink" title="@ConditionalOnJava"></a>@ConditionalOnJava</h3><p>åªæœ‰è¿è¡ŒæŒ‡å®šç‰ˆæœ¬çš„ Java æ‰ä¼šåŠ è½½ Bean<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-16-59-48%402x.png" alt=""></p><h3 id="ConditionalOnWebApplication-å’Œ-ConditionalOnNotWebApplication"><a href="#ConditionalOnWebApplication-å’Œ-ConditionalOnNotWebApplication" class="headerlink" title="@ConditionalOnWebApplication å’Œ @ConditionalOnNotWebApplication"></a>@ConditionalOnWebApplication å’Œ @ConditionalOnNotWebApplication</h3><p>åªæœ‰è¿è¡Œåœ¨ web åº”ç”¨é‡Œæ‰ä¼šåŠ è½½è¿™ä¸ª bean<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-17-00-34%402x.png" alt=""></p><p>ä¸ä¹‹ç›¸åï¼Œåœ¨é web ç¯å¢ƒæ‰åŠ è½½ bean<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-17-01-29%402x.png" alt=""></p><h3 id="ConditionalOnCloudPlatform"><a href="#ConditionalOnCloudPlatform" class="headerlink" title="@ConditionalOnCloudPlatform"></a>@ConditionalOnCloudPlatform</h3><p>è¿™ä¸ªæ³¨è§£å†·çš„æˆ‘å‘¼å¸éƒ½è¦åœæ­¢äº†ï¼Œåªæœ‰è¿è¡Œåœ¨æŒ‡å®šçš„äº‘å¹³å°ä¸Šæ‰åŠ è½½æŒ‡å®šçš„ beanï¼ŒCloudPlatform æ˜¯ <code>org.springframework.boot.cloud</code> ä¸‹ä¸€ä¸ª enum ç±»å‹çš„ç±»ï¼Œå¤§å®¶å¯ä»¥æ‰“å¼€è‡ªè¡Œçœ‹çœ‹:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-17-02-42%402x.png" alt=""></p><p>åˆ°æ­¤ï¼ŒSpring Boot ä¸ºæˆ‘ä»¬æä¾›çš„è¿™ 13 ä¸ªæ³¨è§£å°±ä»‹ç»å®Œäº†ï¼Œä½†æ˜¯æ²¡æœ‰ç»“æŸï¼Œä¸‹é¢çš„ä¸€äº›å†·é—¨çŸ¥è¯†ï¼Œä½ éœ€è¦çŸ¥é“:</p><h2 id="ç»„åˆæ¡ä»¶"><a href="#ç»„åˆæ¡ä»¶" class="headerlink" title="ç»„åˆæ¡ä»¶"></a>ç»„åˆæ¡ä»¶</h2><h3 id="ç»„åˆæ¡ä»¶-AND"><a href="#ç»„åˆæ¡ä»¶-AND" class="headerlink" title="ç»„åˆæ¡ä»¶ AND"></a>ç»„åˆæ¡ä»¶ AND</h3><p>å¦‚æœæˆ‘ä»¬æƒ³å¤šä¸ªæ¡ä»¶ä¸€èµ·åº”ç”¨ï¼Œå¹¶ä¸”æ¡ä»¶çš„å…³ç³»æ˜¯ <code>and</code>ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç±»ä¸Šä½¿ç”¨å¤šä¸ª<code>@ConditionalOnXxxx</code> å°±å¯ä»¥äº† (ä½ è¿™ä¹Ÿå«å†·é—¨ï¼Ÿ) ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç»§æ‰¿ <code>AllNestedConditions</code>ç±»å°è£…æˆ‘ä»¬å¤šä¸ªæ¡ä»¶<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-17-05-03%402x.png" alt=""></p><p>è¿™æ ·å°±æœ‰äº†ç»„åˆ and æ¡ä»¶ï¼Œåªæœ‰å†…éƒ¨æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰åŠ è½½æŒ‡å®š bean</p><h3 id="ç»„åˆæ¡ä»¶-OR"><a href="#ç»„åˆæ¡ä»¶-OR" class="headerlink" title="ç»„åˆæ¡ä»¶ OR"></a>ç»„åˆæ¡ä»¶ OR</h3><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ç»„åˆçš„æ¡ä»¶æ˜¯ <code>or</code> çš„å…³ç³»ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿ <code>AnyNestedCondition</code> æ¥å®Œæˆè¿™ä¸€è¦æ±‚ï¼Œç¤ºä¾‹ä»£ç å’Œä¸Šé¢ä¸€æ ·ï¼Œå¤§å®¶è‡ªè¡Œæ‰“å¼€ <code>AnyNestedCondition</code> ç±»ï¼ŒæŸ¥çœ‹ç±»è¯´æ˜å³å¯</p><h3 id="æ¡ä»¶ç»„åˆ-NONE"><a href="#æ¡ä»¶ç»„åˆ-NONE" class="headerlink" title="æ¡ä»¶ç»„åˆ NONE"></a>æ¡ä»¶ç»„åˆ NONE</h3><p>æœ‰ and å’Œ or å°±è‚¯å®šæœ‰ non(é)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿ <code>NoneNestedConditions</code> å®Œæˆè¿™ä¸€è¦æ±‚ï¼Œå¤§å®¶è‡ªè¡ŒæŸ¥çœ‹å³å¯</p><h2 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h2><p>é€šè¿‡ç»„åˆæ–¹å¼å®ç°äº†å¤šæ¡ä»¶é€»è¾‘åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨è¿™äº›ç»„åˆæ¡ä»¶ä¹Ÿå°±è¦è‡ªå®šä¹‰æ³¨è§£ï¼Œå…¶å®æ–‡ç« å¼€å¤´å·²ç»è®²è¿‡äº†ï¼Œæ¨¡ä»¿å†…ç½®çš„ 13 ä¸ªæ³¨è§£å†™å°±å¥½äº†:<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-17-05-50%402x.png" alt=""></p><p>åªéœ€è¦é€šè¿‡<code>@Conditional</code>æ³¨è§£æŒ‡å®šæˆ‘ä»¬è‡ªå®šä¹‰çš„ condition ç±»å°±å¥½äº†ï¼Œç„¶ååº”ç”¨åˆ°ä½ æƒ³ç”¨çš„åœ°æ–¹å°±å¥½äº†<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/Spring/_image/2019-07-30/2019-07-30-17-06-30%402x.png" alt=""></p><p>è¿˜æ˜¯æ¨èå¤§å®¶çœ‹ RabbitMq çš„ <code>RabbitAutoConfiguration</code> ç±»ï¼Œè¿™ä¸ªç±»é‡Œé¢ä¸»æµçš„æ³¨è§£éƒ½æ˜¯ç”¨äº† (åªçœ‹è¿™ä¸€ä¸ªç±»å°±å¥½äº†)ï¼Œå¤§å®¶çœ‹æ¡†æ¶ç†è§£å­¦ä¹ è¿™äº›æ³¨è§£æ˜¯æ›´å¥½çš„æ–¹å¼:</p><blockquote><p> <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitAutoConfiguration.java" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitAutoConfiguration.java</a></p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œï¼Œä½ å·²ç»äº†è§£äº†å¦‚ä½•çµæ´»é…ç½® beanï¼Œç»“åˆä¹‹å‰çš„æ–‡ç« ï¼Œç›¸ä¿¡çš„å®šä¹‰ä¼šæ›´åŠ çµæ´»ï¼Œå¸Œæœ›å¤§å®¶æ‰“å¼€ IDEï¼Œè‡ªè¡ŒæŸ¥çœ‹è¿™äº›æ³¨è§£ï¼Œäº†è§£æ›´å¤šå…·ä½“å†…å®¹</p><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>SpringBoot æ·»åŠ äº† web starterï¼Œæœ‰å“ªäº›æ–¹æ³•å°†å…¶æ›´æ”¹ä¸ºé web åº”ç”¨ï¼Ÿ</li><li>Java8 Stream ä¹Ÿæœ‰ findAnyï¼ŒfindAll è¿™ç±»çš„æ“ä½œï¼Œè¿™éƒ½æ˜¯åŒ¹é…ï¼Œä½ æœ‰ä½¿ç”¨è¿‡å—ï¼Ÿ</li><li>çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œå¦‚æœ classpath ä¸­æ²¡æœ‰ MyBean classï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼Œé‚£è¿™ä¸ªæ³¨è§£ä»€ä¹ˆç”¨å‘¢ï¼Ÿ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>    </span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(MyBean.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span></span>&#123;</span><br><span class="line">    <span class="comment">// omitted       </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/ilND8u_8HGSTSrJiMB4X8g" target="_blank" rel="noopener">çº¢é»‘æ ‘ï¼Œè¶…å¼ºåŠ¨é™å›¾è¯¦è§£ï¼Œç®€å•æ˜“æ‡‚</a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº«</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€»</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­”</li><li>æŠ€æœ¯èµ„æ–™é¢†å–</li></ul><p><strong>åç»­ä¼šæ¨å‡º ã€Œå¤šçº¿ç¨‹ã€ä»¥åŠã€ŒElasticSearchã€ç­‰è¿è½½å†…å®¹</strong><br>ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> æ³¨è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¢é»‘æ ‘ï¼Œå²ä¸Šæœ€å¼ºåŠ¨é™å›¾è¯¦è§£</title>
      <link href="//p/redblack-tree.html"/>
      <url>//p/redblack-tree.html</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>çº¢é»‘æ ‘ï¼Œå¯¹å¾ˆå¤šç«¥é‹æ¥è¯´ï¼Œæ˜¯æ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿã€‚å­¦æ ¡ä¸­å­¦è¿‡ï¼Œåªäº†è§£å¤§æ¦‚ï¼›å·¥ä½œä¸­ä¸æ€ä¹ˆä½¿ç”¨ï¼Œä½†é¢è¯•åˆæ˜¯é‡ç‚¹ã€‚æ¯æ¬¡éœ€è¦æŸ¥çœ‹çº¢é»‘æ ‘å†…å®¹æ—¶éƒ½å¾ˆéš¾ä»¥æ›´ç”ŸåŠ¨å½¢è±¡çš„æ–¹å¼æ¥ç†è§£å…¶å†…å®¹ã€‚æ²¡é”™ï¼Œæœ¬æ–‡å†…å®¹å°±æ˜¯è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨ç®€å•çš„è¯­è¨€ï¼Œæ­é…é™å›¾å’ŒåŠ¨å›¾(åˆ©ç”¨å¤§è„‘å›¾å½¢è®°å¿†æ–¹å¼)ï¼Œè®©ä½ å¯¹çº¢é»‘æ ‘æœ‰æ›´æ·±å…¥çš„äº†è§£å’Œæ›´æ¸…æ™°çš„è®°å¿†ï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬å†æ¬¡é‡åˆ°çº¢é»‘æ ‘çš„é—®é¢˜ä¸è‡³äºå¤´å¤§ï¼Œ<strong>å»ºè®®è¯»è¯¥æ–‡ç« å§¿åŠ¿: æ‰“å¼€ä¸¤ä¸ªé¡µé¢ï¼Œä¸€ä¸ªé¡µé¢çœ‹å›¾ç‰‡å’Œå†…å®¹ï¼Œä¸€ä¸ªé¡µé¢çœ‹å…¬å¼ï¼Œåƒç©é­”æ–¹ä¸€æ ·ï¼Œå¤šç©å‡ æ¬¡å°±æ˜ç™½äº†</strong></p><blockquote><p>é€šè¿‡å·¥å…· (å…¬ä¼—å·å›å¤ã€Œå·¥å…·ã€â€”&gt;é‚£äº›å¯ä»¥æé«˜æ•ˆç‡çš„å·¥å…·â€”&gt;çº¢é»‘æ ‘) åŠ¨æ€æ„Ÿå—çº¢é»‘æ ‘çš„è½¬æ¢è¿‡ç¨‹</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/Jul-19-2019%2016-46-36.gif" alt=""></p><blockquote><h4 id="ä¿ºå®¶å¸ä»¤ä¹°å®Œä¸œè¥¿åï¼Œæˆ‘ä¿©ç»å¸¸ä¼šå‘ç”Ÿè¿™æ ·çš„ä¸€æ®µå¯¹è¯"><a href="#ä¿ºå®¶å¸ä»¤ä¹°å®Œä¸œè¥¿åï¼Œæˆ‘ä¿©ç»å¸¸ä¼šå‘ç”Ÿè¿™æ ·çš„ä¸€æ®µå¯¹è¯" class="headerlink" title="ä¿ºå®¶å¸ä»¤ä¹°å®Œä¸œè¥¿åï¼Œæˆ‘ä¿©ç»å¸¸ä¼šå‘ç”Ÿè¿™æ ·çš„ä¸€æ®µå¯¹è¯:"></a>ä¿ºå®¶å¸ä»¤ä¹°å®Œä¸œè¥¿åï¼Œæˆ‘ä¿©ç»å¸¸ä¼šå‘ç”Ÿè¿™æ ·çš„ä¸€æ®µå¯¹è¯:</h4><p>å¸ä»¤:ä½ çŒœæˆ‘ä¹°çš„è¿™ä¸ªå¤šå°‘é’±ï¼Ÿ<br><em>æˆ‘: 1000</em><br>å¸ä»¤: é«˜äº†<br><em>æˆ‘: 500</em><br>å¸ä»¤: ä½äº†:<br><em>æˆ‘: 750</em><br>â€¦â€¦ ç›´åˆ°æœ€åçŒœä¸­</p></blockquote><p>è¿™æ ·è¯´å¤§å®¶åº”è¯¥å·²ç»çŒœåˆ°äº†æ˜¯ã€ŒäºŒåˆ†æŸ¥æ‰¾æ³•ã€ï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘æƒ³è¦å¼•å‡ºçš„æ˜¯ <strong>æ ‘</strong>ï¼Œæ¥çœ‹å›¾ç‰‡</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/tree-838667.jpg" alt=""><br>ç¨‹åºä¸­çš„æ ‘å…¶å®æ˜¯æˆ‘ä»¬æ—¥å¸¸çœ‹åˆ°çš„æ ‘çš„å€’å½±ï¼Œæˆ–è€…å‘æŒ¥ä¸€ä¸‹æƒ³è±¡ï¼Œå€’å½±ä¹Ÿå¯ä»¥æ˜¯æ ‘æ ¹</p><h2 id="äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="äºŒå‰æŸ¥æ‰¾æ ‘"></a>äºŒå‰æŸ¥æ‰¾æ ‘</h2><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒBinary Search Tree ã€ŒBSTã€ï¼Œè¦æƒ³äº†è§£äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹äºŒå‰æŸ¥æ‰¾æ ‘æœ‰å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ</p><ol><li>æŸèŠ‚ç‚¹çš„å·¦å­æ ‘èŠ‚ç‚¹å€¼ä»…åŒ…å«å°äºè¯¥èŠ‚ç‚¹å€¼</li><li>æŸèŠ‚ç‚¹çš„å³å­æ ‘èŠ‚ç‚¹å€¼ä»…åŒ…å«å¤§äºè¯¥èŠ‚ç‚¹å€¼</li><li>å·¦å³å­æ ‘æ¯ä¸ªä¹Ÿå¿…é¡»æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘<br>çœ‹ä¸ªå›¾å°±è½»æ¾ç†è§£ä¸Šé¢ä¸‰å¥è¯çš„æ„æ€äº†:</li></ol><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-10-33-23.jpg" alt=""></p><p>ä¸Šå›¾ï¼Œç»“åˆäºŒå‰æŸ¥æ‰¾æ ‘çš„ä¸‰æ¡çº¦æŸæ¥çœ‹ï¼Œéå¸¸å¥½ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å†æ¥çœ‹ä¸€ä¸ªå›¾ï¼Œä¾æ—§ç¬¦åˆä¸Šé¢ä¸‰æ¡çº¦æŸï¼Œæ„Ÿè§‰æœ‰é—®é¢˜å—ï¼Ÿ</p><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-10-42-07.jpg" alt=""></p><ol><li>è¿™æ˜¯ä¸€ä¸ªèµ°è·¯ä¸€ç±³å…­ï¼Œä¸€ç±³å…«çš„æ ‘</li><li>è¿™æ˜¯ä¸€ä¸ªç•¸å½¢çš„æ ‘ï¼Œå¤§é£ä¸€æŒ‚å¾ˆå¯èƒ½è¢«æŠ˜æ–­çš„æ ‘<br>ä»ç¨‹åºçš„è§’åº¦æ¥è¯´è¿™ä¸ªæ ‘ä¸å¤Ÿå¹³è¡¡ï¼ŒæŸ¥æ‰¾æ¬¡æ•°æˆ–æ—¶é—´å¤æ‚åº¦ O(h)å¯èƒ½ä¼šéšç€ä¸€æ¡è…¿é•¿æ— é™å¢é•¿</li></ol><p>ç†ç§‘ç”Ÿåœ¨é«˜ä¸­å­¦ä¹ ç”Ÿç‰©æ—¶å­¦è¿‡ä¸€ä¸ªå…³é”®å­—ã€Œå»é™¤é¡¶ç«¯ä¼˜åŠ¿ã€ï¼Œé€šè¿‡å»é™¤æ¤ç‰©é¡¶ç«¯ä¼˜åŠ¿ï¼Œä¾§èŠ½ä¼šè¿…é€Ÿç”Ÿé•¿ï¼Œæ…¢æ…¢å˜å¾—å¼ºå£®å’Œå¹³è¡¡ï¼Œ <strong>çº¢é»‘æ ‘å…¶å®å°±æ˜¯å»é™¤äºŒå‰æŸ¥æ‰¾æ ‘é¡¶ç«¯ä¼˜åŠ¿çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼Œä»è€Œè¾¾åˆ°æ ‘çš„å¹³è¡¡</p><h2 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h2><p>çº¢é»‘æ ‘ï¼ŒRed-Black Tree ã€ŒRBTã€æ˜¯ä¸€ä¸ªè‡ªå¹³è¡¡(ä¸æ˜¯ç»å¯¹çš„å¹³è¡¡)çš„äºŒå‰æŸ¥æ‰¾æ ‘(BST)ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éµå¾ªä¸‹é¢çš„è§„åˆ™:</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰çº¢è‰²æˆ–é»‘è‰²</li><li>æ ‘çš„æ ¹å§‹ç»ˆæ˜¯é»‘è‰²çš„ (é»‘åœŸåœ°å­•è‚²é»‘æ ‘æ ¹ï¼ŒğŸ˜„)</li><li>æ²¡æœ‰ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²èŠ‚ç‚¹ï¼ˆçº¢è‰²èŠ‚ç‚¹ä¸èƒ½æœ‰çº¢è‰²çˆ¶èŠ‚ç‚¹æˆ–çº¢è‰²å­èŠ‚ç‚¹ï¼Œ<strong>å¹¶æ²¡æœ‰è¯´ä¸èƒ½å‡ºç°è¿ç»­çš„é»‘è‰²èŠ‚ç‚¹</strong>ï¼‰</li><li>ä»èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ ¹ï¼‰åˆ°å…¶ä»»ä½•åä»£NULLèŠ‚ç‚¹(å¶å­ç»“ç‚¹ä¸‹æ–¹æŒ‚çš„ä¸¤ä¸ªç©ºèŠ‚ç‚¹ï¼Œå¹¶ä¸”è®¤ä¸ºä»–ä»¬æ˜¯é»‘è‰²çš„)çš„æ¯æ¡è·¯å¾„éƒ½å…·æœ‰ç›¸åŒæ•°é‡çš„é»‘è‰²èŠ‚ç‚¹</li></ol><p>ç¬é—´æ‡µé€¼ï¼Ÿ<strong>äº†è§£ä¸€ä¸‹å°è±¡å°±è¡Œ</strong>ï¼Œå¼€å§‹ç©é­”æ–¹éƒ½æ˜¯è¦ç…§ç€é­”æ–¹å…¬å¼ä¸€ç‚¹ç‚¹ç©çš„ï¼Œå¤šç©å‡ æ¬¡å°±ç†Ÿæ‚‰äº†ã€‚çº¢é»‘æ ‘ä¹Ÿä¸€æ ·ï¼Œçº¢é»‘æ ‘æœ‰ä¸¤å¤§æ“ä½œ:</p><ol><li>recolor (é‡æ–°æ ‡è®°é»‘è‰²æˆ–çº¢è‰²)</li><li>rotation (æ—‹è½¬ï¼Œè¿™æ˜¯æ ‘è¾¾åˆ°å¹³è¡¡çš„å…³é”®)<br>æˆ‘ä»¬ä¼šå…ˆå°è¯• recolorï¼Œå¦‚æœ recolor ä¸èƒ½è¾¾åˆ°çº¢é»‘æ ‘çš„ 4 ç‚¹è¦æ±‚ï¼Œç„¶åæˆ‘ä»¬å°è¯• rotationï¼Œå…¶å®çº¢é»‘æ ‘çš„å…³é”®ç©æ³•å°±æ˜¯å¼„æ¸…æ¥š recolor å’Œ rotation çš„è§„åˆ™ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹è¯¦ç»†çš„ç®—æ³•å…¬å¼å§ <strong>åƒä¸‡åˆ«ç€æ€¥è®°å¿†å…¬å¼ï¼Œæœ‰å›¾ç¤ºä¼šé€æ­¥è¯´æ˜ï¼Œå°±åƒé­”æ–¹ä¸€æ ·ï¼Œå¤šç©å‡ æ¬¡å°±æ‡‚äº†</strong>:<br>å‡è®¾æˆ‘ä»¬æ’å…¥çš„æ–°èŠ‚ç‚¹ä¸º X</li></ol><ul><li><ol><li>å°†æ–°æ’å…¥çš„èŠ‚ç‚¹æ ‡è®°ä¸ºçº¢è‰²</li></ol></li><li><ol start="2"><li>å¦‚æœ X æ˜¯æ ¹ç»“ç‚¹(root)ï¼Œåˆ™æ ‡è®°ä¸ºé»‘è‰²</li></ol></li><li><ol start="3"><li>å¦‚æœ X çš„ parent ä¸æ˜¯é»‘è‰²ï¼ŒåŒæ—¶ X ä¹Ÿä¸æ˜¯ root:<ul><li>3.1 å¦‚æœ X çš„ uncle (å”å”) æ˜¯çº¢è‰²<ul><li>3.1.1 å°† parent å’Œ uncle æ ‡è®°ä¸ºé»‘è‰²</li><li>3.1.2 å°† grand parent (ç¥–çˆ¶) æ ‡è®°ä¸ºçº¢è‰²</li><li>3.1.3 è®© X èŠ‚ç‚¹çš„é¢œè‰²ä¸ X ç¥–çˆ¶çš„é¢œè‰²ç›¸åŒï¼Œç„¶åé‡å¤æ­¥éª¤ 2ã€3</li></ul></li></ul></li></ol></li></ul><p>è¯ä¸å¤šè¯´ï¼Œçœ‹ä¸‹å›¾<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-15-21-51.jpg" alt=""></p><p>è·Ÿç€ä¸Šé¢çš„å…¬å¼èµ°:</p><ol><li>å°†æ–°æ’å…¥çš„ X èŠ‚ç‚¹æ ‡è®°ä¸ºçº¢è‰²</li><li>å‘ç° X çš„ parent (P) åŒæ ·ä¸ºçº¢è‰²ï¼Œè¿™è¿åäº†çº¢é»‘æ ‘çš„ç¬¬ä¸‰æ¡è§„åˆ™ã€Œä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­ç›¸é‚»çš„çº¢è‰²èŠ‚ç‚¹ã€</li><li>å‘ç° X çš„ uncle (U) åŒæ ·ä¸ºçº¢è‰²</li><li>å°† P å’Œ U æ ‡è®°ä¸ºé»‘è‰²</li><li>å°† X å’Œ X çš„ grand parent (G) æ ‡è®°ä¸ºç›¸åŒçš„é¢œè‰²ï¼Œå³çº¢è‰²ï¼Œç»§ç»­é‡å¤å…¬å¼ 2ã€3</li><li>å‘ç° G æ˜¯æ ¹ç»“ç‚¹ï¼Œæ ‡è®°ä¸ºé»‘è‰²</li><li>ç»“æŸ</li></ol><p>åˆšåˆšè¯´äº† X çš„ uncle æ˜¯çº¢è‰²çš„æƒ…å†µï¼Œæ¥ä¸‹æ¥è¦è¯´æ˜¯é»‘è‰²çš„æƒ…å†µ</p><ul><li><ol start="3"><li>å¦‚æœ X çš„ parent ä¸æ˜¯é»‘è‰²ï¼ŒåŒæ—¶ X ä¹Ÿä¸æ˜¯ root:<ul><li>3.2 å¦‚æœ X çš„ uncle (å”å”) æ˜¯é»‘è‰²ï¼Œæˆ‘ä»¬è¦åˆ†å››ç§æƒ…å†µå¤„ç†<ul><li>3.2.1 å·¦å·¦ (P æ˜¯ G çš„å·¦å­©å­ï¼Œå¹¶ä¸” X æ˜¯ P çš„å·¦å­©å­)</li><li>3.2.2 å·¦å³ (P æ˜¯ G çš„å·¦å­©å­ï¼Œå¹¶ä¸” X æ˜¯ P çš„å³å­©å­)</li><li>3.2.3 å³å³ (å’Œ 3.2.1 é•œåƒè¿‡æ¥ï¼Œæ°å¥½ç›¸å)</li><li>3.2.4 å³å·¦ (å’Œ 3.2.2 é•œåƒè¿‡æ¥ï¼Œæ°å¥½ç›¸å)<br>å½“å‡ºç° uncle æ˜¯é»‘è‰²çš„æ—¶å€™æˆ‘ä»¬ç¬¬ä¸€æ­¥è¦è€ƒè™‘çš„æ˜¯ <strong>æ—‹è½¬</strong> ï¼Œè¿™é‡Œå…ˆè¯·å°ä¼™ä¼´<strong>ä¸è¦å…³æ³¨çº¢é»‘æ ‘çš„ç¬¬ 4 æ¡è§„åˆ™</strong>ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ¼”ç¤ºå¦‚ä½•æ—‹è½¬çš„ï¼Œæ¥ä¸€ç‚¹ç‚¹çœ‹ï¼Œä¸è¦çœ‹å›¾å°±æ…Œï¼Œæœ‰è§£é‡Šçš„ğŸ˜œ:<h3 id="å·¦å·¦æƒ…å†µ"><a href="#å·¦å·¦æƒ…å†µ" class="headerlink" title="å·¦å·¦æƒ…å†µ"></a>å·¦å·¦æƒ…å†µ</h3>è¿™ç§æƒ…å†µå¾ˆç®€å•ï¼Œæƒ³è±¡è¿™æ˜¯ä¸€æ ¹ç»³å­ï¼Œæ‰‹æèµ· P èŠ‚ç‚¹ï¼Œç„¶åå˜è‰²å³å¯</li></ul></li></ul></li></ol></li></ul><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-15-38-39.jpg" alt=""></p><h3 id="å·¦å³"><a href="#å·¦å³" class="headerlink" title="å·¦å³"></a>å·¦å³</h3><p>å·¦æ—‹: ä½¿ X çš„çˆ¶èŠ‚ç‚¹ P è¢« X å–ä»£ï¼ŒåŒæ—¶çˆ¶èŠ‚ç‚¹ P æˆä¸º X çš„å·¦å­©å­ï¼Œç„¶åå†åº”ç”¨ <strong>å·¦å·¦æƒ…å†µ</strong><br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-15-39-07.jpg" alt=""></p><h3 id="å³å³"><a href="#å³å³" class="headerlink" title="å³å³"></a>å³å³</h3><p>ä¸å·¦å·¦æƒ…å†µä¸€æ ·ï¼Œæƒ³è±¡æˆä¸€æ ¹ç»³å­<br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-15-39-32.jpg" alt=""></p><h3 id="å³å·¦"><a href="#å³å·¦" class="headerlink" title="å³å·¦"></a>å³å·¦</h3><p>å³æ—‹: ä½¿ X çš„çˆ¶èŠ‚ç‚¹ P è¢« X å–ä»£ï¼ŒåŒæ—¶çˆ¶èŠ‚ç‚¹ P æˆä¸º X çš„å³å­©å­ï¼Œç„¶åå†åº”ç”¨ <strong>å³å³æƒ…å†µ</strong><br><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/2019-07-19-15-39-44.jpg" alt=""></p><p>ä½ è¯´çš„åŠ¨å›¾åœ¨å“ªé‡Œï¼Œä½ ä¸ªå¤§éª—å­ï¼Œåˆ«ç€æ€¥ï¼Œç°åœ¨å°±ä¸ºå°ä¼™ä¼´ä»¬å¥‰ä¸ŠåŠ¨å›¾æ¼”ç¤ºï¼Œæ¥è¯´æ˜å…¬å¼çš„ä½¿ç”¨:</p><h3 id="æ¡ˆä¾‹ä¸€"><a href="#æ¡ˆä¾‹ä¸€" class="headerlink" title="æ¡ˆä¾‹ä¸€"></a>æ¡ˆä¾‹ä¸€</h3><blockquote><p>æ’å…¥ 10ï¼Œ20ï¼Œ30ï¼Œ15 åˆ°ä¸€ä¸ªç©ºæ ‘ä¸­</p></blockquote><ol><li>å‘ç©ºæ ‘ä¸­ç¬¬ä¸€æ¬¡æ’å…¥æ•°å­— 10ï¼Œè‚¯å®šæ˜¯ root èŠ‚ç‚¹</li><li>root èŠ‚ç‚¹æ ‡è®°æˆé»‘è‰²</li></ol><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/Jul-19-2019%2016-08-11.gif" alt=""></p><ol><li>å‘æ ‘ä¸­æ’å…¥æ–°èŠ‚ç‚¹ 20ï¼Œæ ‡è®°ä¸ºçº¢è‰²</li><li>20 &gt; 10ï¼Œå¹¶å‘ç° 10 æ²¡æœ‰å¶å­èŠ‚ç‚¹ï¼Œå°†æ–°èŠ‚ç‚¹ 20 ä½œä¸º 10 çš„å³å­©å­</li></ol><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/Jul-19-2019%2016-12-00.gif" alt=""></p><ol><li>å‘æ ‘ä¸­æ’å…¥æ–°èŠ‚ç‚¹ 30ï¼Œæ ‡è®°ä¸ºçº¢è‰²</li><li>30 &gt; 10ï¼ŒæŸ¥æ‰¾ 10 çš„å³å­æ ‘ï¼Œæ‰¾åˆ° 20</li><li>30 &gt; 20ï¼Œç»§ç»­æŸ¥æ‰¾ 20 çš„å³å­æ ‘ï¼Œå‘ç° 20 æ²¡æœ‰å¶å­èŠ‚ç‚¹ï¼Œå°†å€¼æ’åœ¨æ­¤å¤„</li><li>30 å’Œ 20 èŠ‚ç‚¹éƒ½ä¸ºçº¢è‰²ï¼Œ30 ä¸ºå³å­©å­ï¼Œ20 ä¹Ÿä¸ºå³å­©å­ï¼Œè§¦å‘äº† <strong>å³å³æƒ…å†µ</strong></li><li>é€šè¿‡ä¸€æ¬¡æ—‹è½¬ï¼Œæèµ· 20 èŠ‚ç‚¹</li><li>20 èŠ‚ç‚¹æ˜¯æ ¹ç»“ç‚¹ï¼Œæ ‡è®°ä¸ºé»‘è‰²</li></ol><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/Jul-19-2019%2016-17-51.gif" alt=""></p><ol><li>å‘æ ‘ä¸­æ’å…¥æ–°èŠ‚ç‚¹ 15ï¼Œæ ‡è®°ä¸ºçº¢è‰²</li><li>é€šè¿‡æ¯”å¯¹å¤§å°å’Œåˆ¤æ–­æ˜¯å¦æœ‰å¶å­èŠ‚ç‚¹ï¼Œæœ€ç»ˆæ’å€¼ä¸º 10 èŠ‚ç‚¹çš„å³å­©å­</li><li>15 å’Œ 10 èŠ‚ç‚¹éƒ½ä¸ºçº¢è‰²ï¼Œ15 çš„ uncle èŠ‚ç‚¹ 30 ä¹Ÿä¸ºçº¢è‰²</li><li>æŒ‰ç…§å…¬å¼ï¼Œå°† 15 çš„ parent 10 å’Œ uncle 30 æ›´æ”¹ä¸ºé»‘è‰²</li><li>è®© 15 èŠ‚ç‚¹ grand parent 20 çš„é¢œè‰²ä¸ 15 èŠ‚ç‚¹çš„é¢œè‰²ä¸€æ ·ï¼Œå˜ä¸ºçº¢è‰²</li><li>20 ä¸ºæ ¹ç»“ç‚¹ï¼Œå°†å…¶æ”¹ä¸ºé»‘è‰²</li></ol><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E5%BA%94%E7%94%A8%E7%B1%BB%E6%96%87%E7%AB%A0/_image/2019-07-19/Jul-19-2019%2016-30-42.gif" alt=""></p><blockquote><p>ç»§ç»­æ’å…¥å…¶ä»–èŠ‚ç‚¹åªä¸è¿‡åå¤åº”ç”¨ä¸Šé¢çš„å…¬å¼ï¼Œä¸Šé¢åº”ç”¨åˆ°çš„çº¢é»‘æ ‘å·¥å…·ï¼Œå¯ä»¥æš‚åœåŠ¨ç”»æ•ˆæœï¼Œä¸€å¸§ä¸€å¸§çš„çœ‹çº¢é»‘æ ‘çš„è½¬æ¢è¿‡ç¨‹ï¼Œè¿™æ ·é€šè¿‡ç»ƒä¹ ï¼ŒæŸ¥çœ‹å…¬å¼ï¼Œè§‚å¯Ÿå˜åŒ–ä¸‰ç®¡é½ä¸‹ï¼Œçº¢é»‘æ ‘çš„å…¥é—¨ç†è§£åº”è¯¥å®Œå…¨ä¸å†æ˜¯é—®é¢˜äº†</p></blockquote><h2 id="çµé­‚è¿½é—®"><a href="#çµé­‚è¿½é—®" class="headerlink" title="çµé­‚è¿½é—®"></a>çµé­‚è¿½é—®</h2><ol><li>jdk 1.8 HashMap ä¸­æœ‰ä½¿ç”¨åˆ°çº¢é»‘æ ‘ï¼Œä½ çŸ¥é“è§¦å‘æ¡ä»¶æ˜¯ä»€ä¹ˆå—ï¼Ÿæœ‰è¯»è¿‡æºç æ˜¯å¦‚ä½• put å’Œ remove çš„å—ï¼Ÿ</li><li>è¿™é‡Œè®²çš„æ˜¯çº¢é»‘æ ‘çš„ insertï¼Œdelete åˆæ˜¯ä»€ä¹ˆè§„åˆ™å‘¢ï¼Ÿ</li><li>å“ªäº›åœºæ™¯å¯ä»¥åº”ç”¨çº¢é»‘æ ‘ï¼Ÿ</li><li>ä½ äº†è§£å„ç§æ ‘çš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿ</li><li>ç•™ä¸ªå°ä½œä¸šï¼Œåº”ç”¨å·¥å…·å°† [10 70 32 34 13 56 32 56 21 3 62 4 ] é€ä¸ªæ’å…¥åˆ°æ ‘ä¸­ï¼Œç†è§£çº¢é»‘æ ‘ recolor å’Œ rotation çš„è½¬æ¢è§„åˆ™</li></ol><h2 id="æé«˜æ•ˆç‡å·¥å…·"><a href="#æé«˜æ•ˆç‡å·¥å…·" class="headerlink" title="æé«˜æ•ˆç‡å·¥å…·"></a>æé«˜æ•ˆç‡å·¥å…·</h2><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/b.png" alt=""></p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://mp.weixin.qq.com/s/6dg3u2PkcTSQHu_3T_QYnA" target="_blank" rel="noopener">åªä¼šç”¨ git pull ï¼Ÿæœ‰æ—¶å€™ä½ å¯ä»¥å°è¯•æ›´ä¼˜é›…çš„å¤„ç†æ–¹å¼ </a></li><li><a href="https://mp.weixin.qq.com/s/Dnr1jLebvBUHnziZzSfcrA" target="_blank" rel="noopener">åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¤§å‚é«˜é¢‘é¢è¯•é¢˜ï¼Œè½»æ¾æå®š</a></li><li><a href="https://mp.weixin.qq.com/s/YBQB086ADBjHUmwrFQrWew" target="_blank" rel="noopener">é¢è¯•è¿˜ä¸çŸ¥é“BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/hR1TqkVzwZ_T8fuMnsM4hQ" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¥½çš„RESTful API</a></li><li><a href="https://mp.weixin.qq.com/s/V7h8O6pVFQ-nr_iA2SNqtw" target="_blank" rel="noopener">ç¨‹åºçŒ¿ä¸ºä»€ä¹ˆè¦çœ‹æºç ï¼Ÿ</a></li></ul><hr><blockquote><h3 id="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"><a href="#æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€" class="headerlink" title="æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€"></a>æ¬¢è¿æŒç»­å…³æ³¨å…¬ä¼—å·ï¼šã€Œæ—¥æ‹±ä¸€å…µã€</h3><ul><li>å‰æ²¿ Java æŠ€æœ¯å¹²è´§åˆ†äº« [orange]</li><li>é«˜æ•ˆå·¥å…·æ±‡æ€» [green]</li><li>é¢è¯•é—®é¢˜åˆ†æä¸è§£ç­” [pink]</li><li>æŠ€æœ¯èµ„æ–™é¢†å– [red]</li></ul><p><strong>åç»­æ–‡ç« ä¼šä¸ºä½ è®²è§£å„ç§æ—¶é—´ç©ºé—´å¤æ‚åº¦ï¼Œä»¥åŠå¤šçº¿ç¨‹ï¼ŒElasticSearch ç­‰é—®é¢˜</strong><br> ä»¥è¯»ä¾¦æ¢å°è¯´æ€ç»´è½»æ¾è¶£å‘³å­¦ä¹  Java æŠ€æœ¯æ ˆç›¸å…³çŸ¥è¯†ï¼Œæœ¬ç€å°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼ŒæŠ½è±¡é—®é¢˜å…·ä½“åŒ–å’Œå›¾å½¢åŒ–åŸåˆ™é€æ­¥åˆ†è§£æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯æŒç»­æ›´æ–°ï¼Œè¯·æŒç»­å…³æ³¨â€¦â€¦</p></blockquote><p><img src="https://rgyb.sunluomeng.top/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%96%87%E7%AB%A0/%E6%84%9F%E6%83%B3%E4%B8%8E%E6%80%BB%E7%BB%93/_image/2019-06-18/a%20%281%29.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çº¢é»‘æ ‘ </tag>
            
            <tag> äºŒå‰æŸ¥æ‰¾æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è®¾è®¡å¥½çš„Restful API</title>
      <link href="//p/restful-api-design.html"/>
      <url>//p/restful-api-design.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h2><p>ç°é˜¶æ®µçš„å¼€å‘æ¨¡å¼å¤šä»¥å‰åç«¯åˆ†ç¦»å½¢å¼å­˜åœ¨ï¼Œå‰åç«¯å¼€å‘äººå‘˜éœ€è¦é€šè¿‡å¤§é‡ API æ¥è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå¦‚æœåœ¨äº¤äº’è¿‡ç¨‹ä¸­å‰åç«¯äººå‘˜ç»å¸¸é­é‡å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>å‰ç«¯äººå‘˜ä¸èƒ½å¿«é€Ÿç†è§£æ¥å£å­—æ®µå«ä¹‰åŠæ¥å£å­—æ®µå˜åŒ–</li><li>åç«¯äººå‘˜æƒ³å¤ç”¨æŸäº›æ¥å£ï¼Œä½†æ˜¯ä¸èƒ½å¿«é€Ÿä»æ¥å£ URL çš„å®šä¹‰ä¸­æ˜ç¡®è¯¥æ¥å£çš„å«ä¹‰ï¼Œéœ€è¦è¿›ä¸€æ­¥è¯»ä»£ç ç¡®è®¤</li><li>URLä¸­çš„è‹±æ–‡å•è¯ä½¿ç”¨äº”èŠ±å…«é—¨ï¼Œæœç´¢æŸä¸ªæ¥å£ä¸çŸ¥é“å…·ä½“çš„å…³é”®å­—</li><li>è¯·æ±‚æ–¹æ³•åŠ¨è¯å¦‚ POST GET éšæ„ä½¿ç”¨</li><li>å®Œæˆå½“å‰ä¸šåŠ¡æ¥å£å¯¹æ¥ï¼Œå‰ç«¯äººå‘˜ç»å¸¸ä¼šè¯¢é—®ä¸‹ä¸€æ­¥ä¸šåŠ¡æµç¨‹çš„æ¥å£å®šä¹‰åœ¨å“ªé‡Œï¼Œå¯¹æ¥å½¢å¼æ˜¯ä»€ä¹ˆæ ·çš„</li></ul><p>ä»¥ä¸Šåªæ˜¯å‰åç«¯äººå‘˜é€šè¿‡æ¥å£äº¤äº’çš„ä¸€å°éƒ¨åˆ†é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å°±å¥½æ¯”â€ç‰™ç—›â€ï¼Œä¸è‡´å‘½ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªè½¯ä»¶å¼€å‘çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå¤©å¤©â€ç‰™ç—›â€æ˜¯å¾ˆè¦å‘½çš„, éœ€è¦è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œéœ€è¦å‰åç«¯äººå‘˜éƒ½èƒ½è®¤è¯†ä¸äº†è§£æ¥å£è®¾è®¡è§„èŒƒçš„é‡è¦æ€§ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯REST"><a href="#ä»€ä¹ˆæ˜¯REST" class="headerlink" title="ä»€ä¹ˆæ˜¯REST"></a>ä»€ä¹ˆæ˜¯REST</h2><p>åœ¨ 2000 å¹´ï¼ŒRoy Fielding æå‡º <a href="https://zjcqoo.github.io/-----https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener">Representational State Transfer (REST)</a> çš„æ¦‚å¿µï¼Œä¸­æ–‡ç¿»è¯‘è¿‡æ¥â€è¡¨è¿°æ€§çŠ¶æ€ä¼ é€’â€ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å»ç»´åŸºç™¾ç§‘çœ‹çœ‹åŸå§‹æ¦‚å¿µï¼Œä¹ä¸€çœ‹æ˜¯ä¸€ä¸ªæŒºæŠ½è±¡çš„æ¦‚å¿µï¼Œä½†å…¶å®ï¼Œè¿™ä¸ªæ¦‚å¿µå°±åƒäº¤é€šç¯è§„åˆ™ä¸€æ ·ç®€å•ï¼Œå°±çœ‹å¦‚ä½•çœ‹å¾…ç›¸å…³è§„èŒƒ. å½“æˆ‘ä»¬è°ˆåŠ RESTful è®¾è®¡è§„èŒƒï¼Œå¤šæ•°äººèƒ½äº†è§£è®¾è®¡çš„å¤§åŸåˆ™ï¼Œä½†æ˜¯ä¸äº†è§£å°ç»†èŠ‚ï¼Œè€Œå¯¹è¿™äº›ç»†èŠ‚çš„äº†è§£ä¸å¦ï¼Œæ˜¯èƒ½å¦æ²»å¥½â€ç‰™ç—›ç—…â€çš„å…³é”®</p><h2 id="RESTæœ¯è¯­ä»‹ç»"><a href="#RESTæœ¯è¯­ä»‹ç»" class="headerlink" title="RESTæœ¯è¯­ä»‹ç»"></a>RESTæœ¯è¯­ä»‹ç»</h2><p>ç°å®ä¸–ç•Œäº¤é€šç¯æœ‰çº¢ç»¿é»„ï¼ŒRESTç›¸å…³çš„æ¦‚å¿µä¹Ÿæ˜¯ä¸‰ä¸ªï¼šèµ„æºï¼Œé›†åˆï¼ŒURL</p><h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><p>èµ„æºæ˜¯æŸç§ä¸œè¥¿çš„å¯¹è±¡æˆ–è¡¨ç¤ºï¼Œå®ƒå…·æœ‰ä¸€äº›ä¸ä¹‹ç›¸å…³çš„æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥æœ‰ä¸€ç»„æ–¹æ³•å¯¹å…¶è¿›è¡Œæ“ä½œã€‚ ä¾‹å¦‚, åŠ¨ç‰©ï¼Œå­¦æ ¡å’Œå‘˜å·¥æ˜¯èµ„æº;  åˆ é™¤ï¼Œæ·»åŠ ï¼Œæ›´æ–°æ˜¯å¯¹è¿™äº›èµ„æºæ‰§è¡Œçš„ç›¸å…³æ“ä½œ</p><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><p>é›†åˆæ˜¯èµ„æºé›†åˆï¼Œä¾‹å¦‚ï¼Œå…¬å¸æ˜¯å…¬å¸èµ„æºçš„é›†åˆ</p><h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰æ˜¯å¯ä»¥é€šè¿‡å…¶å®šä½èµ„æºçš„è·¯å¾„ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å…¶æ‰§è¡ŒæŸäº›æ“ä½œ</p><p>äº†è§£åˆ°ä»¥ä¸Šå†…å®¹ï¼Œ é‚£REST ä¸–ç•Œçš„â€äº¤é€šç¯â€è§„åˆ™æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹</p><h2 id="å¦‚ä½•è®¾è®¡å’Œå¼€å‘ä¸€ä¸ªé«˜å¯ç”¨çš„-REST-APIs"><a href="#å¦‚ä½•è®¾è®¡å’Œå¼€å‘ä¸€ä¸ªé«˜å¯ç”¨çš„-REST-APIs" class="headerlink" title="å¦‚ä½•è®¾è®¡å’Œå¼€å‘ä¸€ä¸ªé«˜å¯ç”¨çš„ REST APIs"></a>å¦‚ä½•è®¾è®¡å’Œå¼€å‘ä¸€ä¸ªé«˜å¯ç”¨çš„ REST APIs</h2><blockquote><p>ç½‘ä¸Šä¸€ç›´æœ‰å…³äºâ€æœ€å¥½çš„Restful APIçš„è®¾è®¡â€äº‰è®ºï¼Œä½•ä¸ºæœ€å¥½ï¼Œè‡³ä»Šæ²¡æœ‰ä¸€ä¸ªå®˜æ–¹çš„æŒ‡å¯¼ã€‚æœ¬æ–‡æ€»ç»“ RESTful çš„è®¾è®¡ç»†èŠ‚ï¼Œä»‹ç»å¦‚ä½•è®¾è®¡å‡ºæ˜“äºç†è§£å’Œä½¿ç”¨çš„ APIã€‚åœ¨ Restful API è®¾è®¡æ ‡å‡†ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„è®¾è®¡å¢åŠ ä¸€äº›å¼¹æ€§ï¼ˆå›¢é˜Ÿéƒ½è®¤å¯çš„æ–¹å¼ï¼‰ï¼Œæ¯ä¸ªé¡¹ç›®çš„æƒ…å†µä¸åŒï¼Œæœ€é‡è¦çš„æ˜¯é¡¹ç›®ç»„æˆå‘˜è¾¾æˆä¸€è‡´çš„Restful API è®¾è®¡è§„åˆ™ï¼Œè¾¾åˆ°é«˜å¯ç”¨å³å¯</p></blockquote><h3 id="URL-è®¾è®¡"><a href="#URL-è®¾è®¡" class="headerlink" title="URL è®¾è®¡"></a>URL è®¾è®¡</h3><p><em>å­¦è‹±è¯­ï¼Œåè¯ï¼ˆcar/animal/teacherï¼‰éƒ½å¾ˆå¥½è®°å¿†ï¼Œä½†æ˜¯å¦‚ä½•ç”¨åŠ¨è¯å’Œè¿™äº›åè¯ç»„åˆæ¥å‡†ç¡®çš„è¡¨è¾¾ç‰¹å®šçš„å«ä¹‰å´å¾ˆå›°éš¾ï¼Œåº†å¹¸çš„æ˜¯åœ¨ REST çš„ä¸–ç•Œï¼ŒåŠ¨è¯å¯¥å¯¥æ— å‡ ï¼Œå¹¶ä¸”å«ä¹‰å•ä¸€</em> ï¼ŒRESTful çš„æ ¸å¿ƒæ€æƒ³ä¹Ÿæ˜¯é€šè¿‡è¿™äº›<strong>åŠ¨è¯ + åè¯</strong>å®Œæˆå¯¹èµ„æºçš„æ“ä½œä¸è®¿é—®ï¼Œä½†æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è¿™æ ·çš„åŠ¨è¯ä¸åè¯çš„ URL ç»„åˆï¼š</p><ul><li>/getAllUsers</li><li>/createNewCompany</li><li>/updateUserInfo</li><li>/deleteUser?name=zhangsan</li></ul><p>è¿™äº› URL çš„è®¾è®¡ä¼šå¯¼è‡´æ–‡ç« å¼€å¤´æ‰€è¯´çš„å¾ˆå¤šé—®é¢˜ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æ¥äº†è§£å¦‚ä½•åº”ç”¨æ‰€è°“çš„<strong>åŠ¨è¯ + åè¯</strong></p><h4 id="åŠ¨è¯"><a href="#åŠ¨è¯" class="headerlink" title="åŠ¨è¯"></a>åŠ¨è¯</h4><p>åŠ¨è¯é€šå¸¸å°±æ˜¯ 5 ç§ HTTP æ–¹æ³•ï¼Œå¯¹åº”æˆ‘ä»¬å¸¸è§çš„ CRUD æ“ä½œï¼š</p><ul><li>POSTï¼šæ–°å»ºï¼ˆCreateï¼‰</li><li>GETï¼šè¯»å–ï¼ˆReadï¼‰</li><li>PUTï¼šæ›´æ–°ï¼ˆUpdateï¼‰</li><li>PATCHï¼šæ›´æ–°ï¼ˆUpdateï¼‰ï¼Œé€šå¸¸ä¸åˆ†æ›´æ–°ï¼Œä¹Ÿå¾ˆå°‘ç”¨åˆ°</li><li>DELETEï¼šåˆ é™¤ï¼ˆDeleteï¼‰</li></ul><p>æ ¹æ® HTTP è§„èŒƒï¼ŒåŠ¨è¯ä¸€å¾‹å¤§å†™ï¼Œå¦å¤–æ ¹æ®RESTful å¹‚ç­‰æ€§ï¼ˆå¤šæ¬¡è°ƒç”¨æ˜¯å¦ä¼šå¯¹èµ„æºäº§ç”Ÿå½±å“ï¼‰åŸåˆ™ï¼Œæˆ‘ä»¬ä¸èƒ½ä¹±ç”¨åŠ¨è¯ï¼ŒGET/PUT/DELETE æ˜¯å¹‚ç­‰çš„ï¼ŒPOST/PATCH ä¸æ˜¯å¹‚ç­‰çš„</p><p>æœ‰äº›å®¢æˆ·ç«¯åªèƒ½ä½¿ç”¨<code>GET</code>å’Œ<code>POST</code>è¿™ä¸¤ç§æ–¹æ³•ã€‚æœåŠ¡å™¨å¿…é¡»æ¥å—<code>POST</code>æ¨¡æ‹Ÿå…¶ä»–ä¸‰ä¸ªæ–¹æ³•ï¼ˆ<code>PUT</code>ã€<code>PATCH</code>ã€<code>DELETE</code>ï¼‰ã€‚</p><p>è¿™æ—¶ï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„ HTTP è¯·æ±‚ï¼Œè¦åŠ ä¸Š<code>X-HTTP-Method-Override</code>å±æ€§ï¼Œå‘Šè¯‰æœåŠ¡å™¨åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªåŠ¨è¯ï¼Œè¦†ç›–<code>POST</code>æ–¹æ³•ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/users/12</span> HTTP/1.1</span><br><span class="line"><span class="attribute">X-HTTP-Method-Override</span>: PUT</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>X-HTTP-Method-Override</code>æŒ‡å®šæœ¬æ¬¡è¯·æ±‚çš„æ–¹æ³•æ˜¯<code>PUT</code>ï¼Œè€Œä¸æ˜¯<code>POST</code></p><h4 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h4><p>åè¯å°±æ˜¯è¡¨ç¤ºä¸€ä¸ªèµ„æºæˆ–è€…æœåŠ¡ï¼Œå¦‚ /usersï¼Œ/teachersï¼Œè¿™é‡Œçœ‹åˆ°æˆ‘ç”¨åè¯å¤æ•°çš„å½¢å¼æè¿°æŸä¸€èµ„æºï¼Œè‡³äºç”¨å•æ•°è¿˜æ˜¯å¤æ•°æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œæˆ‘åœ¨è¿™é‡Œæ¨èä½¿ç”¨å¤æ•°ï¼Œå› ä¸ºåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œèµ„æºå¤šæ•°æ˜¯ä»¥é›†åˆçš„å½¢å¼å­˜åœ¨çš„</p><h4 id="åŠ¨è¯-åè¯"><a href="#åŠ¨è¯-åè¯" class="headerlink" title="åŠ¨è¯ + åè¯"></a>åŠ¨è¯ + åè¯</h4><table><thead><tr><th>èµ„æº</th><th>POSTï¼ˆCreateï¼‰</th><th>GETï¼ˆReadï¼‰</th><th>PUTï¼ˆUpdateï¼‰</th><th>DELETE ï¼ˆDeleteï¼‰</th></tr></thead><tbody><tr><td>/users</td><td>åˆ›å»ºæ–°ç”¨æˆ·</td><td>æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</td><td>æ‰¹é‡æ›´æ–°ç”¨æˆ·</td><td>åˆ é™¤æ‰€æœ‰ç”¨æˆ·</td></tr><tr><td>/users/12</td><td>æ–¹æ³•ä¸è¢«å…è®¸ï¼ˆ405ï¼‰</td><td>æŸ¥è¯¢æŒ‡å®šç”¨æˆ·</td><td>æ›´æ–°æŒ‡å®šç”¨æˆ·</td><td>åˆ é™¤æŒ‡å®šç”¨æˆ·</td></tr></tbody></table><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /users</span><br><span class="line">GET /users</span><br><span class="line">PUT /users</span><br><span class="line">DELETE /users</span><br><span class="line">GET /users/12</span><br><span class="line">PUT /users/12</span><br><span class="line">DELETE /users/12</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°<strong>åŠ¨è¯ + åè¯</strong>çš„ç»„åˆæ˜¯ä¸æ˜¯æ¸…æ™°å¤šäº†ï¼Œæ²¡æœ‰æ‚ä¹±çš„åŠ¨è¯åœ¨ URL ä¸­ï¼Œå¤§å®¶çš„ç†è§£å«ä¹‰ç›¸åŒ</p><h4 id="URL-å±‚çº§"><a href="#URL-å±‚çº§" class="headerlink" title="URL å±‚çº§"></a>URL å±‚çº§</h4><p>ç°å®ä¸­å“ªæœ‰è¿™ä¹ˆç®€å•çš„ CRUDï¼Œèµ„æºçš„ç›¸äº’å…³è”ä¸åµŒå¥—å¾ˆå¸¸è§ï¼Œ<em>æŸ¥æ‰¾ id æ˜¯ 12 çš„ç”¨æˆ·çš„æ‰€æœ‰å¸–å­</em>ï¼Œ å¦‚ä½•è®¾è®¡è¿™ä¸ª URLï¼Œä¸‹é¢ä¸¤ç§è®¾è®¡ä¹Ÿä¼šæœ‰äº‰è®ºï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /users/12/posts</span><br><span class="line">GET /posts?userId=12</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§å‡ºç°ä¸¤ä¸ªåè¯ä¸»é¢˜ï¼ˆusers/postsï¼‰ï¼Œä¼šè®©äººæœ‰å‡ ç§’é’Ÿçš„çŒœæƒ³ï¼Œè¿™åˆ°åº•è¯·æ±‚çš„æ˜¯ç”¨æˆ·èµ„æºè¿˜æ˜¯å¸–å­èµ„æºï¼Œå½“å­˜åœ¨æ›´æ·±æµ…å¥—çš„æ—¶å€™ä¹Ÿä¸å®¹æ˜“æ‰©å±•ï¼Œæ‰€ä»¥æˆ‘æ¨èç¬¬äºŒç§æ–¹å¼ï¼Œä¸»ä½“åè¯ posts èµ„æºæ˜æ˜¾ï¼Œå…¶ä»–è¿‡æ»¤æ¡ä»¶ä¹Ÿæ›´å®¹æ˜“æ‰©å±•ï¼Œæ¯”å¦‚ /posts?userName=zhangsanï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨åŒæ ·çš„æ¥å£</p><h4 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h4><p>æˆ‘ä»¬çœ‹åˆ°è¿‡å¾ˆå¤šå¦‚ä¸‹ URL è®¾è®¡ï¼Œç”¨æ¥åŒºåˆ† API ç‰ˆæœ¬ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /v2/users</span><br><span class="line">GET /V1/users/12</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½æŒ‡å‘åŒæ ·çš„èµ„æº usersï¼ŒURL ä¸­ä¸ºä»€ä¹ˆè¦åŠ ç‰ˆæœ¬å·å‘¢ï¼Ÿ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œç­”æ¡ˆä¾æ—§æ²¡æœ‰ç»Ÿä¸€æ ‡å‡†ï¼Œå¦‚æœå¤šä¸ªç‰ˆæœ¬çš„APIç‰ˆæœ¬è¿”å›æ•°æ®ç»“æœç»“æ„ä¸€æ ·ï¼Œé‚£æ²¡å¿…è¦åŒºåˆ†ç‰ˆæœ¬ï¼Œå¦‚æœç»“æ„å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œè€Œä¸”è¦å‘ä¸‹å…¼å®¹ï¼Œé‚£ç‰ˆæœ¬å·æ˜¯å¾ˆå¥½çš„åŒºåˆ†æ–¹å¼ï¼Œè€Œä¸”é€šè¿‡ URL åŠ ç‰ˆæœ¬çš„æ–¹å¼å¯ä»¥æ›´å¥½çš„å‘ç°èµ„æº</p><h4 id="è¿‡æ»¤-åˆ†é¡µ-æ’åº"><a href="#è¿‡æ»¤-åˆ†é¡µ-æ’åº" class="headerlink" title="è¿‡æ»¤/åˆ†é¡µ/æ’åº"></a>è¿‡æ»¤/åˆ†é¡µ/æ’åº</h4><p>å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ä¼šç»å¸¸å¯¹è¯·æ±‚èµ„æºåšæ¡ä»¶ç­›é€‰ï¼Œåˆ†é¡µæ˜¾ç¤ºï¼Œä»¥åŠæ’åºï¼Œæˆ‘ä»¬ä¸è¦ä¸ºè¿™äº›ä¸šåŠ¡è¦æ±‚åˆ›å»ºä¸åŒæ­¥çš„ APIï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä¿æŒ URL çš„ä¿¡æ¯ç®€å•ï¼Œåªéœ€æ·»åŠ æŸ¥è¯¢æ¡ä»¶å‚æ•°æ¥å®ç°ä¸Šè¿°åŠŸèƒ½ï¼ŒåŒæ—¶ç¬¦åˆâ€æœ› URL çŸ¥æ„â€çš„åŸåˆ™</p><h5 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /users/12/posts?state=published</span><br><span class="line">GET /users/12/posts?published=true</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®ç°èµ„æºçš„è¿‡æ»¤</p><h5 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /users?pageNo=1&amp;pageSize=20</span><br></pre></td></tr></table></figure><p>ä»¥åˆ†é¡µæ–¹å¼æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œæ˜¾ç¤ºç¬¬ 2 é¡µå†…å®¹ï¼Œæ¯é¡µæ˜¾ç¤º 20 æ¡ä¿¡æ¯</p><h5 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /users?sort=score_desc</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§å­¦ç”Ÿåˆ†æ•°é™åºè¿›è¡Œæ’åº</p><p>ä¸Šè¿°æ‰€æœ‰çš„æ–¹å¼æˆ‘ä»¬éƒ½å¯ä»¥åšåˆ°â€æœ› URL çŸ¥æ„â€ï¼Œè¿™å°±æ˜¯å¥½çš„è®¾è®¡</p><h3 id="è¿”å›ç»“æœ"><a href="#è¿”å›ç»“æœ" class="headerlink" title="è¿”å›ç»“æœ"></a>è¿”å›ç»“æœ</h3><p>RESTful API çš„è¿”å›ç»“æœä¹Ÿæ˜¯è®¾è®¡ç¯èŠ‚ä¸­é‡è¦çš„ä¸€ç¯</p><h4 id="å“åº”æ•°æ®æ ¼å¼"><a href="#å“åº”æ•°æ®æ ¼å¼" class="headerlink" title="å“åº”æ•°æ®æ ¼å¼"></a>å“åº”æ•°æ®æ ¼å¼</h4><p>API è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œä¸åº”è¯¥æ˜¯çº¯æ–‡æœ¬ï¼Œè€Œåº”è¯¥æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½è¿”å›æ ‡å‡†çš„ç»“æ„åŒ–æ•°æ®ã€‚æ‰€ä»¥ï¼ŒæœåŠ¡å™¨å›åº”çš„ HTTP å¤´çš„<code>Content-Type</code>å±æ€§è¦è®¾ä¸º<code>application/json</code>ã€‚åŒæ—¶å®¢æˆ·ç«¯ä¹Ÿåº”ä½œå‡ºç›¸åº”çš„é…åˆï¼Œå®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä¹Ÿè¦æ˜ç¡®å‘Šè¯‰æœåŠ¡å™¨ï¼Œå¯ä»¥æ¥å— JSON æ ¼å¼ï¼Œå³è¯·æ±‚çš„ HTTP å¤´çš„<code>ACCEPT</code>å±æ€§ä¹Ÿè¦è®¾æˆ<code>application/json</code>ï¼Œå¤šæ¸ é“è°ƒç”¨å¯èƒ½ä¼šå­˜åœ¨ç›¸åŒèµ„æºéœ€è¦æœ‰ä¸åŒçš„ producer ç±»å‹çš„æƒ…å†µå­˜åœ¨</p><h4 id="å“åº”çŠ¶æ€ç "><a href="#å“åº”çŠ¶æ€ç " class="headerlink" title="å“åº”çŠ¶æ€ç "></a>å“åº”çŠ¶æ€ç </h4><p>å¾ˆå¤šåç«¯å¼€å‘äººå‘˜å¯èƒ½å—å¼€å‘æ¡†æ¶æ‰€é™ï¼Œæˆ–è€…è¿”å›æ•°æ®å°è£…å½¢å¼ä¸å¤Ÿå¥½ï¼Œç»å¸¸ä¼šç»™å‰ç«¯äººå‘˜ä¸æ˜¯å¾ˆå‹å¥½çš„ HTTP çŠ¶æ€ç ï¼Œæ¯”å¦‚ response æœ‰ errorï¼Œå´ç»™å‡º <code>200 HTTP.OK</code> çš„çŠ¶æ€ç  (æ˜æ˜åƒäº†ä¸‰ç¢—ç²‰ï¼Œå´ç»™ä¸¤ç¢—ç²‰çš„é’±)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"status"</span>: <span class="string">"-1"</span>,</span><br><span class="line">    <span class="attr">"result"</span>: &#123;</span><br><span class="line">        <span class="attr">"error"</span>: <span class="string">"åˆ†æ•°åº”å°äº150"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äººè¯´ï¼Œæˆ‘å·²ç»æ ‡è®°è¿”å›å†…å®¹ status æ˜¯ -1ï¼ˆè¡¨ç¤ºfailureï¼‰, ç”¨ 200 ä½œä¸ºçŠ¶æ€ç ä¹Ÿæ— å¦¨å§ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾ˆé”™è¯¯çš„è§‚å¿µï¼ŒRESTful çš„è®¾è®¡ç†å¿µä¹‹ä¸€æ˜¯ç®€å•ç›´è§‚ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå‰ç«¯å¼€å‘äººå‘˜æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æ˜¯200çš„çŠ¶æ€ç ï¼Œä½†æ˜¯é¡µé¢æ•°æ®å°±æ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œéš¾é“å‰ç«¯å¼€å‘äººå‘˜è¿˜è¦æ¯ä¸ªæ¥å£è°ƒç”¨ç‚¹å¼€çœ‹ä¸€çœ‹ï¼Œæ˜¯å“ªä¸ª status æ˜¯ -1 å¯¼è‡´çš„å—ï¼Ÿ å¾ˆæ˜¾ç„¶æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·çš„æƒ…å†µå‘ç”Ÿï¼Œæ­£ç¡®çš„åšæ³•åº”è¯¥ç±»ä¼¼è¿™æ ·çš„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"status"</span>: <span class="string">"-1"</span>,</span><br><span class="line">    <span class="attr">"result"</span>: &#123;</span><br><span class="line">        <span class="attr">"error"</span>: <span class="string">"åˆ†æ•°åº”å°äº150"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢é¡µåˆ—ä¸¾å‡ºæ¥å¸¸ç”¨çš„çŠ¶æ€ç ä»¥åŠè¡¨ç¤ºçš„å«ä¹‰ï¼š</p><h5 id="2xx-çŠ¶æ€ç "><a href="#2xx-çŠ¶æ€ç " class="headerlink" title="2xx çŠ¶æ€ç "></a>2xx çŠ¶æ€ç </h5><p>   200è¡¨ç¤ºæˆåŠŸï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºçš„æ›´åŠ ç²¾ç¡®</p><blockquote><ul><li><code>GET: 200 OK</code> è¯·æ±‚æˆåŠŸ</li><li><code>POST: 201 Created</code> åˆ›å»ºæˆåŠŸ</li><li><code>PUT: 200 OK</code> æ›´æ–°æˆåŠŸ</li><li><code>DELETE: 204 No Content</code> æ‰¾ä¸åˆ°è¦åˆ é™¤çš„å†…å®¹</li></ul></blockquote><p>   ä½¿ç”¨çŠ¶æ€ç  202 æœ‰æ—¶å€™ä¼šæ¯” ä½¿ç”¨çŠ¶æ€å•Šå— 201 æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼ŒçŠ¶æ€ç  202 çš„æ„æ€æ˜¯ï¼šæœåŠ¡ç«¯å·²æ¥æ”¶åˆ°äº†è¯·æ±‚ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•èµ„æºï¼Œä½†ç»“æœä¸€åˆ‡æ­£å¸¸ã€‚ æ¯”å¦‚ï¼š</p><blockquote><ul><li>å¼‚æ­¥æ“ä½œï¼šæœåŠ¡å™¨å·²æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¿˜æœªå¤„ç†ï¼Œä½†æ˜¯ä¼šåœ¨æœªæ¥å¤„ç†</li><li>èµ„æºå·²ç»å­˜åœ¨ï¼Œæ²¡æœ‰åˆ›å»ºæ–°çš„èµ„æº ï¼ˆæœ‰äº›ä¸šåŠ¡å¯èƒ½ä¼šè¿”å›é”™è¯¯ä¿¡æ¯â€æ‚¨åˆ›å»ºçš„æ•°æ®å·²å­˜åœ¨â€ï¼Œæ‰€ä»¥è¿™ç§æƒ…æ™¯æ²¡æœ‰æ˜ç¡®çš„è§„å®šï¼Œç¬¦åˆè‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚å³å¯ï¼‰</li></ul></blockquote><h5 id="4xx-çŠ¶æ€ç "><a href="#4xx-çŠ¶æ€ç " class="headerlink" title="4xx çŠ¶æ€ç "></a>4xx çŠ¶æ€ç </h5><p>   4xx çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯çš„é”™è¯¯ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><blockquote><ul><li><code>400 Bad Request</code>ï¼šæœåŠ¡å™¨ä¸ç†è§£å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæœªåšä»»ä½•å¤„ç†</li><li><code>401 Unauthorized</code>ï¼šç”¨æˆ·æœªæä¾›èº«ä»½éªŒè¯å‡­æ®ï¼Œæˆ–è€…æ²¡æœ‰é€šè¿‡èº«ä»½éªŒè¯</li><li><code>403 Forbidden</code>ï¼šç”¨æˆ·é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œä½†æ˜¯ä¸å…·æœ‰è®¿é—®èµ„æºæ‰€éœ€çš„æƒé™</li><li><code>404 Not Found</code>ï¼šæ‰€è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼Œæˆ–ä¸å¯ç”¨</li><li><code>415 Unsupported Media Type</code>ï¼šå®¢æˆ·ç«¯è¦æ±‚çš„è¿”å›æ ¼å¼ä¸æ”¯æŒã€‚æ¯”å¦‚ï¼ŒAPI åªèƒ½è¿”å› JSON æ ¼å¼ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¦æ±‚è¿”å› XML æ ¼å¼</li></ul></blockquote><p>   è¿™é‡Œè¦æ³¨æ„çŠ¶æ€ç  401 å’Œ 403 çš„åŒºåˆ«</p><h5 id="5xx-çŠ¶æ€ç "><a href="#5xx-çŠ¶æ€ç " class="headerlink" title="5xx çŠ¶æ€ç "></a>5xx çŠ¶æ€ç </h5><p>   5xx çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡ç«¯é”™è¯¯ï¼Œé€šå¸¸åªä¼šç”¨åˆ°ä¸¤ä¸ªï¼š</p><blockquote><ul><li><code>500 Internal Server Error</code>ï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰æ•ˆï¼ŒæœåŠ¡å™¨å¤„ç†æ—¶å‘ç”Ÿäº†æ„å¤–</li><li><code>503 Service Unavailable</code>ï¼šæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºç½‘ç«™ç»´æŠ¤çŠ¶æ€</li></ul></blockquote><h4 id="æ— çŠ¶æ€"><a href="#æ— çŠ¶æ€" class="headerlink" title="æ— çŠ¶æ€"></a>æ— çŠ¶æ€</h4><p>è¿‡å»å¼€å‘äººå‘˜é€šå¸¸ä¼šå°†æ´»åŠ¨çš„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡ç«¯çš„ session ä¸­ï¼Œ è¿™ç§å½¢å¼å¾ˆæ˜¾ç„¶ä¸é€‚ç”¨äºç°åœ¨åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JWT (JSON Web Token) å¦‚ OAuth2 æ¥å®ç°ï¼Œè¿™æ ·æ¯æ¬¡åœ¨ Httpheader ä¸­æ·»åŠ  token æ¥åšéªŒè¯å³å¯</p><h4 id="API-æ–‡æ¡£"><a href="#API-æ–‡æ¡£" class="headerlink" title="API æ–‡æ¡£"></a>API æ–‡æ¡£</h4><p>Swaggeræ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å·¥å…·æ¥ç”¨æ¥è®°å½•ä¸å‘ˆç° REST APIï¼Œå®ƒæä¾›äº†ä¸€ç§æ¢ç´¢ç‰¹å®š API ä½¿ç”¨çš„æ–¹æ³•ï¼Œå› æ­¤å…è®¸å¼€å‘äººå‘˜ç†è§£åº•å±‚çš„è¯­ä¹‰è¡Œä¸ºã€‚ è¿™æ˜¯ä¸€ç§ä½¿ç”¨æ³¨é‡Šæ·»åŠ æ–‡æ¡£çš„å£°æ˜æ€§æ–¹æ³•ï¼Œå®ƒè¿›ä¸€æ­¥ç”Ÿæˆæè¿° API åŠå…¶ç”¨æ³•çš„ JSONï¼Œå¯ä»¥å®æ—¶åº”å¯¹ API çš„æ›´æ–°ï¼Œå…·ä½“è¯·å‚è€ƒ <a href="https://swagger.io/" target="_blank" rel="noopener">Swagger å®˜ç½‘</a> , åŒæ—¶ä½¿ç”¨ Spring Boot çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥å¾ˆè½»æ¾çš„é›†æˆ Swaggerï¼Œåªéœ€å¼•å…¥<a href="https://github.com/SpringForAll/spring-boot-starter-swagger" target="_blank" rel="noopener">Swagger Starter</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spring4all<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="HATEOAS"><a href="#HATEOAS" class="headerlink" title="HATEOAS"></a>HATEOAS</h4><p>HATEOAS (Hypermedia As Transfer Engine Of Application State), API çš„ä½¿ç”¨è€…æœªå¿…çŸ¥é“ï¼ŒURL æ˜¯æ€ä¹ˆè®¾è®¡çš„ã€‚ä¸€ä¸ªè§£å†³æ–¹æ³•å°±æ˜¯ï¼Œåœ¨å›åº”ä¸­ï¼Œç»™å‡ºç›¸å…³é“¾æ¥ï¼Œä¾¿äºä¸‹ä¸€æ­¥æ“ä½œã€‚è¿™æ ·çš„è¯ï¼Œç”¨æˆ·åªè¦è®°ä½ä¸€ä¸ª URLï¼Œå°±å¯ä»¥å‘ç°å…¶ä»–çš„ URLã€‚è¿™ç§æ–¹æ³•å«åš HATEOAS , ä¸¾ä¸ªä¾‹å­ï¼Œåˆ—è¡¨é¡µæ•°æ®é€šå¸¸ä¼šæœ‰æŸ¥çœ‹æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬åœ¨è¿”å›åˆ—è¡¨é¡µçš„æ•°æ®çš„æ—¶å€™åŒæ ·è¿”å›å¦‚ä½•æ“ä½œæŸ¥çœ‹å…·ä½“æ•°æ®è¯¦æƒ…çš„ API æ¥å£ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"status"</span>: <span class="string">"-1"</span>,</span><br><span class="line">    <span class="attr">"result"</span>: [&#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"zhangsan"</span>,</span><br><span class="line">      <span class="attr">"links"</span>:[</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://localhost:8080/user/&#123;id&#125;"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Spring æ¡†æ¶çš„å°ä¼™ä¼´å¯ä»¥å¿«é€Ÿçš„ä½“éªŒä¸€ä¸‹è¿™ç§æ–¹å¼ï¼ŒSpring å®˜ç½‘é¡¹ç›® <a href="https://spring.io/projects/spring-hateoas" target="_blank" rel="noopener">Spring HATEOAS</a> , ä¼šå¿«é€Ÿçš„å°†å‚æ•°éƒ½åšæ›¿æ¢, å°†æŸ¥çœ‹ API URL ä¸­çš„ id ç›´æ¥æ›¿æ¢æˆ 1ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"status"</span>: <span class="string">"-1"</span>,</span><br><span class="line">    <span class="attr">"result"</span>: [&#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"zhangsan"</span>,</span><br><span class="line">      <span class="attr">"links"</span>:[</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://localhost:8080/user/1"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æå‡æ•ˆç‡å·¥å…·"><a href="#æå‡æ•ˆç‡å·¥å…·" class="headerlink" title="æå‡æ•ˆç‡å·¥å…·"></a>æå‡æ•ˆç‡å·¥å…·</h2><h3 id="RestfulToolkit"><a href="#RestfulToolkit" class="headerlink" title="RestfulToolkit"></a>RestfulToolkit</h3><p>åç«¯å¼€å‘äººå‘˜å¯ä»¥å®‰è£… IntellJ idea æ’ä»¶ <a href="https://plugins.jetbrains.com/plugin/10292-restfultoolkit" target="_blank" rel="noopener">RestfulToolkit</a>, Mac ç¯å¢ƒä½¿ç”¨å¿«æ·é”® <code>CMD + \</code> è¾“å…¥å…³é”®å­—å¿«é€Ÿå®šä½åˆ° API ä½ç½®</p><p><img src="https://plugins.jetbrains.com/files/10292/screenshot_17681.png" alt="å®˜ç½‘æˆªå›¾"></p><p>åŒæ—¶åœ¨å³ä¾§å·¥å…·æ æ‰“å¼€ APIï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ demoData è¯·æ±‚å‚æ•°ï¼Œå®ç°å¿«é€Ÿè°ƒç”¨æµ‹è¯•ï¼š</p><p><img src="https://plugins.jetbrains.com/files/10292/screenshot_17679.png" alt="å‚æ•°"></p><h3 id="JSON-Viewer"><a href="#JSON-Viewer" class="headerlink" title="JSON-Viewer"></a>JSON-Viewer</h3><p>JSON-Viewer  æ˜¯ Chrome æµè§ˆå™¨çš„æ’ä»¶ï¼Œç”¨äºå¿«é€Ÿè§£æåŠæ ¼å¼åŒ– json å†…å®¹ï¼Œåœ¨ Chrome omniboxï¼ˆå¤šåŠŸèƒ½è¾“å…¥æ¡†ï¼‰è¾“å…¥<code>json-viewer + TAB</code> ï¼Œå°† json å†…å®¹æ‹·è´è¿›å»ï¼Œç„¶åè¾“å…¥å›è½¦é”®ï¼Œå°†çœ‹åˆ°ç»“æ„æ¸…æ™°çš„ json æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜</p><p><img src="http://ww1.sinaimg.cn/large/8dc363e6ly1g39u1u0er6j21v80tyadz.jpg" alt=""></p><p>å¦å¤–ï¼Œå‰ç«¯äººå‘˜æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒåŒå‡»è¯·æ±‚é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å°† response ä¸­çš„ json æ•°æ®è§£æå‡ºæ¥ï¼Œéå¸¸æ–¹ä¾¿</p><h3 id="Postman"><a href="#Postman" class="headerlink" title="Postman"></a>Postman</h3><p>Postman åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œ æœç´¢ <code>Postman è‡ªå®šä¹‰ç¯å¢ƒå˜é‡</code>ï¼Œä¼šæ‰“å¼€æ–°ä¸–ç•Œçš„å¤§é—¨</p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>å¦‚ä½•è®¾è®¡å‡ºæœ€å¥½çš„ RESTful API æ°¸è¿œä¸ä¼šæœ‰ç»“è®ºï¼Œè®¾è®¡å‡ºé«˜å¯ç”¨ï¼Œå›¢é˜Ÿè®¤å¯ï¼Œç®€å•æ¸…æ™°æ˜äº†çš„ RESTful API å°±æ˜¯å¥½çš„ã€‚</p><p>æ¬¢è¿äº¤æµä½ ä»¬åœ¨å›¢é˜Ÿä¸­æ˜¯å¦‚ä½•è®¾è®¡ RESTful API çš„ï¼Œé‡åˆ°äº†å“ªäº›é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³å’Œè§„èŒƒçš„</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> å®‰å…¨-åè®®-è§„èŒƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RESTful </tag>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Excelçš„å…¬å¼ä½¿ç”¨</title>
      <link href="//p/excel-formula.html"/>
      <url>//p/excel-formula.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘åœ¨åšåŸºç¡€æ•°æ®çš„æ•´ç†ï¼Œæ•°æ®å­˜æ”¾åœ¨ Word è¡¨æ ¼ä¸­ï¼Œè¦å°†å¤§é‡çš„æ•°æ®æ•´ç†å¥½å¹¶å¯¼å…¥åˆ°æ•°æ®åº“ä¸­ç€å®éœ€è¦è´¹äº›åŠ›æ°”ï¼Œäºæ˜¯éœ€è¦ç¬¨æ–¹æ³•å’Œå·§æ–¹æ³•ä¸€èµ·ç”¨</p><h3 id="æ•´ç†è¿‡ç¨‹"><a href="#æ•´ç†è¿‡ç¨‹" class="headerlink" title="æ•´ç†è¿‡ç¨‹"></a>æ•´ç†è¿‡ç¨‹</h3><p>é¦–å…ˆåº”ç”¨ç¬¨æ–¹æ³•ï¼Œå°† Word ä¸­çš„æ•°æ®è¡¨æ ¼æ‹·è´åˆ° Excel ä¸­ï¼Œè²Œä¼¼è¿™æ˜¯å¿…é¡»çš„ï¼Œç”±äºæ‹·è´è¿‡æ¥çš„è¡¨æ ¼æœ‰åˆå¹¶å•å…ƒæ ¼çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°† Excel ä¸­çš„è¡¨æ ¼æ ‡å‡†åŒ–</p><h3 id="Excelé€šè¿‡å…¬å¼æ‹¼æ¥å­—ç¬¦ä¸²æ¢è¡Œ"><a href="#Excelé€šè¿‡å…¬å¼æ‹¼æ¥å­—ç¬¦ä¸²æ¢è¡Œ" class="headerlink" title="Excelé€šè¿‡å…¬å¼æ‹¼æ¥å­—ç¬¦ä¸²æ¢è¡Œ"></a>Excelé€šè¿‡å…¬å¼æ‹¼æ¥å­—ç¬¦ä¸²æ¢è¡Œ</h3><p>æˆ‘ä»¬é€šå¸¸éƒ½ä¼šé€šè¿‡Excelå…¬å¼<strong>=CONCATENATE(Text1,[Text2])</strong>æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå½“æˆ‘ä»¬éœ€è¦æ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸­éœ€è¦æ¢è¡Œæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>CHAR(10)</strong>æ¥å®Œæˆæ‹¼æ¥æ¢è¡Œç¬¦ï¼Œè¯·çœ‹å¦‚ä¸‹ä¾‹å­</p><pre><code>=CONCATENATE(&quot;hello&quot;,CHAR(10),&quot;world&quot;)</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code>helloworld</code></pre><p><strong>NOTE:</strong> ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²å…¬å¼çš„å•å…ƒæ ¼è¯·è®¾ç½®ä¸º<strong>å¸¸è§„</strong>ï¼Œä¸è¦æ˜¯è‡ªåŠ¨æ¢è¡Œ.</p><ol><li><p>å–æ¶ˆåˆå¹¶å•å…ƒæ ¼</p><p>å°† Excel å…¨éƒ¨é€‰ä¸­ï¼Œç„¶åç‚¹å‡»å–æ¶ˆå•å…ƒæ ¼</p><img itemprop="url image" src="/uploads/May-16-2019 11-17-29.gif" /></li><li><p>å°†ç©ºå•å…ƒæ ¼è¿›è¡Œå­—æ®µçš„å¡«å……</p><p>æˆ‘ä»¬çœ‹åˆ°æ‹†åˆ†åçš„å•å…ƒæ ¼å¥½å¤šéƒ½æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬éœ€è¦å°†ç©ºçš„å•å…ƒæ ¼å¡«å……ä¸ºå®ƒä¸Šé¢ä¸€è¡Œçš„æ•°æ®</p><ul><li>é€‰ä¸­å¾…å¤„ç†çš„å•å…ƒæ ¼</li><li>æŒ‰F5</li><li>åœ¨å¼¹å‡ºæ¡†çš„ä½ç½®é€‰æ‹©ç©ºå€¼é€‰é¡¹</li><li>é”®ç›˜è¾“å…¥ç­‰äºå·â€=â€ï¼Œç„¶åæ•²å‡»å‘ä¸Šæ–¹å‘é”®</li><li>Ctrl + Enter ç»„åˆå®Œæˆ</li></ul><img itemprop="url image" src="/uploads/May-16-2019 11-20-29.gif" /></li><li><p>ä¿®æ”¹ Excel çš„é»˜è®¤è¯­è¨€</p><p>æˆ‘ç”¨çš„Mac è‹±æ–‡ç‰ˆï¼Œæ‰“å¼€ Excel æ²¡æœ‰ç±»ä¼¼ LENB() è¿™æ ·çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘éœ€è¦å°†è¯­è¨€å°±æ”¹ä¸ºä¸­æ–‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ Excel è¯­è¨€</span></span><br><span class="line">defaults write com.microsoft.Excel AppleLanguages '("zh-tw")'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ Word è¯­è¨€</span></span><br><span class="line">defaults write com.microsoft.Word AppleLanguages '("zh-tw")'</span><br></pre></td></tr></table></figure></li><li><p>æ•°å­—ä¸æ±‰å­—çš„æ‹†åˆ†</p><p>æ‹·è´è¿‡æ¥çš„æ•°æ®ï¼Œéœ€è¦åšK-V çš„æ˜ å°„ï¼Œå°†ä¸€æ®µæ–‡å­—ä¸­çš„æ•°å­—æå–å‡ºæ¥ä½œä¸º keyï¼Œ å°†æ–‡æœ¬ä¸­çš„æ±‰å­—æå–å‡ºæ¥ä½œä¸º Valueï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°ä¸¤ç»„å…¬å¼ï¼š</p><ul><li><p>LEFT(å•å…ƒæ ¼, length) / RIGHT(å•å…ƒæ ¼, length)</p><blockquote><p>LEFT: ä»å•å…ƒæ ¼å†…å®¹å¼€å§‹ä½ç½®æˆªå–æŒ‡å®šé•¿åº¦å†…å®¹ï¼›</p><p>RIGHT: ä»å•å…ƒæ ¼å†…å®¹æœ«å°¾ä½ç½®æˆªå–æŒ‡å®šé•¿åº¦å†…å®¹ï¼›</p></blockquote></li><li><p>LEN(å•å…ƒæ ¼) / LENB(å•å…ƒæ ¼)</p><blockquote><p>LENæ˜¯è¿”å›å­—ç¬¦ä¸²çš„<strong>å­—ç¬¦</strong>æ•°;</p><p>LENBæ˜¯è¿”å›å­—ç¬¦ä¸²çš„<strong>å­—èŠ‚</strong>æ•°;</p><p><em>æ•°å­—ã€å­—æ¯ã€è‹±æ–‡ã€æ ‡ç‚¹ç¬¦å·ï¼ˆåŠè§’çŠ¶æ€ï¼‰éƒ½æ˜¯æŒ‰1è®¡ç®—çš„ï¼Œæ±‰å­—ã€å…¨è§’çŠ¶æ€ä¸‹çš„æ ‡ç‚¹ç¬¦å·ï¼Œæ¯ä¸ªå­—ç¬¦æŒ‰2è®¡ç®—</em></p></blockquote></li></ul><img itemprop="url image" src="/uploads/May-16-2019 11-27-17.gif" /></li><li><p>é˜¿æ‹‰ä¼¯æ•°å­—è½¬ç½—é©¬æ•°å­—</p><p>åªéœ€è¦åº”ç”¨å…¬å¼ï¼š<strong>= ROMAN(A16)</strong></p><img itemprop="url image" src="/uploads/May-16-2019 11-48-53.gif" /></li><li><p>ç½—é©¬æ•°å­—è½¬é˜¿æ‹‰ä¼¯æ•°å­—</p><p>åŒæ ·åº”ç”¨å…¬å¼ï¼š<strong>=MATCH(B16,INDEX(ROMAN(ROW(INDIRECT(â€œ1:4000â€))),0),0)</strong></p><img itemprop="url image" src="/uploads/May-16-2019 11-52-57.gif" /></li></ol><p>ä»¥ä¸Šå°±æ˜¯è¿™æ¬¡æ•°æ®æå–ç”¨åˆ°çš„ä¸€äº›å…¬å¼</p><h3 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h3><p>åœ¨æ­¤å¤„é™„ä¸Š office çš„å„ç§è¯­è¨€å­—å…¸ç <br><img itemprop="url image" src="/uploads/Xnip2019-05-13_16-19-16.jpg" /></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Excel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒäº²å§”æ´¾æ¨¡å‹</title>
      <link href="//p/java-parents-delegation-model.html"/>
      <url>//p/java-parents-delegation-model.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h2><p>åœ¨ä»‹ç»è¿™ä¸ªJavaæŠ€æœ¯ç‚¹ä¹‹å‰ï¼Œå…ˆè¯•ç€æ€è€ƒä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½å®šä¹‰åŒåçš„ <strong>String</strong> çš„ java æ–‡ä»¶ï¼Ÿ</p></li><li><p>å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç±»çš„åŠ è½½ä¸ºä»€ä¹ˆä¸ä¼šå‡ºç°é‡å¤åŠ è½½çš„æƒ…å†µï¼Ÿ</p></li><li><p>ä¸‹é¢ä»£ç ï¼Œè™šæ‹Ÿæœºæ˜¯æ€æ ·åˆå§‹åŒ–æ³¨å†Œ Mysql è¿æ¥é©±åŠ¨(Driver)çš„ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection conn= DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/mydb?characterEncoding=GBK&quot;, &quot;root&quot;, &quot;000000&quot;);</span><br></pre></td></tr></table></figure></li><li><p>çƒ­éƒ¨ç½²çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p></li></ol><p>æƒ³ç†è§£ä»¥ä¸Šå‡ ä¸ªé—®é¢˜çš„å‰ææ˜¯äº†è§£ç±»åŠ è½½æ—¶æœºä¸è¿‡ç¨‹, è¿™ç¯‡æ–‡ç« å°†ä¼šä»¥éå¸¸è¯¦ç»†çš„è§£è¯»æ–¹å¼æ¥å›ç­”ä»¥ä¸Šå‡ ä¸ªé—®é¢˜</p><a id="more"></a><h3 id="ç±»åŠ è½½æ—¶æœºä¸è¿‡ç¨‹"><a href="#ç±»åŠ è½½æ—¶æœºä¸è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½æ—¶æœºä¸è¿‡ç¨‹"></a>ç±»åŠ è½½æ—¶æœºä¸è¿‡ç¨‹</h3><p>ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡(Preparation)ã€è§£æ(Resolution)ã€åˆå§‹åŒ–(Initialization)ã€ä½¿ç”¨(Using)å’Œå¸è½½(Unloading)7ä¸ªé˜¶æ®µã€‚å…¶ä¸­å‡†å¤‡ã€éªŒè¯ã€è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚å¦‚å›¾æ‰€ç¤º</p><p><img src="http://ww1.sinaimg.cn/large/8dc363e6ly1g2fwal0c83j20hf06774b.jpg" alt=""></p><p>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™5ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼šå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®šï¼‰</p><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><p>åœ¨åŠ è½½é˜¶æ®µï¼ˆå¯ä»¥å‚è€ƒjava.lang.ClassLoaderçš„loadClass()æ–¹æ³•ï¼‰ï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹3ä»¶äº‹æƒ…ï¼š</p><ol><li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆå¹¶æ²¡æœ‰æŒ‡æ˜è¦ä»ä¸€ä¸ªClassæ–‡ä»¶ä¸­è·å–ï¼Œå¯ä»¥ä»å…¶ä»–æ¸ é“ï¼Œè­¬å¦‚ï¼šç½‘ç»œã€åŠ¨æ€ç”Ÿæˆã€æ•°æ®åº“ç­‰ï¼‰ï¼›</li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼›</li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ï¼›</li></ol><p>åŠ è½½é˜¶æ®µå’Œè¿æ¥é˜¶æ®µï¼ˆLinkingï¼‰çš„éƒ¨åˆ†å†…å®¹ï¼ˆå¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œï¼‰æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ï¼Œä½†è¿™äº›å¤¹åœ¨åŠ è½½é˜¶æ®µä¹‹ä¸­è¿›è¡Œçš„åŠ¨ä½œï¼Œä»ç„¶å±äºè¿æ¥é˜¶æ®µçš„å†…å®¹ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µçš„å¼€å§‹æ—¶é—´ä»ç„¶ä¿æŒç€å›ºå®šçš„å…ˆåé¡ºåºã€‚</p><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p>éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚<br>éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š</p><ol><li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥é­”æœ¯0xCAFEBABEå¼€å¤´ï¼ˆå½“classæ–‡ä»¶ä»¥äºŒè¿›åˆ¶å½¢å¼æ‰“å¼€ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶å¤´ï¼Œcafebabeï¼‰ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚</li><li>å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ã€‚</li><li>å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚</li><li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚</li></ol><p>éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨-Xverifynoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨å †ä¸­ã€‚å…¶æ¬¡ï¼Œè¿™é‡Œæ‰€è¯´çš„åˆå§‹å€¼<strong>é€šå¸¸æƒ…å†µ</strong>ä¸‹æ˜¯æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œå‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0è€Œä¸æ˜¯123.å› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º123çš„putstaticæŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨()æ–¹æ³•ä¹‹ä¸­ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º123çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> value=<span class="number">123</span>;</span><br></pre></td></tr></table></figure><p>æœ‰<strong>é€šå¸¸æƒ…å†µ</strong>å°±æœ‰<strong>ç‰¹æ®Šæƒ…å†µ</strong>ï¼Œè¿™é‡Œçš„ç‰¹æ®Šæ˜¯æŒ‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“ç±»å­—æ®µçš„å­—æ®µå±æ€§æ˜¯ConstantValueæ—¶ï¼Œä¼šåœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–ä¸ºæŒ‡å®šçš„å€¼ï¼Œæ‰€ä»¥æ ‡æ³¨ä¸ºfinalä¹‹åï¼Œvalueçš„å€¼åœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–ä¸º123è€Œé0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> value=<span class="number">123</span>;</span><br></pre></td></tr></table></figure><h4 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h4><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚</p><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åœ¨ä»‹ç»åˆå§‹åŒ–æ—¶ï¼Œè¦å…ˆä»‹ç»ä¸¤ä¸ªæ–¹æ³•ï¼š<code>&lt;clinit&gt;</code> å’Œ <code>&lt;init&gt;</code> :</p><blockquote><p>åœ¨ç¼–è¯‘ç”Ÿæˆclassæ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨äº§ç”Ÿä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ç±»çš„åˆå§‹åŒ–æ–¹æ³•<clinit>, å¦ä¸€ä¸ªæ˜¯å®ä¾‹çš„åˆå§‹åŒ–æ–¹æ³•<init></p><ul><li><p><code>clinit&gt;</code>ï¼šåœ¨jvmç¬¬ä¸€æ¬¡åŠ è½½classæ–‡ä»¶æ—¶è°ƒç”¨ï¼ŒåŒ…æ‹¬é™æ€å˜é‡åˆå§‹åŒ–è¯­å¥å’Œé™æ€å—çš„æ‰§è¡Œ</p></li><li><p><code>&lt;init&gt;</code>: åœ¨å®ä¾‹åˆ›å»ºå‡ºæ¥çš„æ—¶å€™è°ƒç”¨ï¼ŒåŒ…æ‹¬è°ƒç”¨newæ“ä½œç¬¦ï¼›è°ƒç”¨ Class æˆ– Java.lang.reflect.Constructor å¯¹è±¡çš„newInstance()æ–¹æ³•ï¼›è°ƒç”¨ä»»ä½•ç°æœ‰å¯¹è±¡çš„clone()æ–¹æ³•ï¼›é€šè¿‡ java.io.ObjectInputStream ç±»çš„getObject() æ–¹æ³•ååºåˆ—åŒ–ã€‚</p></li></ul></blockquote><p>ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaç¨‹åºä»£ç ã€‚åœ¨å‡†å¤‡æç«¯ï¼Œå˜é‡å·²ç»ä»˜è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œåˆ™æ ¹æ®ç¨‹åºçŒ¿é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»ç®¡è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºï¼Œæˆ–è€…è¯´ï¼šåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨<code>&lt;clinit&gt;()</code>æ–¹æ³•çš„è¿‡ç¨‹.</p><p><code>&lt;clinit&gt;()</code>æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å— static{} ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰€å†³å®šçš„ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        i=<span class="number">0</span>;</span><br><span class="line">        System.out.println(i); <span class="comment">//è¿™å¥ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼šIllegal forward reference (ä¸åˆæ³•çš„å‘å‰å¼•ç”¨)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå»æ‰æŠ¥é”™çš„é‚£å¥ï¼Œæ”¹æˆä¸‹é¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        i=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">// System.out.println(i); //è¿™å¥ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼šIllegal forward reference (ä¸åˆæ³•çš„å‘å‰å¼•ç”¨)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š1</p><p>ä¸ºä»€ä¹ˆè¾“å‡ºç»“æœæ˜¯1ï¼Œåœ¨å‡†å¤‡é˜¶æ®µæˆ‘ä»¬çŸ¥é“ i=0ï¼Œç„¶åç±»åˆå§‹åŒ–é˜¶æ®µæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œé¦–å…ˆæ‰§è¡Œ static å—ä¸­çš„ i=0,æ¥ç€æ‰§è¡Œ staticèµ‹å€¼æ“ä½œi=1, æœ€ååœ¨ main æ–¹æ³•ä¸­è·å– i çš„å€¼ä¸º1</p><blockquote><ul><li><p><code>&lt;clinit&gt;</code>()æ–¹æ³•ä¸å®ä¾‹æ„é€ å™¨<code>&lt;init&gt;()</code>æ–¹æ³•ä¸åŒï¼Œå®ƒä¸éœ€è¦æ˜¾ç¤ºåœ°è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»<code>&lt;init&gt;()</code>æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•</p></li><li><p>ç”±äºçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—è¦ä¼˜å…ˆäºå­ç±»çš„å˜é‡èµ‹å€¼æ“ä½œã€‚</p></li><li><p><code>&lt;clinit&gt;()</code>æ–¹æ³•å¯¹äºç±»æˆ–è€…æ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿäº§<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p></li><li><p>æ¥å£ä¸­ä¸èƒ½ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆ<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚ä½†æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚åªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šåˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p></li><li><p>è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®çš„åŠ é”ã€åŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ<code>&lt;clinit&gt;()</code>æ–¹æ³•å®Œæ¯•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­æœ‰è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è¿™ç§é˜»å¡å¾€å¾€æ˜¯éšè—çš„ã€‚</p></li></ul></blockquote><p>è®©æˆ‘ä»¬æ¥éªŒè¯ä¸Šé¢çš„åŠ è½½è§„åˆ™</p><ol><li><p>è™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»<code>&lt;init&gt;()</code>æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"SSClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuperClass</span> <span class="keyword">extends</span> <span class="title">SSClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"SuperClass init!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> value = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SuperClass</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init SuperClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubClass</span> <span class="keyword">extends</span> <span class="title">SuperClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"SubClass init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubClass</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init SubClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotInitialization</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(SubClass.value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SSClass</span><br><span class="line">SuperClass init!</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–(æˆ‘çš„ç†è§£æ˜¯æ•°ç»„çš„çˆ¶ç±»æ˜¯Object)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotInitialization</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SuperClass[] sca = <span class="keyword">new</span> SuperClass[<span class="number">10</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼šæ— </p></li><li><p>å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"ConstClass init!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String HELLOWORLD = <span class="string">"hello world"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotInitialization</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(ConstClass.HELLOWORLD);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure></li></ol><p><code>éªŒè¯å°ç»“</code></p><p>è™šæ‹Ÿæœºè§„èŒƒä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰5ä¸­æƒ…å†µï¼ˆjdk1.7ï¼‰å¿…é¡»å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼ˆè€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š</p><ol><li>é‡åˆ° new, getstatic, putstatic, invokestatic è¿™äº›å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ç”Ÿæˆè¿™4æ¡æŒ‡ä»¤çš„æœ€å¸¸è§çš„Javaä»£ç åœºæ™¯æ˜¯ï¼šä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€å·²åœ¨ç¼–è¯‘å™¨æŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ï¼Œä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚</li><li>ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</li><li>å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</li><li>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚</li><li>å½“ä½¿ç”¨jdk1.7åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœREF_getstatic, REF_putstatic, REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆå‡ºè§¦å‘å…¶åˆå§‹åŒ–ã€‚</li></ol><p>æœ‰äº†è¿™ä¸ªåŠ è½½è§„åˆ™çš„å°è±¡ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹å°±å¾ˆå¥½ç†è§£äº†ï¼Œåˆ«ç€æ€¥ï¼Œç»§ç»­å‘ä¸‹çœ‹, ä½ ä¼šå‘ç°ä½ çš„ç†è§£å±‚é¢æé«˜äº†</p><h3 id="åŒäº²å§”æ´¾æ¨¡å‹-1"><a href="#åŒäº²å§”æ´¾æ¨¡å‹-1" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h3><p>åˆšçœ‹åˆ°è¿™ä¸ªè¯æ±‡çš„æ—¶å€™æˆ‘æ˜¯å®Œå…¨æ‡µæ‡‚çš„çŠ¶æ€ï¼Œå…¶å®å°±æ˜¯å®šä¹‰äº† JVM å¯åŠ¨çš„æ—¶å€™ç±»çš„åŠ è½½è§„åˆ™, å¤§å®¶è¦æŒ‰è§„çŸ©åŠäº‹ï¼Œå¥½åŠäº‹ï¼Œæ¥çœ‹ä¸‹å›¾ï¼š</p><p><img src="http://ww1.sinaimg.cn/large/8dc363e6ly1g2fwftq83rj20jg0dz3z6.jpg" alt=""></p><p>æ‰€è°“åŒäº²å§”æ´¾æ˜¯æŒ‡æ¯æ¬¡æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå…ˆå°†è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å®Œæˆï¼ˆæ‰€æœ‰åŠ è½½è¯·æ±‚æœ€ç»ˆä¼šå§”æ´¾åˆ°é¡¶å±‚çš„Bootstrap ClassLoaderåŠ è½½å™¨ä¸­ï¼‰ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½ï¼ˆè¯¥åŠ è½½å™¨çš„<strong>æœç´¢èŒƒå›´</strong>ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼‰ï¼Œå­ç±»å°è¯•è‡ªå·±åŠ è½½ï¼Œ å¦‚æœéƒ½æ²¡åŠ è½½åˆ°ï¼Œåˆ™ä¼šæŠ›å‡º ClassNotFoundException å¼‚å¸¸ï¼Œ çœ‹åˆ°è¿™é‡Œå…¶å®å°±è§£é‡Šäº†æ–‡ç« å¼€å¤´æå‡ºçš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œçˆ¶åŠ è½½å™¨å·²ç»åŠ è½½äº†JDK ä¸­çš„ String.class æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å®šä¹‰åŒåçš„ String java æ–‡ä»¶ã€‚</p><p><em>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„è§„çŸ©è®¾å®šï¼Ÿ</em></p><blockquote><p>å› ä¸ºè¿™æ ·å¯ä»¥é¿å…é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰å¿…è¦ ClassLoader å†åŠ è½½ä¸€æ¬¡ã€‚è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œæˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ç§å§”æ‰˜æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥éšæ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„Stringæ¥åŠ¨æ€æ›¿ä»£javaæ ¸å¿ƒapiä¸­å®šä¹‰çš„ç±»å‹ï¼Œè¿™æ ·ä¼šå­˜åœ¨éå¸¸å¤§çš„å®‰å…¨éšæ‚£ï¼Œè€ŒåŒäº²å§”æ‰˜çš„æ–¹å¼ï¼Œå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œå› ä¸ºString å·²ç»åœ¨å¯åŠ¨æ—¶å°±è¢«å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrcp ClassLoaderï¼‰åŠ è½½ï¼Œæ‰€ä»¥ç”¨æˆ·è‡ªå®šä¹‰çš„ClassLoaderæ°¸è¿œä¹Ÿæ— æ³•åŠ è½½ä¸€ä¸ªè‡ªå·±å†™çš„Stringï¼Œé™¤éä½ æ”¹å˜ JDK ä¸­ ClassLoader æœç´¢ç±»çš„é»˜è®¤ç®—æ³•ã€‚</p></blockquote><p>æˆ‘ä»¬å‘ç°é™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootStrap ClassLoaderï¼‰ï¼Œæ¯ä¸ªç±»éƒ½æœ‰å…¶â€çˆ¶ç±»â€åŠ è½½å™¨</p><blockquote><p>âš ï¸ å…¶å®è¿™é‡Œçš„çˆ¶å­å…³ç³»æ˜¯ç»„åˆæ¨¡å¼ï¼Œä¸æ˜¯ç»§æ‰¿å…³ç³»æ¥å®ç°</p></blockquote><p><img src="http://ww1.sinaimg.cn/large/8dc363e6ly1g2fys9eto8j20cc087wft.jpg" alt=""></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ç±» <strong>AppClassLoader</strong> å’Œ <strong>ExtClassLoader</strong> éƒ½ç»§æ‰¿ <strong>URLClassLoader</strong>ï¼Œ è€Œ <strong>URLClassLoader</strong> åˆç»§æ‰¿</p><p><strong>ClassLoader</strong>ï¼Œ åœ¨ <strong>ClassLoader</strong> ä¸­æœ‰ä¸€ä¸ªå±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// The parent class loader for delegation</span><br><span class="line">// Note: VM hardcoded the offset of this field, thus all new fields</span><br><span class="line">// must be added *after* it.</span><br><span class="line">private final ClassLoader parent;</span><br></pre></td></tr></table></figure><p>åœ¨é€šè¿‡æ„é€ å‡½æ•°å®ä¾‹åŒ–  <strong>AppClassLoader</strong> å’Œ <strong>ExtClassLoader</strong> çš„æ—¶å€™éƒ½è¦ä¼ å…¥ä¸€ä¸ª classloader ä½œä¸ºå½“å‰ classloader çš„ parent</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AppClassLoader(URL[] var1, ClassLoader var2) &#123;</span><br><span class="line">// é€šè¿‡å±‚å±‚è°ƒç”¨ superï¼Œæœ€åæŒ‡å®šåˆ° ClassLoader.java ä¸­çš„ parent å±æ€§</span><br><span class="line">super(var1, var2, Launcher.factory);</span><br><span class="line">this.ucp.initLookupCache(this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡¶å±‚ClassLoaderæœ‰å‡ ä¸ªå‡½æ•°å¾ˆå…³é”®ï¼Œå…ˆæœ‰ä¸ªå°è±¡</p><ol><li><p>æŒ‡å®šä¿æŠ¤åŸŸï¼ˆprotectionDomainï¼‰ï¼ŒæŠŠByteBufferçš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œè¿™ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸ºfinalçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defineClass(String name, java.nio.ByteBuffer b,ProtectionDomain protectionDomain)</span><br></pre></td></tr></table></figure></li><li><p>æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œå…¶å¼€å§‹åç§»ä¸ºoff,è¿™ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸ºfinalçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defineClass(String name, <span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾æŒ‡å®šåç§°çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findClass(String name)</span><br></pre></td></tr></table></figure></li><li><p>é“¾æ¥æŒ‡å®šçš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resolveClass(Class&lt;?&gt;)</span><br></pre></td></tr></table></figure></li></ol><h4 id="ç±»åŠ è½½å™¨è´£ä»»èŒƒå›´"><a href="#ç±»åŠ è½½å™¨è´£ä»»èŒƒå›´" class="headerlink" title="ç±»åŠ è½½å™¨è´£ä»»èŒƒå›´"></a>ç±»åŠ è½½å™¨è´£ä»»èŒƒå›´</h4><p>ä¸Šé¢æˆ‘ä»¬æåˆ°æ¯ä¸ªåŠ è½½å™¨éƒ½æœ‰å¯¹åº”çš„åŠ è½½æœç´¢èŒƒå›´</p><ol><li><strong>Bootstrap ClassLoader</strong>:è¿™ä¸ªåŠ è½½å™¨ä¸æ˜¯ä¸€ä¸ªJavaç±»ï¼Œè€Œæ˜¯ç”±åº•å±‚çš„c++å®ç°ï¼Œè´Ÿè´£åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åŠ è½½Jdkæ ¸å¿ƒç±»åº“ï¼ˆå¦‚ï¼šrt.jarã€resources.jarã€charsets.jarç­‰ï¼‰ä»¥åŠåŠ è½½åä¸¤ä¸ªç±»åŠ è½½å™¨ã€‚è¿™ä¸ªClassLoaderå®Œå…¨æ˜¯JVMè‡ªå·±æ§åˆ¶çš„ï¼Œéœ€è¦åŠ è½½å“ªä¸ªç±»ï¼Œæ€ä¹ˆåŠ è½½éƒ½æ˜¯ç”±JVMè‡ªå·±æ§åˆ¶ï¼Œåˆ«äººä¹Ÿè®¿é—®ä¸åˆ°è¿™ä¸ªç±»</li><li><strong>Extension ClassLoader</strong>:æ˜¯ä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œç»§æ‰¿è‡ªClassLoaderç±»ï¼Œè´Ÿè´£åŠ è½½{JAVA_HOME}/jre/lib/ext/ç›®å½•ä¸‹çš„æ‰€æœ‰jaråŒ…ã€‚</li><li><strong>App ClassLoader</strong>ï¼šæ˜¯Extension ClassLoaderçš„å­å¯¹è±¡ï¼Œè´Ÿè´£åŠ è½½åº”ç”¨ç¨‹åºclasspathç›®å½•ä¸‹çš„æ‰€æœ‰jarå’Œclassæ–‡ä»¶ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ç±»åŠ è½½å™¨åŠ è½½ç›®å½•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClassLoaderPath</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">      <span class="comment">// BootStrap ClassLoaderåŠ è½½çš„æ–‡ä»¶</span></span><br><span class="line">        System.out.println(System.getProperty(<span class="string">"sun.boot.class.path"</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ExtClassLoaderåŠ è½½çš„æ–‡ä»¶</span></span><br><span class="line">      System.out.println(System.getProperty(<span class="string">"java.ext.dirs"</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// AppClassLoaderåŠ è½½çš„æ–‡ä»¶</span></span><br><span class="line">      System.getProperty(<span class="string">"java.class.path"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§å®¶è‡ªè¡Œè¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±å¯ä»¥çœ‹åˆ°æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„æ–‡ä»¶äº†</p><h4 id="ä¸¤ç§ç±»çš„åŠ è½½æ–¹å¼"><a href="#ä¸¤ç§ç±»çš„åŠ è½½æ–¹å¼" class="headerlink" title="ä¸¤ç§ç±»çš„åŠ è½½æ–¹å¼"></a>ä¸¤ç§ç±»çš„åŠ è½½æ–¹å¼</h4><p>é€šå¸¸ç”¨è¿™ä¸¤ç§æ–¹å¼æ¥åŠ¨æ€åŠ è½½ä¸€ä¸ª java ç±»ï¼Œ<strong>Class.forName()</strong> ä¸ <strong>ClassLoader.loadClass()</strong> ä½†æ˜¯ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´ä¹Ÿæ˜¯æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«</p><h5 id="Class-forName-æ–¹å¼"><a href="#Class-forName-æ–¹å¼" class="headerlink" title="Class.forName() æ–¹å¼"></a>Class.forName() æ–¹å¼</h5><p>æŸ¥çœ‹Classç±»çš„å…·ä½“å®ç°å¯çŸ¥ï¼Œå®è´¨ä¸Šè¿™ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨åŸç”Ÿçš„æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static native Class&lt;?&gt; forName0(String name, boolean initialize,ClassLoader loader);</span><br></pre></td></tr></table></figure><p>å½¢å¼ä¸Šç±»ä¼¼äºClass.forName(name,true,currentLoader)ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒClass.forName å¦‚æœè°ƒç”¨æˆåŠŸä¼šï¼š</p><ul><li>ä¿è¯ä¸€ä¸ªJavaç±»è¢«æœ‰æ•ˆå¾—åŠ è½½åˆ°å†…å­˜ä¸­ï¼›</li><li>ç±»é»˜è®¤ä¼šè¢«åˆå§‹åŒ–ï¼Œå³æ‰§è¡Œå†…éƒ¨çš„é™æ€å—ä»£ç ä»¥åŠä¿è¯é™æ€å±æ€§è¢«åˆå§‹åŒ–ï¼›</li><li>é»˜è®¤ä¼šä½¿ç”¨<strong>å½“å‰çš„ç±»åŠ è½½å™¨</strong>æ¥åŠ è½½<strong>å¯¹åº”çš„ç±»</strong>ã€‚</li></ul><h5 id="ClassLoader-loadClassæ–¹å¼"><a href="#ClassLoader-loadClassæ–¹å¼" class="headerlink" title="ClassLoader.loadClassæ–¹å¼"></a>ClassLoader.loadClassæ–¹å¼</h5><p>å¦‚æœé‡‡ç”¨è¿™ç§æ–¹å¼çš„ç±»åŠ è½½ç­–ç•¥ï¼Œç”±äºåŒäº²æ‰˜ç®¡æ¨¡å‹çš„å­˜åœ¨ï¼Œæœ€ç»ˆéƒ½ä¼šå°†ç±»çš„åŠ è½½ä»»åŠ¡äº¤ä»˜ç»™Bootstrap ClassLoaderè¿›è¡ŒåŠ è½½ã€‚è·Ÿè¸ªæºä»£ç ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private native Class&lt;?&gt; findBootstrapClass(String name);</span><br></pre></td></tr></table></figure><p>ä¸æ­¤åŒæ—¶ï¼Œä¸ä¸Šä¸€ç§æ–¹å¼çš„æœ€æœ¬è´¨çš„ä¸åŒæ˜¯ï¼Œç±»ä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œåªæœ‰æ˜¾å¼è°ƒç”¨æ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚ç»¼ä¸Šæ‰€è¿°ï¼ŒClassLoader.loadClass å¦‚æœè°ƒç”¨æˆåŠŸä¼šï¼š</p><ul><li>ç±»ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼›</li><li>ç±»ä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œåªæœ‰åœ¨ä¹‹åè¢«ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼›</li><li>ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼çš„ç±»åŠ è½½ï¼Œæ˜¯æä¾›ä¸€ç§çµæ´»åº¦ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚ç»§æ‰¿ClassLoaderç±»å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å®ç°ç±»çš„åŠ è½½ã€‚ï¼ˆå¾ˆå¤šå¼€æºWebé¡¹ç›®ä¸­éƒ½æœ‰è¿™ç§æƒ…å†µï¼Œæ¯”å¦‚tomcatï¼Œstruct2ï¼Œjbossã€‚åŸå› æ˜¯æ ¹æ®Java Servletè§„èŒƒçš„è¦æ±‚ï¼Œæ—¢è¦Webåº”ç”¨è‡ªå·±çš„ç±»çš„ä¼˜å…ˆçº§è¦é«˜äºWebå®¹å™¨æä¾›çš„ç±»ï¼Œä½†åŒæ—¶åˆè¦ä¿è¯Javaçš„æ ¸å¿ƒç±»ä¸è¢«ä»»æ„è¦†ç›–ï¼Œæ­¤æ—¶é‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨å°±å¾ˆå¿…è¦äº†ï¼‰</li></ul><h2 id="åŒäº²å§”æ´¾æ¨¡å‹æºç åˆ†æ"><a href="#åŒäº²å§”æ´¾æ¨¡å‹æºç åˆ†æ" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹æºç åˆ†æ"></a>åŒäº²å§”æ´¾æ¨¡å‹æºç åˆ†æ</h2><h3 id="Launcher"><a href="#Launcher" class="headerlink" title="Launcher"></a>Launcher</h3><p>åˆ†æç±»åŠ è½½å™¨æºç è¦ä» <strong>sun.misc.Launcher.class</strong> æ–‡ä»¶çœ‹èµ·, å…³é”®ä»£ç å·²æ·»åŠ æ³¨é‡Šï¼ŒåŒæ—¶å¯ä»¥åœ¨æ­¤ç±»ä¸­çœ‹åˆ° ExtClassLoader å’Œ AppClassLoader çš„å®šä¹‰ï¼Œä¹ŸéªŒè¯äº†æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ä»–ä»¬ä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯é€šè¿‡æŒ‡å®š parent å±æ€§æ¥å½¢æˆçš„ç»„åˆæ¨¡å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Launcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Launcher.ExtClassLoader var1;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–æ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line">            var1 = Launcher.ExtClassLoader.getExtClassLoader();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var10) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(<span class="string">"Could not create extension class loader"</span>, var10);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ŒåŒæ—¶æŒ‡å®š parent æ˜¯var1ï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰</span></span><br><span class="line">            <span class="keyword">this</span>.loader = Launcher.AppClassLoader.getAppClassLoader(var1);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var9) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(<span class="string">"Could not create application class loader"</span>, var9);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®AppClassLoaderä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆå¾ˆå…³é”®ï¼‰ï¼Œç ´ååŒäº²å§”æ´¾æ¨¡å‹éƒ½è¦ç”¨åˆ°è¿™ä¸ªæœºåˆ¶</span></span><br><span class="line">        Thread.currentThread().setContextClassLoader(<span class="keyword">this</span>.loader);</span><br><span class="line">        String var2 = System.getProperty(<span class="string">"java.security.manager"</span>);</span><br><span class="line">        <span class="keyword">if</span> (var2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            SecurityManager var3 = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">""</span>.equals(var2) &amp;&amp; !<span class="string">"default"</span>.equals(var2)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨loadClasså‡½æ•°ï¼Œè¿™é‡Œçš„loaderæ˜¯AppClassLoader</span></span><br><span class="line">                    var3 = (SecurityManager)<span class="keyword">this</span>.loader.loadClass(var2).newInstance();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException var5) &#123;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InstantiationException var6) &#123;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException var7) &#123;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassCastException var8) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                var3 = <span class="keyword">new</span> SecurityManager();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (var3 == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(<span class="string">"Could not create SecurityManager: "</span> + var2);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.setSecurityManager(var3);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€å†…éƒ¨ç±»ExtClassLoader</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtClassLoader</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é™æ€å†…éƒ¨ç±»AppClassLoader</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppClassLoader</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥ä¸Šé¢ç¬¬25è¡Œçš„ <em>loadClass</em> æ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">            Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// parentä¸ºç©ºï¼Œäº¤ç»™BootStrapClassLoader</span></span><br><span class="line">                        c = findBootstrapClassOrNull(name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                    <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                    <span class="comment">// to find the class.</span></span><br><span class="line">                    <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                    <span class="comment">//URLClassLoaderé‡å†™äº†ClassLoaderçš„findClassæ–¹æ³•ï¼Œä¼šè°ƒç”¨defineClassæ–¹æ³•å½¢æˆä¸€ä¸ªJavaç±»</span></span><br><span class="line">                    c = findClass(name);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°æ–¹æ³•æœ‰åŒæ­¥å—ï¼ˆsynchronizedï¼‰, è¿™ä¹Ÿå°±è§£é‡Šäº†æ–‡ç« å¼€å¤´ç¬¬2ä¸ªé—®é¢˜ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸ä¼šå‡ºç°é‡å¤åŠ è½½çš„æƒ…å†µã€‚åŒæ—¶ä¼šè¯¢é—®parent classloaderæ˜¯å¦æœ‰åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè‡ªå·±å°è¯•åŠ è½½ã€‚</p><p>URLClassLoaderä¸­çš„ findClassæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; findClass(<span class="keyword">final</span> String name)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">final</span> Class&lt;?&gt; result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = AccessController.doPrivileged(</span><br><span class="line">                <span class="keyword">new</span> PrivilegedExceptionAction&lt;Class&lt;?&gt;&gt;() &#123;</span><br><span class="line">                    <span class="keyword">public</span> Class&lt;?&gt; run() <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">                        String path = name.replace(<span class="string">'.'</span>, <span class="string">'/'</span>).concat(<span class="string">".class"</span>);</span><br><span class="line">                        Resource res = ucp.getResource(path, <span class="keyword">false</span>);</span><br><span class="line">                        <span class="keyword">if</span> (res != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="comment">// å®šä¹‰Class</span></span><br><span class="line">                                <span class="keyword">return</span> defineClass(name, res);</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(name, e);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, acc);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (java.security.PrivilegedActionException pae) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (ClassNotFoundException) pae.getException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å€Ÿç”¨ç½‘å‹çš„ä¸€ä¸ªåŠ è½½æ—¶åºå›¾æ¥è§£é‡Šæ•´ä¸ªè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼š</p><p><img src="http://ww1.sinaimg.cn/large/8dc363e6ly1g2i4z0q3w9j20k70dtwfj.jpg" alt="åŠ è½½æ—¶åºå›¾"></p><h2 id="åŒäº²å§”æ´¾æ¨¡å‹çš„ç ´å"><a href="#åŒäº²å§”æ´¾æ¨¡å‹çš„ç ´å" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹çš„ç ´å"></a>åŒäº²å§”æ´¾æ¨¡å‹çš„ç ´å</h2><p>Javaæœ¬èº«æœ‰ä¸€å¥—èµ„æºç®¡ç†æœåŠ¡JNDIï¼Œæ˜¯æ”¾ç½®åœ¨rt.jarä¸­ï¼Œç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ã€‚ä»¥å¯¹æ•°æ®åº“ç®¡ç†JDBCä¸ºä¾‹ï¼Œjavaç»™æ•°æ®åº“æ“ä½œæä¾›äº†ä¸€ä¸ªDriveræ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.sql;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Driver</span> </span>&#123;</span><br><span class="line">    <span class="function">Connection <span class="title">connect</span><span class="params">(String url, java.util.Properties info)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">acceptsURL</span><span class="params">(String url)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line"></span><br><span class="line">    DriverPropertyInfo[] getPropertyInfo(String url, java.util.Properties info) <span class="keyword">throws</span> SQLException;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getMajorVersion</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getMinorVersion</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">jdbcCompliant</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Logger <span class="title">getParentLogger</span><span class="params">()</span> <span class="keyword">throws</span> SQLFeatureNotSupportedException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæä¾›äº†ä¸€ä¸ªDriverManageræ¥ç®¡ç†è¿™äº›Driverçš„å…·ä½“å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">registerDriver</span><span class="params">(java.sql.Driver driver,</span></span></span><br><span class="line"><span class="function"><span class="params">           DriverAction da)</span></span></span><br><span class="line"><span class="function">       <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/* Register the driver if it has not already been added to our list */</span></span><br><span class="line">       <span class="keyword">if</span>(driver != <span class="keyword">null</span>) &#123;</span><br><span class="line">           registeredDrivers.addIfAbsent(<span class="keyword">new</span> DriverInfo(driver, da));</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// This is for compatibility with the original DriverManager</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       println(<span class="string">"registerDriver: "</span> + driver);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœç•¥äº†å¤§éƒ¨åˆ†ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“é©±åŠ¨å‰å¿…é¡»å…ˆè¦åœ¨DriverManagerä¸­ä½¿ç”¨registerDriver()æ³¨å†Œï¼Œç„¶åæˆ‘ä»¬æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p><h3 id="ä¸ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µï¼ˆä¸ä½¿ç”¨JNDIæœåŠ¡ï¼‰"><a href="#ä¸ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µï¼ˆä¸ä½¿ç”¨JNDIæœåŠ¡ï¼‰" class="headerlink" title="ä¸ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µï¼ˆä¸ä½¿ç”¨JNDIæœåŠ¡ï¼‰"></a>ä¸ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µï¼ˆä¸ä½¿ç”¨JNDIæœåŠ¡ï¼‰</h3><p>æˆ‘ä»¬çœ‹ä¸‹mysqlçš„é©±åŠ¨æ˜¯å¦‚ä½•è¢«åŠ è½½çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.åŠ è½½æ•°æ®è®¿é—®é©±åŠ¨ï¼Œä»¥Class.forNameçš„æ–¹å¼åŠ è½½ï¼Œä¼šåˆå§‹åŒ–</span></span><br><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"><span class="comment">//2.è¿æ¥åˆ°æ•°æ®"åº“"ä¸Šå»</span></span><br><span class="line">Connection conn= DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/mydb?characterEncoding=GBK"</span>, <span class="string">"root"</span>, <span class="string">""</span>);</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒå°±æ˜¯è¿™å¥Class.forName()è§¦å‘äº†mysqlé©±åŠ¨çš„åŠ è½½ï¼Œæˆ‘ä»¬çœ‹ä¸‹mysqlå¯¹Driveræ¥å£çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">NonRegisteringDriver</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">sql</span>.<span class="title">Driver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Register ourselves with the DriverManager</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.sql.DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException E) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Can't register driver!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Construct a new driver and register it with DriverManager</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     *             if a database error occurs.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Driver</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// Required for Class.forName().newInstance()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒClass.forName()å…¶å®è§¦å‘äº†é™æ€ä»£ç å—ï¼Œç„¶åå‘DriverManagerä¸­æ³¨å†Œäº†ä¸€ä¸ªmysqlçš„Driverå®ç°ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡DriverManagerå»è·å–connectionçš„æ—¶å€™åªè¦éå†å½“å‰æ‰€æœ‰Driverå®ç°ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå»ºç«‹è¿æ¥å°±å¯ä»¥äº†ã€‚</p><h4 id="ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µ"><a href="#ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µ" class="headerlink" title="ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µ"></a>ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æƒ…å†µ</h4><p>åœ¨JDBC4.0ä»¥åï¼Œå¼€å§‹æ”¯æŒä½¿ç”¨spiçš„æ–¹å¼æ¥æ³¨å†Œè¿™ä¸ªDriverï¼Œå…·ä½“åšæ³•å°±æ˜¯åœ¨mysqlçš„jaråŒ…ä¸­çš„META-INF/services/java.sql.Driver æ–‡ä»¶ä¸­æŒ‡æ˜å½“å‰ä½¿ç”¨çš„Driveræ˜¯å“ªä¸ªï¼Œç„¶åä½¿ç”¨çš„æ—¶å€™å°±ç›´æ¥è¿™æ ·å°±å¯ä»¥äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection conn= DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/mydb?characterEncoding=GBK"</span>, <span class="string">"root"</span>, <span class="string">""</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç›´æ¥è·å–è¿æ¥ï¼Œçœå»äº†ä¸Šé¢çš„Class.forName()æ³¨å†Œè¿‡ç¨‹ã€‚<br> ç°åœ¨ï¼Œæˆ‘ä»¬åˆ†æä¸‹çœ‹ä½¿ç”¨äº†è¿™ç§spiæœåŠ¡çš„æ¨¡å¼åŸæœ¬çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„:</p><ul><li>ç¬¬ä¸€ï¼Œä»META-INF/services/java.sql.Driveræ–‡ä»¶ä¸­è·å–å…·ä½“çš„å®ç°ç±»åâ€œcom.mysql.jdbc.Driverâ€</li><li>ç¬¬äºŒï¼ŒåŠ è½½è¿™ä¸ªç±»ï¼Œè¿™é‡Œè‚¯å®šåªèƒ½ç”¨class.forName(â€œcom.mysql.jdbc.Driverâ€)æ¥åŠ è½½</li></ul><p>å¥½äº†ï¼Œé—®é¢˜æ¥äº†ï¼ŒClass.forName()åŠ è½½ç”¨çš„æ˜¯è°ƒç”¨è€…çš„Classloaderï¼Œè¿™ä¸ªè°ƒç”¨è€…DriverManageræ˜¯åœ¨rt.jarä¸­çš„ï¼ŒClassLoaderæ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œcom.mysql.jdbc.Driverè‚¯å®šä¸åœ¨<JAVA_HOME>/libä¸‹ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯æ— æ³•åŠ è½½mysqlä¸­çš„è¿™ä¸ªç±»çš„ã€‚è¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å‹çš„å±€é™æ€§äº†ï¼Œçˆ¶çº§åŠ è½½å™¨æ— æ³•åŠ è½½å­çº§ç±»åŠ è½½å™¨è·¯å¾„ä¸­çš„ç±»ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼ŸæŒ‰ç…§ç›®å‰æƒ…å†µæ¥åˆ†æï¼Œè¿™ä¸ªmysqlçš„drvieråªæœ‰åº”ç”¨ç±»åŠ è½½å™¨èƒ½åŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦åœ¨å¯åŠ¨ç±»åŠ è½½å™¨ä¸­æœ‰æ–¹æ³•è·å–åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œç„¶åé€šè¿‡å®ƒå»åŠ è½½å°±å¯ä»¥äº†ã€‚è¿™å°±æ˜¯æ‰€è°“çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€‚</p><blockquote><p>æ–‡ç« å‰åŠæ®µæåˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡ <strong>Thread.setContextClassLoaser()</strong> æ–¹æ³•è®¾ç½®ï¼Œå¦‚æœä¸ç‰¹æ®Šè®¾ç½®ä¼šä»çˆ¶ç±»ç»§æ‰¿ï¼Œä¸€èˆ¬é»˜è®¤ä½¿ç”¨çš„æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</p></blockquote><p><strong>å¾ˆæ˜æ˜¾ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è®©çˆ¶çº§ç±»åŠ è½½å™¨èƒ½é€šè¿‡è°ƒç”¨å­çº§ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»ï¼Œè¿™æ‰“ç ´äº†åŒäº²å§”æ´¾æ¨¡å‹çš„åŸåˆ™</strong></p><p>ç°åœ¨æˆ‘ä»¬çœ‹ä¸‹DriverManageræ˜¯å¦‚ä½•ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å»åŠ è½½ç¬¬ä¸‰æ–¹jaråŒ…ä¸­çš„Driverç±»çš„ï¼Œå…ˆæ¥çœ‹æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        loadInitialDrivers();</span><br><span class="line">        println(<span class="string">"JDBC DriverManager initialized"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadInitialDrivers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String drivers;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            drivers = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;String&gt;() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> System.getProperty(<span class="string">"jdbc.drivers"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            drivers = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// If the driver is packaged as a Service Provider, load it.</span></span><br><span class="line">        <span class="comment">// Get all the drivers through the classloader</span></span><br><span class="line">        <span class="comment">// exposed as a java.sql.Driver.class service.</span></span><br><span class="line">        <span class="comment">// ServiceLoader.load() replaces the sun.misc.Providers()</span></span><br><span class="line"></span><br><span class="line">        AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceLoader æ˜¯ implements Iterable&lt;S&gt;çš„ä¸€ä¸ªç±»ï¼Œå¹¶é‡å†™äº† iterator æ–¹æ³•ï¼ˆå¾ˆå…³é”®ï¼‰</span></span><br><span class="line">                ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);</span><br><span class="line">                Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Load these drivers, so that they can be instantiated.</span></span><br><span class="line"><span class="comment">                 * It may be the case that the driver class may not be there</span></span><br><span class="line"><span class="comment">                 * i.e. there may be a packaged driver with the service class</span></span><br><span class="line"><span class="comment">                 * as implementation of java.sql.Driver but the actual class</span></span><br><span class="line"><span class="comment">                 * may be missing. In that case a java.util.ServiceConfigurationError</span></span><br><span class="line"><span class="comment">                 * will be thrown at runtime by the VM trying to locate</span></span><br><span class="line"><span class="comment">                 * and load the service.</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                 * Adding a try catch block to catch those runtime errors</span></span><br><span class="line"><span class="comment">                 * if driver not available in classpath but it's</span></span><br><span class="line"><span class="comment">                 * packaged as service and that service is there in classpath.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">while</span>(driversIterator.hasNext()) &#123;</span><br><span class="line">                        driversIterator.next();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Throwable t) &#123;</span><br><span class="line">                <span class="comment">// Do nothing</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        println(<span class="string">"DriverManager.initialize: jdbc.drivers = "</span> + drivers);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (drivers == <span class="keyword">null</span> || drivers.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] driversList = drivers.split(<span class="string">":"</span>);</span><br><span class="line">        println(<span class="string">"number of Drivers:"</span> + driversList.length);</span><br><span class="line">        <span class="keyword">for</span> (String aDriver : driversList) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                println(<span class="string">"DriverManager.Initialize: loading "</span> + aDriver);</span><br><span class="line">                Class.forName(aDriver, <span class="keyword">true</span>,</span><br><span class="line">                        ClassLoader.getSystemClassLoader());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                println(<span class="string">"DriverManager.Initialize: load failed: "</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨DriverManager.getConnection() æ–¹æ³•è‡ªç„¶ä¼šè§¦å‘é™æ€ä»£ç å—çš„æ‰§è¡Œï¼Œå¼€å§‹åŠ è½½é©±åŠ¨ç„¶åæˆ‘ä»¬çœ‹ä¸‹ServiceLoader.load()çš„å…·ä½“å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ServiceLoader&lt;S&gt; <span class="title">load</span><span class="params">(Class&lt;S&gt; service)</span> </span>&#123;</span><br><span class="line"><span class="comment">// ä¸Šæ–‡ä»‹ç»ç±»åŠ è½½æºç æ—¶ï¼Œæ³¨é‡Šè¯´æ˜è¿‡è®¾ç½®AppClassLoaderä¸ºä¸Šä¸‹æ–‡åŠ è½½å™¨</span></span><br><span class="line">    ClassLoader cl = Thread.currentThread().getContextClassLoader();</span><br><span class="line">    <span class="keyword">return</span> ServiceLoader.load(service, cl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ServiceLoader&lt;S&gt; <span class="title">load</span><span class="params">(Class&lt;S&gt; service, ClassLoader loader)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServiceLoader&lt;&gt;(service, loader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­å‘ä¸‹çœ‹æ„é€ å‡½æ•°å®ä¾‹åŒ– ServiceLoader åšäº†å“ªäº›äº‹æƒ…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">ServiceLoader</span><span class="params">(Class&lt;S&gt; svc, ClassLoader cl)</span> </span>&#123;</span><br><span class="line">    service = Objects.requireNonNull(svc, <span class="string">"Service interface cannot be null"</span>);</span><br><span class="line">    loader = (cl == <span class="keyword">null</span>) ? ClassLoader.getSystemClassLoader() : cl;</span><br><span class="line">    acc = (System.getSecurityManager() != <span class="keyword">null</span>) ? AccessController.getContext() : <span class="keyword">null</span>;</span><br><span class="line">    reload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ reload() å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  providers.clear();</span><br><span class="line">  lookupIterator = <span class="keyword">new</span> LazyIterator(service, loader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­æŸ¥çœ‹LazyIteratoræ„é€ å™¨ï¼Œè¯¥ç±»åŒæ ·å®ç°äº†Iteratoræ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">LazyIterator</span><span class="params">(Class&lt;S&gt; service, ClassLoader loader)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.service = service;</span><br><span class="line">  <span class="keyword">this</span>.loader = loader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä¾‹åŒ–åˆ°è¿™é‡Œæˆ‘ä»¬ä¹Ÿå°†ä¸Šä¸‹æ–‡å¾—åˆ°çš„ç±»åŠ è½½å™¨å®ä¾‹åŒ–åˆ°è¿™é‡Œï¼Œæ¥å›çœ‹ServiceLoader é‡å†™çš„ iterator() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;S&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;S&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    Iterator&lt;Map.Entry&lt;String,S&gt;&gt; knownProviders</span><br><span class="line">      = providers.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (knownProviders.hasNext())</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">return</span> lookupIterator.hasNext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DriverManager ç±»ä¸­ driversIterator è°ƒç”¨çš„next() æ–¹æ³•å®é™…æ˜¯è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> S <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (knownProviders.hasNext())</span><br><span class="line">        <span class="keyword">return</span> knownProviders.next().getValue();</span><br><span class="line">      <span class="keyword">return</span> lookupIterator.next();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢next() æ–¹æ³•è°ƒç”¨äº†lookupIterator.next()ï¼Œè¿™ä¸ªlookupIterator å°±æ˜¯åˆšåˆšå®ä¾‹åŒ–çš„ LazyIterator(); æ¥çœ‹nextæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> S <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (acc == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> nextService();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        PrivilegedAction&lt;S&gt; action = <span class="keyword">new</span> PrivilegedAction&lt;S&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> S <span class="title">run</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> nextService(); &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­æŸ¥çœ‹nextService æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> S <span class="title">nextService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!hasNextService())</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    String cn = nextName;</span><br><span class="line">    nextName = <span class="keyword">null</span>;</span><br><span class="line">    Class&lt;?&gt; c = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    c = Class.forName(cn, <span class="keyword">false</span>, loader);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">    fail(service, <span class="string">"Provider "</span> + cn + <span class="string">" not found"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!service.isAssignableFrom(c)) &#123;</span><br><span class="line">    fail(service,  <span class="string">"Provider "</span> + cn  + <span class="string">" not a subtype"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    S p = service.cast(c.newInstance());</span><br><span class="line">    providers.put(cn, p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Throwable x) &#123;</span><br><span class="line">    fail(service, <span class="string">"Provider "</span> + cn + <span class="string">" could not be instantiated"</span>, x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> Error();          <span class="comment">// This cannot happen</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»ˆäºåˆ°è¿™é‡Œäº†ï¼Œåœ¨ä¸Šé¢ nextServiceå‡½æ•°ä¸­ç¬¬8è¡Œè°ƒç”¨äº†c = Class.forName(cn, false, loader) æ–¹æ³•ï¼Œæˆ‘ä»¬æˆåŠŸçš„åšåˆ°äº†é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ‹¿åˆ°äº†åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆæˆ–è€…è‡ªå®šä¹‰çš„ç„¶åå¡åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ï¼‰ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹ŸæŸ¥æ‰¾åˆ°äº†å‚å•†åœ¨å­çº§çš„jaråŒ…ä¸­æ³¨å†Œçš„é©±åŠ¨å…·ä½“å®ç°ç±»åï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æˆåŠŸçš„åœ¨rt.jaråŒ…ä¸­çš„DriverManagerä¸­æˆåŠŸçš„åŠ è½½äº†æ”¾åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºåŒ…ä¸­çš„ç±»äº†åŒæ—¶åœ¨ç¬¬16è¡Œå®ŒæˆDriverçš„å®ä¾‹åŒ–ï¼Œç­‰åŒäºnew Driver();  æ–‡ç« å¼€å¤´çš„é—®é¢˜åœ¨ç†è§£åˆ°è¿™é‡Œä¹Ÿè¿åˆƒè€Œè§£äº†</p><h2 id="JAVAçƒ­éƒ¨ç½²å®ç°"><a href="#JAVAçƒ­éƒ¨ç½²å®ç°" class="headerlink" title="JAVAçƒ­éƒ¨ç½²å®ç°"></a>JAVAçƒ­éƒ¨ç½²å®ç°</h2><p>é¦–å…ˆè°ˆä¸€ä¸‹ä½•ä¸ºçƒ­éƒ¨ç½²ï¼ˆhotswapï¼‰ï¼Œçƒ­éƒ¨ç½²æ˜¯åœ¨ä¸é‡å¯ Java è™šæ‹Ÿæœºçš„å‰æä¸‹ï¼Œèƒ½è‡ªåŠ¨ä¾¦æµ‹åˆ° class æ–‡ä»¶çš„å˜åŒ–ï¼Œæ›´æ–°è¿è¡Œæ—¶ class çš„è¡Œä¸ºã€‚Java ç±»æ˜¯é€šè¿‡ Java è™šæ‹ŸæœºåŠ è½½çš„ï¼ŒæŸä¸ªç±»çš„ class æ–‡ä»¶åœ¨è¢« classloader åŠ è½½åï¼Œä¼šç”Ÿæˆå¯¹åº”çš„ Class å¯¹è±¡ï¼Œä¹‹åå°±å¯ä»¥åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚é»˜è®¤çš„è™šæ‹Ÿæœºè¡Œä¸ºåªä¼šåœ¨å¯åŠ¨æ—¶åŠ è½½ç±»ï¼Œå¦‚æœåæœŸæœ‰ä¸€ä¸ªç±»éœ€è¦æ›´æ–°çš„è¯ï¼Œå•çº¯æ›¿æ¢ç¼–è¯‘çš„ class æ–‡ä»¶ï¼ŒJava è™šæ‹Ÿæœºæ˜¯ä¸ä¼šæ›´æ–°æ­£åœ¨è¿è¡Œçš„ classã€‚å¦‚æœè¦å®ç°çƒ­éƒ¨ç½²ï¼Œæœ€æ ¹æœ¬çš„æ–¹å¼æ˜¯ä¿®æ”¹è™šæ‹Ÿæœºçš„æºä»£ç ï¼Œæ”¹å˜ classloader çš„åŠ è½½è¡Œä¸ºï¼Œä½¿è™šæ‹Ÿæœºèƒ½ç›‘å¬ class æ–‡ä»¶çš„æ›´æ–°ï¼Œé‡æ–°åŠ è½½ class æ–‡ä»¶ï¼Œè¿™æ ·çš„è¡Œä¸ºç ´åæ€§å¾ˆå¤§ï¼Œä¸ºåç»­çš„ JVM å‡çº§åŸ‹ä¸‹äº†ä¸€ä¸ªå¤§å‘ã€‚</p><p>å¦ä¸€ç§å‹å¥½çš„æ–¹æ³•æ˜¯åˆ›å»ºè‡ªå·±çš„ classloader æ¥åŠ è½½éœ€è¦ç›‘å¬çš„ classï¼Œè¿™æ ·å°±èƒ½æ§åˆ¶ç±»åŠ è½½çš„æ—¶æœºï¼Œä»è€Œå®ç°çƒ­éƒ¨ç½²ã€‚</p><p>çƒ­éƒ¨ç½²æ­¥éª¤ï¼š</p><ol><li><p>é”€æ¯è‡ªå®šä¹‰classloader(è¢«è¯¥åŠ è½½å™¨åŠ è½½çš„classä¹Ÿä¼šè‡ªåŠ¨å¸è½½)ï¼›</p></li><li><p>æ›´æ–°class</p></li><li><p>ä½¿ç”¨æ–°çš„ClassLoaderå»åŠ è½½class</p></li></ol><p>JVMä¸­çš„Classåªæœ‰æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰èƒ½è¢«GCå›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯¥Classè¢«å¸è½½ï¼ˆunloadï¼‰ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«GCï¼Œä¹Ÿå°±æ˜¯JVMä¸­ä¸å­˜åœ¨è¯¥Classçš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«GCã€‚</li><li>è¯¥ç±»çš„java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œå¦‚ä¸èƒ½åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•</li></ul><h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2><p>è¦åˆ›å»ºç”¨æˆ·è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œåªéœ€è¦ç»§æ‰¿java.lang.ClassLoaderç±»ï¼Œç„¶åè¦†ç›–å®ƒçš„findClass(String name)æ–¹æ³•å³å¯ï¼Œå³æŒ‡æ˜å¦‚ä½•è·å–ç±»çš„å­—èŠ‚ç æµã€‚</p><p><strong>å¦‚æœè¦ç¬¦åˆåŒäº²å§”æ´¾è§„èŒƒï¼Œåˆ™é‡å†™findClassæ–¹æ³•ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘ï¼‰ï¼›è¦ç ´åçš„è¯ï¼Œé‡å†™loadClassæ–¹æ³•(åŒäº²å§”æ´¾çš„å…·ä½“é€»è¾‘å®ç°)</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClassLoad</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ç±»åŠ è½½æˆåŠŸã€‚"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String classPath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PathClassLoader</span><span class="params">(String classPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.classPath = classPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] classData = getData(name);</span><br><span class="line">        <span class="keyword">if</span> (classData == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] getData(String className) &#123;</span><br><span class="line">        String path = classPath + File.separatorChar</span><br><span class="line">                + className.replace(<span class="string">'.'</span>, File.separatorChar) + <span class="string">".class"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream is = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line">            ByteArrayOutputStream stream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2048</span>];</span><br><span class="line">            <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> ((num = is.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                stream.write(buffer, <span class="number">0</span>, num);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> ClassNotFoundException,</span></span><br><span class="line"><span class="function">            InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        ClassLoader pcl = <span class="keyword">new</span> PathClassLoader(<span class="string">"D:\\ProgramFiles\\eclipseNew\\workspace\\cp-lib\\bin"</span>);</span><br><span class="line">        Class c = pcl.loadClass(<span class="string">"classloader.TestClassLoad"</span>);<span class="comment">//æ³¨æ„è¦åŒ…æ‹¬åŒ…å</span></span><br><span class="line">        System.out.println(c.newInstance());<span class="comment">//æ‰“å°ç±»åŠ è½½æˆåŠŸ.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ„Ÿè°¢ä¸å‚è€ƒ"><a href="#æ„Ÿè°¢ä¸å‚è€ƒ" class="headerlink" title="æ„Ÿè°¢ä¸å‚è€ƒ"></a>æ„Ÿè°¢ä¸å‚è€ƒ</h2><p>éå¸¸æ„Ÿè°¢ä»¥ä¸‹åšæ–‡çš„ä½œè€…ï¼Œé€šè¿‡åå¤æ‹œè¯»æ¥äº†è§£åŒäº²å§”æ´¾æ¨¡å‹çš„åŸç†</p><ol><li><a href="https://blog.csdn.net/u014634338/article/details/81434327" target="_blank" rel="noopener">https://blog.csdn.net/u014634338/article/details/81434327</a></li><li><a href="https://www.cnblogs.com/aspirant/p/7200523.html" target="_blank" rel="noopener">https://www.cnblogs.com/aspirant/p/7200523.html</a></li><li><a href="https://www.cnblogs.com/gdpuzxs/p/7044963.html" target="_blank" rel="noopener">https://www.cnblogs.com/gdpuzxs/p/7044963.html</a></li><li><a href="https://www.jianshu.com/p/09f73af48a98" target="_blank" rel="noopener">https://www.jianshu.com/p/09f73af48a98</a></li><li><a href="https://www.cnblogs.com/yahokuma/p/3668138.html" target="_blank" rel="noopener">https://www.cnblogs.com/yahokuma/p/3668138.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ClassLoader </tag>
            
            <tag> çƒ­éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PKIXè¯ä¹¦å¯¼å…¥</title>
      <link href="//p/pkix-certificate-import.html"/>
      <url>//p/pkix-certificate-import.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">é€šè¿‡ç†è§£SSLæ¡æ‰‹è¿‡ç¨‹è§£å†³å®¢æˆ·ç«¯è¯ä¹¦é—®é¢˜</blockquote><p>æœ€è¿‘åšé¡¹ç›®ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡å™¨çªç„¶å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œå®¢æˆ·ç«¯æ‰¾ä¸åˆ°æœåŠ¡å™¨ç«¯è¿”å›çš„public certificateï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‹¿åˆ°æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯çš„è¯ä¹¦ï¼Œå¹¶ä¸”å­˜æ”¾åˆ°Keystoreä¸­ï¼Œè¿™å°±æ¶‰åŠåˆ°SSLæ¡æ‰‹ï¼ˆhandshakeï¼‰è·å–ä¿¡ä»»çš„è¿‡ç¨‹ã€‚</p><h3 id="å›¾è§£SSLï¼ˆSecure-Socket-Layerï¼‰åè®®"><a href="#å›¾è§£SSLï¼ˆSecure-Socket-Layerï¼‰åè®®" class="headerlink" title="å›¾è§£SSLï¼ˆSecure Socket Layerï¼‰åè®®"></a>å›¾è§£SSLï¼ˆSecure Socket Layerï¼‰åè®®</h3><p>å¼€å§‹åŠ å¯†é€šä¿¡ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é¦–å…ˆå¿…é¡»å»ºç«‹è¿æ¥å’Œäº¤æ¢å‚æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšæ¡æ‰‹ï¼ˆhandshakeï¼‰</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/FraserYu/img-host/blog-imgSSL.png" alt=""></fancybox></p><ol><li>å®¢æˆ·ç«¯ç»™å‡ºåè®®ç‰ˆæœ¬å·ã€ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼ˆClient randomï¼‰ï¼Œä»¥åŠå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹æ³•</li><li>æœåŠ¡ç«¯ç¡®è®¤åŒæ–¹ä½¿ç”¨çš„åŠ å¯†æ–¹æ³•ï¼Œå¹¶ç»™å‡ºæ•°å­—è¯ä¹¦ã€ä»¥åŠä¸€ä¸ªæœåŠ¡å™¨ç”Ÿæˆçš„éšæœºæ•°ï¼ˆServer randomï¼‰</li><li>å®¢æˆ·ç«¯ç¡®è®¤æ•°å­—è¯ä¹¦æœ‰æ•ˆï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„éšæœºæ•°ï¼ˆPremaster secretï¼‰ï¼Œå¹¶ä½¿ç”¨æ•°å­—è¯ä¹¦ä¸­çš„å…¬é’¥ï¼ŒåŠ å¯†è¿™ä¸ªéšæœºæ•°ï¼Œå‘ç»™æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥ï¼Œè·å–çˆ±ä¸½ä¸å‘æ¥çš„éšæœºæ•°ï¼ˆå³Premaster secretï¼‰</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ ¹æ®çº¦å®šçš„åŠ å¯†æ–¹æ³•ï¼Œä½¿ç”¨å‰é¢çš„ä¸‰ä¸ªéšæœºæ•°ï¼Œç”Ÿæˆâ€å¯¹è¯å¯†é’¥â€ï¼ˆsession keyï¼‰ï¼Œç”¨æ¥åŠ å¯†æ¥ä¸‹æ¥çš„æ•´ä¸ªå¯¹è¯è¿‡ç¨‹</li></ol><p>ä»¥ä¸Šå°±æ˜¯æ¡æ‰‹çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå…¶ä¸­æ¡æ‰‹é˜¶æ®µæœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„</p><ol><li>ç”Ÿæˆå¯¹è¯å¯†é’¥ä¸€å…±éœ€è¦ä¸‰ä¸ªéšæœºæ•°ã€‚</li><li>æ¡æ‰‹ä¹‹åçš„å¯¹è¯ä½¿ç”¨â€å¯¹è¯å¯†é’¥â€åŠ å¯†ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ï¼ŒæœåŠ¡å™¨çš„å…¬é’¥å’Œç§é’¥åªç”¨äºåŠ å¯†å’Œè§£å¯†â€å¯¹è¯å¯†é’¥â€ï¼ˆéå¯¹ç§°åŠ å¯†RSAï¼‰ï¼Œæ— å…¶ä»–ä½œç”¨ã€‚</li><li>æœåŠ¡å™¨å…¬é’¥æ”¾åœ¨æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦ä¹‹ä¸­ã€‚</li></ol><h3 id="SSLå…·ä½“æ¡æ‰‹è¿‡ç¨‹"><a href="#SSLå…·ä½“æ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="SSLå…·ä½“æ¡æ‰‹è¿‡ç¨‹"></a>SSLå…·ä½“æ¡æ‰‹è¿‡ç¨‹</h3><p>ç”¨-Djavax.net.debug=allæ¥å¼€å¯è°ƒè¯•ä¿¡æ¯çš„è¾“å‡ºï¼ŒSSLçš„æ¡æ‰‹è¿‡ç¨‹ä¸€ç›®äº†ç„¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>-<span class="number">02</span>-<span class="number">01</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> --INFO-- ***Helper : https:<span class="comment">//xxx.xxx.com:8443/***/ws/***Service</span></span><br><span class="line">Ignoring unsupported cipher suite: TLS_DHE_DSS_WITH_AES_128_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_DHE_DSS_WITH_AES_256_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_DHE_RSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_DHE_RSA_WITH_AES_256_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384</span><br><span class="line">Ignoring unsupported cipher suite: TLS_RSA_WITH_AES_256_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">Ignoring unsupported cipher suite: TLS_RSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">Allow unsafe renegotiation: <span class="keyword">false</span></span><br><span class="line">Allow legacy hello messages: <span class="keyword">true</span></span><br><span class="line">Is initial handshake: <span class="keyword">true</span></span><br><span class="line">Is secure renegotiation: <span class="keyword">false</span></span><br><span class="line">%% Client cached [Session-<span class="number">5</span>, TLS_RSA_WITH_AES_256_CBC_SHA]</span><br><span class="line">%% Try resuming [Session-<span class="number">5</span>, TLS_RSA_WITH_AES_256_CBC_SHA] from port <span class="number">12371</span></span><br><span class="line">##å®¢æˆ·ç«¯è·ŸæœåŠ¡å™¨ç¬¬ä¸€æ¬¡æ‰“æ‹›å‘¼##</span><br><span class="line">*** ClientHello, TLSv1</span><br><span class="line">RandomCookie:  GMT: <span class="number">1517410388</span> bytes = &#123; <span class="number">95</span>, <span class="number">120</span>, <span class="number">132</span>, <span class="number">216</span>, <span class="number">69</span>, <span class="number">34</span>, <span class="number">205</span>, <span class="number">73</span>, <span class="number">133</span>, <span class="number">30</span>, <span class="number">240</span>, <span class="number">178</span>, <span class="number">37</span>, <span class="number">187</span>, <span class="number">228</span>, <span class="number">127</span>, <span class="number">73</span>, <span class="number">149</span>, <span class="number">1</span>, <span class="number">216</span>, <span class="number">19</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">236</span>, <span class="number">29</span>, <span class="number">111</span>, <span class="number">125</span>, <span class="number">132</span> &#125;</span><br><span class="line">Session ID:  &#123;<span class="number">248</span>, <span class="number">40</span>, <span class="number">73</span>, <span class="number">62</span>, <span class="number">46</span>, <span class="number">20</span>, <span class="number">43</span>, <span class="number">249</span>, <span class="number">49</span>, <span class="number">73</span>, <span class="number">148</span>, <span class="number">196</span>, <span class="number">222</span>, <span class="number">200</span>, <span class="number">202</span>, <span class="number">68</span>, <span class="number">221</span>, <span class="number">241</span>, <span class="number">33</span>, <span class="number">57</span>, <span class="number">128</span>, <span class="number">93</span>, <span class="number">149</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">112</span>, <span class="number">248</span>, <span class="number">66</span>, <span class="number">173</span>, <span class="number">203</span>, <span class="number">187</span>, <span class="number">1</span>&#125;</span><br><span class="line">##æ”¯æŒçš„åŠ å¯†ç®—æ³•##</span><br><span class="line">Cipher Suites: [TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA, TLS_RSA_WITH_AES_256_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDH_RSA_WITH_AES_256_CBC_SHA, TLS_DHE_RSA_WITH_AES_256_CBC_SHA, TLS_DHE_DSS_WITH_AES_256_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDH_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_DSS_WITH_AES_128_CBC_SHA, TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, SSL_RSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA, SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA, SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_ECDSA_WITH_RC4_128_SHA, TLS_ECDHE_RSA_WITH_RC4_128_SHA, SSL_RSA_WITH_RC4_128_SHA, TLS_ECDH_ECDSA_WITH_RC4_128_SHA, TLS_ECDH_RSA_WITH_RC4_128_SHA, SSL_RSA_WITH_RC4_128_MD5, TLS_EMPTY_RENEGOTIATION_INFO_SCSV]</span><br><span class="line">Compression Methods:  &#123; <span class="number">0</span> &#125;</span><br><span class="line">Extension elliptic_curves, curve names: &#123;secp256r1, sect163k1, sect163r2, secp192r1, secp224r1, sect233k1, sect233r1, sect283k1, sect283r1, secp384r1, sect409k1, sect409r1, secp521r1, sect571k1, sect571r1, secp160k1, secp160r1, secp160r2, sect163r1, secp192k1, sect193r1, sect193r2, secp224k1, sect239k1, secp256k1&#125;</span><br><span class="line">Extension ec_point_formats, formats: [uncompressed]</span><br><span class="line">Extension server_name, server_name: [host_name: idmtest.dcpc.com]</span><br><span class="line">***</span><br><span class="line">[write] MD5 and SHA1 hashes:  len = <span class="number">220</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> D8 <span class="number">03</span> <span class="number">01</span> <span class="number">5</span>A <span class="number">72</span>   D8 <span class="number">54</span> <span class="number">5F</span> <span class="number">78</span> <span class="number">84</span> D8 <span class="number">45</span> <span class="number">22</span>  ......Zr.T_x..E<span class="string">"</span></span><br><span class="line"><span class="string">0010: CD 49 85 1E F0 B2 25 BB   E4 7F 49 95 01 D8 13 03  .I....%...I.....</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">DefaultQuartzScheduler_Worker-3, WRITE: TLSv1 Handshake, length = 220</span></span><br><span class="line"><span class="string">[Raw write]: length = 225</span></span><br><span class="line"><span class="string">0000: 16 03 01 00 DC 01 00 00   D8 03 01 5A 72 D8 54 5F  ...........Zr.T_</span></span><br><span class="line"><span class="string">0010: 78 84 D8 45 22 CD 49 85   1E F0 B2 25 BB E4 7F 49  x..E"</span>.I....%...I</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[Raw read]: length = <span class="number">5</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">16</span> <span class="number">03</span> <span class="number">01</span> <span class="number">06</span> <span class="number">22</span>                                     ....<span class="string">"</span></span><br><span class="line"><span class="string">[Raw read]: length = 1570</span></span><br><span class="line"><span class="string">0000: 02 00 00 46 03 01 5A 72   63 4E F2 CF 4B 0F CE 58  ...F..ZrcN..K..X</span></span><br><span class="line"><span class="string">0010: 0E EF 36 D4 F3 3E C0 85   AD 6D 4B 8D DB CA FB 77  ..6..&gt;...mK....w</span></span><br><span class="line"><span class="string">0020: 80 B3 A1 D2 A7 90 20 D5   A6 FD 6E A7 FF 5A D4 DF  ...... ...n..Z..</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">DefaultQuartzScheduler_Worker-3, READ: TLSv1 Handshake, length = 1570</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##æœåŠ¡å™¨å“åº”</span></span><br><span class="line"><span class="string">*** ServerHello, TLSv1</span></span><br><span class="line"><span class="string">RandomCookie:  GMT: 1517445966 bytes = &#123; 242, 207, 75, 15, 206, 88, 14, 239, 54, 212, 243, 62, 192, 133, 173, 109, 75, 141, 219, 202, 251, 119, 128, 179, 161, 210, 167, 144 &#125;</span></span><br><span class="line"><span class="string">Session ID:  &#123;213, 166, 253, 110, 167, 255, 90, 212, 223, 9, 221, 44, 82, 61, 249, 50, 79, 110, 177, 174, 106, 198, 101, 47, 213, 191, 119, 128, 106, 200, 188, 1&#125;</span></span><br><span class="line"><span class="string">##æœåŠ¡å™¨é€‰å®šçš„åŠ å¯†ç®—æ³•</span></span><br><span class="line"><span class="string">Cipher Suite: TLS_RSA_WITH_AES_256_CBC_SHA</span></span><br><span class="line"><span class="string">Compression Method: 0</span></span><br><span class="line"><span class="string">***</span></span><br><span class="line"><span class="string">Warning: No renegotiation indication extension in ServerHello</span></span><br><span class="line"><span class="string">%% Initialized:  [Session-8, TLS_RSA_WITH_AES_256_CBC_SHA]</span></span><br><span class="line"><span class="string">** TLS_RSA_WITH_AES_256_CBC_SHA</span></span><br><span class="line"><span class="string">[read] MD5 and SHA1 hashes:  len = 74</span></span><br><span class="line"><span class="string">0000: 02 00 00 46 03 01 5A 72   63 4E F2 CF 4B 0F CE 58  ...F..ZrcN..K..X</span></span><br><span class="line"><span class="string">0010: 0E EF 36 D4 F3 3E C0 85   AD 6D 4B 8D DB CA FB 77  ..6..&gt;...mK....w</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„è¯ä¹¦é“¾,è¯æ˜â€œæˆ‘æ˜¯æˆ‘â€</span></span><br><span class="line"><span class="string">*** Certificate chain</span></span><br><span class="line"><span class="string">chain [0] = [</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">  Version: V3</span></span><br><span class="line"><span class="string">  Subject: CN=*.****.com, ST=åŒ—äº¬å¸‚, L=åŒ—äº¬å¸‚, O=***å…¬å¸, C=CN</span></span><br><span class="line"><span class="string">  Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Key:  Sun RSA public key, 2048 bits</span></span><br><span class="line"><span class="string">  modulus: 256891288892062675553247103925...</span></span><br><span class="line"><span class="string">  public exponent: 65537</span></span><br><span class="line"><span class="string">  Validity: [From: Wed May 17 16:15:30 CST 2017,</span></span><br><span class="line"><span class="string">               To: Fri May 15 16:15:30 CST 2020]</span></span><br><span class="line"><span class="string">  Issuer: CN=WoSign OV SSL CA, O=WoSign CA Limited, C=CN</span></span><br><span class="line"><span class="string">  SerialNumber: [    363fa17d 5c46082c dc707c24 6a8d81b2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Certificate Extensions: 9</span></span><br><span class="line"><span class="string">[1]: ObjectId: 1.3.6.1.5.5.7.1.1 Criticality=false</span></span><br><span class="line"><span class="string">AuthorityInfoAccess [[</span></span><br><span class="line"><span class="string">   accessMethod: ocsp</span></span><br><span class="line"><span class="string">   accessLocation: URIName: http://wosign-ovca.ocsp-certum.com,</span></span><br><span class="line"><span class="string">   accessMethod: caIssuers</span></span><br><span class="line"><span class="string">   accessLocation: URIName: http://repository.certum.pl/wosign-ovca.cer]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2]: ObjectId: 2.5.29.35 Criticality=false</span></span><br><span class="line"><span class="string">AuthorityKeyIdentifier [</span></span><br><span class="line"><span class="string">KeyIdentifier [</span></span><br><span class="line"><span class="string">0000: A1 13 54 DC 56 73 2C 27   82 CA C8 84 EF EE BF 00  ..T.Vs,'........</span></span><br><span class="line"><span class="string">0010: FD 5F AB 56                                        ._.V</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[3]: ObjectId: 2.5.29.19 Criticality=true</span></span><br><span class="line"><span class="string">BasicConstraints:[</span></span><br><span class="line"><span class="string">  CA:false</span></span><br><span class="line"><span class="string">  PathLen: undefined</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[4]: ObjectId: 2.5.29.31 Criticality=false</span></span><br><span class="line"><span class="string">CRLDistributionPoints [</span></span><br><span class="line"><span class="string">  [DistributionPoint:</span></span><br><span class="line"><span class="string">     [URIName: http://wosign.crl.certum.pl/wosign-ovca.crl]</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[5]: ObjectId: 2.5.29.32 Criticality=false</span></span><br><span class="line"><span class="string">CertificatePolicies [</span></span><br><span class="line"><span class="string">  [CertificatePolicyId: [2.23.140.1.2.2]</span></span><br><span class="line"><span class="string">[]  ]</span></span><br><span class="line"><span class="string">  [CertificatePolicyId: [1.2.616.1.113527.2.5.1.12.2]</span></span><br><span class="line"><span class="string">[PolicyQualifierInfo: [</span></span><br><span class="line"><span class="string">  qualifierID: 1.3.6.1.5.5.7.2.2</span></span><br><span class="line"><span class="string">  qualifier:</span></span><br><span class="line"><span class="string">0000: 30 81 E4 30 1F 16 18 41   73 73 65 63 6F 20 44 61  0..0...Asseco Da</span></span><br><span class="line"><span class="string">0010: 74 61 20 53 79 73 74 65   6D 73 20 53 2E 41 2E 30  ta Systems S.A.0</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">]]  ]</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[6]: ObjectId: 2.5.29.37 Criticality=false</span></span><br><span class="line"><span class="string">ExtendedKeyUsages [</span></span><br><span class="line"><span class="string">  serverAuth</span></span><br><span class="line"><span class="string">  clientAuth</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[7]: ObjectId: 2.5.29.15 Criticality=true</span></span><br><span class="line"><span class="string">KeyUsage [</span></span><br><span class="line"><span class="string">  DigitalSignature</span></span><br><span class="line"><span class="string">  Key_Encipherment</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[8]: ObjectId: 2.5.29.17 Criticality=false</span></span><br><span class="line"><span class="string">SubjectAlternativeName [</span></span><br><span class="line"><span class="string">  DNSName: *.dcpc.com</span></span><br><span class="line"><span class="string">  DNSName: dcpc.com</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[9]: ObjectId: 2.5.29.14 Criticality=false</span></span><br><span class="line"><span class="string">SubjectKeyIdentifier [</span></span><br><span class="line"><span class="string">KeyIdentifier [</span></span><br><span class="line"><span class="string">0000: B3 A6 53 AD 96 D8 B7 51   09 D5 E1 07 E5 B2 BC E6  ..S....Q........</span></span><br><span class="line"><span class="string">0010: B5 F2 82 2B                                        ...+</span></span><br><span class="line"><span class="string">]]]</span></span><br><span class="line"><span class="string">  Algorithm: [SHA256withRSA]</span></span><br><span class="line"><span class="string">  Signature:</span></span><br><span class="line"><span class="string">0000: 9A 38 A4 8F B2 A8 CE 9A   B6 98 2F 8F 18 AA 45 79  .8......../...Ey</span></span><br><span class="line"><span class="string">0010: DE D6 31 22 99 6E D7 14   45 5E C1 1F 06 EC 7F C9  ..1"</span>.n..E^......</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">***</span><br><span class="line">==å®¢æˆ·ç«¯ä»æœ¬åœ°æ‰¾åˆ°çš„ä¿¡èµ–è¯ä¹¦(å¦‚æœæ‰¾ä¸åˆ°ä¼šç›´æ¥æŠ¥certificate_unknow)==</span><br><span class="line">Found trusted certificate:</span><br><span class="line">[</span><br><span class="line">[</span><br><span class="line">  Version: V3</span><br><span class="line">  Subject: CN=*.****.com, ST=åŒ—äº¬å¸‚, L=åŒ—äº¬å¸‚, O=****å…¬å¸, C=CN</span><br><span class="line">  Signature Algorithm: SHA256withRSA, OID = <span class="number">1.2</span>.840.113549.1.1.11</span><br><span class="line"></span><br><span class="line">  Key:  Sun RSA <span class="keyword">public</span> key, <span class="number">2048</span> bits</span><br><span class="line">  modulus: <span class="number">2568912888920626755532471039254124</span>....</span><br><span class="line">  <span class="keyword">public</span> exponent: <span class="number">65537</span></span><br><span class="line">  Validity: [From: Wed May <span class="number">17</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">30</span> CST <span class="number">2017</span>,</span><br><span class="line">               To: Fri May <span class="number">15</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">30</span> CST <span class="number">2020</span>]</span><br><span class="line">  Issuer: CN=WoSign OV SSL CA, O=WoSign CA Limited, C=CN</span><br><span class="line">  SerialNumber: [    <span class="number">363f</span>a17d <span class="number">5</span>c46082c dc707c24 <span class="number">6</span>a8d81b2]</span><br><span class="line"></span><br><span class="line">Certificate Extensions: <span class="number">9</span></span><br><span class="line">[<span class="number">1</span>]: ObjectId: <span class="number">1.3</span>.6.1.5.5.7.1.1 Criticality=<span class="keyword">false</span></span><br><span class="line">AuthorityInfoAccess [</span><br><span class="line">  [</span><br><span class="line">   accessMethod: ocsp</span><br><span class="line">   accessLocation: URIName: http:<span class="comment">//wosign-ovca.ocsp-certum.com</span></span><br><span class="line">,</span><br><span class="line">   accessMethod: caIssuers</span><br><span class="line">   accessLocation: URIName: http:<span class="comment">//repository.certum.pl/wosign-ovca.cer</span></span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[<span class="number">2</span>]: ObjectId: <span class="number">2.5</span>.29.35 Criticality=<span class="keyword">false</span></span><br><span class="line">AuthorityKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line"><span class="number">0000</span>: A1 <span class="number">13</span> <span class="number">54</span> DC <span class="number">56</span> <span class="number">73</span> <span class="number">2</span>C <span class="number">27</span>   <span class="number">82</span> CA C8 <span class="number">84</span> EF EE BF <span class="number">00</span>  ..T.Vs,<span class="string">'........</span></span><br><span class="line"><span class="string">0010: FD 5F AB 56                                        ._.V</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[3]: ObjectId: 2.5.29.19 Criticality=true</span></span><br><span class="line"><span class="string">BasicConstraints:[</span></span><br><span class="line"><span class="string">  CA:false</span></span><br><span class="line"><span class="string">  PathLen: undefined</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[4]: ObjectId: 2.5.29.31 Criticality=false</span></span><br><span class="line"><span class="string">CRLDistributionPoints [</span></span><br><span class="line"><span class="string">  [DistributionPoint:</span></span><br><span class="line"><span class="string">     [URIName: http://wosign.crl.certum.pl/wosign-ovca.crl]</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[5]: ObjectId: 2.5.29.32 Criticality=false</span></span><br><span class="line"><span class="string">CertificatePolicies [</span></span><br><span class="line"><span class="string">  [CertificatePolicyId: [2.23.140.1.2.2]</span></span><br><span class="line"><span class="string">[]  ]</span></span><br><span class="line"><span class="string">  [CertificatePolicyId: [1.2.616.1.113527.2.5.1.12.2]</span></span><br><span class="line"><span class="string">[PolicyQualifierInfo: [</span></span><br><span class="line"><span class="string">  qualifierID: 1.3.6.1.5.5.7.2.2</span></span><br><span class="line"><span class="string">  qualifier:</span></span><br><span class="line"><span class="string">0000: 30 81 E4 30 1F 16 18 41   73 73 65 63 6F 20 44 61  0..0...Asseco Da</span></span><br><span class="line"><span class="string">0010: 74 61 20 53 79 73 74 65   6D 73 20 53 2E 41 2E 30  ta Systems S.A.0</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">]]  ]</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[6]: ObjectId: 2.5.29.37 Criticality=false</span></span><br><span class="line"><span class="string">ExtendedKeyUsages [</span></span><br><span class="line"><span class="string">  serverAuth</span></span><br><span class="line"><span class="string">  clientAuth</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[7]: ObjectId: 2.5.29.15 Criticality=true</span></span><br><span class="line"><span class="string">KeyUsage [</span></span><br><span class="line"><span class="string">  DigitalSignature</span></span><br><span class="line"><span class="string">  Key_Encipherment</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[8]: ObjectId: 2.5.29.17 Criticality=false</span></span><br><span class="line"><span class="string">SubjectAlternativeName [</span></span><br><span class="line"><span class="string">  DNSName: *.dcpc.com</span></span><br><span class="line"><span class="string">  DNSName: dcpc.com</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[9]: ObjectId: 2.5.29.14 Criticality=false</span></span><br><span class="line"><span class="string">SubjectKeyIdentifier [</span></span><br><span class="line"><span class="string">KeyIdentifier [</span></span><br><span class="line"><span class="string">0000: B3 A6 53 AD 96 D8 B7 51   09 D5 E1 07 E5 B2 BC E6  ..S....Q........</span></span><br><span class="line"><span class="string">0010: B5 F2 82 2B                                        ...+</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">  Algorithm: [SHA256withRSA]</span></span><br><span class="line"><span class="string">  Signature:</span></span><br><span class="line"><span class="string">0000: 9A 38 A4 8F B2 A8 CE 9A   B6 98 2F 8F 18 AA 45 79  .8......../...Ey</span></span><br><span class="line"><span class="string">0010: DE D6 31 22 99 6E D7 14   45 5E C1 1F 06 EC 7F C9  ..1".n..E^......</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[read] MD5 and SHA1 hashes:  len = 1492</span></span><br><span class="line"><span class="string">0000: 0B 00 05 D0 00 05 CD 00   05 CA 30 82 05 C6 30 82  ..........0...0.</span></span><br><span class="line"><span class="string">0010: 04 AE A0 03 02 01 02 02   10 36 3F A1 7D 5C 46 08  .........6?..\F.</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** ServerHelloDone</span></span><br><span class="line"><span class="string">[read] MD5 and SHA1 hashes:  len = 4</span></span><br><span class="line"><span class="string">0000: 0E 00 00 00                                        ....</span></span><br><span class="line"><span class="string">*** ClientKeyExchange, RSA PreMasterSecret, TLSv1</span></span><br><span class="line"><span class="string">[write] MD5 and SHA1 hashes:  len = 262</span></span><br><span class="line"><span class="string">0000: 10 00 01 02 01 00 85 BD   72 17 92 EA 05 0F 0A BD  ........r.......</span></span><br><span class="line"><span class="string">0010: 90 92 72 51 08 0F 6E 29   C4 A2 F0 D2 BA 78 0B A0  ..rQ..n).....x..</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">DefaultQuartzScheduler_Worker-3, WRITE: TLSv1 Handshake, length = 262</span></span><br><span class="line"><span class="string">[Raw write]: length = 267</span></span><br><span class="line"><span class="string">0000: 16 03 01 01 06 10 00 01   02 01 00 85 BD 72 17 92  .............r..</span></span><br><span class="line"><span class="string">0010: EA 05 0F 0A BD 90 92 72   51 08 0F 6E 29 C4 A2 F0  .......rQ..n)...</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">SESSION KEYGEN:</span></span><br><span class="line"><span class="string">PreMaster Secret:</span></span><br><span class="line"><span class="string">0000: 03 01 80 92 4B 03 FA 1D   39 CE F4 82 3D 4A 96 A7  ....K...9...=J..</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">CONNECTION KEYGEN:</span></span><br><span class="line"><span class="string">Client Nonce:</span></span><br><span class="line"><span class="string">0000: 5A 72 D8 54 5F 78 84 D8   45 22 CD 49 85 1E F0 B2  Zr.T_x..E".I....</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">Server Nonce:</span></span><br><span class="line"><span class="string">0000: 5A 72 63 4E F2 CF 4B 0F   CE 58 0E EF 36 D4 F3 3E  ZrcN..K..X..6..&gt;</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">Master Secret:</span></span><br><span class="line"><span class="string">0000: 93 05 C4 97 B7 FB 23 5F   11 15 8A 8E 2C C1 C7 72  ......#_....,..r</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">Client MAC write Secret:</span></span><br><span class="line"><span class="string">0000: 22 84 BA CD 61 27 D9 62   5F 84 FA 7A DF 05 DE 0A  "...a'</span>.b_..z....</span><br><span class="line">...</span><br><span class="line">Server MAC write Secret:</span><br><span class="line"><span class="number">0000</span>: D2 AC <span class="number">73</span> AC CE F2 D2 <span class="number">00</span>   <span class="number">31</span> E6 <span class="number">4F</span> <span class="number">8</span>A DE E3 <span class="number">97</span> <span class="number">8</span>D  ..s.....<span class="number">1</span>.O.....</span><br><span class="line"><span class="number">0010</span>: <span class="number">73</span> <span class="number">52</span> BA D2                                        sR..</span><br><span class="line">Client write key:</span><br><span class="line"><span class="number">0000</span>: CA FB B2 <span class="number">02</span> E7 <span class="number">3F</span> <span class="number">79</span> <span class="number">93</span>   <span class="number">55</span> <span class="number">61</span> CB AB FF EF <span class="number">1</span>E <span class="number">76</span>  .....?y.Ua.....v</span><br><span class="line"><span class="number">0010</span>: <span class="number">10</span> <span class="number">4</span>C DD DE <span class="number">83</span> <span class="number">55</span> <span class="number">99</span> <span class="number">6F</span>   <span class="number">28</span> <span class="number">8</span>E <span class="number">19</span> <span class="number">5</span>D <span class="number">18</span> <span class="number">25</span> <span class="number">33</span> A2  .L...U.o(..].%<span class="number">3</span>.</span><br><span class="line">Server write key:</span><br><span class="line"><span class="number">0000</span>: <span class="number">1</span>A <span class="number">25</span> <span class="number">31</span> <span class="number">69</span> D2 <span class="number">3</span>B <span class="number">45</span> D7   <span class="number">70</span> <span class="number">09</span> <span class="number">5F</span> <span class="number">9</span>A FF D5 B3 <span class="number">71</span>  .%<span class="number">1</span>i.;E.p._....q</span><br><span class="line"><span class="number">0010</span>: <span class="number">73</span> <span class="number">9</span>D D6 <span class="number">52</span> F0 <span class="number">10</span> <span class="number">21</span> <span class="number">8</span>B   <span class="number">8</span>E <span class="number">13</span> <span class="number">97</span> BE B1 <span class="number">02</span> <span class="number">75</span> <span class="number">46</span>  s..R..!.......uF</span><br><span class="line">Client write IV:</span><br><span class="line"><span class="number">0000</span>: <span class="number">68</span> <span class="number">49</span> <span class="number">14</span> C3 A2 <span class="number">97</span> <span class="number">75</span> A0   F3 AC <span class="number">89</span> DA <span class="number">31</span> <span class="number">84</span> C3 EF  hI....u.....<span class="number">1</span>...</span><br><span class="line">Server write IV:</span><br><span class="line"><span class="number">0000</span>: <span class="number">2</span>C <span class="number">03</span> <span class="number">9</span>D <span class="number">28</span> <span class="number">6F</span> C2 <span class="number">7</span>D BD   <span class="number">37</span> B1 AA E5 <span class="number">30</span> <span class="number">6</span>E <span class="number">09</span> EA  ,..(o...<span class="number">7</span>...<span class="number">0</span>n..</span><br><span class="line">DefaultQuartzScheduler_Worker-<span class="number">3</span>, WRITE: TLSv1 Change Cipher Spec, length = <span class="number">1</span></span><br><span class="line">[Raw write]: length = <span class="number">6</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">14</span> <span class="number">03</span> <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> <span class="number">01</span>                                  ......</span><br><span class="line">*** Finished</span><br><span class="line">verify_data:  &#123; <span class="number">56</span>, <span class="number">169</span>, <span class="number">160</span>, <span class="number">43</span>, <span class="number">198</span>, <span class="number">100</span>, <span class="number">229</span>, <span class="number">140</span>, <span class="number">160</span>, <span class="number">251</span>, <span class="number">76</span>, <span class="number">146</span> &#125;</span><br><span class="line">***</span><br><span class="line">[write] MD5 and SHA1 hashes:  len = <span class="number">16</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>C <span class="number">38</span> A9 A0 <span class="number">2</span>B   C6 <span class="number">64</span> E5 <span class="number">8</span>C A0 FB <span class="number">4</span>C <span class="number">92</span>  ....<span class="number">8</span>..+.d....L.</span><br><span class="line">Padded plaintext before ENCRYPTION:  len = <span class="number">48</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>C <span class="number">38</span> A9 A0 <span class="number">2</span>B   C6 <span class="number">64</span> E5 <span class="number">8</span>C A0 FB <span class="number">4</span>C <span class="number">92</span>  ....<span class="number">8</span>..+.d....L.</span><br><span class="line"><span class="number">0010</span>: F5 B1 BB DE F4 <span class="number">25</span> ED A2   <span class="number">3</span>A <span class="number">18</span> <span class="number">9</span>D C8 <span class="number">8</span>E EE <span class="number">2</span>B A6  .....%..:.....+.</span><br><span class="line"><span class="number">0020</span>: <span class="number">4</span>A <span class="number">1</span>E <span class="number">3</span>A C7 <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B   <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B <span class="number">0</span>B  J.:.............</span><br><span class="line">DefaultQuartzScheduler_Worker-<span class="number">3</span>, WRITE: TLSv1 Handshake, length = <span class="number">48</span></span><br><span class="line">[Raw write]: length = <span class="number">53</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">16</span> <span class="number">03</span> <span class="number">01</span> <span class="number">00</span> <span class="number">30</span> <span class="number">4</span>E <span class="number">92</span> <span class="number">1F</span>   <span class="number">3</span>A <span class="number">1F</span> <span class="number">91</span> C8 <span class="number">1</span>B <span class="number">9F</span> <span class="number">6</span>B <span class="number">3</span>A  ....<span class="number">0</span>N..:.....k:</span><br><span class="line"><span class="number">0010</span>: CC <span class="number">2</span>C <span class="number">67</span> <span class="number">2</span>C <span class="number">9</span>D CA <span class="number">58</span> DA   <span class="number">4F</span> <span class="number">91</span> <span class="number">21</span> <span class="number">01</span> <span class="number">8</span>E D8 <span class="number">5</span>A <span class="number">37</span>  .,g,..X.O.!...Z7</span><br><span class="line"><span class="number">0020</span>: <span class="number">67</span> B8 BD A9 E4 F3 <span class="number">79</span> E9   <span class="number">9</span>C E6 E1 <span class="number">52</span> BB <span class="number">8</span>D <span class="number">39</span> <span class="number">0</span>E  g.....y....R..<span class="number">9</span>.</span><br><span class="line"><span class="number">0030</span>: <span class="number">45</span> <span class="number">5F</span> F5 <span class="number">7</span>E <span class="number">7</span>A                                     E_..z</span><br><span class="line">[Raw read]: length = <span class="number">5</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">14</span> <span class="number">03</span> <span class="number">01</span> <span class="number">00</span> <span class="number">01</span>                                     .....</span><br><span class="line">[Raw read]: length = <span class="number">1</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">01</span>                                                 .</span><br><span class="line">DefaultQuartzScheduler_Worker-<span class="number">3</span>, READ: TLSv1 Change Cipher Spec, length = <span class="number">1</span></span><br><span class="line">[Raw read]: length = <span class="number">5</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">16</span> <span class="number">03</span> <span class="number">01</span> <span class="number">00</span> <span class="number">30</span>                                     ....<span class="number">0</span></span><br><span class="line">[Raw read]: length = <span class="number">48</span></span><br><span class="line"><span class="number">0000</span>: A9 B4 AB <span class="number">6</span>C <span class="number">68</span> BA <span class="number">47</span> DB   CF <span class="number">6</span>E EF <span class="number">8</span>A F2 <span class="number">6F</span> BD <span class="number">73</span>  ...lh.G..n...o.s</span><br><span class="line"><span class="number">0010</span>: E4 <span class="number">44</span> <span class="number">55</span> C8 <span class="number">93</span> <span class="number">1</span>B <span class="number">4</span>B C6   D9 A3 DB <span class="number">4</span>D <span class="number">03</span> <span class="number">3</span>B E0 <span class="number">8</span>D  .DU...K....M.;..</span><br><span class="line"><span class="number">0020</span>: <span class="number">67</span> ED E8 <span class="number">35</span> CA <span class="number">63</span> D8 F8   C8 <span class="number">11</span> <span class="number">40</span> <span class="number">1</span>B <span class="number">54</span> DD <span class="number">6F</span> F2  g..<span class="number">5</span>.c....@.T.o.</span><br><span class="line">DefaultQuartzScheduler_Worker-<span class="number">3</span>, READ: TLSv1 Handshake, length = <span class="number">48</span></span><br><span class="line">Padded plaintext after DECRYPTION:  len = <span class="number">48</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>C <span class="number">58</span> <span class="number">5</span>A F4 F0   FA C9 BE <span class="number">1</span>D <span class="number">27</span> <span class="number">6</span>A A5 <span class="number">3</span>A  ....XZ......<span class="string">'j.:</span></span><br><span class="line"><span class="string">0010: DC 90 D1 52 C8 53 16 DD   CB 04 E9 F0 F7 46 E2 9F  ...R.S.......F..</span></span><br><span class="line"><span class="string">0020: 9E A6 EF 63 0B 0B 0B 0B   0B 0B 0B 0B 0B 0B 0B 0B  ...c............</span></span><br><span class="line"><span class="string">*** Finished</span></span><br><span class="line"><span class="string">verify_data:  &#123; 88, 90, 244, 240, 250, 201, 190, 29, 39, 106, 165, 58 &#125;</span></span><br><span class="line"><span class="string">***</span></span><br><span class="line"><span class="string">%% Cached client session: [Session-8, TLS_RSA_WITH_AES_256_CBC_SHA]</span></span><br><span class="line"><span class="string">[read] MD5 and SHA1 hashes:  len = 16</span></span><br><span class="line"><span class="string">0000: 14 00 00 0C 58 5A F4 F0   FA C9 BE 1D 27 6A A5 3A  ....XZ......'</span>j.:</span><br><span class="line">DefaultQuartzScheduler_Worker-<span class="number">3</span>, setSoTimeout(<span class="number">9000000</span>) called</span><br><span class="line">Padded plaintext before ENCRYPTION:  len = <span class="number">960</span></span><br><span class="line">##å‘é€æ•°æ®</span><br><span class="line"><span class="number">0000</span>: <span class="number">50</span> <span class="number">4F</span> <span class="number">53</span> <span class="number">54</span> <span class="number">20</span> <span class="number">2F</span> <span class="number">69</span> <span class="number">64</span>   <span class="number">6</span>D <span class="number">2F</span> <span class="number">77</span> <span class="number">73</span> <span class="number">2F</span> <span class="number">55</span> <span class="number">6</span>E <span class="number">69</span>  POST /idm/ws/Uni</span><br><span class="line"><span class="number">0010</span>: <span class="number">74</span> <span class="number">53</span> <span class="number">65</span> <span class="number">72</span> <span class="number">76</span> <span class="number">69</span> <span class="number">63</span> <span class="number">65</span>   <span class="number">20</span> <span class="number">48</span> <span class="number">54</span> <span class="number">54</span> <span class="number">50</span> <span class="number">2F</span> <span class="number">31</span> <span class="number">2</span>E  tService HTTP/<span class="number">1</span>.</span><br><span class="line"><span class="number">0020</span>: <span class="number">30</span> <span class="number">0</span>D <span class="number">0</span>A <span class="number">43</span> <span class="number">6F</span> <span class="number">6</span>E <span class="number">74</span> <span class="number">65</span>   <span class="number">6</span>E <span class="number">74</span> <span class="number">2</span>D <span class="number">54</span> <span class="number">79</span> <span class="number">70</span> <span class="number">65</span> <span class="number">3</span>A  <span class="number">0</span>..Content-Type:</span><br><span class="line"><span class="number">0030</span>: <span class="number">20</span> <span class="number">74</span> <span class="number">65</span> <span class="number">78</span> <span class="number">74</span> <span class="number">2F</span> <span class="number">78</span> <span class="number">6</span>D   <span class="number">6</span>C <span class="number">3</span>B <span class="number">20</span> <span class="number">63</span> <span class="number">68</span> <span class="number">61</span> <span class="number">72</span> <span class="number">73</span>   text/xml; chars</span><br><span class="line"><span class="number">0040</span>: <span class="number">65</span> <span class="number">74</span> <span class="number">3</span>D <span class="number">75</span> <span class="number">74</span> <span class="number">66</span> <span class="number">2</span>D <span class="number">38</span>   <span class="number">0</span>D <span class="number">0</span>A <span class="number">41</span> <span class="number">63</span> <span class="number">63</span> <span class="number">65</span> <span class="number">70</span> <span class="number">74</span>  et=utf-<span class="number">8</span>..Accept</span><br><span class="line"><span class="number">0050</span>: <span class="number">3</span>A <span class="number">20</span> <span class="number">61</span> <span class="number">70</span> <span class="number">70</span> <span class="number">6</span>C <span class="number">69</span> <span class="number">63</span>   <span class="number">61</span> <span class="number">74</span> <span class="number">69</span> <span class="number">6F</span> <span class="number">6</span>E <span class="number">2F</span> <span class="number">73</span> <span class="number">6F</span>  : application/so</span><br><span class="line"><span class="number">0060</span>: <span class="number">61</span> <span class="number">70</span> <span class="number">2</span>B <span class="number">78</span> <span class="number">6</span>D <span class="number">6</span>C <span class="number">2</span>C <span class="number">20</span>   <span class="number">61</span> <span class="number">70</span> <span class="number">70</span> <span class="number">6</span>C <span class="number">69</span> <span class="number">63</span> <span class="number">61</span> <span class="number">74</span>  ap+xml, applicat</span><br><span class="line"><span class="number">0070</span>: <span class="number">69</span> <span class="number">6F</span> <span class="number">6</span>E <span class="number">2F</span> <span class="number">64</span> <span class="number">69</span> <span class="number">6</span>D <span class="number">65</span>   <span class="number">2</span>C <span class="number">20</span> <span class="number">6</span>D <span class="number">75</span> <span class="number">6</span>C <span class="number">74</span> <span class="number">69</span> <span class="number">70</span>  ion/dime, multip</span><br><span class="line"><span class="number">0080</span>: <span class="number">61</span> <span class="number">72</span> <span class="number">74</span> <span class="number">2F</span> <span class="number">72</span> <span class="number">65</span> <span class="number">6</span>C <span class="number">61</span>   <span class="number">74</span> <span class="number">65</span> <span class="number">64</span> <span class="number">2</span>C <span class="number">20</span> <span class="number">74</span> <span class="number">65</span> <span class="number">78</span>  art/related, tex</span><br><span class="line"><span class="number">0090</span>: <span class="number">74</span> <span class="number">2F</span> <span class="number">2</span>A <span class="number">0</span>D <span class="number">0</span>A <span class="number">55</span> <span class="number">73</span> <span class="number">65</span>   <span class="number">72</span> <span class="number">2</span>D <span class="number">41</span> <span class="number">67</span> <span class="number">65</span> <span class="number">6</span>E <span class="number">74</span> <span class="number">3</span>A  t<span class="comment">/*..User-Agent:</span></span><br><span class="line"><span class="comment">00A0: 20 41 78 69 73 2F 31 2E   34 0D 0A 48 6F 73 74 3A   Axis/1.4..Host:</span></span><br><span class="line"><span class="comment">00B0: 20 69 64 6D 74 65 73 74   2E 64 63 70 63 2E 63 6F   ***.***.co</span></span><br><span class="line"><span class="comment">00C0: 6D 3A 38 34 34 33 0D 0A   43 61 63 68 65 2D 43 6F  m:8443..Cache-Co</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, WRITE: TLSv1 Application Data, length = 960</span></span><br><span class="line"><span class="comment">[Raw write]: length = 965</span></span><br><span class="line"><span class="comment">0000: 17 03 01 03 C0 76 73 C9   5C 37 18 B3 8D 85 B6 4A  .....vs.\7.....J</span></span><br><span class="line"><span class="comment">0010: A5 FF 06 E0 81 74 E2 46   22 C7 32 12 51 A6 C4 10  .....t.F".2.Q...</span></span><br><span class="line"><span class="comment">0020: 7E 1D 14 C6 1E 1B 44 95   57 6E AC 83 AA 8D A7 92  ......D.Wn......</span></span><br><span class="line"><span class="comment">0030: 4C 34 01 5D E9 A1 1E 8C   BB 03 55 D9 7A 09 0F 1E  L4.]......U.z...</span></span><br><span class="line"><span class="comment">0040: 5D C4 71 46 CA 29 72 0D   C1 CC F8 CE 6E F9 51 3A  ].qF.)r.....n.Q:</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">[Raw read]: length = 5</span></span><br><span class="line"><span class="comment">0000: 17 03 01 01 60                                     ....`</span></span><br><span class="line"><span class="comment">[Raw read]: length = 352</span></span><br><span class="line"><span class="comment">0000: CD C2 06 A2 9F EA 9F 00   C7 27 5E F0 B3 C4 3D 78  .........'^...=x</span></span><br><span class="line"><span class="comment">0010: 2E 9B F4 52 08 FF D7 05   2E A8 1B 42 3F 9A 3D 73  ...R.......B?.=s</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, READ: TLSv1 Application Data, length = 352</span></span><br><span class="line"><span class="comment">##æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="comment">Padded plaintext after DECRYPTION:  len = 352</span></span><br><span class="line"><span class="comment">0000: 48 54 54 50 2F 31 2E 31   20 32 30 30 20 0D 0A 43  HTTP/1.1 200 ..C</span></span><br><span class="line"><span class="comment">0010: 6F 6E 74 65 6E 74 2D 54   79 70 65 3A 20 74 65 78  ontent-Type: tex</span></span><br><span class="line"><span class="comment">0020: 74 2F 78 6D 6C 3B 63 68   61 72 73 65 74 3D 55 54  t/xml;charset=UT</span></span><br><span class="line"><span class="comment">0030: 46 2D 38 0D 0A 44 61 74   65 3A 20 54 68 75 2C 20  F-8..Date: Thu,</span></span><br><span class="line"><span class="comment">0040: 30 31 20 46 65 62 20 32   30 31 38 20 30 39 3A 30  01 Feb 2018 09:0</span></span><br><span class="line"><span class="comment">0050: 35 3A 32 35 20 47 4D 54   0D 0A 43 6F 6E 6E 65 63  5:25 GMT..Connec</span></span><br><span class="line"><span class="comment">0060: 74 69 6F 6E 3A 20 63 6C   6F 73 65 0D 0A 0D 0A 3C  tion: close....&lt;</span></span><br><span class="line"><span class="comment">0070: 73 6F 61 70 3A 45 6E 76   65 6C 6F 70 65 20 78 6D  soap:Envelope xm</span></span><br><span class="line"><span class="comment">0080: 6C 6E 73 3A 73 6F 61 70   3D 22 68 74 74 70 3A 2F  lns:soap="http:/</span></span><br><span class="line"><span class="comment">0090: 2F 73 63 68 65 6D 61 73   2E 78 6D 6C 73 6F 61 70  /schemas.xmlsoap</span></span><br><span class="line"><span class="comment">00A0: 2E 6F 72 67 2F 73 6F 61   70 2F 65 6E 76 65 6C 6F  .org/soap/envelo</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">[Raw read]: length = 5</span></span><br><span class="line"><span class="comment">0000: 15 03 01 00 20                                     ....</span></span><br><span class="line"><span class="comment">[Raw read]: length = 32</span></span><br><span class="line"><span class="comment">0000: 10 E4 3E EF D9 D6 A2 0F   F3 11 85 6F 8F 68 48 C8  ..&gt;........o.hH.</span></span><br><span class="line"><span class="comment">0010: 26 73 2E C8 FA 9D 00 03   AB 3B 79 46 DE ED CC 40  &amp;s.......;yF...@</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, READ: TLSv1 Alert, length = 32</span></span><br><span class="line"><span class="comment">Padded plaintext after DECRYPTION:  len = 32</span></span><br><span class="line"><span class="comment">0000: 01 00 C2 40 0A 51 E1 F1   28 06 65 73 E4 84 81 01  ...@.Q..(.es....</span></span><br><span class="line"><span class="comment">0010: 8F A9 A1 FD A9 6E 09 09   09 09 09 09 09 09 09 09  .....n..........</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, RECV TLSv1 ALERT:  warning, close_notify</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, called closeInternal(false)</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, SEND TLSv1 ALERT:  warning, description = close_notify</span></span><br><span class="line"><span class="comment">Padded plaintext before ENCRYPTION:  len = 32</span></span><br><span class="line"><span class="comment">0000: 01 00 4F BB 75 8C 9C 8A   12 64 D7 62 F6 AF 81 90  ..O.u....d.b....</span></span><br><span class="line"><span class="comment">0010: 92 0E 91 25 6F 9B 09 09   09 09 09 09 09 09 09 09  ...%o...........</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, WRITE: TLSv1 Alert, length = 32</span></span><br><span class="line"><span class="comment">[Raw write]: length = 37</span></span><br><span class="line"><span class="comment">0000: 15 03 01 00 20 C1 60 66   8A 2A 1D A5 6C 82 C3 59  .... .`f.*..l..Y</span></span><br><span class="line"><span class="comment">0010: A8 D5 E9 28 70 1D 93 F1   DD 34 00 14 1F 56 12 46  ...(p....4...V.F</span></span><br><span class="line"><span class="comment">0020: 33 0C 4C 3F 51                                     3.L?Q</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, called closeSocket(selfInitiated)</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, called close()</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, called closeInternal(true)</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, called close()</span></span><br><span class="line"><span class="comment">DefaultQuartzScheduler_Worker-3, called closeInternal(true)</span></span><br></pre></td></tr></table></figure><h3 id="è¯ä¹¦è¯†åˆ«"><a href="#è¯ä¹¦è¯†åˆ«" class="headerlink" title="è¯ä¹¦è¯†åˆ«"></a>è¯ä¹¦è¯†åˆ«</h3><p>Javaç¨‹åºå¯¹å—ä¿¡è¯ä¹¦çš„æŸ¥æ‰¾é¡ºåºæ˜¯ï¼š</p><ol><li><p>javax.net.ssl.trustStore</p><p>å°±æ˜¯System.setProperty(â€œjavax.net.ssl.trustStoreâ€,â€D:\cacert.keystoreâ€);æˆ–è€…é€šè¿‡JVMå‚æ•°æŒ‡å®šï¼š-Djavax.net.ssl.trustStore=D:\cacert.keystoreã€‚</p></li><li><p>JAVA_HOME\jre\lib\security\jssecacerts ã€æ¨èã€‘</p><p>é»˜è®¤æ²¡æœ‰jssecacertsï¼Œä¸€èˆ¬æŠŠcacertså¤åˆ¶æˆjssecacertsï¼Œç„¶åå†ä½¿ç”¨keytoolæ¥ä¿®æ”¹å®ƒã€‚jsseçš„å…¨ç§°æ˜¯Java Secure Socket Extensionã€‚</p></li><li><p>JAVA_HOME\jre\lib\security\cacerts</p><p>é€šå¸¸æƒ…å†µä¸‹ä¸å°±å»ºè®®é€šè¿‡-Djavax.net.ssl.trustStore=D:\cacert.keystoreæ¥ç›´æ¥ä¿®æ”¹keystoreæ–‡ä»¶çš„ä½ç½®ï¼Œå› ä¸ºè¿™æ ·ä¼šé€ æˆç³»ç»Ÿä¸­å…¶ä»–æ¨¡å—å¯èƒ½æ‰¾ä¸åˆ°è‡ªå·±å¯¹åº”çš„è¯ä¹¦äº†ã€‚æ¨èä½¿ç”¨jssecacertsã€‚æˆ‘ä»¬éœ€è¦ä»€ä¹ˆè¯ä¹¦ç›´æ¥å¾€è¿™ä¸ªä½ç½®å¯¼å°±è¡Œäº†ã€‚ç¨‹åºä¸éœ€è¦åšè°ƒæ•´ã€‚</p></li></ol><h3 id="Springboot-ç¨‹åºå®ç°"><a href="#Springboot-ç¨‹åºå®ç°" class="headerlink" title="Springboot ç¨‹åºå®ç°"></a>Springboot ç¨‹åºå®ç°</h3><p>æˆ‘ä»¬å¸Œæœ›åœ¨Springbootåº”ç”¨æ¯æ¬¡å¯åŠ¨åéƒ½å‘æœåŠ¡å™¨è¯·æ±‚è¯ä¹¦ï¼Œå¹¶å°†è¯ä¹¦æ›´æ–°åˆ°Keystoreä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line">@ConditionalOnProperty(value = &quot;cert.installation&quot;, havingValue = &quot;true&quot;)</span><br><span class="line">@ConfigurationProperties(&quot;cert&quot;)</span><br><span class="line">@Configuration</span><br><span class="line">public class InstallCert implements CommandLineRunner &#123;</span><br><span class="line"></span><br><span class="line">private static Logger logger = LoggerFactory.getLogger(InstallCert.class);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç”Ÿæˆçš„è¯ä¹¦éœ€è¦å­˜æ”¾çš„securityè·¯å¾„ï¼Œå³ï¼š %JAVA_HOME%\jre\lib\security</span><br><span class="line"> */</span><br><span class="line">private String path;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * éœ€è¦SSLè®¤è¯çš„åŸŸå</span><br><span class="line"> */</span><br><span class="line">private List&lt;String&gt; domains = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private String password = &quot;changeit&quot;;</span><br><span class="line"></span><br><span class="line">public String getPath() &#123;</span><br><span class="line">return path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setPath(String path) &#123;</span><br><span class="line">this.path = path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public List&lt;String&gt; getDomains() &#123;</span><br><span class="line">return domains;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setDomains(List&lt;String&gt; domains) &#123;</span><br><span class="line">this.domains = domains;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String getPassword() &#123;</span><br><span class="line">return password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setPassword(String password) &#123;</span><br><span class="line">this.password = password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void run(String... strings) throws Exception &#123;</span><br><span class="line">logger.info(&quot;ready to install valid certs&quot;);</span><br><span class="line">if (!Collections.isEmpty(domains))&#123;</span><br><span class="line">logger.info(&quot;domains is &#123;&#125;&quot;, domains.toString());</span><br><span class="line">String[] arrayStr = new String[domains.size()];</span><br><span class="line">installValidCerts(domains.toArray(arrayStr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void installValidCerts(String[] args) throws Exception &#123;</span><br><span class="line">logger.info(&quot;Usage: java InstallCert &lt;host&gt;[:port] [passphrase]&quot;);</span><br><span class="line"></span><br><span class="line">char[] passphrase = password.toCharArray();</span><br><span class="line"></span><br><span class="line">String certPath = path;</span><br><span class="line">if (Strings.isNullOrEmpty(path))&#123;</span><br><span class="line">char separator = File.separatorChar;</span><br><span class="line">certPath = System.getProperty(&quot;java.home&quot;) + separator + &quot;lib&quot; + separator + &quot;security&quot;;</span><br><span class="line">&#125;</span><br><span class="line">File dir = new File(certPath);</span><br><span class="line"></span><br><span class="line">//File file = new File(&quot;jssecacerts&quot;);</span><br><span class="line">//if (file.isFile() == false) &#123;</span><br><span class="line">//char SEP = File.separatorChar;</span><br><span class="line">//File dir = new File(System.getProperty(&quot;java.home&quot;) + SEP + &quot;lib&quot; + SEP + &quot;security&quot;);</span><br><span class="line">//file = new File(dir, &quot;jssecacerts&quot;);</span><br><span class="line">//if (file.isFile() == false) &#123;</span><br><span class="line">//file = new File(dir, &quot;cacerts&quot;);</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">InputStream in = null;</span><br><span class="line">logger.info(&quot;jre security dir path: &#123;&#125;&quot;, dir.getCanonicalPath());</span><br><span class="line">File file = new File(dir, &quot;jssecacerts&quot;);</span><br><span class="line">if (!file.exists() &amp;&amp; !file.isFile())&#123;</span><br><span class="line">file.createNewFile();</span><br><span class="line">File file1 = new File(dir, &quot;cacerts&quot;);</span><br><span class="line">if (!file1.isFile())&#123;</span><br><span class="line">logger.info(&quot;no certs will be registered, casue no cacerts file was found&quot;);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">in = new FileInputStream(file1);</span><br><span class="line">ks.load(in, passphrase);</span><br><span class="line">logger.info(&quot;file jssecacerts is created successfully&quot;);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">in = new FileInputStream(file);</span><br><span class="line">ks.load(in, passphrase);</span><br><span class="line">logger.info(&quot;file jssecacerts is existing, will not create again&quot;);</span><br><span class="line">&#125;</span><br><span class="line">IOUtils.closeQuietly(in);</span><br><span class="line"></span><br><span class="line">logger.info(&quot;Loading KeyStore &quot; + file + &quot;...&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSLContext context = SSLContext.getInstance(&quot;TLS&quot;);</span><br><span class="line">TrustManagerFactory tmf = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());</span><br><span class="line">tmf.init(ks);</span><br><span class="line">X509TrustManager defaultTrustManager = (X509TrustManager) tmf.getTrustManagers()[0];</span><br><span class="line">SavingTrustManager tm = new SavingTrustManager(defaultTrustManager);</span><br><span class="line">context.init(null, new TrustManager[] &#123; tm &#125;, null);</span><br><span class="line">SSLSocketFactory factory = context.getSocketFactory();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OutputStream out = new FileOutputStream(file);</span><br><span class="line">for (String domain: args)&#123;</span><br><span class="line">logger.info(&quot;domain is &#123;&#125;&quot;, domain);</span><br><span class="line">String[] c = args[0].split(&quot;:&quot;);</span><br><span class="line">String host = c[0];</span><br><span class="line">int port = (c.length == 1) ? 443 : Integer.parseInt(c[1]);</span><br><span class="line">logger.info(&quot;Opening connection to &quot; + host + &quot;:&quot; + port + &quot;...&quot;);</span><br><span class="line">SSLSocket socket = (SSLSocket) factory.createSocket(host, port);</span><br><span class="line">socket.setSoTimeout(10000);</span><br><span class="line">try &#123;</span><br><span class="line">logger.info(&quot;Starting SSL handshake...&quot;);</span><br><span class="line">socket.startHandshake();</span><br><span class="line">socket.close();</span><br><span class="line">logger.info(&quot;No errors, certificate is already trusted&quot;);</span><br><span class="line">&#125; catch (SSLException e) &#123;</span><br><span class="line">e.printStackTrace(System.out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">X509Certificate[] chain = tm.chain;</span><br><span class="line">if (chain == null) &#123;</span><br><span class="line">logger.info(&quot;Could not obtain server certificate chain, continue next one&quot;);</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logger.info(&quot;Server sent &quot; + chain.length + &quot; certificate(s):&quot;);</span><br><span class="line">MessageDigest sha1 = MessageDigest.getInstance(&quot;SHA1&quot;);</span><br><span class="line">MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;);</span><br><span class="line">for (int i = 0; i &lt; chain.length; i++) &#123;</span><br><span class="line">X509Certificate cert = chain[i];</span><br><span class="line">logger.info(&quot; &quot; + (i + 1) + &quot; Subject &quot; + cert.getSubjectDN());</span><br><span class="line">logger.info(&quot;   Issuer  &quot; + cert.getIssuerDN());</span><br><span class="line">sha1.update(cert.getEncoded());</span><br><span class="line">logger.info(&quot;   sha1    &quot; + toHexString(sha1.digest()));</span><br><span class="line">md5.update(cert.getEncoded());</span><br><span class="line">logger.info(&quot;   md5     &quot; + toHexString(md5.digest()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int k=0;</span><br><span class="line"></span><br><span class="line">X509Certificate cert = chain[k];</span><br><span class="line">String alias = host + &quot;-&quot; + (k + 1);</span><br><span class="line">ks.setCertificateEntry(alias, cert);</span><br><span class="line">ks.store(out, passphrase);</span><br><span class="line"></span><br><span class="line">logger.info(cert.toString());</span><br><span class="line">logger.info(&quot;Added &#123;&#125; certificate to keystore &apos;jssecacerts&apos; using alias &#123;&#125;&quot;, domain, alias);</span><br><span class="line">&#125;</span><br><span class="line">IOUtils.closeQuietly(out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static final char[] HEXDIGITS = &quot;0123456789abcdef&quot;.toCharArray();</span><br><span class="line"></span><br><span class="line">private static String toHexString(byte[] bytes) &#123;</span><br><span class="line">StringBuilder sb = new StringBuilder(bytes.length * 3);</span><br><span class="line">for (int b : bytes) &#123;</span><br><span class="line">b &amp;= 0xff;</span><br><span class="line">sb.append(HEXDIGITS[b &gt;&gt; 4]);</span><br><span class="line">sb.append(HEXDIGITS[b &amp; 15]);</span><br><span class="line">sb.append(&apos; &apos;);</span><br><span class="line">&#125;</span><br><span class="line">return sb.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private static class SavingTrustManager implements X509TrustManager &#123;</span><br><span class="line"></span><br><span class="line">private final X509TrustManager tm;</span><br><span class="line">private X509Certificate[] chain;</span><br><span class="line"></span><br><span class="line">SavingTrustManager(X509TrustManager tm) &#123;</span><br><span class="line">this.tm = tm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException &#123;</span><br><span class="line">throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException &#123;</span><br><span class="line">this.chain = chain;</span><br><span class="line">tm.checkServerTrusted(chain, authType);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦åœ¨YAMLï¼ˆapplicaton.ymlï¼‰ä¸­é…ç½®è¦ç”³è¯·æ¡æ‰‹çš„æœåŠ¡å™¨å°±å¥½</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cert:</span></span><br><span class="line"><span class="attr">  installation:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  domains:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">bidxxxxxxx.xxxxxxxxxxxxxx.com</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">suppxxxxxx.xxxxx.com</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°è¯ä¹¦æ‰¾ä¸åˆ°çš„é—®é¢˜äº†</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="https://www.cnblogs.com/huqiaoblog/p/8398009.html" target="_blank" rel="noopener">https://www.cnblogs.com/huqiaoblog/p/8398009.html</a></li><li><a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html</a></li><li><a href="https://blog.csdn.net/catoop/article/details/80819638" target="_blank" rel="noopener">https://blog.csdn.net/catoop/article/details/80819638</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arthasè°ƒæ•´logæ—¥å¿—ç­‰çº§</title>
      <link href="//p/arthas-log-level.html"/>
      <url>//p/arthas-log-level.html</url>
      
        <content type="html"><![CDATA[<p>é˜¿é‡Œçš„å¼€æºJavaè¯Šæ–­å·¥å…·Arthaså¯ä»¥åœ¨çº¿è°ƒæ•´logç­‰çº§</p><ol><li>æŸ¥æ‰¾å½“å‰ç±»çš„classloader hashcode</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc -d com.example.demo.arthas.user.UserController | grep classLoaderHash</span><br></pre></td></tr></table></figure><ol start="2"><li>ç”¨OGNLè·å–logger</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ognl -c 1be6f5c3 '@com.example.demo.arthas.user.UserController@logger'</span><br></pre></td></tr></table></figure><ol start="3"><li>å•ç‹¬è®¾ç½®UserControllerçš„logger level</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ognl -c 1be6f5c3 '@com.example.demo.arthas.user.UserController@logger.setLevel(@ch.qos.logback.classic.Level@DEBUG)'</span><br></pre></td></tr></table></figure><ol start="4"><li>å…¨å±€è®¾ç½®logger level</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ognl -c 1be6f5c3 '@org.slf4j.LoggerFactory@getLogger("root").setLevel(@ch.qos.logback.classic.Level@DEBUG)'</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Arthas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arthas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springbootå»æ‰@RequestBodyä¸­å­—ç¬¦ä¸²ç±»å‹å€¼çš„å‰åç©ºæ ¼</title>
      <link href="//p/spring-boot-request-body-space.html"/>
      <url>//p/spring-boot-request-body-space.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">æ”¹é€ MappingJackson2HttpMessageConverter</blockquote><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>é¡¹ç›®ç»„æå‡ºè¦æ±‚ï¼ŒSpringbooté¡¹ç›®ä¸­ï¼Œ@ResquestBodyæ ‡è®°çš„beanä¼ å…¥çš„å­—ç¬¦ä¸²ç±»å‹çš„å€¼è¦å»æ‰å‰åç©ºæ ¼</p><a id="more"></a><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å› ä¸ºé¡¹ç›®é»˜è®¤ä½¿ç”¨ <strong>MappingJackson2HttpMessageConverter</strong> ä½œä¸º Jsonè½¬æ¢å™¨ï¼Œ äºæ˜¯ä¹é‡å†™ä¸€äº›æ–¹æ³•åšæ–‡ç« ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">  <span class="comment">//... çœç•¥é‡å†™çš„å…¶ä»–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.configureMessageConverters(converters);</span><br><span class="line">   <span class="comment">//å¯¹åº”æ— æ³•ç›´æ¥è¿”å›Stringç±»å‹</span></span><br><span class="line">   converters.add(<span class="number">0</span>, <span class="keyword">new</span> MappingJackson2HttpMessageConverter()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">getObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">super</span>.getObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">super</span>.getObjectMapper();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">           * é‡å†™readæ–¹æ³•ï¼Œç„¶ååšå»æ‰å‰åç©ºæ ¼å¤„ç†ï¼Œé‡æ–°è½¬æ¢æˆobject</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@param</span> contextClass</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@param</span> inputMessage</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">           * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@throws</span> HttpMessageNotReadableException</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> Object <span class="title">read</span><span class="params">(Type type, Class&lt;?&gt; contextClass, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;</span><br><span class="line">              Object object = <span class="keyword">super</span>.read(type, contextClass, inputMessage);</span><br><span class="line">              String json = JSONObject.toJSONString(object);</span><br><span class="line">              Map&lt;String,Object&gt; map = (Map&lt;String, Object&gt;) JSONObject.parse(json);</span><br><span class="line"></span><br><span class="line">              Set&lt;Map.Entry&lt;String, Object&gt;&gt; entrySet = map.entrySet();</span><br><span class="line"></span><br><span class="line">              Map&lt;String, Object&gt; removeSpaceMap = Maps.newHashMap();</span><br><span class="line">              <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : entrySet)&#123;</span><br><span class="line">                  <span class="keyword">if</span> (entry.getValue() <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">                      removeSpaceMap.put(entry.getKey(), ((String) entry.getValue()).trim());</span><br><span class="line">                  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                      removeSpaceMap.put(entry.getKey(),entry.getValue());</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line"></span><br><span class="line">              String removeSpaceJson = JSON.toJSONString(removeSpaceMap);</span><br><span class="line">              <span class="keyword">return</span> gson.fromJson(removeSpaceJson, type);</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸Šé¢çš„ä»£ç ç»è¿‡å„ç§æµ‹è¯•å‘ç°ä¸€ä¸ªé—®é¢˜ï¼ŒGsonåœ¨å¤„ç†Integerï¼ŒLongéæµ®ç‚¹å‹çš„æ•°å€¼ç±»å‹æ—¶å€™ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºDoubleæ¥å¤„ç†ï¼Œè¿™å¯¼è‡´åç»­ä»£ç åšä¸€äº›æ•°æ®è½¬æ¢çš„æ—¶å€™ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºGsonå†…éƒ¨åœ¨å¤„ç†æ•°æ®ç±»å‹éƒ½å½“æˆNumberç±»å‹ï¼Œå¯ä»¥è¯»ä¸€ä¸‹æºç ï¼Œè¿™æ ·éœ€è¦åšå¦‚ä¸‹çš„æ”¹åŠ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contextClass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inputMessage</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> HttpMessageNotReadableException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">read</span><span class="params">(Type type, Class&lt;?&gt; contextClass, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;</span><br><span class="line">    Object object = <span class="keyword">super</span>.read(type, contextClass, inputMessage);</span><br><span class="line">    String json = JSONObject.toJSONString(object);</span><br><span class="line">    Map&lt;String,Object&gt; map = (Map&lt;String, Object&gt;) JSONObject.parse(json);</span><br><span class="line"></span><br><span class="line">    Set&lt;Map.Entry&lt;String, Object&gt;&gt; entrySet = map.entrySet();</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; removeSpaceMap = Maps.newHashMap();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : entrySet)&#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.getValue() <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">            removeSpaceMap.put(entry.getKey(), ((String) entry.getValue()).trim());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            removeSpaceMap.put(entry.getKey(),entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    String removeSpaceJson = JSON.toJSONString(removeSpaceMap);</span><br><span class="line">    <span class="keyword">return</span> JSONObject.parseObject(removeSpaceJson, type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨é‡Šæ‰Gsonï¼Œè½¬æ¢é»˜è®¤å°†Integerï¼ŒLongç­‰è½¬æ¢æˆDoubleï¼Œå†…éƒ¨å¤„ç†çœ‹ä½œNumber</span></span><br><span class="line">    <span class="comment">/*Gson gson = new Gson();</span></span><br><span class="line"><span class="comment">    return gson.fromJson(removeSpaceJson, type);*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸ºè¿™æ ·å°±ç»“æŸäº†å—ï¼Ÿå“ˆå“ˆï¼Œæ²¡æœ‰â€¦ ğŸ˜’</p><p>ä»¥ä¸Šæˆ‘ä»¬ä¼ å…¥çš„éƒ½æ˜¯æ­£å¸¸çš„JsonObjectï¼Œæ¯”å¦‚è¿™ç§æ ¼å¼çš„æ•°æ®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"commonName"</span>:<span class="string">"test2"</span>,</span><br><span class="line">    <span class="attr">"ver"</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">"certificateRootType"</span>:<span class="string">"Z200"</span>,</span><br><span class="line">    <span class="attr">"expiredDate"</span>:<span class="string">"2118-01-01"</span>,</span><br><span class="line">    <span class="attr">"certificateName"</span>:<span class="string">"ç¨åŠ¡ç™»è®°è¯ ã€‚"</span>,</span><br><span class="line">    <span class="attr">"commonCode"</span>:<span class="string">"suibian"</span>,</span><br><span class="line">    <span class="attr">"updateTime"</span>:<span class="string">"2018-07-12 13:09:14"</span>,</span><br><span class="line">    <span class="attr">"perpetual"</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="attr">"certificateNo"</span>:<span class="string">"11111111"</span>,</span><br><span class="line">    <span class="attr">"certificateTypeName"</span>:<span class="string">"ç¨åŠ¡ç™»è®°è¯"</span>,</span><br><span class="line">    <span class="attr">"imgInfoVOList"</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"url"</span>:<span class="string">"https://www.a.b.c/a.jpg"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"url"</span>:<span class="string">"https://www.a.b.c/b.jpg"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"producerType"</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="string">"2018-07-12 13:09:14"</span>,</span><br><span class="line">    <span class="attr">"supplier"</span>:<span class="number">1043</span>,</span><br><span class="line">    <span class="attr">"id"</span>:<span class="number">5016</span>,</span><br><span class="line">    <span class="attr">"startDate"</span>:<span class="string">"2018-01-01"</span>,</span><br><span class="line">    <span class="attr">"certificateType"</span>:<span class="string">"Z202"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¦æœ‰è¿™ç§æ ¼å¼çš„æ•°æ®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"roleId"</span>:<span class="number">212</span>,</span><br><span class="line">        <span class="attr">"name"</span>:<span class="string">"ä¸Šå¸è§†è§’"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"roleId"</span>:<span class="number">212</span>,</span><br><span class="line">        <span class="attr">"name"</span>:<span class="string">"ä¸Šå¸è§†è§’"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"roleId"</span>:<span class="number">212</span>,</span><br><span class="line">        <span class="attr">"name"</span>:<span class="string">"ä¸Šå¸è§†è§’"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä¸‹é¢è¿™ç§æ ¼å¼çš„ï¼Œæˆ‘ä»¬è§£æçš„æ—¶å€™å°±ä¼šæŠ¥è½¬æ¢é”™è¯¯ï¼Œæ‰€ä»¥é’ˆå¯¹ä¸‹é¢JsonArrayç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åšç‰¹æ®Šå¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contextClass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inputMessage</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> HttpMessageNotReadableException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">read</span><span class="params">(Type type, Class&lt;?&gt; contextClass, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;</span><br><span class="line">    Object object = <span class="keyword">super</span>.read(type, contextClass, inputMessage);</span><br><span class="line">    String json = JSONObject.toJSONString(object);</span><br><span class="line">    String jsonResult = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (json.startsWith(<span class="string">"["</span>))&#123;</span><br><span class="line">        JSONArray jsonArray = JSONArray.parseArray(json);</span><br><span class="line">        <span class="keyword">if</span> (jsonArray != <span class="keyword">null</span> &amp;&amp; !jsonArray.isEmpty())&#123;</span><br><span class="line">            List&lt;Map&lt;String, Object&gt;&gt; result = Lists.newArrayList();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;jsonArray.size(); i++)&#123;</span><br><span class="line">                Map&lt;String, Object&gt; map = (Map&lt;String, Object&gt;) jsonArray.get(i);</span><br><span class="line">                Map&lt;String, Object&gt; removeSpaceMap = removeSpace(map);</span><br><span class="line">                result.add(removeSpaceMap);</span><br><span class="line">            &#125;</span><br><span class="line">         jsonResult = JSON.toJSONString(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = (Map&lt;String, Object&gt;) JSONObject.parse(json);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; removeSpaceMap = removeSpace(map);</span><br><span class="line">        jsonResult = JSON.toJSONString(removeSpaceMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨é‡Šæ‰Gsonï¼Œè½¬æ¢é»˜è®¤å°†Integerï¼ŒLongç­‰è½¬æ¢æˆDoubleï¼Œå†…éƒ¨å¤„ç†çœ‹ä½œNumber</span></span><br><span class="line">    <span class="comment">/*Gson gson = new Gson();</span></span><br><span class="line"><span class="comment">    return gson.fromJson(removeSpaceJson, type);*/</span></span><br><span class="line">    <span class="keyword">return</span> JSONObject.parseObject(jsonResult, type);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">removeSpace</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>&#123;</span><br><span class="line">  Set&lt;Map.Entry&lt;String, Object&gt;&gt; entrySet = map.entrySet();</span><br><span class="line"></span><br><span class="line">  Map&lt;String, Object&gt; removeSpaceMap = Maps.newHashMap();</span><br><span class="line">  <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : entrySet)&#123;</span><br><span class="line">      <span class="keyword">if</span> (entry.getValue() <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">          removeSpaceMap.put(entry.getKey(), ((String) entry.getValue()).trim());</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          removeSpaceMap.put(entry.getKey(),entry.getValue());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> removeSpaceMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±åº”å¯¹å¤§å¤šæ•°é—®é¢˜äº†</p><img itemprop="url image" src="/uploads/spring/httpmessageconverter.png" class="full-image" /><p>æ¥ä¸‹æ¥éœ€è¦å…·ä½“äº†è§£ä¸€ä¸‹ï¼Œæ„å»ºè¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾ï¼Œåœ¨HttpInputMessage é€šè¿‡ converter è½¬æ¢æˆObjectå¯¹è±¡ä¹‹å‰åšå¤„ç†ï¼Œè¿™æ ·åœ¨Controlleræ¥æ”¶çš„æ—¶å€™å°±å¯ä»¥æ‹¿åˆ°å¤„ç†åçš„å¯¹è±¡äº†</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Json </tag>
            
            <tag> Springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå®ç°æ–‡ä»¶ä¸‹è½½å¹¶å‹ç¼©æˆzipæ–‡ä»¶</title>
      <link href="//p/java-download-file-zip.html"/>
      <url>//p/java-download-file-zip.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">IOæµï¼Œç½‘ç»œç¼–ç¨‹çš„åŸºç¡€</blockquote><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æœ€è¿‘åœ¨åšSpringbootåˆ†å¸ƒå¼å¾®æœåŠ¡é¡¹ç›®ï¼Œç”¨åˆ°äº†æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ï¼Œæ–‡ä»¶ä¸Šä¼ æ˜¯æ—¢æœ‰çš„åŠŸèƒ½ï¼Œå°†æ–‡ä»¶æˆ–å›¾ç‰‡ä¸Šä¼ åˆ°S3æœåŠ¡å™¨ä¸Šï¼Œå°†ç”Ÿæˆçš„æ–‡ä»¶URLåœ°å€å’Œæˆªå–çš„æ–‡ä»¶åå­˜å‚¨åˆ°DBä¸­ï¼Œæ­£å¸¸æˆ‘ä»¬åªéœ€è¦ç»™å‰ç«¯URLï¼Œé€šè¿‡æµè§ˆå™¨å°±å¯ä»¥å®ç°æ–‡ä»¶çš„ä¸‹è½½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å°†æ–‡ä»¶ä¸Šä¼ åˆ°S3æœåŠ¡å™¨ä¹‹å‰æ˜¯å°†æ–‡ä»¶åç§°è¿›è¡Œè½¬ç çš„ï¼Œå¦‚ï¼šæ–‡ä»¶test.docxä¸Šä¼ åˆ°S3æœåŠ¡å™¨ä¹‹åçš„URLåœ°å€æ˜¯ï¼š <em><a href="http://www.S3.xxx.com/files/abRsdf.docx" target="_blank" rel="noopener">http://www.S3.xxx.com/files/abRsdf.docx</a></em>, è¿™æ ·æˆ‘ä»¬ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶æ–‡ä»¶åå°±æ˜¯ <em>abRsdf.docx</em>, æ˜¾ç„¶è¿™æ˜¯ä¸ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„ï¼Œä¸‹è½½çš„æ–‡ä»¶ååº”è¯¥æ˜¯test.docx, å¹¶ä¸”éœ€è¦å¤šä¸ªæ–‡ä»¶å‹ç¼©æˆzipæ–‡ä»¶æ‰“åŒ…ä¸‹è½½. æ‰€ä»¥éœ€è¦åœ¨responseä¸­åšä¸€äº›æ–‡ç« ï¼Œä¿®æ”¹æ–‡ä»¶åï¼Œä»¥åŠåšå¤šæ–‡ä»¶çš„å‹ç¼©ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å› ä¸ºDBä¸­å­˜å‚¨äº†æ–‡ä»¶çš„URLå’Œæ–‡ä»¶åç§°ï¼Œå¤§æ¦‚æ•°æ®å½¢å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">åºå·</th><th align="left">url</th><th align="left">name</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><a href="http://www.S3.xxx.com/files/abRsdf.docx" target="_blank" rel="noopener">http://www.S3.xxx.com/files/abRsdf.docx</a></td><td align="left">test.docx</td></tr><tr><td align="left">2</td><td align="left"><a href="http://www.S3.xxx.com/files/lsdTew.docx" target="_blank" rel="noopener">http://www.S3.xxx.com/files/lsdTew.docx</a></td><td align="left">test1.docx</td></tr></tbody></table><a id="more"></a><h4 id="å°è£…DBæ•°æ®"><a href="#å°è£…DBæ•°æ®" class="headerlink" title="å°è£…DBæ•°æ®"></a>å°è£…DBæ•°æ®</h4><p>å°†DBä¸­çš„urlå’Œnameæ•°æ®å°è£…åˆ°ç±»å‹ä¸ºDownloadVO.javaä¸­ï¼ŒDownloadVO.javaçš„ä»£ç å¾ˆç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.base.Strings;</span><br><span class="line"><span class="keyword">import</span> com.viewhigh.epro.mall.vo.base.DownloadVO;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.lang.Collections;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipEntry;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger LOG = LoggerFactory.getLogger(DownloadUtil.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹è½½å•ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> downloadVO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toDownloadFile</span><span class="params">(DownloadVO downloadVO, HttpServletRequest request, HttpServletResponse response)</span><span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String savePath = request.getServletContext().getRealPath(<span class="keyword">new</span> StringBuffer(File.separator).append(<span class="string">"attachment"</span>).append(File.separator).toString());</span><br><span class="line">        LOG.info(<span class="string">"The Path where file will storage is &#123;&#125;"</span>, savePath);</span><br><span class="line"></span><br><span class="line">        downloadFile(getFile(downloadVO, savePath), request, response, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨æœåŠ¡å™¨ç”Ÿæˆæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> downloadVO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> savePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">getFile</span><span class="params">(DownloadVO downloadVO, String savePath)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fileOutputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL url = <span class="keyword">new</span> URL(downloadVO.getUrl());</span><br><span class="line"></span><br><span class="line">            HttpURLConnection conn = (HttpURLConnection)url.openConnection(); <span class="comment">// åˆ›å»ºè¿æ¥å®ä¾‹</span></span><br><span class="line">            conn.setConnectTimeout(<span class="number">3</span>*<span class="number">1000</span>); <span class="comment">//è®¾ç½®è¶…æ—¶é—´ä¸º3ç§’</span></span><br><span class="line">            conn.setRequestProperty(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)"</span>); <span class="comment">//é˜²æ­¢å±è”½ç¨‹åºæŠ“å–è€Œè¿”å›403é”™è¯¯</span></span><br><span class="line">            conn.setRequestProperty(<span class="string">"Charset"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            inputStream = conn.getInputStream(); <span class="comment">//è·å–è¿æ¥è¾“å…¥æµ</span></span><br><span class="line">            <span class="keyword">byte</span>[] getData = readInputStream(inputStream); <span class="comment">//è·å–å­—èŠ‚æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">            File saveDir = <span class="keyword">new</span> File(savePath); <span class="comment">// åˆ›å»ºæ–‡ä»¶å­˜æ”¾è·¯å¾„</span></span><br><span class="line">            <span class="keyword">if</span> (!saveDir.exists())&#123;</span><br><span class="line">                saveDir.mkdir();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            File file = <span class="keyword">new</span> File(savePath,  downloadVO.getName()); <span class="comment">// åœ¨æ–°å»ºè·¯å¾„ä¸‹åˆ›å»ºå¯¹åº”é™„ä»¶åç§°çš„æ–‡ä»¶</span></span><br><span class="line">            fileOutputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">            fileOutputStream.write(getData);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> file;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å…³é—­æµ</span></span><br><span class="line">            <span class="keyword">if</span>(fileOutputStream!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                fileOutputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(inputStream!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹è½½å¤šä¸ªæ–‡ä»¶ï¼Œå¹¶å‹ç¼©æˆzip</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> downloadVOS å¾…ä¸‹è½½çš„æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request Servletè¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response Servletç›¸åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> zipName å¾…ç”Ÿæˆçš„zipæ–‡ä»¶åæˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toDownloadFiles</span><span class="params">(List&lt;DownloadVO&gt; downloadVOS, HttpServletRequest request, HttpServletResponse response, String zipName)</span><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Collections.isEmpty(downloadVOS))&#123;</span><br><span class="line">            LOG.info(<span class="string">"The total of Attachment is &#123;&#125;"</span> , downloadVOS.size());</span><br><span class="line"></span><br><span class="line">            String savePath = request.getServletContext().getRealPath(<span class="keyword">new</span> StringBuffer(File.separator).append(<span class="string">"attachment"</span>).append(File.separator).toString());</span><br><span class="line">            LOG.info(<span class="string">"The Path where file will storage is &#123;&#125;"</span>, savePath);</span><br><span class="line"></span><br><span class="line">            List&lt;File&gt; files = <span class="keyword">new</span> ArrayList&lt;File&gt;(downloadVOS.size());</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å¤„ç†åŒåæ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä»¥ a.txt, a(1).txt, a(2).txt</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Map&lt;String, Integer&gt; map = Maps.newHashMap();</span><br><span class="line">            <span class="keyword">for</span> (DownloadVO downloadVO : downloadVOS)&#123;</span><br><span class="line">                String fileName = downloadVO.getName();</span><br><span class="line">                <span class="keyword">if</span> (map.containsKey(fileName))&#123;</span><br><span class="line">                    map.put(fileName, map.get(fileName) + <span class="number">1</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    map.put(fileName, <span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (map.get(fileName) != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">int</span> position = fileName.lastIndexOf(<span class="string">"."</span>);</span><br><span class="line">                    downloadVO.setName(<span class="keyword">new</span> StringBuffer(fileName.substring(<span class="number">0</span>, position)).append(<span class="string">"("</span>).append(map.get(fileName)).append(<span class="string">")"</span>).append(fileName.substring(position, fileName.length())).toString());</span><br><span class="line">                &#125;</span><br><span class="line">                File file = getFile(downloadVO, savePath);</span><br><span class="line">                files.add(file);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç”Ÿæˆzipæ–‡ä»¶</span></span><br><span class="line">            File fileZip = generateZipFile(files, savePath, zipName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¸‹è½½zipæ–‡ä»¶</span></span><br><span class="line">            downloadFile(fileZip, request, response, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ é™¤æºæ–‡ä»¶</span></span><br><span class="line">            deleteSourceFile(files);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteSourceFile</span><span class="params">(List&lt;File&gt; files)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Collections.isEmpty(files))&#123;</span><br><span class="line">            files.forEach(File::delete);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»è¾“å…¥æµä¸­è·å–å­—èŠ‚æ•°ç»„ï¼Œæ ¹æ® available è·å–ä¸€æ¬¡æ€§è¯»å–çš„å­—èŠ‚æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">byte</span>[] readInputStream(InputStream inputStream) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            count = inputStream.available();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[count];</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        ByteArrayOutputStream bos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">while</span>((len = inputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            bos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        LOG.info(<span class="string">"current file length is &#123;&#125;"</span>, len);</span><br><span class="line">        bos.close();</span><br><span class="line">        <span class="keyword">return</span> bos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆzipæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> files</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> savePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> zipName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">generateZipFile</span><span class="params">(List&lt;File&gt; files, String savePath, String zipName)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        String zipFileName = zipName;</span><br><span class="line">        <span class="keyword">if</span> (Strings.isNullOrEmpty(zipFileName))&#123;</span><br><span class="line">            zipFileName = UUID.randomUUID().toString();</span><br><span class="line">        &#125;</span><br><span class="line">        zipFileName = zipFileName + <span class="string">".zip"</span>;</span><br><span class="line">        File fileZip = <span class="keyword">new</span> File(savePath, zipFileName );</span><br><span class="line">        FileOutputStream fileOutputStream = <span class="keyword">null</span>; <span class="comment">// æ–‡ä»¶è¾“å‡ºæµ</span></span><br><span class="line">        ZipOutputStream zipOutputStream = <span class="keyword">null</span>; <span class="comment">// å‹ç¼©æµ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileOutputStream = <span class="keyword">new</span> FileOutputStream(fileZip);</span><br><span class="line">            zipOutputStream = <span class="keyword">new</span> ZipOutputStream(fileOutputStream);</span><br><span class="line">            zipFile(files, zipOutputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (zipOutputStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                zipOutputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fileOutputStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                fileOutputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fileZip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‹ç¼©æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> files</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zipFile</span><span class="params">(List&lt;File&gt; files, ZipOutputStream outputStream)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> size = files.size();</span><br><span class="line">            <span class="comment">// å‹ç¼©åˆ—è¡¨ä¸­çš„æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                File file = (File) files.get(i);</span><br><span class="line">                zipFile(file, outputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zipFile</span><span class="params">(File inputFile, ZipOutputStream outputstream)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        FileInputStream inStream = <span class="keyword">null</span>;</span><br><span class="line">        BufferedInputStream bInStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputFile.exists()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (inputFile.isFile()) &#123;</span><br><span class="line">                    inStream = <span class="keyword">new</span> FileInputStream(inputFile);</span><br><span class="line">                    bInStream = <span class="keyword">new</span> BufferedInputStream(inStream);</span><br><span class="line">                    ZipEntry entry = <span class="keyword">new</span> ZipEntry(inputFile.getName());</span><br><span class="line">                    outputstream.putNextEntry(entry);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> MAX_BYTE = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// æœ€å¤§çš„æµä¸º10M</span></span><br><span class="line">                    <span class="keyword">long</span> streamTotal = <span class="number">0</span>; <span class="comment">// æ¥å—æµçš„å®¹é‡</span></span><br><span class="line">                    <span class="keyword">int</span> streamNum = <span class="number">0</span>; <span class="comment">// æµéœ€è¦åˆ†å¼€çš„æ•°é‡</span></span><br><span class="line">                    <span class="keyword">int</span> leaveByte = <span class="number">0</span>; <span class="comment">// æ–‡ä»¶å‰©ä¸‹çš„å­—ç¬¦æ•°</span></span><br><span class="line">                    <span class="keyword">byte</span>[] inOutbyte; <span class="comment">// byteæ•°ç»„æ¥å—æ–‡ä»¶çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line">                    streamTotal = bInStream.available(); <span class="comment">// é€šè¿‡availableæ–¹æ³•å–å¾—æµçš„æœ€å¤§å­—ç¬¦æ•°</span></span><br><span class="line">                    streamNum = (<span class="keyword">int</span>) Math.floor(streamTotal / MAX_BYTE); <span class="comment">// å–å¾—æµæ–‡ä»¶éœ€è¦åˆ†å¼€çš„æ•°é‡</span></span><br><span class="line">                    leaveByte = (<span class="keyword">int</span>) streamTotal % MAX_BYTE; <span class="comment">// åˆ†å¼€æ–‡ä»¶ä¹‹å,å‰©ä½™çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (streamNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; streamNum; ++j) &#123;</span><br><span class="line">                            inOutbyte = <span class="keyword">new</span> <span class="keyword">byte</span>[MAX_BYTE];</span><br><span class="line">                            <span class="comment">// è¯»å…¥æµ,ä¿å­˜åœ¨byteæ•°ç»„</span></span><br><span class="line">                            bInStream.read(inOutbyte, <span class="number">0</span>, MAX_BYTE);</span><br><span class="line">                            outputstream.write(inOutbyte, <span class="number">0</span>, MAX_BYTE); <span class="comment">// å†™å‡ºæµ</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å†™å‡ºå‰©ä¸‹çš„æµæ•°æ®</span></span><br><span class="line">                    inOutbyte = <span class="keyword">new</span> <span class="keyword">byte</span>[leaveByte];</span><br><span class="line">                    bInStream.read(inOutbyte, <span class="number">0</span>, leaveByte);</span><br><span class="line">                    outputstream.write(inOutbyte);</span><br><span class="line">                    outputstream.closeEntry(); <span class="comment">// Closes the current ZIP entry</span></span><br><span class="line">                    <span class="comment">// and positions the stream for</span></span><br><span class="line">                    <span class="comment">// writing the next entry</span></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"æ–‡ä»¶ä¸å­˜åœ¨ï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bInStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                bInStream.close(); <span class="comment">// å…³é—­</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (inStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                inStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹è½½zipæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isDelete</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">downloadFile</span><span class="params">(File file,HttpServletRequest request , HttpServletResponse response,<span class="keyword">boolean</span> isDelete)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BufferedInputStream bufferedInputStream = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(file.getPath()));</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[bufferedInputStream.available()];</span><br><span class="line">            bufferedInputStream.read(buffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            response.reset(); <span class="comment">// æ¸…ç©ºresponse</span></span><br><span class="line">            outputStream = <span class="keyword">new</span> BufferedOutputStream(response.getOutputStream());</span><br><span class="line">            response.setContentType(<span class="string">"application/octet-stream"</span>);</span><br><span class="line">            LOG.info(<span class="string">"fileName:"</span> + file.getName());</span><br><span class="line"></span><br><span class="line">            String userAgent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">            String formFileName = file.getName();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é’ˆå¯¹IEæˆ–è€…ä»¥IEä¸ºå†…æ ¸çš„æµè§ˆå™¨ï¼š</span></span><br><span class="line">            <span class="keyword">if</span> (userAgent.contains(<span class="string">"MSIE"</span>) || userAgent.contains(<span class="string">"Trident"</span>) || userAgent.contains(<span class="string">"Edge"</span>)) &#123;</span><br><span class="line">                formFileName = java.net.URLEncoder.encode(formFileName, <span class="string">"UTF-8"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// éIEæµè§ˆå™¨çš„å¤„ç†ï¼š</span></span><br><span class="line">                formFileName = <span class="keyword">new</span> String(formFileName.getBytes(<span class="string">"UTF-8"</span>), <span class="string">"ISO-8859-1"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span> + formFileName);</span><br><span class="line">            outputStream.write(buffer);</span><br><span class="line">            outputStream.flush();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ˜¯å¦å°†ç”Ÿæˆçš„æœåŠ¡å™¨ç«¯æ–‡ä»¶åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span>(isDelete)&#123;</span><br><span class="line">                file.delete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span>  ex;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bufferedInputStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                bufferedInputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (outputStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                outputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="servletè·¯å¾„é—®é¢˜"><a href="#servletè·¯å¾„é—®é¢˜" class="headerlink" title="servletè·¯å¾„é—®é¢˜"></a>servletè·¯å¾„é—®é¢˜</h4><p>ä¸Šé¢çš„ä»£ç å°†æ–‡ä»¶ä¸‹è½½åˆ°äº†servletçš„realPathä¸­ï¼Œé¡ºä¾¿æ€»ç»“ä¸€ä¸‹å„ç§è·¯å¾„çš„å·®åˆ«</p><p>è¯·æ±‚è·¯å¾„çš„URL <a href="http://localhost:8080/electest/system/elecMenuAction_menuHome.do" target="_blank" rel="noopener">http://localhost:8080/electest/system/elecMenuAction_menuHome.do</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">"contentType------"</span>+request.getContentType());</span><br><span class="line">System.out.println(<span class="string">"requestcontextPath------"</span>+request.getContextPath());</span><br><span class="line">System.out.println(<span class="string">"servletPath----"</span>+request.getServletPath());</span><br><span class="line">System.out.println(<span class="string">"requestRealPath"</span>+request.getRealPath(<span class="string">""</span>));</span><br><span class="line">System.out.println(<span class="string">"realPath------"</span>+request.getServletContext().getRealPath(<span class="string">""</span>));</span><br><span class="line">System.out.println(<span class="string">"requestURI------"</span>+request.getRequestURI());</span><br><span class="line">System.out.println(<span class="string">"requestURL-------"</span>+request.getRequestURL());</span><br><span class="line">System.out.println(<span class="string">"contextPath-------"</span>+request.getServletContext().getContextPath());</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">contentType------application/x-www-form-urlencoded</span><br><span class="line">requestcontextPath------/electest</span><br><span class="line">servletPath----/system/elecMenuAction_menuHome.<span class="keyword">do</span></span><br><span class="line">requestRealPathD:\tomcate\apache-tomcat-<span class="number">7.0</span>.63-windows-x64\apache-tomcat-<span class="number">7.0</span>.63\webapps\electest</span><br><span class="line">realPath------D:\tomcate\apache-tomcat-<span class="number">7.0</span>.63-windows-x64\apache-tomcat-<span class="number">7.0</span>.63\webapps\electest</span><br><span class="line">requestURI------/electest/system/elecMenuAction_menuHome.<span class="keyword">do</span></span><br><span class="line">requestURL-------http:<span class="comment">//localhost:8080/electest/system/elecMenuAction_menuHome.do</span></span><br><span class="line">contextPath---------/electest</span><br></pre></td></tr></table></figure><p>æ–¹æ³•å’Œä»£ç çš„æ³¨é‡Šå†™çš„å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œå…·ä½“çš„å®ç°å°±ä¸å†è¯¦è¿°äº†</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springboot Jsonæ ¼å¼æ•°æ®ä¸è¿”å›nullå€¼å±æ€§</title>
      <link href="//p/spring-boot-json-return-non-null.html"/>
      <url>//p/spring-boot-json-return-non-null.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">Spring ResponseBody without null field</blockquote><blockquote><p>é€šå¸¸Restfulè¿”å›çš„Jsonæ ¼å¼æ•°æ®ï¼Œé‡Œé¢åŒ…å«å¾ˆå¤šä¸ºç©ºå€¼nullçš„å­—æ®µï¼Œæˆ‘ä»¬æ²¡å¿…è¦å°†è¿™äº›å­—æ®µè¿”å›ç»™å‰ç«¯ï¼Œåº”è¯¥ç»™å‡ºæ›´å¤šçš„æœ‰æ•ˆå­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨Converter Messageçš„æ—¶å€™å°†è¿™äº›nullå€¼å­—æ®µç»™è¿‡æ»¤æ‰</p></blockquote><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>æ·»åŠ  <strong>@JsonInclude(JsonInclude.Include.NON_NULL)</strong> æ³¨è§£<br>è¯¥æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å¤ªå¤šçš„è¿”å›ç±»å‹ï¼Œä¸€ä¸€æ·»åŠ ä¹Ÿæ˜¯å¾ˆå¤§çš„å·¥ä½œé‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è½¬æ¢çš„æºå¤´è¿›è¡Œæ§åˆ¶</p><a id="more"></a><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>å®ç° <strong>WebMvcConfigurer</strong> æ¥å£ï¼Œæ·»åŠ  <strong>@EnableWebMvc</strong> å’Œ <strong>@Configuration</strong> æ³¨è§£ï¼Œç„¶åé‡å†™ <strong>MappingJackson2HttpMessageConverter ä¸­ getObjectMapper() æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">  <span class="comment">//... çœç•¥é‡å†™çš„å…¶ä»–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.configureMessageConverters(converters);</span><br><span class="line">   <span class="comment">//å¯¹åº”æ— æ³•ç›´æ¥è¿”å›Stringç±»å‹</span></span><br><span class="line">   converters.add(<span class="number">0</span>, <span class="keyword">new</span> MappingJackson2HttpMessageConverter()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">getObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">super</span>.getObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">super</span>.getObjectMapper();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ‰€æœ‰çš„nullå€¼éƒ½ä¼šè¢«è¿‡æ»¤æ‰ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ <strong>JsonInclude.Include.NON_NULL</strong>ï¼Œ Jsonä¸­çš„æŸä¸ªé›†åˆå¦‚æœä¸ºç©ºè¿˜æ˜¯ä¼šè¿”å›ç©ºæ•°ç»„ï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠè¿™æ ·çš„æ•°æ®ä¹Ÿè¿‡æ»¤æ‰ï¼Œåªéœ€è¦å°†<strong>JsonInclude.Include.NON_NULL</strong> ä¿®æ”¹ä¸º <strong>JsonInclude.Include.NON_EMPTY</strong></p><p>è¿™æ ·å°±å¥½äº†ï¼Œè¿”å›ç»™å‰ç«¯æ¸…æ™°æœ‰æ•ˆçš„æ•°æ®.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> Json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot</title>
      <link href="//p/docker-deploy-spring-boot.html"/>
      <url>//p/docker-deploy-spring-boot.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘é™†ç»­åœ¨é€šè¿‡SpringBootæ­å»ºé¡¹ç›®ï¼Œå¾€é‡Œé¢é€æ¸æ·»åŠ åŠŸèƒ½ï¼Œé¡¹ç›®åœ°å€<a href="https://github.com/FraserYu/springbootlearning.git" target="_blank" rel="noopener">SpringBootLearning</a>, å½“æ€»ç»“Dockeréƒ¨ç½²SpringBootçš„æ—¶å€™ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼ŒåŠ ä»¥æ€»ç»“</p><a id="more"></a><h3 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h3><p>æ–‡ç« ä¸»è¦å‚è€ƒ<a href="http://www.spring4all.com/article/992" target="_blank" rel="noopener">Spring Boot 2.0(å››)ï¼šä½¿ç”¨ Docker éƒ¨ç½² Spring Boot</a>, å› ä¸ºæˆ‘æ˜¯å·²æœ‰çš„SpringBooté¡¹ç›®ï¼Œä¸æ˜¯ç®€å•çš„SpringBooté¡¹ç›®ï¼Œæ‰€ä»¥ä½¿ç”¨Dockeréƒ¨ç½²SpringBootçš„æ—¶å€™é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç°æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><strong>mvn package</strong> æ‰“åŒ…å‘½ä»¤ä¸èƒ½ç”ŸæˆjaråŒ…åˆ°targetç›®å½•ä¸‹<br>å› ä¸ºDockerä¼šç”¨åˆ°jaråŒ…ï¼Œæ‰€ä»¥åœ¨ç”¨Dockeréƒ¨ç½²ä¹‹å‰ï¼Œå…ˆç”¨Mavenæ¥è¿›è¡Œæ‰“åŒ…ï¼Œä¿è¯æ­£ç¡®ï¼Œä½†æ˜¯ä½¿ç”¨å‘½ä»¤å¹¶ä¸èƒ½ç”ŸæˆjaråŒ…ï¼Œå‘ç°æ‰“åŒ…ä¸­æ‰“äº†æˆ‘çš„æµ‹è¯•ç”¨ä¾‹ç±»ï¼Œæµ‹è¯•ç”¨ä¾‹æœ‰æŒç»­æ‰§è¡Œæ“ä½œï¼Œå½“ç„¶å…¶ä»–æŒç»­æ“ä½œä¹Ÿæœ‰å¯èƒ½å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘åœ¨pom.xmlä¸­åŠ å…¥äº†pluginæ¥è¿‡æ»¤æ‰Test case.<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mvn æ‰“åŒ…æ—¶çœç•¥testç”¨ä¾‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>$&#123;skipTests&#125;<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>é€šè¿‡Mavençš„dockeræ’ä»¶æ¥éƒ¨ç½²ï¼Œé‡åˆ°äº†ä¸¤ä¸ªé—®é¢˜ï¼š<blockquote><ul><li>[ERROR] Failed to execute goal com.spotify:docker-maven-plugin:1.0.0:build (default-cli) on project demo: Exception caught: java.util.concurrent.ExecutionException: com.spotify.docker.client.shaded.javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to localhost:2375 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused: connect -&gt; [Help 1]</li><li>[ERROR] Failed to execute goal com.spotify:docker-maven-plugin:1.0.0:build (default-cli) on project demo: Exception caught: java.util.concurrent.ExecutionException: com.spotify.docker.client.shaded.javax.ws.rs.ProcessingException: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target -&gt; [Help 1]</li></ul></blockquote></li></ol><p>é€šè¿‡æŸ¥æ‰¾èµ„æ–™åœ¨pom.xmlä¸­mavençš„dockeræ’ä»¶ä¸­æ·»åŠ äº†å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dockerHost</span>&gt;</span>https://192.168.99.100:2376<span class="tag">&lt;/<span class="name">dockerHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dockerCertPath</span>&gt;</span>D:/Users/fraser.yu/.docker/machine/machines/default<span class="tag">&lt;/<span class="name">dockerCertPath</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ (å››)â€”â€”å®¹å™¨</title>
      <link href="//p/docker-container.html"/>
      <url>//p/docker-container.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">å®¹å™¨æ˜¯é•œåƒçš„ä¸€ä¸ªè¿è¡Œå®ä¾‹ï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼Œå®ƒæœ‰é¢å¤–çš„å¯å†™æ–‡ä»¶å±‚</blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="http://fraserlife.com/2017/11/06/Docker%E5%AD%A6%E4%B9%A0-%E4%B8%89-%E2%80%94%E2%80%94%E9%95%9C%E5%83%8F/#more" target="_blank" rel="noopener">Dockerå­¦ä¹ (ä¸‰)â€”â€”é•œåƒ</a>ä»‹ç»äº†Dockerçš„é•œåƒï¼Œ<br>åŒ…æ‹¬ <em>è·å–é•œåƒï¼ŒæŸ¥çœ‹é•œåƒä¿¡æ¯ï¼Œæœå¯»é•œåƒï¼Œåˆ é™¤é•œåƒï¼Œåˆ›å»ºé•œåƒï¼Œå­˜å‚¨å’Œè½½å…¥é•œåƒï¼Œä¸Šä¼ é•œåƒ</em>ï¼Œæ¥ä¸‹æ¥é€æ­¥æ‹†åˆ†è®²è§£Dockerçš„æ ¸å¿ƒå†…å®¹ä¹‹ä¸€â€”â€”<strong>å®¹å™¨</strong>.</p><a id="more"></a><blockquote><p>Dockerçš„å®¹å™¨ååˆ†è½»é‡çº§ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶åˆ›å»ºæˆ–åˆ é™¤å®¹å™¨</p></blockquote><h3 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="headerlink" title="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨</h3><h4 id="å•çº¯åˆ›å»ºå®¹å™¨"><a href="#å•çº¯åˆ›å»ºå®¹å™¨" class="headerlink" title="å•çº¯åˆ›å»ºå®¹å™¨"></a>å•çº¯åˆ›å»ºå®¹å™¨</h4><p><strong>è¯­æ³•: docker create [OPTIONS] IMAGE [COMMAND] [ARGâ€¦]</strong></p><ol><li><p>ä¸ºæœ¬åœ°Ubuntué•œåƒåˆ›å»ºå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker create -it ubuntu:latest</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æœ¬åœ°å¯åŠ¨çš„å®¹å™¨ï¼ˆæ³¨æ„è§‚å¯Ÿå®¹å™¨çš„çŠ¶æ€æ˜¯Created,æ¢å¥è¯è¯´è¿™ä¸ªå®¹å™¨æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œæ²¡æœ‰è¿è¡Œï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br></pre></td></tr></table></figure></li><li><p>å®¹å™¨ä¿¡æ¯è§£é‡Š</p><blockquote><ul><li>CONTAINER IDï¼š å®¹å™¨ID</li><li>IMAGE: å®¹å™¨æ‰€è¿è¡Œé•œåƒçš„åç§°</li><li>COMMAND: è¿è¡Œå®¹å™¨æ—¶çš„å‘½ä»¤</li><li>CREATED: å®¹å™¨çš„åˆ›å»ºæ—¶é—´</li><li>STATUS: å®¹å™¨å½“å‰çŠ¶æ€</li></ul></blockquote></li><li><p>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker create --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="å¯åŠ¨å®¹å™¨æ–¹æ³•ä¸€"><a href="#å¯åŠ¨å®¹å™¨æ–¹æ³•ä¸€" class="headerlink" title="å¯åŠ¨å®¹å™¨æ–¹æ³•ä¸€"></a>å¯åŠ¨å®¹å™¨æ–¹æ³•ä¸€</h4><p><strong>è¯­æ³•: docker start [OPTIONS] CONTAINER [CONTAINERâ€¦]</strong></p><ol><li><p>æŸ¥çœ‹åˆšåˆšåˆ›å»ºçš„å®¹å™¨IDï¼Œé€šè¿‡startå‘½ä»¤æ¥å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start 93f</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ï¼ˆæ³¨æ„å½“å‰å®¹å™¨çŠ¶æ€æ˜¯Exitedï¼Œå³å®¹å™¨è¿è¡Œç»ˆæ­¢ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br></pre></td></tr></table></figure></li><li><p>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="å¯åŠ¨å®¹å™¨æ–¹æ³•äºŒ"><a href="#å¯åŠ¨å®¹å™¨æ–¹æ³•äºŒ" class="headerlink" title="å¯åŠ¨å®¹å™¨æ–¹æ³•äºŒ"></a>å¯åŠ¨å®¹å™¨æ–¹æ³•äºŒ</h4><p>åˆ›å»ºå®¹å™¨å’Œå¯åŠ¨å®¹å™¨æœ‰ä¸€ç§æ›´æ–¹ä¾¿çš„å‘½ä»¤æ¥å®Œæˆä¸Šé¢create å’Œ start çš„æ“ä½œ.<br><strong>è¯­æ³•: docker run [OPTIONS] IMAGE [COMMAND] [ARGâ€¦]</strong></p><ol><li>ä¸ºæœ¬åœ°Ubuntué•œåƒåœ¨æ­¤åˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it ubuntu:latest</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£ï¼ˆå’Œcreateæ˜¯ä¸€æ ·çš„ï¼‰<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><h4 id="é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºå®¹å™¨"></a>é€€å‡ºå®¹å™¨</h4>è¾“å…¥<strong>exit</strong>æˆ–è€…<strong>Ctrl+D</strong>æ¥é€€å‡ºå®¹å™¨ï¼Œå¯¹äºæ‰€åˆ›å»ºçš„bashå®¹å™¨ï¼Œå½“ä½¿ç”¨exitå‘½ä»¤é€€å‡ºä¹‹åï¼Œè¯¥å®¹å™¨å°±å‡ºäºç»ˆæ­¢çŠ¶æ€äº†ï¼Œè¿™æ˜¯å› ä¸ºå¯¹äºDockerå®¹å™¨æ¥è¯´ï¼Œå½“è¿è¡Œçš„åº”ç”¨ï¼ˆæ­¤å¤„ä»¥bashä¸ºä¾‹ï¼‰é€€å‡ºåï¼Œå®¹å™¨ä¹Ÿå°±æ²¡æœ‰ç»§ç»­è¿è¡Œçš„å¿…è¦äº†.</li></ol><h4 id="å®ˆæŠ¤æ€è¿è¡Œ"><a href="#å®ˆæŠ¤æ€è¿è¡Œ" class="headerlink" title="å®ˆæŠ¤æ€è¿è¡Œ"></a>å®ˆæŠ¤æ€è¿è¡Œ</h4><p>æ›´å¤šçš„æ—¶å€™ï¼Œéœ€è¦è®©Dockerå®¹å™¨åœ¨åå°ä»¥å®ˆæŠ¤æ€ï¼ˆDaemonizedï¼‰å½¢å¼è¿è¡Œï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ·»åŠ <strong>-d</strong> optionæ¥å®ç°.</p><ol><li>è¿è¡Œå®¹å™¨ï¼Œæ¯éš”ä¸€ç§’æ‰“å°å‡ºhello world<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d ubuntu /bin/sh -c <span class="string">"while true; do echo hello world; sleep 1; done"</span></span><br></pre></td></tr></table></figure></li><li>è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs ce90</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="ç»ˆæ­¢å®¹å™¨"><a href="#ç»ˆæ­¢å®¹å™¨" class="headerlink" title="ç»ˆæ­¢å®¹å™¨"></a>ç»ˆæ­¢å®¹å™¨</h3><p><strong>è¯­æ³•: docker stop [OPTIONS] CONTAINER [CONTAINERâ€¦]</strong><br>æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œç»ˆæ­¢å®¹å™¨åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œå…ˆå‘å®¹å™¨å‘é€ä¸€ä¸ªSIGTERMä¿¡å·ï¼Œ10ç§’é’Ÿåä¼šå†æ¬¡å‘é€ä¸€ä¸ªSIGKILLä¿¡å·ç»ˆæ­¢å®¹å™¨</p><ol><li>ç»ˆæ­¢ä¸Šæ–‡ä¸­å¯åŠ¨çš„å®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop ce90</span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹ç»ˆæ­¢çš„å®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a -q</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨å®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start ce90</span><br></pre></td></tr></table></figure></li><li>é‡å¯å®¹å™¨ï¼ˆå°†è¿è¡Œä¸­çš„å®¹å™¨ç»ˆæ­¢ï¼Œå¹¶é‡æ–°å¯åŠ¨ï¼‰<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker restart ce90</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h3><p>ä¸Šæ–‡ä¸­æåˆ°ä½¿ç”¨<strong>-d</strong>å‚æ•°å¯ä»¥ä½¿Dockeræˆå®ˆæŠ¤æ€è¿è¡Œï¼Œä½†æ˜¯ç”¨æˆ·æ— æ³•çœ‹åˆ°å®¹å™¨çš„å†…éƒ¨ä¿¡æ¯ï¼Œè€Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦è¿›å…¥åˆ°å®¹å™¨å†…è¿›è¡Œæ“ä½œï¼ŒDockerä¹Ÿæä¾›äº†é›†ä¸­æ–¹æ³•æ¥å®ç°è¿™ä¸ªåŠŸèƒ½</p><h4 id="docker-attach"><a href="#docker-attach" class="headerlink" title="docker attach"></a>docker attach</h4><p><strong>è¯­æ³•: docker attach [OPTIONS] CONTAINER</strong>, è¿è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œè¯¥å®¹å™¨å¿…é¡»æ˜¯è¿è¡ŒçŠ¶æ€ï¼ˆUPï¼‰,å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œä½¿ç”¨<strong>start</strong>å‘½ä»¤ï¼Œattachå‘½ä»¤å¯ä»¥ä¸ç”¨æŒ‡å®šå‘½ä»¤å‚æ•°ï¼Œé»˜è®¤æ‰§è¡Œä¸Šæ¬¡runçš„å‘½ä»¤å‚æ•°<strong>/bin/bash</strong>, ä½†æ˜¯å½“å¤šä¸ªçª—å£åŒæ—¶attachåˆ°åŒä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œæ‰€æœ‰çª—å£éƒ½ä¼šåŒæ­¥æ˜¾ç¤ºï¼Œå½“æŸä¸ªçª—å£å› ä¸ºæŸä¸€ä¸ªå‘½ä»¤é˜»å¡æ—¶ï¼Œå…¶ä»–çª—å£å°±æ— æ³•æ‰§è¡Œå…¶ä»–æ“ä½œäº†ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨.</p><ol><li>è¿›å…¥åˆšåˆšä»¥å®ˆæŠ¤æ€å¯åŠ¨çš„å®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker attach 9d89</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker attach --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="docker-exec"><a href="#docker-exec" class="headerlink" title="docker exec"></a>docker exec</h4><p><strong>è¯­æ³•: docker exec [OPTIONS] CONTAINER COMMAND [ARGâ€¦]</strong>, è¯¥å‘½ä»¤è‡³å°‘éœ€è¦ä¸€ä¸ªå‘½ä»¤å‚æ•°</p><ol><li>è¿›å…¥åˆšåˆšä¸€å®ˆæŠ¤æ€å¯åŠ¨çš„å®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it 9d89 /bin/bash</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h3><p><strong>è¯­æ³•: docker rm [OPTIONS] CONTAINER [CONTAINERâ€¦]</strong> åˆ é™¤å¤„äº <strong>ç»ˆæ­¢çŠ¶æ€</strong> çš„å®¹å™¨ï¼ŒåŒæ—¶å¯ä»¥è¾“å…¥å¤šä¸ªå®¹å™¨IDæ‰¹é‡åˆ é™¤å®¹å™¨</p><ol><li>åˆ é™¤å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm 9d89</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨"><a href="#å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨" class="headerlink" title="å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨"></a>å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨</h3><h4 id="å¯¼å‡ºå®¹å™¨"><a href="#å¯¼å‡ºå®¹å™¨" class="headerlink" title="å¯¼å‡ºå®¹å™¨"></a>å¯¼å‡ºå®¹å™¨</h4><p>å¯¼å‡ºå®¹å™¨æ˜¯æŒ‡å¯¼å‡ºä¸€ä¸ªå·²ç»åˆ›å»ºçš„å®¹å™¨åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ç®¡è¯¥å®¹å™¨æ˜¯å¦æ˜¯å¤„äºè¿è¡ŒçŠ¶æ€<br><strong>è¯­æ³•: docker export [OPTIONS] CONTAINER</strong></p><ol><li>å¯¼å‡º9d89å®¹å™¨åˆ°ubuntu_export.taræ–‡ä»¶<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">export</span> 9d89 &gt; ubuntu_export.tar</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">export</span> --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="å¯¼å…¥å®¹å™¨"><a href="#å¯¼å…¥å®¹å™¨" class="headerlink" title="å¯¼å…¥å®¹å™¨"></a>å¯¼å…¥å®¹å™¨</h4><p>å¯¼å‡ºçš„æ–‡ä»¶åˆå¯ä»¥ä½¿ç”¨<strong>docker import</strong> å‘½ä»¤å¯¼å…¥ï¼Œæˆä¸ºé•œåƒ</p><ol><li>å¯¼å…¥ä¸Šæ–‡ä¸­çš„ubuntu_export.taræ–‡ä»¶æˆä¸ºé•œåƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat ubuntu_export.tar | docker import - <span class="built_in">test</span>/ubuntu:v1.0</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker import --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­è®²è¿‡è½½å…¥é•œåƒ <strong>docker load</strong> å‘½ä»¤å¯¼å…¥é•œåƒæ–‡ä»¶åˆ°æœ¬åœ°é•œåƒåº“ï¼Œè¿™èŠ‚é€šè¿‡ <strong>docker import</strong> å‘½ä»¤æ¥å¯¼å…¥ä¸€ä¸ªå®¹å™¨å¿«ç…§åˆ°æœ¬åœ°é•œåƒåº“ï¼Œä½†æ˜¯å®¹å™¨å¿«ç…§æ–‡ä»¶å°†ä¸¢å¼ƒæ‰€æœ‰å†å²æ•°æ®å’Œå…ƒæ•°æ®ï¼ˆä»…ä»…ä¿å­˜å®¹å™¨å½“å‰çš„å¿«ç…§çŠ¶æ€ï¼‰ï¼Œ è€Œé•œåƒæ–‡ä»¶å½¢å¼ä¿å­˜å®Œæ•´è®°å½•ï¼Œä½“ç§¯è¦å¤§ï¼Œæ­¤å¤–ï¼Œå®¹å™¨å¿«ç…§å¯¼å…¥æ ‡ç­¾å¯ä»¥é‡æ–°æŒ‡å®šæ ‡ç­¾å…ƒæ•°æ®ç­‰ï¼Œå‘ä¸Šæ–‡ä¸­çš„test/ubuntu:v1.0</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ (ä¸‰)â€”â€”é•œåƒ</title>
      <link href="//p/docker-image.html"/>
      <url>//p/docker-image.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">é•œåƒæ˜¯Dockerè¿è¡Œå®¹å™¨çš„å‰æ</blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="http://fraserlife.com/2017/11/03/Docker%E5%AD%A6%E4%B9%A0-%E4%BA%8C-%E2%80%94%E2%80%94Docker%E6%9E%B6%E6%9E%84/#more" target="_blank" rel="noopener">Dockerå­¦ä¹ (äºŒ)â€”â€”Dockeræ¶æ„</a>è®²è¿°äº†Dockerçš„åŸºæœ¬æ¶æ„ï¼Œæ¥ä¸‹æ¥é€æ­¥æ‹†åˆ†è®²è§£Dockerçš„æ ¸å¿ƒå†…å®¹ä¹‹ä¸€â€”â€”<strong>é•œåƒ</strong>.</p><blockquote><p>Docker è¿è¡Œå®¹å™¨å‰éœ€è¦æœ¬åœ°å­˜æœ‰å¯¹åº”çš„é•œåƒï¼Œå¦‚æœé•œåƒä¸å­˜åœ¨ï¼ŒDockerä¼šå°è¯•å…ˆä»é»˜è®¤ï¼ˆDocker Hubå…¬å…±æ³¨å†ŒæœåŠ¡å™¨ä¸­çš„ä»“åº“ï¼‰é•œåƒä»“åº“ä¸‹è½½ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é…ç½®ä½¿ç”¨è‡ªå·±çš„ä»“åº“. æœ¬ç« å†…å®¹ä¸»è¦æœ‰ï¼š<em>è·å–é•œåƒï¼ŒæŸ¥çœ‹é•œåƒä¿¡æ¯ï¼Œæœå¯»é•œåƒï¼Œåˆ é™¤é•œåƒï¼Œåˆ›å»ºé•œåƒï¼Œå­˜å‚¨å’Œè½½å…¥é•œåƒï¼Œä¸Šä¼ é•œåƒ</em>. çœ‹ç€å†…å®¹å¾ˆå¤šï¼Œå…¶å®ç†Ÿæ‚‰Gitçš„æœ‹å‹ï¼Œåˆ†åˆ†é’Ÿå°±å¯ä»¥ç†è§£ä¸Šé¢çš„è¿™äº›å†…å®¹ï¼Œ æ“ä½œæ–¹å¼éƒ½æ˜¯ç›¸é€šçš„, è¯ä¸å¤šè¯´ï¼Œçœ‹å‘½ä»¤è¯´è¯.</p></blockquote><a id="more"></a><h3 id="è·å–é•œåƒ"><a href="#è·å–é•œåƒ" class="headerlink" title="è·å–é•œåƒ"></a>è·å–é•œåƒ</h3><p><strong>è¯­æ³•: docker pull NAME[:TAG]</strong></p><ol><li>ä»Docker Hubçš„Ubuntuä»“åº“ä¸‹è½½æœ€æ–°ç‰ˆæœ¬Ubuntué•œåƒ(å¦‚æœä¸æŒ‡å®štagï¼Œé»˜è®¤tagæ˜¯latest,å³ä¸‹è½½æœ€æ–°ç‰ˆæœ¬)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull ubuntu</span><br></pre></td></tr></table></figure></li><li>ä»Docker Hubçš„Ubuntuä»“åº“ä¸‹è½½æŒ‡å®šç‰ˆæœ¬Ubuntué•œåƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull ubuntu:16.04</span><br></pre></td></tr></table></figure></li><li>æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œé»˜è®¤æ˜¯ä»Docker Hubçš„Registryä¸­ä¸‹è½½ï¼Œæ‰€ä»¥ä»¥ä¸Šçš„å‘½ä»¤ç›¸å½“äº<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull registry.hub.docker.com/ubuntu:latest</span><br><span class="line">$ docker pull registry.hub.docker.com/ubuntu:16.04</span><br></pre></td></tr></table></figure></li><li>ä»å…¶ä»–æ³¨å†ŒæœåŠ¡å™¨ä¸‹è½½Dockeré•œåƒï¼ˆå¦‚DockerPoolç¤¾åŒºï¼Œéœ€è¦æŒ‡å®šå®Œæ•´çš„æ³¨å†ŒæœåŠ¡å™¨åœ°å€ï¼‰<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull dl.dockerpool.com:5000/ubuntu</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="æŸ¥çœ‹é•œåƒä¿¡æ¯"><a href="#æŸ¥çœ‹é•œåƒä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é•œåƒä¿¡æ¯"></a>æŸ¥çœ‹é•œåƒä¿¡æ¯</h3><p><strong>è¯­æ³•ï¼šdocker images</strong><br>é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼Œè¯´æ˜ä¸€ä¸‹æ‰§è¡Œè¯¥å‘½ä»¤ä¹‹åæ¯åˆ—çš„å«ä¹‰</p><blockquote><ol><li>REPOSITORY: æ¥è‡ªäºå“ªä¸ªä»“åº“ï¼ŒåŒæ ·æ˜¯å¦‚æœæ²¡æœ‰æŒ‡å®šæ³¨å†ŒæœåŠ¡å™¨çš„åœ°å€ï¼Œé‚£é»˜è®¤å°±æ˜¯Docker Hubçš„ä»“åº“</li><li>TAGï¼šé•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯”å¦‚latestã€16.04</li><li>IMAGE IDï¼šé•œåƒçš„å”¯ä¸€IDæ ‡è¯†</li><li>CREATED:ï¼ˆé•œåƒæ‹‰å–åˆ°æœ¬åœ°æˆ–è€…åœ¨æœ¬åœ°åˆ›å»ºé•œåƒçš„æ—¶é—´ï¼‰</li><li>VIRTUAL SIZE:é•œåƒçš„å¤§å°</li></ol><p><em>repositoryæ˜¯ä¸åŒçš„ä»“åº“ï¼Œtagæ˜¯æ ‡è®°åŒä¸€ä¸ªä»“åº“çš„ä¸åŒçš„é•œåƒ</em></p></blockquote><h4 id="Tagæ‰“æ ‡è®°"><a href="#Tagæ‰“æ ‡è®°" class="headerlink" title="Tagæ‰“æ ‡è®°"></a>Tagæ‰“æ ‡è®°</h4><p>æœ‰æ—¶å€™é•œåƒéœ€è¦ä¸€ä¸ªè‡ªå·±éœ€è¦çš„tagæ ‡è¯†ï¼Œè¿™ä¼šæˆ‘ä»¬éœ€è¦ç”¨åˆ°docker çš„tagå‘½ä»¤æ¥æ–¹ä¾¿æˆ‘ä»¬ç®¡ç†é•œåƒ<br><strong>è¯­æ³•ï¼šdocker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</strong></p><ol><li>ç»™é•œåƒæ‰“ä¸Šè‡ªå·±çš„æ ‡ç­¾<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag dl.dockerpool.com:5000/ubuntu:latest ubuntu:20171106_ubuntu</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><p>æ‰§è¡Œå®Œä»¥ä¸Šå‘½ä»¤å†æ¬¡æŸ¥çœ‹[<strong>docker images</strong>]æœ¬åœ°æ‰€æœ‰é•œåƒï¼Œå‘ç°æˆ‘ä»¬æ‰“äº†æ ‡è®°çš„é•œåƒå’Œè¢«æ‰“æ ‡è®°çš„é•œåƒçš„é•œåƒIDç«Ÿç„¶ä¸€æ ·.è¿™è¯´æ˜æ–°æ‰“ä¸Šæ ‡ç­¾çš„é•œåƒåªæ˜¯æŒ‡å‘äº†åŒä¸€ä¸ªé•œåƒæ–‡ä»¶ï¼Œåªæ˜¯åˆ«åä¸åŒï¼Œæ ‡ç­¾åœ¨è¿™é‡Œå°±èµ·åˆ°äº†å¼•ç”¨æˆ–å¿«æ·æ–¹å¼çš„ä½œç”¨.</p><h4 id="æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯</h4><p><strong>è¯­æ³•ï¼šdocker inspect [OPTIONS] NAME|ID [NAME|ID]</strong><br><em>æ‰§è¡Œ[docker inspect]å‘½ä»¤ä¼šå¾—åˆ°ä¸€ä¸ªJsonæ ¼å¼çš„ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å…³æ³¨æŸä¸€ä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨[-f]å‚æ•°æ¥ä½¿ç”¨ï¼Œé•œåƒIDä½¿ç”¨å‰å‡ ä¸ªå­—ç¬¦å°±å¯ä»¥ï¼Œä¸ç”¨è¾“å…¥å…¨éƒ¨</em></p><ol><li>æŸ¥çœ‹åˆšåˆšæ‰“äº†æ ‡è®°çš„Ubuntué•œåƒçš„è¯¦ç»†ä¿¡æ¯(é•œåƒIDå› äººè€Œå¼‚)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect 5506de2b643b</span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹é•œåƒæŒ‡å®šçš„è¯¦ç»†ä¿¡æ¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect -f &#123;&#123;<span class="string">".Architecture"</span>&#125;&#125; 5506</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="æœå¯»é•œåƒ"><a href="#æœå¯»é•œåƒ" class="headerlink" title="æœå¯»é•œåƒ"></a>æœå¯»é•œåƒ</h3><p><strong>è¯­æ³•ï¼šdocker search [OPTIONS] TERM</strong></p><ol><li>æœå¯»mysqlé•œåƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker search mysql</span><br></pre></td></tr></table></figure></li><li>è¯´æ˜ä¸€ä¸‹æ‰§è¡Œè¯¥å‘½ä»¤ä¹‹åæ¯åˆ—çš„å«ä¹‰<blockquote><ul><li>NAME: é•œåƒåç§°</li><li>DESCRIPTIONï¼šç«ç›¸æè¿°</li><li>STARTSï¼šé•œåƒæ˜Ÿçº§ï¼ˆä»£è¡¨å—æ¬¢è¿ç¨‹åº¦ï¼‰</li><li>OFFICIAL:æ˜¯å¦ä¸ºå®˜æ–¹åˆ›å»ºå’Œç»´æŠ¤çš„</li><li>AUTOMATED:æ˜¯å¦è‡ªåŠ¨åˆ›å»ºï¼ˆè‡ªåŠ¨åˆ›å»ºçš„èµ„æºå…è®¸ç”¨æˆ·éªŒè¯é•œåƒå†…å®¹ä»¥åŠæ¥æºï¼‰</li></ul></blockquote></li></ol><h3 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h3><p><strong>è¯­æ³•ï¼šdocker rmi [OPTIONS] IMAGE [IMAGEâ€¦]</strong>, IMAGEå¯ä»¥æ˜¯é•œåƒæ ‡ç­¾æˆ–è€…é•œåƒIDï¼Œrmiå…¶å®å°±æ˜¯remove imageçš„ç¼©å†™.</p><blockquote><p>åˆ é™¤é•œåƒè¿™é‡Œçš„è§„çŸ©ç¨ç¨å¤šä¸€ç‚¹ä½†æ˜¯éµå¾ªä»¥ä¸‹å‡ ä¸ªåŸåˆ™ï¼Œä¸ç”¨èƒŒè¯µä»¥ä¸‹ï¼Œä¼šåœ¨åé¢çš„å®è·µä¸­é€æ­¥æ¥éªŒè¯</p><ol><li>å½“æœ¬åœ°ä¸€ä¸ªé•œåƒæœ‰å¤šä¸ªæ ‡ç­¾æ—¶ï¼Œåˆ é™¤æŸä¸€ä¸ªæ ‡ç­¾ä¸å½±å“å…¶ä»–é•œåƒ</li><li>å½“æœ¬åœ°ä¸€ä¸ªé•œåƒåªæœ‰ä¸€ä¸ªæ ‡ç­¾æ—¶ï¼Œåˆ é™¤è¯¥æ ‡ç­¾ä¼šå½»åº•åˆ é™¤è¯¥é•œåƒ</li><li>å½“é€šè¿‡é•œåƒIDåˆ é™¤é•œåƒçš„æ—¶å€™ï¼Œä¼šé€ä¸ªåˆ é™¤æŒ‡å‘è¯¥é•œåƒçš„æ ‡ç­¾ï¼Œæœ€ç»ˆåˆ é™¤é•œåƒ.</li><li>å½“æœ‰è¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨å­˜åœ¨æ—¶ï¼Œé•œåƒä¸ä¼šè¢«åˆ é™¤ï¼Œdockerä¼šæ›´æ¢è¯¥é•œåƒIDï¼Œå¹¶ä¸”é•œåƒæ²¡æœ‰åå­—.</li><li>å½“æœ‰è¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨å­˜åœ¨æ—¶,å¯ä»¥ä½¿ç”¨[-f] å‚æ•°æ¥å¼ºåˆ¶åˆ é™¤é•œåƒï¼ˆä¸å»ºè®®è¿™æ ·åšï¼‰</li><li>å½“æœ‰è¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨å­˜åœ¨æ—¶,åº”éµå¾ªå…ˆåˆ é™¤å®¹å™¨ï¼Œç„¶åå†åˆ é™¤é•œåƒ</li></ol></blockquote><ol><li>åˆ é™¤mysqlé•œåƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rmi mysql:latest</span><br></pre></td></tr></table></figure></li></ol><h3 id="åˆ›å»ºé•œåƒ"><a href="#åˆ›å»ºé•œåƒ" class="headerlink" title="åˆ›å»ºé•œåƒ"></a>åˆ›å»ºé•œåƒ</h3><p>åˆ›å»ºé•œåƒæœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ol><li>åŸºäºå·²æœ‰é•œåƒçš„<strong>å®¹å™¨</strong>åˆ›å»º</li><li>åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥</li><li>åŸºäºDockerfileåˆ›å»ºï¼ˆæœ€å¸¸ç”¨ï¼Œæ­¤å¤„å…ˆäº†è§£æ•´ä¸ªè¿‡ç¨‹ï¼Œåç»­ç« èŠ‚ç»å¸¸ä½¿ç”¨çš„æ—¶å€™è‡ªç„¶å°±ä¼šäº†ï¼‰</li></ol><h4 id="åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»ºæ–°é•œåƒ"><a href="#åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»ºæ–°é•œåƒ" class="headerlink" title="åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»ºæ–°é•œåƒ"></a>åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»ºæ–°é•œåƒ</h4><p><strong>è¯­æ³•ï¼šdocker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</strong></p><ol><li>å¯åŠ¨é•œåƒï¼ˆé€šè¿‡å®¹å™¨è¿è¡ŒUbuntu16.04, å¹¶ä¸”è¿›å…¥bashç¯å¢ƒï¼‰ï¼Œè¿è¡Œåé€šè¿‡[docker ps -a]æ¥æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ï¼Œå½“ä¸‹ä¸»è¦å…³æ³¨å®¹å™¨ID<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it ubuntu:1604 /bin/bash</span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºtestæ–‡ä»¶å¹¶ä¸”é€€å‡ºå®¹å™¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch <span class="built_in">test</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></li><li>é€šè¿‡è¿è¡Œçš„å®¹å™¨åˆ›å»ºæ–°çš„é•œåƒ,æ‰§è¡ŒæˆåŠŸåä¼šè¿”å›æ–°åˆ›å»ºçš„é•œåƒIDä¿¡æ¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker commit -m <span class="string">"added a new file"</span> -a <span class="string">"fraser"</span> a925cb <span class="built_in">test</span>:latest</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£[â€œ-mâ€:æäº¤ä¿¡æ¯,â€-aâ€:ä½œè€…ä¿¡æ¯,â€-pâ€:æäº¤æ—¶æš‚åœå®¹å™¨è¿è¡Œ]<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker commit --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥"><a href="#åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥" class="headerlink" title="åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥"></a>åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥</h4><p>å¯ä»¥ç›´æ¥ä»ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ¨¡æ¿æ–‡ä»¶å¯¼å…¥ä¸€ä¸ªé•œåƒï¼Œæ¨è<a href="https://download.openvz.org/template/precreated/" target="_blank" rel="noopener">OpenVZ</a>æä¾›çš„æ¨¡æ¿æ¥åˆ›å»º(ä¸ªäººè§‰å¾—è¿™ä¸ªåº”ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œäº†è§£å³å¯)</p><ol><li>é€šè¿‡æ¨¡æ¿æ–‡ä»¶å¯¼å…¥<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cat ubuntu-16.04-x86_64.tar.gz | docker import - ubuntu:1604</span><br></pre></td></tr></table></figure></li></ol><h4 id="åŸºäºDockerfileåˆ›å»º"><a href="#åŸºäºDockerfileåˆ›å»º" class="headerlink" title="åŸºäºDockerfileåˆ›å»º"></a>åŸºäºDockerfileåˆ›å»º</h4><p>Dockerfileéœ€è¦è®²è§£çš„å†…å®¹å¾ˆå¤šï¼ŒåŒ…æ‹¬é‡Œé¢å„ä¸ªæŒ‡ä»¤çš„åº”ç”¨ï¼Œæˆ‘ä»¬ä¼šå•ç‹¬æ‹¿å‡ºä¸€ä¸ªç« èŠ‚æ¥è®²è§£<a href="www.baidu.com">Dockerfile</a>.</p><h3 id="å­˜å‡ºå’Œè½½å…¥é•œåƒ"><a href="#å­˜å‡ºå’Œè½½å…¥é•œåƒ" class="headerlink" title="å­˜å‡ºå’Œè½½å…¥é•œåƒ"></a>å­˜å‡ºå’Œè½½å…¥é•œåƒ</h3><h4 id="å­˜å‡ºé•œåƒ"><a href="#å­˜å‡ºé•œåƒ" class="headerlink" title="å­˜å‡ºé•œåƒ"></a>å­˜å‡ºé•œåƒ</h4><p><strong>è¯­æ³•ï¼šdocker save [OPTIONS] IMAGE [IMAGEâ€¦]</strong> , å­˜å‡ºé•œåƒåˆ°æœ¬åœ°æ–‡ä»¶</p><ol><li>å­˜å‡ºæœ¬åœ°çš„ubuntu:1604é•œåƒä¸ºubuntu_1604.tar<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker save -o ubuntu_1604.tar ubuntu:1604</span><br></pre></td></tr></table></figure></li><li>è¯¦ç»†ä¿¡æ¯è¯·ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªè¡Œäº†è§£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker save --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="è½½å…¥é•œåƒ"><a href="#è½½å…¥é•œåƒ" class="headerlink" title="è½½å…¥é•œåƒ"></a>è½½å…¥é•œåƒ</h4><p><strong>è¯­æ³•ï¼šdocker load [OPTIONS]</strong> , ä»å­˜å‡ºçš„æœ¬åœ°æ–‡ä»¶ä¸­å†å¯¼å…¥åˆ°æœ¬åœ°é•œåƒåº“</p><ol><li>ä»ubuntu_1604.taræ–‡ä»¶å¯¼å…¥é•œåƒåˆ°åˆ°æœ¬åœ°é•œåƒåˆ—è¡¨<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker load --input ubuntu_1604.tar</span><br><span class="line">æˆ–</span><br><span class="line">$ docker load &lt; ubuntu_1604.tar</span><br></pre></td></tr></table></figure></li></ol><h3 id="ä¸Šä¼ é•œåƒ"><a href="#ä¸Šä¼ é•œåƒ" class="headerlink" title="ä¸Šä¼ é•œåƒ"></a>ä¸Šä¼ é•œåƒ</h3><p><strong>è¯­æ³•ï¼šdocker push [OPTIONS] NAME[:TAG]</strong><br>ç”¨æˆ·åœ¨DockerHubä¸Šå®Œæˆæ³¨å†Œä¹‹åï¼Œå³å¯ä¸Šä¼ è‡ªåˆ¶çš„é•œåƒï¼Œä½†æ˜¯éœ€è¦æ‰“ä¸Šå¸¦æœ‰<strong>user</strong>çš„æ ‡ç­¾ï¼ˆæ³¨å†Œçš„ç”¨æˆ·åï¼‰</p><ol><li>å°†æœ¬åœ°hello-worldé•œåƒåŠ ä¸Šæ ‡ç­¾<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag hello-world:latest fraseryu/helloworld:latest</span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨å¯ä»¥çœ‹åˆ°æ‰“ä¸Šæ ‡ç­¾çš„é•œåƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br></pre></td></tr></table></figure></li><li>ç™»å½•å®ŒæˆDockerHubæˆæƒè®¤è¯ï¼Œè¾“å…¥åˆšåˆšåœ¨DockerHubä¸Šæ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker login</span><br></pre></td></tr></table></figure></li><li>pushæœ¬åœ°è®¢åˆ¶çš„é•œåƒåˆ°DockerHub<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker push fraseryu/helloworld:latest</span><br></pre></td></tr></table></figure></li><li>ç™»å½•DockerHubçœ‹åˆ°æˆ‘ä»¬çš„é•œåƒå·²ç»pushæˆåŠŸ<img itemprop="url image" src="/uploads/push.png"/></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ (äºŒ)â€”â€”Dockeræ¶æ„</title>
      <link href="//p/docker-architect.html"/>
      <url>//p/docker-architect.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">åƒé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€æ ·ç†è§£Dockeré•œåƒä¸å®¹å™¨</blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="http://fraserlife.com/2017/11/01/Docker%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E2%80%94%E2%80%94Docker%E5%AE%89%E8%A3%85/#more" target="_blank" rel="noopener">Dockerå­¦ä¹ (ä¸€)â€”â€”Dockerå®‰è£…</a>è®²è¿°äº†åœ¨Ubuntuä¸‹å®‰è£…ï¼Œå®‰è£…å®Œäº†è¦äº†è§£ä¸€ä¸‹Dockeræ¶æ„ä¸ä¸€äº›åè¯è§£é‡Šï¼Œè¿™æ ·å¯¹Dockeråç»­çš„æ“ä½œä¼šæœ‰æ›´å¥½çš„ç†è§£.</p><p>Docker ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ (C/S) æ¶æ„æ¨¡å¼ï¼Œä½¿ç”¨è¿œç¨‹APIæ¥ç®¡ç†å’Œåˆ›å»ºDockerå®¹å™¨, ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬é€šè¿‡Dockerå®¢æˆ·ç«¯æ¥å®Œæˆå¯¹é•œåƒä»¥åŠå®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œ</p><img itemprop="url image" src="/uploads/architecture.jpg" class="full-image" /><p>å¯¹äºä¸Šé¢çš„å›¾ç‰‡å‡ºç°çš„ä¸€ç³»åˆ—åè¯å¯ä»¥è¿™æ ·ç†è§£ï¼š</p><a id="more"></a><table><thead><tr><th align="left">åè¯æœ¯è¯­</th><th align="left">è§£é‡Š</th></tr></thead><tbody><tr><td align="left">Docker é•œåƒ(Images)</td><td align="left">Docker é•œåƒæ˜¯ç”¨äºåˆ›å»º Docker å®¹å™¨çš„æ¨¡æ¿</td></tr><tr><td align="left">Docker å®¹å™¨(Container)</td><td align="left">å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨</td></tr><tr><td align="left">Docker å®¢æˆ·ç«¯(Client)</td><td align="left">Docker å®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–å·¥å…·ä½¿ç”¨ Docker API (<a href="https://docs.docker.com/reference/api/docker_remote_api" target="_blank" rel="noopener">https://docs.docker.com/reference/api/docker_remote_api</a>) ä¸ Docker çš„å®ˆæŠ¤è¿›ç¨‹é€šä¿¡</td></tr><tr><td align="left">Docker ä¸»æœº(Host)</td><td align="left">ä¸€ä¸ªç‰©ç†æˆ–è€…è™šæ‹Ÿçš„æœºå™¨ç”¨äºæ‰§è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨</td></tr><tr><td align="left">Docker ä»“åº“(Registry)</td><td align="left">Docker ä»“åº“ç”¨æ¥ä¿å­˜é•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç æ§åˆ¶ä¸­çš„ä»£ç ä»“åº“ï¼ŒDocker Hub(<a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a>) æä¾›äº†åºå¤§çš„é•œåƒé›†åˆä¾›ä½¿ç”¨</td></tr></tbody></table><p><em>å…³äºRegistryæˆ‘è¦å¤šè¯´ä¸€å¥ï¼Œåº”è¯¥æŠŠå®ƒç†è§£æˆç®¡ç†ä»“åº“çš„ä»“åº“ï¼Œè¿™ä¸ªä»“åº“ä¸­æœ‰Ubuntuä»“åº“ï¼ŒApacheä»“åº“ï¼ŒNginxä»“åº“ç­‰ï¼Œ æ¯ä¸ªå°ä»“åº“è¿˜éƒ½ç®¡ç†ä¸åŒversionçš„é•œåƒï¼Œå¦‚Ubuntu1604,Ubuntu1404ç­‰.</em></p><p>æ–‡ç« å¼€å¤´æåˆ°<strong>åƒé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€æ ·ç†è§£Dockeré•œåƒä¸å®¹å™¨</strong>ï¼Œçœ‹å¦‚ä¸‹è¡¨æ ¼ï¼Œä¸€ä¸ªç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼ˆé™¤äº†å•ä¾‹æ¨¡å¼ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé•œåƒå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨æ¥è¿è¡Œ.</p><table><thead><tr><th align="left">Docker</th><th align="left">é¢å‘å¯¹è±¡</th></tr></thead><tbody><tr><td align="left">é•œåƒ</td><td align="left">ç±»</td></tr><tr><td align="left">å®¹å™¨</td><td align="left">å¯¹è±¡</td></tr></tbody></table><p>å……åˆ†ç†è§£ä¸€ä¸‹è¿™ç¯‡æ¶æ„å›¾ä»¥åŠåè¯è§£é‡Šï¼Œå°±è¦è¿›å…¥æ¥ä¸‹æ¥çš„Dockerä¹‹æ—…äº†.</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="http://www.runoob.com/docker/docker-architecture.html" target="_blank" rel="noopener">Dockeræ¶æ„</a></li><li><a href="http://www.cnblogs.com/SzeCheng/p/6822905.html" target="_blank" rel="noopener">å‡ å¼ å›¾å¸®ä½ ç†è§£ docker åŸºæœ¬åŸç†åŠå¿«é€Ÿå…¥é—¨</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ (ä¸€)â€”â€”Dockerå®‰è£…</title>
      <link href="//p/docker-install.html"/>
      <url>//p/docker-install.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">Docker, incredible virtual machine</blockquote><img itemprop="url image" src="/uploads/dockerIs.png" class="full-image" /><h3 id="ä»€ä¹ˆæ˜¯Docker"><a href="#ä»€ä¹ˆæ˜¯Docker" class="headerlink" title="ä»€ä¹ˆæ˜¯Docker"></a>ä»€ä¹ˆæ˜¯Docker</h3><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œä»‹ç»ä¸€äº›å†å²ï¼Œè¯´æ˜ä¸€ä¸‹æ¥é¾™å»è„‰ï¼Œè‡³å°‘çŸ¥é“å®ƒæ˜¯æ€ä¹ˆæ¥çš„ï¼Œåˆä¸ºä»€ä¹ˆä¼šæ¥ï¼Œèƒ½å¹²ä»€ä¹ˆ</p><blockquote><ol><li>Docker æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè¯ç”Ÿäº 2013 å¹´åˆï¼Œæœ€åˆæ˜¯ dotCloud å…¬å¸å†…éƒ¨çš„ä¸€ä¸ªä¸šä½™é¡¹ç›®ã€‚å®ƒåŸºäº Google å…¬å¸æ¨å‡ºçš„ Go è¯­è¨€å®ç°ã€‚ é¡¹ç›®åæ¥åŠ å…¥äº† Linux åŸºé‡‘ä¼šï¼Œéµä»äº† Apache 2.0 åè®®ï¼Œé¡¹ç›®ä»£ç åœ¨ GitHub ä¸Šè¿›è¡Œç»´æŠ¤</li><li>Docker è‡ªå¼€æºåå—åˆ°å¹¿æ³›çš„å…³æ³¨å’Œè®¨è®ºï¼Œä»¥è‡³äº dotCloud å…¬å¸åæ¥éƒ½æ”¹åä¸º Docker Incã€‚Redhat å·²ç»åœ¨å…¶ RHEL6.5 ä¸­é›†ä¸­æ”¯æŒ Dockerï¼›Google ä¹Ÿåœ¨å…¶ PaaS äº§å“ä¸­å¹¿æ³›åº”ç”¨ã€‚</li><li>Docker é¡¹ç›®çš„ç›®æ ‡æ˜¯å®ç°è½»é‡çº§çš„æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚ Docker çš„åŸºç¡€æ˜¯ Linux å®¹å™¨ï¼ˆLXCï¼‰ç­‰æŠ€æœ¯ã€‚åœ¨ LXC çš„åŸºç¡€ä¸Š Docker è¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œè®©ç”¨æˆ·ä¸éœ€è¦å»å…³å¿ƒå®¹å™¨çš„ç®¡ç†ï¼Œä½¿å¾—æ“ä½œæ›´ä¸ºç®€ä¾¿ã€‚ç”¨æˆ·æ“ä½œ Docker çš„å®¹å™¨å°±åƒæ“ä½œä¸€ä¸ªå¿«é€Ÿè½»é‡çº§çš„è™šæ‹Ÿæœºä¸€æ ·ç®€å•ã€‚</li></ol></blockquote><a id="more"></a><h3 id="Dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„å¯¹æ¯”"><a href="#Dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„å¯¹æ¯”" class="headerlink" title="Dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„å¯¹æ¯”"></a>Dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„å¯¹æ¯”</h3><p>é€šè¿‡ä¸¤å¼ å›¾ï¼Œæ¥ç†è§£ä¸€ä¸‹Dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„å¯¹æ¯”ï¼Œé€šè¿‡ä¸‹é¢ä¸¤å¼ å›¾èƒ½çœ‹å‡ºæ¥DockerèŠ‚çœäº†å“ªäº›èµ„æºå³å¯,å…¶ä»–çš„å¥½å¤„åœ¨åé¢çš„å­¦ä¹ è¿‡ç¨‹ä¸­é™†ç»­ä»‹ç»<br><img itemprop="url image" src="/uploads/virtualization.png"/><br><img itemprop="url image" src="/uploads/docker.png"/></p><p>Dockerç›®å‰åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬</p><ol><li>Docker Enterprise Edition (Docker EE) ä¸“ä¸ºä¼ä¸šå¼€å‘å’ŒITå›¢é˜Ÿè®¾è®¡ï¼Œç”¨äºåœ¨å¤§è§„æ¨¡ç”Ÿäº§ä¸­æ„å»ºï¼Œè¿é€å’Œè¿è¡Œå…³é”®ä¸šåŠ¡åº”ç”¨ç¨‹åºDocker EEé›†æˆï¼Œè®¤è¯å’Œæ”¯æŒï¼Œä¸ºä¼ä¸šæä¾›ä¸šç•Œæœ€å®‰å…¨çš„å®¹å™¨å¹³å°ï¼Œä½¿æ‰€æœ‰åº”ç”¨ç¨‹åºç°ä»£åŒ–</li><li>Docker Community Edition (Docker CE) æ˜¯å¼€å‘äººå‘˜å’Œå°å›¢é˜Ÿçš„ç†æƒ³é€‰æ‹©ï¼Œå¸Œæœ›å¼€å§‹ä½¿ç”¨Dockerå¹¶å°è¯•åŸºäºå®¹å™¨çš„åº”ç”¨ç¨‹åºDocker CEå¯åœ¨è®¸å¤šå¹³å°ä¸Šä½¿ç”¨ï¼Œä»æ¡Œé¢åˆ°äº‘åˆ°æœåŠ¡å™¨</li></ol><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>Dockerç³»åˆ—å­¦ä¹ ä¸»è¦é€šè¿‡ VirtualBox åœ¨ Ubuntu16.04 ä¸­å®Œæˆå®‰è£…ä»¥åŠåç»­è¿›é˜¶è¯¾ç¨‹çš„å­¦ä¹ , Dockerç‰ˆæœ¬ä¸ºDockerCE</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="å®‰è£…Ubuntu16-04"><a href="#å®‰è£…Ubuntu16-04" class="headerlink" title="å®‰è£…Ubuntu16.04"></a>å®‰è£…Ubuntu16.04</h4><p>VirtualBox å®‰è£…Ubuntu1604è¯·å‚è€ƒ<a href="http://blog.csdn.net/liaolu2999/article/details/52081438" target="_blank" rel="noopener">åœ¨virtualboxä¸‹å®‰è£…ubuntu server 16.04</a></p><h4 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h4><p>æŒ‰ç…§Dockerå®˜ç½‘<a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">Get Docker CE for Ubuntu</a>æè¿°å®‰è£…DockerCE</p><h5 id="æ£€æŸ¥å®‰è£…æ¡ä»¶"><a href="#æ£€æŸ¥å®‰è£…æ¡ä»¶" class="headerlink" title="æ£€æŸ¥å®‰è£…æ¡ä»¶"></a>æ£€æŸ¥å®‰è£…æ¡ä»¶</h5><p>Docker è¦æ±‚ Ubuntu ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº 3.10 ï¼ŒæŸ¥çœ‹æœ¬é¡µé¢çš„å‰ææ¡ä»¶æ¥éªŒè¯ä½ çš„ Ubuntu ç‰ˆæœ¬æ˜¯å¦æ”¯æŒ Dockerã€‚<br>é€šè¿‡ uname -r å‘½ä»¤æŸ¥çœ‹ä½ å½“å‰çš„å†…æ ¸ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ uname -r</span><br></pre></td></tr></table></figure><h5 id="å¸è½½æ—§çš„ç‰ˆæœ¬"><a href="#å¸è½½æ—§çš„ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§çš„ç‰ˆæœ¬"></a>å¸è½½æ—§çš„ç‰ˆæœ¬</h5><p>è€çš„Dockerç‰ˆæœ¬æˆ‘ä»¬å«åš<strong>docker</strong>æˆ–<strong>docker-engine</strong>, å¦‚æœä¹‹å‰å®‰è£…è¿‡ï¼Œè¿™é‡Œéœ€è¦å…ˆå¸è½½, Docker CE packageç°åœ¨å«åšdocker-ce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get remove docker docker-engine docker.io</span><br></pre></td></tr></table></figure><h5 id="æ­å»ºDockerä»“åº“"><a href="#æ­å»ºDockerä»“åº“" class="headerlink" title="æ­å»ºDockerä»“åº“"></a>æ­å»ºDockerä»“åº“</h5><p>é¦–æ¬¡åœ¨å®¿ä¸»æœºä¸Šå®‰è£…DockerCEï¼Œéœ€è¦æ­å»ºDocker repository,æ­å»ºå®Œæˆåï¼Œå¯ä»¥é€šè¿‡repositoryå®‰è£…æˆ–æ›´æ–°Docker.</p><ol><li>æ›´æ–°apt package<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure></li><li>å…è®¸aptç”¨httpsæ–¹å¼è®¿é—®Dockerä»“åº“ï¼ˆå‘½ä»¤å¤ªé•¿å¯ä»¥ç”¨ <strong>\</strong> ç¬¦å·æ¢è¡Œï¼‰<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install \</span><br><span class="line">  apt-transport-https \</span><br><span class="line">  ca-certificates \</span><br><span class="line">  curl \</span><br><span class="line">  software-properties-common</span><br></pre></td></tr></table></figure></li><li>æ·»åŠ Dockerçš„å®˜æ–¹GPGå¯†é’¥<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure></li><li>éªŒè¯fingerprint</li></ol><p><strong>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</strong>, ç”¨åå…«ä½å­—ç¬¦å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key fingerprint 0EBFCD88</span><br></pre></td></tr></table></figure><ol start="5"><li>è®¾ç½®ç¨³å®šç‰ˆRepository<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">  <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">  stable"</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="å®‰è£…Docker-CE"><a href="#å®‰è£…Docker-CE" class="headerlink" title="å®‰è£…Docker CE"></a>å®‰è£…Docker CE</h5><ol><li>æ›´æ–°aptç´¢å¼•<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure></li><li>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Docker CE<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure></li><li>ç”Ÿäº§ç¯å¢ƒæŒ‡å®šDockerç‰ˆæœ¬<br>ç”Ÿäº§ç¯å¢ƒä¸ºäº†ç¨³å®šæ€§ä¼šé€‰æ‹©æŒ‡å®šç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯Dokcerçš„æœ€æ–°ç‰ˆæœ¬ï¼ŒæŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ apt-cache madison docker-ce</span><br><span class="line"></span><br><span class="line">docker-ce | 17.09.0~ce-0~ubuntu | https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages</span><br></pre></td></tr></table></figure></li><li>å®‰è£…æŒ‡å®šDocker CE ç‰ˆæœ¬<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce=&lt;VERSION&gt;</span><br></pre></td></tr></table></figure></li><li>ç¡®è®¤Docker CE æ˜¯å¦å®‰è£…æˆåŠŸ</li></ol><p><strong>ä»”ç»†é˜…è¯»docker run hello-worldçš„è¾“å‡ºå†…å®¹ï¼Œå¯¹äºç†è§£dockerçš„å·¥ä½œåŸç†æœ‰å¸®åŠ©</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br><span class="line">$ sudo docker version</span><br></pre></td></tr></table></figure><ol start="6"><li>å¯åŠ¨Docker<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start docker</span><br></pre></td></tr></table></figure></li><li>é‡æ–°å¯åŠ¨Docker<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart docker</span><br></pre></td></tr></table></figure></li></ol><h5 id="Dockerå‘½ä»¤å»æ‰sudo"><a href="#Dockerå‘½ä»¤å»æ‰sudo" class="headerlink" title="Dockerå‘½ä»¤å»æ‰sudo"></a>Dockerå‘½ä»¤å»æ‰sudo</h5><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¯æ¬¡æ•²dockerå‘½ä»¤éƒ½éœ€è¦sudoæƒé™ï¼Œä¸‹é¢çš„æ–¹æ³•å¯ä»¥çœå»sudoæ–¹ä¾¿å¾ˆå¤š.</p><ol><li>åˆ›å»ºdockerç»„<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo groupadd docker</span><br></pre></td></tr></table></figure></li><li>æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li><li>ç™»å‡ºï¼Œé‡æ–°ç™»å½•shell</li><li>éªŒè¯dockerå‘½ä»¤æ˜¯å¦å¯ä»¥è¿è¡Œï¼ˆæ³¨æ„æ²¡æœ‰sudoï¼‰<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŒ‡æ•°åŸºé‡‘äº¤æ˜“ä¼šäº§ç”Ÿå“ªäº›è´¹ç”¨</title>
      <link href="//p/investment-index-fee.html"/>
      <url>//p/investment-index-fee.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>åœ¨è´­ä¹°æŒ‡æ•°åŸºé‡‘æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è®©äººçœ¼èŠ±ç¼­ä¹±çš„å„ç§è´¹ç”¨ï¼Œæ—¢ç„¶ç†è´¢äº†ï¼Œå°±è¦çŸ¥é“ï¼š</p><ol><li>æˆ‘ä»¬ä¸ºäº†è´­ä¹°è¿™äº›åŸºé‡‘éƒ½å‘ç”Ÿäº†é‚£äº›è´¹ç”¨ï¼Ÿ</li><li>æ€æ ·è´­ä¹°æ–¹å¼èƒ½èŠ‚çœè¿™äº›è´¹ç”¨ï¼Ÿ</li></ol><p><strong>äº†è§£è¿™äº›å¯¹äºæˆ‘ä»¬è´¢å¯Œå¢é•¿å°†ä¼šèµ·åˆ°é‡è¦ä½œç”¨</strong>ï¼Œ ä»¥ä¸‹æ–‡ç« æ˜¯å€Ÿé‰´å‰è¾ˆâ€é“¶è¡Œèºä¸é’‰â€ çš„æ–‡ç« åŠ ä»¥æ€»ç»“.</p><h3 id="é’±éƒ½èŠ±åˆ°å“ªé‡Œå»äº†"><a href="#é’±éƒ½èŠ±åˆ°å“ªé‡Œå»äº†" class="headerlink" title="é’±éƒ½èŠ±åˆ°å“ªé‡Œå»äº†"></a>é’±éƒ½èŠ±åˆ°å“ªé‡Œå»äº†</h3><p>ç”³è´­è´¹ã€èµå›è´¹ã€äº¤æ˜“ä½£é‡‘ã€å°èŠ±ç¨ã€æœåŠ¡è´¹ã€æ‰˜ç®¡è´¹ã€ç®¡ç†è´¹â€¦â€¦, åœ¨äº†è§£è¿™ä¹ˆå¯¹è´¹ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æŒ‡æ•°åŸºé‡‘æŒ‰ç…§è´­ä¹°æ–¹å¼å¯ä»¥åˆ†ä¸ºï¼š</p><a id="more"></a><ol><li><p>åœºå†…åŸºé‡‘</p><blockquote><p>åœºå†…åŸºé‡‘æŒ‡çš„æ˜¯ä¸Šå¸‚ï¼ˆè‚¡å¸‚ï¼‰äº¤æ˜“çš„åŸºé‡‘ï¼Œåªèƒ½ç”¨è¯åˆ¸å¸æˆ·è´­ä¹°ï¼Œä¸»è¦æ˜¯å°é—­å¼åŸºé‡‘å’Œä¸Šå¸‚å‹å¼€æ”¾å¼åŸºé‡‘ï¼ˆLOFåŸºé‡‘ï¼‰</p></blockquote></li><li><p>åœºå¤–åŸºé‡‘</p><blockquote><p>åœºå¤–åŸºé‡‘ä¸ä¸Šå¸‚äº¤æ˜“ï¼Œæ˜¯åªèƒ½åœ¨æŒ‡å®šçš„ç½‘ç‚¹ï¼ˆé“¶è¡Œã€åŸºé‡‘å…¬å¸ã€è¯åˆ¸å…¬å¸ç­‰ï¼‰ç”³è´­çš„åŸºé‡‘ï¼Œå¦‚ä¸€èˆ¬çš„å¼€æ”¾å¼åŸºé‡‘</p></blockquote></li></ol><p>åœºå†…åŸºé‡‘ï¼Œä¾‹å¦‚ETFåŸºé‡‘ï¼Œå®ƒæ—¢å¯ä»¥ç”³è´­èµå›ï¼Œåˆå¯ä»¥ä¹°å–ã€‚ç”³è´­èµå›éœ€è¦å‡ åä¸‡èµ·ï¼Œä¹°å–åˆ™æ˜¯100è‚¡èµ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æ˜¯é€šè¿‡ä¹°å–è·å–ETFåŸºé‡‘ã€‚åœºå¤–åŸºé‡‘ä¸€èˆ¬åªæœ‰ç”³è´­èµå›ï¼Œå¤§éƒ¨åˆ†æ˜¯1000å…ƒèµ·ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ç”³èµè·å–åœºå¤–åŸºé‡‘ï¼Œå…ˆåšä¸€ä¸ªè¡¨æ ¼æ¥è¯´æ˜è¿™äº›è´¹ç”¨éƒ½å‘ç”Ÿåœ¨å“ªäº›åŸºé‡‘ä¸Š</p><table><thead><tr><th align="left">åŸºé‡‘\è´¹ç”¨</th><th align="left">ç”³è´­è´¹</th><th align="left">èµå›è´¹</th><th align="left">äº¤æ˜“ä½£é‡‘</th><th align="left">å°èŠ±ç¨</th><th align="left">æœåŠ¡è´¹</th><th align="left">æ‰˜ç®¡è´¹</th><th align="left">ç®¡ç†è´¹</th></tr></thead><tbody><tr><td align="left">åœºå†…åŸºé‡‘</td><td align="left">æ— </td><td align="left">æ— </td><td align="left">æœ‰</td><td align="left">æœ‰</td><td align="left">æ— </td><td align="left">æœ‰</td><td align="left">æœ‰</td></tr><tr><td align="left">åœºå¤–åŸºé‡‘</td><td align="left">æœ‰</td><td align="left">æœ‰</td><td align="left">æ— </td><td align="left">æ— </td><td align="left">æœ‰/æ— </td><td align="left">æœ‰</td><td align="left">æœ‰</td></tr></tbody></table><h4 id="è´¹ç”¨è¯¦è§£"><a href="#è´¹ç”¨è¯¦è§£" class="headerlink" title="è´¹ç”¨è¯¦è§£"></a>è´¹ç”¨è¯¦è§£</h4><ol><li><p>ç”³è´­è´¹å’Œèµå›è´¹</p><blockquote><p>åœºå†…åŸºé‡‘ä¹Ÿå¯ä»¥ç”³è´­ï¼Œæˆ‘åœ¨ä¸Šé¢è¡¨æ ¼ä¸­æ²¡æœ‰å†™, å› ä¸ºä¾‹å¦‚ETFåŸºé‡‘ç”³è´­ä¸€èˆ¬æ˜¯å‡ åä¸‡èµ·ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸é€šè¿‡ç”³è´­è¿™ä¸€é€”å¾„è·å–ETFåŸºé‡‘ï¼Œè€Œæ˜¯é€šè¿‡åœºå†…ä¹°å–ETFæ¥è·å–ã€‚ä¹°å–è·Ÿè‚¡ç¥¨ä¸€æ ·ï¼Œ100è‚¡èµ·ä¹°ï¼› åœºå¤–åŸºé‡‘ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”³è´­è·å¾—ã€‚äº¤æ˜“æ—¥ä¸‹åˆ3ç‚¹å‰ç”³è´­ï¼ŒæŒ‰ç…§å½“å¤©æ”¶ç›˜çš„åŸºé‡‘å‡€å€¼ç”³è´­ï¼›3ç‚¹åï¼ŒæŒ‰ç…§ä¸‹ä¸€äº¤æ˜“æ—¥æ”¶ç›˜åŸºé‡‘å‡€å€¼ç”³è´­ã€‚ ä»¥æˆ‘å¼€å§‹æŠ•èµ„åœºå¤–åŸºé‡‘çš„å¹³å°å—æ–¹åŸºé‡‘æ¥çœ‹ä¸‹å›¾ï¼š<img src="http://7xkyc7.com1.z0.glb.clouddn.com/licai_fee.png" alt="fee"></p></blockquote><p>å¦‚æœé¢‘ç¹æ“ä½œè´­ä¹°ï¼Œ1-1.5%çš„ç”³è´­ä¸èµå›è´¹ç”¨è¿˜æ˜¯éå¸¸é«˜çš„ï¼Œè´­ä¹°1ä¸‡å…ƒå°±è¦100åˆ°150å…ƒçš„æˆæœ¬ï¼Œè´­ä¹°æŒ‡æ•°åŸºé‡‘æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šæŒæœ‰è‡³å°‘ä¸‰å¹´ä»¥ä¸Šï¼Œç°åœ¨å¥½å¤šåŸºé‡‘å¹³å°éƒ½æ¨å‡ºç”³è´­é›¶æ‰‹ç»­è´¹ï¼Œå¦‚æœæŒæœ‰è¶…è¿‡ä¸¤å¹´ä¹Ÿå…æ‰èµå›è´¹ç”¨.</p></li><li><p>äº¤æ˜“ä½£é‡‘(ä¹°å–ä½£é‡‘)</p><blockquote><p>äº¤æ˜“ä½£é‡‘é’ˆå¯¹åœºå†…åŸºé‡‘æ¥çš„ã€‚ä¸Šé¢è¯´è¿‡ï¼Œåœºå†…åŸºé‡‘å¯ä»¥é€šè¿‡ä¹°å–æ¥è·å¾—ï¼Œè·Ÿè‚¡ç¥¨ä¸€æ ·ã€‚éœ€è¦å»åˆ¸å•†å¼€è‚¡ç¥¨è´¦æˆ·ï¼Œç›®å‰åŸºæœ¬æ‰€æœ‰åˆ¸å•†å¼€æˆ·éƒ½æ˜¯å…è´¹çš„ã€‚äº¤æ˜“è´¹ç‡è·Ÿè‚¡ç¥¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ¨åˆ†åˆ¸å•†å¯ä»¥å•†è®®ã€‚ä¸ç¡®å®šçš„è¯å¯ä»¥è”ç³»è‡ªå·±çš„åˆ¸å•†å®¢æˆ·ç»ç†ç¡®å®šï¼Œæ²¡æœ‰ä»»ä½•åšå¹¿å‘Šçš„å«Œç–‘ï¼Œæˆ‘ç°åœ¨ç”¨åæ³°è¯åˆ¸ï¼Œè´¹ç‡è¿˜æ˜¯å¾ˆåˆé€‚çš„.</p></blockquote></li><li><p>å°èŠ±ç¨</p><blockquote><p>å°èŠ±ç¨ä¹Ÿæ˜¯é’ˆå¯¹åœºå†…çš„å“ç§æ¥è¯´çš„ï¼Œè‚¡ç¥¨ä¹°å–äº¤æ˜“æ˜¯éœ€è¦äº¤å°èŠ±ç¨çš„ã€‚å°èŠ±ç¨æ˜¯è‚¡ç¥¨äº¤æ˜“éå¸¸é‡è¦çš„ä¸€ä¸ªç¨ç§ï¼Œç”šè‡³å¯ä»¥èµ·åˆ°è°ƒèŠ‚è‚¡å¸‚ç‰›ç†Šçš„ä½œç”¨ã€‚å°èŠ±ç¨æ˜¯åœ¨ä¹°å–è‚¡ç¥¨äº¤å‰²çš„æ—¶å€™åˆ¸å•†å°±ä»£ä¸ºæ‰£æ”¶äº†ï¼Œä¹°å–å®Œè‚¡ç¥¨åç¬¬äºŒå¤©æŸ¥ä¸‹äº¤å‰²å•å°±å¯ä»¥çŸ¥é“æ‰£äº†å¤šå°‘å°èŠ±ç¨ã€‚ç›®å‰è‚¡ç¥¨äº¤æ˜“çš„å°èŠ±ç¨æ˜¯äº¤æ˜“é¢çš„åƒåˆ†ä¹‹ä¸€ï¼Œå•è¾¹æ”¶å–ï¼Œå³ä¹°è‚¡ç¥¨ä¸æ”¶ï¼Œå–è‚¡ç¥¨æ”¶ã€‚<strong>å¯¹åœºå†…åŸºé‡‘æ¥è¯´ï¼Œç›®å‰ä¸éœ€è¦äº¤å°èŠ±ç¨</strong></p></blockquote></li><li><p>é”€å”®æœåŠ¡è´¹</p><blockquote><p>æˆ‘ä»¬ç»å¸¸èƒ½çœ‹åˆ°ä¸€äº›åŸºé‡‘å…¬å¸å®£ä¼ æŸåªæŒ‡æ•°åŸºé‡‘ç”³èµè´¹ç”¨å…¨å…ã€‚è¿™é‡Œå…ç”³èµè´¹ç”¨çš„åŸºé‡‘æŒ‡çš„æ˜¯Cç±»åŸºé‡‘ã€‚æ˜¯é’ˆå¯¹åœºå¤–åŸºé‡‘æ¥è¯´çš„ã€‚ä¸€èˆ¬çš„åœºå¤–æŒ‡æ•°åŸºé‡‘ï¼Œæ˜¯æ”¶å–ç”³è´­èµå›è´¹ï¼Œä¸ç®¡ä¹°å–é¢‘ç‡å¦‚ä½•ã€‚è¿™æ ·å¯¹äºä¸€äº›é¢‘ç¹æ“ä½œåœºå¤–åŸºé‡‘çš„æŠ•èµ„è€…ï¼Œäº¤æ˜“æˆæœ¬æ˜¯éå¸¸é«˜çš„ã€‚Cç±»åŸºé‡‘æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒä¸æ”¶å–ç”³è´­è´¹ç”¨ï¼Œä¸€èˆ¬æŒæœ‰ä¸€ä¸ªæœˆä»¥ä¸Šèµå›ä¹Ÿä¸æ”¶å–èµå›è´¹ç”¨ã€‚ä½†ä¼šå›ºå®šæ”¶å–ä¸€å®šæ¯”ä¾‹çš„é”€å”®æœåŠ¡è´¹ï¼Œä¸€èˆ¬æ˜¯0.4-0.6%ã€‚è¿™æ ·å°±æŠŠäº¤æ˜“æˆæœ¬å›ºå®šä¸‹æ¥äº†, ä¾æ—§ä»¥å—æ–¹åŸºé‡‘ä¸¾ä¾‹<img src="http://7xkyc7.com1.z0.glb.clouddn.com/licai_fee1.png" alt="fee1"></p></blockquote><p>ä¸è¿‡æˆ‘æŠ•èµ„æŒ‡æ•°åŸºé‡‘ä¸€èˆ¬æ˜¯åœ¨ä½ä¼°å€¼çš„æ—¶å€™åˆ†æ‰¹ä¹°ï¼Œé«˜ä¼°å€¼çš„æ—¶å€™åˆ†æ‰¹å–ï¼Œä¸€èˆ¬éœ€è¦æŒæœ‰ä¸€å¹´æˆ–å¤šå¹´ä»¥ä¸Šã€‚è¿™ç§æƒ…å†µä¸‹æŒ‘é€‰ç”³è´­è´¹ä¸€æŠ˜çš„å¹³å°ç”³è´­åœºå¤–åŸºé‡‘ï¼Œäº¤æ˜“æˆæœ¬å¯ä»¥æ§åˆ¶åœ¨åƒä¸€å·¦å³ï¼ŒæŒæœ‰ä¸¤å¹´ä»¥ä¸Šä¹Ÿæ²¡æœ‰äº†èµå›è´¹ï¼›Cç±»åŸºé‡‘åˆ™éœ€è¦å›ºå®šäº¤åƒå››åˆ°åƒå…­ï¼Œå¦‚æœä¸æ˜¯é¢‘ç¹ç”³èµï¼Œä¸æ˜¯ç‰¹åˆ«å¥½çš„é€‰æ‹©</p></li><li><p>æ‰˜ç®¡è´¹ç®¡ç†è´¹</p><blockquote><p>ä¸Šé¢è¯´çš„è´¹ç”¨éƒ½æ˜¯åœ¨åŸºé‡‘äº¤æ˜“ç›¸å…³çš„è´¹ç”¨ã€‚å®é™…ä¸ŠåŸºé‡‘åœ¨è¿è¥çš„æ—¶å€™è¿˜ä¼šäº§ç”Ÿç®¡ç†è´¹å’Œæ‰˜ç®¡è´¹ã€‚è¿™ä¸¤é¡¹è´¹ç”¨ä¼šç›´æ¥ä»åŸºé‡‘å‡€å€¼ä¸­æ‰£ã€‚ç®¡ç†è´¹å°±æ˜¯åŸºé‡‘å…¬å¸çš„ä¸€ä¸ªéå¸¸é‡è¦çš„åˆ©æ¶¦æ¥æºã€‚ä¸»åŠ¨å‹åŸºé‡‘ä¸€èˆ¬ä¼šæ”¶å–åŸºé‡‘è§„æ¨¡çš„1.5%ä½œä¸ºç®¡ç†è´¹ã€‚ä¾‹å¦‚ç®¡ç†10ä¸ªäº¿çš„èµ„äº§çš„è‚¡ç¥¨åŸºé‡‘ï¼Œä¸€å¹´ä¼šæ”¶å–1500ä¸‡çš„ç®¡ç†è´¹ã€‚æŒ‡æ•°åŸºé‡‘ä½œä¸ºè¢«åŠ¨å‹åŸºé‡‘ï¼Œç®¡ç†è´¹ç‡ä¸€èˆ¬ä½ä¸€äº›ã€‚å›½å†…æŒ‡æ•°åŸºé‡‘çš„å¹³å‡ç®¡ç†è´¹ç‡åœ¨0.83%å·¦å³ã€‚éƒ¨åˆ†è§„æ¨¡è¾ƒå¤§ã€è¿è¡Œæ—¶é—´è¾ƒé•¿çš„åŸºé‡‘ï¼Œç®¡ç†è´¹ç‡ä¼šé™åˆ°0.5%ã€‚è¿™äº›å¯ä»¥åœ¨åŸºé‡‘çš„å…¬å‘Šä¸­æŸ¥çœ‹ã€‚æ‰˜ç®¡è´¹æ˜¯äº¤ç»™åŸºé‡‘çš„æ‰˜ç®¡æ–¹çš„ã€‚åŸºé‡‘çš„åºå¤§èµ„äº§ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å­˜æ”¾åœ¨åŸºé‡‘å…¬å¸ï¼Œä¸€èˆ¬ä¼šåœ¨ç¬¬ä¸‰æ–¹æ‰˜ç®¡æ–¹ï¼Œä¾‹å¦‚æŸå®¶å¤§å‹é“¶è¡Œã€‚åƒæˆ‘ä»¬ç†ŸçŸ¥çš„50ETFï¼ˆ510050ï¼‰ï¼Œå®ƒçš„æ‰˜ç®¡æ–¹å°±æ˜¯å·¥å•†é“¶è¡Œã€‚å›½å†…æŒ‡æ•°åŸºé‡‘çš„æ‰˜ç®¡è´¹ç‡å¹³å‡åœ¨0.17%å·¦å³ï¼Œä½çš„å¯ä»¥åšåˆ°0.15%</p></blockquote></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æŒ‰ç…§ä¸Šé¢çš„è¡¨æ ¼ä»¥åŠè´¹ç”¨è¯¦ç»†åšå‡ºå¦‚ä¸‹æ€»ç»“ï¼š</p><ol><li>æ€»ä½“æ¥è¯´ï¼ŒæŠ•èµ„æŒ‡æ•°åŸºé‡‘ï¼Œæ— è®ºåœºå†…è¿˜æ˜¯åœºå¤–ï¼Œç®¡ç†è´¹å’Œæ‰˜ç®¡è´¹éƒ½è¦äº¤çš„ï¼Œä¼šä»åŸºé‡‘å‡€å€¼ä¸­æ‰£ï¼ˆæˆ‘ä»¬æ— èƒ½ä¸ºåŠ›ï¼‰</li><li>åœºå†…åŸºé‡‘ä¼šæ”¶å–äº¤æ˜“ä½£é‡‘å’Œå°èŠ±ç¨ã€‚ç›®å‰åœºå†…åŸºé‡‘å°èŠ±ç¨ä¸‹è°ƒåˆ°äº†0ï¼Œäº¤æ˜“ä½£é‡‘ä¸åŒåˆ¸å•†ä¸ä¸€æ ·</li><li>åœºå¤–åŸºé‡‘å¦‚æœä¸æ˜¯Cç±»åŸºé‡‘ï¼Œä¼šæ”¶å–ç”³è´­è´¹ï¼Œèµå›è´¹æŒæœ‰è¶…ä¸¤å¹´å¯å…ï¼›Cç±»åŸºé‡‘é€‚åˆé¢‘ç¹ç”³èµçš„æœ‹å‹ï¼Œä¼šæ”¶å–çº¦0.4-0.6%çš„é”€å”®æœåŠ¡è´¹ã€‚å®šæŠ•çš„è¯é€‰æ™®é€šçš„åœºå¤–åŸºé‡‘å°±å¥½ï¼Œä¸ç”¨é€‰Cç±»ï¼ˆå› ä¸ºæˆ‘ä»¬ä¼šæŒæœ‰è¿™ä¸ªåŸºé‡‘è‡³å°‘3å¹´ä»¥ä¸Šï¼‰</li></ol><p>æˆ‘ä»¬ç»å¸¸çœ‹åˆ°æŸä¸€åªè‚¡ç¥¨ä¸Šæ ‡æ³¨ä¸€ä¸ª<strong>â€œèâ€</strong>å­—ï¼Œé‚£è¿™ä¸ªå­—çš„å«ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ è¿™ä¸ªè¯è·ç¦»èµ„é‡‘é‡è¿˜ä¸æ˜¯å¾ˆå¤§çš„æŠ•èµ„è€…æ¥è¯´å…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé¥è¿œçš„ï¼Œå› ä¸ºèƒ½åšåˆ°èèµ„èåˆ¸ä¸åŒçš„åˆ¸å•†å¯¹æŠ•èµ„è€…è¿˜æœ‰æœ‰å¾ˆé«˜çš„è§„æ ¼é™åˆ¶çš„ï¼Œä¸è¿‡è¿™ä¸ªâ€œèâ€å­—çš„å†…åœ¨å«ä¹‰è¿˜æ˜¯éå¸¸æœ‰æ„æ€çš„.</p><h3 id="èâ€”â€”èèµ„èåˆ¸"><a href="#èâ€”â€”èèµ„èåˆ¸" class="headerlink" title="èâ€”â€”èèµ„èåˆ¸"></a>èâ€”â€”èèµ„èåˆ¸</h3><p>èèµ„èåˆ¸æ˜¯åˆ¸å•†å¼€æ‹“çš„ä¸šåŠ¡ï¼Œéƒ½æ˜¯å‘ç”Ÿåœ¨åˆ¸å•†å’ŒæŠ•èµ„è€…ä¹‹é—´ï¼Œå’Œä¸Šå¸‚å…¬å¸æœ¬ç”Ÿæ²¡å…³ç³»ã€‚</p><blockquote><ul><li>èï¼šå°±æ˜¯æ‰©å¤§ï¼Œå¼€æ‹“çš„æ„æ€</li><li>èèµ„ï¼šå…¶å®å°±æ˜¯å€Ÿé’±</li><li>èåˆ¸ï¼šå°±æ˜¯å€Ÿè‚¡ç¥¨</li></ul></blockquote><p>å€Ÿé’±æˆ‘ä»¬å¥½ç†è§£ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦å€Ÿè‚¡ç¥¨å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ä¸­å›½è‚¡ç¥¨å¸‚åœºåªèƒ½åšå¤šï¼Œå°±æ˜¯ä½ ä¹°äº†è‚¡ç¥¨åªèƒ½ç­‰å¾…ä¸Šæ¶¨è·åˆ©ï¼Œå¦‚æœè‚¡ç¥¨ä¸‹è·Œå°±æ²¡æ³•è·åˆ©äº†ï¼Œè€Œèåˆ¸å°±æä¾›äº†ä¸€ç§åšç©ºçš„å·¥å…·ã€‚</p><!-- more --><p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p><ol><li><p>èèµ„ï¼šæŠ•èµ„è€…çœ‹å¥½ä¸€åªè‚¡ç¥¨åœ¨æœªæ¥ä¼šæœ‰ä¸Šå‡è¶‹åŠ¿ï¼Œè‹¦äºæ‰‹ä¸­æ²¡æœ‰é“¶ä¸¤æ¥è´­ä¹°è‚¡ç¥¨ï¼Œäºæ˜¯ä¹æ‰“ç®—å‘åˆ¸å•†å€Ÿé’±æ¥è´­ä¹°è¯¥è‚¡ç¥¨ï¼Œç­‰åˆ°æŒ‡å®šæœŸé™å°†é’±è¿˜ç»™åˆ¸å•†åŒæ—¶è¿˜è¦æ”¯ä»˜ä¸€äº›åˆ©æ¯ï¼ˆé’±ä¸èƒ½æ˜¯ç™½å€Ÿçš„å•Šï¼‰</p><blockquote><p>å¼ ä¸‰çœ‹å¥½è‚¡ç¥¨Aåœ¨æœªæ¥ä¼šæœ‰ä¸Šå‡è¶‹åŠ¿ï¼Œæ‰‹ä¸­å´æ²¡æœ‰é“¶ä¸¤ï¼Œå¼ ä¸‰å·²ç»å…·å¤‡äº†èèµ„çš„èµ„æ ¼ï¼ˆä¸åŒçš„åˆ¸å•†æ ‡å‡†ä¸ä¸€æ ·ï¼Œè¯·å’¨è¯¢å…·ä½“çš„åˆ¸å•†ç»ç†ï¼‰ï¼Œäºæ˜¯ä¹å‘åˆ¸å•†å€Ÿäº†1ä¸‡å…ƒé’±ä»¥æ¯è‚¡10å…ƒçš„ä»·æ ¼è´­ä¹°äº†1000è‚¡ï¼Œåˆ¸å•†åå®šçš„è¿˜æ¬¾æ—¥æœŸåˆ°äº†ï¼Œæ­¤æ—¶è‚¡ç¥¨Açš„è‚¡ä»·å·²ç»æ¶¨åˆ°äº†20å…ƒï¼Œè¿™ä¼šæˆ‘è¿˜æ˜¯è¿˜åˆ¸å•†1ä¸‡å…ƒé’±+åˆ©æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™æ¬¡èèµ„çš„è¿‡ç¨‹ä¸­ï¼ˆé™¤å»åˆ©æ¯ï¼‰èµšäº†20000-10000=10000ï¼ˆå…ƒï¼‰</p></blockquote></li><li><p>èåˆ¸ï¼šä¸èèµ„ç›¸åï¼ŒæŠ•èµ„è€…è§‰å¾—æŸè‚¡Aå…·æœ‰æ˜æ˜¾çš„ä¸‹è·Œç©ºé—´ï¼Œä½†æ˜¯æ‰‹ä¸­å¹¶æ²¡æœ‰è¯¥è‚¡ï¼Œäºæ˜¯ä¹æ‰“ç®—å‘åˆ¸å•†å€Ÿæ¥è‚¡ç¥¨å–å‡ºå»</p><blockquote><p>å¼ ä¸‰è§‰å¾—æŸè‚¡Aå…·æœ‰æ˜æ˜¾çš„ä¸‹è·Œç©ºé—´ï¼Œä½†æ˜¯æ‰‹ä¸­å¹¶æ²¡æœ‰è¯¥è‚¡ï¼Œäºæ˜¯å‘åˆ¸å•†å€Ÿäº†100æ‰‹äº10å…ƒå–å‡ºï¼Œå¾—10ä¸‡å…ƒï¼Œç­‰åˆ°è¯¥è‚¡ä¸‹è·Œåˆ°9å…ƒåä¹°å›100æ‰‹è¯¥è‚¡è¿˜ç»™åˆ¸å•†ï¼Œä¹°å›åªç”¨äº†9ä¸‡ï¼Œè·åˆ©1ä¸‡å…ƒã€‚è¿™å°±æ˜¯ä¸€ç§å…¸å‹çš„èåˆ¸</p><p>èåˆ¸è¿˜æœ‰ä¸€ç§æ–¹å¼å«åšå¯¹å†²ï¼Œè¯•ä¸¾ä¾‹è¯´æ˜ï¼š<br>æŠ•èµ„è€…å½“å¤©äº10å…ƒä¹°å…¥æŸè‚¡100æ‰‹ï¼Œå½“å¤©å°±æ¶¨åˆ°äº11å…ƒï¼ŒæŠ•èµ„è€…æƒ³äºè¯¥ç‚¹å–å‡ºï¼Œä½†æ˜¯è‹¦äºä¸­å›½è‚¡å¸‚æ˜¯T+1åˆ¶åº¦ï¼Œå½“å¤©ä¹°è¿›çš„è‚¡ç¥¨å½“å¤©ä¸èƒ½å–å‡ºã€‚è¿™æ—¶ä½ å¯ä»¥èåˆ¸è¯¥è‚¡100æ‰‹äº11å…ƒå–å‡ºï¼Œè€ŒæŠŠæ‰‹ä¸­çš„100æ‰‹è¿˜ç»™åˆ¸å•†ï¼Œå°±ç›¸å½“äºåšäº†ä¸ªT+0.</p></blockquote></li></ol><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><ol><li>å®é™…æ“ä½œä¸­è¿˜æœ‰å¾ˆå¤šé™åˆ¶ï¼Œæ¯”å¦‚â€œæ ‡çš„â€å°±æ˜¯ä¸€ç§ï¼Œä½ ä¸èƒ½å¯¹ä»»ä½•è‚¡ç¥¨éƒ½è¿›è¡Œèåˆ¸ï¼Œè€Œåªèƒ½å¯¹åˆ¸å•†æŒ‡å®šçš„è‚¡ç¥¨ç¾¤è¿›è¡Œèåˆ¸ï¼Œè¿™ä¸ªè‚¡ç¥¨ç¾¤å°±å«â€œæ ‡çš„â€ã€‚</li><li>å¦ä¸€ä¸ªé™åˆ¶å°±æ˜¯åˆ¸å•†æ‰‹ä¸­æœ‰å¯èƒ½æ²¡æœ‰ä½ æƒ³èåˆ¸çš„â€œæ ‡çš„â€ï¼Œå› ä¸ºåˆ¸å•†ä¹Ÿä¸å‚»ï¼Œä½ æƒ³å–çš„è‚¡ç¥¨ï¼Œå¤šåŠåˆ¸å•†ä¹Ÿä¸æƒ³ç•™åœ¨æ‰‹ä¸­ã€‚ã€‚ã€‚æ‰€ä»¥åœ¨è€ƒè™‘èåˆ¸ä¹‹å‰è¦æŸ¥è¯¢ä¸€ä¸‹åˆ¸å•†æ‰‹ä¸­æ˜¯å¦è¿˜æœ‰è¯¥è‚¡ç¥¨ã€‚</li><li>å¦å¤–ï¼Œå€Ÿï¼Œå°±è¦æœ‰åˆ©æ¯ï¼Œä¸ç®¡èèµ„è¿˜æ˜¯èåˆ¸éƒ½æŒ‰ç…§ç›¸å…³å¸‚å€¼çš„é“¶è¡Œåˆ©æ¯ç»“ç®—ï¼ˆå¤§è‡´å¦‚æ­¤ï¼‰ï¼Œä½†æ˜¯å¾ˆå¤šåˆ¸å•†éƒ½è§„å®šï¼šå½“å¤©å€Ÿå½“å¤©è¿˜æ²¡åˆ©æ¯ï¼Œæ‰€ä»¥æœ‰åˆ©äºåšT+0</li></ol>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> æŠ•èµ„ç†è´¢å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è´¹ç”¨ </tag>
            
            <tag> æŒ‡æ•°åŸºé‡‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¤šæ€è°ƒç”¨é¡ºåº</title>
      <link href="//p/java-polymorphism-order.html"/>
      <url>//p/java-polymorphism-order.html</url>
      
        <content type="html"><![CDATA[<h3 id="Javaå¤šæ€è°ƒç”¨è¯¥æ¡ˆä¾‹"><a href="#Javaå¤šæ€è°ƒç”¨è¯¥æ¡ˆä¾‹" class="headerlink" title="Javaå¤šæ€è°ƒç”¨è¯¥æ¡ˆä¾‹"></a>Javaå¤šæ€è°ƒç”¨è¯¥æ¡ˆä¾‹</h3><p>å¤§å®¶å…ˆçœ‹è‡ªè¡Œæµ‹è¯•å¦‚ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">show</span><span class="params">(D obj)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"A and D"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">show</span><span class="params">(A obj)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"A and A"</span>);  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">show</span><span class="params">(B obj)</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"B and B"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">show</span><span class="params">(A obj)</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"B and A"</span>);  </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">D</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        A a1 = <span class="keyword">new</span> A();  </span><br><span class="line">        A a2 = <span class="keyword">new</span> B();  </span><br><span class="line">        B b = <span class="keyword">new</span> B();  </span><br><span class="line">        C c = <span class="keyword">new</span> C();  </span><br><span class="line">        D d = <span class="keyword">new</span> D();  </span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"1--"</span> + a1.show(b));  </span><br><span class="line">        System.out.println(<span class="string">"2--"</span> + a1.show(c));  </span><br><span class="line">        System.out.println(<span class="string">"3--"</span> + a1.show(d));  </span><br><span class="line">        System.out.println(<span class="string">"4--"</span> + a2.show(b));  </span><br><span class="line">        System.out.println(<span class="string">"5--"</span> + a2.show(c));  </span><br><span class="line">        System.out.println(<span class="string">"6--"</span> + a2.show(d));  </span><br><span class="line">        System.out.println(<span class="string">"7--"</span> + b.show(b));  </span><br><span class="line">        System.out.println(<span class="string">"8--"</span> + b.show(c));  </span><br><span class="line">        System.out.println(<span class="string">"9--"</span> + b.show(d));        </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>ä»”ç»†æ€è€ƒå“¦â€¦â€¦â€¦â€¦â€¦.<br>æ¥çœ‹ç­”æ¡ˆï¼Œæœ‰æ²¡æœ‰æ„å¤–å‘ç”Ÿï¼Ÿ</p><pre><code>1--A and A  2--A and A  3--A and D  4--B and A  5--B and A  6--A and D  7--B and B  8--B and B  9--A and D  </code></pre><p>æ¥ä¸‹æ¥ä¸»è¦é’ˆå¯¹ç¬¬å››ä¸ªè¾“å‡ºç»“æœåšå‡ºè§£é‡Šï¼Œå…¶ä»–çš„è¾“å‡ºç»“æœæŒ‰ç…§æ­¤è§„çŸ©è‡ªç„¶å°±èƒ½å¾—å‡ºï¼Œè¯·è®°ä½ï¼š</p><blockquote><p><strong>å½“è¶…ç±»å¯¹è±¡å¼•ç”¨å˜é‡å¼•ç”¨å­ç±»å¯¹è±¡æ—¶ï¼Œè¢«å¼•ç”¨å¯¹è±¡çš„ç±»å‹è€Œä¸æ˜¯å¼•ç”¨å˜é‡çš„ç±»å‹å†³å®šäº†è°ƒç”¨è°çš„æˆå‘˜æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•å¿…é¡»æ˜¯åœ¨è¶…ç±»ä¸­å®šä¹‰è¿‡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«å­ç±»è¦†ç›–çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»ç„¶è¦æ ¹æ®ç»§æ‰¿é“¾ä¸­æ–¹æ³•è°ƒç”¨çš„ä¼˜å…ˆçº§æ¥ç¡®è®¤æ–¹æ³•ï¼Œè¯¥ä¼˜å…ˆçº§ä¸ºï¼šthis.show(O)ã€super.show(O)ã€this.show((super)O)ã€super.show((super)O)</strong></p></blockquote><p>æ‰€ä»¥ï¼Œè¿™é‡Œa2æ˜¯å¼•ç”¨å˜é‡ï¼Œä¸ºAç±»å‹ï¼Œå®ƒå¼•ç”¨çš„æ˜¯Bå¯¹è±¡ï¼Œå› æ­¤æŒ‰ç…§ä¸Šé¢é‚£å¥è¯çš„æ„æ€æ˜¯è¯´æœ‰Bæ¥å†³å®šè°ƒç”¨è°çš„æ–¹æ³•,æ‰€ä»¥a2.show(b)åº”è¯¥è¦è°ƒç”¨Bä¸­çš„show(B obj)ï¼Œäº§ç”Ÿçš„ç»“æœåº”è¯¥æ˜¯â€œB and Bâ€ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¼šä¸å‰é¢çš„è¿è¡Œç»“æœäº§ç”Ÿå·®å¼‚å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¿½ç•¥äº†åé¢é‚£å¥è¯â€œä½†æ˜¯è¿™å„¿è¢«è°ƒç”¨çš„æ–¹æ³•å¿…é¡»æ˜¯åœ¨è¶…ç±»ä¸­å®šä¹‰è¿‡çš„â€ï¼Œé‚£ä¹ˆshow(B obj)åœ¨Aç±»ä¸­å­˜åœ¨å—ï¼Ÿæ ¹æœ¬å°±ä¸å­˜åœ¨ï¼æ‰€ä»¥è¿™å¥è¯åœ¨è¿™é‡Œä¸é€‚ç”¨ï¼Ÿé‚£ä¹ˆéš¾é“æ˜¯è¿™å¥è¯é”™è¯¯äº†ï¼Ÿéä¹Ÿï¼å…¶å®è¿™å¥è¯è¿˜éšå«è¿™è¿™å¥è¯ï¼šå®ƒä»ç„¶è¦æŒ‰ç…§ç»§æ‰¿é“¾ä¸­è°ƒç”¨æ–¹æ³•çš„ä¼˜å…ˆçº§æ¥ç¡®è®¤ã€‚æ‰€ä»¥å®ƒæ‰ä¼šåœ¨Aç±»ä¸­æ‰¾åˆ°show(A obj)ï¼ŒåŒæ—¶ç”±äºBé‡å†™äº†è¯¥æ–¹æ³•æ‰€ä»¥æ‰ä¼šè°ƒç”¨Bç±»ä¸­çš„æ–¹æ³•ï¼Œå¦åˆ™å°±ä¼šè°ƒç”¨Aç±»ä¸­çš„æ–¹æ³•ã€‚</p><h3 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h3><p>æ„Ÿè°¢<a href="http://blog.csdn.net/chenssy/article/details/12786385#" target="_blank" rel="noopener">ä½œè€…åŸæ–‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šæ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OAuth2.0 è¯¦è§£</title>
      <link href="//p/oauth2-detail.html"/>
      <url>//p/oauth2-detail.html</url>
      
        <content type="html"><![CDATA[<h3 id="OAuth2-0-è¯¦è§£"><a href="#OAuth2-0-è¯¦è§£" class="headerlink" title="OAuth2.0 è¯¦è§£"></a>OAuth2.0 è¯¦è§£</h3><p>ä»¥ä¸‹å†…å®¹ä¸ºè½¬è½½<a href="http://www.cnblogs.com/blowing00/" target="_blank" rel="noopener">åšä¸»</a>çš„å†…å®¹</p><blockquote><ol><li><a href="http://www.cnblogs.com/blowing00/p/4521135.html" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆéœ€è¦ Oauth2.0 åè®®ï¼Ÿ</a></li><li><a href="http://www.cnblogs.com/blowing00/p/4523506.html" target="_blank" rel="noopener">å¼€æ”¾å¹³å°</a></li><li><a href="http://www.cnblogs.com/blowing00/p/4524132.html" target="_blank" rel="noopener">Access Token ä¸ Refresh Token</a></li><li><a href="http://www.cnblogs.com/blowing00/p/4524192.html" target="_blank" rel="noopener">Implicit æˆæƒæ–¹å¼</a></li><li><a href="http://www.cnblogs.com/blowing00/p/4524412.html" target="_blank" rel="noopener">Authorization Code æˆæƒ</a></li><li><a href="http://www.cnblogs.com/blowing00/p/4524591.html" target="_blank" rel="noopener">Resource Owner Password Credentials æˆæƒå’Œ Client Credentials æˆæƒ</a></li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> å®‰å…¨-åè®®-è§„èŒƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OAuth2.0 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hybris tomcat Jrebelçƒ­éƒ¨ç½²é…ç½®</title>
      <link href="//p/hybris-jrebel.html"/>
      <url>//p/hybris-jrebel.html</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>Jrebelæ˜¯éå¸¸å¼ºå¤§çš„å®ç°é¡¹ç›®çƒ­éƒ¨ç½²çš„è½¯ä»¶ï¼Œå½“ç„¶ä¹Ÿæ¯”è¾ƒæ¶ˆè€—ç”µè„‘çš„æ€§èƒ½ï¼Œå½“å¦‚Hybrisçš„è¿™ç§å¯åŠ¨éœ€è¦ä¸€æ®µæ—¶é—´çš„é¡¹ç›®ï¼Œå¯¹äºåç«¯å¼€å‘äººå‘˜æ¥è¯´ï¼Œæ”¹åŠ¨ä¸€äº›ä¸œè¥¿å°±è¦é‡å¯æœåŠ¡çœŸçš„æ˜¯ä¸€ç§æŠ˜ç£¨ï¼Œæµªè´¹æ—¶é—´ï¼Œæ¥ä¸‹æ¥è¯´æ˜ä¸€ä¸‹Jrebelåœ¨Hybrisé¡¹ç›®ä¸­çš„é…ç½®</p><h3 id="é…ç½®Jrebel"><a href="#é…ç½®Jrebel" class="headerlink" title="é…ç½®Jrebel"></a>é…ç½®Jrebel</h3><p>Jrebelå¯ä»¥é€šè¿‡IntelliJ IDEAæ¥ä¸‹è½½å®‰è£…é›†æˆå¥½çš„æ’ä»¶ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä¸‹è½½Jrebelçš„åŒ… ï¼ˆè¯·æ”¯æŒæ­£ç‰ˆï¼‰</p><a id="more"></a><h4 id="æ–¹æ³•ä¸€ï¼šé€šè¿‡IntelliJ-IDEA-æ’ä»¶"><a href="#æ–¹æ³•ä¸€ï¼šé€šè¿‡IntelliJ-IDEA-æ’ä»¶" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé€šè¿‡IntelliJ IDEA æ’ä»¶"></a>æ–¹æ³•ä¸€ï¼šé€šè¿‡IntelliJ IDEA æ’ä»¶</h4><p>å¦‚ä¸‹å›¾ä¸‹è½½å®‰è£…InteliJ IDEA æ’ä»¶<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jrebel_jrebel.png" alt="Jrebel"></p><p>å®‰è£…å¥½ä¹‹åæˆ‘ä»¬å°±å¯ä»¥åœ¨IntelliJ IDEAçš„å®‰è£…ç›®å½•ä¸­çœ‹åˆ°è¯¥æ’ä»¶ï¼Œæ¥ä¸‹æ¥åœ¨Hybrisçš„local.propertiesæ–‡ä»¶ä¸­æ¥é…ç½®tomcat</p><pre><code>#JRebeltomcat.javaoptions=-agentpath:&quot;D:/Users/fraser/.IntelliJIdea2016.2/config/plugins/jr-ide-idea/lib/jrebel6/lib/jrebel64.dll&quot;  -DforceANSI=truetomcat.debugjavaoptions=-agentpath:&quot;D:/Users/fraser/.IntelliJIdea2016.2/config/plugins/jr-ide-idea/lib/jrebel6/lib/jrebel64.dll&quot; -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=8000,suspend=n -DforceANSI=true</code></pre><h4 id="æ–¹æ³•äºŒï¼šé€šè¿‡å®‰è£…åŒ…"><a href="#æ–¹æ³•äºŒï¼šé€šè¿‡å®‰è£…åŒ…" class="headerlink" title="æ–¹æ³•äºŒï¼šé€šè¿‡å®‰è£…åŒ…"></a>æ–¹æ³•äºŒï¼šé€šè¿‡å®‰è£…åŒ…</h4><p>ä¸‹è½½Jrebelå®‰è£…åŒ…æ¥ï¼Œå°†å®‰è£…åŒ…è§£å‹åˆ°æŸä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶ååŒæ ·é…ç½®local.properties æ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code>#JREBELtomcat.javaoptions=-Xverify:none -javaagent:&quot;E:/MyProjectSpace/jrebel_5.6.0/jrebe/jrebel.jar=de.hybris.tomcat.HybrisWebappClassLoader60&quot;tomcat.debugjavaoptions=-Xverify:none -javaagent:&quot;E:/MyProjectSpace/jrebel_5.6.0/jrebe/jrebel.jar=de.hybris.tomcat.HybrisWebappClassLoader60&quot;-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=8060,suspend=y#å¯ä¸é…tomcat.generaloptions=-Xmx2G -Xms2G -XX:PermSize=500M -XX:MaxPermSize=300M -Xss256K -XX:+DisableExplicitGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+CMSPermGenSweepingEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseCMSInitiatingOccupancyOnly -XX:+CMSParallelRemarkEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark  -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -Xloggc:&quot;${HYBRIS_LOG_DIR}/tomcat/java_gc.log&quot; -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dorg.tanukisoftware.wrapper.WrapperManager.mbean=true -Djava.endorsed.dirs=..b/endorsed -Dcatalina.base=%CATALINA_BASE% -Dcatalina.home=%CATALINA_HOME% -Dfile.encoding=UTF-8 -Dlog4j.configuration=log4j_init_tomcat.properties -Djava.util.logging.config.file=jdk_logging.properties -Djava.io.tmpdir=&quot;${HYBRIS_TEMP_DIR}&quot; -Dsun.rmi.dgc.client.gcInterval=3600000 -Dsun.rmi.dgc.server.gcInterval=3600000</code></pre><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å¯åŠ¨HybrisæœåŠ¡å™¨å¦‚çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯å°±è¯´æ˜Jrebelé…ç½®æˆåŠŸï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jrebel_jrebel1.png" alt="jrebel1"></p><p>è¿™æ ·æˆ‘ä»¬æ‰§è¡Œ<strong>ant build</strong> å‘½ä»¤ç­‰å¾…buildæˆåŠŸï¼Œå°±å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Œå¦‚æœé‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jrebel_jrebel2.png" alt="jrebel3"></p><p>æ‰¾åˆ°<strong>D:\projects\hybrisHn\hybris\bin\ext-backoffice\backoffice\buildcallbacks.xml</strong> æ–‡ä»¶ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ³¨é‡Šæ‰<strong><backoffice_remove_web_fragments/></strong> å³å¯</p><pre><code>&lt;macrodef name=&quot;backoffice_after_build&quot;&gt;    &lt;sequential&gt;        &lt;!--&lt;backoffice_remove_web_fragments/&gt;--&gt;        &lt;backoffice_create_web_fragments/&gt;    &lt;/sequential&gt;&lt;/macrodef&gt;</code></pre><p>é‡æ–°å°è¯•<strong>ant build</strong> å‘½ä»¤åº”è¯¥å°±å¯ä»¥buildæˆåŠŸï¼Œå¿«å°è¯•ä¸€ä¸‹å§</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hybris </tag>
            
            <tag> Jrebel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux æ ¹æ®å…³é”®å­—æŸ¥çœ‹é›†ç¾¤æœåŠ¡å™¨çš„log</title>
      <link href="//p/linux-search-keyword-script.html"/>
      <url>//p/linux-search-keyword-script.html</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ç°åœ¨é¡¹ç›®å¤šæ•°ä¼šé‡‡ç”¨é›†ç¾¤éƒ¨ç½²çš„å½¢å¼ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ¥åˆ†æ‹…å®¢æˆ·ç«¯å¤§é‡è¯·æ±‚çš„å‹åŠ›ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚å‘ç”Ÿå¼‚å¸¸ï¼Œå¼‚å¸¸logåªèƒ½åœ¨æŸä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šäº§ç”Ÿï¼Œå½“æœåŠ¡å™¨èŠ‚ç‚¹æ¯”è¾ƒå°‘æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®logçš„å…³é”®å­—æ¥å•ä¸ªæŸ¥æ‰¾ï¼Œä½†æ˜¯å½“æœåŠ¡å™¨èŠ‚ç‚¹å¤šçš„æ—¶å€™æˆ‘ä»¬è¿˜è¿™ä¹ˆæŸ¥æ‰¾çœŸçš„æœ‰äº›æµªè´¹æ—¶é—´è€Œä¸”ä¸å‡†ç¡®.</p><a id="more"></a><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨æŸä¸€å°release æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹é¢è„šæœ¬å³å¯å®Œæˆå¤šä¸ªèŠ‚ç‚¹çš„logä¿¡æ¯çš„æŸ¥è¯¢<br><strong>check_log_in_console.sh</strong>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><pre><code>#!/bin/bashif [ $# -lt 1 ]; then  echo &quot;please provide the content you want to find&quot;  echo &quot;usage: $0 [content] [date in yyyymmdd format]&quot;  exit 0fiif [ &quot;$2&quot; == &quot;&quot; ]; then  d=`date +%Y%m%d`else  d=$2fis=prd-hybris-padfor((i=1;i&lt;=4;i++))do    server=$s$i.bb.com    echo &quot;============check logs on $server====================&quot;    ssh app@$server &quot;grep &apos;$1&apos; /data/workspace/hybris/hybris/log/tomcat/console-$d.log&quot;        sleep 1doneecho &quot;done&quot;#exit 0</code></pre><p>è¿™æ ·æˆ‘ä»¬åªéœ€è¦åœ¨è¯¥æ–‡ä»¶ç›®å½•ä¸­æ‰§è¡Œ</p><pre><code>./check_log_in_console.sh &quot;ä½ è¦æœç´¢çš„å…³é”®å­—&quot;  [å›è½¦]</code></pre><p>å°±ä¼šå»ä»¥ä¸ŠèŠ‚ç‚¹ä¸­å››ä¸ªæœåŠ¡å™¨ä¸­å»æŸ¥æ‰¾ä½ è¦æœç´¢çš„å…³é”®å­—ï¼Œæ‰“å°å‡ºç±»ä¼¼å¦‚ä¸‹çš„logä¿¡æ¯ï¼š</p><pre><code>============check logs on prd-hybris-pad1.bb.com======================check logs on prd-hybris-pad2.bb.com======================check logs on prd-hybris-pad3.bb.com======================check logs on prd-hybris-pad4.bb.com==========</code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC ä¹‹ @ResponseStatus</title>
      <link href="//p/springmvc-response-status.html"/>
      <url>//p/springmvc-response-status.html</url>
      
        <content type="html"><![CDATA[<h3 id="ResponseStatus"><a href="#ResponseStatus" class="headerlink" title="@ResponseStatus"></a>@ResponseStatus</h3><p>Restful webserviceè¯·æ±‚ä¼šç”¨åˆ°@ResponseStatus æ³¨è§£ï¼Œè¯¥æ³¨è§£å¯ç”¨äºç±»çº§åˆ«ä¸Šï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨æ–¹æ³•çº§åˆ«ä¸Šï¼Œä»£è¡¨è¯·æ±‚å“åº”çš„çŠ¶æ€ï¼Œé€šå¸¸å°±æ˜¯è¿”å›HttpStatusçš„çŠ¶æ€ç ï¼Œå…·ä½“å¯æŸ¥è¯¢æ¯ä¸ªçŠ¶æ€ç ä»£ï¼Œè¿™é‡Œç®€å•ç½—åˆ—ä¸€äº›ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CONTINUE(100, "Continue"),</span><br><span class="line">SWITCHING_PROTOCOLS(101, "Switching Protocols"),</span><br><span class="line">PROCESSING(102, "Processing"),</span><br><span class="line">CHECKPOINT(103, "Checkpoint"),</span><br><span class="line">OK(200, "OK"),</span><br><span class="line">CREATED(201, "Created"),</span><br><span class="line">ACCEPTED(202, "Accepted"),</span><br><span class="line">NON_AUTHORITATIVE_INFORMATION(203, "Non-Authoritative Information"),</span><br><span class="line">NO_CONTENT(204, "No Content"),</span><br><span class="line">RESET_CONTENT(205, "<span class="keyword">Reset</span> <span class="keyword">Content</span><span class="string">"),</span></span><br><span class="line"><span class="string">PARTIAL_CONTENT(206, "</span><span class="keyword">Partial</span> <span class="keyword">Content</span><span class="string">"),</span></span><br><span class="line"><span class="string">MULTI_STATUS(207, "</span>Multi-<span class="keyword">Status</span><span class="string">"),</span></span><br><span class="line"><span class="string">ALREADY_REPORTED(208, "</span>Already Reported<span class="string">"),</span></span><br><span class="line"><span class="string">IM_USED(226, "</span>IM Used<span class="string">"),</span></span><br><span class="line"><span class="string">MULTIPLE_CHOICES(300, "</span>Multiple Choices<span class="string">"),</span></span><br><span class="line"><span class="string">MOVED_PERMANENTLY(301, "</span>Moved Permanently<span class="string">"),</span></span><br><span class="line"><span class="string">FOUND(302, "</span><span class="keyword">Found</span><span class="string">"),</span></span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="åº”ç”¨åœ¨ç±»çº§åˆ«"><a href="#åº”ç”¨åœ¨ç±»çº§åˆ«" class="headerlink" title="åº”ç”¨åœ¨ç±»çº§åˆ«"></a>åº”ç”¨åœ¨ç±»çº§åˆ«</h4><p>åˆ›å»ºä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œç”¨è¯¥æ³¨è§£æ ‡æ³¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zj.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseStatus</span>(value=HttpStatus.FORBIDDEN,reason=<span class="string">"ç”¨æˆ·ä¸åŒ¹é…"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotMatchException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ªç›®æ ‡æ–¹æ³•æ¥æŠ›å‡ºå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testResponseStatus"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testResponseStatus</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UserNotMatchException();</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“æˆ‘ä»¬è¯·æ±‚è¯¥æ–¹æ³•ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œä¼šå°†ç”¨æˆ·ä¸åŒ¹é…çš„ä¿¡æ¯è¿”å›ç»™æµè§ˆå™¨ï¼Œè®©å¼‚å¸¸ä¿¡æ¯æ›´åŠ æ˜ç¡®ï¼Œè€Œä¸æ˜¯ä¸€å †å¼‚å¸¸ä¿¡æ¯ä»£ç </p><h4 id="åº”ç”¨åœ¨æ–¹æ³•çº§åˆ«"><a href="#åº”ç”¨åœ¨æ–¹æ³•çº§åˆ«" class="headerlink" title="åº”ç”¨åœ¨æ–¹æ³•çº§åˆ«"></a>åº”ç”¨åœ¨æ–¹æ³•çº§åˆ«</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus</span>(value=HttpStatus.FORBIDDEN,reason=<span class="string">"ç”¨æˆ·åä¸åŒ¹é…"</span>)</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testResponseStatus"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testResponseStatus</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UserNotMatchException();</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ResponseStatusä¿®é¥°ç›®æ ‡æ–¹æ³•ï¼Œæ— è®ºå®ƒæ‰§è¡Œæ–¹æ³•è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰å¼‚å¸¸äº§ç”Ÿï¼Œç”¨æˆ·éƒ½ä¼šå¾—åˆ°å¼‚å¸¸çš„ç•Œé¢ã€‚è€Œç›®æ ‡æ–¹æ³•æ­£å¸¸æ‰§è¡Œ</strong></p><p>è¿™ä¸ªæƒ…å†µè¦çœ‹é¡¹ç›®çš„ä½¿ç”¨æƒ…å†µï¼Œé€šå¸¸ä¼šåˆ¶å®šä¸€ä¸ªæ ‡å‡†çš„å¼‚å¸¸ä¿¡æ¯æ˜¾ç¤ºï¼Œå¯ä»¥çµæ´»ä½¿ç”¨.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC ä¹‹ @initbinder</title>
      <link href="//p/springmvc-init-binder.html"/>
      <url>//p/springmvc-init-binder.html</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨Webé¡¹ç›®ä¸­ï¼Œå¤ªå¤šéœ€è¦æäº¤è¡¨å•æˆ–è€…åœ¨è¯·æ±‚URLä¸­æ·»åŠ å‚æ•°ä¿¡æ¯çš„æ“ä½œï¼Œæ— è®ºæ˜¯å‰è€…è¿˜æ˜¯åè€…ï¼ŒSpringMVCéƒ½å°†æ¯ä¸ªå…ƒç´ å½“åšStringæ¥å¤„ç†ï¼Œ å¦‚æœå‰å°ä¼ å…¥æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²çš„æ—¥æœŸæˆ–è¿™æ•°å€¼ç±»å‹çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼ˆåœ¨SpringMVCä¸­ï¼Œbeanä¸­å®šä¹‰äº†Dateï¼Œdoubleç­‰ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰åšä»»ä½•å¤„ç†çš„è¯ï¼Œæ—¥æœŸä»¥åŠdoubleéƒ½æ— æ³•ç»‘å®šï¼‰ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ¥å¼ºåˆ¶è½¬å‹å¾ˆæ˜¯éº»çƒ¦ï¼ŒSpringMVC æä¾›çš„@initbinder å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜</p><h3 id="initbinder"><a href="#initbinder" class="headerlink" title="@initbinder"></a>@initbinder</h3><p>åœ¨æˆ‘çš„é¡¹ç›®ä¸­æ˜¯åœ¨BaseControllerä¸­å¢åŠ æ–¹æ³•initBinderï¼Œå¹¶ä½¿ç”¨æ³¨è§£@InitBinderæ ‡æ³¨ï¼Œé‚£ä¹ˆspring mvcåœ¨ç»‘å®šè¡¨å•ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆæ³¨å†Œè¿™äº›ç¼–è¾‘å™¨, Springè‡ªå·±æä¾›äº†å¤§é‡çš„å®ç°ç±»ï¼Œè¯¸å¦‚CustomDateEditor ï¼ŒCustomBooleanEditorï¼ŒCustomNumberEditorç­‰è®¸å¤šï¼ŒåŸºæœ¬ä¸Šå¤Ÿç”¨, å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æ¥å†™è¿™äº›ç¼–è¾‘å™¨.</p><a id="more"></a><h4 id="è‡ªå®šä¹‰ç¼–è¾‘å™¨"><a href="#è‡ªå®šä¹‰ç¼–è¾‘å™¨" class="headerlink" title="è‡ªå®šä¹‰ç¼–è¾‘å™¨"></a>è‡ªå®šä¹‰ç¼–è¾‘å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.propertyeditors.PropertiesEditor;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleEditor</span> <span class="keyword">extends</span> <span class="title">PropertiesEditor</span> </span>&#123;    </span><br><span class="line"><span class="meta">@Override</span>    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAsText</span><span class="params">(String text)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;    </span><br><span class="line"><span class="keyword">if</span> (text == <span class="keyword">null</span> || text.equals(<span class="string">""</span>)) &#123;    </span><br><span class="line">text = <span class="string">"0"</span>;    </span><br><span class="line">&#125;    </span><br><span class="line">setValue(Double.parseDouble(text));    </span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span>    </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAsText</span><span class="params">()</span> </span>&#123;    </span><br><span class="line"><span class="keyword">return</span> getValue().toString();    </span><br><span class="line">&#125;    </span><br><span class="line">&#125;  </span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">ç±»ä¼¼Longã€Floatç­‰éƒ½å¯ä»¥è¿™æ ·å†™ï¼Œç„¶åå°†è¿™äº›è‡ªå®šä¹‰çš„ç¼–è¾‘å™¨æˆ–Springè‡ªå¸¦çš„ç¼–è¾‘å™¨æ”¾åˆ°BaseControllerä¸­å¸¦æœ‰<span class="meta">@initbinder</span>çš„æ–¹æ³•ä¸­æ³¨å†Œå°±å¥½.</span><br><span class="line">```java</span><br><span class="line"><span class="meta">@InitBinder</span>    </span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initBinder</span><span class="params">(WebDataBinder binder)</span> </span>&#123;    </span><br><span class="line">binder.registerCustomEditor(Date.class, <span class="keyword">new</span> CustomDateEditor(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>), <span class="keyword">true</span>));    </span><br><span class="line">binder.registerCustomEditor(<span class="keyword">int</span>.class, <span class="keyword">new</span> CustomNumberEditor(<span class="keyword">int</span>.class, <span class="keyword">true</span>));    </span><br><span class="line">binder.registerCustomEditor(<span class="keyword">int</span>.class, <span class="keyword">new</span> IntegerEditor());    </span><br><span class="line">binder.registerCustomEditor(<span class="keyword">long</span>.class, <span class="keyword">new</span> CustomNumberEditor(<span class="keyword">long</span>.class, <span class="keyword">true</span>));  </span><br><span class="line">binder.registerCustomEditor(<span class="keyword">long</span>.class, <span class="keyword">new</span> LongEditor());    </span><br><span class="line">binder.registerCustomEditor(<span class="keyword">double</span>.class, <span class="keyword">new</span> DoubleEditor());    </span><br><span class="line">binder.registerCustomEditor(<span class="keyword">float</span>.class, <span class="keyword">new</span> FloatEditor());    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è‡ªå®šä¹‰çš„ç¼–è¾‘å™¨ç›´æ¥ç»§æ‰¿ <strong>PropertyEditorSupport</strong>ï¼Œ å› ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">springframework</span>.<span class="title">beans</span>.<span class="title">propertyeditors</span>.<span class="title">PropertiesEditor</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">beans</span>.<span class="title">PropertyEditorSupport</span> </span>&#123;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>éå¸¸æ„Ÿè°¢ä¸€ä¸‹ä¸¤ä½ä½œè€…è´¡çŒ®æ•´ç†çš„æ–‡ç« ï¼š</p><ol><li><a href="http://blog.csdn.net/axin66ok/article/details/17938095#" target="_blank" rel="noopener">spring mvcä½¿ç”¨@InitBinder æ ‡ç­¾å¯¹è¡¨å•æ•°æ®ç»‘å®š</a></li><li><a href="http://www.cnblogs.com/shenxiaoquan/p/5753351.html" target="_blank" rel="noopener">@InitBindæ¥è§£å†³å­—ç¬¦ä¸²è½¬æ—¥æœŸç±»å‹</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­çš„ArrayListçš„å®¹é‡</title>
      <link href="//p/java-arraylist-capacity.html"/>
      <url>//p/java-arraylist-capacity.html</url>
      
        <content type="html"><![CDATA[<ol><li><p>Listæ¥å£çš„å¤§å°å¯å˜æ•°ç»„çš„å®ç°ã€‚å®ç°äº†æ‰€æœ‰å¯é€‰åˆ—è¡¨æ“ä½œï¼Œå¹¶å…è®¸åŒ…æ‹¬ null åœ¨å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</p></li><li><p>ArrayListç»§æ‰¿äºListæ¥å£ï¼Œé™¤ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•å¤–ï¼Œè¿˜æä¾›ä¸€äº›æ–¹æ³•æ¥æ“ä½œå†…éƒ¨ç”¨æ¥å­˜å‚¨åˆ—è¡¨çš„æ•°ç»„çš„å¤§å°ã€‚</p></li><li><p>æ¯ä¸ªArrayListå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå®¹é‡ã€‚è¯¥å®¹é‡æ˜¯æŒ‡ç”¨æ¥å­˜å‚¨åˆ—è¡¨å…ƒç´ çš„æ•°ç»„çš„å¤§å°ã€‚å®ƒæ€»æ˜¯è‡³å°‘ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚éšç€å‘ArrayListä¸­ä¸æ–­æ·»åŠ å…ƒç´ ï¼Œå…¶å®¹é‡ä¹Ÿè‡ªåŠ¨å¢é•¿ã€‚å¹¶æœªæŒ‡å®šå¢é•¿ç­–ç•¥çš„ç»†èŠ‚ï¼Œå› ä¸ºè¿™ä¸åªæ˜¯æ·»åŠ å…ƒç´ ä¼šå¸¦æ¥åˆ†æ‘Šå›ºå®šæ—¶é—´å¼€é”€é‚£æ ·ç®€å•ã€‚</p><a id="more"></a></li><li><p>ArrayListæ˜¯ç»å¸¸ä¼šè¢«ç”¨åˆ°çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„æ—¶å€™ä¼šåƒè¿™æ ·è¿›è¡Œå£°æ˜ï¼š</p><pre><code>List arrayList = new ArrayList();</code></pre><p>å¦‚æœåƒä¸Šé¢è¿™æ ·ä½¿ç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œåˆå§‹å®¹é‡è¢«è®¾ç½®ä¸º10ã€‚å½“ArrayListä¸­çš„å…ƒç´ è¶…è¿‡10ä¸ªä»¥åï¼Œä¼šé‡æ–°åˆ†é…å†…å­˜ç©ºé—´ï¼Œä½¿æ•°ç»„çš„å¤§å°å¢é•¿åˆ°16ã€‚<br>å¯ä»¥é€šè¿‡è°ƒè¯•çœ‹åˆ°åŠ¨æ€å¢é•¿çš„æ•°é‡å˜åŒ–ï¼š10-&gt;16-&gt;25-&gt;38-&gt;58-&gt;88-&gt;â€¦</p></li><li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œå£°æ˜ï¼š</p><pre><code>List arrayList = new ArrayList(4);</code></pre><p>å°†ArrayListçš„é»˜è®¤å®¹é‡è®¾ç½®ä¸º4ã€‚å½“ArrayListä¸­çš„å…ƒç´ è¶…è¿‡4ä¸ªä»¥åï¼Œä¼šé‡æ–°åˆ†é…å†…å­˜ç©ºé—´ï¼Œä½¿æ•°ç»„çš„å¤§å°å¢é•¿åˆ°7ã€‚<br>å¯ä»¥é€šè¿‡è°ƒè¯•çœ‹åˆ°åŠ¨æ€å¢é•¿çš„æ•°é‡å˜åŒ–ï¼š4-&gt;7-&gt;11-&gt;17-&gt;26-&gt;â€¦</p></li><li><p>é‚£ä¹ˆå®¹é‡å˜åŒ–çš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢çš„å…¬å¼ï¼š</p><pre><code>((æ—§å®¹é‡ * 3) / 2) + 1</code></pre><p>æ³¨ï¼šè¿™ç‚¹ä¸C#è¯­è¨€æ˜¯ä¸åŒçš„ï¼ŒC#å½“ä¸­çš„ç®—æ³•å¾ˆç®€å•ï¼Œæ˜¯ç¿»å€ã€‚ ä¸€æ—¦å®¹é‡å‘ç”Ÿå˜åŒ–ï¼Œå°±è¦å¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ï¼Œå’Œæ—¶é—´ä¸Šçš„å¼€é”€ã€‚æ‰€ä»¥ï¼Œåœ¨å·²ç»çŸ¥é“å®¹é‡å¤§å°çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ä¸‹é¢æ–¹å¼è¿›è¡Œå£°æ˜ï¼šList arrayList = new ArrayList(CAPACITY_SIZE); å³æŒ‡å®šé»˜è®¤å®¹é‡å¤§å°çš„æ–¹å¼ã€‚</p></li></ol><p>æ„Ÿè°¢åŸæ–‡ä½œè€…ï¼š<a href="http://blog.csdn.net/arui319/article/details/3557743" target="_blank" rel="noopener">åŸæ–‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ArrayList </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²Hybris</title>
      <link href="//p/jenkins-hybris-deploy.html"/>
      <url>//p/jenkins-hybris-deploy.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>é¡¹ç›®å¼€å‘æ—¶é—´ä¸ç®—ç´§å¼ ï¼ŒçŸ¥é“é¡¹ç›®åº”ç”¨Jenkins æŒç»­é›†æˆå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè¿™ä¸ªéƒ¨ç½²æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå‘æ¶æ„å¸ˆå–ç»ç ”ç©¶ä¹‹ååšæ­¤è®°å½•.</p><h3 id="éƒ¨ç½²æ¶æ„æ‹“æ‰‘å›¾"><a href="#éƒ¨ç½²æ¶æ„æ‹“æ‰‘å›¾" class="headerlink" title="éƒ¨ç½²æ¶æ„æ‹“æ‰‘å›¾"></a>éƒ¨ç½²æ¶æ„æ‹“æ‰‘å›¾</h3><p>ä»¥ä¸‹æ˜¯é¡¹ç›®éƒ¨ç½²æ¶æ„ç®€æ˜“æ‹“æ‰‘å›¾ï¼Œä¸åŒ…æ‹¬SolræœåŠ¡å™¨çš„éƒ¨ç½², Prod Envé‡‡ç”¨Cluster Deploymentçš„æ–¹å¼.  </p><a id="more"></a><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_tp.png" alt="éƒ¨ç½²æ‹“æ‰‘å›¾"></p><blockquote><p>è¿ç»´äººå‘˜æ­å»ºJenkinsæœåŠ¡å™¨ä¹‹åï¼Œæ¯ä½è¢«æˆæƒçš„å¼€å‘äººå‘˜éƒ½å¯ä»¥è®¿é—®Jenkins å·¥ä½œä¸»é¡µï¼Œ å½“pushä»£ç ä¹‹åï¼Œç»Ÿä¸€åœ¨æŒ‡å®šæ—¶é—´ç‚¹build (Jenkinsæ²¡æœ‰é‡‡ç”¨æœ‰pushä»£ç è‡ªåŠ¨buildçš„æ–¹å¼ ).</p><ol><li>å¼€å‘äººå‘˜Push ä»£ç </li><li>Build QA1, åŠŸèƒ½æµ‹è¯•é€šè¿‡ä¹‹åè¿›è¡Œä¸‹ä¸€æ­¥</li><li>Build QA2, åŠŸèƒ½æµ‹è¯•é€šè¿‡ä¹‹åè¿›è¡Œä¸‹ä¸€æ­¥</li><li>ç­‰å¾…å‘å¸ƒç‰ˆæœ¬æ—¶é—´èŠ‚ç‚¹</li><li>Build Stageç¯å¢ƒï¼ŒåŠŸèƒ½æµ‹è¯•é€šè¿‡ä¹‹åè¿›è¡Œä¸‹ä¸€æ­¥ ï¼ˆæ‹“æ‰‘å›¾ä¸­æ²¡æœ‰æ˜¾ç¤ºStageç¯å¢ƒï¼‰</li><li>Build Prod ç¯å¢ƒï¼Œ åŠŸèƒ½æµ‹è¯•é€šè¿‡ä¹‹åæˆåŠŸå‘å¸ƒ.</li></ol></blockquote><p>å¼€å‘äººå‘˜åªéœ€è¦ç‚¹å‡»Jenkinsæ§åˆ¶å°çš„Buildï¼Œå³å¯å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè¿™æ­£æ˜¯Jenkins å¸¦æ¥çš„ä¾¿åˆ©ï¼Œæ¥ä¸‹æ¥å°±è§£é‡Šä¸€ä¸‹Jenkins æ•´ä¸ªå·¥ä½œè¿‡ç¨‹.</p><h3 id="Jenkins-æŒç»­é›†æˆè¿‡ç¨‹è¯¦è§£"><a href="#Jenkins-æŒç»­é›†æˆè¿‡ç¨‹è¯¦è§£" class="headerlink" title="Jenkins æŒç»­é›†æˆè¿‡ç¨‹è¯¦è§£"></a>Jenkins æŒç»­é›†æˆè¿‡ç¨‹è¯¦è§£</h3><p>ç”Ÿäº§ç¯å¢ƒæ˜¯é‡‡ç”¨é›†ç¾¤éƒ¨ç½²ï¼Œå’ŒQAç¯å¢ƒæ˜¯æœ‰æ‰€åŒºåˆ«çš„ï¼Œä¸‹é¢é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒå’ŒQAç¯å¢ƒåˆ†åˆ«ä½œè§£é‡Š</p><h4 id="Common-ç¯å¢ƒè§£é‡Š"><a href="#Common-ç¯å¢ƒè§£é‡Š" class="headerlink" title="Common ç¯å¢ƒè§£é‡Š"></a>Common ç¯å¢ƒè§£é‡Š</h4><p>Jenkins çš„Home Directory æ˜¯  </p><pre><code>/var/lib/jenkins</code></pre><h4 id="QAç¯å¢ƒéƒ¨ç½²"><a href="#QAç¯å¢ƒéƒ¨ç½²" class="headerlink" title="QAç¯å¢ƒéƒ¨ç½²"></a>QAç¯å¢ƒéƒ¨ç½²</h4><blockquote><p>ä»¥QA1 ç¯å¢ƒä¸ºä¾‹ï¼Œitemåç§°ä¸º <strong>qa_honor_hybris</strong>,  workspaceçš„è·¯å¾„æ˜¯Jenkins çš„workspaceè·¯å¾„ä¸itemåç§°çš„æ‹¼æ¥ï¼Œè¿™æ ·å½“å‰itemçš„<strong>$workspace</strong>çš„è·¯å¾„ä¸º</p></blockquote><pre><code>/var/lib/jenkins/workspace/qa_honor_hybris</code></pre><ol><li><p>ç‚¹å‡»buildä¹‹åï¼ŒJenkinsä¼šæŒ‰ç…§è¯¥itemé…ç½®å¥½çš„Git Repository æ¥æ‹‰å–æœ€æ–°ä»£ç åˆ°workspaceä¸­</p></li><li><p>æ‰§è¡Œè‡ªå®šä¹‰Shell è„šæœ¬(Jenkins æ§åˆ¶å°å†™å¥½çš„è„šæœ¬)</p><pre><code># 1. ç§»é™¤æ‰å·¥ä½œåŒºæ—§ä»£ç rm -rf /data/qa_honor_hybris/hybris/bin/custom# 2. copy æ‹‰å–ä¸‹æ¥çš„æœ€æ–°ä»£ç åˆ°å·¥ä½œåŒºä¸­cp -r $WORKSPACE/bin/custom /data/qa_honor_hybris/hybris/bin# 3. copy local.properties  å’Œ localextensions.xml åˆ° å·¥ä½œåŒºconfigç›®å½•ä¸‹cp $WORKSPACE/config/local.properties /data/qa_honor_hybris/hybris/configcp $WORKSPACE/config/localextensions.xml /data/qa_honor_hybris/hybris/config# 5. è¿›å…¥å·¥ä½œåŒºplatform ç›®å½•cd /data/qa_honor_hybris/hybris/bin/platform# 6. è®¾ç½®åŸºæœ¬ç¯å¢ƒå˜é‡ï¼Œå½“ç„¶å¯ä»¥Jenkins è®¾ç½®å¥½export JAVA_HOME=/usr/local/jdk1.8export JRE_HOME=/usr/local/jdk1.8/jreexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATHexport PATH=$JAVA_HOME/bin:$PATH# 7. æŒ‡å®šant ç›®å½•å¹¶ä¸”buildï¼Œæ‰§è¡Œè¯¥æ­¥éª¤æ˜¯ä¸ºäº†æ£€æµ‹é¡¹ç›®æ˜¯å¦èƒ½buildæˆåŠŸ. ./setantenv.shant clean all# 8. åˆ‡æ¢åˆ°å·¥ä½œåŒºbuild ç›®å½•ä¸‹cd /data/qa_honor_hybris/build./build_and_deploy.sh</code></pre></li><li><p><strong>./build_and_deploy.sh</strong> è„šæœ¬å†…å®¹</p><pre><code>#!/bin/bash# 1. è¿›å…¥å·¥ä½œåŒºç›®å½•cd /var/lib/jenkins/workspace/qa1-honor-hybrisecho &quot;build for honor hybris qa1&quot;# åˆ é™¤workspace å†å²å†…å®¹echo &quot;create honor source code tar ball&quot;rm -rf honorrm -rf honor.tar.gz# åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œç­‰å¾…æ‰“åŒ…mkdir honor# copy workspace æœ€æ–°ä»£ç æ‹·è´åˆ° åˆšåˆšæ–°å»ºçš„honor æ–‡ä»¶å¤¹ä¸­cp -r /var/lib/jenkins/workspace/qa1-honor-hybris/bin honorcp -r /var/lib/jenkins/workspace/qa1-honor-hybris/config/qa honor# å°†honor æ–‡ä»¶å¤¹å‹ç¼©æ‰“åŒ…tar -zcvf honor.tar.gz honor# å°†æ‰“åŒ…çš„honor.tar.gz è¿œç¨‹copyåˆ° QA1 æœåŠ¡å™¨çš„workspace ä¸­echo &quot;======copy tar ball to qa1 server(10.11.12.233)=====&quot;scp honor.tar.gz app@10.11.12.233:/data/build_workspace# è¿›å…¥åˆ°QA1 ç¯å¢ƒå¹¶ä¸”è¿›å…¥workspace, åœæ‰QA1 çš„æœåŠ¡echo &quot;===build hybris and start hybris on qa1 server===&quot;ssh app@10.11.12.233 &apos;cd /data/build_workspace;. ./stop.sh&apos;# æ‰§è¡ŒQA1ç›¸åº”è·¯å¾„ä¸‹çš„è„šæœ¬.ssh app@10.11.12.233 &apos;cd /data/build_workspace;. ./build_and_start.sh&apos;echo &quot;build_and_deploy done&quot;exit 0</code></pre></li><li><p><strong>./build_and_start.sh</strong> è„šæœ¬å†…å®¹</p><pre><code>#!/bin/bash# 1. åˆ é™¤æ‰honor æ–‡ä»¶å¤¹ï¼ˆç¡®ä¿æ–‡ä»¶å¤¹åˆ é™¤ï¼Œä¸‹é¢å…¶å®å·²ç»åˆ é™¤äº†ä¸€æ¬¡ï¼‰rm -rf honor# 2. èµ‹äºˆå¯è¯»å¯å†™å¯æ‰§è¡Œçš„æƒé™chmod 755 honor.tar.gz# 3. è§£å‹åˆšåˆšä¼ è¾“è¿‡æ¥çš„å‹ç¼©åŒ…ï¼Œå¹¶èµ‹äºˆå¯è¯»å¯å†™å¯æ‰§è¡Œçš„æƒé™tar -zxvf honor.tar.gzchmod -R 755 honor# 4. åˆ é™¤æ‰æ—§çš„Hybrisä»£ç echo &quot;remove old honor hybris source code...&quot;rm -rf /data/build_workspace/honor-hybris/hybris/bin/customrm -rf /data/build_workspace/honor-hybris/hybris/config/local.propertiesrm -rf /data/build_workspace/honor-hybris/hybris/config/localextensions.xml# 5. copyåˆšåˆšè§£å‹å‡ºæ¥çš„honoræ–‡ä»¶å¤¹çš„å†…å®¹åˆ°å·¥ä½œåŒºecho &quot;copy new honor source code...&quot;cd /data/build_workspacecp -r honor/* honor-hybris/hybriscp honor/qa/local_qa1.properties honor-hybris/hybris/config/local.propertiescp honor/qa/localextensions.xml honor-hybris/hybris/config/localextensions.xml# 6. åˆ é™¤è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹rm -rf honor# 7. è®¾ç½®ç¯å¢ƒå˜é‡echo &quot;begin to start qa1...&quot;export JAVA_HOME=&quot;/usr/local/jdk1.8.0_101&quot;export PATH=$JAVA_HOME/bin:$PATHcd /data/build_workspace/honor-hybris/hybris/bin/platform. ./setantenv.shant clean all# 8. ç›´æ¥ä»¥debugæ¨¡å¼å¯åŠ¨ï¼ˆæ–¹ä¾¿è¿œç¨‹è°ƒè¯•ï¼Œä½†æ˜¯Jenkins buildè¿›åº¦æ¡å§‹ç»ˆæ˜¯çº¢è‰²ï¼Œä¸å½±å“ä½¿ç”¨ï¼Œè¿˜æ²¡æ‰¾åˆ°è¿™ä¸ªè§£å†³åŠæ³•ï¼‰. ./hybrisserver.sh debugexit 0</code></pre></li></ol><p>ä»¥ä¸Šæ˜¯QAç¯å¢ƒè¿˜ä¸æ¶‰åŠåˆ°å¤šnodeçš„æƒ…å†µï¼Œæ¥ä¸‹æ¥ä¼šä»‹ç»Prod çš„æƒ…å†µï¼Œå¤§ä½“æµç¨‹å’ŒQAç¯å¢ƒç›¸ä¼¼ï¼Œåªä¸è¿‡æ˜¯å¤šäº†å¤„ç†nodeçš„æƒ…å†µ.</p><h4 id="Prod-ç¯å¢ƒéƒ¨ç½²"><a href="#Prod-ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="Prod ç¯å¢ƒéƒ¨ç½²"></a>Prod ç¯å¢ƒéƒ¨ç½²</h4><blockquote><p>Jenkins åœ¨buildä¹‹åä¼šå°†æœ€æ–°çš„ä»£ç pullåˆ°releaseæœåŠ¡å™¨ï¼Œ ç„¶ååœ¨releaseæœåŠ¡å™¨ä¸Šæ‰§&gt; è¡Œè„šæœ¬ï¼Œå°†ä»£ç å‘å¸ƒåˆ°å„ä¸ªæœåŠ¡å™¨ä¸Š, åœ¨releaseæœåŠ¡å™¨çš„<strong>/data</strong> ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªç›®å½•</p><ol><li><strong>/data/install</strong>: å°†ç¯å¢ƒæ‰€éœ€çš„è½¯ä»¶ã€Licenceç­‰å­˜æ”¾åœ¨æ­¤ï¼Œè¿™äº›åªæ˜¯ç¬¬ä¸€æ¬¡å‘å¸ƒçš„æ—¶å€™ä¼šç”¨åˆ°</li><li><strong>/data/build</strong>: è¿™æ˜¯çœŸæ­£buildçš„æ‰€éœ€è¦çš„ç›®å½•</li></ol></blockquote><ol><li><p>ç‚¹å‡»buildä¹‹åï¼ŒJenkinsä¼šæŒ‰ç…§è¯¥itemé…ç½®å¥½çš„Git Repository æ¥æ‹‰å–æœ€æ–°ä»£ç åˆ°workspaceä¸­</p></li><li><p>æ‰§è¡Œè‡ªå®šä¹‰Shell è„šæœ¬(Jenkins æ§åˆ¶å°å†™å¥½çš„è„šæœ¬, å’ŒQAç¯å¢ƒç±»ä¼¼ï¼Œæ³¨æ„ç›®å½•çš„æ”¹å˜)</p><pre><code>rm -rf /data/prod_honor_hybris/hybris/bin/customcp -r $WORKSPACE/bin/custom /data/prod_honor_hybris/hybris/bincp $WORKSPACE/config/local.properties /data/prod_honor_hybris/hybris/configcp $WORKSPACE/config/localextensions.xml /data/prod_honor_hybris/hybris/configcd /data/prod_honor_hybris/hybris/bin/platformexport JAVA_HOME=/usr/local/jdk1.8export JRE_HOME=/usr/local/jdk1.8/jreexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATHexport PATH=$JAVA_HOME/bin:$PATH. ./setantenv.shant clean allcd /data/prod_honor_hybris/build./build_and_deploy.sh</code></pre></li><li><p><strong>./build_and_deploy.sh</strong> è„šæœ¬å†…å®¹</p><pre><code>#!/bin/bashcd /var/lib/jenkins/workspace/prod-honor-hybrisecho &quot;build for honor hybris product&quot;echo &quot;create honor source code tar ball&quot;rm -rf honorrm -rf honor.tar.gzmkdir honorcp -r /var/lib/jenkins/workspace/prod-honor-hybris/bin honorcp -r /var/lib/jenkins/workspace/prod-honor-hybris/config/prod honortar -zcvf honor.tar.gz honor# 1. ç”Ÿäº§ä¸Šè¦å¤‡ä»½åŸæœ‰çš„å‹ç¼©åŒ…ï¼Œä»¥é˜²ä¸‡ä¸€è¿›è¡Œæ¢å¤ç‰ˆæœ¬echo &quot;======backup original tar in release server(10.11.12.232)=====&quot;ssh app@10.11.12.232 &quot;cp /data/build/product/honor.tar.gz /data/build/product/honor.tar.gz_backup&quot;echo &quot;======copy tar ball to release server(10.11.12.232)=====&quot;scp honor.tar.gz app@10.11.12.232:/data/build/productecho &quot;build_and_deploy done&quot;exit 0</code></pre></li></ol><ol start="4"><li><p>å‘å¸ƒå†…å®¹å‰ç«¯æœåŠ¡å™¨ï¼Œè¿›å…¥åˆ°Prod Release æœåŠ¡å™¨ç›¸åº”ç›®å½•æ‰§è¡Œè„šæœ¬<strong>app_release.sh</strong></p><blockquote><p>ä¸»è¦åŠ¨æ€å¾ªç¯IPåœ°å€ï¼Œå°†æ–‡ä»¶ä¼ é€åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œæ‰§è¡Œç›¸åº”æœåŠ¡å™¨çš„è„šæœ¬.</p></blockquote><pre><code>#!/bin/bashif [ $# -lt 2 ]; then  echo &quot;please provide server start index and end index&quot;  echo &quot;usage: $0 [start] [end]&quot; # exit 0fis=prd-hybris-padbaseIp=11.12.126.let ipStartNum=$1+54echo &quot;release artifact to hybris server from $s$1 to $s$2&quot;for((i=$1;i&lt;=$2;i++))do    server=$s$i.xxx.com    ipAddr=$baseIp$ipStartNum    echo &quot;============deploy on $server====================&quot;    echo &quot;copy Hybris production Deployment ZIP to $server&quot;    scp /data/build/product/honor.tar.gz app@$server:/data/workspace    echo &quot;build hybris on $server and start hybris&quot;    ssh app@$server &quot;cd /data/workspace;./stop.sh; nohup ./build_and_start.sh $ipAddr  &gt;./build.log 2&gt;&amp;1 &amp; &quot;    let ipStartNum=$ipStartNum+1        sleep 1doneecho &quot;done&quot;#exit 0</code></pre></li><li><p>Prod æœåŠ¡å™¨ç›®å½•ç»“æ„</p></li></ol><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_prod1.png" alt="ç›®å½•ç»“æ„"></p><ol start="6"><li><p>è¿›å…¥åˆ°Prod æœåŠ¡å™¨ä¹‹ä¸€ æŸ¥çœ‹<strong>./stop.sh</strong> è„šæœ¬å†…å®¹</p><pre><code>#!/bin/bashcd /data/workspace/hybris/hybris/bin/platform. ./setantenv.sh &amp;&amp; ./hybrisserver.sh stop</code></pre></li><li><p>æŸ¥çœ‹<strong>./build_and_start.sh</strong>å†…å®¹ï¼ˆå†…å®¹æœ‰äº›å¤æ‚ï¼‰</p><pre><code>#!/bin/bashrm -rf honorchmod 755 honor.tar.gztar -zxvf honor.tar.gzchmod -R 755 honorecho &quot;remove old honor hybris source code...&quot;rm -rf /data/workspace/hybris/hybris/bin/customrm -rf /data/workspace/hybris/hybris/config/local.propertiesrm -rf /data/workspace/hybris/hybris/config/localextensions.xmlecho &quot;copy new honor source code...&quot;cp -r honor/* hybris/hybriscp honor/prod/local.properties hybris/hybris/config/local.propertiescp honor/prod/localextensions.xml hybris/hybris/config/localextensions.xmlcp template.tomcat.context.tpl hybris/hybris/config/tomcat/tomcat_context.tplsed -c -i &apos;s/.*name=&quot;backoffice&quot;.*/&lt;!-- &lt;extension name=&quot;backoffice&quot; \/&gt; --&gt;/g&apos; hybris/hybris/config/localextensions.xmlsed -c -i &apos;s/.*requires-channel=&quot;https&quot;.*/&lt;intercept-url pattern=&quot;\/\*\*&quot; requires-channel=&quot;https&quot;\/&gt;/g&apos; hybris/hybris/bin/custom/honor/honorcommercewebservices/web/webroot/WEB-INF/config/v2/security-v2-spring.xml  sed -c -i &apos;s/.*name=&quot;mcc&quot;.*/&lt;!-- &lt;extension name=&quot;mcc&quot; \/&gt; --&gt;/g&apos; hybris/hybris/config/localextensions.xml#echo cluster.id=$1 &gt;&gt; hybris/hybris/config/local.propertiesecho -e &quot;\ncluster.broadcast.method.jgroups.tcp.bind_addr=$1&quot; &gt;&gt; hybris/hybris/config/local.propertiesecho -e &quot;\ntask.processing.enabled=fase&quot; &gt;&gt; hybris/hybris/config/local.propertiesecho -e &quot;\nhac.webroot=/hac&quot; &gt;&gt; hybris/hybris/config/local.propertiesrm -rf honorecho &quot;begin to start server...&quot;export JAVA_HOME=&quot;/usr/local/jdk1.8.0_101&quot;export PATH=$JAVA_HOME/bin:$PATHcd /data/workspace/hybris/hybris/bin/platform. ./setantenv.shant clean all. ./hybrisserver.sh startexit 0</code></pre></li></ol><ol start="8"><li><p><strong>template.tomcat.context.tpl</strong> æ–‡ä»¶å†…å®¹</p><pre><code>#if (  $contextPath != &apos;/hmc&apos; &amp;&amp;  $contextPath != &apos;/hac&apos; &amp;&amp;  $contextPath != &apos;/backoffice&apos; &amp;&amp;  $contextPath != &apos;/advancedexport&apos; &amp;&amp;  $contextPath != &apos;/admincockpit&apos; &amp;&amp;  $contextPath != &apos;/mcc&apos; &amp;&amp;  $contextPath != &apos;/reportcockpit&apos; &amp;&amp;     $contextPath != &apos;/importcockpit&apos; &amp;&amp;    $contextPath != &apos;/cscockpit&apos; &amp;&amp;    $contextPath != &apos;/cmscockpit&apos; &amp;&amp;  $contextPath != &apos;/cmscockpitRegular&apos; &amp;&amp;  $contextPath != &apos;/productcockpit&apos; &amp;&amp;    $contextPath != &apos;/chinacheckoutaddon&apos; &amp;&amp;  $contextPath != &apos;/instore&apos; &amp;&amp;  $contextPath != &apos;/virtualjdbc&apos; &amp;&amp;  $contextPath != &apos;/erpintegration&apos; &amp;&amp;  $contextPath != &apos;/acceleratorservices&apos; &amp;&amp;  $contextPath != &apos;/commercesearchsampledata&apos; &amp;&amp;  $contextPath != &apos;/solrfacetsearch&apos;)#if($contextDescription &amp;&amp; $contextDescription != &apos;&apos;)            &lt;!-- $contextDescription --&gt;#end            &lt;Context path=&quot;$contextPath&quot; docBase=&quot;$contextDocBase&quot; $!contextAdditionalAttributes&gt;                &lt;Manager pathname=&quot;&quot; /&gt;#if($contextLoader &amp;&amp; $contextLoader != &apos;&apos;)                $contextLoader#end#if($contextAdditionalElements &amp;&amp; $contextAdditionalElements != &apos;&apos;)                $contextAdditionalElements#end            &lt;/Context&gt;#end</code></pre></li></ol><ol start="9"><li><p>å‘å¸ƒå†…å®¹åç«¯æœåŠ¡å™¨ï¼Œè¿›å…¥åˆ°Prod Release æœåŠ¡å™¨ç›¸åº”ç›®å½•æ‰§è¡Œè„šæœ¬<strong>backend_release.sh</strong></p><pre><code>#!/bin/bashif [ $# -lt 2 ]; then  echo &quot;please provide server start index and end index&quot;  echo &quot;usage: $0 [start] [end]&quot; # exit 0fis=prd-hybrisbaseIp=10.0.126.let ipStartNum=$1+52echo &quot;release artifact to hybris server from $s$1 to $s$2&quot;for((i=$1;i&lt;=$2;i++))do    server=$s$i.xxxx.com    ipAddr=$baseIp$ipStartNum    echo &quot;============deploy on $server====================&quot;    echo &quot;copy Hybris production Deployment ZIP to $server&quot;    scp /data/build/product/honor.tar.gz app@$server:/data/workspace    echo &quot;build hybris on $server and start hybris&quot;    ssh app@$server &quot;cd /data/workspace;./stop.sh; nohup ./build_and_start.sh  $ipAddr &gt;./build.log 2&gt;&amp;1 &amp; &quot;    let ipStartNum=$ipStartNum+1        sleep 1doneecho &quot;done&quot;#exit 0</code></pre></li></ol><ol start="10"><li><p><strong>security-v2-spring.xml</strong> æ–‡ä»¶å†…å®¹</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!-- [y] hybris Platform Copyright (c) 2000-2016 SAP SE or an SAP affiliate company. All rights reserved. This software is the confidential and proprietary information of SAP (&quot;Confidential Information&quot;). You shall not disclose such Confidential Information and shall use it only in accordance with the terms of the license agreement you entered into with SAP.--&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;       xmlns:security=&quot;http://www.springframework.org/schema/security&quot;       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/security        http://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;    &lt;http pattern=&quot;/v2/**&quot; entry-point-ref=&quot;oauthAuthenticationEntryPointV2&quot;          access-decision-manager-ref=&quot;webSecurityAccessDecisionManager&quot;          xmlns=&quot;http://www.springframework.org/schema/security&quot; create-session=&quot;stateless&quot;&gt;        &lt;anonymous username=&quot;anonymous&quot; granted-authority=&quot;ROLE_ANONYMOUS&quot;/&gt;        &lt;!--&lt;session-management session-authentication-strategy-ref=&quot;fixation&quot;/&gt;--&gt;&lt;intercept-url pattern=&quot;/**&quot; requires-channel=&quot;https&quot;/&gt;        &lt;port-mappings&gt;            &lt;port-mapping http=&quot;#{configurationService.configuration.getProperty(&apos;tomcat.http.port&apos;)}&quot;                          https=&quot;#{configurationService.configuration.getProperty(&apos;tomcat.ssl.port&apos;)}&quot;/&gt;            &lt;port-mapping http=&quot;#{configurationService.configuration.getProperty(&apos;embeddedserver.http.port&apos;)}&quot;                          https=&quot;#{configurationService.configuration.getProperty(&apos;embeddedserver.ssl.port&apos;)}&quot; /&gt;        &lt;/port-mappings&gt;        &lt;custom-filter ref=&quot;resourceServerFilter&quot; before=&quot;PRE_AUTH_FILTER&quot;/&gt;        &lt;access-denied-handler ref=&quot;oauthAccessDeniedHandlerV2&quot;/&gt;        &lt;headers &gt;            &lt;content-type-options /&gt;            &lt;hsts include-subdomains=&quot;true&quot; max-age-seconds=&quot;16070400&quot; /&gt;            &lt;xss-protection /&gt;            &lt;security:frame-options disabled=&quot;true&quot;/&gt;        &lt;/headers&gt;        &lt;security:csrf disabled=&quot;true&quot;/&gt;    &lt;/http&gt;    &lt;bean id=&quot;oauthAuthenticationEntryPointV2&quot; parent=&quot;oauthAuthenticationEntryPoint&quot;&gt;        &lt;property name=&quot;exceptionRenderer&quot; ref=&quot;oAuth2ExceptionRendererV2&quot;/&gt;    &lt;/bean&gt;    &lt;bean id=&quot;oauthAccessDeniedHandlerV2&quot; parent=&quot;oauthAccessDeniedHandler&quot;&gt;        &lt;property name=&quot;exceptionRenderer&quot; ref=&quot;oAuth2ExceptionRendererV2&quot;/&gt;    &lt;/bean&gt;    &lt;bean id=&quot;oAuth2ExceptionRendererV2&quot; parent=&quot;oAuth2ExceptionRenderer&quot;&gt;        &lt;property name=&quot;messageConverters&quot; ref=&quot;messageConvertersV2&quot;/&gt;    &lt;/bean&gt;&lt;/beans&gt;</code></pre></li></ol><p>å¤§å®¶çœ‹åˆ°äº†å¥½å¤„ï¼Œä¹Ÿçœ‹åˆ°äº†Jenkins ä¸åŒæœåŠ¡å™¨çš„éƒ¨ç½²åŸºæœ¬ç±»ä¼¼ï¼Œå°±æ˜¯è‹¦åŠ›æ´»äº†ï¼Œ æ¥ä¸‹æ¥ä¼šå°†dockerçš„éƒ¨ç½²é™†ç»­æ·»åŠ è¿›æ¥.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring AOP</title>
      <link href="//p/spring-aop.html"/>
      <url>//p/spring-aop.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Spring AOP çš„é“ç†æ‡‚å¾—ï¼Œä½†æ˜¯å¾ˆå°‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œåˆšå·§è¿™ä¸ªé¡¹ç›®ä¸­æœ‰ç”¨åˆ°ï¼Œå°†AOPçš„ç†è§£ä»¥åŠä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜åŠ ä»¥æ€»ç»“è®°å½•</p><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>è®¾æƒ³ä¸€ä¸‹ï¼Œé¡¹ç›®å·²æ¥è¿‘å°¾å£°ï¼Œç»ç†è¯´ä¸ºäº†é¡¹ç›®éªŒæ”¶ï¼Œæ›´å¥½çš„ç›‘æ§ç¨‹åºè°ƒç”¨æ—¥å¿—ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•è°ƒç”¨å‰æˆ–è°ƒç”¨ååŠ ä¸Šæ—¥å¿—ï¼Œå¤©å•Šï¼Œè¿™æ˜¯å¤šå¤§çš„å·¥ä½œé‡ï¼Œé¡¹ç›®ä¸­è‡³å°‘æœ‰å‡ ç™¾ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¦åšè¿™ç§æ— è„‘çš„å·¥ä½œäº†å—ï¼Ÿ å¦‚æœä¸æ‡‚å¾—Spring AOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„é“ç†ï¼Œé‚£è¿™ä¸ªä½“åŠ›æ´»çœ‹æ¥æ˜¯è´¹åŠ›ä¸è®¨å¥½çš„äº‹æƒ…ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ…¢æ…¢å‰–æSpring AOP çš„é“ç†.</p><h3 id="Java-åŠ¨æ€ä»£ç†"><a href="#Java-åŠ¨æ€ä»£ç†" class="headerlink" title="Java åŠ¨æ€ä»£ç†"></a>Java åŠ¨æ€ä»£ç†</h3><p>Java23ä¸­è®¾è®¡æ¨¡å¼ä¹‹ä¸€ä»£ç†æ¨¡å¼ï¼ŒSpring AOPå……åˆ†åˆ©ç”¨äº†Java åŠ¨æ€ä»£ç†åŠŸèƒ½æ¥å®ç°ï¼ˆå¯¹åŠ¨æ€ä»£ç†æœ‰æ‰€ç†è§£çš„å¯ä»¥è·³è¿‡è¯¥æ®µå†…å®¹ï¼‰ï¼Œå³ä¾¿æ²¡æœ‰Spring AOP æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿé€šè¿‡Java  åŠ¨æ€ä»£ç†è§£å†³ä¸Šè¿°é—®é¢˜.  åœ¨Java åŠ¨æ€ä»£ç†ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¥å£æˆ–ç±»ï¼š</p><blockquote><ol><li><strong>InvocationHandler</strong> ï¼ˆInterfaceï¼‰</li><li><strong>Proxy</strong> ï¼ˆClassï¼‰</li></ol></blockquote><a id="more"></a><p>è¿™ä¸€ä¸ªæ¥å£å’Œç±»æ˜¯å®ç°æˆ‘ä»¬åŠ¨æ€ä»£ç†æ‰€å¿…é¡»ç”¨åˆ°çš„ï¼Œå…¶å®è¿™ç§è®¾è®¡æ¨¡å¼å¯ä»¥è”æƒ³åˆ°æˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­çš„ä»£è´­æˆ–ä»£ç†å•†:<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/Spring_springaop.png" alt="enter image description here"></p><p>è¿™æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆå¥½åƒå’Œæˆ‘ä»¬è¯´çš„é¡¹ç›®ä¸­éœ€è¦ä¸æ²¾è¾¹é™…ï¼Œé¡¹ç›®å¿«è¦ç»“æŸäº†ï¼Œæ»¡é¡¹ç›®é‹å­å’Œè¡£æœæ–¹æ³•å·²ç»å†™å¥½ï¼Œçªç„¶é¡¹ç›®ç»ç†è¯´è¦ç»™é‹å­å’Œè¡£æœåŠ ä¸ŠåŒ…è£…ï¼ˆæ—¥å¿—ï¼‰ï¼Œåˆšå¥½ä»£ç†å•†å¯ä»¥è½»æ¾åšåˆ°è¿™ä¸ªï¼Œæ¯æ¬¡å®¢æˆ·è°ƒç”¨é‹å­å’Œè¡£æœæ–¹æ³•æ—¶ï¼Œåªéœ€è¦è°ƒç”¨ä»£ç†å•†æš´éœ²å‡ºæ¥çš„é‹å­å’Œæ–¹æ³•å³å¯, è¿˜æ²¡æ‡‚ï¼Ÿ æ²¡å…³ç³»ï¼Œç¨‹åºçŒ¿çœ‹ä»£ç è¿˜æ˜¯æœ€å®é™…çš„.</p><h4 id="InvocationHandler"><a href="#InvocationHandler" class="headerlink" title="InvocationHandler"></a>InvocationHandler</h4><p>çœ‹ä¸€ä¸‹å®˜æ–¹å®šä¹‰ï¼š</p><blockquote><p><em>InvocationHandler is the interface implemented by the invocation handler of a proxy instance. Each proxy instance has an associated invocation handler. When a method is invoked on a proxy instance, the method invocation is encoded and dispatched to the invoke method of its invocation handler.</em> â€”â€” InvocationHandler æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒè¢«ä¸€ä¸ªä»£ç†ç±»å®ä¾‹çš„handleræ‰€å®ç°ï¼Œæ¯ä¸€ä¸ªä»£ç†ç±»å®ä¾‹éƒ½æœ‰å…¶å¯¹åº”çš„handler, å½“ä¸€ä¸ªä»£ç†å®ä¾‹çš„æ–¹æ³•è¢«è°ƒç”¨ï¼Œæ–¹æ³•çš„è°ƒç”¨å°±äº¤ç»™äº†å®ƒå¯¹åº”çš„handleræ¥å¤„ç†</p></blockquote><p>InvocationHandler æ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š</p><pre><code>Object invoke(Object proxy, Method method, Object[] args) throws Throwable;</code></pre><ol><li>proxy : ä»£ç†ç±»å¯¹è±¡</li><li>method : æˆ‘ä»¬è°ƒç”¨çœŸå®å¯¹è±¡çš„æŸä¸ªæ–¹æ³•</li><li>args : æˆ‘ä»¬è°ƒç”¨çœŸæ˜¯å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ¥å—çš„å‚æ•°</li></ol><h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><p>çœ‹ä¸€ä¸‹å®˜æ–¹å®šä¹‰ï¼š</p><blockquote><p>Proxy provides static methods for creating dynamic proxy classes and instances, and it is also the superclass of all dynamic proxy classes created by those methods.  â€”â€” Proxyæä¾›ä¸€ä¸ªé™æ€æ–¹æ³•ç”¨æ¥åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹ï¼Œå¹¶ä¸”æ˜¯æ‰€æœ‰ä»£ç†ç±»çš„çˆ¶ç±»</p></blockquote><p>Proxy ç±»ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ï¼š</p><pre><code>/***Returns an instance of a proxy class for the specified interfaces that dispatches method invocations to the specified invocation handler*/public static Object newProxyInstance(ClassLoader loader, Class[] interfaces, InvocationHandler h) {    try {        Class e = getProxyClass(loader, interfaces);        return e.getConstructor(new Class[]{InvocationHandler.class}).newInstance(new Object[]{h});    } catch (RuntimeException var4) {        throw var4;    } catch (Exception var5) {        throw new CodeGenerationException(var5);    }}</code></pre><ol><li>loader :  ä¸€ä¸ªClassLoaderå¯¹è±¡ï¼Œå®šä¹‰äº†ç”±å“ªä¸ªClassLoaderå¯¹è±¡æ¥å¯¹ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è¿›è¡ŒåŠ è½½</li><li>interfaces : ä¸€ä¸ªInterfaceå¯¹è±¡çš„æ•°ç»„ï¼Œè¡¨ç¤ºçš„æ˜¯æˆ‘å°†è¦ç»™æˆ‘éœ€è¦ä»£ç†çš„å¯¹è±¡æä¾›ä¸€ç»„ä»€ä¹ˆæ¥å£ï¼Œå¦‚æœæˆ‘æä¾›äº†ä¸€ç»„æ¥å£ç»™å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†å¯¹è±¡å°±å®£ç§°å®ç°äº†è¯¥æ¥å£(å¤šæ€)ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº†</li><li>h : ä¸€ä¸ªInvocationHandlerå¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“æˆ‘è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ªInvocationHandlerå¯¹è±¡ä¸Š</li></ol><h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><h4 id="å®šä¹‰Subject-æ¥å£ï¼š"><a href="#å®šä¹‰Subject-æ¥å£ï¼š" class="headerlink" title="å®šä¹‰Subject æ¥å£ï¼š"></a>å®šä¹‰Subject æ¥å£ï¼š</h4><pre><code>public interface Subject{    public void shoes();    public void clothes(String str);}</code></pre><h4 id="å®šä¹‰æ¥å£çœŸå®å®ç°ç±»"><a href="#å®šä¹‰æ¥å£çœŸå®å®ç°ç±»" class="headerlink" title="å®šä¹‰æ¥å£çœŸå®å®ç°ç±»"></a>å®šä¹‰æ¥å£çœŸå®å®ç°ç±»</h4><pre><code>public class RealSubject implements Subject{    @Override    public void shoes()    {        System.out.println(&quot;This is shoes method without packaging&quot;);    }    @Override    public void clothes(String str)    {        System.out.println(&quot;hello: &quot; + str);    }}</code></pre><h4 id="å®šä¹‰åŠ¨æ€ä»£ç†ç±»ï¼Œå¹¶å®ç°InvocationHandler-æ¥å£"><a href="#å®šä¹‰åŠ¨æ€ä»£ç†ç±»ï¼Œå¹¶å®ç°InvocationHandler-æ¥å£" class="headerlink" title="å®šä¹‰åŠ¨æ€ä»£ç†ç±»ï¼Œå¹¶å®ç°InvocationHandler æ¥å£"></a>å®šä¹‰åŠ¨æ€ä»£ç†ç±»ï¼Œå¹¶å®ç°InvocationHandler æ¥å£</h4><pre><code>public class DynamicProxy implements InvocationHandler{    //è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡    private Object subject;    //æ„é€ æ–¹æ³•ï¼Œç»™æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡èµ‹åˆå€¼    public DynamicProxy(Object subject)    {        this.subject = subject;    }    @Override    public Object invoke(Object object, Method method, Object[] args)            throws Throwable    {        //åœ¨ä»£ç†çœŸå®å¯¹è±¡å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œï¼Œæ¯”å¦‚ç»™é‹å­å’Œè¡£æœåšåŒ…è£…        System.out.println(&quot;before packaging&quot;);        System.out.println(&quot;Method:&quot; + method);        //å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨        method.invoke(subject, args);        //åœ¨ä»£ç†çœŸå®å¯¹è±¡åæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œï¼ŒåŠ å®ŒåŒ…è£…ä¹‹åçš„ä¸€äº›å”®åæœåŠ¡        System.out.println(&quot;after packaging&quot;);        return null;    }}</code></pre><h4 id="çœ‹çœ‹å®¢æˆ·ç«¯ç±»çš„å®šä¹‰"><a href="#çœ‹çœ‹å®¢æˆ·ç«¯ç±»çš„å®šä¹‰" class="headerlink" title="çœ‹çœ‹å®¢æˆ·ç«¯ç±»çš„å®šä¹‰"></a>çœ‹çœ‹å®¢æˆ·ç«¯ç±»çš„å®šä¹‰</h4><pre><code>public class Client{    public static void main(String[] args)    {        //æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡        Subject realSubject = new RealSubject();        //æˆ‘ä»¬è¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•çš„        InvocationHandler handler = new DynamicProxy(realSubject);        /*         * é€šè¿‡Proxyçš„newProxyInstanceæ–¹æ³•æ¥åˆ›å»ºæˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸‰ä¸ªå‚æ•°         * ç¬¬ä¸€ä¸ªå‚æ•° handler.getClass().getClassLoader() ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨handlerè¿™ä¸ªç±»çš„ClassLoaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡         * ç¬¬äºŒä¸ªå‚æ•°realSubject.getClass().getInterfaces()ï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºä»£ç†å¯¹è±¡æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡æ‰€å®è¡Œçš„æ¥å£ï¼Œè¡¨ç¤ºæˆ‘è¦ä»£ç†çš„æ˜¯è¯¥çœŸå®å¯¹è±¡ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº†         * ç¬¬ä¸‰ä¸ªå‚æ•°handlerï¼Œ æˆ‘ä»¬è¿™é‡Œå°†è¿™ä¸ªä»£ç†å¯¹è±¡å…³è”åˆ°äº†ä¸Šæ–¹çš„ InvocationHandler è¿™ä¸ªå¯¹è±¡ä¸Š         */        Subject subject = (Subject)Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject                .getClass().getInterfaces(), handler);        System.out.println(subject.getClass().getName());        subject.shoes();        subject.clothes(&quot;clothes, it&apos;s without packaging&quot;);    }}</code></pre><h4 id="æ§åˆ¶å°çš„è¾“å‡ºç»“æœ"><a href="#æ§åˆ¶å°çš„è¾“å‡ºç»“æœ" class="headerlink" title="æ§åˆ¶å°çš„è¾“å‡ºç»“æœ"></a>æ§åˆ¶å°çš„è¾“å‡ºç»“æœ</h4><pre><code>$Proxy0before packagingMethod:public abstract void com.xiaoluo.dynamicproxy.Subject.shoes()This is shoes method without packagingafter packagingbefore packagingMethod:public abstract void com.xiaoluo.dynamicproxy.Subject.clothes(java.lang.String)hello: clothes, it&apos;s without packagingafter packaging</code></pre><p>Proxy.newProxyInstance ç”Ÿæˆä»£ç†å¯¹è±¡æ—¶æ‰€éœ€è¦çš„invocationHandler å‚æ•°æ›´åƒæ˜¯ä»£ç†å•†å’Œä¾›åº”å•†ä¹‹é—´çš„ç‰©æµï¼Œå½“ä»£ç†å•†éœ€è¦ä¾›åº”å•†çš„é‹å­æ—¶å€™ï¼Œéœ€è¦å‘Šè¯‰è¿™ä¸ªç‰©æµå»å–é‹å­.  ä¸€ä¸ªä»£ç†å•†å½“ç„¶ä¹Ÿä»£ç†å¤šä¸ªå“ç‰Œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‚æ•°ä¸­interfaces æ˜¯æ•°ç»„å½¢å¼ï¼Œè‡³æ­¤å…³äºJava åŠ¨æ€ä»£ç†å°±å‘Šä¸€æ®µè½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹Spring AOP , é“ç†éƒ½æ˜¯ç›¸é€šçš„.</p><h3 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h3><h4 id="æœ¯è¯­è§£é‡Š"><a href="#æœ¯è¯­è§£é‡Š" class="headerlink" title="æœ¯è¯­è§£é‡Š"></a>æœ¯è¯­è§£é‡Š</h4><table><thead><tr><th align="left">æœ¯è¯­åç§°</th><th align="left">å¯¹åº”è§£é‡Š</th><th align="left">å®˜æ–¹æœ¯è¯­æè¿°</th></tr></thead><tbody><tr><td align="left">Aspect</td><td align="left">å®ƒæ˜¯ä¸€ä¸ªåŒ…å«ä¸€ç³»åˆ—APIçš„æ¨¡å—ï¼ŒåŒæ—¶æä¾›æ¨ªåˆ‡çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•.</td><td align="left">A module which has a set of APIs providing cross-cutting requirements. For example, a logging module would be called AOP aspect for logging. An application can have any number of aspects depending on the requirement.</td></tr><tr><td align="left">Join point</td><td align="left">åº”ç”¨ç¨‹åºçœŸæ­£ä¼šå‘ç”Ÿé€šçŸ¥è¡Œä¸ºçš„ä¸€ä¸ªç‚¹</td><td align="left">This represents a point in your application where you can plug-in AOP aspect. You can also say, it is the actual place in the application where an action will be taken using Spring AOP framework.</td></tr><tr><td align="left">Advice</td><td align="left">å¯ä»¥ç†è§£ä¸ºé€šçŸ¥ï¼Œåœ¨ç›®æ ‡ç¨‹åºæ‰§è¡Œå‰é€šçŸ¥è¿˜æ˜¯æ‰§è¡Œåé€šçŸ¥</td><td align="left">This is the actual action to be taken either before or after the method execution. This is actual piece of code that is invoked during program execution by Spring AOP framework.</td></tr><tr><td align="left">Pointcut</td><td align="left">Join Pointçš„é›†åˆï¼Œç¨‹åºä¸­æ‰€æœ‰æƒ³åˆ‡å…¥çš„ç‚¹çš„é›†åˆ</td><td align="left">This is a set of one or more joinpoints where an advice should be executed. You can specify pointcuts using expressions or patterns as we will see in our AOP examples.</td></tr></tbody></table><h4 id="Advice-é€šçŸ¥"><a href="#Advice-é€šçŸ¥" class="headerlink" title="Advice é€šçŸ¥"></a>Advice é€šçŸ¥</h4><table><thead><tr><th align="left">æœ¯è¯­åç§°</th><th align="left">å¯¹åº”è§£é‡Š</th><th align="left">å®˜æ–¹æœ¯è¯­æè¿°</th></tr></thead><tbody><tr><td align="left">before</td><td align="left">åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ä¹‹å‰é€šçŸ¥</td><td align="left">Run advice before the a method execution</td></tr><tr><td align="left">after</td><td align="left">åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ä¹‹åé€šçŸ¥ï¼Œä¸ç®¡ç›®æ ‡æ–¹æ³•æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</td><td align="left">Run advice after the a method execution regardless of its outcome.</td></tr><tr><td align="left">after-returning</td><td align="left">å½“ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸ä¹‹å</td><td align="left">Run advice after the a method execution only if method completes successfully</td></tr><tr><td align="left">after-throwing</td><td align="left">after æˆ– after-returning è¿è¡Œä¹‹åæ•è·å¼‚å¸¸</td><td align="left">Run advice after the a method execution only if method exits by throwing an exception.</td></tr><tr><td align="left">around</td><td align="left">è¿è¡Œç›®æ ‡æ–¹æ³•å‰åç¯ç»•</td><td align="left">Run advice before and after the advised method is invoked</td></tr></tbody></table><pre><code>try{   //å‰ç½®é€šçŸ¥        //ç¯ç»•é€šçŸ¥           //è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•        //ç¯ç»•é€šçŸ¥   //åç½®é€šçŸ¥ }catch(){   //å¼‚å¸¸é€šçŸ¥ }finally{   //ç»ˆæ­¢é€šçŸ¥ }</code></pre><h4 id="Spring-XMLé…ç½®"><a href="#Spring-XMLé…ç½®" class="headerlink" title="Spring XMLé…ç½®"></a>Spring XMLé…ç½®</h4><pre><code>&lt;context:annotation-config/&gt;    &lt;aop:config proxy-target-class=&quot;true&quot; expose-proxy=&quot;true&quot;&gt;        &lt;aop:aspect ref=&quot;capitalModification&quot;&gt;            &lt;aop:pointcut id=&quot;handleOrder&quot; expression=&quot;execution(* com.honor.facades.app.order.HonorOrderFacade.handleCapital(..))                || execution(* com.honor.facades.serviceOrder.HonorServiceOrderFacade.handleCapital(..))                || execution(* com.honor.facades.aftersales.HonorReturnFormFacades.handleCapital(..))&quot;/&gt;            &lt;aop:after method=&quot;capitalAndRecordModification&quot;  pointcut-ref=&quot;handleOrder&quot;/&gt;            &lt;aop:after-throwing throwing=&quot;ex&quot; method=&quot;capitalAndRecordModificationExceptionHandle&quot;  pointcut-ref=&quot;handleOrder&quot;/&gt;        &lt;/aop:aspect&gt;    &lt;/aop:config&gt;&lt;bean id=&quot;capitalModification&quot; class=&quot;com.honor.core.customerCapital.impl.DefaultCapitalModificationStrategy&quot;&gt;        &lt;property name=&quot;customerCapitalService&quot; ref=&quot;customerCapitalService&quot;/&gt;        &lt;property name=&quot;honorSuperOrderService&quot; ref=&quot;honorSuperOrderService&quot;/&gt;        &lt;property name=&quot;honorBillService&quot; ref=&quot;honorBillService&quot;/&gt;    &lt;/bean&gt;</code></pre><p>å¤šä¸ªpointcut å¯ä»¥ç”¨ || æˆ– or æ¥å®ç°.</p><h3 id="é¡¹ç›®ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜"><a href="#é¡¹ç›®ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é¡¹ç›®ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜"></a>é¡¹ç›®ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜</h3><p>å…³äºAOPæ— æ³•åˆ‡å…¥åŒç±»è°ƒç”¨æ–¹æ³•çš„é—®é¢˜<br>Controller å±‚æ–¹æ³•Aè°ƒç”¨äº†Facadeå±‚æ–¹æ³•Bï¼Œå¯æ˜¯Bå†…è°ƒç”¨äº†æ–¹æ³•C, æˆ‘ä»¬æƒ³ä½¿ç”¨AOPç»‡å…¥æ–¹æ³•C, å½“ç¨‹åºè¿è¡Œåï¼Œ å§‹ç»ˆæ‰¾ä¸åˆ°ä»£ç†æ–¹æ³•ï¼Œæ„å‘³ç€ç»‡å…¥Cæ²¡æœ‰æˆåŠŸ,</p><pre><code>public class MyController{    public void methodA(){        myFacade.methodB();    }}public class MyController{    public void methodB(){        myFacade.methodC();    }    public void methodC(){        System.out.println(&quot;bingo&quot;);    }}public class Aspect {       @AfterReturning(execution(* Facade.methodB(..)))       public void after() {           Logger.info(after call and do something);      }  }  </code></pre><p>æˆ‘ä»¬å‘ç°åœ¨ AopContext.class ä¸­ï¼š</p><pre><code>public static Object currentProxy() throws IllegalStateException {        Object proxy = currentProxy.get();        if(proxy == null) {            throw new IllegalStateException(&quot;Cannot find current proxy: Set \&apos;exposeProxy\&apos; property on Advised to \&apos;true\&apos; to make it available.&quot;);        } else {            return proxy;        }    }</code></pre><p>è§£å†³åŠæ³•ï¼š</p><ol><li><p>è®¾ç½®proxy-target-class=â€trueâ€expose-proxy=â€trueâ€</p><pre><code>&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;expose-proxy=&quot;true&quot;/&gt;  </code></pre></li><li><p>æ‰‹åŠ¨æŒ‡å®šä»£ç†è°ƒç”¨æ–¹æ³•</p><pre><code>((Facade) AopContext.currentProxy()).methodB();  </code></pre></li></ol><h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p>éå¸¸æ„Ÿè°¢ä»¥ä¸‹å‡ ä½åšä¸»ï¼Œåœ¨ä½ ä»¬è®¤çœŸçš„åšå®¢ä¸Šå­¦åˆ°äº†è®¸å¤š.</p><ol><li><a href="http://blog.csdn.net/lirui0822/article/details/8555691" target="_blank" rel="noopener">http://blog.csdn.net/lirui0822/article/details/8555691</a></li><li><a href="http://www.cnblogs.com/xiaoluo501395377/p/3383130.html" target="_blank" rel="noopener">http://www.cnblogs.com/xiaoluo501395377/p/3383130.html</a></li></ol><p>åŒæ—¶ä¿®æ”¹AOPå‡½æ•°è¿”å›å€¼åŠè·å–å‡½æ•°å‚æ•°è¯·å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p><ol><li><a href="http://blog.csdn.net/cleverutd/article/details/8607491" target="_blank" rel="noopener">http://blog.csdn.net/cleverutd/article/details/8607491</a></li><li><a href="https://my.oschina.net/itblog/blog/211693" target="_blank" rel="noopener">https://my.oschina.net/itblog/blog/211693</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkinså­¦ä¹ ä¹‹é‚®ç®±é…ç½®</title>
      <link href="//p/jenkins-config-mail.html"/>
      <url>//p/jenkins-config-mail.html</url>
      
        <content type="html"><![CDATA[<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>å¼€å‘äººå‘˜build project ä¹‹åï¼Œbuildç»“æœæ— è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦åŠæ—¶çš„é€šçŸ¥ç»„å†…å…¶ä»–æˆå‘˜äº†è§£æœ€æ–°æƒ…å†µï¼Œé‚®ä»¶é€šçŸ¥è¿™æ—¶å€™å°±æ´¾ä¸Šç”¨åœºï¼Œæ°å·§ Jenkins æä¾›äº†è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼Œä¸è¿‡è¯¥åŠŸèƒ½è¿˜æ˜¯è¿‡äºå•ä¸€ï¼Œå¦‚ä¸èƒ½ç¼–å†™email template æ¥æ ¼å¼åŒ–é‚®ä»¶å†…å®¹ï¼Œä½†<strong>Extended E-mail Notification</strong>ï¼ˆJenkins é‚®ä»¶æ’ä»¶ï¼‰å®ç°äº†æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥é€æ­¥çœ‹ä¸€ä¸‹ Jenkins é‚®ä»¶åŠŸèƒ½çš„é…ç½®</p><h3 id="é…ç½®é‚®ä»¶æœåŠ¡å™¨"><a href="#é…ç½®é‚®ä»¶æœåŠ¡å™¨" class="headerlink" title="é…ç½®é‚®ä»¶æœåŠ¡å™¨"></a>é…ç½®é‚®ä»¶æœåŠ¡å™¨</h3><p>ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ï¼Œåœ¨ Jenkins é¦–é¡µclick <strong>Manage Jenkins</strong>, ç„¶å click <strong>Configure System</strong>, ä¸‹æ‹‰åˆ°é¡µé¢çš„æœ€åº•éƒ¨ <strong>E-mail Notification</strong> å¤„ï¼š</p><a id="more"></a><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_mail1.png" alt="E-mail Notification"></p><p>æ­¤å¤„æˆ‘ç”¨äº†ç½‘æ˜“<strong>yeah.net</strong>çš„é‚®ç®±ï¼ŒUser Name(é‚®ç®±è´¦å·)ï¼ŒPassword(é‚®ç®±å¯†ç )ï¼Œåœ¨Test e-mail recipient(æ¥æ”¶é‚®ä»¶)ï¼Œä¸è¿‡é…ç½®äº†è¿™äº›ä»…ä»…æ˜¯é…ç½®é‚®ä»¶æœåŠ¡å™¨åœ°å€ã€è´¦å·å’Œå¯†ç ï¼Œä½†æ˜¯jenkinsä¸çŸ¥é“é‡‡ç”¨å“ªä¸ªé‚®ç®±å»å‘é€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¯¥å¤„é…ç½®å‘é€çš„é‚®ç®±ï¼Œå¹¶ä¸”è¦å’Œç®¡ç†å‘˜çš„é‚®ç®±ä¸€è‡´</p><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_mail2.png" alt="admin"></p><p>åˆ°æ­¤ç‚¹å‡»ä¸€ä¸‹<strong>Test configuration</strong> button çœ‹ä¸€ä¸‹æµ‹è¯•ç»“æœï¼Œå¦‚æœæµ‹è¯•ä¸æˆåŠŸè¦æ£€æŸ¥ä¸€ä¸‹ç®¡ç†å‘˜é‚®ç®±æ˜¯å¦æœ‰å¼€é€š SMTPæœåŠ¡ï¼Œç™»å½•ä½ è®¾ç½®çš„é‚®ç®±å¼€é€šSMTP</p><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/mail3.png" alt="smtp"></p><p>è®¾ç½®å®Œä¹‹åæµ‹è¯•ç»“æœä¸º<strong>æˆåŠŸ</strong></p><p>å½“æˆ‘ä»¬åœ¨project ä¸­é…ç½®buildä¹‹åçš„è¡Œä¸ºæ—¶ï¼Œå¯ä»¥æ·»åŠ é‚®ä»¶é€šçŸ¥ï¼Œè¿™æ ·åœ¨æ¥æ”¶äººåˆ—è¡¨ä¸­çš„äººéƒ½å¯ä»¥æ¥å—åˆ°buildçš„ç»“æœï¼š</p><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_mail4.png" alt="build"></p><p>build ä¸€ä¸‹é¡¹ç›®ï¼Œçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰æ”¶åˆ°é‚®ä»¶é€šçŸ¥å§.</p><h3 id="å®‰è£…Emailæ’ä»¶"><a href="#å®‰è£…Emailæ’ä»¶" class="headerlink" title="å®‰è£…Emailæ’ä»¶"></a>å®‰è£…Emailæ’ä»¶</h3><p>Jenkins é¦–é¡µ â€”â€” Manage Jenkins â€”â€” Manage Pluginsï¼Œå®‰è£…è¯¥æ’ä»¶<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_mail5.png" alt="plugin"></p><p>é‡æ–°å¯åŠ¨Jenkins, å¯ä»¥åœ¨åˆšåˆšé…ç½®é‚®ä»¶çš„ä¸Šæ–¹çœ‹åˆ°å·²å®‰è£…å¥½çš„email æ’ä»¶<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/jenkins_mail6.png" alt="mail plugin"></p><p>è¿™æ ·ç¼–è¾‘<strong>Default Content</strong> å­—æ®µæ¥ç¼–å†™email template, æ”¯æŒ HTML æ ‡ç­¾.  è¿™æ ·åœ¨é¡¹ç›®æ„å»ºåè¡Œä¸ºä¸­é€‰æ‹©<strong>Editable Email Notificatioin</strong> æ¥å‘å¸ƒbuildçš„ç»“æœ</p><p><strong>NOTE:</strong> å¤§å®¶çœ‹ä¸æ‡‚çš„å­—æ®µå¤šå¤šç‚¹å¼€å­—æ®µå³ä¾§çš„é—®å·ï¼Œé‡Œé¢çš„è¯´æ˜è¿˜æ˜¯éå¸¸æ¸…æ™°çš„. é‚®ä»¶æ’ä»¶çš„å…¶ä»–å°åŠŸèƒ½ä¹Ÿè¯·è‡ªè¡Œç ”ç©¶.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·§ç”¨PostMan</title>
      <link href="//p/postman-advanced-usage.html"/>
      <url>//p/postman-advanced-usage.html</url>
      
        <content type="html"><![CDATA[<p>ç°åœ¨è¶Šå‘çš„è®¤è¯†åˆ°å·§ç”¨å·¥å…·æé«˜å·¥ä½œæ•ˆç‡çš„é‡è¦æ€§ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹PostManå¸¦æ¥çš„ä¾¿åˆ©</p><h3 id="ä¸šåŠ¡æƒ…æ™¯"><a href="#ä¸šåŠ¡æƒ…æ™¯" class="headerlink" title="ä¸šåŠ¡æƒ…æ™¯"></a>ä¸šåŠ¡æƒ…æ™¯</h3><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œå½“Appæˆ–å…¶ä»–æ¸ é“æ¥è°ƒç”¨Javaåå°æ¥å£çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨åˆ°PostManè¿™ä¸ªå·¥å…·æ¥æ¨¡æ‹Ÿè°ƒç”¨ï¼Œå½“éœ€è¦tokenæ¥ä½œä¸ºéªŒè¯çš„æ—¶å€™ï¼Œå½“æ¯æ¬¡è¯·æ±‚çš„tokenå‘ç”Ÿå˜åŒ–çš„æ—¶å€™æˆ‘ä»¬åŒæ—¶è¦æ”¹å˜å…¶ä»–è¯·æ±‚URLä¸­çš„tokenå†…å®¹ï¼Œè¿™æ ·å¾ˆéº»çƒ¦ï¼Œé™ä½å·¥ä½œæ•ˆç‡ï¼ŒPostMançš„ç¯å¢ƒå˜é‡è§£å†³äº†è¿™ä¸ªé—®é¢˜</p><a id="more"></a><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_manage_env.png" alt="æ·»åŠ ç¯å¢ƒå˜é‡"><br>and<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_add_get.png" alt="å¢åŠ "><br>and<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_add_post.png" alt="æ·»åŠ å˜é‡"><br>and<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_token_url.png" alt="token_url"><br>and<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_token_script.png" alt="script"><br>and<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_get_token.png" alt="get token"><br>and<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/postman_use_token.png" alt="user token"></p><p>è‡³æ­¤è®¾ç½®ç¯å¢ƒå˜é‡ç»“æŸï¼Œå…¶ä»–åŠŸèƒ½ä¼šé™†ç»­è¡¥å…….</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PostMan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Ignoring Files</title>
      <link href="//p/git-ignore.html"/>
      <url>//p/git-ignore.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»¥ä¸‹å†…å®¹æ ¹æ®<a href="https://help.github.com/articles/ignoring-files/" target="_blank" rel="noopener">Git Help</a>ä»¥åŠ<a href="https://git-scm.com/docs/gitignore" target="_blank" rel="noopener">Git Docs</a> æ•´ç†ç¿»è¯‘</p><h3 id="Ignoring-files-å¿½ç•¥æ–‡ä»¶"><a href="#Ignoring-files-å¿½ç•¥æ–‡ä»¶" class="headerlink" title="Ignoring files(å¿½ç•¥æ–‡ä»¶)"></a>Ignoring files(å¿½ç•¥æ–‡ä»¶)</h3><p>æœ‰æ—¶å€™ä¼šæœ‰ä¸€äº›æˆ‘ä»¬ä¸æƒ³Git æäº¤ä¸€äº›æ–‡ä»¶åˆ°GitHub/GitLabï¼Œä¸‹é¢æœ‰å‡ ç§æ–¹å¼è®©æˆ‘ä»¬å‘Šè¯‰Gitæ¥å¿½ç•¥å“ªäº›æ–‡ä»¶.</p><a id="more"></a><h4 id="Create-a-local-gitignoreï¼ˆåˆ›å»ºå±€éƒ¨-æœ¬åœ°çš„-gitignoreæ–‡ä»¶ï¼‰"><a href="#Create-a-local-gitignoreï¼ˆåˆ›å»ºå±€éƒ¨-æœ¬åœ°çš„-gitignoreæ–‡ä»¶ï¼‰" class="headerlink" title="Create a local .gitignoreï¼ˆåˆ›å»ºå±€éƒ¨/æœ¬åœ°çš„.gitignoreæ–‡ä»¶ï¼‰"></a>Create a local .gitignoreï¼ˆåˆ›å»ºå±€éƒ¨/æœ¬åœ°çš„.gitignoreæ–‡ä»¶ï¼‰</h4><blockquote><p>å¦‚æœåœ¨local repositoryï¼ˆä»“åº“ï¼‰ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<strong>.gitignore</strong>çš„æ–‡ä»¶ï¼Œåœ¨ä½ commitï¼ˆæäº¤ï¼‰åŠ¨ä½œä¹‹å‰ï¼ŒGit å°†ä¼šè¯»å–<strong>*.gitignore</strong>æ–‡ä»¶å»åˆ¤æ–­å“ªäº›æ–‡ä»¶æˆ–è€…ç›®å½•éœ€è¦å¿½ç•¥æ‰. åŒæ—¶è¿™ä¸ªæ–‡ä»¶åº”è¯¥pushåˆ°remote repository, è¿™æ ·cloneè¯¥repositoryçš„ç”¨æˆ·éƒ½ä¼šå…±äº«ignoreçš„è§„åˆ™. å½“ç„¶GitHubä¸Šç»´æŠ¤äº†ä¸€ä¸ªå®˜æ–¹çš„ã€é’ˆå¯¹è®¸å¤šæµè¡Œçš„æ“ä½œç³»ç»Ÿã€ç¯å¢ƒã€è¯­è¨€çš„<strong>.gitignore</strong> <a href="https://github.com/github/gitignore" target="_blank" rel="noopener">æ–‡ä»¶æ ·ä¾‹</a></p></blockquote><p>åœ¨ç»ˆç«¯ï¼Œå®šä½åˆ°Git repositoryæ‰€åœ¨ä½ç½®ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»º<strong>.gitignore</strong>æ–‡ä»¶ï¼ˆå½“ç„¶åœ¨windowsç¯å¢ƒå¯ä»¥ç›´æ¥åœ¨ä»“åº“ä½ç½®é¼ æ ‡å³é”®åˆ›å»ºåä¸º.gitignoreçš„æ–‡ä»¶å³å¯ï¼‰</p><pre><code>touch .gitignore</code></pre><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæŸä¸ªæ–‡ä»¶å·²ç»è¢«æäº¤ï¼Œæ­¤æ—¶ä½ æƒ³è®©git å¿½ç•¥å®ƒï¼Œè¿™æ˜¯ä½ æŠŠè¿™ä¸ªæ–‡ä»¶æ·»åŠ åˆ°<strong>.gitignore</strong>æ–‡ä»¶ä¸­ï¼Œgitä¹Ÿä¸ä¼šå¿½ç•¥å®ƒï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»å…ˆuntrackè¿™ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·Gitæ‰ä¼šå¿½ç•¥è¿™ä¸ªæ–‡ä»¶</p><pre><code>git rm --cached FILENAME</code></pre><h4 id="Create-a-global-gitignoreï¼ˆåˆ›å»ºå…¨å±€-gitignoreæ–‡ä»¶ï¼‰"><a href="#Create-a-global-gitignoreï¼ˆåˆ›å»ºå…¨å±€-gitignoreæ–‡ä»¶ï¼‰" class="headerlink" title="Create a global .gitignoreï¼ˆåˆ›å»ºå…¨å±€.gitignoreæ–‡ä»¶ï¼‰"></a>Create a global .gitignoreï¼ˆåˆ›å»ºå…¨å±€.gitignoreæ–‡ä»¶ï¼‰</h4><blockquote><p>é€šå¸¸æˆ‘ä»¬ä¼šæœ‰å¤šä¸ªrepositoryï¼Œå¦‚æœå¤šä¸ªä»“åº“éœ€è¦çš„è§„åˆ™ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºæ¯ä¸€ä¸ªrepositoryéƒ½æ–°å»ºä¸€ä¸ª<strong>.gitignore</strong> æ–‡ä»¶å—ï¼Ÿæ˜¾ç„¶æˆ‘ä»¬æ­¤åˆ»éœ€è¦ä¸€ä¸ªå…¨å±€çš„æ–¹å¼æ¥ç®¡æ§æ‰€æœ‰çš„repository. æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºè¯¥å…¨å±€æ–‡ä»¶ï¼š</p></blockquote><ol><li><p>å½“å®‰è£…äº†Gitä¹‹åï¼Œåœ¨git ä¸»ç›®å½•(Windowsç¯å¢ƒC:\Users\Fraser)ä¸‹ä¼šæœ‰ä¸€ä¸ª<strong>.gitconfig</strong>æ–‡ä»¶ï¼Œé‡Œé¢æŒ‡å®šäº†å¦‚ä¸‹å†…å®¹ï¼š</p><pre><code>[user][core]    excludesfile = D:\\Users\\fraser\\Documents\\gitignore_global.txt[user][user]    name = XXXXX    email = XXXXX@qq.com</code></pre><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠè§„åˆ™å®šä¹‰åœ¨<strong>gitignore_global.txt</strong>æ–‡ä»¶ä¸­å°±å¥½. æˆ–è€…æŒ‡å®šå…¶ä»–æ–‡ä»¶ï¼Œ è¿™ä¸ªæ–‡ä»¶æ˜¯windowsè‡ªåŠ¨ç”Ÿæˆçš„</p></li><li><p>é€šè¿‡å‘½ä»¤æŒ‡å®š<strong>.gitignore_global</strong>çš„æ–‡ä»¶</p><pre><code>git config --global core.excludesfile ~/.gitignore_global</code></pre><p>é€šå¸¸.gitignore_globalæ–‡ä»¶ä¹Ÿæ˜¯æ”¾åœ¨ä¸»ç›®å½•ä¸‹.</p></li></ol><h4 id="Explicit-repository-excludes-æ˜ç¡®ä»“åº“å¿½ç•¥çš„æ–‡ä»¶"><a href="#Explicit-repository-excludes-æ˜ç¡®ä»“åº“å¿½ç•¥çš„æ–‡ä»¶" class="headerlink" title="Explicit repository excludes(æ˜ç¡®ä»“åº“å¿½ç•¥çš„æ–‡ä»¶)"></a>Explicit repository excludes(æ˜ç¡®ä»“åº“å¿½ç•¥çš„æ–‡ä»¶)</h4><blockquote><p>å¦‚æœä½ ä¸æƒ³åˆ›å»ºä¸€ä¸ª<strong>.gitignore</strong>æ–‡ä»¶å¹¶ä¸”shareç»™å…¶ä»–äººï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸éœ€è¦æäº¤åˆ°repositoryçš„è§„åˆ™ï¼Œæ¯”å¦‚æˆ‘ä½¿ç”¨IntelliJ IDEAç¼–è¾‘å™¨ï¼Œç¼–è¾‘å™¨ä¼šç”Ÿæˆä¸€äº›ç›¸åº”æ–‡ä»¶ï¼Œä½†æ˜¯åŒäº‹ä½¿ç”¨Eclipseï¼Œä¹Ÿå°±æ˜¯è¯´IntelliJ IDEAç¼–è¾‘å™¨ç”Ÿæˆçš„æ–‡ä»¶è§„åˆ™å¹¶ä¸é€‚ç”¨Eclipseï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨å¦å¤–æ–¹æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µ.</p></blockquote><p>ç”¨ç¼–è¾‘å™¨æ‰“å¼€<strong>.git/info/exclude</strong>ï¼Œå°†è§„åˆ™åŠ è½½è¿™é‡Œå³å¯,è¿™ä¸ªgitæ˜¯ä¸ä¼šæäº¤çš„.</p><h3 id="Ignore-è§„åˆ™è¯´æ˜"><a href="#Ignore-è§„åˆ™è¯´æ˜" class="headerlink" title="Ignore è§„åˆ™è¯´æ˜"></a>Ignore è§„åˆ™è¯´æ˜</h3><p>gitignore - Specifies intentionally untracked files to ignore</p><h4 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h4><p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº†æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¤šç§æ–¹å¼æ¥è®©git ignoreæ–‡ä»¶ï¼ŒåŒæ—¶é…ç½®äº†è¿™äº›æ–‡ä»¶ï¼Œä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ol><li><strong>Level1</strong><br>å‘½ä»¤è¡Œæ‰§è¡Œçš„å‘½ä»¤(å¾ˆå°‘ç”¨)</li><li><strong>Level2</strong><br>ä»“åº“ä¸­çš„<strong>.gitignore</strong> æ–‡ä»¶</li><li><strong>Level3</strong><br>$GIT_DIR/info/exclude</li><li><strong>Level4</strong><br>å…¨å±€çš„é…ç½®ï¼šcore.excludesFile</li></ol><h4 id="PATTERN-FORMATè§„åˆ™è¯´æ˜"><a href="#PATTERN-FORMATè§„åˆ™è¯´æ˜" class="headerlink" title="PATTERN FORMATè§„åˆ™è¯´æ˜"></a>PATTERN FORMATè§„åˆ™è¯´æ˜</h4><ol><li>ç©ºè¡Œï¼Œæ²¡æœ‰ä»»ä½•å®é™…ignoreæ„ä¹‰ï¼Œåªæ˜¯ä½œä¸ºå¯è¯»æ€§çš„åˆ†éš”ç¬¦</li><li>â€œ#â€å·å¼€å¤´ä»£è¡¨è¯¥è¡Œæ˜¯æ³¨é‡Šï¼Œå¦‚æœåœ¨å‰é¢åŠ ä¸Šâ€œ\â€ï¼Œåˆ™è½¬ä¹‰æˆä»¥â€œ#â€å¼€å¤´</li><li>â€œ!â€ æ˜¯é‡æ–°è®©git check in æŸæ–‡ä»¶çš„æ„æ€ï¼Œä½†æ˜¯è¯¥æ–‡ä»¶çš„çˆ¶ç›®å½•è¢«excludeï¼Œre-include è¯¥æ–‡ä»¶Gitæ˜¯åšä¸åˆ°çš„. åŒæ ·å¯ä»¥åŠ ä¸Šâ€&quot;æ¥è½¬ä¹‰ï¼Œ<strong>!important!.txt</strong>å’Œ<strong>!important!.txt</strong></li><li>ä»¥â€œ/â€ç»“æŸï¼Œå¦‚<strong>foo/</strong> ä¼šåŒ¹é…fooä»¥åŠfooä¸‹é¢çš„å­æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ä¸ä¼šåŒ¹é…foo/ä¸‹é¢çš„ä»»ä½•æ–‡ä»¶.</li><li>* æ˜¯é€šé…ç¬¦ï¼Œå¦‚*.cï¼Œä¼šåŒ¹é…æ‰€æœ‰.cä¸ºåç¼€çš„æ–‡ä»¶</li><li>** çš„å«ä¹‰éå¸¸å¤šï¼š</li></ol><ul><li>A leading â€œ**â€ followed by a slash means match in all directories. For example, â€œ<strong>/fooâ€ matches file or directory â€œfooâ€ anywhere, the same as pattern â€œfooâ€. â€œ</strong>/foo/barâ€ matches file or directory â€œbarâ€ anywhere that is directly under directory â€œfooâ€.</li><li>A trailing â€œ/**â€ matches everything inside. For example, â€œabc/**â€ matches all files inside directory â€œabcâ€, relative to the location of the .gitignore file, with infinite depth.</li><li>A slash followed by two consecutive asterisks then a slash matches zero or more directories. For example, â€œa/**/bâ€ matches â€œa/bâ€, â€œa/x/bâ€, â€œa/x/y/bâ€ and so on.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¸‹åˆ é™¤è¿‡é•¿æ–‡ä»¶è·¯å¾„æˆ–è¿‡é•¿æ–‡ä»¶åçš„æ–‡ä»¶</title>
      <link href="//p/delete-long-name-file-in-windows.html"/>
      <url>//p/delete-long-name-file-in-windows.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨Windowsä¸‹ï¼Œåˆ é™¤æ–‡ä»¶æ—¶æŠ¥é”™â€æ–‡ä»¶è·¯å¾„å¤ªé•¿æˆ–è€…æ–‡ä»¶åå¤ªé•¿â€ï¼Œæ— è®ºæ˜¯Shift+Delã€è¿›å…¥å­ç›®å½•ä¸€ç‚¹ç‚¹åˆ é™¤éƒ½ä¸å¯ä»¥ä»¥åŠä½¿ç”¨Windowså†…ç½®å‘½ä»¤éƒ½ä¸å¯ä»¥ï¼Œä½†æ˜¯æˆ‘ç”µè„‘ä¸­è£…æœ‰nodeï¼Œäºæ˜¯å®‰è£…<strong>ã€rimrafã€‘</strong>â€”â€”æ˜¯ä¸“é—¨ç”¨äºåˆ é™¤æ¨¡å—çš„æ’ä»¶</p><blockquote><p>å®˜æ–¹æè¿°ï¼šA deep deletion module for node (like rm -rf)</p></blockquote><pre><code>npm install -g rimraf</code></pre><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><a id="more"></a><ol><li><p>è¿›å…¥projectç›®å½•</p><pre><code>cd project/</code></pre></li><li><p>åˆ é™¤hybrisç›®å½•åŠç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</p><pre><code>rimraf hybris</code></pre></li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œhybrisç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•åŠæ–‡ä»¶å…¨éƒ¨åˆ é™¤å¹²å‡€ï¼Œéå¸¸çˆ½ã€‚</p><p>æ„Ÿè°¢<a href="http://blog.csdn.net/crper/article/details/50458369" target="_blank" rel="noopener">åŸä½œè€…</a>çš„åˆ†äº«</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gité…ç½®å¤šä¸ªè´¦å·ï¼ˆGitLabå’ŒGitHubï¼‰</title>
      <link href="//p/git-multiple-account.html"/>
      <url>//p/git-multiple-account.html</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ç°åœ¨å¥½å¤šå…¬å¸ç”¨GitLabä½œä¸ºé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œè‡ªå·±ä¹Ÿä¼šæœ‰å¼€æºé¡¹ç›®åœ¨GitHubä¸Šï¼ŒæŒ‰ç…§ä»¥å¾€çš„é…ç½®å…¨å±€çš„ç”¨æˆ·è²Œä¼¼åœ¨è¿™ç§æƒ…å½¢ä¸‹å°±æ²¡æœ‰ä½œç”¨äº†ï¼ˆå…¬å¸çš„é¡¹ç›®éœ€è¦ç”¨å…¬å¸é‚®ç®±ï¼Œè‡ªå·±çš„é¡¹ç›®éœ€è¦ç”¨è‡ªå·±çš„é‚®ç®±ï¼‰ï¼Œæ­¤æ—¶å°±è¦åšGitå¤šè´¦æˆ·çš„ç®¡ç†ä¸è®¾ç½®ã€‚</p><h3 id="Gitæ”¯æŒçš„åè®®"><a href="#Gitæ”¯æŒçš„åè®®" class="headerlink" title="Gitæ”¯æŒçš„åè®®"></a>Gitæ”¯æŒçš„åè®®</h3><p>Gitä¸»è¦æ”¯æŒå››ä¸­åè®®ï¼š file:// , git://,  http(s)://, ssh://, è¿™é‡Œä¸»è¦è¯´æ˜ä¸€ä¸‹http(s)å’Œsshåè®®çš„åŒºåˆ«ã€‚</p><h4 id="https-å’Œ-SSH-çš„åŒºåˆ«"><a href="#https-å’Œ-SSH-çš„åŒºåˆ«" class="headerlink" title="https å’Œ SSH çš„åŒºåˆ«"></a>https å’Œ SSH çš„åŒºåˆ«</h4><blockquote><ol><li>å‰è€…å¯ä»¥éšæ„å…‹éš†githubä¸Šçš„é¡¹ç›®ï¼Œè€Œä¸ç®¡æ˜¯è°çš„ï¼›è€Œåè€…åˆ™æ˜¯ä½ å¿…é¡»æ˜¯ä½ è¦å…‹éš†çš„é¡¹ç›®çš„æ‹¥æœ‰è€…æˆ–ç®¡ç†å‘˜ï¼Œä¸”éœ€è¦å…ˆæ·»åŠ  SSH key (è¿™é‡Œå°±æ˜¯æ·»åŠ å…¬é’¥ï¼Œå–å¾—ç®¡ç†å‘˜çš„ä¿¡ä»»)ï¼Œå¦åˆ™æ— æ³•å…‹éš†ã€‚</li><li>https url åœ¨pushçš„æ—¶å€™æ˜¯éœ€è¦éªŒè¯ç”¨æˆ·åå’Œå¯†ç çš„ï¼Œè€Œ SSH åœ¨pushçš„æ—¶å€™ï¼Œæ˜¯ä¸éœ€è¦è¾“å…¥ç”¨æˆ·åçš„ï¼Œå¦‚æœé…ç½®SSH keyçš„æ—¶å€™è®¾ç½®äº†å¯†ç ï¼Œåˆ™éœ€è¦è¾“å…¥å¯†ç çš„ï¼Œå¦åˆ™ç›´æ¥æ˜¯ä¸éœ€è¦è¾“å…¥å¯†ç çš„ã€‚</li></ol></blockquote><a id="more"></a><h3 id="Gitè®¾ç½®å¤šè´¦æˆ·"><a href="#Gitè®¾ç½®å¤šè´¦æˆ·" class="headerlink" title="Gitè®¾ç½®å¤šè´¦æˆ·"></a>Gitè®¾ç½®å¤šè´¦æˆ·</h3><h4 id="æ£€æŸ¥æœ¬æœºæ˜¯å¦å·²æœ‰SSH-Key"><a href="#æ£€æŸ¥æœ¬æœºæ˜¯å¦å·²æœ‰SSH-Key" class="headerlink" title="æ£€æŸ¥æœ¬æœºæ˜¯å¦å·²æœ‰SSH Key"></a>æ£€æŸ¥æœ¬æœºæ˜¯å¦å·²æœ‰SSH Key</h4><pre><code>$ cd ~/.ssh$ ls</code></pre><p>å¦‚æœå­˜åœ¨ä¼šæœ‰ä¸¤ä¸ªç§˜é’¥æ–‡ä»¶id_rsa(ç§é’¥)å’Œid_rsa.pub(å…¬é’¥)ï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦ä¸‹ä¸€æ­¥çš„åˆ›å»ºã€‚</p><h4 id="åˆ›å»ºSSH-Key"><a href="#åˆ›å»ºSSH-Key" class="headerlink" title="åˆ›å»ºSSH Key"></a>åˆ›å»ºSSH Key</h4><p>è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>$ ssh-keygen -t rsa -C &quot;your_email@example.com&quot;</code></pre><p>å‚æ•°è§£æï¼š</p><blockquote><ul><li>-t æŒ‡å®šå¯†é’¥ç±»å‹ï¼Œé»˜è®¤æ˜¯ rsa ï¼Œå¯ä»¥çœç•¥ã€‚</li><li>-C è®¾ç½®æ³¨é‡Šæ–‡å­—ï¼Œæ¯”å¦‚é‚®ç®±ã€‚</li><li>-f æŒ‡å®šå¯†é’¥æ–‡ä»¶å­˜å‚¨æ–‡ä»¶åã€‚</li></ul></blockquote><p>ä»¥ä¸Šä»£ç çœç•¥äº† -f å‚æ•°ï¼Œå› æ­¤ï¼Œè¿è¡Œä¸Šé¢é‚£æ¡å‘½ä»¤åä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªæ–‡ä»¶åï¼Œç”¨äºä¿å­˜åˆšæ‰ç”Ÿæˆçš„ SSH key ä»£ç ï¼Œå¦‚ï¼š</p><pre><code>Generating public/private rsa key pair.# Enter file in which to save the key (/c/Users/you/.ssh/id_rsa): [Press enter]</code></pre><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸è¾“å…¥æ–‡ä»¶åï¼Œç›´æ¥è½¦ï¼Œä½¿ç”¨é»˜è®¤æ–‡ä»¶åï¼ˆæ¨èï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šç”Ÿæˆ id_rsa å’Œ id_rsa.pub ä¸¤ä¸ªç§˜é’¥æ–‡ä»¶ã€‚</p><p>æ¥ç€åˆä¼šæç¤ºä½ è¾“å…¥ä¸¤æ¬¡å¯†ç ï¼ˆè¯¥å¯†ç æ˜¯ä½ pushæ–‡ä»¶çš„æ—¶å€™è¦è¾“å…¥çš„å¯†ç ï¼Œè€Œä¸æ˜¯githubç®¡ç†è€…çš„å¯†ç ï¼‰ï¼Œè¿™æ ·åˆ«äººç”¨ä½ çš„æœºå™¨æ²¡æœ‰å¯†ç æ˜¯ä¸å¯èƒ½éšä¾¿pushä»£ç çš„ï¼Œä¸€ç§å®‰å…¨æ€§çš„ä½“ç°ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸è¾“å…¥å¯†ç ï¼Œç›´æ¥æŒ‰å›è½¦ã€‚é‚£ä¹ˆpushçš„æ—¶å€™å°±ä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œç›´æ¥æäº¤åˆ°githubä¸Šäº†ã€‚</p><pre><code>Enter passphrase (empty for no passphrase):# Enter same passphrase again:</code></pre><p>åœ¨æ­¤æ¡ˆä¾‹ä¸­ï¼Œå°±éœ€è¦è¾“å…¥ä¸¤ä¸ªemailæ¥åˆ›å»ºä¸ªç›¸åº”çš„SSH Key:</p><pre><code>$ ssh-keygen -t rsa -C &quot;personal@example.com&quot; (ä¸ªäººé‚®ç®±)$ ssh-keygen -t rsa -C &quot;company@example.com&quot; (å…¬å¸é‚®ç®±)</code></pre><p>æ­¤æ—¶åœ¨.ssh ç›®å½•ä¸‹åº”è¯¥ä¼šæœ‰ä¸‹é¢å››ä¸ªæ–‡ä»¶ï¼š</p><pre><code>id_rsa  id_rsa.pub  id_rsa_company  id_rsa_company.pub</code></pre><p>å°†å…¬é’¥id_rsa.pubå’Œid_rsa_company.pub åˆ†åˆ«æ·»åŠ åˆ°GitHubå’ŒGitLabä¸Šï¼Œæ€æ ·æ·»åŠ è¯·è‡ªè¡ŒæŸ¥è¯¢ï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸¤ä¸ªç”¨æˆ·ï¼ˆå¯ä»¥æ›´å¤šï¼‰ï¼Œæ€æ ·æŒ‡å®šè¦è¿æ¥GitHubè¿˜æ˜¯GitLabå‘¢ï¼Ÿè¿™æ ·å°±éœ€è¦è§£å†³å¤šç”¨æˆ·çš„æƒé™é—®é¢˜ã€‚</p><h4 id="å¤šç”¨æˆ·æƒé™é—®é¢˜"><a href="#å¤šç”¨æˆ·æƒé™é—®é¢˜" class="headerlink" title="å¤šç”¨æˆ·æƒé™é—®é¢˜"></a>å¤šç”¨æˆ·æƒé™é—®é¢˜</h4><p>GitHub/GitLabä½¿ç”¨SSHä¸å®¢æˆ·ç«¯è¿æ¥ã€‚å¦‚æœæ˜¯å•ç”¨æˆ·ï¼ˆAï¼‰ï¼Œç”Ÿæˆå¯†é’¥å¯¹åï¼Œå°†å…¬é’¥ä¿å­˜è‡³ GitHub/GitLabï¼Œæ¯æ¬¡è¿æ¥æ—¶SSHå®¢æˆ·ç«¯å‘é€æœ¬åœ°ç§é’¥ï¼ˆé»˜è®¤~/.ssh/id_rsaï¼‰åˆ°æœåŠ¡ç«¯éªŒè¯ã€‚å•ç”¨æˆ·æƒ…å†µä¸‹ï¼Œè¿æ¥çš„æœåŠ¡å™¨ä¸Šä¿å­˜çš„å…¬é’¥å’Œå‘é€çš„ç§é’¥è‡ªç„¶æ˜¯é…å¯¹çš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯ å¤šç”¨æˆ· ï¼ˆA,Bï¼‰ï¼Œæˆ‘ä»¬åœ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªå¸å·æ—¶ï¼ŒBä¿å­˜çš„æ˜¯è‡ªå·±çš„å…¬é’¥ï¼Œä½†æ˜¯SSHå®¢æˆ·ç«¯ä¾ç„¶å‘é€é»˜è®¤ç§é’¥ï¼Œå³Açš„ç§é’¥ï¼Œé‚£ä¹ˆè¿™ä¸ªéªŒè¯è‡ªç„¶æ— æ³•é€šè¿‡, æ‰€ä»¥éœ€è¦è®©SSHå®¢æˆ·ç«¯å‘ç°Bçš„ç§é’¥ã€‚</p><ol><li><p>æŸ¥çœ‹ç³»ç»ŸSSH Key</p><pre><code>$ ssh-add -l</code></pre><p>å¦‚æœæç¤ºï¼š</p><pre><code>$ Could not open a connection to your authentication agent.</code></pre><p>å¯ä»¥è¾“å…¥å¦‚ä¸‹å‘½ä»¤ç„¶åé‡æ–°è¾“å…¥ï¼š<strong>ssh-add -l</strong></p><pre><code>$ ssh-agent bash</code></pre><blockquote><p><strong>ssh-agent bashå‘½ä»¤è§£é‡Šï¼š</strong><br>ssh-agentæ˜¯ä¸“ä¸ºæ—¢ä»¤äººæ„‰å¿«åˆå®‰å…¨çš„å¤„ç†RSAå’ŒDSAå¯†é’¥è€Œè®¾è®¡çš„ç‰¹æ®Šç¨‹åºï¼Œä¸åŒäºsshï¼Œssh-agentæ˜¯ä¸ªé•¿æ—¶é—´æŒç»­è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œè®¾è®¡å®ƒçš„å”¯ä¸€ç›®çš„å°±æ˜¯å¯¹è§£å¯†çš„ä¸“ç”¨å¯†é’¥è¿›è¡Œ<strong>é«˜é€Ÿç¼“å­˜</strong>ã€‚sshåŒ…å«çš„å†…å»ºæ”¯æŒå…è®¸å®ƒåŒssh-agenté€šä¿¡ï¼Œå…è®¸sshä¸å¿…æ¯æ¬¡æ–°è¿æ¥æ—¶éƒ½æç¤ºæ‚¨è¦å¯†ç æ‰èƒ½è·å–è§£å¯†çš„ä¸“ç”¨å¯†é’¥ã€‚å¯¹äºssh-agentï¼Œæ‚¨åªè¦ä½¿ç”¨ssh-addæŠŠä¸“ç”¨å¯†é’¥æ·»åŠ åˆ°ssh-agentçš„é«˜é€Ÿç¼“å­˜ä¸­ã€‚è¿™æ˜¯ä¸ªä¸€æ¬¡æ€§è¿‡ç¨‹ï¼›ç”¨è¿‡ssh-addä¹‹åï¼Œsshå°†ä»ssh-agentè·å–æ‚¨çš„ä¸“ç”¨å¯†é’¥ï¼Œè€Œä¸ä¼šæç¤ºè¦å¯†ç çŸ­è¯­æ¥çƒ¦æ‚¨äº†ã€‚<br>å¦‚æœå‡ºç°å¦‚ä¸‹æç¤ºä¿¡æ¯è¯´æ˜æ²¡æœ‰SSH Keyåœ¨ä»£ç†ä¸­</p></blockquote><pre><code>$ The agent has no identities.</code></pre><p>ä¸‹é¢å¯ä»¥æ‰‹åŠ¨åŠ å…¥SSH Key åˆ°ä»£ç†ä¸­ï¼š</p><pre><code>$ ssh-add ~/.ssh/id_rsa_company</code></pre><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤remove SSH Key</p><pre><code>$ ssh-add -D</code></pre></li><li><p>é…ç½®config è·¯ç”±æ–‡ä»¶<br>configæ–‡ä»¶å³ç»‘å®šç§é’¥å’Œè¿œç¨‹æœåŠ¡å™¨çš„å…³ç³»ï¼Œä»¥æˆ‘çš„configæ–‡ä»¶ä¸ºä¾‹ï¼š</p><pre><code># è¯¥æ–‡ä»¶ç”¨äºé…ç½®ç§é’¥å¯¹åº”çš„æœåŠ¡å™¨# é»˜è®¤è‡ªå·±GitHubçš„é…ç½®Host github HostName github.com User FraserYu PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa# å…¬å¸æ‰€ç”¨GitLabçš„é…ç½®Host gitlab HostName gitlab.com #(å¯ä»¥æ˜¯åŸŸå/IPåœ°å€) User Fraser PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa_company         </code></pre></li><li><p>æµ‹è¯•<br>è¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒGitLabå’ŒGitHubçš„æµ‹è¯•(æ³¨æ„å‘½ä»¤ä¸­ç”¨äº†Hostçš„åˆ«å)ï¼š</p><pre><code>$ ssh -T git@github$ ssh -T git@gitlab$ git clone git@github:username/project.git</code></pre></li><li><p>ç”¨æˆ·åé‚®ç®±é…ç½®<br>Gitå…¨å±€é…ç½®å’Œå•ä¸ªä»“åº“çš„ç”¨æˆ·åé‚®ç®±é…ç½®ï¼Œå­¦ä¹ gitçš„æ—¶å€™, å¤§å®¶åˆšå¼€å§‹ä½¿ç”¨ä¹‹å‰éƒ½é…ç½®äº†ä¸€ä¸ªå…¨å±€çš„ç”¨æˆ·åå’Œé‚®ç®±</p><pre><code>$ git config --global user.name &quot;github&apos;s Name&quot;$ git config --global user.email &quot;github@xx.com&quot;$ git config --list</code></pre><p>å¦‚æœä½ å…¬å¸çš„é¡¹ç›®æ˜¯æ”¾åœ¨è‡ªå»ºçš„gitlabä¸Šé¢, å¦‚æœä½ ä¸è¿›è¡Œé…ç½®ç”¨æˆ·åå’Œé‚®ç®±çš„è¯, åˆ™ä¼šä½¿ç”¨å…¨å±€çš„, è¿™ä¸ªæ—¶å€™æ˜¯é”™è¯¯çš„, æ­£ç¡®çš„åšæ³•æ˜¯é’ˆå¯¹å…¬å¸çš„é¡¹ç›®, åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿›è¡Œå•ç‹¬é…ç½®</p><pre><code>$ git config user.name &quot;gitlab&apos;s Name&quot;$ git config user.email &quot;gitlab@xx.com&quot;$ git config --list</code></pre><p>git config â€“listæŸ¥çœ‹å½“å‰é…ç½®, åœ¨å½“å‰é¡¹ç›®ä¸‹é¢æŸ¥çœ‹çš„é…ç½®æ˜¯å…¨å±€é…ç½®+å½“å‰é¡¹ç›®çš„é…ç½®, ä½¿ç”¨çš„æ—¶å€™ä¼šä¼˜å…ˆä½¿ç”¨å½“å‰é¡¹ç›®çš„é…ç½®</p></li><li><p>é™¤äº†é»˜è®¤çš„id_rsaæ˜¯è¢«gité»˜è®¤è¯»å–ï¼Œæˆ‘ä»¬æ¯æ¬¡æ‰“å¼€ç»ˆç«¯éƒ½éœ€è¦æ‰§è¡Œ <strong>ssh-add ï½/.ssh/id_rsa_company</strong>ï¼Œ è¿™æ ·ååˆ†éº»çƒ¦ï¼Œä»¥MacOsä¸ºğŸŒ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ·»åŠ åˆ° KeyChain Accessï¼Œ æ‰§è¡Œå‘½ä»¤ <strong>ssh-add -K [path/to/your/ssh-key]</strong>ï¼Œ  å¦‚ï¼šssh-add -K ï½/.ssh/id_rsa_company å³å¯</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chromeä¿å­˜ç½‘é¡µä¸ºè„±æœºæ–‡ä»¶</title>
      <link href="//p/chrome-save-offline-file.html"/>
      <url>//p/chrome-save-offline-file.html</url>
      
        <content type="html"><![CDATA[<h2 id="Chrome-æµè§ˆå™¨ä¿å­˜ç½‘é¡µä¸ºè„±æœºæ–‡ä»¶"><a href="#Chrome-æµè§ˆå™¨ä¿å­˜ç½‘é¡µä¸ºè„±æœºæ–‡ä»¶" class="headerlink" title="Chrome æµè§ˆå™¨ä¿å­˜ç½‘é¡µä¸ºè„±æœºæ–‡ä»¶"></a>Chrome æµè§ˆå™¨ä¿å­˜ç½‘é¡µä¸ºè„±æœºæ–‡ä»¶</h2><p>æˆ‘ä»¬ç»å¸¸éœ€è¦å°†ä¸€äº›ç½‘é¡µä¿å­˜ä¸ºè„±æœºæ–‡ä»¶ï¼Œè¿™æ ·å³ä¾¿æ²¡æœ‰ç½‘ç»œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ­£å¸¸çš„æµè§ˆï¼ŒIEæµè§ˆå™¨å°†ç½‘é¡µå¦å­˜ä¸ºåœ¨é€‰æ‹©æ–‡ä»¶ç±»å‹çš„åœ°æ–¹ä¼šæœ‰é€‰æ‹©*.mht, å¯æ˜¯Chrome å´æ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œæ¥ä¸‹æ¥æ•™å¤§å®¶å¦‚ä½•é€šè¿‡Chromeæ¥ä¿å­˜ç½‘é¡µä¸ºmhtæ–‡ä»¶</p><ol><li><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ <strong>chrome://flags/</strong></p></li><li><p>é€šè¿‡å…³é”®å­—æœç´¢<strong>save</strong> æˆ– <strong>å¦å­˜ä¸º</strong>å¦‚ä¸‹å›¾ï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/chrome_mht.png" alt="mht"></p></li><li><p>ç‚¹å‡»<strong>Enable</strong>æˆ–<strong>ä½¿ç”¨</strong>ï¼Œé‡æ–°å¯åŠ¨æµè§ˆå™¨</p></li><li><p>é¼ æ ‡å³é”®å¦å­˜ä¸ºé€‰æ‹©ç±»å‹å’Œä¿å­˜è·¯å¾„å¦‚ä¸‹å›¾ï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/chrome_save.png" alt="save"></p></li><li><p>ç­‰å¾…ä¸‹è½½å®Œæˆå³å¯</p></li></ol><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git ä½¿ç”¨æµç¨‹</title>
      <link href="//p/git-workflow.html"/>
      <url>//p/git-workflow.html</url>
      
        <content type="html"><![CDATA[<h3 id="Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥"><a href="#Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥" class="headerlink" title="Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥"></a>Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥</h3><p>é¦–å…ˆshareä¸€ä¸‹Ruanè€å¸ˆçš„åšå®¢å†…å®¹ï¼š<a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="noopener">Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥</a> ï¼Œè¯»è¿‡ä¹‹åï¼Œç†è§£Masterã€Developã€ä¸´æ—¶åˆ†æ”¯ï¼ˆfeatureã€releaseã€fixbugï¼‰çš„åŸºæœ¬æ„æ€ï¼Œè¿™é‡Œå†™çš„å°±æ›´åŠ é€å½»äº†ï¼š<a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">A successful Git branching model</a>ï¼Œ é¡¹ç›®ä¸­å¦‚æœæŒ‰ç…§è¿™ç§ä¸¥æ ¼è§„èŒƒæ¥æ‰§è¡Œç‰ˆæœ¬çš„ç®¡ç†ï¼Œåº”è¯¥æ˜¯ä¼šå–å¾—æˆåŠŸçš„ç»“æœ.  ä»”ç»†é˜…è¯»è¿™ä¸ªworkflowæ·±åˆ»çš„ä½“ä¼šï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/git_workflow.png" alt="Git Branch Model"></p><h3 id="Git-ä½¿ç”¨å®æˆ˜æƒ…æ™¯è¯´æ˜"><a href="#Git-ä½¿ç”¨å®æˆ˜æƒ…æ™¯è¯´æ˜" class="headerlink" title="Git ä½¿ç”¨å®æˆ˜æƒ…æ™¯è¯´æ˜"></a>Git ä½¿ç”¨å®æˆ˜æƒ…æ™¯è¯´æ˜</h3><p>ä¸ºä»€ä¹ˆä¸ç½—åˆ—å‡ºæ¥Gitçš„å‘½ä»¤åˆ—è¡¨ï¼Œå› ä¸ºç½—åˆ—åœ¨è¿™è²Œä¼¼ä¹Ÿå¾ˆéš¾æ·±åˆ»ç†è§£å‘½ä»¤çš„å«ä¹‰ï¼Œä¹Ÿä¸çŸ¥é“æ€æ ·å»ä½¿ç”¨ï¼Œæ‰€ä»¥åšä¸€äº›æƒ…æ™¯æ¡ˆä¾‹æ¥è¯´æ˜gitå‘½ä»¤</p><a id="more"></a><h4 id="è·Ÿè¸ªGitHubä¸Šå¼€æºé¡¹ç›®"><a href="#è·Ÿè¸ªGitHubä¸Šå¼€æºé¡¹ç›®" class="headerlink" title="è·Ÿè¸ªGitHubä¸Šå¼€æºé¡¹ç›®"></a>è·Ÿè¸ªGitHubä¸Šå¼€æºé¡¹ç›®</h4><p>å½“åœ¨Githubä¸­é¨æ¸¸ä¸€é˜µï¼Œå‘ç°äº†å–œæ¬¢çš„é¡¹ç›®æƒ³åœ¨æœ¬åœ°ç ”ç©¶ï¼ŒåŒæ—¶è¿˜æƒ³è·Ÿè¸ªäº†è§£æºé¡¹ç›®çš„æœ€æ–°åŠ¨æ€ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹çš„ä¸€äº›æ­¥éª¤ï¼š</p><ol><li><p>Fork (åˆ†å‰)<br>åœ¨è·Ÿè¸ªçš„å¼€æºé¡¹ç›®ä¸Šç‚¹å‡»Forkï¼Œä¼šå‘ç°åˆ†å‰åˆ°ä½ çš„Repoä¸­ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”ç”¨å¦‚ä¸‹å‘½ä»¤å°†é¡¹ç›®cloneåˆ°local Repo, httpsæˆ–sshä¸¤ç§éƒ½å¯ä»¥</p><pre><code>$ git clone git@github.com:YOUR-USERNAME/REPO-NAME$ git clone https://github.com/YOUR-USERNAME/REPO-NAME</code></pre><p>æ­¤æ—¶å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹remoteçš„ç‰ˆæœ¬ï¼Œå³ä½ è‡ªå·±çš„remote Repoçš„ä¿¡æ¯</p><pre><code>$ git remote -v</code></pre><p>å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><pre><code>https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)</code></pre></li><li><p>æ·»åŠ  fork æºä»“åº“çš„åœ°å€<br>æˆ‘ä»¬çš„ç›®çš„ä¸ä½†æ˜¯è¦åœ¨æœ¬åœ°ä¿®æ”¹è‡ªå·±æƒ³è¦çš„ä»£ç ï¼Œè¿˜è¦äº†è§£æœ€æ–°çš„æºçš„åŠ¨æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>$ git remote add originProject https://github.com/ORIGINAL_OWNER/ORIGINAL_REPO.git</code></pre><p>åŒæ ·åº”ç”¨ <strong>git remote -v</strong>å‘½ä»¤ä¼šçš„åˆ°å¦‚ä¸‹ç»“æœï¼š</p><pre><code>origin https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)origin https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)originProject https://github.com/ORIGINAL_OWNER/ORIGINAL_REPO.git(fetch)originProject https://github.com/ORIGINAL_OWNER/ORIGINAL_REPO.git (push)</code></pre><p>æ­¤å¤„çš„originProject å¯ä»¥æ˜¯ä½ å–å¾—ä»»æ„çš„åå­—, å°±æ˜¯ç»™è¿œç¨‹ä¸»æœºå–ä¸ªåå­—</p><pre><code>$ git remote add &lt;ä¸»æœºå&gt; &lt;ç½‘å€&gt;</code></pre></li><li><p>Fetchæº<br>å½“ä½ è¦è·Ÿè¸ªæºåŠ¨æ€ï¼Œå°±è¦fetchä¸€ä»½åˆ°æœ¬åœ°Repo</p><pre><code>$ git fetch originProject</code></pre><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹åˆ†æ”¯ï¼š</p><pre><code>$ git branch</code></pre></li><li><p>åˆå¹¶æºåˆ°æœ¬åœ°<br>é¦–å…ˆåˆ‡æ¢åˆ°æœ¬åœ°masteråˆ†æ”¯</p><pre><code>$ git checkout master</code></pre><p>ä¹‹åmergeæºåˆ°æœ¬åœ°master</p><pre><code>$ git merge originProject/master</code></pre><p>è¿™ä¸ªåœ°æ–¹å¯èƒ½ä¼šæœ‰å†²çªï¼Œéœ€è¦è§£å†³å†²çªå®Œæˆmergeï¼Œæœ€åå°†mergeå¥½çš„ä»£ç pushåˆ°è‡ªå·±remote</p><pre><code>git push origin master</code></pre></li></ol><h4 id="æœ¬åœ°ä¸Šä¼ ä»£ç åˆ°GitHub"><a href="#æœ¬åœ°ä¸Šä¼ ä»£ç åˆ°GitHub" class="headerlink" title="æœ¬åœ°ä¸Šä¼ ä»£ç åˆ°GitHub"></a>æœ¬åœ°ä¸Šä¼ ä»£ç åˆ°GitHub</h4><p>é€šå¸¸ä¼šåœ¨æœ¬åœ°å†™ç‚¹ç¨‹åºï¼Œç„¶åæ”¾åˆ°githubæ¥ç®¡ç†ï¼Œæ­¤æ—¶æˆ‘ä»¬æ€æ ·æŠŠæœ¬åœ°çš„ä»£ç ä¸Šä¼ åˆ°githubå‘¢</p><ol><li><p>gitåˆå§‹åŒ–<br>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆå§‹åŒ–</p><pre><code>$ git init</code></pre><p>ä½ çš„é¡¹ç›®codeåº”è¯¥åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­</p></li><li><p>æ·»åŠ é¡¹ç›®æ–‡ä»¶åˆ°æœ¬åœ°Repo<br>æˆ‘ä»¬éœ€è¦å°†æœ¬åœ°çš„codeæ·»åŠ åˆ°æœ¬åœ°çš„Repoä¸­ï¼Œadd . ä»£è¡¨æ·»åŠ å…¨éƒ¨æ–‡ä»¶</p><pre><code>$ git add .</code></pre></li><li><p>æäº¤æ–‡ä»¶åˆ°æœ¬åœ°Repo<br>æ·»åŠ æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦commitæ–‡ä»¶åˆ°æœ¬åœ°Repoï¼Œå¹¶ä¸”æ ‡è®°æ³¨é‡Š</p><pre><code>$ git commit -m &quot;æ³¨é‡Šè¯­å¥&quot;</code></pre></li><li><p>åœ¨githubä¸Šæ–°å»ºRepo<br>åœ¨githubä¸Šæ–°å»ºRepoï¼Œå¹¶ä¸”copy Repoçš„httpsæˆ–ssh URL</p><pre><code>$ git remote add origin https://github.com/YOUR_USERNAME/YOUR_FORK.git</code></pre></li><li><p>Pullè¿œç¨‹ä»£ç <br>åœ¨pushä¹‹å‰æˆ‘ä»¬éœ€è¦pull remote ä»£ç </p><pre><code>$ git pull origin master</code></pre></li><li><p>Pushæœ¬åœ°ä»£ç åˆ°remote<br>æˆ‘ä»¬å·²ç»æäº¤ä»£ç åˆ°æœ¬åœ°Repoï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦pushåˆ°remote</p><pre><code>$ git push -u origin master</code></pre></li></ol><h4 id="æ›´æ”¹è¿œç¨‹URL"><a href="#æ›´æ”¹è¿œç¨‹URL" class="headerlink" title="æ›´æ”¹è¿œç¨‹URL"></a>æ›´æ”¹è¿œç¨‹URL</h4><p>åœ¨å®é™…åœºæ™¯ä¸­æˆ‘ä»¬ä¼šé‡åˆ°GitæœåŠ¡å™¨è¿ç§»äº†ï¼Œè¿™æ ·æˆ‘ä»¬.gitä»“åº“å­˜å‚¨çš„remote repositoryçš„åœ°å€ä¿¡æ¯å°±æ˜¯é”™è¯¯çš„ï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹è¿™ä¸ªURL. è¯·å‚è€ƒGit Helpä¹‹<a href="https://help.github.com/articles/changing-a-remote-s-url/" target="_blank" rel="noopener">Changing a remoteâ€™s URL</a></p><p>å¦‚æœä½ è§‰å¾—ä½ åˆå¹¶åçš„çŠ¶æ€æ˜¯ä¸€å›¢ä¹±éº»ï¼Œæƒ³æŠŠå½“å‰çš„ä¿®æ”¹éƒ½æ”¾å¼ƒï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å›åˆ°åˆå¹¶ä¹‹å‰çš„çŠ¶æ€ï¼š</p><pre><code>$ git reset --hard HEAD</code></pre><p>æˆ–è€…ä½ å·²ç»æŠŠåˆå¹¶åçš„ä»£ç æäº¤ï¼Œä½†è¿˜æ˜¯æƒ³æŠŠå®ƒä»¬æ’’é”€ï¼š</p><pre><code>$ git reset --hard ORIG_HEAD</code></pre><p>ä½†æ˜¯åˆšæ‰è¿™æ¡å‘½ä»¤åœ¨æŸäº›æƒ…å†µä¼šå¾ˆå±é™©ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ªå·²ç»è¢«å¦ä¸€ä¸ªåˆ†æ”¯åˆå¹¶çš„åˆ†æ”¯ç»™åˆ äº†ï¼Œé‚£ä¹ˆ ä»¥ååœ¨åˆå¹¶ç›¸å…³çš„åˆ†æ”¯æ—¶ä¼šå‡ºé”™ã€‚</p><h3 id="Gitè¿œç¨‹æ“ä½œå‘½ä»¤è¯¦è§£"><a href="#Gitè¿œç¨‹æ“ä½œå‘½ä»¤è¯¦è§£" class="headerlink" title="Gitè¿œç¨‹æ“ä½œå‘½ä»¤è¯¦è§£"></a>Gitè¿œç¨‹æ“ä½œå‘½ä»¤è¯¦è§£</h3><p>æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨è¿™é‡Œå¼•ç”¨ä¸€ä¸‹Ruanè€å¸ˆçš„åšå®¢å†…å®¹ï¼Œæ…¢æ…¢ç†è§£ä¸ä½“ä¼š <a href="http://www.ruanyifeng.com/blog/2014/06/git_remote.html" target="_blank" rel="noopener">Gitè¿œç¨‹æ“ä½œè¯¦è§£</a> å’Œ <a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html?utm_source=tool.lu" target="_blank" rel="noopener">Gitå¸¸ç”¨å‘½ä»¤æ¸…å•</a>, åŒæ—¶è¿˜è¦æŠŠå»–é›ªå³°è€å¸ˆçš„Gitæ•™ç¨‹ç®€ä»‹ï¼š<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="noopener">Gitè¿œç¨‹æ“ä½œè¯¦è§£</a>æ”¾åœ¨è¿™é‡Œï¼Œéƒ½æ˜¯æœ€å¥½çš„å­¦ä¹ èµ„æ–™ï¼Œåç»­æˆ‘è¿˜ä¼šç»§ç»­è¡¥å……. æœ‰ç–‘é—®å¯ä»¥ç•™è¨€ï¼ŒåŠ å…¥gitå®ç”¨æƒ…æ™¯ä¸­.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WeChatFeedback</title>
      <link href="//p/english-common-model.html"/>
      <url>//p/english-common-model.html</url>
      
        <content type="html"><![CDATA[<p><strong>éƒ‘é‡å£°æ˜ï¼š æœªç»åŒæ„ï¼Œä¸å¾—è½¬è½½</strong></p><h2 id="å¾®ä¿¡ä½œä¸šåé¦ˆ2016"><a href="#å¾®ä¿¡ä½œä¸šåé¦ˆ2016" class="headerlink" title="å¾®ä¿¡ä½œä¸šåé¦ˆ2016"></a>å¾®ä¿¡ä½œä¸šåé¦ˆ2016</h2><h3 id="ä¸‡èƒ½å¥å‹"><a href="#ä¸‡èƒ½å¥å‹" class="headerlink" title="ä¸‡èƒ½å¥å‹"></a>ä¸‡èƒ½å¥å‹</h3><h4 id="ä¸‡èƒ½å¥å‹ç¬¬ä¸€å‘-got-to-get"><a href="#ä¸‡èƒ½å¥å‹ç¬¬ä¸€å‘-got-to-get" class="headerlink" title="ä¸‡èƒ½å¥å‹ç¬¬ä¸€å‘[got to get]"></a>ä¸‡èƒ½å¥å‹ç¬¬ä¸€å‘[got to get]</h4><p>å…ˆé™„ä¸Šä¸¤å¼ å›¾ç‰‡æ¥åšä¸€ä¸ªæ€»è§ˆï¼Œæ¥ä¸‹æ¥é€ä¸ªä¸¾ä¾‹è¯´æ˜ï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/wechat_1.1.jpg" alt="ç¬¬ä¸€å¼ "><br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/wechat_1.2.jpg" alt="ç¬¬äºŒå¼ "></p><a id="more"></a><p>ä¸‡èƒ½å¥å‹å‰é¢æ­é…ï¼š</p><table><thead><tr><th align="left">åºå·</th><th align="left">æ­é…</th><th align="left">çœç•¥â€™veæˆ–â€™s</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Iâ€™ve</td><td align="left">å¯ä»¥</td></tr><tr><td align="left">2</td><td align="left">Weâ€™ve</td><td align="left">å¯ä»¥</td></tr><tr><td align="left">3</td><td align="left">Youâ€™ve</td><td align="left">å¯ä»¥</td></tr><tr><td align="left">4</td><td align="left">Theyâ€™ve</td><td align="left">å¯ä»¥</td></tr><tr><td align="left">5</td><td align="left">Heâ€™s</td><td align="left">ä¸å¯ä»¥</td></tr><tr><td align="left">6</td><td align="left">Sheâ€™s</td><td align="left">ä¸å¯ä»¥</td></tr></tbody></table><p>ä¸‡èƒ½å¥å‹ä¸¾ä¾‹ï¼š</p><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/wechat_1.3.png" alt="ç¬¬ä¸‰å¼ "></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get going</td><td align="left">æˆ‘å¾—èµ°äº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I got to get used to it</td><td align="left">æˆ‘å¾—é€‚åº”æŸç‰©</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I got to get used to this bed</td><td align="left">æˆ‘å¾—é€‚åº”è¿™å¼ åºŠ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got to get Used to the new computer</td><td align="left">æˆ‘å¾—é€‚åº”è¿™ä¸ªæ–°ç”µè„‘</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get used to waking up early</td><td align="left">æˆ‘å¾—é€‚åº”æ—©èµ·</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I got to get Used to eating less</td><td align="left">æˆ‘å¾—é€‚åº”å°‘åƒç‚¹</td><td align="left"></td></tr><tr><td align="left">7</td><td align="left">I got to get Used to drinking tea</td><td align="left">æˆ‘å¾—é€‚åº”å–èŒ¶</td><td align="left"></td></tr></tbody></table><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/wechat_1.4.png" alt="ç¬¬å››å¼ "></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get a life</td><td align="left">æˆ‘å¾—å¾—åˆ°ä¸€ä¸ªç”Ÿæ´»ï¼ˆæƒ³è±¡ï¼šå¤©å¤©å®…åœ¨å®¶é‡Œï¼Œçªç„¶é†’æ‚Ÿå¯¹è‡ªå·±è¯´è¿™å¥è¯ï¼‰</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I got to get a nicer house</td><td align="left">æˆ‘å¾—å¾—åˆ°/æœ‰/ä¹°ä¸€ä¸ªæ›´å¥½çš„æˆ¿å­</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I got to get a girl friend</td><td align="left">æˆ‘å¾—æœ‰ä¸ªå¥³æœ‹å‹</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got to get an invite</td><td align="left">æˆ‘å¾—å¾—åˆ°/æ”¶åˆ°ä¸€ä¸ªé‚€è¯·</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get an extra plate</td><td align="left">æˆ‘å¾—è¦ä¸€ä¸ªé¢å¤–çš„ç›˜å­</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I got to get an apartment</td><td align="left">æˆ‘å¾—æœ‰/ä¹°/å¾—åˆ°ä¸ªå…¬å¯“</td><td align="left"></td></tr><tr><td align="left">7</td><td align="left">I got to get a coffee</td><td align="left">æˆ‘å¾—æ¥æ¯å’–å•¡</td><td align="left"></td></tr></tbody></table><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/wechat_1.5.png" alt="ç¬¬äº”å¼ "></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get serious</td><td align="left">æˆ‘å¾—å˜å¾—ä¸¥è‚ƒç‚¹</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I got to get stronger</td><td align="left">æˆ‘å¾—å˜å¾—æ›´å¼ºå£®</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I got to get taller</td><td align="left">æˆ‘å¾—æ›´é«˜ä¸€ç‚¹</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got to get healthier</td><td align="left">æˆ‘å¾—æ›´å¥åº·ä¸€äº›</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get better at sth</td><td align="left">æˆ‘å¾—æ›´æ“…é•¿æŸäº‹</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I got to get better at doing sth</td><td align="left">æˆ‘å¾—æ›´æ“…é•¿åšæŸäº‹</td><td align="left"></td></tr><tr><td align="left">7</td><td align="left">I got to get faster at sth</td><td align="left">æˆ‘å¾—æ›´å¿«é€ŸäºæŸäº‹</td><td align="left"></td></tr><tr><td align="left">8</td><td align="left">I got to get faster at doing sth</td><td align="left">æˆ‘å¾—æ›´å¿«é€ŸäºåšæŸäº‹</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get more [sth] å¾—å¾—åˆ°æ›´å¤š</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get more than that</td><td align="left">æˆ‘å¾—å¾—åˆ°æ›´å¤šï¼Œæ¯”æ‰‹é‡Œæ‹¥æœ‰çš„æ›´å¤š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I got to get more clothes</td><td align="left">æˆ‘å¾—æœ‰/å¾—åˆ°æ›´å¤šè¡£æœ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I got to get more money</td><td align="left">æˆ‘å¾—å¾—åˆ°/æ‹¥æœ‰æ›´å¤šé’±</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get started [doing sth] å¼€å§‹åšæŸäº‹ï¼Œå¤šæŒ‡éœ€è¦ä¸€æ®µæ—¶é—´è¿‡ç¨‹çš„äº‹æƒ…ï¼Œä¸æ˜¯ä¸€ç¬é—´å°±èƒ½æå®šçš„</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get started writing my report</td><td align="left">æˆ‘å¾—å¼€å§‹å†™æˆ‘çš„æŠ¥å‘Š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I got to get started working on my project</td><td align="left">æˆ‘å¾—å¼€å§‹åšæˆ‘çš„é¡¹ç›®</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I got to get started planning my wedding</td><td align="left">æˆ‘å¾—å¼€å§‹ç­¹åˆ’å©šç¤¼</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got to get started moving these boxes</td><td align="left">æˆ‘å¾—å¼€å§‹æ¬è¿™äº›ç›’å­äº†</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get started cooking dinner</td><td align="left">æˆ‘å¾—å¼€å§‹åšé¥­äº†</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get [adv]å‰¯è¯/[prep]ä»‹è¯</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get up</td><td align="left">æˆ‘å¾—èµ·åºŠäº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">You got to get up early tomorrow</td><td align="left">ä½ æ˜æ—©å¾—æ—©èµ·</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I got to get started planning my wedding</td><td align="left">æˆ‘å¾—å¼€å§‹ç­¹åˆ’å©šç¤¼</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got to get started moving these boxes</td><td align="left">æˆ‘å¾—å¼€å§‹æ¬è¿™äº›ç›’å­äº†</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get started cooking dinner</td><td align="left">æˆ‘å¾—å¼€å§‹åšé¥­äº†</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get backâ€¦æŸäººå¾—å›å»ã€å›å®¶</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get back</td><td align="left">æˆ‘å¾—å›å®¶ ï¼ˆæœ‰æ—¶å€™è¯´å›å®¶ä¸ä¸€å®šéè¦æœ‰homeï¼‰</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">You got to get back to work[sth]</td><td align="left">ä½ å¾—å›å»å·¥ä½œäº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Sheâ€™s got to get back on that horse</td><td align="left">å¥¹å¾—å†åšæŒä¸€æ¬¡ï¼ˆä¿šè¯­ï¼Œä¹‹å‰ä»é©¬ä¸Šæ‰ä¸‹æ¥ä¸€æ¬¡ï¼Œå†æ¬¡å›åˆ°é©¬ä¸Šï¼‰</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Heâ€™s got to get back soon.</td><td align="left">ä»–å¾—é©¬ä¸Šå›æ¥</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get back in the game</td><td align="left">æˆ‘å¾—å›åˆ°è€è¡Œå½“ï¼ˆçˆ±å¥½ï¼Œå·¥ä½œï¼Œå–œå¥½) ç®—æ˜¯é‡æ“æ—§ä¸š</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get thereâ€¦æŸäººå¾—åˆ°è¾¾æŸå¤„</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get there at 4</td><td align="left">æˆ‘å¾—4ç‚¹åˆ°é‚£</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">You got to get there on time</td><td align="left">ä½ å¾—å›å»å·¥ä½œäº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Sheâ€™s got to get there in time</td><td align="left">å¥¹å¾—åŠæ—¶åˆ°é‚£</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Heâ€™s got to get there before itâ€™s too late</td><td align="left">ä»–èµ¶ç´§åˆ°é‚£å„¿ï¼Œä¸ç„¶å°±æ™šäº†</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get outâ€¦  æŸäººå¾—å‡ºå»/è·‘èµ°/é¿å…ã€æ‘†è„±</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get out of here</td><td align="left">æˆ‘å¾—ç¦»å¼€è¿™</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Sheâ€™s got to get out of work</td><td align="left">å¥¹å¾—æ‘†è„±å·¥ä½œï¼ˆä¸€èµ·çœ‹ç”µå½±ï¼Œå¥¹å·¥ä½œå¾ˆå¿™ï¼Œè¦æ˜¯æƒ³å»éœ€è¦å…ˆæ‘†è„±å·¥ä½œï¼‰</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Heâ€™s got to get out of this relationship</td><td align="left">ä»–å¾—æ‘†è„±è¿™æ®µå…³ç³»çš„çº ç¼ </td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">You got to get out of bed</td><td align="left">ä½ å¾—ç¦»å¼€åºŠï¼ˆæ»šä¸‹åºŠï¼‰</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get [to smw] / [to the smw] /[smw] æŸäººå¾—å»æŸä¸ªåœ°æ–¹</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get to school</td><td align="left">æˆ‘å¾—å»å­¦æ ¡</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">You got to get to work</td><td align="left">ä½ å¾—å»ä¸Šç­</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Heâ€™s got to get home.</td><td align="left">ä»–å¾—å›å®¶</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">We got to get to the hospital</td><td align="left">æˆ‘ä»¬å¾—å»åŒ»é™¢</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">You got to get to the part where [SVO]ä¸»è°“å®¾</td><td align="left">ä½ å¾—å»æŠŠï¼ˆç”µè§†ï¼Œå‰§é›†ç­‰ï¼‰çœ‹åˆ°å“ªä¸ªæ®µè½ï¼Œå“ªä¸€é›†</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get [Sb][sth] æŸäººå¾—ç»™æŸä¸ªäººé€æŸä¸ªä¸œè¥¿</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get to you a gift</td><td align="left">æˆ‘å¾—ç»™ä½ é€ä¸ªç¤¼ç‰©</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">You got to get him a girlfriend</td><td align="left">ä½ å¾—ç»™ä»–æ‰¾ä¸ªå¥³æœ‹å‹</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">We got to get them a car</td><td align="left">æˆ‘ä»¬å¾—ç»™ä»–å¼„è¾†è½¦</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">We got to get to the hospital</td><td align="left">æˆ‘ä»¬å¾—å»åŒ»é™¢</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">They got to get me a job</td><td align="left">ä»–ä»¬å¾—ç»™æˆ‘æ‰¾ä¸ªå·¥ä½œ</td><td align="left"></td></tr></tbody></table><p><strong>[Sb] got to get [Sb][smw] æŸäººå¾—é€æŸä¸ªäººå»æŸä¸ªåœ°æ–¹</strong></p><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got to get you to school</td><td align="left">æˆ‘å¾—é€ä½ å»å­¦æ ¡</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">You got to get me home</td><td align="left">ä½ å¾—é€æˆ‘å›å®¶</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">We got to get them a car</td><td align="left">æˆ‘ä»¬å¾—ç»™ä»–å¼„è¾†è½¦</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got to get you out of here.</td><td align="left">æˆ‘å¾—è®©ä½ ç¦»å¼€è¿™å„¿</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got to get this off the wall.</td><td align="left">æˆ‘å¾—æŠŠè¿™ä¸œè¥¿ä»å¢™ä¸Šå¼„ä¸‹æ¥ä½œ</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Sheâ€™s got to get all this stuff into the luggage</td><td align="left">å¥¹å¾—æŠŠæ‰€æœ‰ä¸œè¥¿å¡è¿›è¡Œæç®±</td><td align="left"></td></tr></tbody></table><h3 id="Mar"><a href="#Mar" class="headerlink" title="Mar"></a>Mar</h3><h4 id="Mar-29th"><a href="#Mar-29th" class="headerlink" title="Mar 29th"></a>Mar 29th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I donâ€™t know what to do</td><td align="left">è¿™ä¸ªçœ‹èµ·æ¥ä¹Ÿå¾ˆå¥½</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Give it to him</td><td align="left">æŠŠè¿™ä¸ªç»™ä»–å§</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I made an important decision today</td><td align="left">æˆ‘ä»Šå¤©åšäº†ä¸ªå¾ˆé‡è¦çš„å†³å®š</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I have to leave early last night</td><td align="left">å·®ä¸å¤šæ˜¯æ—¶å€™äº†</td><td align="left"></td></tr></tbody></table><h4 id="Mar-30th"><a href="#Mar-30th" class="headerlink" title="Mar 30th"></a>Mar 30th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">This one looks good too</td><td align="left">è¿™ä¸ªçœ‹èµ·æ¥ä¹Ÿå¾ˆå¥½</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I tried to talk to him</td><td align="left">æˆ‘è¯•ç€æƒ³è·Ÿä»–èŠ(ä½†ä»–ä¸å¬)</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Itâ€™s hard to tell</td><td align="left">è¿™ä¸å¥½è¯´</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Itâ€™s about time</td><td align="left">å·®ä¸å¤šæ˜¯æ—¶å€™äº†</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I canâ€™t tell, can you</td><td align="left">æˆ‘çœ‹ä¸å‡ºæ¥ï¼Œä½ å¯ä»¥å—</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Iâ€™ve decided to move forward with it</td><td align="left">æˆ‘å†³å®šç»§ç»­å‰è¿›</td><td align="left"></td></tr></tbody></table><h4 id="Mar-31st"><a href="#Mar-31st" class="headerlink" title="Mar 31st"></a>Mar 31st</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">What do you mean</td><td align="left">ä½ æƒ³è¡¨è¾¾ä»€ä¹ˆï¼Œä½ ä»€ä¹ˆæ„æ€</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">We could do that</td><td align="left">å½“æœ‰äººæè®®æˆ‘ä»¬ä¸€èµ·åšä¸€ä»¶äº‹æ—¶ï¼Œå¥½å•Šï¼Œæˆ‘ä»¬å¯ä»¥åš.. äº‹</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Donâ€™t let your guard down</td><td align="left">åˆ«æ”¾æ¾è­¦æƒ•</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">It might take a while</td><td align="left">è¿™å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">It wonâ€™t take too long</td><td align="left">ä¸ä¼šèŠ±è´¹å¤ªé•¿æ—¶é—´çš„</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Donâ€™t tell me the answer</td><td align="left">ä¸è¦å‘Šè¯‰æˆ‘ç­”æ¡ˆ</td><td align="left"></td></tr><tr><td align="left">7</td><td align="left">Iâ€™ve decided to move forward with it</td><td align="left">æˆ‘å†³å®šç»§ç»­å‰è¿›</td><td align="left"></td></tr></tbody></table><h3 id="Apr"><a href="#Apr" class="headerlink" title="Apr"></a>Apr</h3><h4 id="Apr-4th"><a href="#Apr-4th" class="headerlink" title="Apr 4th"></a>Apr 4th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Yep, pretty much</td><td align="left">å¯¹ï¼Œå·®ä¸å¤š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Keep pushing, come on</td><td align="left">ç”¨åŠ›æ¨ï¼Œä½¿åŠ²</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I always keep people at distance</td><td align="left">æˆ‘ä¸€ç›´éƒ½è·Ÿåˆ«äººä¿æŒè·ç¦»</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">They have deep pocket</td><td align="left">ä»–ä»¬æœ‰çš„æ˜¯é’±</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I got a backup plan</td><td align="left">æˆ‘å·²ç»ç•™äº†åæ‰‹</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">You guys got to keep pace</td><td align="left">ä½ ä»¬å¾—è·Ÿæˆ‘èŠ‚å¥</td><td align="left"></td></tr></tbody></table><h4 id="Apr-5th"><a href="#Apr-5th" class="headerlink" title="Apr 5th"></a>Apr 5th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Stop being stupid</td><td align="left">åˆ«å‚»äº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I couldnâ€™t help but notice</td><td align="left">æˆ‘æ— æ³•ä¸æ³¨æ„åˆ°</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Weâ€™ll stop by on weekends</td><td align="left">æˆ‘ä»¬å‘¨æœ«å›è¿‡æ¥çš„</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Youâ€™re very upbeat today</td><td align="left">ä½ ä»Šå¤©è¿™æ˜¯å‡ºå¥‡çš„æ´»è·ƒå•Š</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Can you stop being so loud</td><td align="left">ä½ ä¸èƒ½å°ç‚¹å£°å—</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Can you help me</td><td align="left">èƒ½å¸®æˆ‘ä¸€ä¸‹å—</td><td align="left"></td></tr></tbody></table><h4 id="Apr-6th"><a href="#Apr-6th" class="headerlink" title="Apr 6th"></a>Apr 6th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">We need to take a step back</td><td align="left">å’±ä»¬éœ€è¦é€€ä¸€æ­¥</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I have to stop by my place first</td><td align="left">æˆ‘å¾—å…ˆå›å®¶ä¸€è¶Ÿ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I need to go pick up my friend</td><td align="left">æˆ‘è¦å»æ¥æˆ‘çš„æœ‹å‹</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I have to make up for past mistakes</td><td align="left">æˆ‘å¿…é¡»å¼¥è¡¥æˆ‘è¿‡å»çš„é”™è¯¯</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Can you grab me a coke</td><td align="left">èƒ½ç»™æˆ‘å¸¦ä¸ªå¯ä¹å—</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Donâ€™t rub my fact in it</td><td align="left">åˆ«åœ¨ä¼¤å£ä¸Šæ’’ç›</td><td align="left"></td></tr></tbody></table><h4 id="Apr-7th"><a href="#Apr-7th" class="headerlink" title="Apr 7th"></a>Apr 7th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">He didnâ€™t show up for work</td><td align="left">ä»–æ²¡æ¥ä¸Šç­</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">She dressed up for her interview</td><td align="left">å¥¹ä¸ºé¢è¯•æ‰“æ‰®çš„</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">You need to stand up for yourself</td><td align="left">ä½ è¦ç»´æŠ¤ä½ è‡ªå·±</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I got a backup plan</td><td align="left">æˆ‘å·²ç»ç•™äº†åæ‰‹</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Can you stop moping</td><td align="left">åˆ«å†è¿™ä¹ˆæ¶ˆæ²‰äº†å¥½å—</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I bought my son a popup book</td><td align="left">æˆ‘ç»™æˆ‘å„¿å­ä¹°äº†æœ¬ç«‹ä½“æ•…äº‹ä¹¦</td><td align="left"></td></tr></tbody></table><h4 id="Apr-11st"><a href="#Apr-11st" class="headerlink" title="Apr 11st"></a>Apr 11st</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Iâ€™d take christmas alone any day</td><td align="left">æˆ‘å®æ„¿è‡ªå·±è¿‡åœ£è¯èŠ‚</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I take classes on line</td><td align="left">æˆ‘åœ¨ç½‘ä¸Šä¸Šè¯¾</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Why donâ€™t you ask questions</td><td align="left">ä½ æ€ä¹ˆä¸é—®é—®é¢˜</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Iâ€™ll take care of it</td><td align="left">æˆ‘è§‰å¾—ä½ å¾ˆå¯çˆ±</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">You look gorgeous</td><td align="left">ä½ çœ‹èµ·æ¥å¥½è¿·äºº</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">You look great too</td><td align="left">ä½ çœ‹èµ·æ¥ä¹Ÿå¾ˆæ£’</td><td align="left"></td></tr></tbody></table><h4 id="Apr-12nd"><a href="#Apr-12nd" class="headerlink" title="Apr 12nd"></a>Apr 12nd</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">He gets a big kick out of it</td><td align="left">ä»–ä»è¿™ä»¶äº‹ä¸­æ”¶è´§å¾ˆå¤šä¹è¶£</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">He wears thick glasses</td><td align="left">ä»–å¸¦ç€åšåšçš„çœ¼é•œ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">You look good</td><td align="left">ä½ æ°”è‰²ä¸é”™å•Š</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I think you look cute</td><td align="left">æˆ‘è§‰å¾—ä½ å¾ˆå¯çˆ±</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Is this a trick question</td><td align="left">ä½ é—®çš„è¿™ä¸ªé—®é¢˜æ˜¯ä¸ªé™·é˜±å—</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I bought a new bookcase from IKEA</td><td align="left">æˆ‘ä»å®œå®¶ä¹°äº†ä¸ªæ–°ä¹¦æŸœ</td><td align="left"></td></tr></tbody></table><h4 id="Apr-13rd"><a href="#Apr-13rd" class="headerlink" title="Apr 13rd"></a>Apr 13rd</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">They make good pizza here</td><td align="left">ä»–ä»¬è¿™çš„Pizzaå¾ˆä¸é”™</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Iâ€™ve got an electric guitar</td><td align="left">æˆ‘å¾—åˆ°äº†ä¸€æŠŠç”µå‰ä»–</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Heâ€™s a very romantic guy</td><td align="left">ä»–æ˜¯ä¸ªå¾ˆæµªæ¼«çš„äºº</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Whoâ€™s milk carton is this</td><td align="left">è¿™ç›’å¥¶æ˜¯è°çš„</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Itâ€™s all a big coverup</td><td align="left">è¿™å…¨æ˜¯æ¼”ç¤º</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Thatâ€™s a big cat</td><td align="left">é‚£åªçŒ«çœŸè‚¥</td><td align="left"></td></tr></tbody></table><h4 id="Apr-14th"><a href="#Apr-14th" class="headerlink" title="Apr 14th"></a>Apr 14th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Either the dog goes or I go</td><td align="left">è®©ç‹—ç¦»å¼€ï¼Œè¦ä¹ˆæˆ‘èµ°</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">He sent me a gag gift for christmas</td><td align="left">ä»–é€äº†æˆ‘ä¸€ä¸ªææ€ªçš„åœ£è¯ç¤¼ç‰©</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">What do you say, big guy</td><td align="left">ä½ æ€ä¹ˆçœ‹å“¥ä»¬</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Can we at least hug goodbye</td><td align="left">æˆ‘ä»¬èƒ½è‡³å°‘æ‹¥æŠ±ä¸€ä¸‹æ¥å‘Šåˆ«å—</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">He took credit for my work</td><td align="left">ä»–æŠŠæˆ‘çš„åŠŸåŠ³å ä¸ºå·±æœ‰</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">These are big cups</td><td align="left">è¿™äº›æ¯å­å¥½å¤§</td><td align="left"></td></tr></tbody></table><h4 id="Apr-18th"><a href="#Apr-18th" class="headerlink" title="Apr 18th"></a>Apr 18th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Sheâ€™s so great</td><td align="left">å¥¹çœŸå¥½</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">This is so unfair</td><td align="left">è¿™ä¸ªå¤ªä¸å…¬å¹³äº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">This is sick</td><td align="left">çœŸå˜æ€</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I leave for work at seven in the morning</td><td align="left">æˆ‘æ—©ä¸Šä¸ƒç‚¹å»ä¸Šç­</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I live for dance</td><td align="left">æˆ‘æ˜¯ä¸ºäº†è·³èˆè€Œç”Ÿ</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Breath through the pain</td><td align="left">å’¬å’¬ç‰™</td><td align="left"></td></tr></tbody></table><h4 id="Apr-19th"><a href="#Apr-19th" class="headerlink" title="Apr 19th"></a>Apr 19th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I lost Monicaâ€™s shoes</td><td align="left">æˆ‘æŠŠè«å¦®å¡çš„é‹å­ä¸¢äº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">yes, she is</td><td align="left">å¥¹ç¡®å®æ˜¯</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Let show them whoâ€™s boss</td><td align="left">è®©ä»–ä»¬çœ‹çœ‹è°æ‰æ˜¯è€æ¿</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">What does she do?</td><td align="left">å¥¹æ˜¯åšä»€ä¹ˆçš„</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Why is she here</td><td align="left">å¥¹ä¸ºä»€ä¹ˆåœ¨è¿™</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">How long has she been in the bathroom</td><td align="left">å¥¹åœ¨æ´—æ‰‹é—´å¤šé•¿æ—¶é—´äº†</td><td align="left"></td></tr></tbody></table><h4 id="Apr-20th"><a href="#Apr-20th" class="headerlink" title="Apr 20th"></a>Apr 20th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">These are nice shoes</td><td align="left">è¿™é‹å­ä¸é”™</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I think heâ€™s shy</td><td align="left">æˆ‘æƒ³ä»–æ˜¯å®³ç¾</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I really like this shirt</td><td align="left">æˆ‘ç‰¹åˆ«å–œæ¬¢è¿™ä»¶è¡£æœ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">This is because she doesnâ€™t like you</td><td align="left">è¿™æ˜¯å› ä¸ºå¥¹ä¸å–œæ¬¢ä½ </td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">How is she doing</td><td align="left">å¥¹ç°åœ¨çŠ¶æ€æ€ä¹ˆæ ·å•Š</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">What she like</td><td align="left">å¥¹äººæ€ä¹ˆæ ·å•Š</td><td align="left"></td></tr></tbody></table><h4 id="Apr-21st"><a href="#Apr-21st" class="headerlink" title="Apr 21st"></a>Apr 21st</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Go and have fun</td><td align="left">å»å¥½å¥½åœ°ç©</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Houseflies live for a day</td><td align="left">æœè‡åªæ´»ä¸€å¤©</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">What kind of food are they serving</td><td align="left">ä»–ä»¬æä¾›å“ªäº›ç§ç±»çš„é£Ÿç‰©</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Itâ€™s cruel twist of fate</td><td align="left">è¿™æ˜¯ä¸ªæ®‹é…·çš„å‘½è¿åè½¬</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I have to leave for work</td><td align="left">æˆ‘å¾—èµ°äº†å»ä¸Šç­äº†</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I have faith in you</td><td align="left">æˆ‘å¯¹ä½ æœ‰ä¿¡å¿ƒ</td><td align="left"></td></tr></tbody></table><h4 id="Apr-25th"><a href="#Apr-25th" class="headerlink" title="Apr 25th"></a>Apr 25th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Of course she likes me</td><td align="left">ä»–å½“ç„¶å–œæ¬¢æˆ‘å•Š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">She hasnâ€™t, has she</td><td align="left">å¥¹æ²¡æœ‰ï¼Œå¯¹å§</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">How is that possible</td><td align="left">æ€ä¹ˆå¯èƒ½è¿™æ ·</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Give it back</td><td align="left">æŠŠå®ƒè¿˜ç»™æˆ‘</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Itâ€™s hard to say goodbye</td><td align="left">è¯´å†è§çœŸä¸å®¹æ˜“</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Give me my credit card</td><td align="left">æŠŠæˆ‘çš„ä¿¡ç”¨å¡ç»™æˆ‘</td><td align="left"></td></tr></tbody></table><h4 id="Apr-26th"><a href="#Apr-26th" class="headerlink" title="Apr 26th"></a>Apr 26th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">How could that even be possible</td><td align="left">è¿™æ˜¯æ€ä¹ˆå¯èƒ½çš„å•Š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">What are you up to</td><td align="left">å¹²å•¥å•Šä½ </td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Itâ€™s just another one of his pipe dream</td><td align="left">è¿™æ˜¯ä»–çš„å¦ä¸€ä¸ªç™½æ—¥æ¢¦</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Letâ€™s get back to the topic at hand</td><td align="left">å’±ä»¬è¨€å½’æ­£ä¼ </td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Henryâ€™s rock bottom lately</td><td align="left">äº¨åˆ©æœ€è¿‘æƒ³å…¥äº†äººç”Ÿçš„è°·åº•</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Letâ€™s look the big picture</td><td align="left">å’±ä»¬ä»å¤§å±€ç€æƒ³</td><td align="left"></td></tr></tbody></table><h4 id="Apr-27th"><a href="#Apr-27th" class="headerlink" title="Apr 27th"></a>Apr 27th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">This is my big break</td><td align="left">è¿™æ˜¯æˆ‘çš„é‡å¤§çªç ´</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">This is a public place</td><td align="left">è¿™æ˜¯å…¬å…±åŒºåŸŸ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Itâ€™s no big deal</td><td align="left">æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">It broke down this morning</td><td align="left">å®ƒä»Šå¤©æ—©æ™¨åæ‰äº†</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">How bad could it be</td><td align="left">èƒ½ååˆ°å“ªå»å‘¢</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">so, howâ€™d go</td><td align="left">æ€ä¹ˆæ ·äº†</td><td align="left"></td></tr></tbody></table><h4 id="Apr-28th"><a href="#Apr-28th" class="headerlink" title="Apr 28th"></a>Apr 28th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I think I should go</td><td align="left">æˆ‘è§‰å¾—æˆ‘è¯¥èµ°äº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I think you need to read the subtitle</td><td align="left">æˆ‘æƒ³ä½ éœ€è¦çœ‹å­—å¹•</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">We canâ€™t stop, we got to keep going</td><td align="left">æˆ‘ä»¬ä¸èƒ½åœï¼Œæˆ‘ä»¬å¾—ç»§ç»­</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">oh yeah, big time</td><td align="left">æ˜¯çš„ï¼Œç›¸å½“çš„</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">You got to give it back</td><td align="left">ä½ å¾—æ¢å›å»</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">good bye</td><td align="left">å†è§</td><td align="left"></td></tr></tbody></table><h3 id="May"><a href="#May" class="headerlink" title="May"></a>May</h3><h4 id="May-2nd"><a href="#May-2nd" class="headerlink" title="May 2nd"></a>May 2nd</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Donâ€™t I know you?</td><td align="left">æˆ‘å¥½åƒåœ¨å“ªè§è¿‡ä½ </td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I did, didnâ€™t I?</td><td align="left">æˆ‘åšäº†ï¼Œå¯¹å§ï¼Ÿ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Donâ€™t even try it</td><td align="left">æƒ³ä¹Ÿåˆ«æƒ³</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I wouldnâ€™t even care</td><td align="left">æˆ‘ä¸€ç‚¹éƒ½ä¸ä¼šåœ¨ä¹çš„</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Listen to me</td><td align="left">ä½ å¬æˆ‘è¯´</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Letâ€™s move on to something else</td><td align="left">å’±ä»¬è®¨è®ºä¸‹ä¸ªå§</td><td align="left"></td></tr></tbody></table><h4 id="May-3rd"><a href="#May-3rd" class="headerlink" title="May 3rd"></a>May 3rd</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Shouldnâ€™t I do something about this</td><td align="left">æˆ‘ä¸åº”è¯¥åšäº›ä»€ä¹ˆå—</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I donâ€™t mean to be rude</td><td align="left">æˆ‘ä¸æ˜¯æ•…æ„å†’çŠ¯ä½ </td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Thereâ€™s no reason to do that</td><td align="left">æ²¡æœ‰å¿…è¦è¿™æ ·</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I havenâ€™t spoken to him in years</td><td align="left">æˆ‘å¥½å‡ å¹´éƒ½æ²¡å’Œä»–è¯´è¯äº†</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Letâ€™s move on to something else</td><td align="left">å’±ä»¬èŠä¸‹ä¸€ä¸ªè¯é¢˜å§</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Do you believe in Santa Claus</td><td align="left">ä½ ç›¸ä¿¡åœ£è¯è€å…¬å…¬å—</td><td align="left"></td></tr></tbody></table><h4 id="May-4th"><a href="#May-4th" class="headerlink" title="May 4th"></a>May 4th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">There are plenty of intelligent inventors</td><td align="left">æœ‰å¾ˆå¤šèªæ˜çš„å‘æ˜å®¶</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Iâ€™m on a international flight to Canada</td><td align="left">æˆ‘æ­£åœ¨åä¸€ä¸ªå›½é™…èˆªç­å»Canada</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">There are twenty presenters scheduled for today</td><td align="left">ä»Šå¤©å®‰æ’äº†20ä¸ªæ¼”è®²è€…</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">There are identical twins</td><td align="left">åŒåµåŒèƒèƒ</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">He works in the entertainment industry</td><td align="left">ä»–åœ¨å¨±ä¹åœˆå·¥ä½œ</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Why wonâ€™t he listen to me</td><td align="left">ä»–ä¸ºä»€ä¹ˆä¸å¬æˆ‘çš„è¯</td><td align="left"></td></tr></tbody></table><h4 id="May-5th"><a href="#May-5th" class="headerlink" title="May 5th"></a>May 5th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Why does he do that</td><td align="left">ä»–ä¸ºä»€ä¹ˆé‚£ä¹ˆåš</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Why doesnâ€™t he come to me</td><td align="left">ä»–ä¸ºä»€ä¹ˆä¸æ¥æ‰¾æˆ‘</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Did he mention us</td><td align="left">ä»–æåˆ°æˆ‘ä»¬äº†å—</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">There he is</td><td align="left">ä»–åœ¨é‚£</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I thought he was nice</td><td align="left">æˆ‘è§‰å¾—ä»–æŒºå¥½çš„å•Š</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I think about him all the time</td><td align="left">æˆ‘ä¸€ç›´åœ¨æƒ³ä»–</td><td align="left"></td></tr></tbody></table><h4 id="May-10th"><a href="#May-10th" class="headerlink" title="May 10th"></a>May 10th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Iâ€™ll take him to the store</td><td align="left">æˆ‘ä¼šå¸¦ä»–å»å•†åº—</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Iâ€™m looking for him</td><td align="left">æˆ‘åœ¨æ‰¾ä»–</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Let him do what he wants</td><td align="left">è®©ä»–åšä»–æƒ³åšçš„</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Can you tell him for me</td><td align="left">ä½ èƒ½æ›¿æˆ‘å‘Šè¯‰å¥¹å—</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Iâ€™ll give him back his book</td><td align="left">æˆ‘ä¼šæŠŠä»–çš„ä¹¦è¿˜ç»™ä»–</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Itâ€™s his, not mine</td><td align="left">æ˜¯ä»–çš„ï¼Œä¸æ˜¯æˆ‘çš„</td><td align="left"></td></tr></tbody></table><h4 id="May-11th"><a href="#May-11th" class="headerlink" title="May 11th"></a>May 11th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">They found a gun in his hand</td><td align="left">ä»–ä»¬åœ¨ä»–æ”¶æ‰¾åˆ°ä¸€æŠŠæª</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">This is his office</td><td align="left">è¿™æ˜¯ä»–çš„åŠå…¬å®¤</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">When is his birthday</td><td align="left">ä»€ä¹ˆæ—¶å€™æ˜¯ä»–çš„ç”Ÿæ—¥</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Donâ€™t push her</td><td align="left">åˆ«é€¼å¥¹/åˆ«æ¨å¥¹</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I walked her out to the bus stop</td><td align="left">æˆ‘æŠŠå¥¹é€åˆ°äº†è½¦ç«™</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I wanna make her breakfast</td><td align="left">æˆ‘æƒ³ç»™å¥¹åšæ—©é¤</td><td align="left"></td></tr></tbody></table><h4 id="May-12th"><a href="#May-12th" class="headerlink" title="May 12th"></a>May 12th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">He really told her off</td><td align="left">ä»–è‡­éª‚äº†å¥¹ä¸€é¡¿</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I went to the mall with her</td><td align="left">æˆ‘è·Ÿå¥¹ä¸€èµ·å»äº†å•†åœº</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Youâ€™ve got to call her</td><td align="left">ä½ å¾—ç»™å¥¹æ‰“ä¸ªç”µè¯</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Is it her birthday today</td><td align="left">ä»Šå¤©æ˜¯å¥¹çš„ç”Ÿæ—¥å—</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I think his ideaâ€™s good</td><td align="left">æˆ‘è§‰å¾—ä»–çš„ä¸»æ„æŒºå¥½</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Is this his wallet</td><td align="left">è¿™æ˜¯ä»–çš„é’±åŒ…å—</td><td align="left"></td></tr></tbody></table><h4 id="May-16th"><a href="#May-16th" class="headerlink" title="May 16th"></a>May 16th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Get in the car</td><td align="left">ä¸Šè½¦</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Itâ€™s not in there</td><td align="left">ä¸åœ¨é‚£é‡Œ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">This is my first night in BJ</td><td align="left">è¿™æ˜¯æˆ‘åœ¨åŒ—äº¬çš„ç¬¬ä¸€å¤œ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Heâ€™s out in the hallway</td><td align="left">ä»–åœ¨å¤–é¢çš„èµ°å»Š</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">It hit me right in the eye</td><td align="left">æ­£å¥½æ‰“åˆ°æˆ‘çš„çœ¼ç›</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Whatâ€™s that in the car</td><td align="left">è½¦é‡Œé‚£ä¸ªæ˜¯ä»€ä¹ˆ</td><td align="left"></td></tr></tbody></table><h4 id="May-17th"><a href="#May-17th" class="headerlink" title="May 17th"></a>May 17th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">This is a important day for me</td><td align="left">è¿™å¯¹æˆ‘æ˜¯ä¸€ä¸ªé‡è¦çš„æ—¥å­</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Martin said the milk is rotten</td><td align="left">é©¬ä¸è¯´ç‰›å¥¶å·²ç»è¿‡æœŸäº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Would you like some sweetener for your coffee</td><td align="left">ä½ æƒ³åŠ ä¸€äº›ç”œå‘³å‰‚ç»™ä½ çš„å’–å•¡å—</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Can you draw the curtains</td><td align="left">ä½ èƒ½æ‹‰ä¸Šé‚£ä¸ªçª—å¸˜å—</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I wanna help lighten the load</td><td align="left">æˆ‘æƒ³å¸®å¿™åˆ†æ‹…ä¸€äº›é‡é‡</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Iâ€™ve written a letter to him</td><td align="left">æˆ‘å·²ç»ç»™ä»–å†™ä¿¡äº†</td><td align="left"></td></tr></tbody></table><h4 id="May-18th"><a href="#May-18th" class="headerlink" title="May 18th"></a>May 18th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I need to buy a hair straightener</td><td align="left">æˆ‘éœ€è¦ä¹°ä¸€ä¸ªç›´å‘åŠ ç­</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I just got a new kitten</td><td align="left">æˆ‘åˆšåˆšä¹°äº†ä¸€åªå°çŒ«</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Have you seen my mittens</td><td align="left">ä½ çœ‹åˆ°æˆ‘çš„è¿æŒ‡æ‰‹å¥—äº†å—</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Have you eaten yet</td><td align="left">ä½ åƒé¥­äº†å—</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I lost a button</td><td align="left">æˆ‘ä¸¢äº†ä¸€ä¸ªæ‰£å­</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Are you certain that he left</td><td align="left">ä½ ç¡®å®šä»–å·²ç»èµ°äº†å—</td><td align="left"></td></tr></tbody></table><h4 id="May-19th"><a href="#May-19th" class="headerlink" title="May 19th"></a>May 19th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">The dentist is going to whiten my teeth</td><td align="left">ç‰™åŒ»å°†ä¼šç»™æˆ‘çš„ç‰™é½¿ç¾ç™½</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Itâ€™s disheartening news</td><td align="left">è¿™æ˜¯ä¸ªä»¤äººæ²®ä¸§çš„æ¶ˆæ¯</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Please enlighten me</td><td align="left">è¯·æŒ‡å¼•æˆ‘</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I wanna shorten my bangs</td><td align="left">æˆ‘æƒ³å‰ªçŸ­æˆ‘çš„åˆ˜æµ·</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">The wall is crooked, it needs to be straightened</td><td align="left">è¿™å µå¢™æ­ªäº†ï¼Œéœ€è¦é‡æ–°è°ƒæ•´</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">The horror movie we saw was frightening</td><td align="left">æˆ‘ä»¬çœ‹è¿‡çš„é‚£ä¸ªææ€–ç‰‡å¾ˆå¯æ€•</td><td align="left"></td></tr></tbody></table><h4 id="May-23rd"><a href="#May-23rd" class="headerlink" title="May 23rd"></a>May 23rd</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">What about you</td><td align="left">é‚£ä½ å‘¢</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Can I get you something to drink</td><td align="left">ä½ æƒ³è¦å–ç‚¹ä»€ä¹ˆå—</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Thatâ€™s what you said</td><td align="left">ä½ å°±æ˜¯è¿™ä¹ˆè¯´çš„å•Š</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Thereâ€™s something that you should know</td><td align="left">æœ‰äº›äº‹æƒ…ä½ åº”è¯¥çŸ¥é“</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Look at you, youâ€™re mess</td><td align="left">çœ‹çœ‹ä½ ï¼Œä½ ä¸€å›¢ç³Ÿ</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">I thought you left already</td><td align="left">æˆ‘ä»¥ä¸ºä½ å·²ç»èµ°äº†</td><td align="left"></td></tr></tbody></table><h4 id="May-24th"><a href="#May-24th" class="headerlink" title="May 24th"></a>May 24th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">I got you flowers</td><td align="left">æˆ‘ç»™ä½ ä¹°äº†èŠ±</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Donâ€™t you wanna know?</td><td align="left">ä½ ä¸æƒ³çŸ¥é“å—</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Is that what youâ€™re saying</td><td align="left">ä½ è¯´çš„æ˜¯è¿™ä¸ªæ„æ€å—</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">What did you do</td><td align="left">ä½ åšäº†ä»€ä¹ˆ</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Would you give it a rest</td><td align="left">ä½ èƒ½ä¸èƒ½åˆ«æŠ˜è…¾äº†</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">How could you do that to me</td><td align="left">ä½ æ€ä¹ˆèƒ½è¿™æ ·å¯¹æˆ‘</td><td align="left"></td></tr></tbody></table><h4 id="May-25th"><a href="#May-25th" class="headerlink" title="May 25th"></a>May 25th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Hey, Iâ€™m glad youâ€™re here</td><td align="left">å˜¿ï¼Œå¹¸äºä½ æ¥äº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Should you be doing that</td><td align="left">ä½ åº”è¯¥è¿™ä¹ˆåšå—</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I told you yesterday that Iâ€™m busy today</td><td align="left">æˆ‘æ˜¨å¤©å°±è·Ÿä½ è¯´äº†æˆ‘ä»Šå¤©å¾ˆå¿™</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">He said you wanted to go home</td><td align="left">ä»–è¯´äº†ä½ æƒ³å›å®¶</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Iâ€™m sorry I stood you up last night</td><td align="left">ä¸å¥½æ„æ€æ˜¨å¤©æ™šä¸Šæ”¾äº†ä½ é¸½å­</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Why would you do that</td><td align="left">ä½ ä¸ºä»€ä¹ˆé‚£ä¹ˆåš</td><td align="left"></td></tr></tbody></table><h4 id="May-26th"><a href="#May-26th" class="headerlink" title="May 26th"></a>May 26th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Did you sleep okay</td><td align="left">ä½ ç¡å¾—å¥½å—</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">How did you do that</td><td align="left">ä½ æ˜¯æ€ä¹ˆåšçš„</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I donâ€™t need your pity</td><td align="left">æˆ‘ä¸éœ€è¦ä½ çš„å¯æ€œ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I brought you some books</td><td align="left">æˆ‘ç»™ä½ å¸¦äº†ä¹¦</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Why canâ€™t you go</td><td align="left">ä½ ä¸ºä»€ä¹ˆä¸èƒ½å»</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Donâ€™t let your guard down</td><td align="left">ä½ åˆ«æ”¾æ¾è­¦æƒ•</td><td align="left"></td></tr></tbody></table><h4 id="May-30th"><a href="#May-30th" class="headerlink" title="May 30th"></a>May 30th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">What are you talking about?</td><td align="left">ä½ åœ¨è¯´ä»€ä¹ˆå•Š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Whatâ€™s going on</td><td align="left">æœ€è¿‘æ€ä¹ˆæ ·</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">What are you doing here</td><td align="left">ä½ åœ¨è¿™é‡Œåšä»€ä¹ˆ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Iâ€™m tell you, this guys mean business</td><td align="left">æˆ‘è·Ÿä½ è®²ï¼Œä»–ä»¬æ˜¯ç©çœŸçš„</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Yeah, thatâ€™s right, keep walking</td><td align="left">æ²¡é”™ï¼Œç»§ç»­èµ°</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Iâ€™m having the time of my life</td><td align="left">æˆ‘æ­£åœ¨äº«å—ä¸€ç”Ÿä¸­æœ€å¿«ä¹çš„æ—¶å…‰</td><td align="left"></td></tr></tbody></table><h4 id="May-31st"><a href="#May-31st" class="headerlink" title="May 31st"></a>May 31st</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">What are you saying?</td><td align="left">ä½ ä»€ä¹ˆæ„æ€å•Š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Quit being such a wuss</td><td align="left">åˆ«åšèƒ†å°é¬¼äº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">What are you looking at</td><td align="left">ä½ çœ‹ä»€ä¹ˆå‘¢</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">What are you trying to do</td><td align="left">ä½ æƒ³åšä»€ä¹ˆ</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">When are we starting</td><td align="left">æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¼€å§‹</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">Iâ€™m getting you home</td><td align="left">æˆ‘é€ä½ å›å®¶</td><td align="left"></td></tr></tbody></table><h3 id="Jun"><a href="#Jun" class="headerlink" title="Jun"></a>Jun</h3><h4 id="Jun-1st"><a href="#Jun-1st" class="headerlink" title="Jun 1st"></a>Jun 1st</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Hey, Iâ€™m talking to you</td><td align="left">å˜¿ï¼Œæˆ‘æ­£å’Œä½ è®²è¯å‘¢</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Heâ€™s going into the house</td><td align="left">ä»–æ­£è¦èµ°è¿›é‚£ä¸ªæˆ¿å­</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Iâ€™ve been waiting all day</td><td align="left">æˆ‘ç­‰äº†ä¸€æ•´å¤©</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Stop shouting at me</td><td align="left">åˆ«å†²æˆ‘åš·åš·</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Theyâ€™re fighting again</td><td align="left">ä»–ä»¬åˆåµèµ·æ¥äº†</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">When are we meeting</td><td align="left">æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™è§é¢</td><td align="left"></td></tr></tbody></table><h4 id="Jun-2nd"><a href="#Jun-2nd" class="headerlink" title="Jun 2nd"></a>Jun 2nd</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">He keeps hitting on her</td><td align="left">ä»–ä¸€ç›´åœ¨æ­è®ªå¥¹</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Iâ€™m putting out the cigarette</td><td align="left">æˆ‘æ­£åœ¨æŠŠçƒŸç­äº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Whatâ€™s he eating</td><td align="left">ä»–åœ¨åƒä»€ä¹ˆ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">This is exciting</td><td align="left">è¿™ä¸ªå¥½åˆºæ¿€</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">I was putting on my jacket</td><td align="left">æˆ‘å½“æ—¶åœ¨ç©¿å¤¹å…‹</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">He keeps putting it off</td><td align="left">ä»–ä¸€ç›´åœ¨æ‹–å»¶</td><td align="left"></td></tr></tbody></table><h4 id="Jun-6th"><a href="#Jun-6th" class="headerlink" title="Jun 6th"></a>Jun 6th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">They arenâ€™t coming, are theyï¼Ÿ</td><td align="left">ä»–ä»¬ä¸å›æ¥äº†ï¼Œå¯¹å§ï¼Ÿ</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">She couldnâ€™t have done that</td><td align="left">ä»–ä¸ä¼šåšé‚£æ ·çš„äº‹çš„</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">She would have asked for permission</td><td align="left">ä»–æœ¬æ¥å¯ä»¥å…ˆå¾æ±‚è®¸å¯çš„</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">I would have done it differently</td><td align="left">å¦‚æœæ˜¯æˆ‘æˆ‘ä¸ä¼šè¿™ä¹ˆåš</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Itâ€™d been done before</td><td align="left">æ—©å°±æœ‰äººåšè¿‡äº†</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">You shouldnâ€™t have said anything</td><td align="left">ä½ æœ¬æ¥ä»€ä¹ˆéƒ½ä¸åº”è¯¥è®²çš„</td><td align="left"></td></tr></tbody></table><h4 id="Jun-7th"><a href="#Jun-7th" class="headerlink" title="Jun 7th"></a>Jun 7th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Where have you been ?</td><td align="left">ä½ åˆ°å“ªå»äº†ï¼Ÿ</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Why are you so annoying?</td><td align="left">ä½ ä¸ºä»€ä¹ˆè¿™ä¹ˆç”Ÿæ°”ï¼Ÿ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">Doesnâ€™t he know</td><td align="left">ä»–ä¸çŸ¥é“å—ï¼Ÿ</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">When have you ever cared about me?</td><td align="left">ä½ ä»€ä¹ˆæ—¶å€™åœ¨ä¹è¿‡æˆ‘ï¼Ÿ</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">She would told me if she could</td><td align="left">å¦‚æœå¯ä»¥çš„è¯å¥¹ä¸€å®šä¼šå‘Šè¯‰æˆ‘çš„</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">He wasnâ€™t even here when it happened</td><td align="left">äº‹æƒ…å‘ç”Ÿçš„æ—¶å€™ä»–ä¸åœ¨è¿™é‡Œ</td><td align="left"></td></tr></tbody></table><h4 id="Jun-8th"><a href="#Jun-8th" class="headerlink" title="Jun 8th"></a>Jun 8th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">You need not have done that</td><td align="left">ä½ ä¸éœ€è¦åšé‚£ä»¶äº‹</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">They havenâ€™t had a chance</td><td align="left">ä»–ä»¬ä¸€ç›´æ²¡æœ‰æœºä¼š</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">It will do for now</td><td align="left">æš‚æ—¶è¿™æ ·å°±å¯ä»¥äº†</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">It couldnâ€™t have been him</td><td align="left">ä¸å¯èƒ½æ˜¯ä»–</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Whereâ€™s our food</td><td align="left">æˆ‘ä»¬çš„åƒçš„åœ¨å“ª</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">He wouldnâ€™t have done that to you</td><td align="left">[å¦‚æœæ˜¯ä»–]ä»–ä¸ä¼šå¯¹ä½ è¿™ä¹ˆåšçš„</td><td align="left"></td></tr></tbody></table><h4 id="Jun-9th"><a href="#Jun-9th" class="headerlink" title="Jun 9th"></a>Jun 9th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">It had better be good</td><td align="left">æœ€å¥½æ˜¯å¥½äº‹</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">Where has she beenï¼Ÿ</td><td align="left">å¥¹åˆ°å“ªå»äº†</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">It would be nice if you could cut me some slack</td><td align="left">ä½ è¦æ˜¯å¯¹æˆ‘è¦æ±‚æ¾ä¸€ç‚¹å°±å¥½äº†</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">It couldnâ€™t have been her</td><td align="left">ä¸å¯èƒ½æ˜¯å¥¹</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">There is a good restaurant on the corner</td><td align="left">è¡—è§’æœ‰ä¸€å®¶å¥½åƒçš„é¥­åº—</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">When have I ever led you wrong?</td><td align="left">æˆ‘ä»€ä¹ˆæ—¶å€™å¸¦ä½ èµ°è¿‡å¼¯è·¯</td><td align="left"></td></tr></tbody></table><h4 id="Jun-13th"><a href="#Jun-13th" class="headerlink" title="Jun 13th"></a>Jun 13th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Who did you talk to?</td><td align="left">ä½ å’Œè°è¯´è¿‡äº†</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">What did you do?</td><td align="left">ä½ åšäº†ä»€ä¹ˆ</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">When did you go?</td><td align="left">ä½ æ˜¯ä»€ä¹ˆæ—¶å€™å»çš„</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Where did you put it?</td><td align="left">ä½ æ”¾å“ªå„¿å»äº†</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Why did you do that ?</td><td align="left">ä½ ä¸ºä»€ä¹ˆè¿™ä¹ˆåšäº†</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">How did you do that?</td><td align="left">ä½ æ˜¯æ€ä¹ˆåšåˆ°çš„</td><td align="left"></td></tr></tbody></table><h4 id="Jun-14th"><a href="#Jun-14th" class="headerlink" title="Jun 14th"></a>Jun 14th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Who do you talk to?</td><td align="left">ä½ å¹³æ—¶å’Œè°è¯´å•Š</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">What do you do?</td><td align="left">ä½ æ˜¯åšä»€ä¹ˆçš„</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">When do you go?</td><td align="left">ä½ ä»€ä¹ˆæ—¶å€™è¦å»</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">Where do you put it?</td><td align="left">ä½ å¹³æ—¶æ”¾å“ª</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Why do you do that ?</td><td align="left">ä½ ä¸ºä»€ä¹ˆè¿™ä¹ˆåš</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">How do you do that?</td><td align="left">è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„</td><td align="left"></td></tr></tbody></table><h4 id="Jun-15th"><a href="#Jun-15th" class="headerlink" title="Jun 15th"></a>Jun 15th</h4><table><thead><tr><th align="left">åºå·</th><th align="left">å¥å­</th><th align="left">ç¿»è¯‘</th><th align="left">è¿è¯»éŸ³æ ‡</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">You got to get ahead</td><td align="left">ä½ å¾—æƒ³åŠæ³•å‡ºäººå¤´åœ°</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">I wanted to talk about the future</td><td align="left">æˆ‘æƒ³èŠèŠæœªæ¥</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">I donâ€™t know if thatâ€™s good idea</td><td align="left">æˆ‘ä¸çŸ¥é“é‚£æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">You should come to the party</td><td align="left">ä½ åº”è¯¥å‚åŠ é‚£ä¸ªèšä¼š</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">Let me give it a shot</td><td align="left">è®©æˆ‘è¯•ä¸€è¯•</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">You want to give me a crack at it</td><td align="left">è®©æˆ‘è¯•è¯•å¥½å—</td><td align="left"></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> English </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVCä¹‹RequestMappingæ³¨è§£</title>
      <link href="//p/springmvc-requestmapping-annotation.html"/>
      <url>//p/springmvc-requestmapping-annotation.html</url>
      
        <content type="html"><![CDATA[<h1 id="SpringMVCä¹‹RequestMappingæ³¨è§£"><a href="#SpringMVCä¹‹RequestMappingæ³¨è§£" class="headerlink" title="SpringMVCä¹‹RequestMappingæ³¨è§£"></a>SpringMVCä¹‹RequestMappingæ³¨è§£</h1><hr><h3 id="ä»€ä¹ˆæ˜¯RequestMappingæ³¨è§£"><a href="#ä»€ä¹ˆæ˜¯RequestMappingæ³¨è§£" class="headerlink" title="ä»€ä¹ˆæ˜¯RequestMappingæ³¨è§£"></a>ä»€ä¹ˆæ˜¯RequestMappingæ³¨è§£</h3><p>åœ¨SpringMVCçš„APIä¸­æˆ‘ä»¬å‘ç°å¯¹@interface RequestMapping æœ‰å¦‚ä¸‹çš„å®šä¹‰ï¼š</p><blockquote><p>*Annotation for mapping web requests onto specific handler classes and/or handler methods. Provides a consistent style between Servlet and Portlet environments, with the semantics adapting to the concrete environment. *</p></blockquote><p>ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯é€šè¿‡åœ¨åœ¨ç±»å’Œæ–¹æ³•ä¸Šçš„é™åˆ¶æ¥åŒ¹é…request</p><a id="more"></a><h3 id="RequestMappingçš„å‡ å¤§å±æ€§"><a href="#RequestMappingçš„å‡ å¤§å±æ€§" class="headerlink" title="RequestMappingçš„å‡ å¤§å±æ€§"></a>RequestMappingçš„å‡ å¤§å±æ€§</h3><p>åœ¨Spring4.2.4çš„APIä¸­å‘ç°RequestMappingæœ‰å…«å¤§å±æ€§æ¥mappingURLè¯·æ±‚</p><ol><li><p><strong>value</strong></p><blockquote><p> *In a Servlet environment this is an alias for path(). For example @RequestMapping(â€œ/fooâ€) is equivalent to @RequestMapping(path=â€/fooâ€). *<br>åœ¨Servletä¸­valueå°±æ˜¯è¡¨ç¤ºpathï¼Œè¡¨ç¤ºè¯·æ±‚çš„è·¯å¾„çš„mapping, æ”¯æŒé€šé…ç¬¦å½¢å¼</p></blockquote></li><li><p><strong>method</strong></p><blockquote><p><em>The HTTP request methods to map to, narrowing the primary mapping: *</em>GET, POST, HEAD, OPTIONS, PUT, PATCH, DELETE, TRACE. ***<br>Httpè¯·æ±‚ä¸­æœ‰ä»¥ä¸Šå‡ ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ å…¥methodæ¥é™åˆ¶mappingèŒƒå›´</p></blockquote></li><li><p><strong>params</strong></p><blockquote><p><em>Same format for any environment: a sequence of â€œmyParam=myValueâ€ style expressions, with a request only mapped if each such parameter is found to have the given value. Expressions can be negated by using the â€œ!=â€ operator, as in â€œmyParam!=myValueâ€. â€œmyParamâ€ style expressions are also supported, with such parameters having to be present in the request (allowed to have any value). Finally, â€œ!myParamâ€ style expressions indicate that the specified parameter is not supposed to be present in the request. *<br>è¯·æ±‚å‚æ•°ä¸­å¿…é¡»æœ‰key*</em>ç­‰äº<strong>æŸä¸ªvalueæˆ–è€…keyå¿…é¡»</strong>ä¸ç­‰äº<strong>æŸä¸ªvalueï¼Œå¤šä¸ªæ¡ä»¶æ˜¯</strong>ä¸**çš„å…³ç³»ã€‚</p></blockquote></li><li><p><strong>headers</strong></p><blockquote><p><em>Same format for any environment: a sequence of â€œMy-Header=myValueâ€ style expressions, with a request only mapped if each such header is found to have the given value. Expressions can be negated by using the â€œ!=â€ operator, as in â€œMy-Header!=myValueâ€. â€œMy-Headerâ€ style expressions are also supported, with such headers having to be present in the request (allowed to have any value). Finally, â€œ!My-Headerâ€ style expressions indicate that the specified header is not supposed to be present in the request.</em></p></blockquote></li></ol><p><strong><em>Also supports media type wildcards (</em>), for headers such as Accept and Content-Type. For instance,will match requests with a Content-Type of â€œtext/htmlâ€, â€œtext/plainâ€, etc. *</strong><br>å’Œparamså±æ€§ç±»ä¼¼ï¼Œæ”¯æŒé€šé…ç¬¦åŒ¹é…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/something"</span>, headers = <span class="string">"content-type=text/*"</span>)</span><br></pre></td></tr></table></figure><ol start="5"><li><p><strong>name</strong></p><blockquote><p><em>Assign a name to this mapping. Supported at the type level as well as at the method level! When used on both levels, a combined name is derived by concatenation with â€œ#â€ as separator.</em><br>ç»™mappingå‘½åï¼Œæ”¯æŒåœ¨ç±»å’Œæ–¹æ³•ä¸Šä½¿ç”¨è¯¥å±æ€§ï¼Œè”åˆèµ·æ¥çš„nameç”¨#æ¥åˆ†éš”</p></blockquote></li><li><p><strong>consumes</strong></p><blockquote><p>*The consumable media types of the mapped request, narrowing the primary mapping. The format is a single media type or a sequence of media types, with a request only mapped if the Content-Type matches one of these media types. Examples:</p></blockquote><pre><code>consumes = &quot;text/plain&quot;consumes = {&quot;text/plain&quot;, &quot;application/*&quot;}</code></pre><blockquote><p>*Expressions can be negated by using the â€œ!â€ operator, as in â€œ!text/plainâ€, which matches all requests with a Content-Type other than â€œtext/plainâ€. *<br>consumesæ•°ç»„é‡Œé¢å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œåªè¦åŒ¹é…åˆ°ä»–ä»¬å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚</p></blockquote></li><li><p><strong>produces</strong></p><blockquote><p><em>he producible media types of the mapped request, narrowing the primary mapping. The format is a single media type or a sequence of media types, with a request only mapped if the Accept matches one of these media types. Examples:</em></p></blockquote><pre><code>produces = &quot;text/plain&quot;produces = {&quot;text/plain&quot;, &quot;application/*&quot;}produces = &quot;application/json; charset=UTF-8&quot;</code></pre><blockquote><p>*It affects the actual content type written, for example to produce a JSON response with UTF-8 encoding, â€œapplication/json; charset=UTF-8â€ should be used. Expressions can be negated by using the â€œ!â€ operator, as in â€œ!text/plainâ€, which matches all requests with a Accept other than â€œtext/plainâ€. *<br>æŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„(Accept)ç±»å‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»å‹æ‰è¿”å›</p></blockquote></li><li><p><strong>path</strong></p><blockquote><p><em>In a Servlet environment only: the path mapping URIs (e.g. â€œ/myPath.doâ€). Ant-style path patterns are also supported (e.g. â€œ/myPath/</em>.doâ€). At the method level, relative paths (e.g. â€œedit.doâ€) are supported within the primary mapping expressed at the type level. Path mapping URIs may contain placeholders (e.g. â€œ/${connect}â€) *</p></blockquote></li></ol><p>ä»¥ä¸Šæ‰€æœ‰å±æ€§éƒ½æ˜¯æ¥é™åˆ¶mappingè¦æ±‚çš„ï¼Œä½†æ˜¯å¸¸ç”¨çš„æ˜¯<strong>paramsã€methodã€consumes</strong>.</p><h3 id="éªŒè¯å±æ€§"><a href="#éªŒè¯å±æ€§" class="headerlink" title="éªŒè¯å±æ€§"></a>éªŒè¯å±æ€§</h3><ol><li><p><strong>value</strong><br>valueæ”¯æŒé€šé…ç¬¦çš„è¡¨ç°å½¢å¼,  <strong>?</strong>è¡¨ç¤ºåŒ¹é…æ–‡ä»¶åä¸­çš„ä¸€ä¸ªå­—ç¬¦, * è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦, ** è¡¨ç¤ºåŒ¹é…å¤šå±‚è·¯å¾„çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦, @PathVariableç®—æ˜¯URLå‚æ•°çš„å ä½ç¬¦ã€‚</p><pre><code>@RequestMapping(value=&quot;/?/testValue1/{id}&quot;)public String testValue1(@PathVariable(&quot;id&quot;) String id){    System.out.println(&quot;valueæµ‹è¯•&quot; + id);    return SUCCESS;}</code></pre><blockquote><p><strong>URL</strong>:  <a href="http://localhost:8080/springMVC1/demo/a/testValue1/28" target="_blank" rel="noopener">http://localhost:8080/springMVC1/demo/a/testValue1/28</a><br><strong>Result</strong>:  valueæµ‹è¯•28</p></blockquote><p>ç°åœ¨æˆ‘ä»¬é‡åˆ°ä¸€ç§æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬çš„idæ˜¯1.2.0007.9 è¿™ç§ç±»å‹çš„å­—ç¬¦ï¼Œå¦‚æœåœ¨è¿˜å‘ä¸Šé¢é‚£æ ·æ¥ä¼ å‚æ•°åªä¼šçš„åˆ°1.0è¿™æ ·çš„ç»“æœï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><pre><code>@RequestMapping(value=&quot;/?/testValue1/{idï¼š.*}&quot;)        public String testValue1(@PathVariable(&quot;id&quot;) String id){            System.out.println(&quot;valueæµ‹è¯•&quot; + id);            return SUCCESS;        }</code></pre><p> å†™æˆ{id:.*} æˆ– {id:.+} éƒ½å¯ä»¥ã€‚</p></li><li><p><strong>method</strong><br>jspéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>&lt;dl&gt;    &lt;dt&gt;Test method&lt;/dt&gt;    &lt;dd&gt;        &lt;a href=&quot;demo/testMethod_GET&quot;&gt;Method_GET&lt;/a&gt;    &lt;/dd&gt;    &lt;dd&gt;        &lt;form action=&quot;demo/testMethod_POST&quot; method=&quot;post&quot;&gt;            &lt;input type=&quot;submit&quot; value=&quot;Method_POST&quot;/&gt;        &lt;/form&gt;    &lt;/dd&gt;    &lt;dd&gt;        &lt;form action=&quot;demo/testMethod_DELETE&quot; method=&quot;post&quot;&gt;            &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;/&gt;            &lt;input type=&quot;submit&quot; value=&quot;Method_DELETE&quot;/&gt;        &lt;/form&gt;    &lt;/dd&gt;    &lt;dd&gt;        &lt;form action=&quot;demo/testMethod_PUT&quot; method=&quot;post&quot;&gt;            &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot;/&gt;            &lt;input type=&quot;submit&quot; value=&quot;Method_PUT&quot;/&gt;        &lt;/form&gt;    &lt;/dd&gt;&lt;/dl&gt;</code></pre><p>GETå’ŒPOSTæ–¹æ³•å¾ˆå¥½ç†è§£ï¼Œå¯æ˜¯åœ¨DELETEæ–¹æ³•å’ŒPUTæ–¹æ³•ä¸­æˆ‘ä»¬å´åŠ å…¥äº†ä¸€ä¸ªhiddenç±»å‹çš„inputï¼Œå€¼åˆ†åˆ«ä¸ºDELETEå’ŒPUTï¼Œä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ªéšè—åŸŸï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹Springä¸­org.springframework.web.filter.HiddenHttpMethodFilterç±»çš„ä¸€æ®µæºç ï¼š</p><pre><code>public static final String DEFAULT_METHOD_PARAM = &quot;_method&quot;;private String methodParam = DEFAULT_METHOD_PARAM;@Overrideprotected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)throws ServletException, IOException {    String paramValue = request.getParameter(this.methodParam);    if (&quot;POST&quot;.equals(request.getMethod()) &amp;&amp; StringUtils.hasLength(paramValue)) {        String method = paramValue.toUpperCase(Locale.ENGLISH);        HttpServletRequest wrapper = new HttpMethodRequestWrapper(request, method);        filterChain.doFilter(wrapper, response);    }    else {        filterChain.doFilter(request, response);    }}</code></pre><p>è¿™æ®µä»£ç çš„ä¸»è¦æ„æ€å°±æ˜¯å¦‚æœ_methodä¸­å­˜åœ¨å€¼ï¼Œå¹¶ä¸”æ˜¯postæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬çš„servletå¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œä¸ºäº†å®Œæˆè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥åœ¨web.xmlä¸­é…ç½®è¿™ä¸ªorg.springframework.web.filter.HiddenHttpMethodFilterï¼Œå¦‚ä¸‹ï¼š</p><pre><code>&lt;!-- org.springframework.web.filter.HiddenHttpMethodFilter å¯ä»¥å°†postè¯·æ±‚è½¬ä¸ºPUTå’ŒDELETEè¯·æ±‚ --&gt;&lt;filter&gt;    &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;    &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt;    &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;</code></pre><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹JAVAåå°controllerä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>@RequestMapping(value=&quot;/testMethod_GET&quot;, method=RequestMethod.GET)public String testMethod_GET(){    System.out.println(&quot;This is GET method&quot;);    return SUCCESS;}@RequestMapping(value=&quot;/testMethod_POST&quot;,method=RequestMethod.POST)public String testMethod_POST(){    System.out.println(&quot;This is POST method&quot;);    return SUCCESS;}@RequestMapping(value=&quot;/testMethod_DELETE&quot;, method=RequestMethod.DELETE)public String testMethod_DELETE(){    System.out.println(&quot;This is DELETE method&quot;);    return SUCCESS;}@RequestMapping(value=&quot;/testMethod_PUT&quot;, method=RequestMethod.PUT)public String testMethod_PUT(){    System.out.println(&quot;This is PUT method&quot;);    return SUCCESS;}        </code></pre></li><li><p><strong>params</strong><br>jspéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>&lt;dl&gt;    &lt;dt&gt;Test params&lt;/dt&gt;    &lt;dd&gt;        &lt;a href=&quot;demo/testParams?username&amp;age=10&quot;&gt;testParams&lt;/a&gt;    &lt;/dd&gt;&lt;/dl&gt;</code></pre><p>Javaçš„Controllerä»£ç å¦‚ä¸‹ï¼š</p><pre><code>@RequestMapping(value=&quot;/testParams&quot;, params={&quot;username&quot;,&quot;age!=0&quot;})public String testParams(){    System.out.println(&quot;testParams&quot;);    return SUCCESS;}</code></pre><p>params={â€œusernameâ€,â€age!=0â€}ä»£è¡¨è¯·æ±‚å‚æ•°ä¸­<strong>å¿…é¡»</strong>æœ‰usernameå’Œageè¿™ä¸¤ä¸ªå‚æ•°ï¼ŒåŒæ—¶ageä¸èƒ½ç­‰äº0.</p></li><li><p><strong>headers</strong><br>headerså±æ€§åŒparamsç±»ä¼¼ï¼Œéƒ½æ˜¯å¯ä»¥ä»¥æ•°ç»„çš„å½¢å¼æ¥è¿›è¡Œçº¦æŸã€‚éœ€è¦ä»€ä¹ˆæ ·çš„è¯·æ±‚å‚æ•°å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·æ¥æŸ¥çœ‹è¯·æ±‚ä¸­éƒ½æœ‰ä»€ä¹ˆæ ·çš„å‚æ•°ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Spring-Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨è§£ </tag>
            
            <tag> annotation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven Project</title>
      <link href="//p/maven-project-structure.html"/>
      <url>//p/maven-project-structure.html</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ›å»ºMaven-Web-Project"><a href="#åˆ›å»ºMaven-Web-Project" class="headerlink" title="åˆ›å»ºMaven Web Project"></a>åˆ›å»ºMaven Web Project</h1><hr><h3 id="ä»€ä¹ˆæ˜¯Maven"><a href="#ä»€ä¹ˆæ˜¯Maven" class="headerlink" title="ä»€ä¹ˆæ˜¯Maven"></a>ä»€ä¹ˆæ˜¯Maven</h3><p>åœ¨<a href="http://maven.apache.org/" target="_blank" rel="noopener">Apache Maven</a> å®˜ç½‘ä¸Šçš„è¯´æ˜æ˜¯ï¼š<em>Apache Maven is a software project management and comprehension tool. Based on the concept of a project object model (POM), Maven can manage a projectâ€™s build, reporting and documentation from a central piece of information.</em>   ç¿»è¯‘è¿‡æ¥çš„åŸºæœ¬æ„æ€å°±æ˜¯ï¼š<strong>Mavenæ˜¯åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹(POM)ï¼Œå¯ä»¥é€šè¿‡ä¸€å°æ®µæè¿°ä¿¡æ¯æ¥ç®¡ç†é¡¹ç›®çš„æ„å»ºï¼ŒæŠ¥å‘Šå’Œæ–‡æ¡£çš„è½¯ä»¶é¡¹ç›®ç®¡ç†å·¥ å…·ã€‚</strong></p><a id="more"></a><h3 id="ä½¿ç”¨Mavenç®¡ç†é¡¹ç›®çš„å¥½å¤„"><a href="#ä½¿ç”¨Mavenç®¡ç†é¡¹ç›®çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨Mavenç®¡ç†é¡¹ç›®çš„å¥½å¤„"></a>ä½¿ç”¨Mavenç®¡ç†é¡¹ç›®çš„å¥½å¤„</h3><ol><li><p>å¯¹ç¬¬ä¸‰æ–¹ä¾èµ–åº“è¿›è¡Œç»Ÿä¸€çš„ç‰ˆæœ¬ç®¡ç†ã€‚</p><blockquote><p>åªè¦ç”¨äº†Mavenå°±ä¸ç”¨å†ä¸ºæ¯ä¸ªé¡¹ç›®å¤åˆ¶spring.jarå’Œhibernate.jaräº†ï¼ŒMavenä¼šåœ¨ä½ éœ€è¦çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŠŠè¿™äº›ç¬¬ä¸‰æ–¹ä¾èµ–åº“æ‰¾åˆ°ï¼Œä½ éœ€è¦ç¼–è¯‘ï¼ŒMavenå°±æŠŠè¿™äº›jaråŒ…æ”¾åˆ°classpathé‡Œï¼Œä½ éœ€è¦æ‰“åŒ…ï¼ŒMaven2å°±å¸®ä½ æŠŠéœ€è¦çš„jaråŒ…éƒ½å¤åˆ¶åˆ°WEB- INF/lib/ç›®å½•ä¸‹ã€‚</p></blockquote></li><li><p>ç»Ÿä¸€é¡¹ç›®çš„ç›®å½•ç»“æ„</p><blockquote><p> å¯ä»¥ä¿è¯æ‰€æœ‰é¡¹ç›®çš„ç›®å½•ç»“æ„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç›®å½•ç»“æ„ç»Ÿä¸€çš„å¥½å¤„å°±æ˜¯ï¼Œä½ è¦æ‰¾æºä»£ç å°±å»src/main/java/ä¸‹ï¼Œä½ è¦æ‰¾éœ€è¦æ”¾åˆ°classpathä¸‹çš„èµ„æºï¼Œå°±å»src/main/resources/ä¸‹ï¼Œä½ è¦æ‰¾å•å…ƒæµ‹è¯•å¯¹åº”çš„ä»£ç å’Œèµ„æºï¼Œå°±å»src/test/ä¸‹ã€‚æ¯ä¸ªç›®å½•ä¸‹æ”¾ä»€ä¹ˆä¸œè¥¿ï¼Œç¨‹åºç¼–è¯‘ï¼Œå‘å¸ƒçš„æ—¶å€™ï¼Œæ¯ä¸ªç›®å½•èµ·ä»€ä¹ˆä½œç”¨éƒ½å¾ˆæ¸…æ¥šæ˜äº†ï¼Œä¸ä¼šå‡ºç°æ‰“å¼€é¡¹ç›®æ‰¾ä¸åˆ°è¦æ‰¾çš„æ–‡ä»¶çš„æƒ…å†µã€‚</p></blockquote></li><li><p>ç»Ÿä¸€è½¯ä»¶æ„å»ºé˜¶æ®µ</p><blockquote><p>Maven2æŠŠè½¯ä»¶å¼€å‘çš„è¿‡ç¨‹åˆ’åˆ†æˆäº†å‡ ä¸ªç»å…¸é˜¶æ®µï¼Œæ¯”å¦‚ä½ å…ˆè¦ç”Ÿæˆä¸€äº›javaä»£ç ï¼Œå†æŠŠè¿™äº›ä»£ç å¤åˆ¶åˆ°ç‰¹å®šä½ç½®ï¼Œç„¶åç¼–è¯‘ä»£ç ï¼Œå¤åˆ¶éœ€è¦æ”¾åˆ° classpathä¸‹çš„èµ„æºï¼Œå†è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•éƒ½é€šè¿‡äº†æ‰èƒ½è¿›è¡Œæ‰“åŒ…ï¼Œå‘å¸ƒã€‚</p></blockquote></li><li><p>æ”¯æŒå¤šç§æ’ä»¶</p><blockquote><p>åœ¨<a href="http://maven.apache.com/å’Œhttp://mojo.codehaus.org/ä¸Šå¯ä»¥æ‰¾åˆ°å¤§é‡çš„Maven2æ’ä»¶ï¼Œé€šè¿‡è¿™äº›æ’ä»¶å¯ä»¥å®Œæˆå¤šç§å¤šæ ·çš„æ‰©å±•åŠŸèƒ½ã€‚" target="_blank" rel="noopener">http://maven.apache.com/å’Œhttp://mojo.codehaus.org/ä¸Šå¯ä»¥æ‰¾åˆ°å¤§é‡çš„Maven2æ’ä»¶ï¼Œé€šè¿‡è¿™äº›æ’ä»¶å¯ä»¥å®Œæˆå¤šç§å¤šæ ·çš„æ‰©å±•åŠŸèƒ½ã€‚</a></p></blockquote></li></ol><p>ä»¥ä¸Šåªæ˜¯æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œé™†ç»­ä¼šç”¨å®ä¾‹è¯æ˜ä»¥ä¸Šå¥½å¤„</p><h3 id="ä¸‹è½½åŠå®‰è£…Maven"><a href="#ä¸‹è½½åŠå®‰è£…Maven" class="headerlink" title="ä¸‹è½½åŠå®‰è£…Maven"></a>ä¸‹è½½åŠå®‰è£…Maven</h3><ol><li>è®¿é—®<a href="http://maven.apache.org/" target="_blank" rel="noopener">Maven</a> ä¸‹è½½ï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_download_maven.png" alt="down load Maven"><br/>                 </li><li>ä»¥Windows ç¯å¢ƒä¸ºä¾‹ï¼Œå°†ä¸‹è½½çš„<strong>apache-maven-3.3.9-bin.zip</strong> è§£å‹åˆ°æŸä¸€ç£ç›˜ç›®å½•ä¸‹ï¼Œ<strong>apache-maven-3.3.9</strong> ä½œä¸º<strong>MAVEN_HOME</strong> ç›®å½•ï¼Œ<br/>       </li><li>æ–°å»ºæœ¬åœ°Mavenä»“åº“ï¼ˆRepositoryï¼‰ï¼Œç¼–è¾‘<strong>apache-maven-3.3.9\conf\setting.xml</strong> æ–‡ä»¶ï¼Œåœ¨æœ¬åœ°å»ºç«‹ä»“åº“ï¼ˆä»»æ„ä¸€æ¬¡ç›˜æ–‡ä»¶å¤¹ä¸‹å³å¯ï¼‰<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_mavenRepo.png" alt="Maven Repo"><br/>       </li><li>ç¯å¢ƒå˜é‡å¯é…ç½®ä¹Ÿå¯ä¸é…ç½®ï¼Œå¦‚æœç”¨åˆ°å‘½ä»¤è¡Œå¿…é¡»è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚<blockquote><ol><li>æ–°å»ºç³»ç»Ÿå˜é‡MAVEN_HOME, å¹¶æŒ‡å®šç›®å½•ï¼šE:\Java_Web\apache-maven-3.3.9-bin\apache-maven-3.3.9</li><li>ç¼–è¾‘ç³»ç»Ÿå˜é‡Pathï¼Œå¢åŠ %MAVEN_HOME%\bin;</li><li>å‘½ä»¤è¡Œä¸‹ï¼ˆcmdï¼‰æ£€æµ‹Maven ç‰ˆæœ¬ï¼š mvn -v  </li></ol><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_mavenEnv.png" alt="maven_env_configuration"></p></blockquote></li></ol><h3 id="Eclipseä¸‹é…ç½®Maven"><a href="#Eclipseä¸‹é…ç½®Maven" class="headerlink" title="Eclipseä¸‹é…ç½®Maven"></a>Eclipseä¸‹é…ç½®Maven</h3><ol><li>ç°åœ¨æ–°ç‰ˆæœ¬çš„Eclipseå·²ç»é›†æˆäº†Mavenæ’ä»¶ï¼Œåœ¨Windows-Preferences-MavenèŠ‚ç‚¹ä¸‹çš„Installationsæ·»åŠ Maven, æœ€å<strong>å‹¾é€‰ä¸Šæ·»åŠ çš„Maven</strong>ã€‚<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_addMaven.png" alt="Add Maven"><br/>       </li><li>åœ¨Windows-Preferences-MavenèŠ‚ç‚¹ä¸‹çš„User Settingè®¾ç½®setting.xml æ–‡ä»¶<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_mavenSetting.png" alt="User Setting"><br/>       ### æ–°å»ºMaven Web Project</li><li>é¼ æ ‡é‚®ä»¶New Maven Project<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_new_maven1.png" alt="step1"><br/></li><li>é€‰æ‹©Artifact ID<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_new_maven2.png" alt="step2"><br/></li><li>å¡«å†™required text<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_new_maven3.png" alt="step3"><br/></li><li>pom.xml ä¸Šé¼ æ ‡é‚®ä»¶run as <strong>Maven install</strong>, ä¼šå‘ç°å…³äºè¿™ä¸ªé¡¹ç›®çš„waråŒ…åœ¨Mavenä»“åº“ä¸­å·²ç»ç”Ÿæˆ<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_3_Maven_new_maven4.png" alt="step4"></li></ol><h3 id="å¸¸ç”¨MVNå‘½ä»¤"><a href="#å¸¸ç”¨MVNå‘½ä»¤" class="headerlink" title="å¸¸ç”¨MVNå‘½ä»¤"></a>å¸¸ç”¨MVNå‘½ä»¤</h3><blockquote><ol><li>mvn  help:system è‡ªåŠ¨åœ¨æœ¬ç”¨æˆ·ä¸‹åˆ›å»º   ~/.m2/repository</li><li>mvn clean compile     æ¸…ç†ç¼–è¯‘</li><li>mvn clean test  æ¸…ç†æµ‹è¯•</li><li>mvn clean package æ¸…ç†æ‰“åŒ…</li><li>mvn clean install  æ¸…ç†å°†æ‰“åŒ…å¥½çš„jarå­˜å…¥ æœ¬åœ°ä»“åº“  æ³¨æ„æ˜¯æœ¬åœ°ä»“åº“</li><li>mvn archetype:generate ä½¿ç”¨Archetypeç”Ÿæˆé¡¹ç›®éª¨æ¶</li><li>mvn clean deploy  æ ¹æ®pomä¸­çš„é…ç½®ä¿¡æ¯å°†é¡¹ç›®å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ä¸­</li></ol></blockquote><h3 id="Mavené¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜"><a href="#Mavené¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜" class="headerlink" title="Mavené¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜"></a>Mavené¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜</h3><blockquote><ol start="2"><li>src/main/java :æ­£å¼å†…å®¹åŒ…è·¯å¾„</li><li>src/mian/resources :æ­£å¼çš„é…ç½®æ–‡ä»¶è·¯å¾„</li><li>src/test/java :æµ‹è¯•åŒ…è·¯å¾„</li><li>src/test/resources :æµ‹è¯•çš„é…ç½®æ–‡ä»¶è·¯å¾„</li><li>src/main/webapp : war èµ„æºç›®å½•</li></ol></blockquote><h3 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h3><p>æ›´å¤šå…³äº<a href="http://mark.leanote.com/post/%E4%BD%BF%E7%94%A8IntelliJ-IDEA-14%E5%92%8CMaven%E5%88%9B%E5%BB%BAjava-web%E9%A1%B9%E7%9B%AE" target="_blank" rel="noopener">IntelliJ IDEA ä¸‹åˆ›å»ºMavené¡¹</a></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>English</title>
      <link href="//p/spoken-english.html"/>
      <url>//p/spoken-english.html</url>
      
        <content type="html"><![CDATA[<h3 id="è¿è¯»"><a href="#è¿è¯»" class="headerlink" title="è¿è¯»"></a>è¿è¯»</h3><ol><li><p><strong>Youâ€™re gonna wanna get more experiences before you apply</strong>    </p><blockquote><p>before å¯ä»¥è¯»æˆ /b fÉ”r/ï¼Œ youå’Œapplyä¹‹é—´åŠ wçš„éŸ³</p></blockquote></li><li><p><strong>I just wanted to have a look at her resume before you hired her</strong>     </p><blockquote><p>wanted to è¯»æˆ /wa nI tÉ™/ï¼Œ nt+vowel,çœt wanted=/wÉ‘ntÉªd/=/wÉ‘nÉªd/,  at her è¯»æˆ/Ã¦ dÉ™r/   hired her åŒç†ä¸å‘hçš„éŸ³</p></blockquote></li><li><p>*<em>Give up or make decision because you canâ€™t have it both ways *</em></p><blockquote><p>give up or è¯»æˆ/gÉª vÊŒ pÉ™r/ , because è¯»æˆ/kÉ”z/, åŒæ—¶æ³¨æ„ canâ€™tå’Œcançš„è¯»éŸ³åŒºåˆ«</p></blockquote></li><li><p><strong>Didnâ€™t it <em>seem</em> kinda cold last night</strong></p><blockquote><p>Didnâ€™t it /dÉª dÉªn nÉª/</p></blockquote></li><li><p><strong>And your daddy didnâ€™t understandï¼Ÿ</strong></p><blockquote><p>/ É™ njÉ™r dÃ¦ di dÉª â€˜É™ nÊŒn dÉ™r sdÃ¦nd?/</p></blockquote><a id="more"></a></li><li><p><strong>How does he expect me to buy stuff</strong></p><blockquote><p>/ hÉ‘u dÊŒ ziks bekt mi dÉ™ bÉ‘i sdÊŒf?/</p></blockquote></li><li><p><strong>Youâ€™re probably gonna wanna train the new intern because he is hopeless**</strong></p><blockquote><p>probableå¯ä»¥çœç•¥ä¸­é—´çš„bçš„éŸ³ /â€˜prÉ‘bÉ™li/  new internä¹‹é—´åŠ wçš„éŸ³ï¼Œ  because he is /kÉ” zÉªs/</p></blockquote></li><li><p><strong>Look Iâ€™m really tired, so can we go home?</strong></p><blockquote><p>look Iâ€™m /lÊŠ kai m/</p></blockquote></li><li><p><strong>Who else wants to see a movie?</strong></p><blockquote><p>who else ä¸­é—´æœ‰wçš„éŸ³  see a ä¸­é—´æœ‰jçš„éŸ³</p></blockquote></li><li><p><strong>Oh,we do, but not just yet.</strong></p><blockquote><p>/Ouwi dÂµ, bÊŒâ€™ nÉ‘â€™ dÊ’ÊŒ sjeâ€™/</p></blockquote></li><li><p><strong>But it wonâ€™t work out</strong></p><blockquote><p>/bÊŒâ€™Éªâ€™ wounâ€™ wÉ™r kÉ‘uâ€™/</p></blockquote></li><li><p><strong>This might be a bad idea</strong></p><blockquote><p>be a ä¸­é—´æœ‰jçš„éŸ³    ideaä¸­é—´ä¹Ÿæœ‰jçš„éŸ³</p></blockquote></li><li><p><strong>But Iâ€™m gonna do it anyway</strong></p></li><li><p><strong>What if I had taken that job at Merrill Lynch?</strong></p><blockquote><p>/wÊŒ dÉª fÉ‘i hÃ¦â€™ tei kÉªn Ã°Ã¦â€™ dÊ’É‘ bÃ¦â€™ meÉ™r rÉ™l lintÊƒ? /</p></blockquote></li><li><p><strong>Well, why didnâ€™tyou take the job?</strong></p><blockquote><p>/Wel wÉ‘i dÉª â€˜É™n tÊƒÂµ teik Ã°É™ dÊ’É‘b/</p></blockquote></li><li><p><strong>Do you not wanna be seen with me?</strong></p><blockquote><p>/dÉ™ jÎ¼ nÉ‘â€™ wÉ‘ nÉ™bi sin wÉªÎ¸ mi?/</p></blockquote></li><li><p>** weâ€™renot gonna hide it anymore.**</p><blockquote><p>/wÉ™r nÉ‘â€™ gÊŒ nÉ™ hÉ‘i dÉª dÃ¦ ni mÉ”r /</p></blockquote></li><li><p><strong>Here, let me give it a shot</strong>   è®©æˆ‘è¯•ä¸€è¯•</p><blockquote><p>give it a shot /É¡Éª vÉª dÉ™ ÊƒÉ‘/</p></blockquote></li><li><p><strong>When are we gonna hang out?</strong> æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å‡ºå»ç©ä¸€ç©</p><blockquote><p>when are we /we nar wi/</p></blockquote></li><li><p><strong>This isnâ€™t what I wanted</strong></p><blockquote><p>wanted /wÉ‘nÉªd/</p></blockquote></li><li><p><strong>Matt canâ€™t be that fat, can he?</strong></p><blockquote><p>é‡éŸ³ï¼š canâ€™tã€ thatï¼Œ can he /cÃ¦ni/</p></blockquote></li><li><p><strong>Itâ€™dâ€™ve been nice to go out today</strong></p><blockquote><p>Itâ€™dâ€™ve = It would have /Iâ€™ dI dIv/</p></blockquote></li><li><p><strong>when am I going to get promoted</strong></p><blockquote><p>when am I /we nÉ™ maÉª/</p></blockquote></li><li><p><strong>Is it a school night and she has a lot of homework to do?</strong></p><blockquote><p>/Éª zÉª dÉ™ sguÉ™l nÉ‘iâ€™ É™n áµ—Êƒi hÃ¦ zÉ™ lÉ‘ dÉ™ houmwÉ™rk tÉ™ dÂµ/</p></blockquote></li><li><p><strong>Whenâ€™s her birthday?</strong></p><blockquote><p>/wen tsÉ™r bÉ™rÎ¸ dei/</p></blockquote></li><li><p><strong>Would you give it a rest</strong> ä½ çœçœå§ï¼Œä¼‘æ¯ä¸€ä¸‹å§ï¼Œ ï¼ˆä¸è¦å–‹å–‹ä¸ä¼‘äº†ï¼Œèƒ½åœåœå—ï¼‰</p></li><li><p><strong>He is gonna wish he was never born</strong></p><blockquote><p>wish he /wÉªÊƒi/ æ­¤å¤„çœç•¥h</p></blockquote></li><li><p><strong>could youâ€¦ hold out that ring and ask me to marry you?</strong></p><blockquote><p>/kÊŠ dÊ’Âµâ€¦ houl dÉ‘uâ€™ Ã°Ã¦â€™ riÅ‹ Å‹É™nâ€¦ Ã¦s mi dÉ™ mÃ¦ rijÂµ?/ that å’¬èˆŒåœé¡¿ï¼Œç•¥è¯»</p></blockquote></li><li><p><strong>How much is it?</strong></p><blockquote><p>/hÉ‘u mÊŒ tÊƒÉª zÉªâ€™ ?/  é‡éŸ³åœ¨isä¸Š</p></blockquote></li><li><p><strong>I thought that it mattered what I said or where I said it</strong></p><blockquote><p>/É‘i Î¸É”â€™ Ã°Ã¦ dÉªâ€™ mÃ¦dÉ™rd wÊŒdÉ‘i sed, É”r weÉ™rrÉ‘ise dÉªâ€™/</p></blockquote></li><li><p><strong>He knows what itâ€™s about</strong></p><blockquote><p>/hi nou zwÊŒ dÉªtsÉ™ bÉ‘uâ€™/</p></blockquote></li><li><p><strong>You wanted it to be a surprise.</strong></p><blockquote><p>/ jÂµ wanÉª dÉªâ€™ tÉ™ bi jÉ™ sÓ™â€™praiz /</p></blockquote></li><li><p><strong>I never had a bike of my own</strong></p><blockquote><p>/É‘ine vÉ™r hÃ¦ dÉ™ bÉ‘i kÉ™ mÉ‘i Ê²oun /</p></blockquote></li><li><p><strong>Not really, I got to drag him around, too!</strong></p><blockquote><p>/ nÉ‘â€™rÉªlli, É‘i gÉ‘â€™ tÉ™ drÃ¦g hÉª mÉ™ rÉ‘unâ€™ tÂµ! /  (æ³¨æ„æ˜¯gÉ‘â€™ tÉ™ï¼Œ è¡¨ç¤ºâ€œæˆ‘ä¹Ÿæœ‰æ‹–ç€ä»–è·‘çš„â€ï¼Œ ä¸æ˜¯â€œæˆ‘å¾—æ‹–ç€ä»–è·‘â€)</p></blockquote></li><li><p><strong>Iâ€™m sorry we canâ€™t store your childhood things anymore.</strong></p><blockquote><p>/É‘im sÉ”r ri wi kÃ¦nâ€™ tsdÉ”r jÉ™r tÊƒÉ‘ild hÊŠâ€™ Î¸iÅ‹ ze nimÉ”r./</p></blockquote></li><li><p>** I used to love to play restaurant.**</p><blockquote><p>/É‘i jÂµs tÉ™ lÊŒv tÉ™ plei res dÉ™r rÉ”nâ€™/</p></blockquote></li><li><p><strong>Sheâ€™s not as pretty as she was when she was 29</strong></p><blockquote><p>/Êƒis nÉ‘ dÉ™z prÉª di Ê²Ã¦ Êƒi wÊŒz wen áµ—Êƒi wÊŒz twe ni nÉ‘in/</p></blockquote></li><li><p><strong>Ms. Greene would like to establish some ground rules before she comes out</strong></p><blockquote><p>/mÉªs grin wÊŠâ€™ lÉ‘ik tÂµ Ê·Éªs dÃ¦blÉªÊƒ sÊŒm grÉ‘unâ€™ ruÉ™lz bÉ™ fÉ”r Êƒi kÊŒm zÉ‘uâ€™/</p></blockquote></li><li><p><strong>No, I love it.Thank you</strong></p><blockquote><p>/nouÊ·É‘i lÊŒvÉªâ€™ Î¸Ã¦Å‹kjÂµ/</p></blockquote></li><li><p><strong>Now that youâ€™re a couple, we donâ€™t get two presents from you guys?</strong></p><blockquote><p>/nÉ‘uÃ°Ã¦â€™ jÉ™r rÉ™ kÊŒpÉ™l, wi dounâ€™geâ€™ tÂµprezÉªnáµ—s frÊŒ mjÂµ gÉ‘iz?/</p></blockquote></li><li><p><strong>you have got to try this cheesecake</strong></p><blockquote><p>/jÂµhÃ¦v gÉ‘â€™ tÉ™ trÉ‘i Ã°Éªs tÊƒiz keik /</p></blockquote></li><li><p><strong>Somebody sent it to us</strong></p><blockquote><p>/sÊŒmbÉ‘ di se nÉªâ€™ tÂµ Ê·ÊŒs/</p></blockquote></li><li><p><strong>Iâ€™ll be right with you</strong></p><blockquote><p>/É‘lbi rÉ‘iâ€™ wÉª Î¸jÂµ /</p></blockquote></li><li><p><strong>I was not staring at her</strong></p><blockquote><p>/É‘iwÊŒz nÉ‘â€™ tsdeÉ™r riÅ‹ Å‹Ã¦â€™ hÉ™r/</p></blockquote></li><li><p><strong>In college, Ross used to wear leg warmers!</strong></p><blockquote><p>/ Éªn kÉ‘ lÉªdÊ’, rÉ”s jÂµs tÉ™ weÉ™r le gwÉ‘É™r mÉ™rz/</p></blockquote></li><li><p><strong>Monica couldnâ€™t tell time â€™til she was 13</strong></p><blockquote><p>/mÉ‘ nÉª kÉ™ kÊŠ â€˜É™n tel tÉ‘i mÊŒn tÉªl Êƒi wÊŒz Î¸É™r tin/</p></blockquote></li><li><p><strong>We used to be very close</strong></p><blockquote><p>/ wi jÂµs tÉ™ bi ve ri klous/</p></blockquote></li><li><p><strong>Itâ€™s not a big deal!</strong></p><blockquote><p>/Éªts nÉ‘ dÉ™ bÉªâ€™ diÉ™l/</p></blockquote></li><li><p><strong>What did you say when you made up your vows?</strong></p><blockquote><p>/ wÊŒ dÉª dÊ’Âµ sei we njÂµ mei dÊŒâ€™ jÉ™r vÉ‘uz?/</p></blockquote></li><li><p><strong>I am supposed to be writing my vows and all I have is this!</strong></p><blockquote><p>/É‘im sÊŒ pous tÉ™ bi rÉ‘i diÅ‹ mÉ‘i vÉ‘uz É™ nÉ‘l lÉ‘ihÃ¦v Éªz Ã°Éªs./</p></blockquote></li><li><p><strong>Those boots are amazing</strong></p><blockquote><p>/Ã°ouz bÂµ tsÉ‘É™r rÉ™ mei ziÅ‹/</p></blockquote></li></ol><h3 id="é‡‘ç‰ŒéŸ³æ ‡"><a href="#é‡‘ç‰ŒéŸ³æ ‡" class="headerlink" title="é‡‘ç‰ŒéŸ³æ ‡"></a>é‡‘ç‰ŒéŸ³æ ‡</h3><ol><li><strong>/v/</strong><blockquote><p>åŒâ€œé£â€çš„å£å‹ï¼Œå–‰å’™éœ‡åŠ¨</p></blockquote></li></ol><p><strong><em>never ever over very give have love everything every even move believe leave everybody haven live five everyone whatever drive leaving moving alive movie giving forever lovely given evening cover seven leaving loved voice above evil save government forgive private</em></strong></p><ol start="2"><li><strong>/Ã°/</strong><blockquote><p>èˆŒå¤´æ”¾åœ¨ä¸Šä¸‹é½¿ä¹‹é—´æˆ–è€…èˆŒå¤´é¡¶åœ¨ç‰™é½¿ä¸Šï¼Œå–‰å’™éœ‡åŠ¨</p></blockquote></li></ol><p><strong><em>the than those that other this these there then they  mother father another together brother though either rather others</em></strong></p><ol start="3"><li><p><strong>/Ê’/ /Êƒ/</strong></p><blockquote><p>è‹±æ–‡å•è¯ä»¥sion sure sual rsionä¸ºç»“å°¾çš„åŒ…å«Ê’éŸ³ï¼ŒåŒsheçš„å£å‹ï¼Œå˜Ÿèµ·å˜´å”‡ï¼Œå–‰å’™éœ‡åŠ¨, æ³¨æ„ä¸åŒäºæ±‰è¯­çš„â€œæ¹¿â€</p><p><strong><em>conclusion confusion decision division occasion provision television vision</em></strong><br><strong><em>exposure measure pleasure disclosure, enclosure, leisure, treasure</em></strong><br><strong>*usual visual casual *</strong><br><strong><em>aversion conversion dispersion immersion perversion version</em></strong><br><strong><em>action cooperation inflation situation appreication</em></strong></p></blockquote></li><li><p><strong>/ai/ /au/ /n/</strong></p><blockquote><p> <strong>å‘/n/ èˆŒå¤´è¦è´´ä¸Šé¢š</strong><br> /ai/  é˜¿å§¨<br> <strong>behind bind blind wind find mind</strong></p><p>/au/  å•Šå±‹   /aun/ è”æƒ³â€œäº‘â€å­—<br><strong>bound hound count mount pound found down brown town downtown</strong></p></blockquote></li><li><p><strong>/â€˜É™n/</strong></p><blockquote><p>/É™/ å˜´å·´å…¨éƒ¨æ”¾æ¾å–‰å’™éœ‡åŠ¨ï¼Œ å¾ˆæ‡’å¾ˆæ”¾æ¾çš„â€œé¥¿â€</p><p><strong>certain certainly  fountain(å–·æ³‰ï¼Œæ³‰æ°´) mountain curtainï¼ˆçª—å¸˜ï¼‰ shorten written bitten gotten sweetenï¼ˆå‡è½»ï¼Œä½¿å˜ç”œï¼‰ forgottten kitten(å°çŒ«) mitten(æ‰‹å¥—)</strong><br>/tÉ™n/ é€šå¸¸drop t</p></blockquote></li><li><p><strong>/â€˜É™l/</strong></p><blockquote><p>/É™/ å˜´å·´å…¨éƒ¨æ”¾æ¾å–‰å’™éœ‡åŠ¨ï¼Œ å¾ˆæ‡’å¾ˆæ”¾æ¾çš„â€œé¥¿â€ /l/ èˆŒå°–å‘ä¸Šå·ç¢°åˆ°ç‰™é½¿, å˜´å”‡ä¸åŠ¨ï¼Œ æ‹‰é•¿â€œæ¥¼â€çš„éŸ³</p><p>*<em>people able pull bicycle table uncle principle deal heal meal rural actural formal legal *</em></p></blockquote></li><li><p><strong>/r/</strong></p><blockquote><p>èˆŒå¤´å‘åä¸Šè½¬æ˜¯æ­£å¸¸çš„rï¼ˆåœ¨æœ«å°¾ï¼‰ åŠ¨ä½œå›å»å°±æ˜¯rçš„å¦ä¸€ä¸ªå‘éŸ³ï¼ˆåœ¨å¼€å¤´ï¼‰ï¼Œ é€šå¸¸r æ—¢åœ¨æœ«å°¾åˆè¦åœ¨å¼€å¤´éƒ½å‘éŸ³ï¼Œ å¦‚teacher is /titÊƒÉšr rIs/</p><p>råœ¨å¼€å¤´ï¼š rain ring read ride role room<br>råœ¨æœ«å°¾: wider easier higher dear poker</p></blockquote></li><li><p><strong>/t/ /d/</strong></p><blockquote><p>æ¸…è¾…éŸ³å’ŒæµŠè¾…éŸ³å°±æ˜¯å–‰å’™æœ‰æ²¡æœ‰éœ‡åŠ¨,ç”¨æ°”å¼¹é‚£ä¹ˆä¸€ä¸‹<br>talked take top installed leged learnt student</p></blockquote></li><li><p><strong>/ÊŠ/</strong></p><blockquote><p>ç±»ä¼¼äºâ€œé¥¿â€çš„è¯»éŸ³ï¼Œ ä½†æ˜¯æ²¡æœ‰â€œé¥¿â€è¿™ä¸ªéŸ³å–‰å’™é‚£ä¹ˆç”¨åŠ›</p><p><strong>good look book took hood cook could would should put</strong></p></blockquote></li><li><p><strong>/i/ /Éª/</strong></p><blockquote><p>å°†â€œå¶â€å­—åˆ†è§£.</p><p>*<em>it, fit hit bit itch(ç—’) lip sit *</em></p></blockquote></li></ol><h3 id="ç¾è¯­å£è¯­"><a href="#ç¾è¯­å£è¯­" class="headerlink" title="ç¾è¯­å£è¯­"></a>ç¾è¯­å£è¯­</h3><h4 id="2016-3-2-Future-World"><a href="#2016-3-2-Future-World" class="headerlink" title="2016.3.2 Future World"></a>2016.3.2 Future World</h4><p><strong>J: ** <em>Did u hear the Apple Pay is coming to China? It means we can *</em>pay with</strong> our Iphone, isnâ€™t that <strong>nifty*</strong></p><blockquote><p><strong>pay with</strong>: ç”¨â€¦ æ”¯ä»˜;     <strong>nifty</strong>: /â€˜nÉªfti/  </p></blockquote><p><strong>X:</strong> <em>Thatâ€™s pretty <strong>slick</strong>, <strong>who wouldâ€™ve thought that one day</strong> we could <strong>make payments</strong> with a mobile phone? Technology seems to make our lives better and better, what do u think the future <strong>has in store for</strong> us <strong>over</strong> the next 50 years</em></p><blockquote><p><strong>slick</strong> ç­‰åŒ niftyï¼Œè¡¨ç¤ºé«˜ç§‘æŠ€çš„å°ç‰©ä»¶æ¯”è¾ƒé…·<br><strong>who wouldâ€™ve thought that one dayâ€¦</strong>  è°èƒ½æƒ³åˆ°æœ‰ä¸€å¤©â€¦<br><strong>sth has/have in store for</strong> ç­‰åŒäº sth will happen in the future</p></blockquote><p><strong>J:</strong> <em>I think *</em>things** will continue to get smaller, Maybe one day our <strong>cellphone</strong> will be <strong>the size of a grain of rice*</strong></p><blockquote><p><strong>things</strong> æ—¥å¸¸çš„ä¸œè¥¿<br><strong>cellphone</strong>  åœ¨ç¾å›½æ‰‹æœºç»å¸¸ç”¨è¿™ä¸ªè¯<br><strong>the size of a grain of rice</strong> ç±³ç²’å„¿ä¸€æ ·çš„å¤§å°</p></blockquote><p><strong>X:</strong> * <strong>Thatâ€™d be pretty cool</strong>! Maybe  it will be <strong>implanted</strong> in our bodies, weâ€™ll see a greater <strong>integration</strong> between man and machine*</p><blockquote><p><strong>Thatâ€™d be pretty cool</strong>   ä¸€ç§çŒœæµ‹ï¼Œè™šæ‹Ÿè¯­æ°”<br><strong>implant</strong>  æ¤å…¥<br><strong>integration</strong>  é›†æˆ  ICå¡ï¼ˆIntegrated Circuit Cardï¼‰</p></blockquote><p><strong>J:</strong> <em>I think VR(virtual reality) is <strong>the next big thing</strong>, I bet <strong>stem cell</strong> research will <strong>make great strides</strong> as well, maybe we can grow a new in the lab(laboratory) organ instead of transplanting some elseâ€™s</em></p><blockquote><p><strong>the next big thing</strong> æˆä¸ºä¸»æµï¼Œsomething that is not popular now, but will be popular and mainstream in the future<br><strong>make great strides</strong> å–å¾—æ›´å¤§è¿›æ­¥<br><strong>stem cell</strong> å¹²ç»†èƒ</p></blockquote><p><strong>X:</strong> <em>Iâ€™d rather work than become a *</em>couch potato***</p><blockquote><p><strong>couch potato</strong>  æ²™å‘åœŸè±† æŒ‡æ‡’äºº</p></blockquote><h4 id="2016-3-7-Online-Learning"><a href="#2016-3-7-Online-Learning" class="headerlink" title="2016.3.7 Online Learning"></a>2016.3.7 Online Learning</h4><p><strong>X:</strong> <em>I thought you <strong>were supposed to</strong> have class now? what are you doing at your home?</em></p><blockquote><p>were supposed to æœ¬åº”è¯¥å¹²ä»€ä¹ˆå´æ²¡å¹²</p></blockquote><p><strong>J:</strong> <em>Iâ€™m having class, canâ€™t you see?</em></p><blockquote><p>have class ä¸Šè¯¾</p></blockquote><p><strong>X:</strong> <em>What do you mean? youâ€™re at home on your computer</em></p><blockquote><p>what do you mean? ä»€ä¹ˆæ„æ€ï¼Ÿ æœŸå¾…å¯¹æ–¹ç»™äºˆç­”æ¡ˆ<br>on your computer é¢å¯¹ç”µè„‘. Iâ€™m on my computer æˆ‘æ­£åœ¨ç”¨ç”µè„‘. on the internet ä¸Šç½‘. Iâ€™m on the bus æˆ‘åœ¨å…¬äº¤è½¦ä¸Š</p></blockquote><p><strong>J:</strong> <em>Come on, *</em>get with the times,** a lot of people are taking classes online now, itâ€™s perfect for <strong>workaholics(å·¥ä½œç‹‚)</strong> like me, <strong>not only that</strong>, you can go online and learn <strong>just about anything</strong>, right now, iâ€™m studying <strong>economics</strong>. The best thing is I can choose the time I want to study, the time isnâ€™t <strong>set in stone*</strong></p><blockquote><p>get with the times è·Ÿä¸Šæ—¶ä»£çš„æ½®æµ<br>take class = have class ä¸Šè¯¾ (where are you taking class? iâ€™m taking class online)<br>not only that ä¸ä»…å¦‚æ­¤<br>just about anything å‡ ä¹æ‰€æœ‰çš„äº‹æƒ…/ä¸œè¥¿ï¼Œ juståœ¨è¿™é‡ŒæŒ‡å‡ ä¹<br>economy ç»æµ economics ç»æµå­¦ economist ç»æµå­¦å®¶<br>set in stone è®¾ç½®åœ¨çŸ³å¤´ä¸Šï¼Œè¡¨ç¤ºâ€œå›ºå®š,æ°¸ä¹…ä¸å˜çš„â€ï¼Œ isnâ€™t set in stone ä¸å›ºå®š</p></blockquote><p><strong>X:</strong> <em>I had no idea that you could learn online</em></p><blockquote><p>have no idea æ˜¯å®Œå…¨ä¸çŸ¥é“ï¼Œ i donâ€™t know æœ‰æ—¶å€™è¿˜è¡¨ç¤ºä¸€äº›ä¸ç¡®å®šåœ¨é‡Œé¢</p></blockquote><p><strong>J:</strong> <em>You should <strong>jump on the bandwagon</strong> and study online too</em></p><blockquote><p>jump on the bandwagon è·Ÿä¸Šæ½®æµ.   keep up with trend, trendæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤§çš„è¶‹åŠ¿ï¼Œæ‰€ä»¥åƒä¸‡ä¸è¦å†™big trendï¼Œ  ä»æ±‰è¯­çš„è§£é‡Šbigå°±æ˜¯ç´¯èµ˜</p></blockquote><p><strong>X:</strong> <em>Iâ€™d love to, Maybe next semester I can pick some online classes, Right now my *</em>thesis** is <strong>driving me bonkers*</strong></p><blockquote><p>thesis /â€˜Î¸isÉªs/  æ¯”è¾ƒæ­£å¼çš„è®ºæ–‡<br>drive me bonkers/nuts/crazy è®©æˆ‘æŠ“ç‹‚</p></blockquote><p><strong>J:</strong> <em>What do you so <strong>stressed about</strong>? I thought you had the whole semester to get it done</em></p><blockquote><p>stress about æŠ“ç‹‚ï¼ˆä»€ä¹ˆä¸œè¥¿å‹ç€ä½ ï¼‰</p></blockquote><p><strong>X:</strong> <em>Yeah, I did, but I procrastinated until the very last minute, Now iâ€™m paying the price</em></p><blockquote><p>procrastinate /proâ€™krÃ¦stÉªnet/ è€½æã€å»¶è¿Ÿ<br>pay the price ä»˜å‡ºä»£ä»·</p></blockquote><p><strong>J:</strong> <em>Just take it easy, Rome is not built in a day, you know?</em></p><blockquote><p>Rome is not built in a day ç½—é©¬ä¸æ˜¯ä¸€å¤©å»ºæˆçš„</p></blockquote><p><strong>J:</strong> * <strong>Good thing</strong> you are here, my computer <strong>crashed</strong>, now i canâ€™t <strong>boot</strong> it, I have to finish my homework <strong>by the end of the day</strong>, can you <strong>help me out</strong>ï¼Œ Iâ€™m really pressed for time with this homework*</p><blockquote><p>good thing å¹¸äºï¼Œ ç±»ä¼¼äºthanks god.<br>crashed å¯ä»¥è¡¨ç¤ºç”µè„‘æ­»æœº<br>boot å¯åŠ¨ boot an electronic device (å¯åŠ¨ç”µå­è®¾å¤‡)<br>by the end of the day æˆªæ­¢åˆ°ä»Šå¤©<br>help me out å¸®æˆ‘æ¸¡è¿‡éš¾å…³/å›°éš¾<br>pressed for time æ—¶é—´ç´§è¿«</p></blockquote><p><strong>X:</strong> * <strong>You scratch my back, I will scratch your back</strong>, itâ€™s only fair*</p><blockquote><p>you scratch my back, iâ€™ll scratch your back  ä½ æŒ æŒ æˆ‘éƒ½åèƒŒï¼Œæˆ‘æŒ æŒ ä½ çš„åèƒŒï¼ŒæŒ‡äº’å¸®äº’åŠ©</p></blockquote><p><strong>J:</strong> <em>Alright, you winï¼Œ It works, you really are *</em>a Jack of all trades***</p><blockquote><p>a Jack of all trades æŸäººå„ç§å·¥ä½œéƒ½å¹²å¾—å¾ˆå¥½ï¼Œä¸€ä¸ªä»€ä¹ˆéƒ½ä¼šåšçš„äºº è¡¨ç¤ºä»€ä¹ˆéƒ½ä¼š</p></blockquote><p><strong>X:</strong> <em>So you are gonna *</em>renege on our deal<strong>? <em>*thatâ€™s cold</em></strong></p><blockquote><p>renege on our deal/go back on your words/go back on your promise åæ‚”<br>thatâ€™s cold ä¸€ç§å¿ƒç†æè¿°ï¼Œ â€œå¤ªä¸é è°±äº†â€ å¿ƒç°æ„å†·</p></blockquote><h4 id="2016-3-10-Visiting-a-friend-in-the-hospital"><a href="#2016-3-10-Visiting-a-friend-in-the-hospital" class="headerlink" title="2016.3.10 Visiting a friend in the hospital"></a>2016.3.10 Visiting a friend in the hospital</h4><p><strong>J:</strong> <em>What a pleasant surprise</em></p><blockquote><p>Iâ€™m so happy to see you è¡¨ç¤ºéå¸¸é«˜å…´</p></blockquote><p><strong>X:</strong> <em>How ya doinâ€™, Sis? I thought Iâ€™d pay you a visit, I bet you are pretty lonely here in the hospital all by yourself</em></p><blockquote><p>How are you doing? åœ¨å£è¯­ä¸­å¯ä»¥è¯´ How ya doinâ€™, è¡¨ç¤ºé—®å€™â€œæ€ä¹ˆæ ·äº†â€<br>pay a visit to sb = pay sb a visit (æ‹œè®¿æŸäºº)</p></blockquote><p><strong>J:</strong> <em>Thatâ€™s so sweet of you, my mom just left a few minutes ago, Iâ€™m surprised you didnâ€™t bump into her as you were coming up</em></p><blockquote><p>so sweet of you = so kind of you (ä½ çœŸå¥½)<br>bump into sb (å¶ç„¶é‡åˆ°æŸäººï¼Œ å¼ºè°ƒå¶ç„¶æ€§)</p></blockquote><p><strong>X:</strong> <em>Oh rats, That wouldâ€™ve been great to catch up with her, I havenâ€™t seen her in ages, anyways, howâ€™d your operation go?</em></p><blockquote><p>oh rats çœŸå¯æƒœï¼Œå¾ˆå¯æƒœ<br>catch up with sb (Talk with someone who you havenâ€™t seen in a long time å’Œå¾ˆä¹…æ²¡è§çš„äººå” å—‘èŠå¤©)<br>I havenâ€™t see her in ages (æˆ‘å¥½ä¹…æ²¡è§åˆ°å¥¹äº†ï¼Œ long time no see)<br>Howâ€™d (did) your operation/holiday/birthday go? (â€¦ è¿‡å¾—æ€ä¹ˆæ ·)ï¼Ÿ</p></blockquote><p><strong>J:</strong> <em>It was success, The doctor said I will be back to normal in no time, Although, iâ€™m feeling a little woozy(å¤´æ™•) from the anesthesia(éº»è¯)</em></p><blockquote><p>I will be back to normal in no time = Iâ€™ll get back on my feet soon = Iâ€™ll fully recover soon<br>anesthesia /,Ã¦nÉ™sâ€™Î¸iÊ’É™/ éº»è¯</p></blockquote><p><strong>X:</strong> <em>Thatâ€™s a relief, I wouldâ€™ve come earlier had I known</em></p><blockquote><p>Thatâ€™s a relief (é‚£æˆ‘å°±æ”¾å¿ƒäº†)</p></blockquote><p><strong>J:</strong> <em>Two days ago, I was helpig my mom do the dishes when I slipped and fell on my knee,Thankfully, we didnâ€™t have to call ambulance, my mom rushed me to the ER(emergency room)</em></p><blockquote><p>do the dishes æ´—ç¢—<br>thankfully éå¸¸å¹¸è¿åœ°<br>rush sb to smw = send sb smw quickly (é£é€Ÿçš„æŠŠæŸäººé€åˆ°æŸåœ°)</p></blockquote><p><strong>X:</strong> <em>Good thing your mom was there to help you out. I brought you some stuff to munch on, beef jerky, your favorite</em></p><blockquote><p>munch on = to snack on = to eat<br>beef jerky ç‰›è‚‰å¹²  pork jerky çŒªè‚‰å¹²</p></blockquote><p><strong>J:</strong> <em>This will make me feel even better, I should stay in the hospital a little longer, I donâ€™t mind being pampered by you</em></p><blockquote><p>pamper /â€˜pÃ¦mpÉš/ to take really good care of someone ç²¾å¿ƒç…§æ–™</p></blockquote><p><strong>X:</strong> <em>Is there anything I can do for you</em> (å¸¸ç”¨å£è¯­ï¼Œ æˆ‘èƒ½ä¸ºä½ åšäº›ä»€ä¹ˆäº‹æƒ…å—)<br><strong>J:</strong> <em>You can go pick up some medicine for me at drug store, take this prescription and get me three bottles of painkillers and three bottles of penicillin, The drug store is on the first floor to the left of entrance, on your way back, help me ask the nurse on duty, if Iâ€™ll be able to come home tomorrow</em></p><blockquote><p>drug store = pharmacy ï¼ˆè¯æˆ¿ï¼‰<br>prescription å¤„æ–¹ï¼Œ painkiller æ­¢ç—›è¯ï¼Œ penicillin é’éœ‰ç´ <br>The drug store is on the first floor to the left of entrance  ï¼ˆæ³¨æ„æç»˜æ–¹ä½ï¼‰<br>on your way back åœ¨ä½ å›æ¥çš„è·¯ä¸Š<br>on duty  å€¼ç­</p></blockquote><h4 id="2016-3-14-Negotiating-with-Landlords"><a href="#2016-3-14-Negotiating-with-Landlords" class="headerlink" title="2016.3.14 Negotiating with Landlords"></a>2016.3.14 Negotiating with Landlords</h4><p><strong>L:</strong> <em>After seeing the apartment, are you satisfied with everything?</em></p><blockquote><p>be satisfied with å¯¹â€¦ æ»¡æ„<br>look for a house/place æ‰¾æˆ¿å­</p></blockquote><p><strong>X:</strong> <em>I think so, I just have a few questions if you donâ€™t mind</em></p><blockquote><p>if you donâ€™t mind å¦‚æœä½ ä¸ä»‹æ„ï¼Œä¸€ç§éå¸¸å®¢æ°”çš„è¯´æ³•ï¼Œå¯ä»¥æ”¾åœ¨å¥å­å¼€å¤´ä¹Ÿå¯ä»¥æ”¾åœ¨å¥å­æœ«å°¾</p></blockquote><p><strong>L:</strong> <em>Okay, shoot</em></p><blockquote><p>shoot éå¸¸å£è¯­åŒ–çš„è¡¨è¾¾â€œè¯·ç›´è¯´ï¼Œä½†è¯´æ— å¦¨ï¼Œé—®å§â€</p></blockquote><p><strong>X:</strong> <em>Iâ€™m on the fence about choosing the big room or the small room, they are both very nice</em></p><blockquote><p>Iâ€™m on the fence about sth/doing sth è¡¨ç¤ºâ€œä¸å¤§ç¡®å®šï¼Œè¿˜åœ¨çŠ¹è±«â€<br>to sit on the fence  â€œå¢™å¤´è‰â€œçš„æ„æ€  he is to sit on the fence</p></blockquote><p><strong>L:</strong> <em>If I were you, Iâ€™d pick the bigger room, itâ€™s closer to the bathroom and the view is facing the city, itâ€™s really the best of both worlds</em></p><blockquote><p>the view is facing the city çª—å­å†²ç€å¸‚åŒºæ™¯è‰²<br>itâ€™s really the best of both worlds ä¸¤å…¨å…¶ç¾</p></blockquote><p><strong>X:</strong> <em>Youâ€™re right, Iâ€™m a sucker for beautiful scenery, Okay, iâ€™m sold, the big room it is, whatâ€™s the next step?</em></p><blockquote><p>Iâ€™m a sucker for sth æˆ‘å¯¹â€¦ æ²¡æœ‰æŠµæŠ—åŠ›<br>iâ€™m sold æˆ‘è¦äº†/æˆ‘ä¹°äº†<br>the big room it is å°±æ˜¯è¿™ä¸ªå¤§æˆ¿é—´äº†ï¼Œ .. it is è¡¨ç¤ºå°±æ˜¯.. äº†   Pizza it is  å°±æ˜¯æŠ«è¨äº†</p></blockquote><p><strong>L:</strong> <em>If you are sure youâ€™d like to live here, we require that all of tenants sign a one year lease agreement, then I need your John Hancock here</em></p><blockquote><p>lease agreement ç§Ÿçº¦ï¼Œ  é€šå¸¸è¿ç”¨<br>John Hancock ç­¾å = autograph (æ‰€æœ‰ç­¾åçš„å•è¯éƒ½å¯ä»¥é€šç”¨åœ¨ä»»ä½•åœºåˆ)</p></blockquote><p><strong>X:</strong> <em>There you go, are we finished?</em><br><strong>L:</strong> <em>Thatâ€™s it, here is your key, youâ€™re free to move in anytime, if you have any question, please give us a call and weâ€™ll glad to assit you</em></p><blockquote><p>move in æ¬è¿›æ¥ï¼Œå…¥ä½</p></blockquote><p><strong>L:</strong> <em>Hello, Mr. Gao, how is the new apartment?</em><br><strong>X:</strong> <em>Well.. itâ€™s great, but there is a slight problem</em></p><blockquote><p>slight problem å°é—®é¢˜ï¼Œä¸€ç§å§”å©‰çš„è¯´æ³•</p></blockquote><p><strong>Lï¼š</strong> <em>Whatâ€™s the matter?</em><br><strong>X:</strong> <em>Thereâ€™s a huge pest(å®³è™«ã€è™«å­ã€æœ‰å®³ä¹‹ç‰©) problem in the kitchen, Iâ€™m worried that it might come into my room *<br><strong>L:</strong> *What kind of pests are we talking about?</em><br><strong>X:</strong> <em>Roaches</em></p><blockquote><p>roach (èŸ‘è‚) å…¨ç¨‹cockroach</p></blockquote><p><strong>L:</strong> <em>Iâ€™m very sorry to hear that, have you tried cleaning the kitchen thoroughly(å½»åº•åœ°ï¼Œå®Œå…¨åœ°)</em><br><strong>X:</strong> <em>Thatâ€™s why I came here, isnâ€™t there something that you can do?</em><br><strong>L:</strong> <em>Iâ€™m afraid not</em><br><strong>X:</strong> <em>But you are my landlord, I thought your slogan was â€œabove and beyond the call of dutyâ€</em></p><blockquote><p>slogan å£å·<br>above and beyond the call of duty ç«­å°½å…¨åŠ›åšæŸäº‹ï¼Œå…¨å¿ƒå…¨æ„åšæŸäº‹</p></blockquote><p><strong>L:</strong> <em>You mustnâ€™t have read the fine print in the contract. it says here on line 217 that we are not responsible for any bug infestations</em></p><blockquote><p>fine print å°å­—ä½“ large print å¤§å­—ä½“<br>infestation /ÉªnfÉ›sâ€™teÊƒÉ™n/  æ„ŸæŸ“ï¼Œä¾µæ‰°</p></blockquote><p><strong>X:</strong> <em>I seeï¼Œ in that case, Iâ€™ll have to hire a prefessional to get rid of the bugs</em></p><blockquote><p>in that case é‚£ä¹ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹<br>get rid of æ¸…é™¤..</p></blockquote><h4 id="2016-3-16-House-of-Cards"><a href="#2016-3-16-House-of-Cards" class="headerlink" title="2016.3.16 House of Cards"></a>2016.3.16 House of Cards</h4><p><strong>J:</strong> <em>Hi,Xiaogao, why do you have those bags under your eyes, have you not been sleeping well lately?</em></p><blockquote><p>bags under oneâ€™s eyes = to have dark shadows under oneâ€™s eyes, usually from a lack of sleep (ç”±äºç¡çœ ä¸è¶³å¯¼è‡´çš„é»‘çœ¼åœˆ)</p></blockquote><p><strong>X:</strong> <em>You can say that</em></p><blockquote><p>you can say that (ä½ å¯ä»¥è¿™ä¹ˆè¯´ï¼‰ ç­‰åŒäºyesï¼Œè¡¨ç¤ºè‚¯å®š</p></blockquote><p><strong>J:</strong> <em>Care to elaborate?</em></p><blockquote><p>care to elaborate = can you please explain?  èƒ½è§£é‡Šä¸€ä¸‹å—ï¼Ÿ è¯¦ç»†è¯´è¯´ï¼Ÿ</p></blockquote><p><strong>X:</strong> <em>Iâ€™ve been binging on House of Cards lately, season 4 came out last week, and my eyes have been glued to the screen ever since</em></p><blockquote><p>binge on sth/doing sth = to over indulge in sth è¿‡æ¸¡åšæŸäº‹ï¼Œ è¿™é‡ŒæŒ‡ç–¯ç‹‚è¿½å‰§çº¸ç‰Œå±‹<br>binge drinking (é…—é…’ï¼Œè±ªé¥®)<br>come out ä¸Šæ˜ ï¼Œ å¤šç”¨äºå½±ç‰‡<br>oneâ€™s eyes have been glued to the screen = to be infatuated with a movie or show to the point where you donâ€™t want to do anything çœ¼ç›è´´åœ¨å±å¹•ä¸Šäº†ï¼Œæ„æŒ‡æ²‰è¿·äºç”µå½±æˆ–ç”µè§†èŠ‚ç›®è€Œæ— å¿ƒåšå…¶ä»–äº‹</p></blockquote><p><strong>J:</strong> <em>Season 4 is already out? I just remember just a few years ago when the first season came out back in early 2013. It seems like just yesterday</em></p><blockquote><p>It seems like just yesterday ï¼ˆused to refer to something that isstill fresh in oneâ€™s memoryï¼‰ æå¦‚æ˜¨æ—¥çš„æ„Ÿè§‰</p></blockquote><p><strong>X:</strong> <em>Yeah, Iâ€™m hooked on it, I think it is so cool that Netflix was able to make such a successful online-only web television series, They really broke new grounds</em></p><blockquote><p>Be hooked on sth = to be addicted to sth æ²‰è¿·äºæŸäº‹ï¼Œä¸Šç˜¾<br>hook up<br>online-only web television åªåœ¨ç½‘ç»œä¸Šæ’­æ”¾çš„ç½‘å‰§<br>break new grounds ï¼ˆto accomplish something that hasnâ€™t been accomplished beforeï¼‰ å®Œæˆä»æœªè¢«å®Œæˆè¿‡çš„äº‹ï¼Œå¸¸æŒ‡å¼€åˆ›æ–°å±€é¢</p></blockquote><p><strong>J:</strong> <em>Did you know the first season received nine prime time Emmy Award nominations, The whole world seems like to love this political drama</em></p><blockquote><p>receive .. award è·å¾—.. å¥–é¡¹<br>political drama ï¼ˆA drama series that has a political backgroundï¼‰ æœ‰æ”¿æ²»èƒŒæ™¯çš„å‰§é›†</p></blockquote><p><strong>X:</strong> <em>I think Kevin Spacey and Robin Wrightâ€™s acting is outstanding! The first three seasons kept me on the edge of my seat during each episode. I love Neve Campbellâ€™s performance in season 4! Sheâ€™s one of my favorite actresses of all time.</em></p><blockquote><p>outstanding è¿™é‡ŒæŒ‡æ¼”æŠ€å‡ºç¥å…¥åŒ–ï¼Œå¾ˆæ£’<br>[Something] keeps you on the edge of your seat = [something] is very suspenseful éå¸¸å…·æœ‰æ‚¬å¿µçš„æŸäº‹  è¿™é‡ŒæŒ‡å¾ˆåˆºæ¿€<br>of all time ä¸€ç›´ä»¥æ¥</p></blockquote><p><strong>J:</strong> <em>So, how is season 4? I heard there are some similarities(ç›¸ä¼¼ä¹‹å¤„) between season 4 and the American election campaign. Is that true?</em><br><strong>X:</strong> <em>Thatâ€™s right! There certainly are parallelsï¼ˆç›¸ä¼¼ä¹‹å¤„ï¼‰ between season 4â€™s script and the 2016 primary campaign. Are you sure you want me to go into specifics? It might spoilï¼ˆå‰§é€ï¼‰ it for you?</em></p><blockquote><p>Go into specifics = talk about something in detail (è¯¦ç»†è¯´ï¼Œä»”ç»†è§£é‡Š)</p></blockquote><p><strong>J:</strong> <em>On second thought, I think youâ€™d better wait until I watch itmyself.</em></p><blockquote><p>on second thought ç»è¿‡å†ä¸€æ¬¡è€ƒè™‘</p></blockquote><p><strong>X:</strong> <em>Well, all I can say is get ready for more suspense and nail-biting drama! Itâ€™s so fun to watch Frank Underwood climb up the ladder of power!</em></p><blockquote><p>all that I can say is = what I can say is ï¼ˆå…·ä½“æŸ¥çœ‹è¯­æ³•å®šè¯­ä»å¥ï¼‰<br>nail-biting (å’¬æŒ‡ç”²ï¼ŒæŒ‡éå¸¸åˆºæ¿€çš„å‰§æƒ…)<br>climb up the ladder = to ascend in rank, power, or status ï¼ˆå­—é¢çˆ¬ä¸Šæ¢¯å­ï¼Œæ„æŒ‡è¾¾åˆ°æŸç§æƒåŠ›)</p></blockquote><h4 id="2016-3-23-Artificial-Intelligence"><a href="#2016-3-23-Artificial-Intelligence" class="headerlink" title="2016.3.23 Artificial Intelligence"></a>2016.3.23 Artificial Intelligence</h4><p><strong>Jï¼š</strong> <em>I didnâ€™t know you played Go(å›´æ£‹)</em><br><strong>X:</strong> <em>I donâ€™t, but I really wanna learn it, Did you hear about the amazing archievement of Googleâ€™s AI robot AplhaGo?</em></p><blockquote><p>hear about å¬è¯´<br>archievement æˆå°±ï¼Œéå¸¸å¤§çš„è¯æ±‡ï¼Œè¡¨ç¤ºå¾ˆäº†ä¸èµ·çš„æˆæœ</p></blockquote><p><strong>J:</strong> <em>I heard about it, why are you so excited? *<br><strong>X:</strong> *Because itâ€™s the first AI program that could beat a professional player at the most complex board game mankindï¼ˆäººç±»ï¼‰ has ever created.</em></p><blockquote><p>board game æ£‹ç›˜æ¸¸æˆ</p></blockquote><p><strong>J:</strong> <em>I thought computers have been able to beat humans at chess for a long time, whatâ€™s the big deal?</em></p><blockquote><p>for a long time = in ages<br>whatâ€™s the big deal? æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œå¤šå¤§çš„äº‹</p></blockquote><p><strong>X:</strong> <em>Youâ€™re right, but there is a huge difference between chess and Go, computers could easily beat humans because itâ€™s way less complicated. computers donâ€™t need to be smart to win at chess, they just need to be fast, a computer  can use technique called brute forceto(BF) win at chess, this is not possible with Go, AlphaGo use reall AI called deep learning in order to solve problem.</em></p><blockquote><p>there is a huge difference between A and B   (A å’Œ Bæœ‰å¾ˆå¤§çš„ä¸åŒ)<br>way less complicated  (æ­¤å¤„çš„wayç›¸å½“äºvery /much)<br>deep learning (æ·±åº¦å­¦ä¹ )<br>win at sth ï¼ˆèµ¢å¾—ä»€ä¹ˆ/å–èƒœï¼‰</p></blockquote><p><strong>J:</strong> <em>I think I understand now, but why does this matter for mankind?</em></p><blockquote><p>why does this matter for mankind?   (ä½†æ­¤äº‹ä¸ºä½•å¯¹äººç±»äº‹å…³é‡è¦ï¼Ÿ)</p></blockquote><p><strong>X:</strong> <em>such as complex weather conditions,disease control, and global warming issues</em><br><strong>J:</strong> <em>I heard the AI robot only won 4 out of 5 matches. Does that mean that AI has room for improvement?</em></p><blockquote><p>4 out of 5 äº”åˆ†ä¹‹å››  å››åˆ†ä¹‹ä¸‰ï¼šthree fourths= three quarters äº”åˆ†ä¹‹ä¸‰ï¼šthree fifths  åˆ†æ•°çš„è¡¨è¾¾æ³•ï¼šåˆ†å­ç”¨åŸºæ•°è¯,åˆ†æ¯è¦ç”¨åºæ•°è¯,åˆ†å­å¤§äº1æ—¶,åˆ†æ¯çš„åºæ•°è¯ååŠ s.å¯¹äºå››åˆ†ä¹‹ä¸€,å¸¸ç”¨quarteræ¥è¡¨ç¤º.<br>sth has room for improvement  ï¼ˆsth è¿˜æœ‰è¿›æ­¥ç©ºé—´ï¼‰</p></blockquote><p><strong>X:</strong> <em>Thatâ€™s right. The robot isnâ€™t perfect, but it certainly impressed the entire world. Some of AlphaGoâ€™s moves were described as â€œbeautifulâ€ by Go fans.</em></p><blockquote><p>sth impressed sb  ï¼ˆ.. ç»™æŸäººç•™ä¸‹æ·±åˆ»å°è±¡ï¼‰<br>AlphaGoâ€™s moves  æ­¤å¤„çš„moveè¡¨ç¤ºæ£‹è·¯</p></blockquote><p><strong>J:</strong> <em>This is getting scary. Are robots going to take over the world?</em></p><blockquote><p>take over (æ§åˆ¶/æ¥ç®¡)</p></blockquote><p><strong>Xï¼š</strong> <em>Although Googleâ€™s AI victory marked a major milestone for artificial intelligence, the world is still a long way away from mimicing true human intelligence.</em></p><blockquote><p>mark a major milestone  (æ ‡è¯†ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘)<br>mimic /â€˜mÉªmÉªk/ vt. æ¨¡ä»¿ï¼Œæ‘¹æ‹Ÿ<br>A long way away fromâ€¦ = ä¸â€¦å·®å¾—å¾ˆè¿œ</p></blockquote><h4 id="2016-3-28-Horoscope"><a href="#2016-3-28-Horoscope" class="headerlink" title="2016.3.28 Horoscope"></a>2016.3.28 Horoscope</h4><p><strong>J:</strong> <em>Weâ€™ve already talked about the first six zodiac signs, I think itâ€™s time we talk about the last six . Pop quiz</em></p><blockquote><p>first six å‰å…­ä¸ª last six åå…­ä¸ª<br>pop quiz è€ƒè€ƒä½ </p></blockquote><p><strong>X:</strong> <em>These people love justice(å…¬æ­£) and fairnessï¼ˆå…¬å¹³ï¼‰ï¼Œ they also work well with other people</em></p><blockquote><p>work well with sb éå¸¸èæ´½çš„å’ŒæŸäººåˆä½œã€ é…åˆé»˜å¥‘</p></blockquote><p><strong>J:</strong> <em>Libras are known to be cooperative(æœ‰åˆä½œç²¾ç¥çš„), they donâ€™t like violenceï¼ˆæš´åŠ›ï¼‰ or injusticeï¼ˆä¸å…¬æ­£ï¼‰ of any kind.</em><br><strong>X:</strong> <em>Scorpios seem quiet and cool on the outside, but they are actually really emotional(å†…å¿ƒæ„Ÿæƒ…ä¸°å¯Œ) and passionate(å¯Œæœ‰æ¿€æƒ…) on the inside</em></p><blockquote><p>on the outside å¤–è¡¨  on the inside å†…å¿ƒ</p></blockquote><p><strong>J:</strong> <em>I heard they make really great leaders, they donâ€™t like being lied  to, so make sure youâ€™re always honest to a Scorpio</em></p><blockquote><p>make great leaders éå¸¸ä¼šåšé¢†å¯¼ æ³¨æ„makeçš„ç”¨æ³•</p></blockquote><p><strong>X:</strong> <em>Sagittarius are deep thinkers</em></p><blockquote><p>deep thinkers æ€æƒ³å®¶/æ€æƒ³è€…</p></blockquote><p><strong>J:</strong> <em>They are really extroverted and optimistic, itâ€™s hard for a Sagittarius to feel downï¼Œ weâ€™ve finally reached the last three zodiac signs(æ˜Ÿåº§)</em></p><blockquote><p>extroverted/introverted  (å¤–å‘çš„/å†…å‘çš„)<br>optimistic/pessimistic ï¼ˆä¹è§‚çš„/æ‚²è§‚çš„ï¼‰<br>feel down (ä¸å¼€å¿ƒï¼Œæƒ…ç»ªä½è½)<br>reach åˆ°è¾¾ï¼Œ åˆ°è¾¾äº†æœ€åä¸‰ä¸ªï¼Œå°±ä»£è¡¨å‰©ä¸‹ä¸‰ä¸ª</p></blockquote><p><strong>X:</strong> <em>These people is known for their professionalism and traditional values , they are really serious people</em></p><blockquote><p>professionalism and traditional values ï¼ˆä¸“ä¸šç²¾ç¥å’Œä¼ ç»Ÿä»·å€¼è§‚ï¼‰<br>serious people (ä¸¥è‚ƒè®¤çœŸçš„äººï¼Œ é«˜å†·)</p></blockquote><p><strong>J:</strong> <em>Letâ€™s move on, it should not surprise you that the symbol of Aquarius the water bearer,  they can also be boisterous and energetic. They love to lend a helping hand to those in need.</em></p><blockquote><p>it should not surprise you (æ¯«æ— ç–‘é—®ï¼Œä¸ä¼šè®©ä½ æ„Ÿåˆ°æƒŠè®¶)<br>boisterous /ËˆbÉ”Éª.stÉš.É™s/ å–§é—¹çš„, ç²¾åŠ›æ—ºç››çš„<br>lend a helping hand to sb å¸®åŠ©æŸäºº</p></blockquote><p><strong>X:</strong> <em>The Pisces is a very gentle and affectionate(æ·±æƒ…çš„ï¼Œæœ‰çˆ±å¿ƒçš„) person. They are there for you when you need to spill your guts. Why would I want to be like you?</em></p><blockquote><p>spill your guts è¯´å¿ƒé‡Œè¯<br>why would I wannt to be like you?  ä¸ºä»€ä¹ˆæˆ‘è¦åƒä½ ä¸€æ ·ï¼Ÿ</p></blockquote><p><strong>åäºŒæ˜Ÿåº§</strong> Aries /Ëˆer.iËz/ ç™½ç¾Šåº§ Taurus /ËˆtÉ”Ër.É™s/ é‡‘ç‰›åº§ Gemini /ËˆdÊ’em.É™.naÉª/ åŒå­åº§ cancer /ËˆkÃ¦n.sÉš/ å·¨èŸ¹åº§ Leo /ËˆliË.oÊŠ/ ç‹®å­åº§ Virgo /ËˆvÉË.É¡oÊŠ/  å¤„å¥³åº§ Libra /ËˆliË.brÉ™/ å¤©ç§¤åº§ Scorpio /ËˆskÉ”Ër.pi.oÊŠ/ å¤©èåº§ Sagittarius /ËŒsÃ¦dÊ’.É™Ëˆter.i.É™s/ å°„æ‰‹åº§ Capricorn  /ËˆkÃ¦p.rÉ™.kÉ”Ërn/ æ‘©ç¾¯åº§ Aquarius /É™Ëˆkwer.i.É™s/ æ°´ç“¶åº§ Pisces /ËˆpaÉª.siËz/ åŒé±¼åº§</p><h4 id="2016-3-30-Airport-English"><a href="#2016-3-30-Airport-English" class="headerlink" title="2016.3.30 Airport English"></a>2016.3.30 Airport English</h4><p><strong><em>Xiaogao is at the airport checking in(åŠç†ç™»æœº), Jingjing plays the part of the airline employee</em></strong><br><strong>J:</strong> <em>Hello sir, where are you flying today? (æ‚¨æ­¤è¡Œé£å¾€ä½•å¤„ï¼Ÿ)</em><br><strong>X:</strong> <em>Iâ€™m headed to Detroit.</em></p><blockquote><p>be headed to smw å‰å¾€æŸåœ°ï¼Œ ä¸èƒ½æŒ‡ä»å¤–åœ°å›å®¶<br>Head to = to go to å»ï¼ˆå¾€ï¼‰æŸåœ°</p></blockquote><p><strong>Jï¼š</strong> <em>Can I please see your passport? do you have any goods to declare?</em></p><blockquote><p>declare ç”³æŠ¥ï¼Œ æŒ‡è¿‡æµ·å…³çš„ç”³æŠ¥</p></blockquote><p><strong>Xï¼š</strong> <em>Hereâ€™s my passport, no goods to declare this time.</em><br><strong>J:</strong> <em>Okay, will you be checking in any bags?</em></p><blockquote><p>check in (æ—¢å¯ä»¥æŒ‡åŠç†ç™»æœºï¼Œä¹Ÿå¯ä»¥æŒ‡æ‰˜è¿è¡Œæï¼Œæ­¤å¤„æ˜¯åè€…)</p></blockquote><p><strong>X:</strong> <em>Yes, Just this one</em><br><strong>J:</strong> <em>Please place it on the scale, oh *</em>your bag is overweightï¼ˆè¶…é‡ï¼‰, Iâ€™m afraid youâ€™ll have to pay a small fee***</p><blockquote><p>place it on the scale(ç§¤: a device to measure weights) æŠŠå®ƒæ”¾åœ¨ç§¤ä¸Š<br>pay a small fee (æ­¤å¤„è¦ç”¨feeï¼Œ tipæŒ‡åƒå®Œé¥­ç»™çš„å°è´¹)<br>Iâ€™m afraid that ï¼ˆææ€•â€¦ï¼‰ Iâ€™m afraid of (å®³æ€•â€¦)  æ³¨æ„äºŒè€…çš„åŒºåˆ«</p></blockquote><p><strong>X:</strong> <em>Thatâ€™s fine, here you go(ç»™ä½ )</em><br><strong>J:</strong> <em>Hereâ€™s your boarding pass, youâ€™ll begin boarding at 10:05 at gate D12</em></p><blockquote><p>boarding pass (ç™»æœºç‰Œ)</p></blockquote><p><strong>X:</strong> <em>Thanks maâ€™am</em></p><blockquote><p>maâ€™am /mÉ‘Ëm/ å¯¹å¥³å£«é¥¿ä¸€ç§ç¤¼è²Œçš„ç§°å‘¼ï¼Œä¸åœ¨ä¹ç»“å©šä¸å¦</p></blockquote><p><strong><em>Xiao Gao is going through the security check. Jing Jing plays the part of the customs agent</em></strong></p><blockquote><p>go through é€šè¿‡<br>security check å®‰æ£€</p></blockquote><p><strong>J:</strong> <em>Please take your laptop out of your bag and place it in a bin</em>(æŒ‡å®‰æ£€çš„å°ç›’å­)<br><strong>X:</strong> <em>No problem, should I take my shoes off too?</em><br><strong>J:</strong> <em>Yes, sir, you can put your shoes in another bin, please step through the metal detector.</em></p><blockquote><p>step through ï¼ˆèµ°è¿‡ï¼‰ æ³¨æ„å’Œgo throughçš„åŒºåˆ«<br>metal detector ï¼ˆé‡‘å±æ¢æµ‹å™¨ï¼‰</p></blockquote><p><strong>X:</strong> <em>Iâ€™m gonna have to pat your down, do you have any metal items in your pockets?</em></p><blockquote><p>pat oneâ€™s down (å¾ˆå½¢è±¡çš„è¯´æ˜â€œæœæŸ¥èº«ä½“â€ï¼Œ åŸæ„æ˜¯æ‹æ‹ä½ çš„èº«ä½“)  to search someoneâ€™s clothes for items they shouldnâ€™t have</p></blockquote><p><strong>J:</strong> <em>No, I think it might be the belt buckle, itâ€™s made of metal.</em></p><blockquote><p>belt buckle (çš®å¸¦æ‰£)</p></blockquote><p><strong>X:</strong> <em>You are free to go, donâ€™t forget to grab your things</em></p><blockquote><p>grab sth ï¼ˆæ‹¿ä¸ŠæŸç‰©ï¼‰<br>grab a bite to eat/ grab sth to eat</p></blockquote><p><strong><em>Xiao Gao is onthe airplane getting ready to take off. Jing Jing plays the part of the stewardess(æŒ‡ç©ºå§)</em></strong></p><blockquote><p>Flight attendants/stewardess ç©ºä¹˜äººå‘˜</p></blockquote><p><strong>J:</strong> <em>Here is a hot towel(æ¯›å·¾) for you.Would you care for a pair of head phones?</em></p><blockquote><p>care for sth (éœ€è¦â€¦)<br>head phones (è€³æœº)</p></blockquote><p><strong>X:</strong> <em>I will take a pair(æŒ‡ä¸€å¯¹è€³æœº)ï¼Œ BTWï¼Œ could I have a cup of water, please?</em><br><strong>J:</strong> <em>Coming right up, and hereâ€™s some peanuts(èŠ±ç”Ÿ) and pretzelsï¼ˆæ¤’ç›è„†é¥¼ï¼‰ for you to snack on.</em></p><blockquote><p>coming right up (é©¬ä¸Šé€è¿‡æ¥)<br>snack on = munch on (é£Ÿç”¨, å½“é›¶é£Ÿåƒ)</p></blockquote><p><strong>X:</strong> <em>Thanks! Those are my favorite!</em></p><blockquote><p>favorite æ­¤å¤„æ˜¯å½¢å®¹è¯ä½œåè¯ï¼Œç›´æ¥å•æ•°å½¢å¼</p></blockquote><p><strong><em>The captain makes an announcementï¼ˆæœºé•¿å¼€å§‹å¹¿æ’­ï¼‰</em></strong><br><strong>Good morning ladies and gentlemen. This is your captain speaking. We have been cleared for takeoff(åè¯ï¼šèµ·é£). Weâ€™ll be leaving in just a few minutes. Please sit down and fasten your seatbelts. We expect to arrive in Detroit in 12 hours. Thank you for flying with Happy Airlines. Flight attendants, prepare for takeoff!</strong></p><p><strong>æ‰©å±•ç¿»è¯‘</strong></p><blockquote><ol><li>å“ªé‡Œæ˜¯è½åœ°ç­¾åŠç†å¤„ï¼Ÿ<br>Where can I find the visa on arrival office?</li><li>æˆ‘åœ¨28å·å®‰æ£€å£ç­‰å¾…å®‰æ£€<br>Iâ€™m waiting at gate 28 for a security check</li><li>å¯ä»¥å…è´¹æ‰˜è¿å¤šé‡çš„è¡Œæï¼Ÿ<br>Whatâ€™s the heaviest amount of luggage that we can check for free?</li><li>è½¬æœºæ—¶æ˜¯å¦éœ€è¦å–è¡Œæ?è¡Œæå¯ä»¥ç›´è¾¾ç›®çš„åœ°å—ï¼Ÿ<br>Do I have to grab my luggage during connecting flights? Can we send my luggage directly to my destination?</li><li>ç´§æ€¥å‡ºå£åœ¨å“ªå„¿ï¼Ÿ<br>Whereâ€™s the emergency exit?</li></ol></blockquote><h4 id="2016-4-6-Camping"><a href="#2016-4-6-Camping" class="headerlink" title="2016.4.6 Camping"></a>2016.4.6 Camping</h4><p><strong>J:</strong> <em>What are you gonna do for the weekend?</em></p><blockquote><p>what are you gonna do/what are you plans/what you have in mind for the weekend?   å‘¨æœ«æ‰“ç®—åšä»€ä¹ˆ</p></blockquote><p><strong>X:</strong> <em>I havenâ€™t decided yet, itâ€™s still up in the air as to whether Iâ€™ll go camping with my friends or go bike riding through the countryside(éƒŠå¤–).</em></p><blockquote><p>I havenâ€™t decided <strong>yet</strong>. ï¼ˆæ³¨æ„åŠ ä¸Šyetæ›´åŠ å®Œæ•´ï¼Œè¡¨ç¤ºâ€œæˆ‘è¿˜æ²¡æœ‰å†³å®šâ€ï¼‰<br>sth is still up in the air ï¼ˆæŸäº‹è¿˜æ²¡å†³å®šï¼Œæ­¤å¤„æ˜¯äº‹æ²¡ç¡®å®šï¼‰<br>sb is on the fence about sth ï¼ˆæŸäººè¿˜åœ¨çŠ¹è±«æŸäº‹ï¼Œ æ­¤å¤„æ˜¯äººåœ¨çŠ¹è±«ï¼‰<br>as to ï¼ˆè‡³äºâ€¦. ï¼‰</p></blockquote><p><strong>J:</strong> <em>Both of those things sound really tiring. why donâ€™t you stay in town and hang out with your friends?</em></p><blockquote><p>tiring: sth is tiring that makes you tired.<br>æ³¨æ„hang out å’Œ playçš„åŒºåˆ«, playè·Ÿå¤šçš„æ˜¯æŒ‡å°æœ‹å‹ä¹‹é—´çš„ç©è€ï¼Œhang out æŒ‡é€›è¡—ä¹‹ç±»çš„</p></blockquote><p><strong>X:</strong> <em>Iâ€™m an outdoorsman, I love nature, and besides, lately the weather has taken a turn for the better.</em></p><blockquote><p>outdoorsman  ï¼ˆæˆ·å¤–è¿åŠ¨æ§ï¼‰<br>take a turn ï¼ˆè½¬ä¸ªå¼¯ï¼Œå˜åŒ–ï¼‰ å¤šæ•°ç”¨äºå¤©æ°”/èº«ä½“ take a turn for the better/worse</p></blockquote><p><strong>J:</strong> <em>I guess different things make us happy, I use my weekend to catch some shuteye</em></p><blockquote><p>catch some shuteye (è¡¥è§‰)</p></blockquote><p><strong>X:</strong> <em>I think youâ€™d really like camping,how about we both go camping this weekend?</em><br><strong>J:</strong> <em>I donâ€™t know, is it expensive?</em><br><strong>X:</strong> <em>Not at all, but Iâ€™d appreciate some help with gas money. itâ€™s a long drive out to the campsite(åº¦å‡è¥åœ°)</em></p><blockquote><p>not at all (ä¸€ç‚¹ä¹Ÿä¸ï¼Œæ³¨æ„è¿è¯»)<br>Iâ€™d appreicate some help â€¦  éå¸¸å§”å©‰å®¢æ°”çš„è¯´æ³•<br>Itâ€™s a long drive out to the campsite/hospital/my mom house (å»..çš„è·¯ç¨‹å¾ˆè¿œ)</p></blockquote><p><strong>J:</strong> <em>Iâ€™ll spring for gas, can I help with anything else?</em></p><blockquote><p>spring (ä½œåŠ¨è¯è®²æ„æ€ï¼šæ‹¿å‡º..ä¸œè¥¿)  pay for = spring for the ticket/dinner   </p></blockquote><p><strong>X:</strong> <em>Iâ€™ll let you set up a tent, youâ€™ll love it</em></p><blockquote><p>set up a tent = pitch a tent ï¼ˆæ­å¸ç¯·ï¼‰</p></blockquote><p><strong>J:</strong> <em>It sounds like Iâ€™m getting the raw end of the deal, I heard that can be a lot of work</em></p><blockquote><p>get the raw end of the deal (raw ç”Ÿçš„ï¼Œ is not fairï¼Œ æ„æ€æ˜¯åƒäº†äºï¼Œæ‹¿åˆ°äº†ä¸å¥½çš„ä¸€ç«¯)</p></blockquote><p><strong>X:</strong> <em>Donâ€™t worry, Iâ€™ll help you through it. so are we on for the weekend?</em></p><blockquote><p>Iâ€™ll help you throught it = Iâ€™ll help you out (æˆ‘ä¼šå¸®ä½ æå®šå®ƒ)<br>are we on .. (æˆ‘ä»¬è¯´å®šäº†..å˜›ï¼Ÿ) are we on for tonight/the weekend? ï¼ˆè¯´å¥½ä»Šæ™š/å‘¨æœ«ï¼Ÿï¼‰</p></blockquote><p><strong>J:</strong> <em>weâ€™re on</em>  è¯´å®šäº†</p><p><strong>J:</strong> <em>You should have looked at the weather report before we left.I canâ€™t believe itâ€™s raining right now, this is the pits</em></p><blockquote><p>I canâ€™t believe itâ€™s raining/April 4<br>This is the pits (pit: the hole in the ground, è¡¨ç¤ºä¸ç†æƒ³çš„æƒ…å†µï¼Œ å¤ªç³Ÿç³•äº†)</p></blockquote><p><strong>X:</strong> <em>Donâ€™t worry, we still have a good time, hurry up and pitch the tent before we get any wetter.</em></p><blockquote><p>hurry up and pitch the tent before we get any wetter (å¿«æ¥ï¼Œåœ¨æˆ‘ä»¬æ·‹æ¹¿ä¹‹å‰æŠŠå¸ç¯·æ‰“èµ·æ¥ï¼Œæ³¨æ„æ­¤å¤„æ¯”è¾ƒçº§çš„è¿ç”¨ï¼Œæ›´åŠ åœ°é“)</p></blockquote><p><strong>J:</strong> <em>There a lot of poles(æ†å­), I donâ€™t know what to do first.</em><br><strong>X:</strong> <em>There is nothing to it, watch me, there, all done</em></p><blockquote><p>there is nothing to it (æ²¡éš¾åº¦ï¼Œå¾ˆç®€å•)</p></blockquote><p><strong>J:</strong> <em>I guess that wasnâ€™t so bad, so what are we supposed to do now? itâ€™s too cold and wet to be outside right now.</em><br><strong>X:</strong> <em>How about we make dinner in tent? I brought a portable stove and some ramen</em></p><blockquote><p>portable ï¼ˆå”¯ä¸€è¡¨ç¤ºâ€œä¾¿æºå¼â€çš„å•è¯ï¼‰<br>ramen æ‹‰é¢</p></blockquote><p><strong>J:</strong> <em>Now youâ€™re talking, cooking is right up my alley, ok, Xiaogao, just sit back and relax, iâ€™m gonna cook up a mean bowl of noodles.</em></p><blockquote><p>youâ€™re talking (å¤ªå¥½äº†ï¼Œå¾ˆåŒæ„è¿™ä¹ˆåšï¼Œè¡¨ç¤ºèµæˆ)<br>sth is right up oneâ€™s alley = sb is good at sth<br>a mean bowl/dish of sth (ä¸€ç¢—ç‰¹åˆ«å¥½åƒçš„â€¦)</p></blockquote><p><strong>X:</strong> <em>Hey, you should come camping more often! You seem like a pro!</em></p><blockquote><p>pro æ­¤å¤„è¡¨ç¤ºä¸“å®¶ï¼Œ æ³¨æ„å’Œprofessorçš„åŒºåˆ«ï¼Œ æ­¤å¤„ä¸èƒ½ç”¨professorï¼Œ proè¡¨ç¤ºå¾ˆä¸“ä¸š<br>more ofen è¡¨ç¤ºâ€œç»å¸¸â€</p></blockquote><p><strong>J:</strong> <em>What can I say? I guess Iâ€™m just good at everything I do!</em></p><blockquote><p>what can I say (æˆ‘èƒ½è¯´ä»€ä¹ˆå‘¢ï¼Ÿ å¾ˆç‚«è€€çš„ä¸€ç§è¯´æ³•)<br>Iâ€™m good at everything I do = Iâ€™m a Jack of all trades (æˆ‘ä»€ä¹ˆäº‹éƒ½èƒ½åšå¥½ï¼Œ æˆ‘æ˜¯ä¸ªå…¨æ‰)</p></blockquote><h4 id="2016-4-11-30-day-Challenge"><a href="#2016-4-11-30-day-Challenge" class="headerlink" title="2016.4.11 30-day Challenge"></a>2016.4.11 30-day Challenge</h4><p><strong>X:</strong> <em>My friends and I are gonna go see Zootopia and then go grab a bite to eat, you in?</em></p><blockquote><p>grab a bite to eat åƒç‚¹ä¸œè¥¿<br>A: you in? B: yes, Iâ€™m in / no, Iâ€™ll pass</p></blockquote><p><strong>J:</strong> <em>Iâ€™ll pass</em><br><strong>X:</strong> <em>What? I thought you were dying to see that movie</em></p><blockquote><p>be dying to do sth = Yearning to do something (éå¸¸/æ¸´æœ›æƒ³åšæŸäº‹)</p></blockquote><p><strong>J:</strong> <em>I do really wanna see that movie, but Iâ€™ve got other plans, Lately Iâ€™ve been helping people at the old folksâ€™ home</em></p><blockquote><p>old folksâ€™ home = nursing home (æ•¬è€é™¢ï¼Œå‰è€…å¤šç”¨äºå£è¯­ä¸­)</p></blockquote><p><strong>X:</strong> <em>Why would you do that instead of going to the movies? That doesnâ€™t make sense</em></p><blockquote><p>make sense (æœ‰æ„ä¹‰)<br>That doesnâ€™t make sense (æ ¹æœ¬æ²¡é“ç†ï¼Œè®²ä¸é€š)</p></blockquote><p><strong>J:</strong> <em>I made a commitment to myself that I will do something good every day for 30days, I recently attented a TED seminarï¼ˆä¸“é¢˜è®¨è®ºä¼šï¼‰ by Matt, He talked about the benefits of doing something for 30 days straight.</em></p><blockquote><p>make a commitement (åšæ‰¿è¯º)<br>æ³¨æ„æ­¤å¤„Straightçš„ç”¨å¤„</p></blockquote><p><strong>X:</strong> <em>Oh yeah, tell me about it.</em></p><blockquote><p>tell me about it = care to elaborate</p></blockquote><p><strong>J:</strong> <em>He said itâ€™s a greate way to improve yourself-confidence. Itâ€™s also a great way to force yourself to do something that youâ€™ve always wannted to do, but never got around to actually doing</em></p><blockquote><p>improve yourself-confidence (æ³¨æ„ï¼šæå‡è‡ªä¿¡å¿ƒè¦ç”¨improve)<br>push sb to do sth = force sb to do sth<br>get around to doing sth (æŠ½æ—¶é—´åšæŸäº‹) åœ¨<strong>è‚¯å®šå¥</strong>ä¸­ï¼š finally get around to doing sth åœ¨<strong>å¦å®šå¥</strong>ä¸­ï¼š never get around to doing sth</p></blockquote><p><strong>X:</strong> <em>Oh, that sounds like something I should doâ€¦</em><br><strong>J:</strong> <em>I think youâ€™d love it. You can pick something that youâ€™re willing to do for 30 days, for example, writing a 50,000-word short story. Every day you just have to write 1667 words, but the tough part is that you canâ€™t go to sleep until youâ€™ve finished what you promised yourself youâ€™d do.</em></p><blockquote><p>the tough part (æœ€è‰°éš¾çš„éƒ¨åˆ†)</p></blockquote><p><strong>X:</strong> <em>I think Iâ€™ll give this a shot.Okay, have fun helping the old people. Iâ€™m off to the movies!</em></p><blockquote><p>give it/this a shot ï¼ˆè¯•ä¸€è¯•ï¼‰<br>have fun doing sth (æœ‰å…´è¶£åšæŸäº‹)<br>Iâ€™m off (æˆ‘èµ°äº†ï¼Œå¯ç”¨äºç»“æŸä¸€å¤©çš„å·¥ä½œæŒ‡â€œä¸‹ç­â€)</p></blockquote><p><strong>J:</strong> * You look a lot thinner than the last time we met.*</p><blockquote><p>package some pounds ï¼ˆå˜èƒ–ï¼‰</p></blockquote><p><strong>X:</strong> <em>I took your advice and decided to go on a diet for 30 days. So far, Iâ€™ve stuck to my diet really well.</em></p><blockquote><p>go on a diet (èŠ‚é£Ÿã€å‡è‚¥)<br>stick to doing sth/sth ï¼ˆåšæŒåšæŸäº‹ï¼‰</p></blockquote><p><strong>J:</strong> <em>Thatâ€™s great! So, tell me about it? What exactly are you doing?</em></p><blockquote><p>what exactly are you doing? (ä½ åˆ°åº•åšäº†ä»€ä¹ˆ)</p></blockquote><p><strong>X:</strong> * I promised myself that I would eat healthy for at least 30 days. I also promised myself to get lots of exercise by walking and going to the gym.*<br><strong>J:</strong> <em>How are you making sure that you eat heathy?</em><br><strong>X:</strong> * I weigh all of my food on a digital scale before I eat it. Then I calculate the amount of calories. Right now, I only eat about 1900 calories a day. Itâ€™s really helped me slim down.*</p><blockquote><p>digital scale (ç”µå­ç§¤)  å…³è”2016.3.30 Airport English ä¸­ place it on the scale<br>slim down (ç˜¦èº«ï¼Œç˜¦ä¸‹æ¥)</p></blockquote><p><strong>J:</strong> <em>I can see that! You look like a completely different person!</em> (ä½ ç®€ç›´åƒæ¢äº†ä¸€ä¸ªäººï¼Œæ³¨æ„completelyçš„ä½¿ç”¨)<br><strong>X:</strong> <em>By the way, are you still sticking to your commitment?</em><br><strong>J:</strong> <em>My 30-day commitment ended two weeks ago, but I felt so good about myself that I decided to keep it as a healthy habit. I still try to do one good thing every day. I love it!</em></p><h4 id="2016-4-18-Getting-Money-Back"><a href="#2016-4-18-Getting-Money-Back" class="headerlink" title="2016.4.18 Getting Money Back"></a>2016.4.18 Getting Money Back</h4><p><strong>X:</strong> <em>Can I talk to you for a minute? Iâ€™d like to pick your brains about something.</em></p><blockquote><p>pick someoneâ€™s brains (è¯¢é—®/å¾æ±‚æŸäººæ„è§) Can I get your advice?</p></blockquote><p><strong>J:</strong> <em>Iâ€™m all ears, whatâ€™s up?</em></p><blockquote><p>Iâ€™m all ears (æµ‘èº«ä¸Šä¸‹éƒ½æ˜¯è€³æœµï¼ŒæŒ‡åœ¨è®¤çœŸå¬ï¼Œæ´—è€³æ­å¬)</p></blockquote><p><strong>X:</strong> <em>I lent my friend 500RMB two weeks ago, and he still hasnâ€™t paid me back, Iâ€™m at a loss of what to do</em></p><blockquote><p>borrow sth from sb (ä»æŸäººå€ŸæŸç‰©)<br>lend sth to sb (å€Ÿç»™æŸäººæŸç‰©)<br>pay me back (è¿˜é’±ç»™æˆ‘)<br>Iâ€™m at a loss [of]â€¦  æˆ‘å›°æƒ‘.. ä¸çŸ¥é“æ€ä¹ˆåŠ  I donâ€™t know what to do.</p></blockquote><p><strong>J:</strong> <em>You could give him the benefit of the doubt, maybe he forget about the money</em></p><blockquote><p>give sb the benefit of the doubt (æš‚ä¸”ç›¸ä¿¡æŸäºº ç«™åœ¨å¯¹æ–¹çš„ç«‹åœºä¸Šæƒ³ï¼Œç»™æŸäººä¸€æ¬¡è¯æ˜è‡ªå·±çš„æœºä¼š)</p></blockquote><p><strong>X:</strong> * Thatâ€™s a lot of money to forget about. Iâ€™m really starting to get angry now.*<br><strong>J:</strong> <em>I suggest you sit down with him and have a heart-to-heart talk. whatever you do, donâ€™t lash out and accuse him of stealing your money, he really might have forgotten.</em></p><blockquote><p>heart-to-heart talk (å¦è¯šçš„ï¼Œå¼€è¯šå¸ƒå…¬çš„è°ˆè¯)<br>lash out (ç”¨è¨€è¯­æ”»å‡»ã€ç‹ æ‰¹)  donâ€™t lash out (ä¸è¦è¯´ä¼¤äººçš„è¯ï¼Œä¸è¦æƒ…ç»ªå¤ªå†²åŠ¨å¤±æ§)<br>accuse sb of doing sth (è°´è´£/æ–¥è´£/æŒ‡æ§æŸäººåšæŸäº‹ï¼Œ ä¸è§å¾—æœ‰è¯æ®çš„æŒ‡æ§/æ–¥è´£)</p></blockquote><p><strong>X:</strong> <em>I think Iâ€™d better keep him at armâ€™s length from now on</em></p><blockquote><p>keep sb at armâ€™s length (å’ŒæŸäººä¿æŒè·ç¦»)</p></blockquote><p><strong>J:</strong> <em>Donâ€™t jump to conclusions so fast, talk to him about it first, and then draw your conclusion.</em></p><blockquote><p>jump to conclusions (å¦„ä¸‹ç»“è®º)<br>draw oneâ€™s conclusion (ä¸‹ç»“è®º)</p></blockquote><p><strong>X:</strong> <em>Okay, Iâ€™ll keep you posted</em></p><blockquote><p>keep you posted (å‘ŠçŸ¥æŸäººæŸäº‹ï¼Œæˆ‘ä¼šä¿æŒæ›´æ–°æ¶ˆæ¯ï¼Œ æœ‰æ¶ˆæ¯å°±å‘Šè¯‰ä½ , å¯ä»¥ç”¨åœ¨é‚®ä»¶ä¹¦å†™ä¸­)</p></blockquote><p><strong>J:</strong> <em>Were you able to get your money back?</em></p><blockquote><p>get money back (è¿˜é’±)</p></blockquote><p><strong>X:</strong> <em>Yeah, but it was no walk in the park.</em></p><blockquote><p>a walk in the park (è½»è€Œæ˜“ä¸¾)<br>a pain in the neck (è„–å­ä¸Šæœ‰ç–¼ç—›ï¼ŒæŒ‡ä¸é¡ºåˆ©ï¼Œæœ‰éº»çƒ¦)<br>twists and turns  (æ•…äº‹ä¸Šçš„â€œæ›²æŠ˜â€) The story is twists and turns</p></blockquote><p><strong>J:</strong> <em>What do you mean?</em><br><strong>X:</strong> <em>I asked him if he could give me my money back, and he told me that it had completely slipped his mind.</em></p><blockquote><p>slip oneâ€™s mind (å¿˜å¾—ä¸€å¹²äºŒå‡€)</p></blockquote><p><strong>J:</strong> <em>So did he give the money back to you then</em><br><strong>X:</strong> <em>He only gave me 300. He said he will give me the other 200 next week once he gets paid. But then I remembered that he was going on vacation next week, so I called him on his bluff</em></p><blockquote><p>call sb bluff ï¼ˆæ­ç©¿æŸäººï¼‰</p></blockquote><p><strong>J:</strong> <em>Did he come clean?</em></p><blockquote><p>come clean (å˜å¾—æ¸…æ™° æŒ‡è¯´çœŸè¯ è€å®äº¤ä»£)</p></blockquote><p><strong>X:</strong> <em>Yes, he apologized and gave me the other 200 the next day. He said he has been really tight for cash lately.</em></p><blockquote><p>tight for cash (æ‰‹å¤´ç´§)</p></blockquote><p><strong>J:</strong> <em>It sounds like youburied the hatchet with him?</em></p><blockquote><p>bury the hatchet (åŸ‹æ‰æˆ˜äº‰ã€æ–§å¤´, æŒ‡â€œå’Œè§£ï¼›å†°é‡Šå‰å«Œâ€)</p></blockquote><p><strong>X:</strong> <em>Yeah, I decided to let bygones be bygones. Now weâ€™re back to being good friends,just like before.</em></p><blockquote><p>let bygones be bygones (è¿‡å»çš„äº‹å°±è®©è¿‡å»å§ï¼Œ æ—¢å¾€ä¸å’)</p></blockquote><p><strong>J:</strong> * Iâ€™m glad you listened to me and were able to remain friends with him.*</p><blockquote><p>remain friends (ç»´æŒæœ‹å‹å…³ç³»)</p></blockquote><p><strong>X:</strong> <em>what would I do without you?</em></p><h4 id="2016-4-20-Taxi-English"><a href="#2016-4-20-Taxi-English" class="headerlink" title="2016.4.20 Taxi English"></a>2016.4.20 Taxi English</h4><p><strong>JJ is visiting NewYork for the first time. XG plays the part of the taxi driver.</strong><br><strong>JJ:</strong> <em>Thanks so much for stopping, do you know how to get to Times Square(æ—¶ä»£å¹¿åœº) from here?</em></p><blockquote><p>how to get to smw from here? ä»è¿™æ€æ ·å»smw</p></blockquote><p><strong>XGï¼š</strong> <em>Hop in, so, is this your first time to The Big Apple?</em></p><blockquote><p>hop in ï¼ˆä¸Šè½¦ï¼‰/ hop out (ä¸‹è½¦)  hopæœ¬æ„æ˜¯â€œè·³â€<br>NYC(NewYork city åˆ«ç§°å«The Big Apple)</p></blockquote><p><strong>JJï¼š</strong> <em>Yeah, it sure is, I never thought NewYork was <strong>this</strong> big, It reminds me of ShangHai,China</em></p><blockquote><p>It sure is (å½“ç„¶äº†ï¼Œç¡®å®æ˜¯è¿™æ ·)<br>this ï¼ˆæ­¤å¤„è¡¨ç¤ºå¼ºè°ƒï¼Œ å¢å¼ºæè¿°è¯­æ°”ï¼‰<br>remind sb of sth ï¼ˆè®©æŸäººæƒ³èµ·æŸäº‹ï¼‰</p></blockquote><p><strong>XG:</strong> <em>Youâ€™re from China, eh?  wow, thatâ€™s a long way from NewYork. when did you land?</em></p><blockquote><p>itâ€™s a long way from swm (è·ç¦»æŸåœ°å¾ˆè¿œ)<br>when did you land (ä»€ä¹ˆæ—¶å€™åˆ°çš„) = when did you arrive</p></blockquote><p><strong>JJ:</strong> <em>Last night, Iâ€™m still a little jet lagged</em></p><blockquote><p>Iâ€™m still a little jet lagged (æˆ‘ç°åœ¨ä»ç„¶æœ‰ç‚¹æ—¶å·®ç–²åŠ³) tired from the time difference between two places<br>iâ€™m lagging  (é€šå¸¸æ˜¯æŒ‡â€œæˆ‘ç½‘ç»œå»¶è¿Ÿâ€)</p></blockquote><p><strong>XGï¼š</strong> <em>Well, welcome to Manhattan(æ›¼å“ˆé¡¿) ï¼Œ where else are you gonna see while youâ€™re here?</em><br><strong>JJ:</strong> *Iâ€™m planning on visiting Central Park(ä¸­å¤®å…¬å›­) and of course , the Empire State Building(å¸å›½å¤§å¦), maybe you can tell me some good places to visit? *</p><blockquote><p>Iâ€™m planning on doing sth (æ­£æ‰“ç®—æŸäº‹)</p></blockquote><p><strong>XGï¼š</strong> <em>Itâ€™d be my pleasure, I think you should add the Statue of Liberty(è‡ªç”±å¥³ç¥) to your list, itâ€™s a must-see</em></p><blockquote><p>must-see(å¿…çœ‹çš„[åœ°æ–¹]) must-do(å¿…åšçš„[äº‹æƒ…])</p></blockquote><p><strong>JJï¼š</strong> <em>thaâ€™s a greate idea.</em><br><strong>XG:</strong> <em>If youâ€™re into animals, you should check out the Bronx ZOO(å¸ƒæœ—å…‹æ–¯åŠ¨ç‰©å›­), The 9/11 memorial is also a place you canâ€™t miss, and since youâ€™re laddy, I bet you like shopping, right?</em></p><blockquote><p>be into sth (ç‰¹åˆ«å–œæ¬¢æŸç‰©/äº‹)<br>check out (å»çœ‹çœ‹ï¼Œ åœ¨é…’åº—ç»“è´¦é€€æˆ¿ä¹Ÿå¯ä»¥ç”¨check out)<br>A place you canâ€™t miss (éè¦å»çœ‹ä¸å¯çš„åœ°æ–¹)<br>The 9/11 memorial is also a place you canâ€™t miss (æ³¨æ„å¥å­ç»“æ„ç”¨æ³•)</p></blockquote><p><strong>JJï¼š</strong> <em>Thatâ€™s right</em><br><strong>XGï¼š</strong> <em>Wellï¼Œ youâ€™ll love downtown Manhattan(æ›¼å“ˆé¡¿é—¹å¸‚åŒº)ï¼Œ <strong>thereâ€™s enough shopping malls there to keep you busy for days</strong>. but make sure you save some money for Coney island(åº·å°¼å²›), thereâ€™s a lot of things to do, If you have enough energy, You should check out NewYorkâ€™s night life, You wonâ€™t be disappointed.</em><br><strong>JJ:</strong> <em>Thanks so much, those are some great tips!(å°æ”»ç•¥)</em><br><strong>XGï¼š</strong> <em>Here we are, Times Square! Thatâ€™ll be $32.50ï¼ˆthirty two dollars and fifty centsï¼‰</em><br><strong>JJ:</strong> <em>Hereâ€™s $35, <strong>keep the change</strong>. By the way, can you tell me how to get to the music store?</em></p><blockquote><p>keep the change = You can keep the tip(ç•™ç€å°è´¹å§)</p></blockquote><p><strong>XGï¼š</strong> <em>Sure, walk two blocks east. Youâ€™ll see it on your right.Good luck</em></p><blockquote><p>walk two blocks east (å‘ä¸œèµ°ä¸¤æ¡è¡—ï¼Œ æ³¨æ„ä¹‹è·¯æ–¹å‘è¯çš„ç”¨æ³•)</p></blockquote><p><strong>æ‰©å±•ï¼š</strong></p><ol><li>çº½çº¦å¸‚å…±åˆ†ä¸ºäº”åŒºã€ˆBoroughã€‰ï¼šå¸ƒæœ—ã€ˆThe Bronxã€‰ã€å¸ƒé²å…‹æ—ã€ˆBrooklynã€‰ã€æ›¼å“ˆé¡¿ã€ˆManhattanã€‰ã€çš‡åã€ˆQueensã€‰ã€åŠæå¥‡æ–‡(åˆç§°ä¸ºåˆ—æ²»æ–‡)ã€ˆRichmond (Staten Island)ã€‰ã€‚</li><li>put your arm out (ä¼¸å‡ºæ‰‹ï¼Œæƒ³è±¡å«å‡ºç§Ÿè½¦çš„æ ·å­)</li></ol><h4 id="2016-4-25-Vacation-English"><a href="#2016-4-25-Vacation-English" class="headerlink" title="2016.4.25 Vacation English"></a>2016.4.25 Vacation English</h4><p><strong>Xiao Gao is checking into a hotel(åŠç†å…¥ä½é…’åº—). Jing Jing plays the part of the front desk employee</strong><br><strong>JJ:</strong> <em>How may I help you?</em><br><strong>XG:</strong> <em>I have a reservation under the name Gao</em></p><blockquote><p>A: I have a reservation. B: under which name (ç”¨å“ªä¸ªåå­—é¢„å®šçš„)</p></blockquote><p><strong>JJï¼š</strong> <em>Wait a moment while Iâ€™ll look you up, XG, is that right?</em></p><blockquote><p>look [sth] up (æŸ¥è¯¢)</p></blockquote><p><strong>XGï¼š</strong> <em>Yes, thatâ€™s right</em><br><strong>JJ:</strong> <em>It looks like you have booked a queen size bed?</em></p><blockquote><p>queen size bed ï¼ˆå¤§åºŠæˆ¿ï¼‰ King size bed (è¶…çº§å¤§åºŠæˆ¿)</p></blockquote><p><strong>XGï¼š</strong> <em>BTW, could you tell me some fun things to do around here? itâ€™s my first time to Miami.</em><br><strong>JJ:</strong> <em>You asked the right person, I used to work as a tour guide before getting this job at the hotel, I think you should check out Miami beach, itâ€™s a great place to get a tan, At Miami beach, you can go on a speed boat tour, afterwardsï¼ˆç„¶åï¼‰, you should take a boat to the Bahamas(å·´å“ˆé©¬)ï¼Œ itâ€™s a paradise, youâ€™ll love the restaurants and bars there</em></p><blockquote><p>you asked the right person (ä½ é—®å¯¹äººäº†)<br>get a tan (æ™’çš„ç¾é»‘) (tan æ—¢å¯ä»¥æ˜¯åè¯ï¼Œ ä¹Ÿå¯ä»¥æ˜¯åŠ¨è¯ Iâ€™m tanning now)<br>get a sunburnt(æ™’çº¢ï¼Œ å°±æ˜¯æŒ‡æ™’ä¼¤äº†)<br>sea sick (æ™•èˆ¹)<br>go on a speed boat(å¿«è‰‡)/sth tour (æ¥ä¸€ä¸ªâ€¦æ¸¸)<br>itâ€™s a paradise (å°±æ˜¯ä¸€ä¸ªå¤©å ‚å•Š)</p></blockquote><p><strong>XGï¼š</strong> <em>thanks, Iâ€™m gonna get my swim suit on and hit the beach</em></p><blockquote><p>swim suit (æ³³è¡£)<br>you look good  in the suit. the suit looks nice on you (æ³¨æ„ä»‹è¯inå’Œonçš„ä½¿ç”¨)<br>hit the beach (å¥”å‘æµ·æ»©ï¼Œæ³¨æ„åŠ¨è¯hitçš„ä½¿ç”¨ï¼ŒæŒ‡å»å“ª)</p></blockquote><p><strong>XG is at a restaurant at the Bahamas. Jing Jing plays the part of the restaurant employee</strong><br><strong>JJï¼š</strong> <em>Sir, table for one?</em></p><blockquote><p>table for one/two (ä¸€ä½/ä¸¤ä½å—)<br>A: how many? (å‡ ä½ï¼Ÿ) B: table for six (å…­ä¸ªäºº)</p></blockquote><p><strong>XG</strong> <em>Yes, Please</em><br><strong>JJ:</strong> <em>Smoking or non?</em> (æ‚¨æƒ³åå¸çƒŸåŒºè¿˜æ˜¯éå¸çƒŸåŒº)<br><strong>XGï¼š</strong> <em>Non, please</em><br><strong>JJ:</strong> <em>right this way, *</em>Can I get started off with a something to drink?***</p><blockquote><p>right this way (è¿™è¾¹è¯·)<br>Can I get started off(start off å°±ç›¸å½“äºstart) with a something to drink?</p></blockquote><p><strong>XG:</strong> <em>How about a martini(é©¬ä¸å°¼)</em><br><strong>JJ:</strong> <em>Coming right up, do u still need a minute to look at the menu?</em></p><blockquote><p>coming right up (é©¬ä¸Šå°±æ¥)</p></blockquote><p><strong>XGï¼š</strong> <em>What are your specials today?</em> (ä»Šå¤©çš„ç‰¹ä»·èœæ˜¯ä»€ä¹ˆï¼Ÿ)<br><strong>JJï¼š</strong> <em>Today our specials are steakï¼ˆç‰›æ’ï¼‰ and potatoesï¼ˆåœŸè±†ï¼‰ and roasted salmonï¼ˆçƒ¤ä¸‰æ–‡é±¼ï¼‰. Do any of those sound good?</em><br><strong>XGï¼š</strong> <em>Iâ€™ll go with the steak please.</em></p><blockquote><p>Iâ€™ll have / go with + èœå  ï¼ˆæˆ‘è¦ç‚¹ä»€ä¹ˆ.. ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>Okay, Iâ€™ll be right back with your order.</em> ï¼ˆæ‚¨çš„å•å¾ˆå¿«å°±æ¥ï¼‰<br><strong>JJ:</strong> <em>How are we doing? Can I get you another martini?</em></p><blockquote><p>how are we doing (æ€ä¹ˆæ ·ï¼Œå¤–å›½åƒå›½å†…éœ€è¦å«æœåŠ¡å‘˜ï¼Œä»–ä»¬ä¼šå››å¤„èµ°æ¥ç…§é¡¾é¡¾å®¢éœ€æ±‚)</p></blockquote><p><strong>XGï¼š</strong> <em>No, thank you, Iâ€™m feeling a bit tipsy already. Iâ€™ll take the check, though.</em></p><blockquote><p>Iâ€™m feeling a bit tipsy already(æˆ‘æ„Ÿè§‰æœ‰ç‚¹å¾®é†ºäº†) / Iâ€™m feeling a little tipsy/woozy (I think Iâ€™ve caught a buzz). I gotta foot the bill.<br>Iâ€™ll take the check ï¼Œ though(æˆ‘è¦ä¹°å•äº†, thoughå°±ç®—æ˜¯ä¸€ç§è¯­æ°”è¯â€œäº†â€)</p></blockquote><p><strong>JJï¼š</strong> <em>You got it. Here you are. Iâ€™ll be back to pick that up in a few minutes.(æˆ‘è¿‡ä¸€ä¼šå›æ¥æ‹¿ï¼‰</em></p><blockquote><p>you got it (æ²¡é—®é¢˜)</p></blockquote><p><strong>æ‰©å±•ï¼š</strong></p><ol><li>å››å¤§æ´‹ï¼š the Pacific [pÉ™â€™sÉªfÉªk] Ocean (å¤ªå¹³æ´‹),the Atlantic [É™tâ€™lÃ¦ntÉªk] (Ocean)(å¤§è¥¿æ´‹),the Indian Ocean(å°åº¦æ´‹),the Arctic [â€˜É‘rktÉªk] Ocean (åŒ—å†°æ´‹)</li><li>Hurricane crashed the Florida last week (é£“é£ä¸Šå‘¨è¢­å‡»äº†å¼—ç½—é‡Œè¾¾å·)</li></ol><h4 id="2016-5-4-House-Warming-Party"><a href="#2016-5-4-House-Warming-Party" class="headerlink" title="2016.5.4 House Warming Party"></a>2016.5.4 House Warming Party</h4><p><strong>JJ:</strong> <em>XG, howâ€™s the guest list coming along?</em></p><blockquote><p>howâ€™s [sth] coming along? (sthè¿›å±•çš„æ€ä¹ˆæ ·ï¼Œè¿˜æ²¡æœ‰ç»“æŸ)</p></blockquote><p><strong>XGï¼š</strong> <em>Itâ€™s pretty good, Iâ€™ve already thought of 30 people who we should invite.</em><br><strong>JJ:</strong> <em>I think you should limit your guest list, after all weâ€™re on a tight budget. hosting so many people could be really expensive.</em></p><blockquote><p>on a tight budget (é¢„ç®—æœ‰é™)  æ³¨æ„å’Œtight for cashçš„ç†è§£åŒºåˆ«<br>hosting (é‚€è¯·)</p></blockquote><p><strong>XGï¼š</strong> <em>Youâ€™re right, what about invitations? maybe we should use social media instead of paper invitations in order to cut down on costs</em></p><blockquote><p>what aboutï¼ˆç›´æ¥æå‡ºé€‰æ‹©ã€æƒ³æ³•ï¼‰ å’Œ how aboutï¼ˆæœ‰äº†ä¸€ä¸ªï¼Œæå‡ºå¦å¤–ä¸€ä¸ªï¼‰<br>cut down on costs (å‡å°‘å¼€æ”¯)</p></blockquote><p><strong>JJï¼š</strong> <em>Good idea, make sure you request an RVSP so that we can play for foods and drinks better.</em></p><blockquote><p>RVSP (RÃ©pondez sâ€™il vous plait(French for â€œplease respondâ€) æ•¬è¯·å›å¤,æ”¶åˆ°è¯·å›å¤)</p></blockquote><p><strong>XGï¼š</strong> <em>Speaking of food, I think we should have finger foods that people can munch on while they mingle.</em></p><blockquote><p>speaking of [sth] (è¯´é“sth)<br>saying [sth] ï¼ˆæ¯”å¦‚sthï¼‰<br>finger foods (foods that are convenient to eat with your hands èƒ½ç”¨æ‰‹æ‹¿ç€åƒçš„æ–¹ä¾¿é£Ÿç‰©)<br>mingle (Mingle = to socialize é™Œç”Ÿäººä¹‹é—´çš„ç¤¾äº¤)</p></blockquote><p><strong>JJ:</strong> <em>I was thinking we should hire a catering service to provide our food . that way we can focus on decorating our new home, we want it to look nice when the guests arrive.</em></p><blockquote><p>catering service (a service that provides food for an event or party ä¸ºç‰¹å®šæ´»åŠ¨æä¾›é¤é¥®æœåŠ¡)</p></blockquote><p><strong>XGï¼š</strong> <em>Great party huhï¼Ÿ</em><br><strong>JJï¼š</strong> <em>Yeahï¼Œ it sure is, the music is great, and the food is even better.</em></p><blockquote><p>it sure is (ç¡®å®ï¼Œç»™ä¸è‚¯å®š)</p></blockquote><p><strong>XGï¼š</strong> <em>Who do you know here?</em> (ä½ éƒ½è®¤è¯†è¿™é‡Œçš„è°ï¼Œæ³¨æ„è¡¨è¾¾)<br><strong>JJï¼š</strong> <em>Iâ€™m JJâ€™s friend, we went to school together.</em></p><blockquote><p>we went to school together (å¯ä»¥è¡¨ç¤ºæˆ‘ä»¬è¿‡å»æ—¶åŒå­¦)</p></blockquote><p><strong>XGï¼š</strong> <em>Oh cool. Xiao Gao and I are on the same basketball team. Nice to meet you. Iâ€™m Bob, by the way.</em></p><blockquote><p>æ³¨æ„å£è¯­å¯¹è¯ä¸­ by the way çš„ä½¿ç”¨ï¼Œ é¡ºä¾¿ä»‹ç»ä¸€ä¸‹è‡ªå·±</p></blockquote><p><strong>JJï¼š</strong> <em>Iâ€™m Jennifer. Nice to meet you too. Did you get to go on a tour of the place yet? Itâ€™s such a nice home. Iâ€™m so happy for them</em></p><blockquote><p>go on a tour of the place (åœ¨è¿™ä¸ªæˆ¿å­é‡Œå››å¤„è½¬è½¬äº†å—ï¼Ÿ)  è”æƒ³ go on a speed boat tour (æ¥ä¸€ä¸ªå¿«è‰‡æ¸¸)  æ³¨æ„çµæ´»ä½¿ç”¨</p></blockquote><p><strong>XGï¼š</strong> <em>Yeah, Iâ€™m surprised at how much space they have. Anyways, would you like to go grab some refreshmentsï¼ˆé›¶é£Ÿï¼Œç‚¹å¿ƒï¼‰? I see youâ€™re almost done with your drink. The turkey is splendidï¼ˆéå¸¸å¥½ï¼‰.</em></p><blockquote><p>sb is done with sth (æŸäººçš„sthå¿«åšå®Œäº†/sthå¿«æ²¡äº†)  Iâ€™m done with my work.</p></blockquote><p><strong>JJï¼š</strong> <em>Iâ€™m a veganï¼ˆ ä¸¥æ ¼ç´ é£Ÿä¸»ä¹‰è€…ï¼‰, so I donâ€™t eat meat. But Iâ€™ll join you for some more spirits.</em></p><blockquote><p>spirits (we just use the word â€œspiritsâ€ to refer to liquor(é…’) in general, so we only use it in plural(å¤æ•°) form (spirits). We canâ€™t say â€œIâ€™d like a spiritâ€, instead we should say specifically what kind you want, such as â€œIâ€™d like a shot of vodkaâ€ or â€œIâ€™d like a glass of whiskeyâ€)</p></blockquote><p><strong>XG:</strong> <em>Do you think I could get your phone number? You seem like a really cool person. Weâ€™re always looking for more members on our basketball team. Itâ€™s open to both guys and girls. Think youâ€™d be interested?</em></p><blockquote><p>åœ¨å›½å¤–è¦å¼‚æ€§ç”µè¯å°±æ˜¯å¯¹å¯¹æ–¹æœ‰å¥½æ„Ÿï¼Œ å§”å©‰ä¸€äº›å¯ä»¥æå‡ºä¸€äº›å€Ÿå£å¦‚ï¼ˆYou seem like a really cool personï¼‰</p></blockquote><h4 id="2016-5-9-Obsessive-Compulsive-Disorder-ï¼ˆOCDï¼‰"><a href="#2016-5-9-Obsessive-Compulsive-Disorder-ï¼ˆOCDï¼‰" class="headerlink" title="2016.5.9 Obsessive Compulsive Disorder ï¼ˆOCDï¼‰"></a>2016.5.9 Obsessive Compulsive Disorder ï¼ˆOCDï¼‰</h4><p><strong>JJï¼š</strong> <em>Quit biting your nails, itâ€™s a bad habit.</em><br><strong>XG:</strong> <em>Itâ€™s a bad habit, Iâ€™ve done it since I was a kid.</em><br><strong>JJ:</strong> <em>Sounds like you got OCD, do you do it a lot?</em><br><strong>XG:</strong> <em>Yeah, pretty often, do you ever tweak out about things like that?</em></p><blockquote><p>tweak out about sth = freak out about sth = worry about sth</p></blockquote><p><strong>JJ:</strong> <em>Sometimes, when Iâ€™m about to put my earbuds(å¡å…¥å¼è€³æœº) in to listen to music, I always have to make sure that the R and L are in the correct ear.</em></p><blockquote><p>be about to do sth(é©¬ä¸Šè¦åšæŸäº‹)  Iâ€™m about to leave. (æˆ‘é©¬ä¸Šè¦ç¦»å¼€)</p></blockquote><p><strong>XGï¼š</strong> <em>Do you know what else drive me nuts? After I set the alarm at night to wake me up in the morning, I gotta check again like 5 minutes later to make sure I acturally set it.</em></p><blockquote><p>drive sb nuts/crazy/bonkers/up the wall è®©æŸäººæŠ“ç‹‚</p></blockquote><p><strong>JJï¼š</strong> <em>Year, sometimes I have to make sure over and over that I locked the door at night before I sleep.</em></p><blockquote><p>over and over (åå¤ï¼Œä¸€éåˆä¸€éï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>I canâ€™t stand it when someone doesnâ€™t completely clean the blackboard in school, I feel really weird in class and keep looking at.</em></p><blockquote><p>I canâ€™t stand it (æˆ‘ä¸èƒ½å¿å—)</p></blockquote><p><strong>JJï¼š</strong> <em>I remember when I was going to school and our test grades would be out for us to look at, I would never go and see my score.</em><br><strong>XG:</strong> <em>Sounds like weâ€™re both a little OCD. Hey, what does OCD stand for anyway?</em><br><strong>JJ:</strong> <em>You tell me! Why donâ€™t you go home and do some research about it?</em><br><strong>XG:</strong> <em>Geez, is being bossy one of your OCD habits too?</em>  (å¤©å“ªï¼Œéš¾é“å‘å·æ–½ä»¤ä¹Ÿæ˜¯ä½ çš„å¼ºè¿«ç—‡ç—‡çŠ¶ä¹‹ä¸€å—ï¼Ÿ)<br><strong>JJ:</strong> <em>So, what did you find out about OCD?</em><br><strong>XG:</strong> <em>it stands for <strong>Obsessive Compulsive Disorder</strong>, Basicly itâ€™s when you have a lot of anxiety and you do a lot of repetitive behaviors to make the anxiety go away.</em></p><blockquote><p>(å¤§è‡´å°±æ˜¯è¯´ä½ æœ‰å¾ˆå¤šçš„ç„¦è™‘ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡é‡å¤æŸç§è¡Œä¸ºæ‰è®©è¿™ç§ç„¦è™‘æ¶ˆå¤±ã€‚)</p></blockquote><p><strong>JJ:</strong> <em>What kinds of behaviors are you talking about? Did you find out about anything new</em><br><strong>XG:</strong> <em>Yeah I did. Do you know what hoarders(å›¤ç§¯æ§) are?</em></p><blockquote><p>herder (ç‰§äºº)</p></blockquote><p><strong>JJ:</strong> * I think so. Arenâ€™t they the people who have to round up a bunch(ç¾¤) of sheep?*</p><blockquote><p>round up sth (æ”¶é›† èšé›† å½’æ‹¢ )</p></blockquote><p><strong>XGï¼š</strong> * No, those are called herdersï¼ˆç‰§äººï¼‰, Iâ€™m talking about hoarders! H-O-A-R-D-E-R-S. Hoarders! Hoarding is when you keep a lot of things and donâ€™t throw them away, even if they are worthless or meaningless.*<br><strong>JJï¼š</strong> <em>I donâ€™t know, Xiao Gaoâ€¦ Your room is pretty messyï¼ˆæ‚ä¹±çš„ï¼‰. Do you think you might â€¦.</em></p><blockquote><p>messy (æŒ‡å®¶ï¼ŒåŠå…¬å®¤ï¼Œå¤´å‘æ‚ä¹±çš„ï¼Œå°æœ‹å‹åƒé¥­å¼„å¾—å“ªé‡Œéƒ½æ˜¯ä¹Ÿå¯ä»¥ç”¨ )</p></blockquote><p><strong>XGï¼š</strong> <em>Hey! My room is messy but itâ€™s not that bad!</em><br><strong>JJï¼š</strong> <em>Anyways, do a lot of people suffer from this disorder?</em><br><strong>XGï¼š</strong> <em>Itâ€™s fairlyï¼ˆç›¸å½“ï¼‰ common. Actually, itâ€™s the fourth-most diagnosed mentalï¼ˆå¿ƒç†çš„ï¼‰ disorder. <strong>One in fifty</strong> people have been diagnosed with it in the United States.</em><br><strong>JJï¼š</strong> <em>Uh oh! Weâ€™re doomed! We probably have it too!</em></p><blockquote><p>Youâ€™re so dead (ä½ æ­»å®šäº†)  Weâ€™re doomedï¼ˆæˆ‘ä»¬æ­»å®šäº†ï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>Donâ€™t worry! I think weâ€™re okay. I also learned that just because you might have some obsessive behaviors, doesnâ€™t mean that you have OCD.</em><br><strong>JJï¼š</strong> <em>Is it treatable?</em><br><strong>XGï¼š</strong> <em>Yes. The good news is that this mental disorder is treatable with therapy(æ²»ç–—ï¼Œç–—æ³•) and medication!</em></p><h4 id="2016-5-11-At-The-Crossroads"><a href="#2016-5-11-At-The-Crossroads" class="headerlink" title="2016.5.11 At The Crossroads"></a>2016.5.11 At The Crossroads</h4><p><strong>JJ:</strong> <em>Hey,XG why do you look so stressed out? do you have a lot of homework or something?</em></p><blockquote><p>stressed out (æŠ“ç‹‚)<br>or something æ”¾åœ¨é—®å¥çš„ç»“å°¾ç±»ä¼¼æ±‰è¯­çš„â€œ..å§/å—â€</p></blockquote><p><strong>XGï¼š</strong> <em>Wellï¼Œ itâ€™s just it, schoolâ€™s going fine this yearâ€¦ but Iâ€™m not sure about next year.</em></p><blockquote><p>well, itâ€™s just it (å°±æ˜¯è¿™ä¹ˆå›äº‹)<br>Iâ€™m not sure about sth (ä¸ç¡®å®šsth)</p></blockquote><p><strong>JJï¼š</strong> <em>I donâ€™t get it, you said schoolâ€™s going fine now, why do you have an issue at school year?</em></p><blockquote><p>I donâ€™t get it (æˆ‘æ²¡æ˜ç™½) = I donâ€™t understand<br>You got it (å¤šæ•°æ˜¯å›ç­”å¯¹è¯æŒ‡â€œæ²¡é—®é¢˜â€)</p></blockquote><p><strong>XG:</strong> <em>The way things are looking now, I donâ€™t think Iâ€™ll be able to fork up enough money for tuition next year.</em></p><blockquote><p>the way things are looking now (ç…§ç›®å‰æ¥çœ‹)<br>fork up <a href="æ”¯ä»˜ï¼ŒèŠ±ä¸€å¤§ç¬”é’±">money</a> = pay a large amount of money.</p></blockquote><p><strong>JJ:</strong> <em>Thatâ€™s not good, so what are you gonna do?</em><br><strong>XG:</strong> <em>I was planning on working at a factory this summer and saving up some money and maybe take out a student loan, that way, I should be able to go to school next year.</em></p><blockquote><p>take out a [student] loan  (ç”³è¯·åŠ©å­¦è´·æ¬¾)<br>that way (é‚£æ ·çš„è¯)<br>save up (å‚¨è“„ï¼Œ å­˜å‚¨)</p></blockquote><p><strong>JJï¼š</strong> <em>Problem solved, right? what are you worrying about?</em></p><blockquote><p>worry about sth = tweak out about sth = freak out about sth</p></blockquote><p><strong>XG:</strong> <em>I got a job offer to work as an English teacher, I wouldnâ€™t be able to go to school on such a low salary, but I think it would be really fun, so now Iâ€™m having second thoughts, Maybe I should take the teaching English position instead.</em></p><blockquote><p>have second thoughts (çŠ¹è±«ï¼Œå†åŠ æ€ç´¢)<br>on second thought (ç»è¿‡å†æ¬¡æ€è€ƒ)<br>instead æ”¾åœ¨å¥å°¾ä½¿ç”¨</p></blockquote><p><strong>JJï¼š</strong> <em>You have to think this through carefully, On one hand the English teaching job is fun, thatâ€™s right, but on the other hand you wouldnâ€™t be able to fulfill your long term goal of getting a bachelorâ€™s degree, I donâ€™t think itâ€™s in your best interests to take the English teaching job</em></p><blockquote><p>think sth through [carefully] (å……åˆ†çš„è€ƒè™‘æŸäº‹)<br>on one hand â€¦ on the other hand â€¦ ï¼ˆä¸€æ–¹é¢â€¦ å¦ä¸€æ–¹é¢â€¦ï¼‰<br>fulfill your long term goal (å®Œæˆ/å®ç°é•¿è¿œç›®æ ‡ï¼Œ fulfill å¯ä»¥æŒ‡å®Œæˆç›®æ ‡ã€éœ€æ±‚ã€æ„¿æœ›)<br>in oneâ€™s best interests (å¯¹æŸäººæœ€å¥½çš„åˆ©ç›Šï¼Œ æ˜¯æŸäººæœ€å¥½çš„é€‰æ‹©)</p></blockquote><p><strong>XGï¼š</strong> *But I think that teaching job will help me in the future to land a better job, donâ€™t you think it will look good on my resume, if I had some teaching experience. *</p><blockquote><p>land a job (è·å¾—å·¥ä½œ)<br>æ³¨æ„experienceæ˜¯ç»éªŒçš„æ—¶å€™ä¸å¯æ•°</p></blockquote><p><strong>JJï¼š</strong> <em>It might help, but I think having a bachelorâ€™s degree on your resume will look even better. you really have to weight the pros and cons</em></p><blockquote><p>åœ¨ç®€å†ä¸Šç”¨ on resume<br>weight the pros and cons (æƒè¡¡åˆ©å¼Š)</p></blockquote><p><strong>XGï¼š</strong> *But working in the factory will be so boring, Iâ€™d much rather do something that would make me happy, itâ€™s always been one of my dreams *</p><blockquote><p>I would rather do sth(æˆ‘å®æ„¿åšsth)</p></blockquote><p><strong>JJ:</strong> <em>Well, thatâ€™s part of growing up and being responsible. This experience will make you a better and more responsible person in the future. Trust me, a bachelorâ€™s degree is worth much more than a temporary English teaching job. Plus, you donâ€™t even know for sure if youâ€™ll like teaching English. Anyways, you could always make learning English your hobby at night when you come home from work. Next semester at school, maybe you could take an English elective class. If youâ€™re certain you really like teaching English, then next semester maybe you could tutor a child on the weekend and at the same time make some extra money?</em></p><blockquote><p>thatâ€™s part of growing up ï¼ˆè¿™å°±æ˜¯æˆé•¿çš„ä¸€éƒ¨åˆ†ï¼‰<br>A is worth much more than B  (Aæ¯”Bæ›´æœ‰ä»·å€¼/æ„ä¹‰)<br>elective class (é€‰ä¿®è¯¾) mandatory class(å¿…ä¿®è¯¾)<br>tutor a child (æŒ‡å¯¼å­©å­ï¼Œåšå®¶æ•™)</p></blockquote><p><strong>XGï¼š</strong> <em>Okay, youâ€™ve convinced me. Iâ€™m gonna do whatâ€™s best for myself and work hard to earn enough money to pay for school! Thanks so much, Jing Jing.</em></p><blockquote><p>youâ€™ve convinced me (ä½ è¯´æœäº†æˆ‘)</p></blockquote><h4 id="2016-5-16-Left-and-Right-Handedness"><a href="#2016-5-16-Left-and-Right-Handedness" class="headerlink" title="2016.5.16 Left and Right Handedness"></a>2016.5.16 Left and Right Handedness</h4><p><strong>JJ:</strong> <em>Have you ever wondered how hard it must be for people who are left-handed(å·¦æ’‡å­) to use a computer, the computer mouse is made for right-handed(å³æ’‡å­) people.</em></p><blockquote><p>Have you ever wondered â€¦ ï¼ˆä½ æœ‰æ²¡æœ‰æƒ³è¿‡â€¦ï¼‰<br>mouse (é¼ æ ‡)ï¼Œ wireless mouse (hamsterä»“é¼ ï¼Œ å› ä¸ºæ²¡æœ‰å°¾å·´.)</p></blockquote><p><strong>XG:</strong> <em>Year, it must be hard, my sister is lefty and she seems to do alright.</em></p><blockquote><p>lefty (å·¦æ’‡å­ï¼Œ æ¯”left-handed æ›´åŠ å£è¯­åŒ–)</p></blockquote><p><strong>JJï¼š</strong> <em>So do people choose to be left-handed or is it something that theyâ€™re born with?</em></p><blockquote><p>something that theyâ€™re born with (ä»–ä»¬ä¸ç”Ÿä¿±æ¥çš„ï¼Œä»–ä»¬ç”Ÿæ¥å°±æœ‰çš„)</p></blockquote><p><strong>XGï¼š</strong> <em>The actual reasons why some people are left-handed are still a little vagueï¼ˆè°œï¼‰, but scientists think that it has to do with peopleâ€™s geneticsï¼ˆé—ä¼ å­¦ï¼ŒåŸºå› å­¦ï¼‰ and the environment they grew up in. Studies also show that about 15% of the population is left-handed.</em></p><blockquote><p>vague (è°œ)<br>the environment they grew up in (æ³¨æ„inä¸èƒ½ä¸¢æ‰ï¼Œ æˆé•¿<strong>åœ¨</strong>ç¯å¢ƒä¸­)<br>studies/study/research show[s] ç ”ç©¶è¡¨æ˜</p></blockquote><p><strong>JJï¼š</strong> <em>So besides holding a pen with their left hand, are there any other differences between left-handers and right-handers?</em><br><strong>XGï¼š</strong> <em>Actually, yes.</em><br><strong>JJï¼š</strong> <em>I heard left-handed people are kinda clumsyï¼ˆç¬¨æ‹™çš„ï¼‰, is that true?</em><br><strong>XGï¼š</strong> <em>No, itâ€™s not. There are a lot of social stigmasï¼ˆç¤¾ä¼šåè§ï¼‰ about left-handed people that are completely false.In reality, left-handed people tend to be more athleticï¼ˆè¿åŠ¨çš„ï¼‰. Also, left-handed people seem to have better problem-solving skills.</em></p><blockquote><p>social stigmas (ç¤¾ä¼šåè§ï¼ŒæŒ‡æ ¹æ·±è’‚å›ºçš„åè§) â€”â€” To be a nonreader carries a social stigma.<br>bias about/against sth (å¯¹æŸäº‹æœ‰åè§)  bias toward/against sb (å¯¹æŸäºº.. çš„åè§)<br>outright wrong (å®Œå…¨æ²¡æœ‰æ ¹æ®çš„é”™è¯¯)</p></blockquote><p><strong>JJ:</strong> <em>Wow, I kinda wish I were left-handed now</em><br><strong>XG:</strong> <em>Did you know that a lot of famous people were left-handed? Like Barak Obama and Prince William of England.</em><br><strong>JJ:</strong> <em>Thatâ€™s really interesting. Iâ€™m gonna go home and see what I can learn about right-handed people now. Take care!</em></p><blockquote><p>A: see ya B: take care / A: take care B: see ya ï¼ˆå¯¹è¯ä¸­åŒæ–¹ï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>See ya.</em><br><strong>JJï¼š</strong> <em>So, did you find out anything about right-handed people?</em></p><blockquote><p>find out sth ï¼ˆè°ƒæŸ¥/æŸ¥è¯¢åˆ°sthï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>Well, thereâ€™s one major plus to being a right-handed person: most items in life are geared towards right-handed people. Everything from water bubblers to door handles.Other than that, thereâ€™s really no intellectual advantage to being right-handed.</em></p><blockquote><p>plus (åœ¨æ­¤å¤„æŒ‡â€œå¥½å¤„ï¼Œä¼˜ç‚¹â€)<br>gear toward sb (ä¸“é—¨ä¸ºsbåˆ¶é€ çš„)<br>water bubblers (é¥®æ°´æœº) water fountain (æˆ·å¤–é¥®æ°´æ³‰)<br>other than that (é™¤æ­¤ä¹‹å¤–)</p></blockquote><p><strong>JJï¼š</strong> * So, do right-handed people use the right side of their brain and left-handed people use the left?*<br><strong>XGï¼š</strong> <em>No, itâ€™s actually the opposite. Right-handed people are left-brain oriented and vice versa.</em></p><blockquote><p>money oriented (é‡‘é’±å¯¼å‘çš„)<br>vice versa (åä¹‹äº¦ç„¶)</p></blockquote><p><strong>XGï¼š</strong> <em>Are there any people that can use both left and right hands equally well?</em><br><strong>JJï¼š</strong> <em>Yes, these people are called ambidextrousï¼ˆ åŒæ‰‹éƒ½ä½¿ç”¨å¾—éå¸¸çµå·§çš„ï¼‰. Itâ€™s incredibly rare, but you can actually teach yourself to become ambidextrous.</em><br><strong>XGï¼š</strong> <em>Really? So you mean I could teach myself how to use my left hand to do things?</em><br><strong>JJï¼š</strong> <em>Yes, but donâ€™t expect it to be a cinch. You might have grey whiskers by the time you master it.</em></p><blockquote><p>a cinch = walk in a park = a piece of cake<br>have grey whiskers  (ç™½å‘è‹è‹ï¼ŒæŒ‡å˜è€çš„æ—¶å€™)</p></blockquote><p><strong>XG:</strong> <em>Cool,well,Iâ€™m gonna go practice some left-handed food eating. You coming?</em></p><blockquote><p>you coming? (ä½ æ¥å—)</p></blockquote><h4 id="2016-5-23-Personality-Traits"><a href="#2016-5-23-Personality-Traits" class="headerlink" title="2016.5.23 Personality Traits"></a>2016.5.23 Personality Traits</h4><p><strong>XG:</strong> <em>Ouch! I just got bit again by another skeeter(èšŠå­)! I think summer is just around the corner.</em></p><blockquote><p>Summer is just around the corner (å¤å¤©å°±è¦æ¥äº†)</p></blockquote><p><strong>JJï¼š</strong> <em>Yeah, you must have sweet blood.</em><br><strong>XGï¼š</strong> <em>Well, all I know is that my blood type is â€œAâ€, Iâ€™m not sure if itâ€™s sweet or not.</em><br><strong>JJï¼š</strong> <em>Oh, you know your blood type eh? Did you know that thereâ€™s been a lot of research done about blood type in relation to personality?</em><br><strong>XGï¼š</strong> <em>No, I didnâ€™t,can you enlighten me?</em></p><blockquote><p>enlighten me (ç»™æˆ‘è®²è®²ï¼Œè®©æˆ‘æ˜ç™½å—æ•™)</p></blockquote><p><strong>JJï¼š</strong> <em>As you know,there are four possible blood types that a human being can have: A, B, AB, and O. Since youâ€™re A, let me tell you a few things about your personality.</em><br><strong>XGï¼š</strong> <em>Okay, give it your best shot.</em></p><blockquote><p>Let me give it a shot (è®©æˆ‘è¯•ä¸€è¯•)<br>give it your best shot (ä½ æ¥è¯•è¯•å§)</p></blockquote><p><strong>JJï¼š</strong> <em>Most type As are sensitive to the needs of others and are good listeners.</em><br><strong>XGï¼š</strong> <em>Yeah, well,doesnâ€™t this describe everyone?</em><br><strong>JJï¼š</strong> * Hold on! Iâ€™m not done yet! Youâ€™re also detail-oriented, creative and inventive. On the outside, you seem really calm, but on the inside, you are filled with anxiety and worry.*</p><blockquote><p>on the outside (åœ¨å¤–è¡¨çœ‹æ¥) on the inside (åœ¨å†…å¿ƒçœ‹æ¥)</p></blockquote><p><strong>XGï¼š</strong> <em>Youâ€™re lying! I think you are describing me on purpose.</em></p><blockquote><p>â€¦ on purpose (â€¦ æ˜¯æ•…æ„çš„)</p></blockquote><p><strong>JJï¼š</strong> <em>Iâ€™m not kidding! The research really shows this. Also, type As are usually shy and sensitive, and a lot of them are perfectionistsï¼ˆå®Œç¾ä¸»ä¹‰è€…ï¼‰.</em><br><strong>XGï¼š</strong> <em>Thatâ€™s me to a T!</em></p><blockquote><p>.. to a T (è¡¨ç¤ºå‡†ç¡®æäº†ï¼Œå®Œå…¨ç²¾å‡†çš„æè¿°)</p></blockquote><p><strong>JJï¼š</strong> <em>Romantically,type As work best with other type As and ABs.</em></p><blockquote><p>Romantically (æ„Ÿæƒ…ä¸Šè¯´)</p></blockquote><p><strong>XGï¼š</strong> <em>What do type As end up doing for jobs?</em><br><strong>JJ:</strong> <em>Common type A career choices include accountants, librarians, economists, computer programmers and writers.</em><br><strong>XG:</strong> <em>I was once a computer programmer! Does it say anything about us being really stressed out(å‹åŠ›å¤§)?Iâ€™m usually pretty tenseï¼ˆç´§å¼ ï¼‰ during the day.</em><br><strong>JJï¼š</strong> <em>Yes it does,actually. Most type As often bottle up anxiety in order to get along with others. Many of them are tense, impatient, and unable to sleep well.</em></p><blockquote><p>bottle up emotions [anxiety] (æŠŠç„¦è™‘è—èµ·æ¥ï¼Œæƒ³è±¡ç“¶å­è£…èµ·æ¥ä¸€ä¸ªä¸œè¥¿å¹¶ä¸”æŠŠç“¶å¡å¡ä¸Šï¼Œåœ¨æ„Ÿæƒ…è—åœ¨å¿ƒé‡Œï¼Œä¸å‘Šè¯‰åˆ«äººï¼Œä¹Ÿä¸é‡Šæ”¾å‡ºæ¥)</p></blockquote><p><strong>XGï¼š</strong> <em>Ahh! Itâ€™s like youâ€™re reading my mind! What blood type are you? Tell me now!!</em></p><blockquote><p>read my mind (è¯»å¿ƒ)</p></blockquote><p><strong>JJï¼š</strong> <em>Thatâ€™s for you to determine. Go home and research all the different blood types, then letâ€™s see if you can guess it correctly!</em><br><strong>XG:</strong> <em>Okay, Jingjing, Iâ€™ve done my research. I think I know which blood type you are.</em><br><strong>JJ:</strong> <em>Oh yeah? Which one?</em><br><strong>XG:</strong> <em>Youâ€™re a type B!</em><br><strong>JJ:</strong> <em>Youâ€™re right.But how did you come to that conclusion?</em></p><blockquote><p>come to that conclusion. (æ€ä¹ˆå¾—å‡ºè¿™ä¸ªç»“è®ºï¼Œæœ‰ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹åœ¨é‡Œé¢)</p></blockquote><p><strong>XG:</strong> <em>Well, it said type Bs are easygoing(éšå’Œçš„), creative, original and flexible.</em><br><strong>JJï¼š</strong> <em>Can you say something more concreteï¼ˆå…·ä½“çš„ï¼‰?</em><br><strong>XGï¼š</strong> <em>Well, it says that type Bs are globally-oriented people. Also, it says that you learn best through listening. On top of thatï¼ˆå¹¶ä¸”ï¼‰, it says you are goal-oriented and ambitious.</em></p><blockquote><p>on top of that (å¹¶ä¸”)</p></blockquote><p><strong>JJï¼š</strong> <em>Itâ€™s true, I am good at listening, thatâ€™s why I like working on the radio.</em><br><strong>XGï¼š</strong> * It also said you arenâ€™t a very picky person, and you donâ€™t worry about little things too much.*</p><blockquote><p>a picky person (ä¸€ä¸ªæŒ‘å‰”çš„äººï¼Œè®¡è¾ƒçš„äºº)</p></blockquote><p><strong>JJ:</strong> <em>Yup, for example, I donâ€™t say anything to you when you come to work dressed like a slob (æ²¡æœ‰æ¡ç†ï¼Œé‚‹é¢çš„äºº).</em><br><strong>XG:</strong> <em>Hey! That wasnâ€™t very nice.</em><br><strong>JJ:</strong> <em>How about romance-wise?</em></p><blockquote><p>romance-wise (æ„Ÿæƒ…æ–¹é¢ï¼Œæ„Ÿæƒ…è§’åº¦)<br>time-wise (æ—¶é—´æ–¹é¢ï¼Œæ—¶é—´è§’åº¦)</p></blockquote><p><strong>XGï¼š</strong> <em>Type Bs do best with other type Bs and ABs.</em></p><blockquote><p>do best with others = work together well.</p></blockquote><p><strong>JJ:</strong> <em>Anything else?</em><br><strong>XG:</strong> <em>Basically, you are thoughtful like type As and ambitious like Os. Itâ€™s a very interesting blood type. But do you know what the smoking gun was that made me convinced you were blood type B?</em></p><blockquote><p>smoking gun (è®©ä½ ç ´æ¡ˆçš„çº¿ç´¢ï¼Œç¡®å‡¿è¯æ®ï¼Œ  æƒ³è±¡å†’çƒŸçš„æªï¼Œç ´æ¡ˆçš„çº¿ç´¢)</p></blockquote><p><strong>JJï¼š</strong> <em>No, what was it?</em><br><strong>XGï¼š</strong> <em>Common career choices for type B, such as cooks, military leadersï¼ˆå†›å®˜ï¼‰, talk show hosts and journalists!</em><br><strong>JJï¼š</strong> <em>Thatâ€™s me,indeed! Good job, Greg! So we talked about blood type As and blood type Bs, but do you remember me telling you there was also a blood type AB?</em></p><blockquote><p>do you remember sb doing sth</p></blockquote><p><strong>XG:</strong> <em>Yeah, Ido, I found them to be the most interesting of all!</em><br><strong>JJ:</strong> <em>Me too. Not surprisingly, they have both A and B traits(ç‰¹æ€§).Sometimes theyâ€™re shy and outgoingï¼ˆå¤–å‘çš„ï¼Œextrovertedï¼‰, hesitant and confident.</em><br><strong>XG:</strong> <em>Type ABs often stand out like a sore thumb among other types. They are trustworthy and like to help others.</em></p><blockquote><p>stand out like a sore thumb ï¼ˆæ°å‡ºï¼Œçªå‡ºï¼Œé¹¤ç«‹é¸¡ç¾¤ï¼‰<br>trustworthy (å¯é çš„)</p></blockquote><p><strong>JJï¼š</strong> <em>They also think logically and are determined to do things correctly.</em></p><blockquote><p>think logicaly/emotionally/rationally (é€»è¾‘ã€æ„Ÿæ€§ã€ç†æ€§)</p></blockquote><p><strong>XGï¼š</strong> <em>Type ABs can find a soul mate with any other blood type.</em></p><blockquote><p>soul mate ï¼ˆçµé­‚ä¼´ä¾£ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>Did you know that both John F. Kennedy and Marilyn Monroe are type ABs?</em><br><strong>XGï¼š</strong> <em>Yeah, what a coincidence! Whatâ€™s even more interesting is that only about 2%ï½5% of the population are blood type AB.</em></p><blockquote><p>what a coincidence (å¤ªå·§äº†)</p></blockquote><p><strong>JJï¼š</strong> <em>Theyâ€™re really charmingï¼ˆè¿·äººçš„ï¼Œå¯çˆ±çš„ï¼‰ and popular. They donâ€™t sweat the small stuff.</em></p><blockquote><p>sweat the small stuff (ä¸æ‹˜å°èŠ‚ï¼Œä¸çº ç»“äºå°äº‹æƒ…, ä¸ä¸ºå°äº‹çƒ¦å¿ƒ)</p></blockquote><p><strong>XGï¼š</strong> <em>So what do type ABs usually do for work?</em><br><strong>JJï¼š</strong> <em>Well, some common type AB careers are bartendersï¼ˆè°ƒé…’å¸ˆï¼‰, lawyers, teachers and sales peopleï¼ˆé”€å”®ï¼‰.</em><br><strong>XGï¼š</strong> <em>Thereâ€™s never a dull moment in a type ABs life. If you can find one for a friend, consider yourself lucky! Well, weâ€™ve talked about A, B, and AB. We havenâ€™t even said a thing about type O yet.</em></p><blockquote><p>Thereâ€™s never a dull moment in sth (åœ¨sthä¸Šä¸€ç‚¹ä¹Ÿä¸å•è°ƒ)  Thereâ€™s never a dull moment in GFG<br>consider yourself lucky (ä½ å®åœ¨å¤ªå¹¸è¿äº†)</p></blockquote><p><strong>JJï¼š</strong> <em>Type Os are really unique. Theyâ€™re responsible, decisiveï¼ˆæœ‰å†³å¿ƒçš„ï¼‰, organizedï¼ˆæœ‰æ¡ç†çš„ï¼‰, and practicalï¼ˆåŠ¡å®çš„ï¼‰.</em><br><strong>XGï¼š</strong> <em>Thatâ€™s right. Type Os are shot callers. They often end up being bankers,politicians, gamblersï¼ˆèµŒå¾’ï¼‰, investment brokersï¼ˆæŠ•èµ„ç»çºªäººï¼‰, and pro athletes</em></p><blockquote><p>shot caller (æ³•ä»¤å¼€æªçš„äººï¼ŒæŒ‡â€œå†³ç­–äººâ€)</p></blockquote><p><strong>JJï¼š</strong> <em>They tend to be lonersï¼ˆç‹¬è¡Œä¾ ï¼‰ or leaders and are self-reliantï¼ˆè‡ªç«‹çš„ï¼‰ and daringï¼ˆå‹‡æ•¢çš„ï¼‰.</em><br><strong>XGï¼š</strong> <em>They cope with stress better than any other blood types and donâ€™t get sick that much.</em></p><blockquote><p>cope with sth (å¤„ç†sth) ï¼ˆå¯ä»¥å†ä¹Ÿä¸ç”¨handleäº†ï¼Œ æ¬§è€¶ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>They also have a strong build ï¼ˆå¥åº·çš„ä½“é­„ï¼‰and like to stay active.</em><br><strong>XGï¼š</strong> <em>Being hard-headedï¼ˆå¤´è„‘æ¸…æ™°å†·é™çš„ï¼‰ and determined to succeed helps them to reach their goals.</em></p><blockquote><p>be determined to do sth (å†³å¿ƒè¦åšæŸäº‹)<br>reach oneâ€™s goal (å®ç°ç›®æ ‡)</p></blockquote><p><strong>JJï¼š</strong> <em>Theyâ€™re also really creative and are often the center of attention.</em></p><blockquote><p>the center of attention (å…³æ³¨çš„ç„¦ç‚¹) Children offen wanna be the center of attention.</p></blockquote><p><strong>XG:</strong> <em>Thatâ€™s right, they are the social butterflies that you meet in life from time to time.</em></p><blockquote><p>social butterfly (å–„äºäº¤é™…çš„ï¼Œæ²¡æœ‰è´¬ä¹‰)<br>from time to time (ä¸æ—¶ï¼Œæœ‰æ—¶ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>What I found most interesting is that they seem to use their five senses better than the other blood types.</em><br><strong>XGï¼š</strong> <em>Well, now we know a lot more about different blood types. Iâ€™m still surprised at how accurately it described me.</em></p><blockquote><p>be surprised at sth (åƒæƒŠâ€¦ )</p></blockquote><h4 id="2016-6-1-Awesome-Brand-New-Book-Is-Out"><a href="#2016-6-1-Awesome-Brand-New-Book-Is-Out" class="headerlink" title="2016.6.1 Awesome Brand New Book Is Out"></a>2016.6.1 Awesome Brand New Book Is Out</h4><p><strong>JW:</strong> <em>Hey, Anya. Howâ€™s it hanging? What are you doing</em></p><blockquote><p>howâ€™s it hanging? = whatâ€™s going on? = how youâ€™re doing ? ï¼ˆæœ€è¿‘æ€ä¹ˆæ ·ï¼‰</p></blockquote><p><strong>AY:</strong> <em>Iâ€™m listening to Going for Gold. Normally Iâ€™d be studying the book, but Iâ€™ve already gone through the whole thing</em></p><blockquote><p>normally (ä¸€èˆ¬æ¥è¯´)<br>Go through the whole thing = to finish something entirely, front to back (å®ŒæˆæŸäº‹)</p></blockquote><p><strong>JW:</strong> <em>Oh, I love Going for Gold. I canâ€™t imagine life without it.</em></p><blockquote><p>I canâ€™t imagine life without it (æ ‡å‡†å¥å‹ï¼Œæ³¨æ„ä½¿ç”¨ï¼Œâ€œä¸æ•¢æƒ³è±¡ç”Ÿæ´»æ²¡æœ‰å®ƒä¼šæ€æ ·â€)</p></blockquote><p><strong>AYï¼š</strong> <em>Me too. I bought Jing Jing and Xiao Gaoâ€™s first book last year. Also, I listen to their show using an app on my phone. I like to look at the scriptï¼ˆæ–‡æœ¬ï¼‰ on WeChat</em><br><strong>JWï¼š</strong> <em>:I get home from work pretty late at night, but Jing Jing always hosts an evening show online for those of us who like to self-studyï¼ˆè‡ªå­¦ï¼‰. Iâ€™ve gotten so much out of it. Iâ€™ve learned so many native phrases(ç”¨è¯­ï¼ŒçŸ­è¯­)!</em></p><blockquote><p>Iâ€™ve gotten so much out of it (æˆ‘è§‰å¾—æ”¶è·å¾ˆå¤§)</p></blockquote><p><strong>AY:</strong> <em>This is the best program Iâ€™ve ever listened to. It totally changed the way I study English. I wasnâ€™t learning native stuff in the past, in fact it was mostly Chinglishï¼ˆä¸­å¼è‹±è¯­ï¼‰. By following Going for Gold, not only have I learned how to express myself, but Iâ€™ve learned correct pronunciation and have gained confidence in speaking.</em></p><blockquote><p>gain confidence (è·å¾—è‡ªä¿¡) improve confidence (æå‡è‡ªä¿¡)</p></blockquote><p><strong>JWï¼š</strong> <em>The first book was awesome because it came with an MP3 CD. The second book is even better because you can download the dialogues for free. Iâ€™m definitely buying the second book so I can keep learning.</em></p><blockquote><p>sth1 came with sth2 (sth1éšèº«é™„å¸¦sth2)</p></blockquote><p><strong>AYï¼š</strong> <em>:Iâ€™ve already passed the show on to several of my friends, classmates, and even family members. I really liked watching Xiao Gaoâ€™s videos that he used to post on Weibo. I hope he posts more in the future. It was a great way to learn!</em></p><blockquote><p>pass sth on to sb = to share [something] with other people (å¤šæŒ‡å£å¤´åˆ†äº«)<br>post (å‘å¸ƒä¸œè¥¿)</p></blockquote><p><strong>JWï¼š</strong> <em>I heard there was a way to get an autographed copy of the new book. Is that true?</em></p><blockquote><p>autographed copy of the new book (æ–°ä¹¦çš„ç­¾åç‰ˆ)</p></blockquote><p><strong>AYï¼š</strong> <em>Yeah, we just have to follow Jing Jingâ€™s Weibo account and forward comments about the book, then weâ€™ll be eligible for a raffleï¼ˆæŠ½å¥–ï¼‰. Theyâ€™ll announce the winners on the weekend.</em></p><blockquote><p>be eligible for sth/doing sth (æœ‰èµ„æ ¼åšæŸäº‹)</p></blockquote><p><strong>JWï¼š</strong> <em>I heard this book is a limited edition. Iâ€™d better hurry up and buy it!</em></p><blockquote><p>limited edition (é™é‡ç‰ˆ)<br>Iâ€™d better hurry up and buy it! (æˆ‘å¾—èµ¶ç´§å…¥æ‰‹)</p></blockquote><p><strong>AYï¼š</strong> <em>Yeah, what are you waiting for? Next Monday will be the first class of the new book. Iâ€™m gonna participate more in the WeChat challenges each week, because the more I practice, the better I get. This is another reason why I love this radio show so much!</em><br><strong>JWï¼š</strong> <em>Hey, we forgot the most important part: Going for Gold is free! We can learn so many things without paying anything. That is so awesome!</em></p><blockquote><p>so much feedback (æ³¨æ„ç”¨much)</p></blockquote><h4 id="2016-6-6-Bad-Habits"><a href="#2016-6-6-Bad-Habits" class="headerlink" title="2016.6.6 Bad Habits"></a>2016.6.6 Bad Habits</h4><p><strong>JJ:</strong> <em>Pee yew! Whatâ€™s that awful smell?</em></p><blockquote><p>Pee yew (å’¿å‘€, å£è¯­åŒ–çš„è¡¨è¾¾ï¼Œ é€šå¸¸å’Œ whatâ€™s that awful smell ä»€ä¹ˆå‘³é“è¿™ä¹ˆéš¾é—»)</p></blockquote><p><strong>XG:</strong> <em>Donâ€™t look at me! I took a shower today!</em></p><blockquote><p>take a shower (æ´—æ¾¡ï¼ŒæŒ‡æ·‹æµ´)  shower ä¹Ÿå¯ä»¥å½“åŠ¨è¯ä½¿ç”¨ï¼Œ I showered today (æˆ‘ä»Šå¤©æ´—æ¾¡äº†)</p></blockquote><p><strong>JJï¼š</strong> <em>No, I meanâ€¦ something smells like smoke. *<br><strong>XGï¼š</strong> *Oh, I recently picked up a bad habit. I started smoking a few weeks ago</em></p><blockquote><p>pick up a bad habit ï¼ˆå…»æˆä¸€ä¸ªåä¹ æƒ¯ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>Really? Why did you start doing that?</em></p><blockquote><p>Why did you start doing that (ä½ æ˜¯æ€æ ·å¼€å§‹çš„ï¼Ÿ )</p></blockquote><p><strong>XGï¼š</strong> <em>I bummed a cigarette from my friend one day. After that, I got hooked.</em></p><blockquote><p>bum (to ask someone for something without intending to pay for it), (æœ‰ä¸€å¤©æˆ‘ä»æˆ‘æœ‹å‹é‚£å„¿é¡ºäº†ä¸€æ ¹çƒŸ)<br>get hooked [on sth] ([å¯¹æŸäº‹]ä¸Šç˜¾)</p></blockquote><p><strong>JJï¼š</strong> <em>Well, I think you should kick the habit!</em></p><blockquote><p>kick the habit (æ”¹æ‰é‚£ä¸ªä¹ æƒ¯)</p></blockquote><p><strong>XGï¼š</strong> <em>I want to, but itâ€™s really hard!</em><br><strong>JJï¼š</strong> <em>You know what they say: Bad habits are like comfortable beds, easy to get into, hard to get out of.</em></p><blockquote><p>you know what they say [that]â€¦(ä¿—è¯è¯´â€¦)</p></blockquote><p><strong>XG:</strong> <em>You can say that again. So, do you have any suggestions on how to quit?</em></p><blockquote><p>you can say that again (ä½ è¯´çš„å¤ªå¯¹äº†ï¼Œç”¨ä»¥è¡¨ç¤ºâ€œè‚¯å®šâ€)<br>suggestions on â€¦ (â€¦çš„å»ºè®®)</p></blockquote><p><strong>JJï¼š</strong> <em>I heard the patchï¼ˆæˆ’çƒŸè´´ç‰‡ï¼‰ works really well. Why donâ€™t you give it a try and see if it helps?</em><br><strong>XGï¼š</strong> <em>Okay, Iâ€™ll give it a shot. Talk to you later!</em><br><strong>JJï¼š</strong> <em>Hey, Xiaogao.Were you able to quit smoking yet?</em><br><strong>XGï¼š</strong> * Yes, thank God! It was really hard, but I finally did it.*</p><blockquote><p>It was really hard, but I finally did it (å¯ä»¥å¸¸ç”¨ï¼Œè¡¨ç¤ºç»è¿‡ä¸€ç•ªåŠªåŠ›å–å¾—æˆåŠŸï¼Œå¾ˆæœ‰æˆå°±æ„Ÿçš„æ„Ÿè„š)</p></blockquote><p><strong>JJï¼š</strong> <em>Iâ€™m sure it was, after all, old habits die hard. So did you use the patch?</em></p><blockquote><p>old habits die hard (æ—§ä¹ éš¾æ”¹)</p></blockquote><p><strong>XGï¼š</strong> <em>No, the patch was a rip off, so I didnâ€™t buy it.</em></p><blockquote><p>sth is a rip off (â€¦å¤ªè´µäº†)</p></blockquote><p><strong>JJï¼š</strong> <em>So how did you do it?</em><br><strong>XGï¼š</strong> <em>I went cold turkey. Itâ€™s the cheapest and most effective method there is.</em></p><blockquote><p>go/went code turkey (é‡‡ç”¨ç®€å•ç²—æš´çš„æ–¹æ³•, ç«‹åˆ»å®Œå…¨åœæ­¢åšæŸäº‹ï¼Œä¸å€ŸåŠ©ä»»ä½•è¯ç‰©çš„å¸®åŠ©ï¼Œä¹Ÿä¸ç»™è‡ªå·±ç•™æ—¶é—´æ…¢æ…¢æ¥)</p></blockquote><p><strong>JJï¼š</strong> <em>Wow, good for you! How do you feel now? Did you have any withdrawals?</em></p><blockquote><p>withdrawal (å‰¯ä½œç”¨ï¼Œç˜¾ã€‚å› ä¸ºæ²¡æœ‰è·å¾—è¶³å¤Ÿè‡ªå·±å·²ç»ä¸Šç˜¾çš„ç‰©è´¨ï¼Œä¾‹å¦‚å’–å•¡å› ã€å°¼å¤ä¸ã€é…’ç²¾ç­‰ï¼Œè€Œé€ æˆçš„éš¾å—çš„æ„Ÿè§‰)<br>phisical suffering</p></blockquote><p><strong>XGï¼š</strong> <em>For the first three days I had a headache,after that it was smooth sailing.</em></p><blockquote><p>smooth sailing (ä¸€å¸†é£é¡º)</p></blockquote><p><strong>JJï¼š</strong> <em>Well, Iâ€™m glad youâ€™ve given yourself a new lease of life. In the future, donâ€™t bum anymore cigarettes!</em></p><blockquote><p>a new lease of life=æ–°é¢è²Œï¼Œåœ¨ç»å†ä¸€æ®µè‰°è¾›åè¿æ¥çš„å´­æ–°ç”Ÿæ´»<br>donâ€™t bum anymore cigarettes (ä»¥åå¯åˆ«å†æ²¾çƒŸäº†)</p></blockquote><p><strong>XG:</strong> <em>I learned my lesson, I wonâ€™t make that mistake again!</em></p><blockquote><p>I learned my lesson.=å¸å–äº†æ•™è®­ã€‚æŒ‡æŸäººçŠ¯è¿‡ä¸€æ¬¡é”™è¯¯åï¼Œä¸ä¼šå†çŠ¯ç±»ä¼¼çš„é”™è¯¯ã€‚<br>I wonâ€™t make that mistake again = æˆ‘ä¸ä¼šå†çŠ¯é‚£æ ·çš„é”™</p></blockquote><h4 id="2016-6-13-Getting-Along-with-Co-workers"><a href="#2016-6-13-Getting-Along-with-Co-workers" class="headerlink" title="2016.6.13 Getting Along with Co-workers"></a>2016.6.13 Getting Along with Co-workers</h4><p><strong>XG:</strong> <em>Ohhh, Jingjing! I have been having the worst time at work lately! My co-workers are driving me up the wall.</em></p><blockquote><p>drive sb nuts/crazy/up the wall/bonkers/ lose sbâ€™s nerve</p></blockquote><p><strong>JJ:</strong> <em>Well, you came to the right person. You know Iâ€™m always here to listen when you want to vent your feelings. So whatâ€™s up? Who is bothering you and why?</em></p><blockquote><p>you came to the right person (ä½ é—®å¯¹äººäº†)<br>vent oneâ€™s feelings (åæ§½ï¼Œå‘æ³„æƒ…ç»ª)</p></blockquote><p><strong>XGï¼š</strong> <em>Well, my cube mate, Jerry, smacks gum all day. Itâ€™s so distractingï¼ˆåˆ†å¿ƒçš„ï¼‰ and discourteousï¼ˆæ— ç¤¼çš„ï¼‰!</em></p><blockquote><p>cubicleçš„å£è¯­åŒ–ç®€ç§° cube (æŒ‡åŠå…¬å®¤çš„å·¥ä½)<br>smack gum (åš¼å£é¦™ç³–å‡ºå£°éŸ³)<br>slurp  smack ï¼ˆéƒ½æŒ‡å‡ºå£°éŸ³çš„å’€åš¼ä¸œè¥¿ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>Have you ever thought about asking him to not chew so loudly? Or how about asking your boss if you can change cubicles?</em></p><blockquote><p>have you ever thought about sth</p></blockquote><p><strong>XG:</strong> <em>Iâ€™ve thought about that, but weâ€™re working on the same project together, I donâ€™t want to make him upset. Anyways, I can live with this problem, but thereâ€™s some other things at work that are making me lose my nerve too.</em></p><blockquote><p>work on sth<br>make sb upset ï¼ˆè®©æŸäººå¿ƒçƒ¦ï¼‰<br>live with sth (å¿å—sth)<br>lose my nerve ï¼ˆå¿æ— å¯å¿ï¼Œè®©æˆ‘æŠ“ç‹‚ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>Yeah? Like what?</em></p><blockquote><p>like whatï¼ˆä»€ä¹ˆäº‹ï¼Ÿï¼‰, like whoï¼ˆæ¯”å¦‚è°ï¼Ÿï¼‰, like whenï¼ˆä»€ä¹ˆæ—¶å€™ï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>My other co-worker, Bob, takes all the credit for the work I do. I designed a website last week for our company, Bob only edited two pictures, but he told everyone that he did the whole thing! Itâ€™s so unfair!</em></p><blockquote><p>take all the credit for sth ï¼ˆæŠ¢åŠŸå ä¸ºå·±æœ‰ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>Yeah, I feel you. Thatâ€™s happened to me a couple times too. I suggest you tell Bob that he isnâ€™t being a team player. You have a right to tell him how much it upset you, but be careful not to lose your temper and start screaming at him. He probably doesnâ€™t realize what he did.</em></p><blockquote><p>I feel you (æˆ‘ç†è§£ä½  I understand you)<br>you have a/every/the right to do sth<br>lose oneâ€™s temper (å¤±æ€ï¼Œå‘è„¾æ°”)<br>scream/yell at sb ï¼ˆå¤§å¼å¤§å«æŸäººï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>Youâ€™re probably right. Wow, you sure know a lot about this kind of situation.Can you give me some more advice?</em></p><blockquote><p>can you give me some more advice? = can I pick your brains?</p></blockquote><p><strong>JJ:</strong> <em>I tell you what, itâ€™s almost lunch time. Letâ€™s go sit down at a restaurant and Iâ€™ll tell you some rules of thumb for dealing with difficult people at work.</em></p><blockquote><p>a rule of thumb=ç»éªŒæ³•åˆ™ï¼Œä¸ºé€‚å®œçš„è¡Œä¸ºæä¾›æŒ‡å¯¼<br>deal with sb ï¼ˆå’ŒæŸäººç›¸å¤„ï¼Œæ‰“äº¤é“ï¼‰</p></blockquote><p><strong>Jingjing and Xiaogao sit down at a restaurant and begin their conversation</strong><br><strong>JJ:</strong> <em>Alright, Xiaogao, rule number one: when youâ€™re at work, make sure you always carry your own weight.That means you should always do whatâ€™s asked of you and try not to let other co-workers pick up the slack.</em></p><blockquote><p>carry your own weight (åšå¥½åˆ†å†…çš„äº‹ï¼Œä¸èƒ½è¦æ±‚åˆ«äººä¸ºä½ åš)<br>pick up the slack (æ›¿åˆ«äººåšä»–ä»¬åº”è¯¥åšä½†æ²¡æœ‰åšçš„)</p></blockquote><p><strong>XG:</strong> <em>Okay, that I can do. But what about when my co-workers are in a grumpy mood? Sometimes I want to lash out at them.</em></p><blockquote><p>grumpyï¼ˆmoodï¼‰=è„¾æ°”æš´èºï¼Œç”Ÿæ°”æˆ–ä¸å‹å–„<br>lash out at sb ï¼ˆå‘æŸäººå‘ç«ï¼‰ï¼Œ yell at sb, lay into sb(ç—›æ–¥æŸäºº)<br>I am so gonna do (æˆ‘ç‰¹åˆ«æƒ³åš)</p></blockquote><p><strong>JJ:</strong> <em>That brings me to rule number two: no matter how other people act at work, you should always maintain a professional attitude. That means you should talk to people with respect at all times. If something bothers you, you can talk to your boss or the HR department.</em></p><blockquote><p>maintain a professional attritude (ä¿æŒä¸“ä¸šçš„æ€åº¦)</p></blockquote><p><strong>XGï¼š</strong> <em>I have another co-worker who sits close to me, her name is Amanda. Sheâ€™s always on the phone with her boyfriend talking up a storm. Itâ€™s really distracting, just like Jerry chewing his gum(æ²¡æœ‰å¤æ•°å½¢å¼ï¼Œæœ¬èº«å°±æ˜¯å¤æ•°). What should I do about that? Sheâ€™s a girl, is it okay to confront her about it?</em></p><blockquote><p>Sheâ€™s always on the phone with her boyfriend talking up a storm,Itâ€™s really distracting (å¥¹æ€»æ˜¯å’Œå¥¹çš„ç”·æœ‹å‹ç…²ç”µè¯ç²¥ã€‚è¿™çœŸçš„å¾ˆè®©äººåˆ†å¿ƒ)<br>talk up a storm (æ»”æ»”ä¸ç»çš„è®²)<br>confront sb (ç›´é¢æŸäºº)</p></blockquote><p><strong>JJï¼š</strong> <em>Of course itâ€™s okay. Just remember to stay professional and ask nicely. She probably doesnâ€™t realize that sheâ€™s being a chatterbox. If you ask her nicely Iâ€™m sure sheâ€™ll keep her voice down.</em></p><blockquote><p>She probably doesnâ€™t realize that sheâ€™s being a chatterbox (å¥¹å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°è‡ªå·±ä¸€ç›´åœ¨å–‹å–‹ä¸ä¼‘)<br>keep her voice down</p></blockquote><p><strong>XG:</strong> <em>Thanks for all your advice. I have to get back to work now, wish me luck.</em><br><strong>JJ:</strong> <em>One last thing, Xiaogao. Just remember that the most important thing at work is getting along with your co-workers. If you have a bad relationship with them, then you will start to hate your job, or maybe your coworkers will despise(é„™è§†) you. A happy workplace is a healthy workplace!</em></p><p><strong>XGï¼š</strong> <em>Got it. Okay, I gotta run. Talk to you later!</em><br><strong>JJï¼š</strong> <em>Hey, Xiaogao! You didnâ€™t pay the bill! Waaaaiiit! Ohâ€¦ forget it!</em></p><blockquote><p>pay the bill (ä¹°å•)<br>forget it ï¼ˆç®—äº†å§ï¼‰</p></blockquote><h4 id="2016-6-20-A-Fork-in-a-Road"><a href="#2016-6-20-A-Fork-in-a-Road" class="headerlink" title="2016.6.20 A Fork in a Road"></a>2016.6.20 A Fork in a Road</h4><p><strong>XG:</strong> <em>Hey, Jing Jing,why do you look so vexed?</em></p><blockquote><p>vexed = annoyed (å¿ƒçƒ¦æ„ä¹±çš„)</p></blockquote><p><strong>JJ:</strong> <em>Iâ€™ve come to a fork in the road, I donâ€™t know what to do. Can you give me some advice?</em></p><blockquote><p>Come to a fork in the road = be in a position where you must make a tough decision (äººç”Ÿåšé‡è¦å†³å®šçš„å…³å£)<br>give sb some advice/pointers/tips ï¼ˆç»™æŸäººå»ºè®®ï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>Sure, Iâ€™ll trymy best. Whatâ€™s up?</em><br><strong>JJï¼š</strong> <em>Well, Iâ€™ve been working as an RN at an ICU unit for the past four years, but I feel like Iâ€™ve hit a plateau. Itâ€™s the same thing over and over, the night shift is really taking a toll on me. But three years ago, a teacher got me thinking, and I started to look into nursing overseas. I began to study professional English with the hopes of one day working as a nurse abroad.</em></p><blockquote><p>RN (Registered Nurse) æ³¨å†ŒæŠ¤å£«<br>ICU (Intensive Care Unit) é‡ç—‡ç›‘æŠ¤å®¤<br>hit a plateau = to be unable to make any more progress (åˆ°è¾¾ç“¶é¢ˆå¤„)<br>overcome / break out/ surmount the plateau å…‹æœç“¶é¢ˆ<br>night shift/day shift (å¤œç­/ç™½ç­)<br>take a toll on sb = If something takes its/a toll, it causes suffering, deaths, or damage<br>get one thinking (å¯å‘ï¼Œç»™äº†æŸäººä¸€ä¸ªçµæ„Ÿ)<br>look into (é’»ç ”ï¼Œç ”ç©¶)</p></blockquote><p><strong>XGï¼š</strong> <em>It sounds like a no-brainer.Whatâ€™s holding you back?</em></p><blockquote><p>no-brainer = requiring no thought; an easy decision (ä¸éœ€è¦è´¹è„‘å­çš„å†³å®š)<br>hold sb back = make [one] hesitate ï¼ˆè®©äººçŠ¹è±«ä¸å†³ï¼‰</p></blockquote><p><strong>JJï¼š</strong> <em>I took a test in Singapore from the SNB and passed with flying colors. Just as I was about to make my next move, my parents and boyfriend complained that I shouldnâ€™t go abroad to be a nurse. Theyâ€™re worried that I wonâ€™t be able to adapt to the way of life and work environment over there. And once I go to work abroad, Iâ€™ll lose my job here in China. My parents donâ€™t have really high expectations of me, theyâ€™ve never demanded that I find a super high paying job. As long as I am near their side theyâ€™ll be happy.</em></p><blockquote><p>pass with flying colors (é«˜åˆ†é€šè¿‡)<br>have high expectations of/on sb (å¯¹æŸäººæœ‰å¾ˆé«˜çš„æœŸå¾…)</p></blockquote><p><strong>XGï¼š</strong> <em>Well I think that might be the problem right there. Look at what youâ€™re saying: it will make your parents happy if you stay at the same hospital. Did they ever consider what would make you happy? If youâ€™ve studied English so hard and are able to pass the Singapore test, why should they be worried about you not being able to adapt to life abroad?</em></p><blockquote><p>I think that might be the problem right there (æˆ‘è§‰å¾—è¿™å¯èƒ½å°±æ˜¯é—®é¢˜çš„æ‰€åœ¨)<br>be adapt to env/sth (é€‚åº”â€¦)</p></blockquote><p><strong>JJ:</strong> <em>What they donâ€™t know is, Singapore was just my first step. My ultimate goal is to go to America to work as an RN. Iâ€™m confused about that too. Should I first use Singapore as a stepping stone and work there for a bit, or should I go directly to the United States to work?</em></p><blockquote><p>ultimate goal (ç»ˆæç›®æ ‡ï¼Œæœ€ç»ˆç›®æ ‡)<br>stepping stone (å«è„šçŸ³ï¼Œæ•²é—¨ç –)</p></blockquote><p><strong>XGï¼š</strong> <em>Thatâ€™s a tough call. Considering youâ€™re only 27 years old, youâ€™re still young and can do many things. If you wait any longer, you might miss your chance. I think going to Singapore first would be a good idea because you can prepare for what it feels like to work abroad. You might also learn important skills there that will help you when you go to the United States to work. Iâ€™m 32 years old. Iâ€™m preparing to start my second Masterâ€™s degree. I had to make this decision on my own.Taking a risk and coming to China was the best decision I â€˜ve ever made in my life.</em></p><blockquote><p>tough call = a hard decision<br>make a call = make a decision<br>you never too old to learn sth new<br>take a risk (å†’é™©)</p></blockquote><p><strong>JJï¼š</strong> <em>Okay, Iâ€™m starting to feel better now. But what if I canâ€™t find a job anywhere?</em><br><strong>XG:</strong> <em>Unless people stop becoming sick, youâ€™ll be able to find a job as a nurse anywhere on Earth. Good luck to you!</em></p><h4 id="2016-6-22-Saying-Goodbye"><a href="#2016-6-22-Saying-Goodbye" class="headerlink" title="2016.6.22 Saying Goodbye"></a>2016.6.22 Saying Goodbye</h4><p><strong>XG:</strong> <em>Well, Jingjing, Iâ€™m afraid Iâ€™m going to have to cut my stay short here in Beijing.</em></p><blockquote><p>cut my stay short (æå‰ç¦»å¼€) We had to cut short our holiday because Richard was ill.</p></blockquote><p><strong>JJ:</strong> <em>What? You mean youâ€™re gonna split(ç¦»å¼€)? Why? I thought you liked it here?</em><br><strong>XGï¼š</strong> <em>Donâ€™t worry, Iâ€™ll be back. Iâ€™m just going home to straighten out my visa.</em></p><blockquote><p>strainghten sth out / out sth = to solve a problem or to deal successfully with a confusing situation  (è§£å†³é—®é¢˜)</p><ul><li>Once we get these problems straightened out, we should be all right.<br>straighten sb out = to improve someoneâ€™s behaviour</li><li>I thought that once he got a girlfriend that would straighten him out.</li></ul></blockquote><p><strong>JJ:</strong> <em>Oh, okay, phew! Well, when are you coming back?</em></p><blockquote><p>phew (é‚£è¿˜å¥½ï¼Œå“å‘€ï¼Œä½ å“æ­»æˆ‘äº†ï¼Œè¯­æ°”è¯ï¼ŒæŒ‡æ¾äº†ä¸€å£æ°”)</p></blockquote><p><strong>XG:</strong> <em>Probably in a month or so. But I have to leave soon. My visa expires in a couple of days so itâ€™s a race against the clock to get back home as soon as possible.</em></p><blockquote><p>Probably in a month or so (ä¸€ä¸ªæœˆå·¦å³ï¼Œæ³¨æ„ or so)<br>race against the clock=åˆ†ç§’å¿…äº‰ï¼ŒæŒ‡ç€æ€¥</p></blockquote><p><strong>JJ:</strong> <em>Oh, I see. Well, when you come back hopefully youâ€™ll have all the time in the world. Itâ€™s no fun being pressed for time. Hey, do you have anyone that will send you to the airport?</em></p><blockquote><p>have all time in the world (æœ‰å¤§é‡çš„æ—¶é—´; æŒ‡ä¸å¿…æ‹…å¿ƒæˆ–æœ‰å‹åŠ›)<br>Itâ€™s no fun being pressed for time(è¿™ä¹ˆç´§è¿«å®åœ¨å¤ªç—›è‹¦äº†)<br>pressed for time (æ—¶é—´ç´§è¿«)</p></blockquote><p><strong>XG:</strong> <em>No, I was gonna take a cab there. Unlessâ€¦</em></p><blockquote><p>take a cab (åå‡ºç§Ÿè½¦)</p></blockquote><p><strong>JJï¼š</strong> <em>Of course Iâ€™ll take you! You know you donâ€™t have to ask that!</em></p><blockquote><p>æ³¨æ„You know you donâ€™t have to ask that! è¯­æ°”</p></blockquote><p><strong>XGï¼š</strong> <em>Really? Youâ€™re the greatest!</em><br><strong>JJï¼š</strong> <em>I know I am! What time does your flight leave?</em></p><blockquote><p>I know I am (æ¯”è¾ƒéª„å‚²çš„è¯´ï¼šæˆ‘ä¹Ÿè¿™ä¹ˆè®¤ä¸ºçš„)<br>What time does your flight[äº¤é€šå·¥å…·] leave? ï¼ˆä½ çš„èˆªç­å‡ ç‚¹èµ·é£ï¼‰</p></blockquote><p><strong>XGï¼š</strong> <em>Nine in the morning, do you think you can handle that?</em></p><blockquote><p>handle (æå®šï¼Œæ­¤å¤„ä»¥ä¸ºæ¥å¾—åŠå—)</p></blockquote><p><strong>JJï¼š</strong> <em>Iâ€™ll be at your place at 6:00 on the dot. See you then!</em></p><blockquote><p>on the dot/sharp(å‡†æ—¶å‡†ç‚¹ï¼Œåªèƒ½ç”¨åœ¨æ•´ç‚¹, å¦‚7:00 on the dotï¼Œä¸èƒ½è¯´7:15 on the dot</p></blockquote><p><strong>XGï¼š</strong> <em>I must say, Jingjing. I have to take my hat off for you, you said youâ€™d be at my place at 6:00 sharp and you were. I really appreciate it!</em></p><blockquote><p>I got to say/ I got to tell you (è€å®è¯´)<br>take my hat for sb (è„±å¸½è‡´æ•¬)<br>I really appreciate it</p></blockquote><p><strong>JJ:</strong> <em>No problem, you know I always keep my word. Well, right now itâ€™s only 7:00. You still have some time to kill before your plane leaves.</em></p><blockquote><p>keep my word (è¯´è¯ç®—è¯)<br>you have my word (ä¿å¯† ä¸æ³„å¯†) renege on our deal/go back on your words/go back on your promise åæ‚”<br>have some time to kill=æœ‰ç©ºé—²æ—¶é—´æ¥æ¶ˆç£¨</p></blockquote><p><strong>XG:</strong> <em>Okay, letâ€™s go get a cup of coffee. Itâ€™s my treat. (Xiaogao saysto the coffee shop worker) Two cups of coffee please.</em></p><blockquote><p>Itâ€™s my treat (æˆ‘è¯·å®¢)</p></blockquote><p><strong>JJ:</strong> <em>Wow! This coffee is so strong! It just about knocked my socks off! I donâ€™t usually drink coffee this early in the morning.</em></p><blockquote><p>knock oneâ€™s socks off=ï¼ˆé€šå¸¸æŒ‡å£å‘³æˆ–æ°”å‘³ï¼‰éå¸¸æµ“çƒˆã€‚ä¾‹å¦‚ï¼Œä¸€æ¯äºŒé”…å¤´ä¼šâ€œknock</p></blockquote><p><strong>XG:</strong> <em>Yeah, this is some good stuff. You know, Jingjing, Iâ€™m really gonna miss you.</em><br><strong>JJ:</strong> <em>Now is not the time to get all emotional. Here, I brought you a going away gift.</em></p><blockquote><p>ç°åœ¨è¿˜ä¸æ˜¯å‚¬æ³ªçš„æ—¶å€™ã€‚çœ‹ï¼Œæˆ‘ç»™ä½ å¸¦äº†ä¸€ä¸ªå‘Šåˆ«ç¤¼ç‰©</p></blockquote><p><strong>XG:</strong> <em>A gift? Why did you do that?</em><br><strong>JJ:</strong> <em>Itâ€™s common for Chinese to give a gift when someone is coming or going. You didnâ€™t know?</em><br><strong>XG:</strong> * No, I didnâ€™t. Thatâ€™s so nice of you. Can I open it?*<br><strong>JJ:</strong> <em>Be my guest.</em></p><blockquote><p>be my guest = of course è¯·ä¾¿</p></blockquote><p><strong>XG:</strong> <em>Cool! A new watch! I needed a new one!</em><br><strong>JJ:</strong> * Iâ€™m glad you like it.*<br><em>(The loud speaker at the airport says Now boarding flight1423 to Detroit.) Thatâ€™s my flight. I gotta bounce(é¢ äº†ï¼Œç¦»å¼€). Thanks for everything,Jingjing. Iâ€™ll see you when I get back.</em></p><h4 id="2016-6-27-Meeting-Someone-at-The-Airport"><a href="#2016-6-27-Meeting-Someone-at-The-Airport" class="headerlink" title="2016.6.27 Meeting Someone at The Airport"></a>2016.6.27 Meeting Someone at The Airport</h4><p><strong>M:</strong> <em>Hey! Long time no see! Thanks so much for picking me up!</em></p><blockquote><p>pick up sb/skill/knowledge/friend</p></blockquote><p><strong>JJ:</strong> <em>No problem! Your plane was a little late coming in. You must be beat!</em></p><blockquote><p>You must be beat (ä½ ä¸€å®šç´¯äº†å§)   Iâ€™m beat åä¹‰ Iâ€™m wired</p></blockquote><p><strong>M:</strong> <em>Iâ€™m fine, I chugged a bunch of coffee on the plane, so now Iâ€™m wired.</em></p><blockquote><p>chug ï¼ˆa drinkï¼‰=çŒï¼ˆé¥®æ–™ï¼‰ drink a lot of sth very quickly<br>wired=ç›¸å…¶å…´å¥‹çš„</p></blockquote><p><strong>JJ:</strong> <em>So? How was your trip? Tell me all about it.</em><br><strong>M:</strong> <em>I had a great time. It was really nice to see my family. I just wish that I could have stayed a little longer.</em><br><strong>JJ:</strong> <em>Well, you know what they say:all good things must come to an end. You should just be happy that you even got to go on vacation at all. Iâ€™ve been working here the past month, lucky you!</em></p><blockquote><p>you know what they say, all good things must come to an end  (ä¸€åˆ‡ç¾å¥½çš„äº‹ç‰©éƒ½ä¼šæœ‰å°½å¤´ï¼Œå¤©ä¸‹æ— ä¸æ•£çš„ç­µå¸­)<br>go on vacation</p></blockquote><p><strong>M:</strong> <em>Thatâ€™s true! Oh, I almost forgot, I got a present for you while I was in America. Here you go, hope you like it!</em></p><blockquote><p>here you go å°±æ˜¯ç»™ä½ ..  there you go æœ‰ç‚¹ç±»ä¼¼å½’è¿˜ä¸œè¥¿</p></blockquote><p><strong>JJ:</strong> <em>Thanksâ€¦ but what is it?</em><br><strong>M:</strong> <em>Itâ€™s a voodoo dollï¼ˆå·«æ¯’å¨ƒå¨ƒï¼‰.</em><br><strong>JJï¼š</strong> <em>A what doll?</em><br><strong>M:</strong> <em>A voodoo doll. I bought it in New Orleansï¼ˆæ–°å¥¥å°”è‰¯ï¼‰ where voodoo is heavily practicedï¼ˆç››è¡Œï¼‰. This doll will bring you luck and protection. I hope it works!</em><br><strong>JJï¼š</strong> <em>Cool, I love it! I hope you didnâ€™t spend too much money on it?</em><br><strong>M:</strong> <em>Nah, in New Orleans theyâ€™re a dime a dozen.</em></p><blockquote><p>a dime a dozen=å¸¸è§è€Œä¾¿å®œçš„ä¸œè¥¿  </p></blockquote><p><strong>JJ:</strong> <em>Okay, thatâ€™s good. Letâ€™s hit the road now. We should get back home before the sun goes down.</em></p><blockquote><p>hit the road (ä¸Šè·¯)<br>sun goes down (å¤ªé˜³è½å±±)</p></blockquote><p><strong>M:</strong> <em>Well, we finally made it.Thanks again for the ride, Jingjing.</em></p><blockquote><p>give me a ride (è½½æˆ‘ä¸€ç¨‹)</p></blockquote><p><strong>JJï¼š</strong> <em>Donâ€™t mention it.</em><br><strong>M:</strong> <em>By the way, can I give you some gas money?</em><br><strong>JJ:</strong> <em>Donâ€™t worry about it. Just take me to the airport next month when I go to see my parents and weâ€™ll be even.</em></p><blockquote><p>weâ€™ll be even (æˆ‘ä»¬å°±æ‰¯å¹³äº†)</p></blockquote><p><strong>M:</strong> <em>Okay, cool. Hey, why donâ€™t you come in and drink a glass of lemonade(æŸ æª¬æ°´) with me before you go home? Itâ€™s the least I could do for you.</em><br><strong>JJï¼š</strong> <em>That sounds like it will hit the spot! It seems like this heat wave will never end! Hey, while weâ€™re at it how about we watch a DVD too?</em></p><blockquote><p>hit the spot (æ­£ä¸­è¦å®³ï¼Œæ­£åˆæˆ‘æ„)<br>heat wave (çƒ­æµªï¼Œä¸èƒ½ç”¨hotï¼Œ hot weather, heat wave)</p></blockquote><p><strong>M:</strong> <em>Iâ€™d love to, but I have to wake up at the crack of dawn tomorrow to go to work.</em></p><blockquote><p>crack of dawn (ç ´æ™“)</p></blockquote><p><strong>JJï¼š</strong> <em>Really? Geezï¼ˆå¤©å•Šï¼‰, I never knew you were such an early bird.</em></p><blockquote><p>early bird/night owl</p></blockquote><p><strong>M:</strong> <em>Yupâ€¦ Donâ€™t you wake up early to go to work too?</em><br><strong>JJ:</strong> <em>Not as early as you. Iâ€™m more of a night owl. I like staying up late and working on my computer.</em></p><blockquote><p>Iâ€™m more of a night owl (æˆ‘å…¶å®æ˜¯ä¸ªå¤œçŒ«å­)</p></blockquote><p><strong>M:</strong> <em>Ohâ€¦ Well, letâ€™s go inside and get that ice cold glass of lemonade thatâ€™s waiting for us!</em></p><blockquote><p>dog days of summer (had nothing to doï¼Œé—²ç€ï¼Œåƒå¤å¤©ç‹—çƒ­äº†èººåœ¨åœ°ä¸Šä»€ä¹ˆä¹Ÿä¸å¹²)</p></blockquote><h4 id="2016-7-4-Donâ€™t-text-and-drive"><a href="#2016-7-4-Donâ€™t-text-and-drive" class="headerlink" title="2016.7.4 Donâ€™t text and drive"></a>2016.7.4 Donâ€™t text and drive</h4><p><strong>M:</strong> <em>Ah! Jingjing! Iâ€™m in a grind!</em></p><blockquote><p>Iâ€™m in a grind/bind (æˆ‘å¥½ç—›è‹¦ï¼Œä¸æ–¹ä¾¿ï¼Œå°´å°¬ï¼Œ æŒ‡ç²¾ç¥æƒ…æ„Ÿçš„ï¼Œä¸æ˜¯èº«ä½“ä¸Šçš„)</p></blockquote><p><strong>JJ:</strong> <em>Whatâ€™s the matter? You look like youâ€™ve seen a ghost!</em> ï¼ˆä½ çœ‹èµ·æ¥åƒè§äº†é¬¼ä¸€æ ·ï¼‰<br><strong>M:</strong> <em>Yeah, I just got in a wreck. My parents are gonna bite my head off.</em></p><blockquote><p>get in a wreck (å‡ºäº†è½¦ç¥¸ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æŠ¥é”€äº†ï¼Œæˆæœ¬å¤§äº2000ç¾å…ƒ)<br>fender bender (è½¦ç¥¸ï¼Œæˆæœ¬å°äº2000ç¾å…ƒï¼Œå¯ä»¥ä¿®ç†)<br>bite sb head off (yell at sb, å¤§å–Šå¤§å«ï¼ŒæŒ‡éå¸¸ç”Ÿæ°”)</p></blockquote><p><strong>JJï¼š</strong> <em>Really? Are you okay? How about your car?</em><br><strong>M:</strong> <em>Iâ€™m fine, but my car is totaled! They gave that car to me last year when I graduated college, it cost thirty grand! I donâ€™t know what to do!</em></p><blockquote><p>totaled (â€œå®Œè›‹äº†â€ï¼Œ ä¸èƒ½ç›´æ¥è¯´totaledï¼Œéœ€è¦ç»“åˆä¸Šä¸‹æ–‡ï¼Œ I wrecked my car totally)<br>grand (1000ç¾å…ƒ)</p></blockquote><p><strong>JJï¼š</strong> <em>Just stay calm! Accidents happen. Iâ€™m sure it wasnâ€™t your fault.</em></p><blockquote><p>stay calm (ä¿æŒå†·é™)</p></blockquote><p><strong>M:</strong> <em>Actually it was. I really goofed up, Jingjing. I was texting and driving. I wasnâ€™t paying attention to the road.</em></p><blockquote><p>goofed up/messed up/screw up (å‡ºå¤§é”™ï¼Œæç ¸äº†)<br>text (å¯ä»¥åŠ¨è¯ä½¿ç”¨ï¼Œ Iâ€™ll text youï¼Œ æˆ‘ä¼šç»™ä½ å‘ä¿¡æ¯)</p></blockquote><p><strong>JJï¼š</strong> <em>Mark! Whatâ€™s gotten into you? That doesnâ€™t seem like something youâ€™d do!</em></p><blockquote><p>whatâ€™s gotten into you (ä½ æ˜¯æ€ä¹ˆæƒ³çš„ï¼Ÿ è„‘è¢‹è¿›æ°´äº†å—)</p></blockquote><p><strong>M:</strong> <em>I know. I donâ€™t know what I was thinking. Jingjing, what am I supposed to do?!</em></p><blockquote><p>what am I supposed to do (what should I do?  ä½†æ˜¯å‰è€…æ›´å¸¸ç”¨ï¼Œè¡¨è¾¾æ›´å¥½ä¸€ç‚¹)</p></blockquote><p><strong>JJï¼š</strong> <em>Look, you need to be blunt with your parents and tell them what happened. Iâ€™m sure theyâ€™ll forgive you! After all, theyâ€™re your parents.</em></p><blockquote><p>be blunt with sb (å¦ç‡çš„è¯´ï¼Œä¸é¡¾åŠå¯¹æ–¹æ„Ÿå—ï¼Œæœ‰ç‚¹ç®€å•ç²—æš´ï¼Œåªæ˜¯å¦‚å®è¯´å‡ºæ¥)</p></blockquote><p><strong>M:</strong> <em>Okay, Iâ€™m gonna go home now and spill the beans.</em></p><blockquote><p>spill the beans (å¦‚æ˜¯è¯´ï¼Œæ›´å¼ºè°ƒå®è¯å®è¯´ï¼Œæ³¨æ„å’Œbe blunt with sb çš„åŒºåˆ«)</p></blockquote><p><strong>JJï¼š</strong> <em>So? How did it go with your parents? Are they ticked off?</em></p><blockquote><p>ticked off (ç”Ÿæ°”ï¼Œä¹‹å‰å¿äº†å‡ æ¬¡äº†  è¿™æ¬¡å½»åº•çˆ†å‘äº†ï¼Œ å¿æ— å¯å¿)</p></blockquote><p><strong>M:</strong> <em>No. They were more worried than anything. They were just happy I wasnâ€™t hurt. The good news is that the insurance will cover the cost of the car.</em></p><blockquote><p>cover the cost of the car (ä¿é™©å…¬å¸å°†ä¼šèµ”ä»˜æˆ‘æ±½è½¦çš„æŸå¤±)</p></blockquote><p><strong>JJ:</strong> <em>Wow, it sounds like they are letting you off pretty easy. Whatâ€™s the catch?</em></p><blockquote><p>let sb off pretty easy(æ”¾ä½ ä¸€é©¬ï¼Œå¾ˆå®¹æ˜“çš„æ”¾è¿‡ä½ )<br>whatâ€™s the catch (æœ‰ä»€ä¹ˆæ¡ä»¶)</p></blockquote><p><strong>M:</strong> <em>The catch is that they are making me pay the deductable(æŠµæ‰£æ¬¾), and they told me Iâ€™m not allowed to send text for a month.</em><br><strong>JJï¼š</strong> <em>No text messages? I think I would go bananas! I love sending texts. I bet you canâ€™t wait for this month to go by, huh?</em></p><blockquote><p>go bananas (ç–¯æ‰äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä¼¤å®³çš„ï¼Œno harm)</p></blockquote><p><strong>M:</strong> <em>Thatâ€™s right, next month Iâ€™ll be like a dog with two tails. Although, I swear Iâ€™ll never send another text while driving again.</em></p><blockquote><p>Iâ€™ll be like a dog with two tails (æ¢å¤è‡ªç”±äº†ï¼ŒæŒ‡éå¸¸é«˜å…´)</p></blockquote><p><strong>JJï¼š</strong> <em>Look on the bright side, at least youâ€™ll save a lot of money this month by not having to send texts. Texting can be expensive.</em></p><blockquote><p>look on the bright/down/dark side (å¾€å¥½å¤„/åå¤„æƒ³)</p></blockquote><p><strong>M:</strong> <em>Thatâ€™s true! I never thought about that. With all this left over money(çœä¸‹æ¥çš„é’±), I think I might go buy some books that Iâ€™ve been wanting to read.</em><br><strong>JJï¼š</strong> <em>See, Mark. This whole ordealï¼ˆç£¨éš¾ï¼‰ has turned out to be a blessing in disguise.</em></p><blockquote><p>turn out to be a blessing in disguise (å› ç¥¸å¾—ç¦)</p></blockquote><p><strong>M:</strong> <em>Hey, how come you always seem to cheer me up? Do you have magical powers or something?</em></p><blockquote><p>cheer sb up (é¼“åŠ±æŸäººï¼Œæ¿€åŠ±æŸäºº)</p></blockquote><p><strong>JJï¼š</strong> <em>No, Iâ€™m just awesome!ï¼ˆæˆ‘å°±æ˜¯å¤©æ‰ï¼Œæ¯”è¾ƒéª„å‚²çš„å£å»ï¼‰ Thatâ€™s allâ€¦</em></p><h3 id="è‹±è¯­è¯­æ³•"><a href="#è‹±è¯­è¯­æ³•" class="headerlink" title="è‹±è¯­è¯­æ³•"></a>è‹±è¯­è¯­æ³•</h3><h4 id="å®šè¯­ä»å¥"><a href="#å®šè¯­ä»å¥" class="headerlink" title="å®šè¯­ä»å¥"></a>å®šè¯­ä»å¥</h4><h5 id="å®šè¯­ä»å¥ç›¸å…³åŸºæœ¬æ¦‚å¿µ"><a href="#å®šè¯­ä»å¥ç›¸å…³åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å®šè¯­ä»å¥ç›¸å…³åŸºæœ¬æ¦‚å¿µ"></a>å®šè¯­ä»å¥ç›¸å…³åŸºæœ¬æ¦‚å¿µ</h5><blockquote><ol><li>å®šè¯­ä»å¥çš„å®šä¹‰ï¼šç”¨ä½œå®šè¯­çš„ä»å¥å«å®šè¯­ä»å¥</li><li>å®šè¯­ä»å¥ç»“æ„ï¼š<strong>å…ˆè¡Œè¯ + å¼•å¯¼è¯ + å®šè¯­ä»å¥</strong></li><li>å…ˆè¡Œè¯ï¼šè¢«å®šè¯­ä»å¥æ‰€ä¿®é¥°çš„åè¯æˆ–ä»£è¯</li><li>å®šè¯­ä»å¥çš„ä½ç½®ï¼šç´§è·Ÿå…ˆè¡Œè¯ï¼ˆåè¯æˆ–ä»£è¯ï¼‰ä¹‹å</li><li>å¼•å¯¼è¯ï¼šå¼•å¯¼å®šè¯­ä»å¥çš„è¯ï¼ˆåŒ…æ‹¬å…³ç³»ä»£è¯å’Œå…³ç³»å‰¯è¯ï¼‰</li></ol><ul><li>å…³ç³»ä»£è¯ï¼š<strong>that/who/whom/which/as</strong></li><li>å…³ç³»å‰¯è¯ï¼š<strong>when/where/why</strong></li></ul></blockquote><h5 id="å¼•å¯¼è¯çš„åŠŸèƒ½"><a href="#å¼•å¯¼è¯çš„åŠŸèƒ½" class="headerlink" title="å¼•å¯¼è¯çš„åŠŸèƒ½"></a>å¼•å¯¼è¯çš„åŠŸèƒ½</h5><blockquote><ol><li>è¿æ¥å…ˆè¡Œè¯å’Œå®šè¯­ä»å¥ã€‚ï¼ˆç›¸å½“äºæ¡¥æ¢ï¼‰</li></ol><ul><li>*I like the book which I bought. *         </li></ul><ol start="2"><li>åœ¨å®šè¯­ä»å¥ä¸­å……å½“ä¸€å®šçš„æˆåˆ†ï¼ˆå…³ç³»ä»£è¯å……å½“ä¸»è¯­æˆ–å®¾è¯­ï¼Œå…³ç³»å‰¯è¯å……å½“çŠ¶è¯­ï¼‰ã€‚</li></ol><ul><li>*This is the man who studied with me. *ï¼ˆå…³ç³»ä»£è¯åšä¸»è¯­ï¼‰</li><li><em>This is the man with whom I studied. * (å…³ç³»ä»£è¯åšå®¾è¯­, å°†ä»‹è¯æå‰)</em></li></ul></blockquote><h5 id="å®šè¯­ä»å¥ç±»å‹"><a href="#å®šè¯­ä»å¥ç±»å‹" class="headerlink" title="å®šè¯­ä»å¥ç±»å‹"></a>å®šè¯­ä»å¥ç±»å‹</h5><p>å®šè¯­ä»å¥æœ‰é™åˆ¶æ€§å’Œéé™åˆ¶æ€§ä¸¤ç§ã€‚é™åˆ¶æ€§å®šè¯­ä»å¥æ˜¯å…ˆè¡Œè¯ä¸å¯ç¼ºå°‘çš„éƒ¨åˆ†ï¼Œå»æ‰å®ƒä¸»å¥æ„æ€å¾€å¾€ä¸æ˜ç¡®ï¼›éé™åˆ¶æ€§å®šè¯­ä»å¥æ˜¯å…ˆè¡Œè¯çš„é™„åŠ è¯´æ˜ï¼Œå»æ‰äº†ä¹Ÿä¸ä¼šå½±å“ä¸»å¥çš„æ„æ€ï¼Œå®ƒä¸ä¸»å¥ä¹‹é—´é€šå¸¸ç”¨é€—å·åˆ†å¼€ï¼Œä»¥ä¸‹æ˜¯ç®€å•ä¾‹å­è¯´æ˜ï¼š</p><blockquote><ul><li><em>This is the house which I bought last month</em> ï¼ˆé™åˆ¶æ€§å®šè¯­ä»å¥ï¼‰</li><li><em>The house, which I bought last month, is very nice</em> (éé™å®šæ€§å®šè¯­ä»å¥)</li></ul></blockquote><p>(ä¸€) é™åˆ¶æ€§å®šè¯­ä»å¥ï¼ˆä¸»å¥å’Œå®šè¯­ä»å¥ä¹‹é—´æ— é€—å·éš”å¼€ï¼‰</p><blockquote><ul><li><em>The man <strong>who</strong> youâ€™re talking <strong>to</strong> is my friend.</em></li><li><em>The man <strong>to whom</strong> youâ€™re talking is my friend.</em></li><li><em>I need a pencil  <strong>with which</strong> I can write a letter</em></li><li><em>I need a piece of paper <strong>on which</strong> I can write a letter</em></li><li><em>The man (*</em>who/whom/that** éƒ½å¯ä»¥) I talked <strong>about</strong> at the meeting is from Peking University. *</li><li><em>The man <strong>about whom</strong> I talked at the meetingï¼‰is from Peking University.</em></li><li><em>The palace (<strong>which/that</strong> éƒ½å¯ä»¥) I often pay a visit <strong>to</strong> was built in the 17th century.</em></li><li><em>The palace <strong>to which</strong> I often pay a visit was built in the 17th century</em></li></ul><p><strong>æ€»ç»“</strong>ï¼š ä»‹è¯å¯ä»¥æ”¾åˆ°<strong>å…³ç³»ä»£è¯ä¹‹å‰</strong>ä¹Ÿå¯ä»¥æ”¾åœ¨<strong>å¥å­æœ«å°¾</strong>ï¼Œæ”¾åœ¨å…³ç³»ä»£è¯ä¹‹å‰æ˜¯å¾ˆåœ°é“çš„ä¹¦å†™æ–¹å¼ï¼Œä»‹è¯åªèƒ½åŠ å®¾è¯­ï¼Œäºæ˜¯åªæœ‰ <strong>ä»‹è¯+which</strong> å’Œ <strong>ä»‹è¯+whom</strong>ä¸¤ç§å½¢å¼ï¼Œ whoåœ¨å®šè¯­ä»å¥ä¸­æ—¢å¯ä»¥åšä¸»è¯­ä¹Ÿå¯ä»¥åšå®¾è¯­ï¼Œä½œå®¾è¯­å¯ä»¥ä¸whomäº’æ¢ï¼Œä½†æ˜¯å¦‚æœæœ‰ä»‹è¯ï¼Œå¿…é¡»è¦ç”¨whomï¼Œ å¦å¤–paperå•ç‹¬æŒ‡è®ºæ–‡ï¼Œä¸€é¡µçº¸è¦ç”¨a piece of paper, åŒ—äº¬å¤§å­¦è¦ç”¨Peking Universityï¼ŒBJ UniversityæŒ‡åŒ—äº¬çš„å¤§å­¦ã€‚</p></blockquote><p>(äºŒ) éé™åˆ¶æ€§å®šè¯­ä»å¥ ï¼ˆä¸»å¥å’Œå®šäºä»å¥ä¹‹é—´æœ‰é€—å·åˆ†éš”ï¼‰<br>å½“å½“å…ˆè¡Œè¯æ˜¯ä¸“æœ‰åè¯æˆ–ç‰©ä¸»ä»£è¯å’ŒæŒ‡ç¤ºä»£è¯æ‰€ä¿®é¥°æ—¶ï¼Œå…¶åçš„å®šè¯­ä»å¥é€šå¸¸æ˜¯éé™åˆ¶æ€§çš„</p><blockquote><ul><li><em>Charles Smith, who was my former teacther, retired last year</em></li><li><em>My house, which I bought last month, has got a lovely garden</em></li><li><em>The novel, which I have reading three times, is very touching</em></li></ul></blockquote><p>éé™åˆ¶æ€§å®šè¯­ä»å¥è¿˜èƒ½å°†æ•´ä¸ªä¸»å¥ä½œä¸ºå…ˆè¡Œè¯,å¯¹å…¶è¿›è¡Œä¿®é¥°,è¿™æ—¶ä»å¥è°“è¯­åŠ¨è¯è¦ç”¨ç¬¬ä¸‰äººç§°å•æ•°</p><blockquote><p><em>He seems not to have grasped what I meant, which greatly <strong>upsets</strong> me</em> ä»–ä¼¼ä¹æ²¡æŠ“ä½æˆ‘çš„æ„æ€ï¼Œè¿™ä½¿æˆ‘å¿ƒçƒ¦</p></blockquote><p>ç”±ä»‹è¯+å…³ç³»ä»£è¯ï¼ˆwhom/whichï¼‰å¼•å¯¼</p><blockquote><ul><li><em>I live in a house far away from city, <strong>in front of which</strong> is a big tree.</em>  å…¶ä¸­far away from city åšåç½®å®šè¯­</li><li><em>There is an apple tree standing there at the gate, on which are many apples</em></li></ul></blockquote><p>ç”±â€œä»£è¯/åè¯+of+whom/whichâ€æˆ–â€œof which/ whom +åè¯/ä»£è¯â€(å…ˆè¡Œè¯æŒ‡äººç”¨whom,æŒ‡ç‰©ç”¨which)å¼•å¯¼ã€‚One, some, any, none,all, both, several, many, most, neither, eitherç­‰è¯ã€æ•°è¯ã€åˆ†æ•°æˆ–ç™¾åˆ†æ¯”ä¸of whomæˆ–of whichè¿ç”¨ã€‚</p><blockquote><ul><li><em>He has five children, two of whom are abroad.</em>  (He has five children, and two of them are abroad. å¤–å›½äººä¸å–œæ¬¢é‡å¤ï¼Œæ‰€ä»¥å°†è¿è¯å»æ‰å¹¶ä¸”æŠŠthemæ¢æˆwhichï¼Œ å› ä¸ºè¿™é‡Œwhichå°±æ˜¯æŒ‡ä»£them)</li><li><em>We have three books, none of which is/are interesting.</em> (We have three books, but none of them is/are interesting é“ç†åŒä¸Š)</li></ul></blockquote><p>whoseå¼•å¯¼éé™å®šæ€§å®šè¯­ä»å¥</p><blockquote><ul><li><em>The house, whose window faces South, is mine</em></li></ul></blockquote><p><strong>æ³¨æ„ï¼š</strong> å…³ç³»ä»£è¯<strong>that</strong>å’Œå…³ç³»å‰¯è¯<strong>why</strong>ä¸èƒ½å¼•å¯¼éé™åˆ¶æ€§å®šè¯­ä»å¥</p><h5 id="å¼•å¯¼è¯ï¼ˆå…³ç³»ä»£è¯ï¼‰that-which-whoç”¨æ³•è¯¦è§£"><a href="#å¼•å¯¼è¯ï¼ˆå…³ç³»ä»£è¯ï¼‰that-which-whoç”¨æ³•è¯¦è§£" class="headerlink" title="å¼•å¯¼è¯ï¼ˆå…³ç³»ä»£è¯ï¼‰that/which/whoç”¨æ³•è¯¦è§£"></a>å¼•å¯¼è¯ï¼ˆå…³ç³»ä»£è¯ï¼‰that/which/whoç”¨æ³•è¯¦è§£</h5><p>ï¼ˆä¸€ï¼‰ å½“å…ˆè¡Œè¯æ˜¯<strong>ç‰©</strong>æ—¶ï¼Œå…³ç³»ä»£è¯(that/which)åªç”¨thatçš„æƒ…å†µ</p><blockquote><ol><li>å½“å…ˆè¡Œè¯è¢«åºæ•°è¯æˆ–å½¢å®¹è¯æœ€é«˜çº§ä¿®é¥°æ—¶ï¼Œåªèƒ½ç”¨that, å½“ç„¶thatä¹Ÿå¯ä»¥çœç•¥<br>This is <strong>the best</strong> film <strong>that</strong> has been shown this year.<br>This is <strong>the first</strong> book <strong>that</strong> I borrow from the library<br>He is <strong>the first</strong> student <strong>that/who</strong> came to school today   (student æ˜¯äººï¼Œæ‰€ä»¥å¯ä»¥ç”¨who)</li><li>å½“å…ˆè¡Œè¯ä¸ºä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šåˆ†åˆ«æŒ‡äººå’Œç‰©çš„åè¯æ—¶ï¼Œåªèƒ½ç”¨that<br>He talked about <strong>the teachers and the school that</strong> he had visited.</li><li>å½“å…ˆè¡Œè¯æœ¬èº«æ˜¯allçš„ï¼Œåªèƒ½ç”¨that<br>All that(what) I want to say to you is â€œThank youâ€  (all that=what)<br>Go over all that (what) we learned</li><li>å…ˆè¡Œè¯ä¸ºsomething, anything, nothing, everything, thingæ—¶, åªèƒ½ç”¨that<br>Iâ€™ll tell you anything that I know.</li><li>å½“å…ˆè¡Œè¯å‰æœ‰all, much, little, many, (a) few, every, some, any, no, only, the very, one of, the only, the last, the nextç­‰ä¿®é¥°è¯­æ—¶<br>This is one of the books <strong>in which</strong> Iâ€™m very interested ï¼ˆæœ‰ä»‹è¯å°±è¦ç”¨whichï¼‰<br>This is the only book that I read.<br>He is the only one of the boys that likes playing the piano.</li><li>å½“å…ˆè¡Œè¯åœ¨ä»¥whoæˆ–whichå¼€å¤´çš„ç‰¹æ®Šç–‘é—®å¥ä¸­æ—¶ï¼Œç”¨thatå¼•å¯¼ä»¥é¿å…æ··æ·†ï¼<br>Who is the man that is talking with the lady?<br>Which of you that know the answer can come to the front?</li><li>å½“å…ˆè¡Œè¯æ˜¯åœ¨å®šè¯­ä»å¥ä¸­ä½œè¡¨è¯­æ—¶ï¼Œç”¨that<br>He likes the girl that sheused to be.</li></ol></blockquote><p>ï¼ˆäºŒï¼‰å½“å…ˆè¡Œè¯æ˜¯ç‰©æ—¶ï¼Œå…³ç³»ä»£è¯(that/which)åªç”¨whichçš„æƒ…å†µ</p><blockquote><ol><li>ä½œä»‹å®¾ä¸”ä»‹è¯ç½®äºå¼•å¯¼è¯ä¹‹å‰æ—¶ï¼<br>The room <strong>in which</strong> he lives is very large.</li><li>å¼•å¯¼éé™å®šæ€§å®šè¯­ä»å¥æ—¶ï¼ˆä¸»ï¼Œå®¾éƒ½ç”¨which,éƒ½ä¸èƒ½çœç•¥ï¼‰<br>Football, which is a very interesting game, is played all over the world.<br>The house, which I visited yesterday, is very large.</li><li>whichæŒ‡æ•´ä¸ªå¥å­çš„å†…å®¹æˆ–éƒ¨åˆ†å†…å®¹ï¼Œå¼•å¯¼éé™å®šæ€§å®šè¯­ä»å¥<br>He always makes fun of me, which upsets me.</li></ol></blockquote><p>ï¼ˆä¸‰ï¼‰å…¶ä»–ç‰¹æ®Šæƒ…å†µ</p><blockquote><ol><li>å…ˆè¡Œè¯æ˜¯these, thoseæŒ‡äººæ—¶ï¼Œå…³ç³»ä»£è¯åªç”¨who<br>Those who are playing over there are my students</li><li>å…ˆè¡Œè¯æ˜¯äººç§°ä»£è¯(he, sheâ€¦)æ—¶ï¼Œå…³ç³»ä»£è¯åªç”¨who<br>He who doesnâ€™t reach the Great Wall is not a true man</li><li>ä¸å®šä»£è¯someone, anyone,everyone, no one, somebody, anybody, everybodyä½œå…ˆè¡Œè¯æ—¶ï¼Œå…³ç³»ä»£è¯ç”¨who<br>Anybody who breaks the rules would be pubnished  (æ³¨æ„æ˜¯breaksï¼ŒAnybodyåœ¨æ„æ€ä¸ŠæŒ‡â€œå…¨éƒ¨â€ï¼Œ è¯­æ³•ä¸Šåªåšç¬¬ä¸‰äººç§°å•æ•°ç”¨)</li><li>å…ˆè¡Œè¯æ˜¯the only one of +å¯æ•°åè¯å¤æ•°ï¼Œåœ¨å®šè¯­ä»å¥ä¸­ä½œä¸»è¯­æ—¶ï¼Œå®šè¯­ä»å¥ä¸­çš„è°“è¯­ç”¨å•æ•°å½¢å¼, å› ä¸ºæ­¤æ—¶é™å®šçš„æ˜¯the only one <strong>æ³¨æ„ä»¥ä¸‹ä¸¤ä¸ªä¾‹å¥å®šè¯­ä»å¥speakçš„å½¢å¼åŒºåˆ«</strong><br>He is the only one of the students who(å£è¯­)/that <strong>speaks</strong> Japanese in our class<br>He is one of the students who <strong>speak</strong> Japanese in our class</li><li>å½“å…ˆè¡Œè¯æ˜¯the way, åœ¨å®šè¯­ä»å¥ä¸­å……å½“æ–¹å¼çŠ¶è¯­æ—¶ï¼ˆthe wayè¡¨ï¼‚ä»¥â€¦æ–¹å¼ï¼æ–¹æ³•ï¼‚ï¼‰ï¼Œå¼•å¯¼è¯é€šå¸¸ç”¨thatæˆ–çœç•¥ï¼Œä¹Ÿå¯ç”¨in whichï¼<br>I donâ€™t like the way (that) you speak<br>I donâ€™t like the way in which you speak</li><li>å…³ç³»ä»£è¯æˆ–å…³ç³»å‰¯è¯åœ¨ä»å¥ä¸­å……å½“ä¸€ä¸ªå¥å­æˆåˆ†ï¼Œå› æ­¤è¦æ³¨æ„é¿å…ä»å¥ä¸­å¥å­æˆåˆ†çš„é‡å¤å‡ºç°<br>This isthe most beautiful place that I have visited it. (é”™è¯¯: ité‡å¤ï¼Œthatåœ¨è¿™é‡Œå·²ç»åšå®¾è¯­ ï¼‰<br>his isthe most beautiful place thatI have visited</li><li>å®šè¯­ä»å¥ä¸­å…³ç³»ä»£è¯æˆ–å…³ç³»å‰¯è¯çš„é€‰æ‹©å–å†³äºå®ƒä»¬åœ¨ä»å¥ä¸­æ‰€å……å½“çš„å¥å­æˆåˆ†ã€‚å¦‚ä½œä¸»è¯­å’Œå®¾è¯­ç”¨å…³ç³»ä»£è¯ï¼›ä½œçŠ¶è¯­ï¼Œç”¨å…³ç³»å‰¯è¯<br>Iâ€™ll never forget the day when I went abroad myself.æˆ‘æ°¸è¿œè®°å¾—æˆ‘ç‹¬è‡ªåœ¨å›½å¤–çš„æ—¥å­, ï¼ˆè¿™é‡Œçš„the day æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼ŒæŒ‡ä¸€æ®µæ—¥å­ï¼‰<br>Iâ€™ll never forget the days that we spent together.æˆ‘æ°¸è¿œä¸ä¼šå¿˜è®°æˆ‘ä»¬ä¸€èµ·åº¦è¿‡çš„é‚£äº›å¤©/æ—¥å­, (è¿™é‡Œçš„the daysæ˜¯ä¸€ä¸ªå…·ä½“çš„æ¦‚å¿µ)</li></ol><p><strong>the day (minute)ç­‰è¡¨æ—¶é—´çš„å•æ•°åè¯å+å…³ç³»å‰¯è¯when</strong>  ï¼ˆè¡¨æŠ½è±¡çš„ä¸€æ®µæ—¶é—´ï¼‰<br><strong>the days(minutes)ç­‰è¡¨æ—¶é—´çš„å¤æ•°åè¯å+å…³ç³»ä»£è¯that ã€which</strong> ï¼ˆè¡¨å…·ä½“çš„ä¸€æ®µæ—¶é—´ï¼‰</p></blockquote><h5 id="å®šä»ç»å…¸ç»„åˆï¼ˆä»‹è¯-å…³ç³»ä»£è¯ï¼‰åå¤§éš¾ç‚¹"><a href="#å®šä»ç»å…¸ç»„åˆï¼ˆä»‹è¯-å…³ç³»ä»£è¯ï¼‰åå¤§éš¾ç‚¹" class="headerlink" title="å®šä»ç»å…¸ç»„åˆï¼ˆä»‹è¯+å…³ç³»ä»£è¯ï¼‰åå¤§éš¾ç‚¹"></a>å®šä»ç»å…¸ç»„åˆï¼ˆä»‹è¯+å…³ç³»ä»£è¯ï¼‰åå¤§éš¾ç‚¹</h5><p><strong>Note:</strong> ä»‹è¯+å…³ç³»ä»£è¯ä¸»è¦çœ‹ç»“æ„<br>ï¼ˆä¸€ï¼‰ ä»‹è¯+whichåœ¨å®šè¯­ä»å¥ä¸­åˆ†åˆ«ä½œæ—¶é—´ã€åœ°ç‚¹å’ŒåŸå› <strong>çŠ¶è¯­</strong>ï¼Œä»£æ›¿ç›¸åº”çš„å…³ç³»å‰¯è¯when,whereå’Œwhyï¼Œ<strong>ä»‹è¯+whichåˆåŒ– when/where/why</strong></p><blockquote><ol><li>I still remember the day <em>on which(when)</em> I first came to school   ï¼ˆæˆ‘ä»ç„¶è®°å¾—å½“åˆæ¥å­¦æ ¡çš„é‚£ä¸€å¤©ï¼‰</li></ol><p><strong>ç†è§£ï¼š</strong> I came to school on the day.<br>2. The factory <em>in which(where)</em> I work is a large one. (æˆ‘å·¥ä½œçš„å·¥å‚æ˜¯ä¸€ä¸ªå¤§å·¥å‚)<br><strong>ç†è§£ï¼š</strong> factoryä¸å¯èƒ½åšworkçš„å®¾è¯­ï¼ˆå·¥ä½œå·¥å‚ï¼‰ï¼Œ æ˜¯åœ¨å·¥å‚å·¥ä½œï¼Œ I work in the factory<br>3. This is the reason <em>for which(why)</em> he was late (è¿™å°±æ˜¯ä»–ä¸ºä»€ä¹ˆè¿Ÿåˆ°çš„åŸå› )<br><strong>ç†è§£ï¼š</strong> reasonä¸å¯èƒ½åšlateçš„å®¾è¯­ï¼Œ be late forå› ä¸ºä»€ä¹ˆè¿Ÿåˆ°</p></blockquote><p>ï¼ˆäºŒï¼‰ ä»‹è¯+whichï¼ˆæŒ‡ç‰©ï¼‰/ whomï¼ˆæŒ‡äººï¼‰åœ¨å®šè¯­ä»å¥ä¸­ä½œåœ°ç‚¹çŠ¶è¯­ï¼Œè¡¨ç¤ºå­˜åœ¨å…³ç³»ï¼Œå®šè¯­ä»å¥ä¸»è°“ä¸€èˆ¬è¦å€’ç½®ã€‚ <strong>æ‰“å—è¾¹æ¥äº†ä¸€ä¸ªå–‡å˜›ï¼›èƒŒä¸ŠèƒŒç€ä¸€ä¸ªèƒ–å¨ƒå¨ƒ</strong></p><blockquote><ol><li>They arrived at a farm house, in front of which sat a small boy ä»–æ¥åˆ°ä¸€å¤„å†œèˆï¼Œ(å†œèˆ)å‰è¾¹åç€ä¸€ä¸ªå°ç”·å­©ã€‚</li></ol><p><strong>ç†è§£ï¼š</strong> a small boy sat in front of the farm houseï¼ˆæ­¤æ—¶a small boyæ˜¯ä¸»è¯­ï¼Œ sat æ˜¯è°“è¯­ï¼‰, åœ°ç‚¹çŠ¶è¯­åšä¸»è¯­ä¹‹åï¼Œä¸»è°“å€’è£…ï¼Œ a small boy åšsatçš„å®¾è¯­<br>2. I saw a man,on the head of whom stood a bird.<br><strong>ç†è§£ï¼š</strong>  é“ç†åŒä¸Š a bird stood on the head of a man. åœ°ç‚¹çŠ¶è¯­åœ¨å‰ï¼Œä¸»è°“å€’è£…</p></blockquote><p>ï¼ˆä¸‰ï¼‰ ä»‹è¯+ whichï¼ˆæŒ‡ç‰©ï¼‰/ whomï¼ˆæŒ‡äººï¼‰åœ¨å®šè¯­ä»å¥ä¸­ä½œç›®çš„ã€æ–¹å¼æˆ–åœ°ç‚¹çŠ¶è¯­ã€‚è¿™ç§ç»“æ„ä¸­çš„ä»‹è¯ä¸€èˆ¬å—åŠ¨è¯æˆ–ä»‹è¯åçš„åè¯æ‰€åˆ¶çº¦ã€‚<strong>æ‰¾å®šè¯­ä»å¥é‡Œçš„åŠ¨è¯çœ‹å®ƒåº”è¯¥æ­é…ä»€ä¹ˆä»‹è¯</strong></p><blockquote><ol><li>Could you tell me for whom you brought this coat (ä½ èƒ½å‘Šè¯‰æˆ‘è¿™ä»¶è¡£æœæ˜¯ç»™è°ä¹°çš„å—ï¼Ÿ)</li></ol><p><strong>ç†è§£ï¼š</strong> buy sth for sb, for whom åœ¨æ­¤å¤„æ˜¯ç›®çš„ï¼ŒæŒ‡ç»™æŸäºº<br>2. The man, from whom I learned the news, is an engineer. (è¿™äººæ˜¯ä¸€ä½å·¥ç¨‹å¸ˆï¼Œæˆ‘æ˜¯ä»ä»–é‚£é‡Œå¾—åˆ°è¿™æ¶ˆæ¯çš„ã€‚)<br><strong>ç†è§£ï¼š</strong> learn sth from sb ï¼Œæ­¤å¤„æ˜¯æ–¹å¼</p></blockquote><p>ï¼ˆå››ï¼‰ ä»‹è¯+which/whomï¼Œç”¨äºè¢«åŠ¨ç»“æ„çš„å®šè¯­ä»å¥ä¸­ï¼Œä½œçŠ¶è¯­ï¼Œè¯´æ˜åŠ¨ä½œçš„å‘å‡ºè€…ã€‚ <strong>è¢«åŠ¨çš„ä½¿ç”¨æ˜¯ä¸ºäº†æ›´åŠ å¼ºè°ƒåŠ¨ä½œå‘å‡ºè€…çš„å‰å®³</strong></p><blockquote><ol><li>The wolf by which the sheep was killed was shot (ä¼¤å®³ç¾Šçš„é‚£åªç‹¼è¢«æ‰“æ­»äº†)</li></ol><p><strong>ç†è§£ï¼š</strong> the sheep was killed by the wolf, ä¸Šé¢å¥å­ä¸­çš„whichå°±æ˜¯è¡¨ç¤ºthe wolf.<br>2. The man by whom the wolf was shot was a good hunter. æ‰“æ­»ç‹¼çš„é‚£äººæ˜¯ä¸ªå¥½çŒæ‰‹ã€‚<br><strong>ç†è§£ï¼š</strong> the wolf was shot by the man, ä¸Šé¢å¥å­ä¸­çš„whomè¡¨ç¤ºthe man</p></blockquote><h4 id="å€’è£…å¥"><a href="#å€’è£…å¥" class="headerlink" title="å€’è£…å¥"></a>å€’è£…å¥</h4><h5 id="è‹±è¯­å€’è£…ç»“æ„çš„å…­å¤§å½¢å¼è¯¦è§£"><a href="#è‹±è¯­å€’è£…ç»“æ„çš„å…­å¤§å½¢å¼è¯¦è§£" class="headerlink" title="è‹±è¯­å€’è£…ç»“æ„çš„å…­å¤§å½¢å¼è¯¦è§£"></a>è‹±è¯­å€’è£…ç»“æ„çš„å…­å¤§å½¢å¼è¯¦è§£</h5><p>ï¼ˆä¸€ï¼‰ å¦å®šå‰¯è¯ä½äºå¥é¦–æ—¶çš„å€’è£…<br>åœ¨æ­£å¼æ–‡ä½“ä¸­ï¼Œ<strong>never, seldom, rarely, little,hardly, scarcely, no sooner, no longer, nowhere</strong> ç­‰å«æœ‰å¦å®šæ„ä¹‰çš„å‰¯è¯è‹¥ä½äºå¥é¦–ï¼Œåˆ™å…¶åè¦ç”¨éƒ¨åˆ†å€’è£…ï¼š</p><blockquote><ol><li>I shall never forgive him -&gt; Never shall I forgive him. æˆ‘æ°¸è¿œä¸ä¼šå®½æ•ä»–ã€‚</li><li>He seldom goes out for dinner -&gt; Seldom does he go out for dinner. ä»–å¾ˆå°‘å‡ºå»åƒé¥­ã€‚</li><li>She hardly has time to listen to music -&gt; Hardly does she have time to listen to music. å¥¹å‡ ä¹æ²¡æ—¶é—´å¬éŸ³ä¹ã€‚</li><li>He little realizes how important this meeting is -&gt; Little doeshe realize how important this meeting is. ä»–ä¸ç”šæ˜ç™½è¿™ä¸ªä¼šè®®çš„é‡è¦æ€§</li><li>We had no sooner reached the airport than the plane took off -&gt; No sooner had we reached the airport than the plane took off. æˆ‘ä»¬åˆšåˆ°æœºåœº,é£æœºå°±èµ·é£äº†ã€‚</li></ol><p><strong>æ³¨æ„ï¼š</strong> in no time(ç«‹å³ï¼Œé©¬ä¸Š)ä½äºå¥é¦–æ—¶ï¼Œå…¶åæ— éœ€ç”¨å€’è£…è¯­åºï¼š  In no time he worked out the problem. ä»–é©¬ä¸Šå°±ç®—å‡ºäº†é‚£é“é¢˜ã€‚</p></blockquote><p>(äºŒ) only+çŠ¶è¯­â€ä½äºå¥é¦–æ—¶çš„å€’è£…<br><strong>å½“ä¸€ä¸ªçŠ¶è¯­å—å‰¯è¯onlyçš„ä¿®é¥°ä¸”ç½®äºå¥é¦–æ—¶ï¼Œå…¶åç”¨éƒ¨åˆ†å€’è£…è¯­åºï¼š</strong></p><blockquote><ol><li>Only then did he realize that he was wrong. åˆ°é‚£æ—¶ä»–æ‰æ„è¯†åˆ°ä»–é”™äº†ã€‚</li><li>Only in this way are you able to do it well. ä½ åªæœ‰ç”¨è¿™ç§æ–¹æ³•æ‰èƒ½æŠŠå®ƒåšå¥½ã€‚</li><li>Only when he returned home did he realize what had happened.  å½“ä»–å›åˆ°å®¶é‡Œæ—¶ï¼Œæ‰çŸ¥é“å‡ºäº†ä»€ä¹ˆäº‹ã€‚</li></ol></blockquote><p>(ä¸‰) so+adj. / adv.â€ä½äºå¥é¦–æ—¶çš„å€’è£…<br><strong>å‰¯è¯soåæ¥å½¢å®¹è¯æˆ–å‰¯è¯ä½äºå¥é¦–æ—¶ï¼Œå…¶åç”¨éƒ¨åˆ†å€’è£…</strong></p><blockquote><ol><li>The weather was so cold that we had to stay at home. -&gt; So cold was the weather that we had to stay at home. å¤©æ°”å¤ªå†·ï¼Œæˆ‘ä»¬åªå¥½å‘†åœ¨å®¶é‡Œã€‚</li><li>Light travels so fast that we can hardly imagine its speed -&gt; So fastdoes light travel that we can hardly imagine its speed.  å…‰é€Ÿå¾ˆå¿«ï¼Œæˆ‘ä»¬å‡ ä¹æ²¡æ³•æƒ³åƒå®ƒçš„é€Ÿåº¦ã€‚</li><li>The attack was so sudden that we had no time to escape -&gt; So suddenwas the attack that we had no time to escape. è¢­å‡»æ¥å¾—éå¸¸çªç„¶ï¼Œæˆ‘ä»¬æ¥ä¸åŠé€ƒè·‘ã€‚</li></ol><p><strong>æ€»ç»“ï¼š</strong> æ­¤ç±»å‹çš„åŸå¥å°±æ˜¯soâ€¦that (å¦‚æ­¤.. ä»¥è‡³äº..)</p></blockquote><p>(å››) so+åŠ©åŠ¨è¯+ä¸»è¯­â€å€’è£…å½“è¦è¡¨ç¤ºå‰é¢æå‡ºçš„æŸä¸€è‚¯å®šçš„æƒ…å†µä¹ŸåŒæ ·é€‚åˆäºåè€…</p><blockquote><p>You are young and so am I. (ä½ å¹´è½»ï¼Œæˆ‘ä¹Ÿå¹´è½»)  æ³¨æ„ï¼š ä¸èƒ½çœç•¥and, so am I æ˜¯ä¸€ä¸ªå¥å­ï¼Œéœ€è¦è¿æ¥<br>She likes music and so do I. (å¥¹å–œæ¬¢éŸ³ä¹ï¼Œæˆ‘ä¹Ÿå–œæ¬¢ï¼‰<br>If he can do it,so can I. (è¦æ˜¯ä»–èƒ½åšæ­¤äº‹ï¼Œæˆ‘ä¹Ÿèƒ½) æ³¨æ„â€œé€—å·â€çš„ä½¿ç”¨ï¼Œ æ¡ä»¶ä»å¥<br><strong>è‹¥å‰é¢æå‡ºæŸä¸€å¦å®šçš„æƒ…å†µï¼Œè¦è¡¨ç¤ºåè€…ä¹Ÿå±äºåŒæ ·çš„å¦å®šæƒ…å†µï¼Œåˆ™åº”å°†å…¶ä¸­çš„soæ”¹ä¸ºneitheræˆ–nor</strong><br>You arenâ€™t young and neither am I. (ä½ ä¸å¹´è½»ï¼Œæˆ‘ä¹Ÿä¸å¹´è½»)<br>She hasnâ€™t read it and nor have I. (å¥¹æ²¡æœ‰è¯»å®ƒï¼Œæˆ‘ä¹Ÿæ²¡æœ‰è¯»)<br><strong>æ³¨æ„è¯¥ç»“æ„ä¸è¡¨ç¤ºå¼ºè°ƒæˆ–åŒæ„çš„â€œso+ä¸»è¯­+ç‰¹æ®ŠåŠ¨è¯â€ç»“æ„çš„åŒºåˆ«, æ­¤ç§æƒ…å†µä¸éœ€è¦å€’è£…</strong><br>A: â€œIt was cold yesterday.(æ˜¨å¤©å¾ˆå†·)â€  B: â€œSo it was. (çš„ç¡®å¾ˆå†·)â€<br>A: â€œFather, you promised.(çˆ¸çˆ¸ï¼Œä½ ç­”åº”è¿‡çš„)â€ B: â€œWell,so I did. ï¼ˆå—¯ï¼Œæ˜¯ç­”åº”è¿‡ï¼‰â€<br><strong>æ³¨æ„ï¼š so + adj/adv åŸºæœ¬å¯ä»¥äº’æ¢such a/an + adj + n, suchå¼€å¤´çš„ä¹Ÿè¦å€’è£…ï¼Œä½†æ˜¯äº’æ¢æœ‰æ—¶ä¼šæ”¹å˜è¡¨è¾¾æƒ…æ„Ÿ</strong></p></blockquote><p>ï¼ˆäº”ï¼‰ ç”±not onlyâ€¦but alsoå¼•å‡ºçš„å€’è£…å½“not onlyâ€¦but alsoä½äºå¥é¦–å¼•å‡ºå¥å­æ—¶ï¼Œnot only åçš„å¥å­é€šå¸¸ç”¨éƒ¨åˆ†å€’è£…å½¢å¼ï¼Œ <strong>but also åé¢æ­£å¸¸è¯­åº</strong></p><blockquote><p>Not only is he a teacher, but also he is a poet. (ä»–ä¸ä»…æ˜¯ä¸€ä½æ•™å¸ˆï¼Œè€Œä¸”æ˜¯ä¸€ä½è¯—äºº)<br>Not only did he speak more correctly, but also he spoke more easily. (ä¸ä»…ä»–è®²å¾—æ›´æ­£ç¡®ï¼Œä¹Ÿè®²å¾—æ›´ä¸è´¹åŠ²äº†)</p><p><strong>æ³¨æ„ï¼š</strong> not only .. but also ä¸­but alsoä¸ä¸€å®šéè¦è¿åœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥åªç•™butæˆ–åªç•™also ï¼š Not only is he a teacher, but he is also a poet (è¿™æ ·å†™æ›´èˆ’æœåœ°é“)</p></blockquote><p>(å…­) è™šæ‹Ÿæ¡ä»¶å¥çš„çœç•¥ä¸å€’è£…<br><strong>å½“ifå¼•å¯¼çš„è™šæ‹Ÿæ¡ä»¶ä»å¥ä¸­å«æœ‰had, were, shouldç­‰æ—¶ï¼Œå¦‚å°†ifçœç•¥ï¼Œåˆ™è¦å°†had, were, shouldç­‰ç§»åˆ°ä¸»è¯­å‰ï¼Œæ„æˆå€’è£…å¥</strong></p><blockquote><p>If you had come yesterday, you would have seen him. -&gt; Had you come yesterday, you would have seen him.<br>If you should require anything give me a ring. -&gt; Should you require anything give me a ring.<br>If it were not for your help,I would still be homeless. -&gt; Were it not for your help, I would still be homeless.  (è¦ä¸æ˜¯ä½ å¸®åŠ©ï¼Œæˆ‘ä¼šä»ç„¶æ— å®¶å¯å½’)<br><strong>çœç•¥ifåæå‰çš„hadä¸ä¸€å®šæ˜¯åŠ©åŠ¨è¯</strong><br>If I had money, I would buy it. -&gt; Had I money, I would buy it. (æ­¤å¤„çš„hadæ˜¯å®æ„åŠ¨è¯)</p></blockquote><p>ï¼ˆä¸ƒï¼‰ As å¼•å¯¼çš„è®©æ­¥çŠ¶è¯­ä»å¥å€’è£…<br><strong>asä½œâ€œè™½ç„¶â€è§£ï¼Œå¼•å¯¼è®©æ­¥çŠ¶è¯­ä»å¥æ—¶ï¼Œå¿…é¡»å°†è¡¨è¯­ã€çŠ¶è¯­æˆ–åŠ¨è¯åŸå½¢æåˆ°aså‰é¢ã€‚æ­¤æ—¶åº”æ³¨æ„å‡ ç‚¹ï¼š</strong></p><ol><li>è‹¥æå‰çš„è¡¨è¯­æ˜¯æ²¡æœ‰å½¢å®¹è¯ä¿®é¥°çš„å•æ•°å¯æ•°åè¯ï¼Œè¦çœç•¥ä¸å®šå† è¯ï¼›</li><li>è‹¥æå‰çš„æ˜¯åŠ¨è¯åŸå½¢(å¤šä¸ºä¸åŠç‰©åŠ¨è¯)ï¼Œä¸ä¹‹è¿ç”¨çš„é€šå¸¸æ˜¯may, might, will, wouldç­‰ï¼Œä¸”è¿™äº›è¯éƒ½è¦ä¿ç•™åœ¨åŸæ¥çš„ä½ç½®ä¸Š(ä¸»è¯­å)ï¼›</li><li>thoughæœ‰æ—¶ä¹Ÿå¯åƒasè¿™æ ·ä½¿ä½œå€’è£…ï¼Œ althoughç»å¯¹ä¸èƒ½å€’è£…**</li></ol><blockquote><p>Tiredï¼ˆå½¢å®¹è¯ï¼‰ as I was, I tried to help them. è™½ç„¶æˆ‘å¾ˆç´¯ï¼Œæˆ‘è¿˜æ˜¯åŠªåŠ›å¸®åŠ©ä»–ä»¬ã€‚ =Although I was tired, I tried to help them.<br>Tryï¼ˆåŠ¨è¯ï¼‰ as he would, he couldnâ€™t open the door. ä»–è¯•è¿‡å¤šæ¬¡äº†, å´ä»æ‰“ä¸å¼€é‚£é—¨ã€‚ =Although he would try, he couldnâ€™t open the door.<br>Search(åŠ¨è¯ï¼‰ as they would, they would find nobody in the house. æ— è®ºæ€æ ·æœæŸ¥ï¼Œä»–ä»¬åœ¨æˆ¿å­é‡Œä»ç„¶æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªäººã€‚ =Although they would search, they would find nobody in the house.<br>Hard(å‰¯è¯ï¼‰ as (though) they tried, they couldnâ€™t make her change her mind. å°½ç®¡ä»–ä»¬åšäº†å¾ˆå¤§åŠªåŠ›ï¼Œå´æ²¡æ³•è®©å¥¹æ”¹å˜ä¸»æ„ã€‚ =Although they tried hard, they couldnâ€™t make her change her mind.<br>Boy(åè¯æ— å† è¯ï¼‰ as he was, he behaved like a girl. ä»–è™½æ˜¯ä¸ªç”·å­©ï¼Œä½†ä¸¾æ­¢å´åƒä¸ªå¥³å­©ã€‚ =Although he was a boy, he behaved like a girl.</p></blockquote><h4 id="çŠ¶è¯­ä»å¥"><a href="#çŠ¶è¯­ä»å¥" class="headerlink" title="çŠ¶è¯­ä»å¥"></a>çŠ¶è¯­ä»å¥</h4><p><strong>çŠ¶è¯­ä¸»è¦æ˜¯ç”¨æ¥ä¿®é¥°åŠ¨è¯å’Œå½¢å®¹è¯çš„ï¼Œä»¥è¡¨æ˜åŠ¨ä½œå‘ç”Ÿæˆ–çŠ¶æ€å­˜åœ¨çš„æ—¶é—´ã€åœ°ç‚¹ã€åŸå› ã€ç›®çš„ã€ç»“æœç­‰ã€‚çŠ¶è¯­ä»å¥å³æŒ‡åœ¨ä¸»ä»å¤åˆå¥ä¸­ç”¨ä½œçŠ¶è¯­çš„ä»å¥ã€‚çŠ¶è¯­ä»å¥ä¸»è¦ç”¨æ¥ä¿®é¥°ä¸»å¥æˆ–ä¸»å¥çš„è°“è¯­</strong><br>ï¼ˆä¸€ï¼‰ <strong>æ—¶é—´çŠ¶è¯­ä»å¥</strong><br><em>æ—¶é—´çŠ¶è¯­ä»å¥ç”¨è¡¨ç¤ºæ—¶é—´çš„è¿è¯è¿æ¥ä¸€ä¸ªå¥å­ä½œçŠ¶è¯­ï¼Œè¿™æ ·çš„ä¸»ä»å¤åˆå¥å°±æ˜¯æ—¶é—´çŠ¶è¯­ä»å¥, å¸¸ç”¨å¼•å¯¼è¯ï¼šwhen, as, while, as soon as, before, after, since , till, until</em></p><ol><li><p>ç”±when,while, aså¼•å¯¼çš„æ—¶é—´çŠ¶è¯­ä»å¥çš„åŒºåˆ«ç”¨æ³•</p><blockquote><ul><li><strong>whenå¼•å¯¼çš„ä»å¥çš„è°“è¯­åŠ¨è¯å¯ä»¥æ˜¯å»¶ç»­æ€§çš„åŠ¨è¯ï¼Œåˆå¯ä»¥æ˜¯ç¬æ—¶åŠ¨è¯, å¹¶ä¸”whenæœ‰æ—¶è¡¨ç¤ºâ€œå°±åœ¨é‚£æ—¶â€</strong><br>When she came in, I stopped eating.å¥¹è¿›æ¥æ—¶ï¼Œæˆ‘åœ¨åƒé¥­ã€‚(ç¬æ—¶åŠ¨è¯) [came in æ­¤æ—¶æ˜¯ç¬é—´åŠ¨è¯ï¼Œ å¥¹è¿›æ¥æˆ‘æœ‰æ³¨æ„åˆ°å¥¹ï¼Œåƒé¥­åœäº†ä¸€ä¸‹]<br>When I lived in the countryside, I used to carry some water for him.å½“æˆ‘çš„ä½åœ¨å†œæ‘æ—¶ï¼Œæˆ‘å¸¸å¸¸ä¸ºä»–æ‹…æ°´ã€‚ï¼ˆå»¶ç»­æ€§çš„åŠ¨è¯ï¼‰ [live in æ˜¯å»¶ç»­æ€§åŠ¨è¯ï¼Œä¸€ç›´åœ¨ä½ç€]<br>We were about to leave when he came in.æˆ‘ä»¬å°±è¦ç¦»å¼€ï¼Œå°±åœ¨é‚£æ—¶ä»–è¿›æ¥äº†ã€‚ï¼ˆå°±åœ¨é‚£æ—¶ï¼‰  </li></ul><p><strong>æ€»ç»“ï¼š</strong> when å¼•å¯¼çš„ä»å¥æœ‰æ¿€æ´»ä¸»å¥çš„æ„Ÿè§‰ï¼Œä»å¥çš„å†…å®¹è¦å¹³è¡Œå¹¶åˆ—ä¸»å¥.</p><ul><li><strong>Whileå¼•å¯¼çš„ä»å¥çš„è°“è¯­åŠ¨ä½œå¿…é¡»æ˜¯å»¶ç»­æ€§çš„ï¼Œå¹¶å¼ºè°ƒä¸»å¥å’Œä»å¥çš„åŠ¨ä½œåŒæ—¶å‘ç”Ÿï¼ˆæˆ–è€…ç›¸å¯¹åº”ï¼‰ã€‚å¹¶ä¸”whileæœ‰æ—¶è¿˜å¯ä»¥è¡¨ç¤ºå¯¹æ¯”</strong><br>My wife was reading the newspaper, while I was watching TV. æˆ‘å¦»å­åœ¨çœ‹æŠ¥çº¸ï¼Œæˆ‘åœ¨çœ‹ç”µè§†ã€‚(was readingæ˜¯å»¶ç»­æ€§çš„åŠ¨è¯ï¼Œå¹¶ä¸”was readingå’Œwas watchingåŒæ—¶å‘ç”Ÿ)<br>I like playing football while you like playing basketball.æˆ‘å–œæ¬¢è¸¢è¶³çƒï¼Œè€Œä½ å–œæ¬¢æ‰“ç¯®çƒã€‚ (æ­¤å¤„è¡¨ç¤ºå¯¹æ¯”)</li></ul><p><strong>æ€»ç»“ï¼š</strong> whileåé¢å§‹ç»ˆè¦åŠ å»¶ç»­æ€§åŠ¨è¯</p><ul><li><strong>Asè¡¨ç¤ºâ€œä¸€è¾¹â€¦â€¦ä¸€è¾¹â€ï¼Œaså¼•å¯¼çš„åŠ¨ä½œæ˜¯å»¶ç»­æ€§çš„åŠ¨ä½œï¼Œä¸€èˆ¬ç”¨äºä¸»å¥å’Œä»å¥åŠ¨ä½œåŒæ—¶å‘ç”Ÿï¼›asä¹Ÿå¯ä»¥å¼ºè°ƒâ€œä¸€å…ˆä¸€åã€‚</strong><br>We always sing as we walk.æˆ‘ä»¬æ€»æ˜¯è¾¹èµ°è¾¹å”±ã€‚ï¼ˆasè¡¨ç¤ºâ€œä¸€è¾¹â€¦â€¦ä¸€è¾¹â€ï¼‰ [è¿™é‡Œå¼ºè°ƒæˆ‘ä»¬æŒç»­è¿™æ ·å¾ˆé•¿æ—¶é—´ï¼Œåƒæ˜¯ä¸€è¾ˆå­çš„ä¹ æƒ¯]<br>As we was going out, it began to snow. å½“æˆ‘ä»¬å‡ºé—¨æ—¶ï¼Œå¼€å§‹ä¸‹é›ªäº†ã€‚ï¼ˆaså¼ºè°ƒå¥ä¸­ä¸¤ä¸ªåŠ¨ä½œç´§æ¥ç€å…ˆåå‘ç”Ÿï¼Œè€Œä¸å¼ºè°ƒå¼€å§‹ä¸‹é›ªçš„ç‰¹å®šæ—¶é—´ï¼‰</li></ul><p><strong>æ€»ç»“ï¼š</strong> asè¡¨ç¤ºçš„æŒç»­æ€§ç”šè‡³æ˜¯ä¸€ç§ä¹ æƒ¯</p><p><strong>Note:</strong> ä¸»ä»å¤åˆå¥ï¼Œè¦å¼ºè°ƒçš„ä¸œè¥¿åœ¨å‰é¢å†™ï¼Œè¿™ä¹Ÿæ˜¯è‹±æ–‡çš„çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œå¼ºè°ƒçš„ä¸œè¥¿å§‹ç»ˆæ”¾åœ¨ç¬¬ä¸€ä½ .</p></blockquote></li><li><p>ç”±beforeå’Œafterå¼•å¯¼çš„æ—¶é—´çŠ¶è¯­ä»å¥çš„åŒºåˆ«ç”¨æ³•</p><blockquote><ul><li><strong>beforeå¼•å¯¼çš„ä»å¥ä¸å†ç”¨å¦å®šå¼çš„è°“è¯­ï¼Œå¹¶ä¸”å½“beforeå¼•å¯¼çš„ä»å¥ä½äºä¸»å¥ä¹‹åï¼Œæœ‰æ—¶è¯‘æˆâ€œå°±ï¼Œæ‰â€æˆ–â€œ è¿˜æ²¡æ¥å¾—åŠâ€¦ å°±â€ã€‚è¿˜è¦æ³¨æ„ä¸»å¥å’Œä»å¥ä¹‹é—´çš„æ—¶é—´å…³ç³»ã€‚å½“ä¸»å¥ç”¨å°†æ¥æ—¶ï¼Œä»å¥æ€»æ˜¯ç”¨ç°åœ¨æ—¶ï¼›å¦‚æœbeforeå¼•å¯¼çš„ä»å¥è°“è¯­ç”¨çš„æ˜¯è¿‡å»æ—¶ï¼Œåˆ™ä¸»å¥åŠ¨è¯å¤šç”¨è¿‡å»å®Œæˆæ—¶ï¼Œè¿™æ ·ä»¥ä¾¿ä½“ç°åŠ¨ä½œå‘ç”Ÿçš„å…ˆå</strong><br>It will be four days before they come back. ï¼ˆä¸»å°†ä»ç°ï¼Œä¸€ä¸€å¯¹åº”ï¼‰ (ä»–ä»¬è¦è¿‡å››å¤©æ‰èƒ½å›æ¥)<br>Einstein almost knocked me down before he saw me. ï¼ˆå‡ ä¹åŒæ—¶å‘ç”Ÿï¼‰ (çˆ±å› æ–¯å¦å‡ ä¹æŠŠæˆ‘æ’å€’æ‰çœ‹åˆ°æˆ‘)<br>My father had left for Canada just before the letter arrived. ï¼ˆä¸»è¿‡å®Œä»è¿‡ï¼‰ (æˆ‘çˆ¶äº²æ°å¥½åœ¨ä¿¡åˆ°ä¹‹å‰å»åŠ æ‹¿å¤§äº†)</li></ul><p><strong>leave for smw</strong> (ç¦»å¼€å»æŸåœ°)<br>They had not been married four months before they were divorced. (ä»–ä»¬ç»“å©šè¿˜ä¸åˆ°å››ä¸ªæœˆå°±ç¦»å©šäº†)</p><ul><li><strong>afterè¡¨ç¤ºä¸»å¥åŠ¨ä½œå‘ç”Ÿåœ¨ä»å¥åŠ¨ä½œä¹‹åã€‚ä¸»å¥å’Œä»å¥çš„åŠ¨ä½œçš„æ—¶é—´å…³ç³»æ­£å¥½ä¸beforeå¼•å¯¼çš„ä»å¥ç›¸å</strong><br>After you think it over, please let me know what you decide. (ä½ ä»”ç»†è€ƒè™‘è¿‡ä»¥åï¼Œå‘Šè¯‰æˆ‘ä½ æ˜¯æ€æ ·å†³å®šçš„)<br>After we had finished the work, we went home. (å®Œæˆå·¥ä½œä¹‹åï¼Œæˆ‘ä»¬å›å®¶äº†) ï¼ˆä»å¥ç”¨è¿‡å»å®Œæˆæ—¶ï¼Œä¸»å¥ç”¨ä¸€èˆ¬è¿‡å»æ—¶ï¼‰</li></ul></blockquote></li><li><p>tillæˆ–untilå¼•å¯¼çš„æ—¶é—´çŠ¶è¯­ä»å¥çš„åŒºåˆ«</p><blockquote><ul><li><strong>tillå’Œuntilä¸€èˆ¬æƒ…å†µä¸‹ä¸¤è€…å¯ä»¥äº’æ¢ï¼Œä½†æ˜¯åœ¨å¼ºè°ƒå¥å‹ä¸­å¤šç”¨until,ä½†æ˜¯æ³¨æ„æ³¨æ„æ³¨æ„ï¼šâ‘ å¦‚æœä¸»å¥ä¸­çš„è°“è¯­åŠ¨è¯æ˜¯ç¬æ—¶åŠ¨è¯æ—¶ï¼Œå¿…é¡»ç”¨å¦å®šå½¢å¼ï¼›â‘¡å¦‚æœä¸»å¥ä¸­çš„è°“è¯­åŠ¨è¯æ˜¯å»¶ç»­æ€§åŠ¨è¯æ—¶ï¼Œç”¨è‚¯å®šæˆ–å¦å®šå½¢å¼éƒ½å¯ä»¥ï¼Œä½†è¡¨è¾¾çš„æ„æ€ä¸åŒã€‚â‘¢tillä¸å¯ä»¥ç”¨åœ¨å¥é¦–ï¼Œè€Œuntilå¯ä»¥æ”¾åœ¨å¥é¦–ã€‚</strong><br>I didnâ€™t go to bed untilï¼ˆtillï¼‰my father came back. (ç›´åˆ°æˆ‘çˆ¶äº²å›æ¥æˆ‘æ‰ä¸ŠåºŠç¡è§‰ã€‚)<br>It was not until the meeting was over that he began to teach me English. (ç›´åˆ°æ•£ä¼šä¹‹åä»–æ‰å¼€å§‹æ•™æˆ‘è‹±è¯­)<br>I worked until he came back.æˆ‘å·¥ä½œåˆ°ä»–å›æ¥ä¸ºæ­¢ã€‚ï¼ˆå‰è‚¯æ„ä¸ºå¦ï¼‰<br>I didnâ€™t work until he came back.ä»–å›æ¥æˆ‘è¿™æ‰å¼€å§‹å·¥ä½œã€‚ï¼ˆå‰å¦æ„ä¸ºè‚¯ï¼‰<br>Please wait until I arrived.åœ¨æˆ‘åˆ°è¾¾ä¹‹å‰è¯·ç­‰æˆ‘ã€‚</li></ul></blockquote></li><li><p>sinceå¼•å¯¼çš„æ—¶é—´çŠ¶è¯­ä»å¥çš„ç”¨æ³•</p><blockquote><ul><li><strong>sinceå¼•å¯¼çš„ä»å¥çš„è°“è¯­åŠ¨è¯å¯ä»¥æ˜¯å»¶ç»­æ€§çš„åŠ¨è¯ï¼Œåˆå¯ä»¥æ˜¯ç¬æ—¶åŠ¨è¯ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»å¥è°“è¯­åŠ¨è¯ç”¨ä¸€èˆ¬è¿‡å»æ—¶ï¼Œè€Œä¸»å¥çš„è°“è¯­åŠ¨è¯ç”¨ç°åœ¨å®Œæˆæ—¶ã€‚ä½†åœ¨It is ï¼‹æ—¶é—´ï¼‹sinceä»å¥çš„å¥å‹ä¸­ï¼Œä¸»å¥å¤šç”¨ä¸€èˆ¬ç°åœ¨æ—¶</strong><br>I have been in Beijing since you left. ï¼ˆä¸»ç°å®Œä»è¿‡å»ï¼‰ (è‡ªä»ä½ ç¦»å¼€ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨åŒ—äº¬äº†)<br>Where have you been since I last saw you? ï¼ˆä¸»ç°å®Œä»è¿‡å»ï¼‰ (è‡ªä¸Šæ¬¡æˆ‘å’Œä½ è§é¢ä»¥åï¼Œä½ åˆ°å“ªé‡Œå»äº†ï¼Ÿ)<br>It is four years since my sister lived in Beijing. (æˆ‘å¦¹å¦¹ä¸åœ¨åŒ—äº¬ä½æœ‰å››å¹´äº†)ï¼ˆä»Šæ—¥é‡ç‚¹å¥å‹ï¼Œè¡¨ç¤ºç›¸åæ„æ€ï¼‰</li></ul></blockquote></li><li><p>åœ¨æ—¶é—´çŠ¶è¯­ä»å¥ä¸­</p><blockquote><ul><li><strong>å½“ä¸»å¥æ˜¯ä¸€èˆ¬å°†æ¥æ—¶æˆ–ç¥ˆä½¿å¥è¡¨ç¤ºå°†æ¥çš„æ„ä¹‰æ—¶ï¼Œæ—¶é—´çŠ¶è¯­ä»å¥ç”¨ä¸€èˆ¬ç°åœ¨æ—¶</strong><br>Iâ€™ll let him know as soon as she comes.ï¼ˆä¸»å°†ä»ç°ï¼‰ (å¥¹ä¸€æ¥ï¼Œæˆ‘å°±ä¼šè®©ä½ çŸ¥é“)</li></ul></blockquote></li></ol><p>ï¼ˆäºŒï¼‰ <strong>åŸå› çŠ¶è¯­ä»å¥</strong><br><strong>ç”¨è¡¨ç¤ºåŸå› çš„è¿è¯è¿æ¥ä¸€ä¸ªå¥å­ä½œçŠ¶è¯­ï¼Œè¿™æ ·çš„ä¸»ä»å¤åˆå¥å°±æ˜¯åŸå› çŠ¶è¯­ä»å¥ï¼ŒåŸå› çŠ¶è¯­ä»å¥é€šå¸¸ç”±because, since, as,for å¼•å¯¼</strong></p><table><thead><tr><th align="left">é¡¹ç›®</th><th align="left">ä½ç½®</th><th align="left">å†…æ¶µ</th><th align="left">è¯­æ°”</th><th align="left">èƒ½å¦å›ç­”why</th></tr></thead><tbody><tr><td align="left">because(å› ä¸º)</td><td align="left">ä¸»å¥å‰æˆ–è€…åï¼Œé€šå¸¸æ”¾åœ¨åé¢ä¸ºå¥½</td><td align="left">ç›´æ¥å› æœå…³ç³»ï¼Œæˆ–ä¸€äº›ä¸å¤ªæƒ³è¯´çš„åŸå› </td><td align="left">å¼º</td><td align="left">èƒ½</td></tr><tr><td align="left">as(ç”±äº)</td><td align="left">ä¸»å¥å‰æˆ–è€…å</td><td align="left">åŒæ–¹éƒ½çŸ¥é“çš„åŸå› </td><td align="left">å¼±</td><td align="left">ä¸èƒ½</td></tr><tr><td align="left">since/now that (æ—¢ç„¶)</td><td align="left">ä¸»è¯­å‰</td><td align="left">åŒæ–¹éƒ½çŸ¥é“åŸå› </td><td align="left">å¼±</td><td align="left">ä¸èƒ½</td></tr><tr><td align="left">for (å› ä¸º)</td><td align="left">å¥ä¸­ï¼Œé€šå¸¸ç”±é€—å·éš”å¼€</td><td align="left">è¡¥å……è¯´æ˜åŸå› æˆ–æ¨æ–­çš„ä¾æ®</td><td align="left">å¼±</td><td align="left">ä¸èƒ½</td></tr></tbody></table><blockquote><ol><li>becauseè¡¨ç¤ºç›´æ¥åŸå› ï¼Œè¯­æ°”æœ€å¼ºã€‚Becauseå¼•å¯¼çš„åŸå› çŠ¶è¯­ä»å¥å¤šæ”¾åœ¨ä¸»å¥ä¹‹åã€‚å›ç­”ç”±whyæå‡ºçš„é—®é¢˜ï¼Œåªèƒ½ç”¨becauseã€‚<br>I was absent from the meeting because I was ill.</li><li>aså’Œsinceè¯­æ°”è¾ƒå¼±ï¼Œä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºæ˜æ˜¾çš„åŸå› ,å³ä¼—æ‰€å‘¨çŸ¥æˆ–å½“äº‹äººéƒ½çŸ¥é“ï¼Œç”±aså’Œsinceå¼•å¯¼çš„åŸå› çŠ¶è¯­ä»å¥å¤šæ”¾åœ¨å¥é¦–<br>As it is raining, we will not go to the park.   (PS:ä¸‹é›¨å°±åœ¨çœ¼å‰ï¼Œéƒ½çŸ¥é“)<br>Now that/ Since everybody is here, letâ€™s begin our meeting.</li><li>foræœ‰æ—¶ä¹Ÿå¯å¼•å‡ºè¡¨ç¤ºåŸå› çš„åˆ†å¥ï¼Œä½†å®ƒåªèƒ½ä½äºåé¢ï¼Œå¯¹å‰ä¸€åˆ†å¥åŠ ä»¥è§£é‡Šæˆ–æ¨æ–­<br>It must have rained last night, for the ground is wetï¼</li></ol></blockquote><p>(ä¸‰) <strong>ç›®çš„çŠ¶è¯­ä»å¥</strong><br>*<em>ç”¨è¡¨ç¤ºç›®çš„çš„è¿è¯è¿æ¥ä¸€ä¸ªå¥å­ä½œçŠ¶è¯­ï¼Œè¿™æ ·çš„ä¸»ä»å¤åˆå¥å°±æ˜¯ç›®çš„çŠ¶è¯­ä»å¥ï¼Œç›®çš„çŠ¶è¯­ä»å¥é€šå¸¸ç”±so that, in order to , in case, for fear *</em></p><blockquote><ol><li>I hired a boat so that I could go fishing. (æˆ‘ç§Ÿäº†ä¸€æ¡èˆ¹å»é’“é±¼)</li><li>Take your raincoat in case it rains (should rain). (å¸¦ä¸Šé›¨è¡£ä»¥é˜²ä¸‹é›¨)</li><li>He studied hard in order that he could pass the exam. (ä»–åŠªåŠ›å­¦ä¹ æ˜¯ä¸ºäº†èƒ½é€šè¿‡è€ƒè¯•)</li></ol><p><strong>æ³¨æ„ï¼š in case å’Œ for fear çš„åŒºåˆ«ï¼š</strong> in case æŒ‡â€œå‡å¦‚æŸç§æƒ…å†µå‡ºç°,æˆ‘ä»¬è¦â€¦â€¦â€ åŒæ—¶å‘ç”Ÿçš„å¯èƒ½æ€§éå¸¸å¤§ä¸å¯é¿å…,for fearæŒ‡â€œæˆ‘ä»¬è¦â€¦â€¦ä»¥å…æŸç§æƒ…å†µå‡ºç°â€,å‰è€…å¼ºè°ƒä¸»è¯­çš„èƒ½åŠ¨æ€§</p><ul><li>He worked hard for fear that he might be fired by the boss (ä»–æ‹¼å‘½åœ°å¹²æ´»æƒŸæè¢«è€æ¿è§£é›‡)</li><li>He walked fast for fear that he should be late. (ä»–å¿«èµ°,ä»¥å…è¿Ÿåˆ°)</li></ul><p><strong>æ³¨æ„ï¼š so thatæ—¢å¯å¼•å¯¼ç›®çš„çŠ¶è¯­ä»å¥ï¼Œåˆå¯å¼•å¯¼ç»“æœçŠ¶è¯­ä»å¥ã€‚åŒºåˆ«è¿™ä¸¤ç§ä»å¥çš„åŠæ³•æœ‰ä¸¤ä¸ª</strong></p><ul><li>ç›®çš„çŠ¶è¯­ä»å¥é‡Œå¾€å¾€å¸¦æœ‰æƒ…æ€åŠ¨è¯can, could, may, mightç­‰,ä»æ„æ€ä¸Šçœ‹ï¼Œç›®çš„çŠ¶è¯­ä»å¥å¾€å¾€è¡¨ç¤ºçš„ç›®çš„å¾ˆæ˜ç¡®<br>Speak clearly so that they may understand you. (ç›®çš„çŠ¶è¯­ä»å¥)<br>Jack is badly ill so that he has to rest. (ç»“æœçŠ¶è¯­ä»å¥)</li></ul></blockquote><p>ï¼ˆå››ï¼‰ <strong>æ¡ä»¶çŠ¶è¯­ä»å¥</strong><br><strong>ç”¨è¡¨ç¤ºæ¡ä»¶çš„è¿è¯è¿æ¥ä¸€ä¸ªå¥å­ä½œçŠ¶è¯­ï¼Œè¿™æ ·çš„ä¸»ä»å¤åˆå¥å°±æ˜¯æ¡ä»¶çŠ¶è¯­ä»å¥ï¼Œå¼•å¯¼æ¡ä»¶çŠ¶è¯­ä»å¥çš„ä»å±è¿è¯ä¸»è¦æœ‰if, unlessï¼Œas long as, æ¿€æ´»æ¡ä»¶</strong></p><ol><li>Donâ€™t come unless I telephone (é™¤éæˆ‘æ‰“ç”µè¯ï¼Œå¦åˆ™ä½ åˆ«æ¥)</li><li>If you watch carefully you will **see how to do it (å¦‚æœä½ ä»”ç»†çœ‹ï¼Œä½ ä¼šçœ‹å‡ºè¯¥æ€æ ·åš)</li><li>Iâ€™ll help you with your English if I am free tomorrow (å¦‚æœæˆ‘æ˜å¤©æœ‰ç©ºï¼Œæˆ‘å°±å¸®ä½ è¾…å¯¼è‹±è¯­)</li><li>He wonâ€™t be late unless he is ill (é™¤éä»–ç—…äº†ï¼Œå¦åˆ™ä»–ä¸ä¼šè¿Ÿåˆ°)<blockquote><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>ç¥ˆä½¿å¥è¿è¯è¦åœ¨ä¸­é—´</li><li>åœ¨æ¡ä»¶çŠ¶è¯­ä»å¥é‡Œï¼Œè°“è¯­åŠ¨è¯é€šå¸¸ç”¨ç°åœ¨æ—¶æ€è¡¨ç¤ºå°†æ¥çš„åŠ¨ä½œæˆ–çŠ¶æ€ï¼ˆä¸»å°†ä»ç°ï¼‰ï¼Œä½†æ˜¯æ¡ä»¶æ˜¯ä¸å¯èƒ½å‘ç”Ÿæˆ–å®ç°çš„å°±æ˜¯è™šæ‹Ÿè¯­æ°”äº†ï¼Œâ€œIf I were you â€</li></ul></blockquote></li></ol><p>ï¼ˆäº”ï¼‰ <strong>ç»“æœçŠ¶è¯­ä»å¥</strong><br><strong>å¼•å¯¼ç»“æœçŠ¶è¯­ä»å¥çš„ä»å±è¿è¯ä¸»è¦æœ‰so that, soâ€¦thatï¼Œsuchâ€¦thatç­‰</strong></p><ol><li><p>åœ¨ç”±soâ€¦thatå¼•å¯¼çš„ç»“æœçŠ¶è¯­ä»å¥ä¸­ï¼Œsoæ˜¯å‰¯è¯ï¼Œä¸å½¢å®¹è¯è¿ç”¨ã€‚å…¶ç»“æ„æ˜¯: â€œâ€¦so + å½¢å®¹è¯ï¼ˆå‰¯è¯ï¼‰+ that + ä»å¥</p><blockquote><ul><li>The hall is so big that it can hold 2,000 people  (è¿™ä¸ªå¤§å…å¤§å¾—èƒ½å®¹çº³2000äºº)</li><li>Mother lives so far away that we hardly ever see her (å¦ˆå¦ˆä½å¾—å¤ªè¿œäº†æˆ‘ä»¬éƒ½æ— æ³•å¸¸è§é¢)</li><li>He shut the window with such force that the glass broke (ä»–å…³çª—å­ç”¨åŠ›å¤ªå¤§ï¼Œç»ç’ƒéƒ½éœ‡ç ´äº†)</li></ul></blockquote></li><li><p>åœ¨ç”±suchâ€¦thatå¼•å¯¼çš„ç»“æœçŠ¶è¯­ä»å¥ä¸­ï¼Œsuchæ˜¯å½¢å®¹è¯ï¼Œå®ƒä¿®é¥°çš„å¯ä»¥æ˜¯å•æ•°æˆ–å¤æ•°å¯æ•°åè¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸å¯æ•°åè¯ï¼›åè¯å‰é¢å¯ä»¥å¸¦å½¢å®¹è¯ï¼Œä¹Ÿå¯ä¸å¸¦ã€‚å¦‚æœæ˜¯å•æ•°å¯æ•°åè¯ï¼Œå‰é¢éœ€åŠ ä¸å®šå† è¯aæˆ–an</p><blockquote><ul><li>It was such a hot day that nobody wanted to do anything (å¤©å¤ªçƒ­äº†ï¼Œæ²¡äººæ„¿æ„å¹²æ´»)</li><li>He made such rapid progress that he did very well in the mid-term. (ä»–è¿›æ­¥å¾ˆå¿«ï¼ŒæœŸä¸­è¡¨ç°éå¸¸å¥½)</li></ul></blockquote></li><li><p>å¦‚æœåè¯å‰ç”±many, much, little, fewç­‰è¯ä¿®é¥°æ—¶ï¼Œåªèƒ½ç”¨so, ä¸ç”¨such, å³â€œå¤šå¤šå°‘å°‘åªèƒ½ç”¨soâ€</p><blockquote><ul><li>Soon there were so many deer(å•å¤æ•°ä¸€æ ·) that they ate up all the wild roses (å¾ˆå¿«å°±èšé›†äº†è®¸å¤šé¹¿ï¼Œå•ƒå…‰äº†æ‰€æœ‰çš„é‡ç«ç‘°)</li><li>He has so little time that he canâ€™t go to the cinema with you (ä»–å‡ ä¹æ²¡æ—¶é—´è·Ÿä½ ä»¬å»ç”µå½±é™¢)</li></ul></blockquote></li><li><p>soâ€¦thatâ€¦å¥å‹çš„å¦å®šå½¢å¼å¯ç”¨ç®€å•å¥tooâ€¦toâ€¦æˆ–notâ€¦enough toä»£æ›¿</p><blockquote><ul><li>He is so young that he canâ€™t go to school = He is too young to go to school</li></ul></blockquote></li><li><p>å½“so/suchâ€¦thatç»“æ„ä¸­çš„soæˆ–suchæ”¾åœ¨å¥é¦–æ—¶ï¼Œä¸»å¥ç”¨å€’è£…è¯­åº</p><blockquote><ul><li>So proud was he that he never listened to any advice (ä»–å¤ªéª„å‚²äº†ä»¥è‡´äºä»æ¥å¬ä¸è¿›ä»»ä½•å»ºè®®)</li></ul></blockquote></li></ol><p>(å…­) <strong>è®©æ­¥çŠ¶è¯­ä»å¥</strong></p><table><thead><tr><th align="left">é¡¹ç›®</th><th align="left">ä½ç½®</th><th align="left">æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td align="left">though</td><td align="left">å¥é¦–,æˆ–å¥æœ«</td><td align="left">æ”¾åœ¨å¥æœ«ï¼Œåšå‰¯è¯ï¼Œæ„ä¸ºâ€œå¯æ˜¯ï¼Œä¸è¿‡â€ ,ä¸å¯ä¸butè¿ç”¨ï¼Œå¯ä¸yet,stillè¿ç”¨</td></tr><tr><td align="left">even though</td><td align="left">é€šå¸¸æ”¾åœ¨å¥ä¸­é“¾æ¥ä¸»ä»å¥</td><td align="left"></td></tr><tr><td align="left">even if</td><td align="left">é€šå¸¸æ”¾åœ¨å¥ä¸­é“¾æ¥ä¸»ä»å¥</td><td align="left"></td></tr><tr><td align="left">although</td><td align="left">å¥é¦–æˆ–å¥ä¸­</td><td align="left">åœ¨å¥é¦–éœ€è¦æœ‰é€—å·ï¼Œåœ¨å¥ä¸­ä¸éœ€è¦é€—å·ï¼Œä¸å¯ä¸butè¿ç”¨ï¼Œå¯ä¸yet,stillè¿ç”¨</td></tr></tbody></table><ol><li><p>å¼•å¯¼è®©æ­¥çŠ¶è¯­ä»å¥çš„ä»å±è¿è¯ä¸»è¦æœ‰although, though, even thoughï¼Œeven ifï¼ˆå³ä½¿ï¼‰</p><blockquote><ul><li>Though we are poor, we are still happy. æˆ‘ä»¬è™½ç„¶ç©·ï¼Œä½†æ˜¯å¾ˆå¿«æ´»ã€‚</li><li>He went out even though it was raining. å°½ç®¡ä¸‹ç€é›¨ï¼Œä»–è¿˜æ˜¯å‡ºå»äº†ã€‚</li><li>Itâ€™s hard work, I enjoy it though. å·¥ä½œå¾ˆè¾›è‹¦ï¼Œå¯æˆ‘ä¹æ„å¹²</li><li>The speech is good, it could be better though. è¿™æ¬¡æ¼”è®²ä¸é”™ï¼Œè™½ç„¶è¿˜å¯ä»¥å†å¥½ä¸€ç‚¹</li><li>Although Princeton has a world famous university, it is still a small quiet town. æ™®æ—æ–¯é¡¿è™½ç„¶æœ‰ä¸€æ‰€é—»åä¸–ç•Œçš„å¤§å­¦ï¼Œä½†ä»ç„¶æ˜¯ä¸ªå®‰é™çš„å°é•‡ã€‚</li><li>He often helps me with my English although he is pretty busy. å°½ç®¡ä»–ç›¸å½“å¿™ï¼Œä½†è¿˜æ˜¯å¸¸å¸¸å¸®åŠ©æˆ‘å­¦è‹±è¯­ã€‚</li><li>Although the book was old , we decided to buy it . å°½ç®¡è¿™æœ¬ä¹¦å¾ˆæ—§ï¼Œæˆ‘ä»¬è¿˜æ˜¯å†³å®šä¹°ã€‚</li><li><em>Though she was busy with her work, yet she managed to find time to stay with her family è™½ç„¶å¥¹å¿™äºå·¥ä½œ,ä½†å¥¹è¿˜æ˜¯æŒ¤å‡ºæ—¶é—´ä¸å®¶äººåœ¨ä¸€èµ·.</em></li><li><em>She was busy with her work ,and yet she managed to find time to stay with her family (è¿™é‡Œæ˜¯å‰¯è¯and yet ==but )</em></li><li><em>She was busy with her work , yet she managed to find time to stay with her family ï¼ˆè¿™é‡Œæ˜¯è¿æ¥è¯,è§£é‡Šä¸ºï¼šè™½ç„¶,ä½†æ˜¯=but ï¼‰</em></li></ul></blockquote></li><li><p>è¿è¯whileæœ‰æ—¶ä¹Ÿå¯è¡¨ç¤ºâ€œå°½ç®¡â€ã€â€œè™½ç„¶â€ï¼Œå¼•å¯¼è®©æ­¥çŠ¶è¯­ä»å¥</p><blockquote><p>While we donâ€™t agree with each other, we continue to be friends. å°½ç®¡æˆ‘ä»¬æ„è§ä¸åŒï¼Œæˆ‘ä»¬è¿˜æ˜¯æœ‹å‹</p></blockquote></li><li><p>whatever, whoever, however, whenever, whereverç­‰å¼•å¯¼è®©æ­¥çŠ¶è¯­ä»å¥, æ­Œè¯ä¸­å¤šè§</p><blockquote><ul><li>Donâ€™t lose heart whatever you do. ä¸ç®¡ä½ åšä»€ä¹ˆï¼Œéƒ½ä¸è¦ç°å¿ƒã€‚</li><li>Whoever you are, you canâ€™t pass this way. ä¸ç®¡ä½ æ˜¯è°ï¼Œä½ éƒ½ä¸èƒ½ä»è¿™é‡Œé€šè¿‡</li></ul></blockquote></li><li><p>asä¹Ÿå¯å¼•å¯¼è®©æ­¥çŠ¶è¯­ä»å¥ï¼Œä½†è¦å°†åè¯ã€å½¢å®¹è¯æˆ–å‰¯è¯ç­‰æåˆ°aså‰ï¼Œè‹¥æå‰çš„æ˜¯å•æ•°å¯æ•°åè¯ï¼Œè¦çœç•¥aæˆ–anï¼Œå¼•å¯¼è®©æ­¥çŠ¶è¯­ä»å¥</p><blockquote><p>Teacher as he is, he canâ€™t know everything. è™½ç„¶æ˜¯è€å¸ˆï¼Œä»–ä¹Ÿä¸å¯èƒ½ä»€ä¹ˆéƒ½æ‡‚ã€‚</p></blockquote></li><li><p>Thoughå¼•å¯¼çš„è®©æ­¥çŠ¶è¯­ä»å¥å¯ç”¨éƒ¨åˆ†å€’è£…ï¼Œå€’è£…åä½äºå¥é¦–çš„åè¯ä¹‹å‰ä¸ç”¨å† è¯aæˆ–an</p><blockquote><p>Poor though I am ,I can afford it. æˆ‘è™½ç©·ï¼Œä½†è¿™ä¸œè¥¿è¿˜æ˜¯ä¹°å¾—èµ·çš„ã€‚</p></blockquote></li><li><p>ä¹ è¯­ as though (å¥½åƒï¼Œä»¿ä½›)ï¼Œeven though (å³ä½¿ï¼Œçºµç„¶)ï¼Œ æœ‰ä¸€ç§è™šæ‹Ÿåœ¨é‡Œé¢, ä¸ç¡®å®šæ˜¯å¦æ˜¯æŸç§æƒ…å†µ</p><blockquote><p>She closed her eyes as though she were tired. å¥¹é—­ä¸Šçœ¼ï¼Œä»¿ä½›å¾ˆç–²åŠ³ä¼¼çš„ã€‚<br>He is an honest man, I must say, even though I has opposed him. å°½ç®¡æˆ‘åå¯¹ä»–ï¼Œæˆ‘è¿˜å¾—è¯´ä»–æ˜¯ä¸ªè¯šå®çš„äººã€‚</p></blockquote></li></ol><p>(ä¸ƒ) åœ°ç‚¹çŠ¶è¯­ä»å¥<br><strong>æ³¨æ„åŒºåˆ†whereå¼•å¯¼çš„å®šè¯­ä»å¥ä¸çŠ¶è¯­ä»å¥</strong></p><blockquote><ol><li>Youâ€™d better make a mark where you have any questions. (çŠ¶è¯­ä»å¥)ä½ æœ€å¥½åœ¨æœ‰ç–‘é—®çš„åœ°æ–¹åšä¸ªè®°å·ã€‚</li><li>Youâ€™d better make a mark at the place where you have any questions. (å®šè¯­ä»å¥) ä½ æœ€å¥½åœ¨æœ‰ç–‘é—®çš„åœ°æ–¹åšä¸ªè®°å·ã€‚</li></ol></blockquote><ol><li>Whereå¼•å¯¼çŠ¶è¯­ä»å¥â€”å‰¯è¯æ€§ä»å¥</li></ol><p><strong>å½“Whereå¼•å¯¼çŠ¶è¯­ä»å¥æ—¶ï¼ŒWhereå‰æ²¡æœ‰è¡¨ç¤ºåœ°ç‚¹çš„å…ˆè¡Œè¯ï¼ŒWhereæ˜¯ä»å±è¿è¯ï¼ŒWhereå¼•å¯¼çš„ä»å¥ä¿®é¥°ä¸»å¥çš„è°“è¯­åŠ¨è¯</strong></p><blockquote><ul><li>The famous scientist grew up where he was born and in 1930 he came to Shanghai. (è¿™ä½çŸ¥åçš„ç§‘å­¦å®¶å°±åœ¨å‡ºç”Ÿåœ°æˆé•¿ï¼Œ1930å¹´æ¥åˆ°ä¸Šæµ·ã€‚)<br>è¯„æï¼šå¥ä¸­â€œthe famous scientist grew up â€œè¿™ä¸€éƒ¨åˆ†æ˜¯è¯¥å¥çš„ä¸»å¥ï¼ŒWhereåˆ°å¥å­æœ€åæ˜¯åœ°ç‚¹çŠ¶è¯­ä»å¥ï¼Œwhereå‰æ²¡æœ‰è¡¨ç¤ºåœ°ç‚¹çš„å…ˆè¡Œè¯.</li><li>She found her passport where she lost it . (å¥¹åœ¨å¥¹ä¸¢æŠ¤ç…§çš„åœ°æ–¹æ‰¾åˆ°äº†æŠ¤ç…§ã€‚)<br>è¯„æï¼šâ€passportâ€æ˜¯ä¸»å¥ found åçš„å®¾è¯­ï¼Œå®ƒå¹¶ä¸æ˜¯ä»å¥ä¸­lostçš„åœ°ç‚¹ï¼Œå› æ­¤ where å¼•å¯¼çš„æ˜¯åœ°ç‚¹çŠ¶è¯­ä»å¥ï¼Œä»å±è¿è¯whereå¼•å¯¼çš„ä»å¥ä¿®é¥°ä¸»å¥çš„è°“è¯­åŠ¨è¯ found ã€‚</li></ul></blockquote><ol start="2"><li>Whereå¼•å¯¼å®šè¯­ä»å¥â€”å½¢å®¹è¯æ€§ä»å¥</li></ol><p><strong>å½“where å¼•å¯¼å®šè¯­ä»å¥æ—¶ï¼ŒWhereå‰æœ‰è¡¨ç¤ºåœ°ç‚¹çš„å…ˆè¡Œè¯ï¼Œwhere å¼•å¯¼çš„ä»å¥ä¿®é¥°å…ˆè¡Œè¯ï¼ŒWhereæ˜¯å…³ç³»å‰¯è¯ï¼Œåœ¨ä»å¥ä¸­ä½œåœ°ç‚¹çŠ¶è¯­</strong></p><blockquote><ul><li>Heâ€™s got himself into a dangerous situation where is likely to lose control over the plane . (ä»–åœ¨é£æœºä¸Šå¤±å»æ§åˆ¶ï¼Œå¤„äºæå…¶å±é™©çš„å¢ƒåœ°ã€‚)<br>è¯„æï¼šsituation æ˜¯å…ˆè¡Œè¯ï¼Œå…¶åæ˜¯Whereå¼•å¯¼çš„å®šè¯­ä»å¥ã€‚</li><li>This is the place where Luxun once lived . (è¿™æ˜¯é²è¿…æ›¾ç»ç”Ÿæ´»è¿‡çš„åœ°æ–¹ã€‚)<br>è¯„æï¼š the place æ˜¯å…ˆè¡Œè¯ï¼Œå…¶åæ˜¯ whereå¼•å¯¼çš„å®šè¯­ä»å¥ ï¼Œwhere åœ¨ä»å¥ä¸­ä½œåœ°ç‚¹çŠ¶è¯­ã€‚</li></ul></blockquote><ol start="3"><li><p>åœ¨æœ‰äº›æƒ…å†µä¸‹,whereå¼•å¯¼çš„å®šè¯­ä»å¥å¯è½¬æ¢ä¸ºwhereå¼•å¯¼çš„åœ°ç‚¹çŠ¶è¯­ä»å¥.</p><blockquote><p>A tall building was put up at the place where there used to be a desert.ï¼A tall building was put up where there used to be a desert. (åœ¨ä»¥å‰æ›¾æ˜¯æ²™æ¼ çš„åœ°æ–¹ç›–èµ·äº†ä¸€å¹¢é«˜æ¥¼.)</p></blockquote></li><li><p>whereå¼•å¯¼å®¾è¯­ä»å¥ã€è¡¨è¯­ä»å¥ã€ä¸»è¯­ä»å¥â€”â€”â€”åè¯æ€§ä»å¥</p><blockquote><ul><li>This is where Luxun once lived.   è¿™æ˜¯é²è¿…æ›¾ç»ä½çš„åœ°æ–¹(where å¼•å¯¼è¡¨è¯­ä»å¥)</li><li>I donâ€™t know where Luxun once lived .æˆ‘ä¸æ¸…æ¥šé²è¿…æ›¾ç»ä½åœ¨å“ªé‡Œã€‚(where å¼•å¯¼å®¾è¯­ä»å¥)</li><li>She was free to go to where she liked . å¥¹å¯ä»¥å»ä»»ä½•å¥¹å–œæ¬¢çš„åœ°æ–¹ã€‚(where å¼•å¯¼å®¾è¯­ä»å¥)</li><li>Where Mary was born is Beijing .  ç›åˆ©å‡ºèº«çš„åœ°æ–¹æ˜¯åŒ—äº¬ã€‚(where å¼•å¯¼ä¸»è¯­ä»å¥)</li></ul></blockquote></li><li><p>å­¦åæ„Ÿ</p><blockquote><ul><li>å…ˆè¡Œè¯æ˜¯åœ°ç‚¹ç±»çš„åè¯ place situation caseï¼Œ åé¢çš„whereå¼•å¯¼å®šè¯­ä»å¥</li><li>where å‡ºç°åœ¨ä»€ä¹ˆåœ°æ–¹å°±æ˜¯å……å½“ä»€ä¹ˆæˆåˆ†</li><li>ä¸»å¥åŠ¨è¯åé¢é™¤äº†å®¾è¯­å’Œè¡¨è¯­ï¼Œå‰©ä¸‹çš„å°±æ˜¯çŠ¶è¯­</li><li>çŠ¶è¯­ç”¨æ¥ä¿®é¥°çš„æ˜¯ä¸»å¥çš„åŠ¨è¯</li></ul></blockquote></li><li><p>è¯¾åä¹ é¢˜</p><blockquote><ul><li>æœ‰å¿—è€…äº‹ç«Ÿæˆã€‚ Where there is a will, there is a way.   </li><li>ä¹¦åœ¨ä½ åŸæ¥æ”¾çš„åœ°æ–¹ã€‚  The book is where you left it.   </li><li>å¥¹å›åˆ°äº†å¥¹åˆšæ‰åçš„åœ°æ–¹ã€‚  She is back to where she sat just now.</li><li>è¯·å‘†åœ¨åŸå¤„ã€‚  Please stay where you are.   </li><li>è¿™å°±æ˜¯ä»–æ›¾å·¥ä½œè¿‡çš„å†œåœºã€‚  This is the farm where he once worked.</li></ul></blockquote></li></ol><p>ï¼ˆå…«ï¼‰ æ¯”è¾ƒçŠ¶è¯­ä»å¥<br><strong>å¸¸è§çš„å¼•å¯¼è¯æœ‰ï¼š asâ€¦as,not so (as)â€¦as, than, the moreâ€¦the moreç­‰</strong></p><ol><li><p><strong>the more + ä¸»è°“ï¼Œ the more + åè¯ + ä¸»è°“</strong></p><blockquote><ul><li>The harder you work, the more progress you will make. ä½ è¶ŠåŠªåŠ›ï¼Œå–å¾—çš„è¿›æ­¥å°±è¶Šå¤§ã€‚   </li><li>The more you study, the more knowledge you can get.  ä½ å­¦çš„çŸ¥è¯†è¶Šå¤šï¼Œä½ çš„çŸ¥è¯†è¶Šä¸°å¯Œã€‚</li></ul></blockquote></li><li><p><strong>not so/as â€¦ as ä¹‹é—´åªèƒ½æ˜¯å½¢å®¹è¯åŸçº§ï¼Œä¸å¯ä»¥æ˜¯æ¯”è¾ƒçº§å’Œæœ€é«˜çº§</strong></p><blockquote><ul><li>The work is not so difficult as you imagine. è¿™å·¥ä½œä¸åƒä½ æƒ³åƒçš„é‚£ä¹ˆå›°éš¾ã€‚</li><li>He doesnâ€™t work as hard as she (does). ä»–å·¥ä½œä¸åƒå¥¹é‚£æ ·åŠªåŠ›ã€‚</li></ul></blockquote></li><li><p><strong>è¡¨ç¤ºå€æ•°çš„ä¸‰ç§å¥å‹</strong></p><blockquote><ul><li><strong>å€æ•°ï¼‹as many +å¯æ•°åè¯å¤æ•°+as</strong></li><li><strong>å€æ•°+as much+ä¸å¯æ•°åè¯+as</strong></li><li><strong>å€æ•°+as+å½¢å®¹è¯åŸçº§+åè¯+as</strong></li><li>I have twice as many books as you do. æˆ‘æ‹¥æœ‰çš„ä¹¦æ˜¯ä½ çš„ä¸¤å€ã€‚</li><li>It is reported that the United States uses twice as much energy as the whole of Europe. æ®æŠ¥é“ç¾å›½äººä½¿ç”¨çš„èƒ½æºæ˜¯æ•´ä¸ªæ¬§æ´²çš„ä¸¤å€ã€‚</li><li>I can rent three times as big a room as yours in my city using that money. ç”¨é‚£äº›é’±æˆ‘èƒ½åœ¨æˆ‘ä»¬çš„åŸå¸‚ç§Ÿä¸€ä¸ªä¸‰å€å¤§çš„æˆ¿é—´ã€‚</li><li><strong>æ³¨æ„ï¼š</strong> adj + a/an + åè¯</li></ul></blockquote></li></ol><p>ï¼ˆä¹ï¼‰ æ–¹å¼çŠ¶è¯­ä»å¥<br><strong>å¸¸è§çš„å¼•å¯¼è¯æœ‰ï¼šas ,as if ï¼Œas though</strong></p><ol><li><p>** as if ä»å¥ç”¨é™ˆè¿°è¯­æ°”çš„æƒ…å†µ,å½“è¯´è¯è€…è®¤ä¸ºå¥å­æ‰€è¿°çš„æ˜¯çœŸå®çš„æˆ–ææœ‰å¯èƒ½å‘ç”Ÿæˆ–å­˜åœ¨çš„äº‹å®æ—¶ **</p><blockquote><ul><li>It sounds as if it is rainingï¼å¬èµ·æ¥åƒæ˜¯åœ¨ä¸‹é›¨ã€‚</li><li>He talks as if he is drunkï¼ä»ä»–è°ˆè¯çš„æ ·å­æ¥çœ‹ä»–æ˜¯é†‰äº†ã€‚</li></ul></blockquote></li><li><p><strong>as if ä»å¥ç”¨è™šæ‹Ÿè¯­æ°”çš„æƒ…å†µ,å½“è¯´è¯äººè®¤ä¸ºå¥å­æ‰€è¿°çš„æ˜¯ä¸çœŸå®çš„æˆ–æå°‘æœ‰å¯èƒ½å‘ç”Ÿæˆ–å­˜åœ¨çš„æƒ…å†µæ—¶ã€‚ä»å¥è™šæ‹Ÿè¯­æ°”åŠ¨è¯æ—¶æ€çš„å½¢å¼å¦‚ä¸‹</strong></p><blockquote><p><strong>å¦‚æœä»å¥è¡¨ç¤ºä¸ç°åœ¨äº‹å®ç›¸åï¼Œè°“è¯­åŠ¨è¯ç”¨ä¸€èˆ¬è¿‡å»æ—¶</strong></p><ul><li>You look as if you didnâ€™t careï¼ ä½ çœ‹ä¸Šå»å¥½åƒå¹¶ä¸åœ¨ä¹ã€‚</li><li>He talks as if he knew where she wasï¼ ä»–è¯´è¯çš„æ ·å­ï¼Œå¥½åƒä»–çŸ¥é“å¥¹åœ¨å“ªé‡Œä¼¼çš„ã€‚</li></ul><p><strong>ä»å¥è¡¨ç¤ºä¸è¿‡å»äº‹å®ç›¸åï¼Œè°“è¯­åŠ¨è¯ç”¨â€œhadï¼‹è¿‡å»åˆ†è¯â€</strong></p><ul><li>He talks about Rome as if he had been there beforeï¼ ä»–è¯´èµ·ç½—é©¬æ¥å¥½åƒä»–ä»¥å‰å»è¿‡ç½—é©¬ä¼¼çš„ã€‚</li><li>The girllistened as if she had been turned to stoneï¼ é‚£å¥³å­©å€¾å¬ç€ï¼Œä¸€åŠ¨ä¹Ÿä¸åŠ¨ï¼Œåƒå·²ç»å˜æˆäº†çŸ³å¤´ä¼¼çš„ã€‚</li></ul><p><strong>ä»å¥è¡¨ç¤ºä¸å°†æ¥äº‹å®ç›¸åï¼Œè°“è¯­åŠ¨è¯ç”¨â€œwouldï¼couldï¼mightï¼‹åŠ¨è¯åŸå½¢â€</strong></p><ul><li>He opened his mouth as if he would say somethingï¼  ä»–å¼ å¼€å˜´å¥½åƒè¦è¯´ä»€ä¹ˆã€‚</li><li>It looks as if it might snowï¼çœ‹æ¥å¥½åƒè¦ä¸‹é›ªäº†ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong> as if /thoughå¼•å¯¼çš„ä»å¥å¸¸ç”¨è™šæ‹Ÿè¯­æ°”ï¼Œè¡¨ç¤ºéçœŸå®æƒ…å†µï¼Œä½†å¦‚æœä»å¥ä¸­é™ˆè¿°çš„æƒ…å†µå¾ˆå¯èƒ½å®ç°ï¼Œä¹Ÿå¯ç”¨é™ˆè¿°è¯­æ°”</p></blockquote></li></ol><p>ï¼ˆåï¼‰ çŠ¶è¯­ä»å¥çš„çœç•¥<br><strong>å½“æ—¶é—´ã€æ¡ä»¶ã€è®©æ­¥ã€æ–¹å¼å’Œæ¯”è¾ƒçŠ¶è¯­ä»å¥çš„ä¸»è¯­ä¸ä¸»å¥ä¸€è‡´æˆ–ä¸ºit æˆ– thereä¸”è°“è¯­åŠ¨è¯å«beåŠ¨è¯æ—¶ï¼Œä»å¥ä¸­çš„ä¸»è¯­å’Œè°“è¯­å¯ä»¥ä¸€èµ·çœå»</strong></p><ol><li>Donâ€™t speak until spoken to.( çœç•¥äº†you are) ä½ ä¸è¦è®²è¯ï¼Œé™¤éè®©ä½ è®²è¯ã€‚</li><li>I have no money. If any, I will lend yousome. æˆ‘æ‰‹é‡Œæ²¡æœ‰é’±ï¼Œæœ‰çš„è¯ï¼Œæˆ‘ä¼šå€Ÿç»™ä½ çš„ã€‚( çœç•¥äº†there is)</li><li>Though cold, he still wore a shirt. å°½ç®¡å¾ˆå†·ï¼Œä»–å´åªç©¿ä¸€ä»¶çŸ­è¢–ã€‚ ( çœç•¥äº†it was)</li></ol><h4 id="å¼ºè°ƒå¥"><a href="#å¼ºè°ƒå¥" class="headerlink" title="å¼ºè°ƒå¥"></a>å¼ºè°ƒå¥</h4><p>ï¼ˆä¸€ï¼‰ åŒºåˆ†å¼ºè°ƒå¥ä¸å…¶ä»–ç±»å‹ä»å¥ï¼ˆä¸»ã€å®šã€çŠ¶ï¼‰</p><ol><li><p>å¼ºè°ƒå¥ä¸ä¸»è¯­ä»å¥çš„åŒºåˆ«</p><blockquote><ul><li>It is true that he is honest. (ä¸»è¯­ä»å¥) ä»–çœŸçš„å¾ˆè¯šå®ã€‚</li><li>True he is honest (å»æ‰It is â€¦ that ä¹‹åä¸æˆå¥å­ï¼Œæ‰€ä»¥æ˜¯ä¸»è¯­ä»å¥ï¼Œå¼ºè°ƒå¥å»æ‰ä»ç„¶æˆå¥å­å¦‚ï¼š It is Mr Fu that is honest)</li><li>It is known to all that China is a country with a long history. (ä¸»è¯­ä»å¥) ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½æ˜¯ä¸€ä¸ªå†å²æ‚ ä¹…çš„å›½å®¶ã€‚<br>It was here that he fell off his bicycle.(å¼ºè°ƒå¥) è¿™æ­£æ˜¯ä»–ä»è‡ªè¡Œè½¦ä¸Šæ‘”ä¸‹æ¥çš„åœ°æ–¹ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> â€œIt is / was + å½¢å®¹è¯ / åˆ†è¯ /  + thatä»å¥â€æ˜¯ä¸»è¯­ä»å¥ï¼Œå®ƒè¯‘æˆä¸­æ–‡æ—¶<strong>ä¸</strong>å¯åŠ ä¸Šâ€œæ­£æ˜¯â€¦â€¦â€â€œå°±æ˜¯â€¦â€¦â€ä¹‹ç±»å­—çœ¼ï¼Œ</p></blockquote></li><li><p>å«æœ‰å®šè¯­ä»å¥çš„å¼ºè°ƒå¥å‹ (åœ¨è¢«å¼ºè°ƒçš„åè¯åå†è®¾è®¡ä¸€ä¸ªä»¥è¯¥åè¯ä¸ºå…ˆè¡Œè¯çš„å®šè¯­ä»å¥ï¼Œè¿™æ—¶ä¸è¦æŠŠå®šè¯­ä»å¥å½“ä½œå¼ºè°ƒå¥)ã€‚</p><blockquote><ul><li>It was this school where (in which) he once studied that gave him a chance of teaching.æ­£æ˜¯è¿™æ‰€ä»–æ›¾ç»å­¦ä¹ è¿‡çš„å­¦æ ¡ç»™äº†ä»–æ•™å­¦çš„æœºä¼šã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> è¿™ç§å¥å­å…ˆå†™ä¸»å¹²ï¼š It was this schoolâ€¦. that gave him a chance of teaching</p></blockquote></li><li><p>å¼ºè°ƒå¥å‹ä¸çŠ¶è¯­ä»å¥çš„åŒºåˆ«</p><blockquote><ul><li>It was at 7:00 that I arrived.(å¼ºè°ƒå¥å‹ï¼Œå¼ºè°ƒæ—¶é—´çŠ¶è¯­at 7:00)æ­£æ˜¯åœ¨7:00æ—¶ï¼Œ æˆ‘åˆ°äº†ã€‚</li><li>It was 7:00 when I arrived.(æ—¶é—´çŠ¶è¯­ä»å¥ï¼Œåœ¨7:00å‰æ— ä»‹è¯at) å½“æˆ‘åˆ°è¾¾æ—¶ï¼Œ æ—¶é—´æ˜¯7:00ã€‚</li><li>It was two years ago that I began to learn drawing.(å¼ºè°ƒå¥å‹ï¼Œå‰åæ—¶æ€ä¸€è‡´) æ­£æ˜¯åœ¨ä¸¤å¹´å‰æˆ‘å¼€å§‹å­¦ä¹ ç»˜ç”»ã€‚</li><li>It is(has been) two years since I began to learn drawing.(sinceå¼•å¯¼çš„æ—¶é—´çŠ¶è¯­ä»å¥ï¼Œå‰åæ—¶æ€ä¸ä¸€è‡´) è‡ªä»æˆ‘å­¦ä¹ ç»˜ç”»ä»¥æ¥å·²ç»æœ‰ä¸¤å¹´äº†ã€‚</li><li>It was two years before they came to see us.(æ—¶é—´çŠ¶è¯­ä»å¥) è¿‡äº†ä¸¤å¹´åä»–ä»¬æ‰æ¥çœ‹æˆ‘ä»¬ã€‚</li><li>It was two years later that they came to see us.(å¼ºè°ƒå¥å‹) æ­£æ˜¯ä¸¤å¹´åä»–ä»¬æ‰æ¥çœ‹æˆ‘ä»¬çš„ã€‚</li><li>It wonâ€™t be long before we graduate from the school. (æ—¶é—´çŠ¶è¯­ä»å¥) ä¸ä¹…æˆ‘å°±å°†æ¯•ä¸šäº†ã€‚</li><li>It will be two years before we graduate from this university. (æ—¶é—´çŠ¶è¯­ä»å¥) å†è¿‡ä¸¤å¹´æˆ‘ä»¬å°±å°†å¤§å­¦æ¯•ä¸šäº†ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> å¯ä»¥çœ‹å…ˆè¡Œè¯ï¼Œå¦‚æœæ˜¯å¼•å¯¼æ—¶é—´çš„è¯since before after å°±æ˜¯æ—¶é—´çŠ¶è¯­ä»å¥ï¼Œ thatæ˜¯å¼ºè°ƒå¥</p></blockquote></li></ol><p>ï¼ˆäºŒï¼‰ å¼ºè°ƒä¸‰å…³</p><p><img src="http://7xkyc7.com1.z0.glb.clouddn.com/xmind_mind1.png" alt="mind1"></p><h3 id="å¸¸ç”¨å¥å¼"><a href="#å¸¸ç”¨å¥å¼" class="headerlink" title="å¸¸ç”¨å¥å¼"></a>å¸¸ç”¨å¥å¼</h3><ol><li><p><strong>sb1 cut sb1 off</strong>  sb1æˆªæ–­äº†sb2çš„æ¥æºï¼ˆå¤šåªç»æµæ¥æºï¼‰</p><blockquote><p>My daddy cut me off  æˆ‘è€çˆ¸æ–­äº†æˆ‘çš„ç»æµæ¥æº<br><strong>sth cut sb off</strong> (sthæ–­äº†)<br>Machine cut me off (ç”µè¯æ–­äº†)</p></blockquote></li><li><p><strong>sb is dumb blonde that has no common sense</strong>   æŸäººæ˜¯æ²¡æœ‰å¸¸è¯†çš„é‡‘å‘å¥³éƒï¼ˆä¸–ç•Œè§‚åŠä»·å€¼è§‚ä¸å¸¸äººä¸åŒï¼‰</p></li><li><p><strong>I knew it was stupid and I <em>shouldnâ€™t have done</em> it</strong>   æˆ‘çŸ¥é“è¿™äº‹æƒ…å¾ˆè ¢æˆ‘ä¹Ÿä¸è¯¥è¿™ä¹ˆåš</p><blockquote><p>shouldnâ€™t have done, æœ¬æ¥ä¸è¯¥åšçš„äº‹æƒ…åšäº†ï¼ŒåŒç†ï¼Œshould have done,æœ¬è¯¥åšçš„äº‹æƒ…æ²¡åšï¼Œå£è¯­ä¸­ä½¿ç”¨é¢‘ç‡å¾ˆé«˜.<br>You shouldnâ€™t have said that.</p></blockquote></li><li><p><strong>sb is at rock bottom</strong> æŸäººåœ¨å¾ˆæƒ¨/ä½è°·çš„æ—¶å€™</p></li><li><p><strong>I think it is the best thing that couldâ€™ve ever happened to you</strong></p></li><li><p><strong>get out on oneâ€™s way</strong>  è‡ªåŠ›æ›´ç”Ÿ</p><blockquote><p>We should get out on our way.</p></blockquote></li><li><p><strong>How does he expect me to do sth</strong>   è´£å¤‡çš„è¯­æ°”ï¼Œæ€ä¹ˆå¯ä»¥è¿™æ ·ï¼Ÿå¤ªè¿‡åˆ†äº†</p><blockquote><p>How does my boss expect me to work overtime</p></blockquote></li><li><p><strong>tune (æ›²è°ƒï¼Œè°ƒæ•´ï¼Œä½¿ä¸€è‡´)</strong></p><blockquote><p>tune in(æ”¶å¬) America tuned in to watch six very attractive singles navigate relationships and life in New York City<br>stay tuned (ä¸è¦æ¢å°ï¼Œä¸è¦èµ°å¼€ï¼Œ DJå¸¸ç”¨è¯­)</p></blockquote></li><li><p><strong>clip</strong> å°æ®µéŸ³é¢‘æˆ–è§†é¢‘ï¼Œ next clipï¼Œ clip section 2</p></li><li><p><strong>wind(wound) up doing == end up doing</strong> æœ€ç»ˆ..</p></li><li><p><strong>Right in the very beginning</strong> å°±åœ¨ä¸€å¼€å§‹</p></li><li><p>*<em>we really just fell in love and adoredï¼ˆå€¾æ…•ï¼‰ each other instantly *</em></p></li><li><p><strong>sitcom = situation comedy</strong> ï¼ˆæƒ…æ™¯å–œå‰§ï¼‰</p></li><li><p><strong>Who have the best chemistry of the group?</strong></p><blockquote><p>chemistry: åŒ–å­¦ååº”ï¼Œç›¸äº’å¸å¼•ï¼Œå¹¶éé…åˆçš„é»˜å¥‘</p></blockquote></li><li><p><strong>take sb under oneâ€™s â€¦</strong>  </p><blockquote><p>he graciously took me under his wings.</p></blockquote></li><li><p><strong>be filthy rich</strong>  </p><blockquote><p>filthy /â€˜fÉªlÎ¸i/ è‚®è„çš„ï¼Œæ±¡ç§½çš„ï¼ŒçŒ¥äºµçš„ï¼Œ æ˜¯æŒ‡æœ‰é“œè‡­çš„é‚£ç§æ„Ÿè§‰  Tom is filthy rich.    </p></blockquote></li><li><p><strong>I donâ€™t want to go into sth</strong>   æˆ‘ä¸æƒ³è¯¦ç»†çš„è§£é‡Š/è®²è¿™ä»¶äº‹ï¼Œ å› ä¸ºæ‡’/éº»çƒ¦ä¸æ„¿æ„è¯´</p></li><li><p><strong>It wonâ€™t work out</strong>  â€¦è¡Œä¸é€š</p></li><li><p><strong>have words</strong> è¾¾æˆä¸€è‡´</p></li><li><p><strong>His mind is blown/ sb blew his mind</strong>  è„‘è¢‹çˆ†ç‚¸ï¼ŒæŒ‡ä¿¡æ¯é‡å¾ˆå¤§ï¼Œä¸€æ—¶æ¥å—ä¸äº†</p></li><li><p><strong>But not yet</strong>  â€¦è¿˜æ²¡æ€æ ·ï¼Œä½†æ˜¯è¦å¿«äº†</p></li><li><p><strong>I expect(é¢„æµ‹)/look forward to(æœŸç›¼) it will rain today</strong></p></li><li><p><strong>What if I â€¦</strong> å¦‚æœæˆ‘â€¦.  é€šå¸¸æ¥è¿‡å»æ—¶/è¿‡å»å®Œæˆæ—¶</p><blockquote><p>What if I was still fat  ï¼ˆè¿‡å»æ—¶ï¼‰<br>What if I had had the guts(å‹‡æ°”) to quit my job ï¼ˆè¿‡å»å®Œæˆæ—¶ï¼‰<br>What ifâ€¦? ä¸»è¦æœ‰ä¸‰ç§ç”¨æ³•ï¼Œæ­¤å¤„è¡¨ç¤ºå‡è®¾ï¼Œæ„æ€æ˜¯â€œè¦æ˜¯â€¦â€¦å°†ä¼šæ€ä¹ˆæ ·â€ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥è¡¨ç¤ºé‚€è¯·æˆ–å»ºè®®ï¼Œæ„æ€æ˜¯â€œå¦‚æœâ€¦â€¦å¦‚ä½•ï¼Ÿâ€What ifâ€¦? è¿˜å¯ä»¥è¡¨ç¤ºæŸäº‹ä¸é‡è¦ï¼Œå¸¸å¸¸ä¸soè¿ç”¨ï¼Œæ„ä¸ºâ€œå°±ç®—â€¦â€¦é‚£åˆæ€æ ·ï¼Ÿ<br>What if you join us for lunch? åŒæˆ‘ä»¬ä¸€èµ·åƒæ™šé¥­æ€ä¹ˆæ ·  ï¼ˆè¡¨ç¤ºé‚€è¯·/å»ºè®®ï¼‰<br>So what if weâ€™re a little late? å°±ç®—æˆ‘ä»¬è¿Ÿåˆ°ä¸€å°ä¼šåˆæ€æ ·  ï¼ˆè¡¨ç¤ºæŸäº‹ä¸é‡è¦ï¼‰</p></blockquote></li><li><p><strong>golden years</strong> é»„é‡‘å¹´ä»£  <strong>prime time</strong> é»„é‡‘æ—¶é—´</p></li><li><p><strong>Thatâ€™s for sure</strong> é‚£æ¯‹åº¸ç½®ç–‘ï¼Œ å¯ä»¥åœ¨è‡ªå·±è¯´çš„å¥å­æœ«å°¾åŠ ä¸Šè¿™å¥è¯ï¼Œ ä¹Ÿå¯ä»¥åœ¨åˆ«äººè¯´è¿‡è¯ä¹‹åè¯´è¿™å¥è¯è¡¨ç¤ºè‚¯å®šå’Œè®¤å¯</p></li><li><p><strong>Donâ€™t dwell</strong> (ä¸è¦æ²‰æººäºè¿‡å»)</p><blockquote><p>dwell /dwÉ›l/ (vi. å±…ä½ï¼›å­˜åœ¨äºï¼›ç»†æƒ³æŸäº‹)<br>move on / look forward  æ˜¯å…¶åä¹‰è¯ è¡¨ç¤ºå‘å‰çœ‹</p></blockquote></li><li><p><strong>casual Friday</strong>  é€šå¸¸æ‰€è¯´çš„happy Friday, æŒ‡å·¥ä½œæ—ä¸ç”¨åœ¨æ˜ŸæœŸäº”ç©¿è¥¿è£…æ‰“é¢†å¸¦é‚£ä¹ˆä¸è‡ªç”±</p></li><li><p><strong>only if/if only</strong></p><blockquote><p>only if çš„only æ˜¯é‡ç‚¹ï¼Œâ€åªæœ‰å¦‚æœ(å½“â€¦)â€,if only çš„ifæ˜¯é‡ç‚¹â€å¦‚æœâ€¦å°±å¥½äº†(æ—¢ç„¶å‡è®¾å°±è™šæ‹Ÿ)â€</p></blockquote></li><li><p><strong>You guys really think that Iâ€™m that shallow</strong>  (ä½ ä»¬çœŸçš„é‚£ä¹ˆè®¤ä¸ºæˆ‘é‚£ä¹ˆè‚¤æµ…/æµ…è–„å—ï¼Ÿ)</p></li><li><p><strong>wear a tie</strong> (æˆ´é¢†å¸¦)</p></li><li><p><strong>sb have a knack for sth</strong> æŸäººæœ‰â€¦ å¤©åˆ†</p><blockquote><p>knack /nÃ¦k/ n. è¯€çªï¼›æœ¬é¢†ï¼›ç†Ÿç»ƒæŠ€æœ¯ï¼›å·§å¦™æ‰‹æ³•   I have a knack for stocks æˆ‘æœ‰ç‚’è‚¡ç¥¨çš„å¤©åˆ†/æ½œè´¨</p></blockquote></li><li><p><strong>quit my job</strong> æ”¾å¼ƒæˆ‘çš„å·¥ä½œï¼Œè¡¨ç¤ºè¾èŒ</p></li><li><p><strong>I have to admit, *the horoscope stuff really caught my attention.</strong> æˆ‘ä¸å¾—ä¸æ‰¿è®¤ï¼Œæ˜Ÿåº§è¿åŠ¿è¿™ä¸œè¥¿å¼•èµ·äº†æˆ‘çš„å…´è¶£</p></li><li><p><strong>Virgos have a strong attention to detail, they are known to take good care of people</strong> å¤„å¥³åº§åŠå…¶å…³æ³¨ç»†èŠ‚ï¼Œä»–ä»¬æ˜¯å…¬è®¤çš„æ“…é•¿ç…§é¡¾åˆ«äºº</p></li><li><p><strong>Do you have some studying(homework) to do?</strong></p></li><li><p><strong>Do you not wanna be seen with me?  å’Œ Donâ€™t you wanna be seen with me?</strong>  (ä¸¤è€…è¡¨è¾¾çš„æ„æ€ä¸ä¸€æ ·ï¼Œ å‰è€…åœ¨å½“æ—¶çš„å¯¹è¯æƒ…æ™¯çŒœæµ‹åˆ°å¯¹æ–¹çš„æ„æ€)</p></li><li><p><strong>Iâ€™m about to leave</strong> (æˆ‘é©¬ä¸Šè¦ç¦»å¼€ï¼Œ æŒ‡ä¸‹ä¸€ç§’å°†è¦åšæŸäº‹)</p></li><li><p>*<em>you may frown upon that. *</em> ï¼ˆä½ å¯èƒ½å¿ƒé‡Œå¤´ä¸èˆ’æœï¼Œè¡¨ç¤ºè¡¨æƒ…ä¸Šï¼Œå†…å¿ƒé‡Œï¼ˆæš—æš—ï¼‰ä¸æ»¡ï¼Œä¸åŒæ„ï¼Œ è€Œdisapprove,disagree è¡¨ç¤ºè¨€è¯­ä¸Šçš„ä¸åŒæ„ï¼‰</p></li><li><p><strong>You are so fired. ï¼</strong> ä½ é“å®šè¢«è§£é›‡äº† æœ‰ç‚¹ä½ ä¼šè¢«è§£é›‡çš„å¾ˆæƒ¨çš„æ„æ€</p><blockquote><p>you are so dead ä½ æ­»å®šäº†</p></blockquote></li><li><p><strong>what are you [doing]</strong> å¥å‹æ‰©å±•</p><blockquote><ul><li>what are you trying to say. (ä½ æƒ³è¯´ä»€ä¹ˆ)<br>æƒ…æ™¯åº”ç”¨ï¼š A: è¯´äº†åŠå¤©ä¹Ÿè¯´ä¸æ˜ç™½ï¼Œæˆ–è€…åœ¨çº ç»“è¯¥ä¸è¯¥è¯´  B: what are you trying to say?   ä½ ç°åœ¨æ­£åœ¨å°è¯•è¦è¯´ä»€ä¹ˆï¼Ÿ</li><li>what do you want to say? (ä½ æƒ³è¯´ä»€ä¹ˆ)<br>æƒ…æ™¯åº”ç”¨ï¼š A: è·‘åˆ°Bé¢å‰è¯´â€œCan I talk to you?â€ B: what do you want to say? ä½ æƒ³è¦è¯´ä»€ä¹ˆï¼Ÿ</li><li>what are you doing saying this  ï¼ˆä½ è¯´è¿™ä¸ªå¹²ä»€ä¹ˆï¼Œå¸¦æœ‰è´£å¤‡è¯­æ°”ï¼‰<br>æƒ…æ™¯åº”ç”¨ï¼š ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¥å‹ what are you doing [doing] å¸¦æœ‰è´£å¤‡çš„æƒ…æ„Ÿåœ¨é‡Œé¢   what are you doing talking to her about that? ä½ å’Œå¥¹è°ˆè®ºé‚£ä¸ªå¹²ä»€ä¹ˆï¼Ÿ</li></ul></blockquote></li><li><p><strong>Please bear in mind</strong> è¯·è®°ä½</p><blockquote><p>Please bear in mind that I love you forever.</p></blockquote></li><li><p><strong>Twist the knife</strong> å¾€ä¼¤å£ä¸Šæ’’ç›ï¼Œæ­ä¼¤ç–¤</p><blockquote><p>Theyâ€™re all twisting the knife.</p></blockquote></li><li><p><strong>Split the cost</strong> åˆ†æ‘Šæˆæœ¬ï¼Œç±»ä¼¼äºä¸­å›½çš„AAåˆ¶</p></li><li><p><strong>you canâ€™t be too careful in your work</strong>  </p><blockquote><p>Aï¼šä½ å‡ºé—¨è¿˜å¸¦åˆ€è‡ªæˆ‘ä¿æŠ¤ï¼Œå¤ªå¤¸å¼ äº†å§ Bï¼šYou canâ€™t be too careful.ï¼ˆç°åœ¨ä¸–é“è¿™ä¹ˆä¹±ï¼Œå†æ€ä¹ˆå°å¿ƒä¹Ÿä¸ä¸ºè¿‡, å°å¿ƒä½¿å¾—ä¸‡å¹´èˆ¹ï¼‰</p></blockquote></li><li><p><strong>Do you mind if we switch placesï¼Ÿ ï¼ˆbecasue I get off next å¯è¯´å¯ä¸è¯´ï¼‰ ç±»ä¼¼äºåœ¨ç”µæ¢¯ä¸­è¯·æ±‚äº’æ¢ä½ç½®</strong></p></li><li><p><strong>mean to do sth</strong> æœ‰æ„åšæŸäº‹ æ•…æ„åšæŸäº‹ // <strong>run into sb</strong> ä¸å°å¿ƒæ’åˆ°åˆ«äººï¼Œå¶é‡åˆ«äºº=bump into</p><blockquote><p>Oops, I did not mean to run into you like that, sir  å“å‘€ï¼æˆ‘æ²¡æˆæƒ³è¦è¿™ä¹ˆç¢°åˆ°ä½ çš„ï¼Œå¯¹ä¸èµ·ï¼Œå…ˆç”Ÿã€‚</p></blockquote></li><li><p><strong>school night/work night</strong></p><blockquote><p>school night æ˜æ—©è¿˜è¦ä¸Šå­¦<br>work night æ˜å¤©è¦ä¸Šç­<br>ä»¥ä¸Šä¸¤ç§å¥å‹çš„ç†è§£ï¼šä¸Šç­(ä¸Šå­¦)æœŸé—´ï¼Œä¸æ˜¯æ”¾å‡æœŸé—´ï¼Œæ™šä¸Šä¸è¦ç©ç–¯ï¼Œè¦åšå‡†å¤‡ï¼Œä¸ºäº†ç¬¬äºŒå¤©å·¥ä½œã€å­¦ä¹ <br> Is it a school night and she has a lot of homework to do?</p></blockquote></li><li><p><strong>Bring â€™em on</strong>  æ”¾é©¬è¿‡æ¥  è¿˜æƒ³è¯´ä»€ä¹ˆå°±è¯´å§</p></li><li><p><strong>girl/boy scouts</strong> ç¾å›½12å²ä»¥ä¸‹å­©å­çš„ä¸€ä¸ªreal lifeçš„é”»ç‚¼æ´»åŠ¨ï¼Œ çŒœæµ‹ç±»ä¼¼å¤ä»¤è¥ï¼Œ ä¸ºäº†ç­¹åŠæ´»åŠ¨ä¹°girl/boy scouts cookies</p></li><li><p><strong>Tell sb good luck with sth.</strong>  è¡¨ç¤ºâ€œç¥æŸäººåœ¨æŸäº‹ä¸Šæœ‰å¥½è¿â€ï¼Œå£è¯­ä¸­ç»å¸¸ä½¿ç”¨ã€‚</p><blockquote><p>A: Tom will have an exam tomorrow. æ±¤å§†æ˜å¤©æœ‰ä¸ªè€ƒè¯•ã€‚  B: Tell him good luck with that. å¸®æˆ‘ç¥ä»–å¥½è¿ã€‚</p></blockquote></li><li><p><strong>I can let it go for eight.</strong> (ç»“åˆä¸Šä¸‹æ–‡æ˜¯8000å…ƒæˆäº¤çš„æ„æ€ï¼Œ å…¶ä¸­let it goï¼Œ å¯ä»¥æƒ³è±¡å…»äº†å¥½ä¹…çš„å® ç‰©è¦èµ°äº†ï¼Œèˆä¸å¾—ï¼Œæ­¤å¤„ç†è§£ä¸ºâ€œå‹‰å¼ºæˆäº¤ï¼Œéå¸¸ä¸æƒ…æ„¿çš„è®©ä»·â€)</p></li><li><p><strong>We stand firm at $10</strong> (æˆ‘ä»¬åšå†³ä»˜åå—ï¼Œ stand firm at â€¦ åšå®š..ç«‹åœº)</p></li><li><p><strong>Iâ€™m over it</strong> (ä¸åœ¨ä¹ï¼Œæ— æ‰€è°“äº†)</p></li><li><p><strong>hold out sth</strong> ï¼ˆä¼¸å‡ºæ‰‹é‡Œçš„ä¸œè¥¿ï¼Œç›´ç›´çš„æ‹¿ç€â€¦ï¼‰</p></li><li><p><strong>Engagement ring</strong> ç»“å©šæˆ’æŒ‡</p></li><li><p><strong>poker face</strong> ï¼ˆ ä¸€æœ¬æ­£ç»çš„é¢å®¹, é¢æ— è¡¨æƒ…çš„äººï¼‰</p></li><li><p><strong>a man-to-man talk</strong> (ä¸€å¯¹ä¸€çš„ï¼Œå¦ç‡çš„,ç›´è¨€ä¸è®³çš„; ç•…æ‰€æ¬²è¨€çš„)</p></li><li><p><strong>count on sb</strong> (ä¾èµ–/æŒ‡æœ›æŸäºº)</p><blockquote><p>Donâ€™t count on me (åˆ«æŒ‡æœ›æˆ‘)<br>You can count on us (ä½ å¯ä»¥æŒ‡æœ›/ä¾èµ–æˆ‘ä»¬)</p></blockquote></li><li><p><strong>toe the line</strong> (è„šé ç€çº¿ï¼Œä¸è¦è¶Šç•Œï¼Œå¾ªè§„è¹ˆçŸ©ï¼Œéµå®ˆè§„åˆ™)</p></li><li><p><strong>thread the needle</strong> (æœ‰balanceçš„æ„æ€  ä¹Ÿæœ‰è®½åˆºè¿™ä¸ªä¸œè¥¿å¾ˆéš¾ï¼Œ â€œçº¿ç©¿é’ˆçœ¼â€)</p><blockquote><p>itâ€™s like thread the needle. (è¿™ä¸ªä¸œè¥¿å¾ˆéš¾)</p></blockquote></li><li><p><strong>think outside the box</strong> (åˆ›æ–°æ€ç»´ï¼Œæ‘†è„±æ€ç»´å®šå¼)</p></li><li><p><strong>I have bigger fish to fry</strong> (æœ‰æ›´å¤§ã€é‡è¦çš„äº‹æƒ…è¦å¤„ç†)</p><blockquote><p>é€šå¸¸ä¼šè¯´ I have bigger fish</p></blockquote></li><li><p>*<em>sb is heartless *</em> ( æŸäººæ— æƒ…æ— ä¹‰)</p></li><li><p><strong>she/he gets on one knee</strong>  ï¼ˆå•è†è·ªåœ°æ±‚å©šï¼‰</p><blockquote><p>take a knee (æ•™ç»ƒï¼šå›´èµ·æ¥å¬æ•™ç»ƒè®²è¯)</p></blockquote></li><li><p><strong>Weâ€™re engaged</strong>  æˆ‘ä»¬è®¢å©šäº†  <strong>engagement ring</strong> è®¢å©šæˆ’æŒ‡</p></li><li><p><strong>Weâ€™re dying out here!</strong>  ( æˆ‘ä»¬ç­‰å¾—å¿«æ€¥æ­»äº†ï¼)</p></li><li><p><strong>be likely to do sth.</strong> (è¡¨ç¤ºâ€œå¾ˆæœ‰å¯èƒ½åšæŸäº‹â€ï¼Œå¼ºè°ƒå¯èƒ½æ€§)</p><blockquote><p>It is likely to rain. å¥½åƒå¿«è¦ä¸‹é›¨äº†ã€‚<br>be unlikely to (ä¸å¤§å¯èƒ½ï¼Œä¸å†å‘ç”Ÿ)<br>These tactics are unlikely to be helpful to you (è¿™ç§æ–¹æ³•å¯¹ä½ æœªå¿…æœ‰ç”¨)<br>He is very ill and unlikely to recover (ä»–ç—…å¾—å¾ˆé‡ï¼Œä¸å¤§å¯èƒ½æ¢å¤å¥åº·äº†)</p></blockquote></li><li><p><strong>lose oneâ€™s temper</strong> ï¼ˆå¤±æ€ï¼‰</p></li><li><p><strong>the box that it came in</strong>  ï¼ˆåŒ…è£…çš„ç®±å­ï¼‰</p></li><li><p><strong>shake hand</strong> (æ¡æ‰‹)</p></li><li><p><strong>Parents shouldnâ€™t play favorites</strong>  ï¼ˆçˆ¶æ¯ä¸åº”åå¿ƒï¼‰</p><blockquote><p>Iâ€™m the favorite (æˆ‘æ˜¯çˆ¶æ¯å–œæ¬¢çš„é‚£ä¸€ä¸ª)</p></blockquote></li><li><p><strong>Iâ€™m kind/sort of ï¼ˆkinaï¼‰tired</strong> ï¼ˆæˆ‘æœ‰ç‚¹ç´¯ï¼Œæ¯”Iâ€™m a little bit tiredæ›´åœ°é“ï¼‰</p></li><li><p><strong>clever/smart/resourceful/competent</strong></p><blockquote><p>åœ¨ç¾å›½cleverå¸¦æœ‰â€œå°èªæ˜â€çš„æ„æ€ï¼Œä¹Ÿæœ‰æŒ‡åŠ¨ç‰©çš„èªæ˜ï¼Œ åœ¨è‹±å›½cleverå¯ä»¥æŒ‡äººçš„èªæ˜ï¼Œ æ‰€ä»¥å¤¸äººèªæ˜è¿˜æ˜¯ç”¨smartæ¯”è¾ƒåˆé€‚<br>resourceful å½¢å®¹äººæ¯”è¾ƒè¶³æ™ºå¤šè°‹ï¼Œèµ„æºåˆ†ä¸°å¯Œ<br>competent/incompetent æœ‰èƒ½åŠ›çš„å’Œæ²¡æœ‰èƒ½åŠ›çš„ å½¢å®¹äºº</p></blockquote></li><li><p>*<em>get the hell out of here *</em> ï¼ˆæ»šå‡ºå»  ä¹Ÿæœ‰å¼ºè°ƒçš„æ„æ€ï¼Œ è¦è¯»çš„å¿«å’Œåœ°é“æ‰æœ‰æ„Ÿè§‰ï¼‰</p></li><li><p><strong>check clear/bounce</strong> (å½¢å®¹æ”¯ç¥¨æ˜¯å¯ä»¥æ”¯å‡ºé’±æˆ–ä¸èƒ½æ”¯å‡ºé’±)</p></li><li><p><strong>I canâ€™t wait to see everything again!</strong> ï¼ˆ æˆ‘éƒ½ç­‰ä¸åŠè¦å†æ¬¡çœ‹åˆ°å®ƒä»¬äº†ï¼ï¼‰</p><blockquote><p>canâ€™t wait to do sth.è¡¨ç¤ºâ€œè¿«ä¸åŠå¾…è¦åšæŸäº‹â€ï¼Œå£è¯­ä¸­çš„ä½¿ç”¨é¢‘ç‡å¾ˆé«˜ã€‚</p></blockquote></li><li><p><strong>canâ€™t/couldnâ€™t help doing sth.</strong> (æƒ…ä¸è‡ªç¦åšæŸäº‹)</p><blockquote><p>I canâ€™t help laughing. (æˆ‘å¿ä¸ä½å¤§ç¬‘)</p></blockquote></li><li><p><strong>hit å¸¸ç”¨çŸ­è¯­æ€»ç»“ï¼š</strong></p><blockquote><ol><li>hit on sb (æ’©å¦¹ï¼Œæ³¡å¦) â€”â€” Cindy never realizes when boys  are hitting on her(Cindy æ€»æ˜¯æµ‘ç„¶ä¸çŸ¥æœ‰ç”·ç”Ÿåœ¨è¿½å¥¹)</li><li>hit on sth (çµæœºä¸€åŠ¨æƒ³åˆ°sth) â€”â€” He hit on an idea that would be a perfect surprise (ä»–çµæœºä¸€åŠ¨ï¼Œæƒ³åˆ°äº†å®Œç¾çš„ç”Ÿæ—¥è¶´ä½“æƒŠå–œ)</li><li>hit smw (ä¸Šè·¯å»å“ª) â€”â€” Letâ€™s hit the road after staying here for a night (æˆ‘ä»¬åœ¨è¿™å‘†ä¸€æ™šå°±ä¸Šè·¯å§)</li><li>hit the sack/hay (å°±å¯ã€ç¡è§‰) â€”â€” Tina was so tired that she hit the sack soon after long hours works ï¼ˆTina å®åœ¨æ˜¯å¤ªç´¯äº†ï¼Œé•¿æ—¶é—´å·¥ä½œä»¥åæ—©æ—©ç¡è§‰å»äº†ï¼‰</li><li>hit the nail[æŒ‡ç”²ã€é’‰å­] (è¯´è¯ä¸­è‚¯ï¼Œä¸€é’ˆè§è¡€) â€”â€” He always hit the nail on the head so all people found him extremly reliable ï¼ˆä»–è¯´è¯æ€»æ˜¯ä¸€é’ˆè§è¡€ï¼Œæ‰€æœ‰äººéƒ½è§‰å¾—ä»–å¾ˆé è°±ï¼‰</li><li>hit the jackpot (ä¸­å¤´å½©) â€”â€” Jocelin is the perfect girl for me, Iâ€™ve hit the jackpot in life being with her (Jocelinæ˜¯æˆ‘çš„çœŸå‘½å¤©å¥³ï¼Œèƒ½å’Œå¥¹åœ¨ä¸€èµ·çœŸæ˜¯æˆ‘è¿™è¾ˆå­æœ€å¤§çš„ç¦åˆ†)</li><li>hit it off well (ä¸€æ‹å³åˆ) â€”â€” We all thought the two of you would hit it off well ï¼ˆæˆ‘ä»¬å¤§å®¶éƒ½è®¤ä¸ºä½ ä»¬ä¼šç›¸å¤„æ„‰å¿«ï¼‰</li><li>hit the bottle (é…—é…’) â€”â€” He started to hit the bottle to relieve stress. (ä»–å¼€å§‹ç”¨é…—é…’æ¥é‡Šæ”¾å‹åŠ›)</li><li>hit the light (å¼€ç¯) â€”â€” Would you please hit the light for me? ï¼ˆè¯·é—®ä½ å¯ä»¥å¸®æˆ‘å¼€ä¸€ä¸‹ç¯ä¹ˆï¼Ÿï¼‰</li><li>hit the big (åšåˆ°ï¼ŒæˆåŠŸ) â€”â€” We hit the big (æˆ‘ä»¬æˆåŠŸäº†)</li><li>hit the book (å•ƒä¹¦ï¼Œç”¨å·¥è¯»ä¹¦) â€”â€” I got an exam tomorrow. so I got to hit the books tonight. ï¼ˆæˆ‘æ˜å¤©æœ‰ä¸ªè€ƒè¯•ï¼Œä»Šæ™šæˆ‘è¦å¿µä¹¦å‘¢ï¼‰</li><li>hit the roof (æš´è·³å¦‚é›·ï¼Œå¤§æ€’) â€”â€” My parents would hit the roof if he knew that I wrecked his car ï¼ˆå¦‚æœæˆ‘çˆ¸å‘ç°æˆ‘æ¯äº†ä»–çš„è½¦ï¼Œä¸€å®šä¼šæš´è·³å¦‚é›·çš„ï¼‰</li><li>hit me (åœºæ™¯ï¼š å¯¹é…’å§è°ƒé…’å¸ˆè¯´hit me, æŒ‡å†æ¥ä¸€æ¯)</li></ol></blockquote></li><li><p>*<em>ground rules = basic rule *</em> (åŸºæœ¬è§„åˆ™)</p><blockquote><p>Are there ground rules (æœ‰ä»€ä¹ˆåŸºæœ¬çš„è§„åˆ™å—ï¼Ÿ å¦‚åœ¨ç©æ¸¸æˆå‰åšå¥½è§„åˆ™)</p></blockquote></li><li><p><strong>Iâ€™m just saying</strong> (A: youâ€™re so handsome, Iâ€™m just saying. ä¸ºäº†é¿å…å°´å°¬çš„å±€é¢ï¼Œå¯ä»¥è¯´Iâ€™m just saying.)</p></li><li><p><strong>He really told her off</strong> (ä»–è‡­éª‚äº†å¥¹ä¸€é¡¿)</p></li><li><p><strong>shave a head</strong> (ç†å‘)</p></li><li><p>*<em>on top of *</em> (å¹¶ä¸” å¦å¤–)</p></li><li><p>*<em>reduce anxiety *</em> (å‡å°‘ã€é™ä½ç„¦è™‘ï¼Œæ³¨æ„åŠ¨è¯çš„ä½¿ç”¨)</p></li><li><p><strong>fixate on sth</strong> (æèµ·sth)</p><blockquote><p>Why does everyone keep fixating on that? (ä¸ºä»€ä¹ˆå¤§å®¶éƒ½ç»•ç€è¿™ä¸ªè¯é¢˜æ‰“è½¬ï¼Ÿ )</p></blockquote></li><li><p>*<em>of course it was a line *</em> (æ˜¾ç„¶è¿™æ˜¯éª—ä½ çš„)</p></li><li><p><strong>live off</strong> (ä»¥â€¦ä¸ºé£Ÿæ–™ï¼›é â€¦ç”Ÿæ´»ï¼›ä½åœ¨â€¦ä¹‹å¤–)</p><blockquote><p>You canâ€™t live off your parents all the time (ä½ ä¸èƒ½ä¸€ç›´é ä½ çˆ¶æ¯ç”Ÿæ´»)</p></blockquote></li><li><p><strong>æ˜¯ï¼ˆisï¼‰, æœ‰ï¼ˆthere beï¼‰, æ—¶ï¼ˆwhenï¼‰</strong>  (ä¸‡èƒ½è½¬æ¢)</p></li><li><p><strong>loudly å’Œ loud çš„åŒºåˆ«</strong></p><blockquote><p>loudly æœ‰åµé—¹çš„å£°éŸ³å¤§çš„æ„Ÿè§‰<br>speak loud and clear</p></blockquote></li><li><p><strong>ä¸ºæŸäººæ”¯ä»˜è´¹ç”¨</strong></p><blockquote><p>cover for you (æš‚æ—¶å¸®ä½ ä»˜ï¼Œå›å¤´ä½ éœ€è¦å½’è¿˜) I forgot my wallet, can you cover me?  (æˆ‘å¿˜è®°å¸¦é’±åŒ…äº†ï¼Œèƒ½å…ˆä¸´æ—¶å¸®æˆ‘ä»˜ä¸€ä¸‹å—ï¼Ÿ)<br>pay for you (å¸®ä½ ä»˜ï¼Œä¸éœ€è¦ä½ è¿˜)</p></blockquote></li><li><p><strong>She gives him a withering look</strong>  ï¼ˆå¥¹ç”¨ä¸€ä¸ªç»æœ›æˆ–å¤±æœ›çš„çœ¼ç¥çœ‹äº†ä»–ä¸€çœ¼ï¼‰</p></li><li><p><strong>You had one job</strong> (å°±è®©ä½ å¹²äº†ä¸€ä»¶äº‹è¿˜å¹²ä¸å¥½çš„æ„æ€)</p></li><li><p>*<em>beyond oneâ€™s grasp, beyond oneâ€™s capatibility , out of reach, out of control åŒºåˆ« *</em></p><blockquote><p>beyond oneâ€™s grasp (é­é•¿è«åŠï¼Œæœ‰èƒ½åŠ›ï¼Œä½†æ˜¯è¿œæ°´è§£ä¸äº†è¿‘æ¸´çš„æ„Ÿè§‰) I canâ€™t help him because itâ€™s beyond my grasp<br>beyond oneâ€™s capatibility (è¶…å‡ºæŸäººçš„èƒ½åŠ›èŒƒå›´) The work is difficult and beyond my capatibility (å·¥ä½œå¤ªéš¾è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›èŒƒå›´ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¯´ itâ€™s beyond me)<br>out of reach (æŒ‡ç©ºé—´è·ç¦»çš„ä¸èƒ½åŠ) Iâ€™m in BJï¼Œ teaching in SH is out of reach<br>out of control (æŸç‰©ä¸å¯æ§) The fire is out of control (å¤§ç«å¤±å»äº†æ§åˆ¶)</p></blockquote></li><li><p><strong>a family of three</strong> (ä¸‰å£ä¹‹å®¶)</p></li><li><p>*<em>have yet to do sth *</em> (used for saying that something has not happened or been done up to the present time, especially when you think it should have happened or been done)</p><blockquote><p>As for accommodation, the resort has yet to announce the price of a stay in its hotel rooms. (è‡³äºè†³å®¿ï¼Œåº¦å‡èƒœåœ°è¿˜æ²¡æœ‰å…¬å¸ƒé…’åº—çš„è´¹ç”¨)</p></blockquote></li><li><p><strong>trial run/flight/version</strong> (è¯•è¿è¡Œ/è¯•é£/è¯•ç”¨ç‰ˆæœ¬)</p></li><li><p><strong>turn over in oneâ€™s mind</strong> (Think about something thoroughly)</p><blockquote><p>My father gave me some advice that Iâ€™ve been turning over in my mind ever since (æˆ‘çˆ¶äº²æ•™å¯¼è¿‡æˆ‘ä¸€å¥è¯ï¼Œæˆ‘è‡³ä»Šè¿˜å¿µå¿µä¸å¿˜)</p></blockquote></li><li><p><strong>web celebrity</strong> (ç½‘çº¢ï¼Œ celebrityä¹Ÿå¯ä»¥æŒ‡åå£°åæ°”)</p></li><li><p>*<em>You have got to do sth *</em>  (å¼ºçƒˆå»ºè®®åšæŸäº‹ï¼Œ got è¦åŠ é‡éŸ³)</p><blockquote><p>Youâ€™ve got to try this.</p></blockquote></li><li><p><strong>Iâ€™m not that much of â€¦</strong> (æˆ‘è¿˜æ²¡é‚£ä¹ˆâ€¦,è¿˜æ²¡åˆ°..ç¨‹åº¦ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§è°¦è™šçš„è¯´æ³•)</p><blockquote><p>Iâ€™m not that much of an artist<br>Iâ€™m not that much of a sweet tooth (æˆ‘ä¸é‚£ä¹ˆå–œæ¬¢åƒç”œé£Ÿ)</p></blockquote></li><li><p><strong>This is the best sth/sb I have ever done</strong></p><blockquote><p>This is the best radio show I have ever listened to.<br>This is the best movie I have ever seen</p></blockquote></li><li><p><em>Sth is addressed to you*</em> (sthæ˜¯é‚®å¯„ç»™ä½ çš„)</p><blockquote><p>This is not addressed to you (è¿™ä¸æ˜¯é‚®å¯„ç»™ä½ çš„)<br>æ³¨æ„åè¯åŠ¨è¯çš„è¯»éŸ³åŒºåˆ† vt. æ¼”è¯´ï¼›ä»äº‹ï¼›å¿™äºï¼›å†™å§“ååœ°å€ï¼›å‘â€¦è‡´è¾ï¼›ä¸â€¦è¯´è¯ï¼›æå‡ºï¼›å¤„ç†   n. åœ°å€ï¼›æ¼”è®²ï¼›è‡´è¾ï¼›è¯´è¯çš„æŠ€å·§ï¼›ç§°å‘¼</p></blockquote></li><li><p><strong>send away</strong></p><blockquote><p>send away for sth (request another sth) æƒ³è±¡â€œè®©å¿«é€’å°å“¥é€è¿‡æ¥sthâ€</p></blockquote></li><li><p>** Iâ€™ll be right with you.** (ç­‰ç­‰ï¼Œæˆ‘é©¬ä¸Šå°±æ¥)</p><blockquote><p>Wait a few minutes and Iâ€™ll be right with you. (è¯·ç­‰ä¸€ä¸‹ï¼Œæˆ‘é©¬ä¸Šå°±æ¥)</p></blockquote></li><li><p><strong>sink oneâ€™s teeth into sth/sb</strong></p><blockquote><ul><li><strong>bite to sth/sb</strong><br>I canâ€™t wait to sink my teeth into that delicious-looking dessert(é¤åç”œç‚¹) you made<br>The dog sunk his teeth into the little boyâ€™s arm.</li><li><strong>get a chance to do something energetically or productively</strong><br>I want to give the students a project they can really sink their teeth into.<br>Iâ€™m so bored at work. I would like something I can sink my teeth into.</li></ul></blockquote></li><li><p><strong>first-tier city</strong> (ä¸€çº¿åŸå¸‚)</p></li><li><p><strong>take sb/sth for granted</strong> (æŠŠâ€¦å½“æˆç†æ‰€å½“ç„¶)</p><blockquote><p>So many of us take clean water for granted.<br>Children often take their parents for granted.</p></blockquote></li><li><p><strong>slow motion hair shake</strong> (æ…¢åŠ¨ä½œç”©å¤´å‘)</p></li><li><p><strong>Itâ€™s a running gag</strong> ï¼ˆä¸åœå‡ºç°çš„ç¬‘ç‚¹ï¼‰</p><blockquote><p>gag me (short for gag me with a spoon)</p><ul><li>Shit i have so much homework. Gag meee! (æ€äº†æˆ‘å§ï¼Œæ¶å¿ƒæ­»æˆ‘å§)</li></ul></blockquote></li><li><p><strong>stare at sb</strong> ( ç›¯ç€æŸäººçœ‹ï¼Œ  ä¸æ˜¯å¾ˆç¤¼è²Œçš„è¡Œä¸º)</p><blockquote><p>Donâ€™t stare</p></blockquote></li><li><p><strong>wafer thin ice</strong>  (å¾ˆå±é™©äº†)</p><blockquote><p>youâ€™re standing on thin ice  ï¼ˆä½ å¾ˆå±é™©äº†ï¼Œâ€œåˆ«å˜šç‘Ÿäº†ï¼Œå†è§¦ç¢°åº•çº¿å°±æ­»å®šäº†â€ï¼‰</p></blockquote></li><li><p><strong>sth rules</strong> (sthå¾ˆç»™åŠ›ï¼ŒæŒ‡å¾ˆè¿‡ç˜¾)</p><blockquote><p>movie rules / water rules</p></blockquote></li><li><p>*<em>leg warms *</em> (ç§‹è£¤)</p></li><li><p><strong>You shush</strong> ï¼ˆä½ é—­å˜´å§ï¼‰</p><blockquote><p>å£è¯­ä¸­ï¼ŒYou shushæˆ–è€…Shushçš„ä½¿ç”¨é¢‘ç‡å¾ˆé«˜ï¼Œè¯´è¯è€…ç”¨æ¥è®©å¯¹æ–¹â€œé—­å˜´â€æˆ–è€…â€œå®‰é™ä¸€ä¸‹<br>Shush! I want to hear the weather. (å®‰é™ï¼æˆ‘è¦å¬å¤©æ°”é¢„æŠ¥)<br>Shush! Here he comes. Iâ€™ll talk to you later. (å˜˜ï¼ä»–æ¥äº†ã€‚æˆ‘ä¸€ä¼šå„¿å†è·Ÿä½ è¯´)<br>Donâ€™t shush me. (è®©å¯¹æ–¹å®‰é™çš„æ„æ€)<br><strong>æ³¨æ„ï¼š</strong> Shushä¸Shut upæ‰€è¡¨è¾¾çš„å«ä¹‰ç›¸åŒï¼Œä½†Shushçš„è¯­æ°”æ¯”è¾ƒå§”å©‰å’Œå®¢æ°”ï¼Œè€ŒShut upåˆ™æ¯”è¾ƒç²—é²ï¼Œä¸€èˆ¬æ˜¯æ€¥äº†çš„æƒ…å†µä¸‹ç”¨è¿™ç§è¡¨è¾¾æ¥è®©å¯¹æ–¹â€œä½å£â€</p></blockquote></li><li><p>*<em>one hit wonder *</em> (one hit wonderï¼ŒæŒ‡ä»£ä¸€ä¸ªæ­Œæ‰‹æˆ–è€…ç»„åˆåªæœ‰ä¸€é¦–æˆåŠŸçš„å•æ›²)</p><blockquote><p>There are lots of singers are one hit wonder</p></blockquote></li><li><p><strong>tell each other secrets</strong> (äº’ç›¸æ­ç©¿ç§˜å¯†)</p></li><li><p><strong>freshman sophomore junior senior</strong> (å¤§ä¸€å¤§äºŒå¤§ä¸‰å¤§å››)</p></li><li><p>*<em>valley girl *</em> ï¼ˆè¯´è¯å£°éŸ³æ¯”è¾ƒå¤§ï¼Œæ¯”è¾ƒå…´å¥‹çš„å¥³å­©ï¼Œä¼šè®©å‘¨å›´çš„äººè§‰å¾—å¾ˆåµ ï¼‰</p></li><li><p><strong>è‹±è¯­ä¸­æ²¡æœ‰å­¦å“¥å°å¦¹ï¼Œåªéœ€è¦è¯´æ¥è‡ªåŒä¸€ä¸ªå­¦æ ¡å°±å¯ä»¥äº†ï¼Œ he was my friend from college æˆ–è€… alumni /É™â€™lÊŒmnaÉª/ æ ¡å‹</strong></p></li><li><p><strong>to make matters worse</strong> (æ›´ç³Ÿç³•çš„æ˜¯)</p></li><li><p><strong>tough cookie = a difficult people</strong> (éš¾ç›¸å¤„çš„äºº)</p></li><li><p><strong>wedding vows</strong> ï¼ˆvery serious promiseï¼Œ ç°åœ¨å¤šæ•°åœ¨ç»“å©šæ—¶å€™ç”¨äº†ï¼‰  å©šå§»èª“è¯</p></li><li><p><strong>flash back episode</strong> (å›é¡¾ç‰‡æ®µ  ç”µå½±ä¸­çš„å›å¿†ç‰‡æ®µ)</p></li><li><p>*<em>steal oneâ€™s thunder *</em> (æŠ¢äº†è°çš„é£å¤´)</p></li><li><p><strong>Your roof, your rules</strong> (ä½ çš„åœ°ç›˜ä½ åšä¸»)</p></li><li><p><strong>a blessing in disguise</strong> (å¡ç¿å¤±é©¬ï¼Œå› ç¥¸å¾—ç¦)</p></li><li><p><strong>word on the street</strong> (å°é“æ¶ˆæ¯)</p></li><li><p>*<em>second mother tongue *</em> ï¼ˆç¬¬äºŒæ¯è¯­ï¼‰</p></li><li><p><strong>serve for sth</strong> ï¼ˆæœåŠ¡../ç”¨æ¥åš..ï¼‰</p></li><li><p><strong>show off</strong> (ç‚«è€€ï¼Œæ˜¾æ‘†)</p></li><li><p><strong>Reading makes a full man; conference a ready man;and writing an exact man</strong> (è¯»ä¹¦ä½¿äººå……å®ï¼›äº¤è°ˆä½¿äººæœºæ•ï¼›ç¬”è®°ä½¿äººç²¾ç¡®)</p></li><li><p><strong>learn from the past</strong> (ä»å†å²/è¿‡å»ä¸­å­¦ä¹ )</p></li><li><p><strong>Those are way too expensive</strong> (way too + adj å¤ªâ€¦)</p></li><li><p><strong>Heâ€™s a pushover</strong> (ä»–æ˜¯ä¸€ä¸ªå®¹æ˜“è¢«æŒæ§ä½¿å”¤çš„äºº)</p></li><li><p><strong>Heâ€™s a buzzkill</strong> (ä»–æ˜¯ä¸€ä¸ªæ‰«å…´çš„äºº)</p></li><li><p><strong>iâ€™m not doing it/sth</strong> (æ­£åœ¨å¦è®¤ä¸åšä»€ä¹ˆ)</p></li><li><p><strong>Iâ€™m not returning them, youâ€™ll see</strong> (youâ€™ll see ç­‰ç€çœ‹å§ï¼Œå°¾è¯­)</p></li></ol><h3 id="æˆè¯­çŸ­è¯­æ€»ç»“"><a href="#æˆè¯­çŸ­è¯­æ€»ç»“" class="headerlink" title="æˆè¯­çŸ­è¯­æ€»ç»“"></a>æˆè¯­çŸ­è¯­æ€»ç»“</h3><ol><li><p><strong>ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€</strong> &lt;â€”â€”&gt; <strong>ç»å‰é¡¾å</strong></p><blockquote><p><strong>rain or shine</strong> &lt;â€”â€”&gt; <strong>take a look around</strong></p><ul><li>You have to carry out(è´¯å½»ï¼Œæ‰§è¡Œ) your plan, rain or shine.</li><li>Buddy, just keep goingï¼Œ Iâ€™ll be along with you, rain or shine.</li><li>If you take a look around, you will miss a lot of oppotunities that were supposed to belong to you.</li></ul></blockquote></li><li><p><strong>ä¸å¯’è€Œæ —</strong></p><blockquote><p><strong>Make oneâ€™ s teeth chatter(ä½¿å¡å—’å¡å—’ä½œå£°). Make oneâ€™s flesh(è‚‰ä½“) creep</strong></p><ul><li>The mysterious /mÉªâ€™stÉªrÉªÉ™s/ sound in the dark made Lilyâ€™s teeth chatter.</li><li>The news that fake vaccines were being sold to different provinces in China made my teeth chatter.</li></ul></blockquote></li><li><p><strong>ä¸å¯æ•‘è¯</strong> &lt;â€”â€”&gt; <strong>å¾®æ„Ÿä¸é€‚</strong></p><blockquote><p><strong>beyond remedy(è¡¥æ•‘ï¼Œæ²»ç–—ï¼Œèµ”å¿)</strong> &lt;â€”â€”&gt; <strong>To feel off color</strong></p><ul><li>Robertâ€™s laziness is beyond remedy.</li><li>Tom feels off color</li></ul></blockquote></li><li><p><strong>ä¸å¯åŒæ—¥è€Œè¯­</strong> &lt;â€”â€”&gt; <strong>ç›¸æå¹¶è®º</strong></p><blockquote><p><strong>canâ€™t be mentioned on the same day</strong> &lt;â€”â€”&gt; <strong>place on par</strong></p><ul><li>Johnâ€™s idea is different from Jeanâ€™s, they canâ€™t be mentioned on the same day.</li><li>Both of things can not be placed on par.</li></ul></blockquote></li></ol><h3 id="ç”Ÿè¯è¡¨"><a href="#ç”Ÿè¯è¡¨" class="headerlink" title="ç”Ÿè¯è¡¨"></a>ç”Ÿè¯è¡¨</h3><table><thead><tr><th align="left">åºå·</th><th align="left">å•è¯</th><th align="left">éŸ³æ ‡</th><th align="left">è¯æ€§å’Œè§£é‡Š</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">ditch</td><td align="left">/dÉªtÊƒ/</td><td align="left">vt. åœ¨â€¦ä¸Šæ˜æ²Ÿï¼›æŠŠâ€¦å¼€å…¥æ²Ÿé‡Œï¼›ä¸¢å¼ƒ n. æ²Ÿæ¸ ï¼›å£•æ²Ÿ</td></tr><tr><td align="left">2</td><td align="left">custod</td><td align="left">/â€˜kÊŒstÉ™di/</td><td align="left">n. ä¿ç®¡ï¼›ç›‘æŠ¤ï¼›æ‹˜ç•™ï¼›æŠšå…»æƒ</td></tr><tr><td align="left">3</td><td align="left">alcoholic</td><td align="left">/,Ã¦lkÉ™â€™hÉ”lÉªk/</td><td align="left">adj. é…’ç²¾çš„ï¼Œå«é…’ç²¾çš„ n. é…’é¬¼ï¼Œé…—é…’è€…</td></tr><tr><td align="left">4</td><td align="left">revelation</td><td align="left">/â€˜rÉ›vÉ™â€™leÊƒÉ™n/</td><td align="left">n. å¯ç¤ºï¼›æ­éœ²ï¼›å‡ºä¹æ„æ–™çš„äº‹ï¼›è¢«æ­éœ²çš„çœŸç›¸</td></tr><tr><td align="left">5</td><td align="left">massage</td><td align="left">/mÉ™â€™sÉ‘ËÊ’</td><td align="left">n. æŒ‰æ‘©ï¼›æ‰ vt. æŒ‰æ‘©ï¼›æ‰</td></tr><tr><td align="left">6</td><td align="left">horoscope</td><td align="left">/â€˜hÉ”rÉ™skop</td><td align="left">n. å æ˜Ÿæœ¯ï¼›æ˜Ÿè±¡ï¼›åäºŒå®«å›¾</td></tr><tr><td align="left">7</td><td align="left">nonsense</td><td align="left">/â€˜nÉ‘nsÉ›n/</td><td align="left">n. èƒ¡è¯´ï¼›åºŸè¯</td></tr><tr><td align="left">8</td><td align="left">charming</td><td align="left">/â€˜tÊƒÉ‘rmÉªÅ‹/</td><td align="left">adj. è¿·äººçš„ï¼›å¯çˆ±çš„</td></tr><tr><td align="left">9</td><td align="left">arrogant</td><td align="left">/â€˜Ã¦rÉ™É¡É™n/</td><td align="left">adj. è‡ªå¤§çš„ï¼Œå‚²æ…¢çš„</td></tr><tr><td align="left">10</td><td align="left">oops</td><td align="left">/uËps/</td><td align="left">ï¼ˆè¡¨ç¤ºæƒŠè®¶æˆ–åæ‚”ï¼‰å“å“Ÿâ€¦</td></tr><tr><td align="left">11</td><td align="left">taboo</td><td align="left">/tÉ™ËˆbuË/</td><td align="left">ç¦å¿Œ</td></tr><tr><td align="left">12</td><td align="left">dash</td><td align="left">/dÃ¦Êƒ/</td><td align="left">è¿å­—ç¬¦â€-â€œ</td></tr><tr><td align="left">13</td><td align="left">underscore</td><td align="left">/ËŒÊŒn.dÉšËˆskÉ”Ër/</td><td align="left">ä¸‹åˆ’çº¿â€_â€</td></tr><tr><td align="left">14</td><td align="left">money-oriented</td><td align="left">/ -É”Ër.i.en.tÌ¬Éªd/</td><td align="left">å¯¼å‘é’±çš„, æ³¨æ„è¿å­—ç¬¦çš„ä½¿ç”¨</td></tr><tr><td align="left">15</td><td align="left">detail-oriented</td><td align="left">/ -É”Ër.i.en.tÌ¬Éªd/</td><td align="left">å¯¼å‘ç»†èŠ‚çš„ï¼Œ æ³¨æ„è¿å­—ç¬¦çš„ä½¿ç”¨ï¼Œå¯èƒ½å‡ ç™¾å¹´åå°±æ˜¯ä¸€ä¸ªå•è¯ï¼Œä¸­é—´æ²¡æœ‰è¿å­—ç¬¦</td></tr><tr><td align="left">16</td><td align="left">alley</td><td align="left">/ ËˆÃ¦l.i/</td><td align="left">å°è¡—, å°å··ï¼Œèƒ¡åŒ, ï¼ˆå°¤æŒ‡ä¸¤è¾¹æœ‰æ ‘æˆ–çŒæœ¨çš„ï¼‰å°å¾„â€¦</td></tr><tr><td align="left">17</td><td align="left">stove</td><td align="left">/ stoÊŠv/</td><td align="left">ï¼ˆç”¨äºå–æš–çš„ï¼‰ç‚‰ï¼Œç«ç‚‰, ç‚‰ç¶â€¦</td></tr><tr><td align="left">18</td><td align="left">ramen</td><td align="left">/ËˆrÉ‘Ë.men/</td><td align="left">æ—¥å¼æ‹‰é¢ æ–¹ä¾¿é¢</td></tr><tr><td align="left">19</td><td align="left">drip-&gt;dribble</td><td align="left">/drÉªp/ /ËˆdrÉªb.É™l/</td><td align="left">æ»´å—’-&gt;æ»´æ»´ç­”ç­” frequentative form åå¤åŠ¨è¯</td></tr><tr><td align="left">20</td><td align="left">murmur</td><td align="left">/ËˆmÉË.mÉš/</td><td align="left">è½»å£°è¯´, ä½å£°è¯´ ,å–ƒå–ƒè‡ªè¯­  frequentative form åå¤åŠ¨è¯</td></tr><tr><td align="left">21</td><td align="left">jerk</td><td align="left">/dÊ’ÉœËk/</td><td align="left">ï¼ˆç¾ä¿š) foolish person è ¢äºº.é˜¿å‘†,ç¬¨ç“œ,ä¸æ‡‚ä¸–æ•… ï¼ˆé€‚åˆå¥½æœ‹å‹ä¹‹é—´ç”¨ï¼Œæœ‰ç‚¹å¹¼ç¨šï¼Œå¯çˆ±çš„æ„Ÿè§‰ï¼‰</td></tr><tr><td align="left">22</td><td align="left">seminar</td><td align="left">/Ëˆsem.É™.nÉ‘Ër/</td><td align="left">ä¸“é¢˜è®¨è®ºä¼š, ç ”è®¨ä¼šâ€¦</td></tr><tr><td align="left">23</td><td align="left">bluff</td><td align="left">/blÊŒf/</td><td align="left">ä»¥å‡è±¡æ¬ºéª—ï¼Œè’™ï¼Œå”¬</td></tr><tr><td align="left">24</td><td align="left">bury</td><td align="left">/Ëˆber.i/</td><td align="left">åŸ‹, åŸ‹è‘¬ï¼Œå®‰è‘¬, æ©åŸ‹</td></tr><tr><td align="left">25</td><td align="left">hatchet</td><td align="left">/ËˆhÃ¦tÊƒ.Éªt/</td><td align="left">å°æ–§å¤´</td></tr><tr><td align="left">26</td><td align="left">cosmetic</td><td align="left">/kÉ‘ËzËˆmetÌ¬.Éªk/</td><td align="left">adj. ç¾å®¹çš„ï¼›åŒ–å¦†ç”¨çš„ n. åŒ–å¦†å“ï¼›è£…é¥°å“</td></tr><tr><td align="left">27</td><td align="left">sentimental</td><td align="left">/â€˜sÉ›ntÉ™â€™mÉ›ntl/</td><td align="left">adj. ä¼¤æ„Ÿçš„ï¼›å¤šæ„å–„æ„Ÿçš„ï¼›æ„Ÿæƒ…ç”¨äº‹çš„ï¼›å¯“æœ‰æƒ…æ„Ÿçš„</td></tr><tr><td align="left">28</td><td align="left">bendï¼ˆè¿‡å»æ—¶bentâ€å¼¯æ›²çš„â€ï¼‰</td><td align="left">/bÉ›nd/</td><td align="left">vt. ä½¿å¼¯æ›²ï¼›ä½¿å±ˆæœï¼›ä½¿è‡´åŠ›ï¼›ä½¿æœå‘ vi. å¼¯æ›²ï¼Œè½¬å¼¯ï¼›å±ˆæœï¼›å€¾å‘ï¼›ä¸“å¿ƒäº n. å¼¯æ›²</td></tr><tr><td align="left">29</td><td align="left">daisy</td><td align="left">/â€˜deÉªzÉª/</td><td align="left">n. é›èŠï¼›èŠç§‘æ¤ç‰©ï¼›æå¥½çš„ä¸œè¥¿ adj. æå¥½çš„ï¼›ä¸Šç­‰çš„</td></tr><tr><td align="left">30</td><td align="left">tassel</td><td align="left">/â€˜tÃ¦sl/</td><td align="left">n. æµè‹ï¼›ç¼¨ï¼›ç©— vt. ç”¨æµè‹è£…é¥°ï¼›æ‘˜ä¸‹â€¦ç©—</td></tr><tr><td align="left">31</td><td align="left">step-dad, step-mom, step-brother, step-sister</td><td align="left"></td><td align="left">ç»§çˆ¶,ç»§æ¯,ç»§å…„,ç»§å¥³</td></tr><tr><td align="left">32</td><td align="left">asbestos</td><td align="left">/Ã¦zâ€™bestÉ’s    /</td><td align="left">n.çŸ³æ£‰</td></tr><tr><td align="left">33</td><td align="left">ceiling</td><td align="left">/â€˜siËlÉªÅ‹/</td><td align="left">å¤©èŠ±æ¿</td></tr><tr><td align="left">34</td><td align="left">oven</td><td align="left">/â€˜ÊŒvÉ™n/</td><td align="left">n. çƒ¤ç®±</td></tr><tr><td align="left">35</td><td align="left">bulb</td><td align="left">/bÊŒlb/</td><td align="left">n. ç”µç¯æ³¡</td></tr><tr><td align="left">36</td><td align="left">bittersweet</td><td align="left">/â€˜bÉªtÉš,swit/</td><td align="left">adj. è‹¦ä¹å‚åŠçš„ï¼›åˆè‹¦åˆç”œçš„  n. åˆè‹¦åˆç”œçš„ä¸œè¥¿ï¼›èœ€ç¾Šæ³‰</td></tr><tr><td align="left">37</td><td align="left">narcissist</td><td align="left">/nÉ‘râ€™sÉªsÉªst/</td><td align="left">n. è‡ªæˆ‘é™¶é†‰è€… è‡ªæ‹çš„äºº</td></tr><tr><td align="left">38</td><td align="left">narcissism</td><td align="left">/â€˜nÉ‘rsÉªâ€™sÉªzÉ™/</td><td align="left">n. [å¿ƒç†] è‡ªæ‹ï¼Œè‡ªæˆ‘é™¶é†‰</td></tr><tr><td align="left">39</td><td align="left">downhill</td><td align="left">/,daÊŠnâ€™hÉªl/</td><td align="left">adv. ä¸‹å¡ï¼›å‘ä¸‹ï¼›æ¯å†µæ„ˆä¸‹ adj. ä¸‹å¡çš„ï¼›å®¹æ˜“çš„ n. ä¸‹å¡ï¼›æ»‘é™</td></tr><tr><td align="left">40</td><td align="left">punchline</td><td align="left">/â€˜pÊŒntÊƒlaÉªn/</td><td align="left">n. ç¬‘ç‚¹ï¼›ç»“å°¾è­¦è¯­ï¼›å¦™è¯­å¦‚ç </td></tr><tr><td align="left">41</td><td align="left">bald</td><td align="left">/bÉ”ld/</td><td align="left">adj. ç§ƒé¡¶çš„ï¼›å…‰ç§ƒçš„ï¼›å•è°ƒçš„ï¼›æ— è£…é¥°çš„ vi. å˜ç§ƒ</td></tr><tr><td align="left">42</td><td align="left">therapy</td><td align="left">/â€˜Î¸É›rÉ™pi/</td><td align="left">n. æ²»ç–—ï¼Œç–—æ³•</td></tr><tr><td align="left">43</td><td align="left">tuition</td><td align="left">/tÊŠâ€™ÉªÊƒÉ™n/</td><td align="left">n. å­¦è´¹ï¼›è®²æˆ</td></tr><tr><td align="left">44</td><td align="left">tutor</td><td align="left">/â€˜tÊŠtÉš/</td><td align="left">vt. è¾…å¯¼ï¼›çº¦æŸ n. å¯¼å¸ˆï¼›å®¶åº­æ•™å¸ˆï¼›åŠ©æ•™ vi. å½“å®¶åº­æ•™å¸ˆï¼›ï¼ˆç¾ï¼‰åœ¨å®¶åº­æ•™å¸ˆæŒ‡å¯¼ä¸‹å­¦ä¹ </td></tr><tr><td align="left">45</td><td align="left">scooter</td><td align="left">/ËˆskuË.tÌ¬Éš/</td><td align="left">n. å•è„šæ»‘è¡Œè½¦</td></tr><tr><td align="left">46</td><td align="left">ambidextrous</td><td align="left">/â€˜Ã¦mbÉ™â€™dÉ›kstrÉ™s/</td><td align="left">n. æ—è§‚è€…</td></tr><tr><td align="left">47</td><td align="left">onlooker = spectator</td><td align="left">/â€˜É‘nlÊŠkÉš/</td><td align="left">adj. åŒæ‰‹çµå·§çš„ï¼›æ€€æœ‰äºŒå¿ƒçš„</td></tr><tr><td align="left">48</td><td align="left">vague</td><td align="left">/veÉ¡/</td><td align="left">adj. æ¨¡ç³Šçš„ï¼›å«ç³Šçš„ï¼›ä¸æ˜ç¡®çš„ï¼›æš§æ˜§çš„</td></tr><tr><td align="left">49</td><td align="left">genetics</td><td align="left">/dÊ’É™â€™nÉ›tÉªks/</td><td align="left">n. é—ä¼ å­¦</td></tr><tr><td align="left">50</td><td align="left">clumsy</td><td align="left">/â€˜klÊŒmzi/</td><td align="left">adj. ç¬¨æ‹™çš„</td></tr><tr><td align="left">51</td><td align="left">stigma</td><td align="left">/â€˜stÉªÉ¡mÉ™/</td><td align="left">n. [æ¤] æŸ±å¤´ï¼›è€»è¾±ï¼›æ±¡åï¼›çƒ™å°ï¼›ç‰¹å¾</td></tr><tr><td align="left">52</td><td align="left">gasp</td><td align="left">/É¡Ã¦sp/</td><td align="left">vi. å–˜æ°”ï¼›å–˜æ¯ï¼›æ¸´æœ› vt. æ°”å–˜åååœ°è¯´ï¼›å–˜ç€æ°”è¯´è¯ n. å–˜æ°” (å¾ˆæƒŠè®¶çš„åœºæ™¯ï¼Œå€’å¸ä¸€å£æ°”)</td></tr><tr><td align="left">53</td><td align="left">creamy</td><td align="left">/â€˜krimi/</td><td align="left">adj. å¥¶æ²¹è‰²çš„ï¼›ä¹³è„‚çŠ¶çš„ï¼›å«ä¹³è„‚çš„</td></tr><tr><td align="left">54</td><td align="left">hypocrite</td><td align="left">/â€˜hÉªpÉ™â€™krÉª/</td><td align="left">n. ä¼ªå›å­ï¼›ä¼ªå–„è€…</td></tr><tr><td align="left">55</td><td align="left">foreshadow</td><td align="left">/fÉ”rËˆÊƒÃ¦dÂ·oÊŠ/</td><td align="left">vt. é¢„ç¤ºï¼›æˆä¸ºâ€¦çš„å‰å…†ï¼Œåšé“ºå« n. é¢„å…†ï¼Œé“ºå«</td></tr><tr><td align="left">56</td><td align="left">cliche</td><td align="left">/kliËËˆÊƒeÉª/</td><td align="left">n. é™ˆè¯æ»¥è°ƒï¼›[å°åˆ·] é“…ç‰ˆï¼›é™ˆè…æ€æƒ³ adj. é™ˆè…çš„ a saying or remark that is very often made and is therefore not original and not interesting ,æƒ³è±¡å‰§æƒ…ä¸­çš„ç”©å¤´å‘å¤ªæ™®éäº†ï¼Œçƒ‚å¤§è¡—äº†</td></tr><tr><td align="left">57</td><td align="left">conversationalist</td><td align="left">/ËŒkÉ‘Ën.vÉšËˆseÉª.ÊƒÉ™n.É™l.Éªst/</td><td align="left">n. å¥è°ˆçš„äºº someone who enjoys or is good at talking with people</td></tr><tr><td align="left">58</td><td align="left">intently</td><td align="left">/ÉªnËˆtentÂ·li/</td><td align="left">adv. ä¸“å¿ƒåœ°ï¼›ä¸€å¿ƒä¸€æ„åœ°ï¼›å¿ƒæ— æ—éª›åœ° in a way that shows great attention to something</td></tr><tr><td align="left">59</td><td align="left">pathetic</td><td align="left">/pÉ™ËˆÎ¸etÌ¬.Éªk/</td><td align="left">adj. å¯æ€œçš„ï¼Œæ‚²å“€çš„ï¼›æ„Ÿä¼¤çš„ï¼›ä¹å‘³çš„</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> English </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåœ¨githubä¸Šæ­å»ºè‡ªå·±çš„åšå®¢</title>
      <link href="//p/build-github-pages-blog.html"/>
      <url>//p/build-github-pages-blog.html</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>é•¿æ—¶é—´åœ¨æŸå¹³å°ä¸Šå†™åšå®¢è®°å½•äº›ä»€ä¹ˆï¼Œä½†æ˜¯è¿‘æœŸè¯¥å¹³å°é™†é™†ç»­ç»­å‡ºç°ä¸€äº›å°é—®é¢˜ï¼Œè®©å†™åšå®¢è¿™ä¹ˆæ„‰å¿«çš„äº‹æƒ…æ€»æ˜¯å……æ–¥ç€å„ç§æ’æ›²ï¼Œç¨ç¨ä¸çˆ½ï¼Œäºæ˜¯ä¹å¼€å§‹å‡†å¤‡æ­å»ºè‡ªå·±çš„çš„åšå®¢ï¼Œé€šè¿‡æŸ¥é˜…èµ„æ–™ç”¨äº†ä¸¤å¤©æ—¶é—´åˆæ­¥æ­å»ºèµ·æ¥ï¼Œæ”¶è·é¢‡ä¸°ï¼Œæ‰€ä»¥è¶çƒ­æ‰“é“è®°å½•æ•´ä¸ªè¿‡ç¨‹ï¼Œæ­å»ºè¿‡ç¨‹å‚è€ƒäº†éå¸¸å¤šå‰è¾ˆä»¬çš„blogï¼Œå…ˆçœŸè¯šçš„é“ä¸€å£°<strong>â€œæ„Ÿè°¢â€</strong>ï¼Œæ–‡ç« æœ«å°¾ä¼šç»™å‡ºç›¸å…³çš„å‚è€ƒé“¾æ¥ã€‚å¯æ­å»ºåšå®¢çš„æ¡†æ¶å¾ˆå¤šï¼Œå‚è€ƒ<a href="http://www.chinaz.com/special/static-blog/index.html?qq-pf-to=pcqq.c2c" target="_blank" rel="noopener">é™æ€åšå®¢æ¡†æ¶å¯¹æ¯”</a>ï¼Œé€‰æ‹©ä½ çœ‹ä¸Šçœ¼çš„ï¼Œæœ¬æ–‡é€‰æ‹©<a href="https://hexo.io/docs/" target="_blank" rel="noopener">Hexo</a>ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Œæˆ‘åªèƒ½è¯´å¯¹æ¯”ä¹‹åå–œæ¬¢.</p><h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©githubå¹³å°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©githubå¹³å°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©githubå¹³å°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€‰æ‹©githubå¹³å°ï¼Ÿ</h2><p>ä¸ºä»€ä¹ˆé€‰æ‹©<strong>github</strong>å¹³å°ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä¸¤ç»„é—®é¢˜å°±å¯ä»¥å¾—åˆ°ç­”æ¡ˆäº†.</p><blockquote><p>åšå‹ä»¬æ˜¯å¦åœ¨ç¼–å†™åšå®¢çš„æ—¶å€™é‡åˆ°è¿‡ä»¥ä¸‹é—®é¢˜ï¼š</p></blockquote><blockquote><ol><li>åšå®¢å¹³å°å‡çº§ç»´æŠ¤</li><li>æ²¡æœ‰ç½‘ç»œï¼ˆæ¯”åšå®¢å‡çº§å’Œç»´æŠ¤è¿˜æƒ¨ï¼‰</li><li>ä¸å¤Ÿå®šåˆ¶åŒ–</li></ol></blockquote><hr><blockquote><p>githubä¸Šæ­å»ºè‡ªå·±çš„åšå®¢å½“ç„¶æ˜¯æœ‰å¾ˆå¤šå¥½å¤„çš„ï¼š</p></blockquote><blockquote><ol><li>å­¦ç€ç”¨githubï¼Œäº«å—githubçš„ä¾¿åˆ©ï¼Œä¸Šé¢æœ‰å¾ˆå¤šå¤§ç‰›ï¼Œçœ¼ç•Œä¼šå¼€é˜”å¾ˆå¤š</li><li>é¡ºä¾¿çœ‹çœ‹githubå·¥ä½œåŸç†ï¼Œæœ€å¥½çš„å›¢é˜Ÿåä½œæµç¨‹</li><li>è‡ªæˆ‘è®¤ä¸ºå¼€æºæ˜¯ä¸€ç§è¶‹åŠ¿ï¼Œgithubä¸Šæœ‰è‰¯å¥½çš„å¼€æºæ°›å›´ä¸ç²¾ç¥</li><li>å®šåˆ¶åŒ–çš„åšå®¢ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½æ¥åšæ›´æ”¹</li><li>å³ä¾¿ç¦»çº¿æˆ‘ä¹Ÿå¯ä»¥æŒ‰ç…§Markdownè¯­æ³•æ¥ç¼–å†™åšå®¢ï¼Œæœ‰ç½‘ç»œæ—¶ä¸Šä¼ å³å¯</li><li>ä¸€ä»½ä½¿ç”¨ Markdown æ ¼å¼æ’°å†™çš„æ–‡ä»¶åº”è¯¥å¯ä»¥ç›´æ¥ä»¥çº¯æ–‡æœ¬å‘å¸ƒï¼Œå¹¶ä¸”çœ‹èµ·æ¥ä¸ä¼šåƒæ˜¯ç”±è®¸å¤šæ ‡ç­¾æˆ–æ˜¯æ ¼å¼æŒ‡ä»¤æ‰€æ„æˆï¼Œå¯è¯»æ€§å¼º</li></ol></blockquote><h2 id="æ­å»ºè¿‡ç¨‹"><a href="#æ­å»ºè¿‡ç¨‹" class="headerlink" title="æ­å»ºè¿‡ç¨‹"></a>æ­å»ºè¿‡ç¨‹</h2><p>æŒ‰ç…§ä¸‹é¢çš„è¿‡ç¨‹é€æ­¥è¿›è¡Œï¼Œç»†å¿ƒç†è§£é¢†ä¼šï¼Œä½ ä¼šå‘ç°æ­å»ºè¿‡ç¨‹å¾ˆç®€å•, ä¸‹æ–‡éƒ½æ˜¯åœ¨Windows ç¯å¢ƒè¿›è¡Œæ­å»ºã€‚</p><h3 id="å‰æœŸå‡†å¤‡å·¥ä½œ"><a href="#å‰æœŸå‡†å¤‡å·¥ä½œ" class="headerlink" title="å‰æœŸå‡†å¤‡å·¥ä½œ"></a>å‰æœŸå‡†å¤‡å·¥ä½œ</h3><p>å®‰è£…Hexoå¾ˆç®€å•ï¼Œä½†æ˜¯éœ€è¦ä¸‹é¢ä¸¤æ ·ä¸œä¸œçš„æ”¯æŒï¼š</p><ul><li>Node.js</li><li>Git</li></ul><p>åœ¨Windows ç¯å¢ƒå®‰è£…çœŸçš„æ˜¯å¤ªç®€å•äº†ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ— è„‘<strong>ä¸‹ä¸€æ­¥</strong></p><a id="more"></a><h3 id="Hexoå®‰è£…"><a href="#Hexoå®‰è£…" class="headerlink" title="Hexoå®‰è£…"></a>Hexoå®‰è£…</h3><p>åœ¨æŸä¸ªç£ç›˜ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åé¼ æ ‡å³é”®å•å‡»<strong>ã€Git Bashã€‘</strong>, è¿›å…¥ä¸‹å›¾ï¼š<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_1_%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E5%8D%95%E5%87%BBgit_bash.png" alt="å•å‡»Git Bash"></p><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…Hexoï¼š</p><blockquote><p>$ npm install -g hexo-cli</p></blockquote><p>æŸ¥çœ‹ä¸€ä¸‹å®‰è£…çš„Hexoç‰ˆæœ¬ï¼ˆæœ¬äººå®‰è£…çš„æ˜¯3.1.1ï¼‰<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_1_%E6%9F%A5%E7%9C%8Bhexo%E7%89%88%E6%9C%AC.png" alt="æŸ¥çœ‹hexoç‰ˆæœ¬"></p><p>hexoçš„å‘½ä»¤è¦æ€ä¹ˆç”¨ï¼Ÿå¿…é¡»helpå‘½ä»¤æ¥å¸®å¿™<br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_1_hexo%20help%E5%91%BD%E4%BB%A4.png" alt="hexo helpå‘½ä»¤"></p><p>å®‰è£…å¥½åå°±éœ€è¦åˆå§‹åŒ–Hexoæ¥åˆ›å»ºé¡¹ç›®äº†</p><blockquote><p>$ hexo init</p></blockquote><p>è¯¥æ–‡ä»¶å¤¹ä¸‹ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</p><blockquote><ul><li>scaffolds è„šæ‰‹æ¶ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå·¥å…·æ¨¡æ¿</li><li>scripts å†™æ–‡ä»¶çš„jsï¼Œæ‰©å±•hexoçš„åŠŸèƒ½</li><li>source å­˜æ”¾åšå®¢æ­£æ–‡å†…å®¹</li><li>source/_drafts è‰ç¨¿ç®±</li><li>source/_posts æ–‡ä»¶ç®±</li><li>themes å­˜æ”¾çš®è‚¤çš„ç›®å½•</li><li>themes/landscape é»˜è®¤çš„çš®è‚¤</li><li>_config.yml å…¨å±€çš„é…ç½®æ–‡ä»¶</li><li>db.json é™æ€å¸¸é‡</li></ul></blockquote><p>é¡¹ç›®åˆ›å»ºå®Œæ¯•ï¼Œå°±è¦å¯åŠ¨äº†</p><blockquote><p>$ hexo server</p></blockquote><p>è¿™ä¸ªåœ°æ–¹å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ï¼Œ å› ä¸ºserveråœ¨Hexo 3çš„ç‰ˆæœ¬è¢«åˆ†ç¦»å‡ºæ¥ï¼Œéœ€è¦<a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">å•ç‹¬å®‰è£…</a>ï¼š</p><blockquote><p>$ npm install hexo-server â€“save</p></blockquote><p>è¿™æ ·é‡æ–°å¯åŠ¨å°±å¥½äº†.</p><p>è¿™æ—¶ç«¯å£4000è¢«æ‰“å¼€äº†ï¼Œæˆ‘ä»¬èƒ½è¿‡æµè§ˆå™¨æ‰“å€ï¼Œ<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a><br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_1_hexo%E9%BB%98%E8%AE%A4%E4%B8%BB%E9%A2%98.png" alt="hexoé»˜è®¤ä¸»é¢˜"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ¥åˆ›å»ºæ–°pageæ¥å†™åšå®¢äº†</p><blockquote><p>$ hexo new myNewPage</p></blockquote><p>åˆ›å»ºå¥½myNewPage.mdæ–‡ä»¶ä¼šè‡ªåŠ¨æ”¾åœ¨<strong>source/_posts</strong>ç›®å½•ä¸‹ï¼Œç”Ÿæˆçš„mdåç¼€çš„æ–‡ä»¶éœ€è¦é‡‡ç”¨<a href="http://www.appinn.com/markdown/#philosophy" target="_blank" rel="noopener">Markdown</a>è¿›è¡Œç¼–å†™ï¼Œç„¶ååˆ·æ–°é¡µé¢ï¼Œä½ å°±ä¼šå‘ç°ä½ çš„æ–°æ–‡ç« äº†ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹å°æ¿€åŠ¨ï¼Œè¿˜æœ‰æ›´å¥½çš„ï¼Œå¾€ä¸‹çœ‹ã€‚</p><h3 id="æ›´æ”¹Hexoä¸»é¢˜"><a href="#æ›´æ”¹Hexoä¸»é¢˜" class="headerlink" title="æ›´æ”¹Hexoä¸»é¢˜"></a>æ›´æ”¹Hexoä¸»é¢˜</h3><p>å®‰è£…å¥½çš„Hexoæˆ‘ä»¬éƒ½æ˜¯ä¸€æ ·çš„åœ¨<strong>source/themes</strong>é»˜è®¤ä¸»é¢˜<strong>landscape</strong>, æ˜¯ä¸æ˜¯è§‰å¾—ä¸å¤Ÿçˆ½ï¼Œ é‚£å°±<a href="https://github.com/hexojs/hexo/wiki/Themes" target="_blank" rel="noopener">é€‰æ‹©ä¸»é¢˜</a>, è¿™é‡Œé¢åº”è¯¥æœ‰ä½ æƒ³è¦çš„é‚£ä¸€æ¬¾å§ã€‚</p><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤å°†é€‰å¥½çš„ä¸»é¢˜cloneåˆ°è‡ªå·±çš„hexoç©ºé—´</p><blockquote><p>$ git clone <a href="https://github.com/A-limon/pacman.git" target="_blank" rel="noopener">https://github.com/A-limon/pacman.git</a> themes/pacman</p></blockquote><p>è¿™æ ·ä½ ä¼šå‘ç°pacmanè¿™ä¸ªä¸»é¢˜å°±åœ¨ä½ çš„themesæ–‡ä»¶ä¸‹äº†ï¼Œæƒ³è®©è‡ªå·±åšå®¢æŒ‡å®šä¸»é¢˜ï¼Œåªéœ€è¦ä¿®æ”¹hexoçš„ä¸»é¢˜æ–‡ä»¶_config.yml ä¸­çš„themeå±æ€§å³å¯</p><blockquote><p>theme: pacman</p></blockquote><p>é‡æ–°å¯åŠ¨ï¼Œåˆ·æ–°ä½ çš„é¡µé¢ï¼Œä¸»é¢˜å˜äº†å§ã€‚</p><h3 id="é…ç½®å’Œä½¿ç”¨Github"><a href="#é…ç½®å’Œä½¿ç”¨Github" class="headerlink" title="é…ç½®å’Œä½¿ç”¨Github"></a>é…ç½®å’Œä½¿ç”¨Github</h3><p>æˆ‘ä»¬å¦‚ä½•è®©æœ¬åœ°gité¡¹ç›®ä¸è¿œç¨‹çš„githubå»ºç«‹è”ç³»å‘¢ï¼Ÿç”¨<strong>SSH keys</strong><br>å¼€å§‹èœå•å¤„å•å‡»ã€Git Bashã€‘**</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ£€æŸ¥ä½ ç”µè„‘ä¸Šç°æœ‰çš„ssh keyï¼š</p><blockquote><p>$ cd ~/.ssh</p></blockquote><p>å¦‚æœæç¤ºï¼šNo such file or directory è¯´æ˜ä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨gitï¼Œ æ¥ä¸‹æ¥éœ€è¦ç”Ÿæˆ<strong>SSH keys</strong></p><blockquote><p>$ ssh-keygen -t rsa -C â€œé‚®ä»¶åœ°å€@youremail.comâ€<br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/Users/your_user_directory/.ssh/id_rsa):&lt;å›è½¦å°±å¥½&gt;</p></blockquote><p><strong>æ³¨æ„:</strong> æ­¤å¤„çš„é‚®ç®±åœ°å€ï¼Œä½ å¯ä»¥è¾“å…¥è‡ªå·±çš„é‚®ç®±åœ°å€ï¼›æ³¨æ„2: æ­¤å¤„çš„ã€Œ-Cã€çš„æ˜¯å¤§å†™çš„ã€ŒCã€</p><p>ç³»ç»Ÿè¦æ±‚è¾“å…¥å¯†ç å’Œç¡®è®¤å¯†ç ï¼š</p><blockquote><p>$ Enter passphrase (empty for no passphrase):&lt;è¾“å…¥åŠ å¯†ä¸²&gt;<br>$ Enter same passphrase again:&lt;å†æ¬¡è¾“å…¥åŠ å¯†ä¸²&gt;</p></blockquote><p>æœ€åçœ‹åˆ°ä¸‹é¢ç•Œé¢å°±ç”Ÿæˆäº†<strong>SSH keys</strong><br><img src="http://7xkyc7.com1.z0.glb.clouddn.com/blog_1_%E7%94%9F%E6%88%90sshkey.png" alt="ç”Ÿæˆsshkey"></p><p>æŒ‰ç…§logæç¤ºæ‰¾åˆ°id_rsa.pubæ–‡ä»¶ï¼Œå¤åˆ¶é‡Œé¢çš„å†…å®¹ï¼Œç„¶åå°†<strong>SSH keys</strong>æ·»åŠ åˆ°githubä¸Šï¼Œç™»é™†githubç³»ç»Ÿã€‚ç‚¹å‡»å³ä¸Šè§’çš„ Account Settingsâ€”-&gt;SSH Public keys â€”-&gt; add another public keys</p><p>å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æ¥è¿›è¡Œæµ‹è¯•æ˜¯å¦æˆåŠŸ</p><blockquote><p>$ ssh -T <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a></p></blockquote><p>ç°åœ¨ä½ å·²ç»å¯ä»¥é€šè¿‡SSHé“¾æ¥åˆ°GitHubäº†ï¼Œè¿˜æœ‰ä¸€äº›ä¸ªäººä¿¡æ¯éœ€è¦å®Œå–„çš„ã€‚</p><p>Gitä¼šæ ¹æ®ç”¨æˆ·çš„åå­—å’Œé‚®ç®±æ¥è®°å½•æäº¤ã€‚GitHubä¹Ÿæ˜¯ç”¨è¿™äº›ä¿¡æ¯æ¥åšæƒé™çš„å¤„ç†ï¼Œè¾“å…¥ä¸‹é¢çš„ä»£ç è¿›è¡Œä¸ªäººä¿¡æ¯çš„è®¾ç½®ï¼ŒæŠŠåç§°å’Œé‚®ç®±æ›¿æ¢æˆä½ è‡ªå·±çš„ï¼Œåå­—å¿…é¡»æ˜¯ä½ çš„çœŸåï¼Œè€Œä¸æ˜¯GitHubçš„æ˜µç§°ã€‚</p><blockquote><p>$ git config â€“global user.name â€œyour nameâ€<br>$ git config â€“global user.email  â€œ<a href="mailto:username@gmail.com" target="_blank" rel="noopener">username@gmail.com</a>â€œ</p></blockquote><p>è‡³æ­¤<strong>SSH keys</strong>è®¾ç½®æˆåŠŸ</p><h3 id="å‘å¸ƒåšå®¢åˆ°Github"><a href="#å‘å¸ƒåšå®¢åˆ°Github" class="headerlink" title="å‘å¸ƒåšå®¢åˆ°Github"></a>å‘å¸ƒåšå®¢åˆ°Github</h3><p>æˆ‘ä»¬çš„ç»ˆæç›®æ ‡æ˜¯å°†åšå®¢å‘å¸ƒåˆ°githubä¸Šï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦æœ‰ä¸€äº›å‡†å¤‡å·¥ä½œè¦åšã€‚åœ¨githubä¸Šæ–°å»ºusername.github.ioçš„repositoryï¼Œè‡³äºä¸ºä»€ä¹ˆè¯·å‚è€ƒ<a href="https://pages.github.com/" target="_blank" rel="noopener">github pages</a></p><p>æœ¬åœ°æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹å³é”®å•å‡»<strong>ã€Git Bashã€‘</strong> æ‰§è¡Œå‘½ä»¤</p><blockquote><p>$ git clone <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:username/username.github.io.git</p></blockquote><p>è¿™æ ·å°±åœ¨æœ¬åœ°ç”Ÿæˆäº†è‡ªå·±çš„repository</p><p>æ€æ ·å‘å¸ƒåˆ°githubä¸Šå»ï¼Œæˆ‘ä»¬åŒæ ·è¦ä¿®æ”¹hexoä¸‹çš„_config.ymlæ–‡ä»¶ï¼Œåœ¨æœ€ådeploymentå¤„å¢åŠ è¿™æ ·ä¸¤è¡Œ</p><blockquote><p>deploy:<br>type: github<br>repo: <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:username/username.github.io.git</p></blockquote><p>ç„¶åæ‰§è¡Œå‘½ä»¤è¿›è¡Œé™æ€åŒ–ï¼Œå°†æ‰€æœ‰æ–‡ä»¶é™æ€åŒ–åˆ°publicæ–‡ä»¶å¤¹ä¸‹</p><blockquote><p>$ hexo generate</p></blockquote><p>ç„¶åè¿›è¡Œéƒ¨ç½²</p><blockquote><p>$ hexo deploy</p></blockquote><p>è¿™ä¸ªåœ°æ–¹å¯èƒ½åˆé‡åˆ°é—®é¢˜äº†ï¼Œæç¤ºã€hexo ERROR Deployer not found: githubã€‘ï¼ŒåŒæ ·æ˜¯3ä»¥ä¸Šç‰ˆæœ¬çš„é—®é¢˜ï¼ŒæŒ‰ç…§ä¸‹é¢æ“ä½œå³å¯ï¼š</p><blockquote><p>$ npm install hexo-deployer-git â€“save</p></blockquote><p>ç„¶åå°†ä¸Šé¢è¯´åˆ°çš„éƒ¨ç½²æ–‡ä»¶çš„typeç”±<strong>github</strong>æ”¹ä¸º<strong>git</strong></p><blockquote><p>deploy:<br>type: git<br>repo: <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:username/username.github.io.git</p></blockquote><p>é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œç„¶åå‘å¸ƒï¼Œè¿™æ ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥username.github.ioå°±å¯ä»¥åˆ°ä½ åœ¨githubä¸Šçš„åšå®¢äº†ï¼Œ æœ‰æ²¡æœ‰å°æ¿€åŠ¨ï¼Ÿ æœ€åå°ä¼™ä¼´ä»¬å“ªé‡Œçœ‹ä¸æ‡‚æˆ–å“ªé‡Œæœ‰é—®é¢˜æ¬¢è¿ç•™è¨€ï¼Œæˆ‘è¿›è¡Œè¡¥å……æˆ–å›ç­”, æ›´å¤šé—®é¢˜å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£<a href="https://hexo.io/docs/" target="_blank" rel="noopener">Docs</a> .</p><p>æœ€åçœŸçš„æ„Ÿæ¿€å‰è¾ˆä»¬çš„åšæ–‡æŒ‡ç‚¹ï¼Œä¸‹é¢æä¾›æˆ‘å‚è€ƒè¿‡çš„ä¸€äº›é“¾æ¥ï¼š</p><ol><li><a href="http://cnfeat.com/2014/05/10/2014-05-11-how-to-build-a-blog/" target="_blank" rel="noopener">å¦‚ä½•æ­å»ºä¸€ä¸ªç‹¬ç«‹åšå®¢â€”â€”ç®€æ˜GithubPagesä¸Hexoæ•™ç¨‹</a></li><li><a href="http://blog.fens.me/hexo-blog-github/" target="_blank" rel="noopener">Hexoåœ¨githubä¸Šæ„å»ºå…è´¹çš„Webåº”ç”¨</a></li><li><a href="http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html" target="_blank" rel="noopener">æ­å»ºä¸€ä¸ªå…è´¹çš„ï¼Œæ— é™æµé‡çš„Blogâ€”-github Pageså’ŒJekyllå…¥é—¨</a></li><li><a href="http://www.cnblogs.com/fstang/p/3308964.html" target="_blank" rel="noopener">ç”¨Jekyllåœ¨githubä¸Šå†™åšå®¢â€”â€”ã€Šæ­å»ºä¸€ä¸ªå…è´¹çš„ï¼Œæ— é™æµé‡çš„Blogã€‹çš„æ³¨è„š</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub Pages </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
